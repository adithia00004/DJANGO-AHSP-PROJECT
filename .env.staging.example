# Staging Environment Configuration
# Copy to .env.staging for staging deployment
# Staging should closely mirror production but with relaxed security for testing

# ============================================================================
# Django Core Settings
# ============================================================================

DJANGO_ENV=staging
DJANGO_DEBUG=False

# Generate a secure secret key (different from production!)
# Python command: python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
DJANGO_SECRET_KEY=staging-secret-key-change-me

# Staging domain(s)
DJANGO_ALLOWED_HOSTS=staging.example.com,staging-api.example.com,localhost

# CSRF trusted origins
DJANGO_CSRF_TRUSTED_ORIGINS=https://staging.example.com,http://localhost:8000

# Application version
APP_VERSION=1.0.0-staging


# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================

POSTGRES_DB=ahsp_sni_staging
POSTGRES_USER=postgres
POSTGRES_PASSWORD=staging-password-change-me
POSTGRES_HOST=postgres-staging
POSTGRES_PORT=5432

# Connection pool settings
POSTGRES_CONN_MAX_AGE=300


# ============================================================================
# Redis Cache Configuration (REQUIRED)
# ============================================================================

# Redis connection URL
REDIS_URL=redis://redis-staging:6379/1

# Redis password
REDIS_PASSWORD=staging-redis-password

# Connection pool settings
REDIS_MAX_CONNECTIONS=50


# ============================================================================
# Gunicorn Configuration
# ============================================================================

# Fewer workers than production for resource efficiency
GUNICORN_WORKERS=5

# Worker timeout
GUNICORN_TIMEOUT=120

# Bind address
GUNICORN_BIND=0.0.0.0:8000

# Worker class
GUNICORN_WORKER_CLASS=sync

# Max requests per worker
GUNICORN_MAX_REQUESTS=1000
GUNICORN_MAX_REQUESTS_JITTER=50

# Logging (more verbose than production)
GUNICORN_LOG_LEVEL=info
GUNICORN_ACCESS_LOG=-
GUNICORN_ERROR_LOG=-

# Process name
GUNICORN_PROC_NAME=ahsp-staging

# Preload application
GUNICORN_PRELOAD=False


# ============================================================================
# Logging & Monitoring
# ============================================================================

DJANGO_LOG_LEVEL=INFO
DJANGO_PERF_THRESHOLD=0.9

# Sentry DSN (optional - separate project from production)
SENTRY_DSN=

# Sentry environment
SENTRY_ENVIRONMENT=staging

# Higher sample rate for staging to catch issues
SENTRY_TRACES_SAMPLE_RATE=0.5


# ============================================================================
# Email Configuration
# ============================================================================

# Use console backend or mailtrap for testing
DJANGO_EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
DJANGO_DEFAULT_FROM_EMAIL=no-reply@staging.example.com
DJANGO_SERVER_EMAIL=server@staging.example.com

# If using SMTP for staging
# EMAIL_HOST=smtp.mailtrap.io
# EMAIL_PORT=2525
# EMAIL_HOST_USER=mailtrap-user
# EMAIL_HOST_PASSWORD=mailtrap-password
# EMAIL_USE_TLS=True


# ============================================================================
# Static & Media Files
# ============================================================================

# Static files root
DJANGO_STATIC_ROOT=/var/www/ahsp-staging/static

# Media files root
DJANGO_MEDIA_ROOT=/var/www/ahsp-staging/media


# ============================================================================
# Security Settings (Staging - Relaxed for Testing)
# ============================================================================

# HTTPS enforcement (if staging has HTTPS)
DJANGO_SECURE_SSL_REDIRECT=False
DJANGO_SESSION_COOKIE_SECURE=False
DJANGO_CSRF_COOKIE_SECURE=False

# HSTS settings (disabled for staging)
DJANGO_SECURE_HSTS_SECONDS=0
DJANGO_SECURE_HSTS_INCLUDE_SUBDOMAINS=False
DJANGO_SECURE_HSTS_PRELOAD=False

# Other security headers (enabled)
DJANGO_SECURE_CONTENT_TYPE_NOSNIFF=True
DJANGO_SECURE_BROWSER_XSS_FILTER=True
DJANGO_X_FRAME_OPTIONS=SAMEORIGIN

# Session settings (relaxed timeout for testing)
DJANGO_SESSION_COOKIE_HTTPONLY=True
DJANGO_SESSION_COOKIE_SAMESITE=Lax
DJANGO_SESSION_COOKIE_AGE=86400


# ============================================================================
# Rate Limiting Configuration
# ============================================================================

RATE_LIMITING_ENABLED=True

# More relaxed limits for staging testing
RATE_LIMIT_DEFAULT_MAX_REQUESTS=100
RATE_LIMIT_DEFAULT_WINDOW=60

# Per-category limits
RATE_LIMIT_BULK_MAX_REQUESTS=10
RATE_LIMIT_BULK_WINDOW=300
RATE_LIMIT_WRITE_MAX_REQUESTS=30
RATE_LIMIT_WRITE_WINDOW=60
RATE_LIMIT_READ_MAX_REQUESTS=150
RATE_LIMIT_READ_WINDOW=60


# ============================================================================
# Testing & Development Features
# ============================================================================

# Enable Django Debug Toolbar in staging (optional)
ENABLE_DEBUG_TOOLBAR=False

# Django extensions (for shell_plus, etc.)
ENABLE_DJANGO_EXTENSIONS=True

# Maintenance mode
MAINTENANCE_MODE=False

# Feature flags (all enabled for testing)
FEATURE_DEEP_COPY_ENABLED=True
FEATURE_BATCH_OPERATIONS_ENABLED=True
FEATURE_EXPORT_PDF_ENABLED=True

# Performance testing flags
ENABLE_QUERY_LOGGING=True
ENABLE_SLOW_REQUEST_LOGGING=True


# ============================================================================
# Backup & Maintenance
# ============================================================================

# Shorter retention for staging
BACKUP_RETENTION_DAYS=7


# ============================================================================
# Third-Party Integrations (Staging/Test Accounts)
# ============================================================================

# AWS credentials (staging bucket)
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_STORAGE_BUCKET_NAME=ahsp-staging
# AWS_S3_REGION_NAME=ap-southeast-1
