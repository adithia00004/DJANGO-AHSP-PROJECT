import{c as e}from"./vendor-ag-grid-CNpf5Dvm.js";class t{constructor(e){this.rootElement=e,this.handlers=new Map,this.activeListeners=new Map}on(e,t,l,s={}){this.handlers.has(e)||(this.handlers.set(e,[]),this._attachListener(e,s)),this.handlers.get(e).push({selector:t,handler:l,options:s})}off(e,t,l){if(!this.handlers.has(e))return;const s=this.handlers.get(e),n=s.findIndex(e=>e.selector===t&&e.handler===l);-1!==n&&(s.splice(n,1),0===s.length&&(this._detachListener(e),this.handlers.delete(e)))}clearEvent(e){this.handlers.has(e)&&(this._detachListener(e),this.handlers.delete(e))}destroy(){for(const e of this.handlers.keys())this._detachListener(e);this.handlers.clear(),this.activeListeners.clear(),this.rootElement=null}_attachListener(e,t={}){const l=t=>{const l=this.handlers.get(e)||[];for(const{selector:e,handler:s}of l){const l=t.target.closest(e);l&&this.rootElement.contains(l)&&s.call(l,t,l)}};this.rootElement.addEventListener(e,l,{capture:t.capture||!1,passive:t.passive||!1}),this.activeListeners.set(e,l)}_detachListener(e){const t=this.activeListeners.get(e);t&&(this.rootElement.removeEventListener(e,t),this.activeListeners.delete(e))}}function l(e){let t=null,l=null;const s=function(...s){l=s,null===t&&(t=requestAnimationFrame(()=>{e.apply(this,l),t=null,l=null}))};return s.cancel=()=>{null!==t&&(cancelAnimationFrame(t),t=null,l=null)},s}function s(e,t={}){const{min:l=0,max:s=100,precision:n=1}=t;if(null==e||""===e)return{isValid:!0,message:"",level:"info",value:0};const i=parseFloat(e);if(isNaN(i))return{isValid:!1,message:`Nilai harus berupa angka (0-${s})`,level:"error",value:0};if(i<l)return{isValid:!1,message:`Nilai tidak boleh kurang dari ${l}`,level:"error",value:l};if(i>s)return{isValid:!1,message:`Nilai tidak boleh lebih dari ${s}`,level:"error",value:s};return{isValid:!0,message:"",level:"info",value:Math.round(i*Math.pow(10,n))/Math.pow(10,n)}}function n(e,t,l){const s=document.querySelector(`[data-pekerjaan-id="${e}"]`);if(!s)return;const n=s.querySelector(".progress-indicator")||function(e){const t=e.querySelector(".name-cell");if(!t)return null;const l=document.createElement("span");return l.className="progress-indicator",t.appendChild(l),l}(s),i=function(e,t={}){const{maxTotal:l=100,tolerance:s=.1}=t,n=e.reduce((e,t)=>e+(parseFloat(t)||0),0),i=Math.round(10*n)/10;return Math.abs(i-l)<s?{isValid:!0,message:`Total: ${i}%`,level:"info",value:i}:i>l?{isValid:!1,message:`Total melebihi ${l}% (${i}%)`,level:"error",value:i}:i<l-s?{isValid:!1,message:`Total kurang dari ${l}% (${i}%)`,level:"warning",value:i}:{isValid:!0,message:`Total: ${i}%`,level:"info",value:i}}([t],{maxTotal:100});n.textContent=`${t.toFixed(1)}%`,n.className="progress-indicator","error"===i.level?n.classList.add("progress-error"):"warning"===i.level?n.classList.add("progress-warning"):n.classList.add("progress-success"),l&&l.progressTotals&&l.progressTotals.set(e,t)}function i(e,t,l){const n=e.target,i=n.value,a=s(i);if(function(e,t,l={}){const{showTooltip:s=!0,tooltipDuration:n=3e3}=l;e.classList.remove("validation-error","validation-warning","validation-success");const i=e.querySelector(".validation-tooltip");if(i&&i.remove(),t.isValid)e.classList.add("validation-success");else if("error"===t.level?e.classList.add("validation-error"):"warning"===t.level&&e.classList.add("validation-warning"),s&&t.message){const l=document.createElement("div");l.className=`validation-tooltip validation-tooltip-${t.level}`,l.textContent=t.message,e.style.position="relative",e.appendChild(l),n>0&&setTimeout(()=>{l.remove()},n)}}(t,a,{showTooltip:!a.isValid,tooltipDuration:3e3}),a.isValid||a.value!==parseFloat(i)){n.value=a.value;const e=t.dataset.cellId;e&&l.modifiedCells&&l.modifiedCells.set(e,a.value)}return a.isValid||"error"!==a.level||"function"==typeof window.showToast&&window.showToast(a.message,"danger",3e3),a}class a{constructor(e,t){this.state=e,this.helpers=t,this.eventManagers=new Map,this.scrollHandlers=new Map}attachEvents(){var e,t,l,s;const n=(null==(e=this.state.domRefs)?void 0:e.leftTbody)||document.getElementById("left-tbody"),i=(null==(t=this.state.domRefs)?void 0:t.rightTbody)||document.getElementById("right-tbody"),a=(null==(l=this.state.domRefs)?void 0:l.leftPanelScroll)||document.querySelector(".left-panel-scroll"),o=(null==(s=this.state.domRefs)?void 0:s.rightPanelScroll)||document.querySelector(".right-panel-scroll");return n&&i?(this.cleanup(),this._setupLeftPanelEvents(n),this._setupRightPanelEvents(i),a&&o&&this._setupScrollSync(a,o),!0):(console.error("Grid containers not found"),!1)}_setupLeftPanelEvents(e){const l=new t(e);l.on("click",".tree-toggle",(e,t)=>{this._handleTreeToggle(e,t)}),l.on("click",".name-cell",(e,t)=>{this._handleRowSelection(e,t)}),this.eventManagers.set("left-panel",l)}_setupRightPanelEvents(e){const l=new t(e);l.on("click",".time-cell.editable",(e,t)=>{this._handleCellClick(e,t)}),l.on("dblclick",".time-cell.editable",(e,t)=>{this._handleCellDoubleClick(e,t)}),l.on("input",".time-cell input",(e,t)=>{this._handleCellInput(e,t)}),l.on("blur",".time-cell input",(e,t)=>{this._handleCellBlur(e,t)}),l.on("keydown",".time-cell input",(e,t)=>{this._handleCellKeydown(e,t)}),this.eventManagers.set("right-panel",l)}_setupScrollSync(e,t){const s=l(()=>{t.scrollTop=e.scrollTop}),n=l(()=>{e.scrollTop=t.scrollTop});e.addEventListener("scroll",s,{passive:!0}),t.addEventListener("scroll",n,{passive:!0}),this.scrollHandlers.set("left",{element:e,handler:s}),this.scrollHandlers.set("right",{element:t,handler:n})}_handleTreeToggle(e,t){e.stopPropagation();const l=t.dataset.nodeId,s=!t.classList.contains("collapsed");s?(this.state.expandedNodes.delete(l),t.classList.add("collapsed")):(this.state.expandedNodes.add(l),t.classList.remove("collapsed")),this._toggleNodeChildren(l,!s),requestAnimationFrame(()=>{this._syncRowHeights()})}_toggleNodeChildren(e,t){var l,s;const n=(null==(l=this.state.domRefs)?void 0:l.leftTbody)||document.getElementById("left-tbody"),i=(null==(s=this.state.domRefs)?void 0:s.rightTbody)||document.getElementById("right-tbody"),a=`[data-parent-id="${e}"]`,o=n.querySelectorAll(a),r=i.querySelectorAll(a),d=t?"":"none";o.forEach(e=>{if(e.style.display=d,!t){const t=e.dataset.nodeId;t&&this._toggleNodeChildren(t,!1)}}),r.forEach(e=>{e.style.display=d})}_handleRowSelection(e,t){const l=t.closest("tr");if(!l)return;l.classList.toggle("row-selected");const s=l.dataset.rowIndex;if(s){const e=document.querySelector(`.right-panel-scroll tr[data-row-index="${s}"]`);e&&e.classList.toggle("row-selected")}}_handleCellClick(e,t){document.querySelectorAll(".time-cell.selected").forEach(e=>{e.classList.remove("selected")}),t.classList.add("selected")}_handleCellDoubleClick(e,t){e.preventDefault(),t.classList.contains("editing")||this._enterEditMode(t)}_enterEditMode(e){const t=e.dataset.value||"0",l=document.createElement("input");l.type="number",l.className="cell-input",l.value=t,l.min="0",l.max="100",l.step="0.1",e.innerHTML="",e.appendChild(l),e.classList.add("editing"),l.focus(),l.select()}_handleCellInput(e,t){const l=t.closest(".time-cell");if(!l)return;const s=parseFloat(t.value);isNaN(s)||(s<0||s>100?l.classList.add("validation-warning"):l.classList.remove("validation-warning"))}_handleCellBlur(e,t){const l=t.closest(".time-cell");if(!l)return;const s=i(e,l,this.state);this._exitEditMode(l,s.value);const n=l.dataset.cellId;if(n){this.state.modifiedCells=this.state.modifiedCells||new Map,this.state.modifiedCells.set(n,s.value),this.state.isDirty=!0;const[e]=n.split("-");this._updatePekerjaanProgress(e)}}_exitEditMode(e,t){e.classList.remove("editing"),e.dataset.value=t;const l=0===t?"-":`${t}%`;e.innerHTML=`<span class="cell-value">${l}</span>`}_handleCellKeydown(e,t){const l=t.closest(".time-cell");if(l)switch(e.key){case"Enter":e.preventDefault(),t.blur(),this._navigateToNextCell(l,"down");break;case"Escape":e.preventDefault();const s=l.dataset.originalValue||"0";t.value=s,t.blur();break;case"Tab":e.preventDefault(),t.blur();const n=e.shiftKey?"left":"right";this._navigateToNextCell(l,n);break;case"ArrowUp":e.ctrlKey&&(e.preventDefault(),t.blur(),this._navigateToNextCell(l,"up"));break;case"ArrowDown":e.ctrlKey&&(e.preventDefault(),t.blur(),this._navigateToNextCell(l,"down"))}}_navigateToNextCell(e,t){const l=e.closest("tr");if(!l)return;let s=null;switch(t){case"right":for(s=e.nextElementSibling;s&&!s.classList.contains("editable");)s=s.nextElementSibling;break;case"left":for(s=e.previousElementSibling;s&&!s.classList.contains("editable");)s=s.previousElementSibling;break;case"down":const t=l.nextElementSibling;if(t){const n=Array.from(l.children).indexOf(e);s=t.children[n]}break;case"up":const n=l.previousElementSibling;if(n){const t=Array.from(l.children).indexOf(e);s=n.children[t]}}s&&s.classList.contains("editable")&&this._enterEditMode(s)}_updatePekerjaanProgress(e){const t=this.state.modifiedCells||new Map,l=this.state.timeColumns||[];let s=0;l.forEach(l=>{const n=`${e}-${l.id}`,i=t.get(n)||0;s+=parseFloat(i)||0}),"function"==typeof this.helpers.updateProgressIndicator&&this.helpers.updateProgressIndicator(e,s)}_syncRowHeights(){var e,t;const l=(null==(e=this.state.domRefs)?void 0:e.leftTbody)||document.getElementById("left-tbody"),s=(null==(t=this.state.domRefs)?void 0:t.rightTbody)||document.getElementById("right-tbody");if(!l||!s)return;const n=l.querySelectorAll("tr"),i=s.querySelectorAll("tr");n.forEach((e,t)=>{const l=i[t];if(!l)return;e.style.height="",l.style.height="";const s=e.offsetHeight,n=l.offsetHeight,a=Math.max(s,n);e.style.height=`${a}px`,l.style.height=`${a}px`})}cleanup(){for(const e of this.eventManagers.values())e.destroy();this.eventManagers.clear();for(const{element:e,handler:t}of this.scrollHandlers.values())t.cancel&&t.cancel(),e.removeEventListener("scroll",t);this.scrollHandlers.clear()}}function o(e,t={}){const l=new a(e,t);return l.attachEvents(),l}function r(e=[]){const t=[{headerName:"Kode",field:"code",width:150,pinned:"left",suppressSizeToFit:!0,cellClass:"ag-code-col"},{headerName:"Pekerjaan",field:"name",minWidth:240,flex:1.2,pinned:"left",cellRenderer:d,cellClass:"ag pekerjaan-col"}],l=(e||[]).map(e=>{const t=e.fieldId||e.id||"periode";return{headerName:e.label||e.id||"Periode",field:t,minWidth:120,flex:1,type:"numericColumn",editable:!0,cellEditor:"agNumberCellEditor",cellClass:"ag-time-col",valueFormatter:e=>null===e.value||void 0===e.value||""===e.value?"-":`${e.value}`}});return t.concat(l)}function d(e){var t;const l=e.value||"",s=(null==(t=e.data)?void 0:t.level)||0,n=document.createElement("div");return n.className="ag-pekerjaan-label",n.style.paddingLeft=16*s+"px",n.textContent=l,n}class c{constructor(e,t={}){this.state=e,this.helpers=t,this.gridApi=null,this.columnApi=null,this.gridOptions=null,this.container=null,this.currentColumns=[]}mount(t){t?(this.container=t,this.gridOptions=this._createGridOptions(),this.gridApi=e(t,this.gridOptions),"function"==typeof this.gridApi.getColumnApi&&(this.columnApi=this.gridApi.getColumnApi()),t.classList.add("ag-grid-initialized")):console.warn("[AGGridManager] Container not provided")}updateData({tree:e=[],timeColumns:t=[]}={}){if(!this.gridApi)return;const l=r(t);this.currentColumns=t,this.gridApi.setGridOption("columnDefs",l);const s=this._buildRowData(e,t);this.gridApi.setGridOption("rowData",s)}destroy(){this.gridApi&&(this.gridApi.destroy(),this.gridApi=null,this.columnApi=null)}_createGridOptions(){return{columnDefs:r([]),rowData:[],animateRows:!0,suppressAggFuncInHeader:!0,defaultColDef:{resizable:!0,sortable:!1,flex:1,minWidth:120},onCellValueChanged:e=>this._handleCellValueChanged(e)}}_buildRowData(e=[],t=[]){const l=[],s=t||[],n=(e,t=[])=>{Array.isArray(e)&&e.forEach((e,i)=>{if(!e)return;const a=e.snapshot_uraian||e.uraian||e.nama||e.name||`Node ${t.length+i+1}`,o=e.snapshot_kode||e.kode||e.code||"",r=t.concat(a),d={id:e.id||e.pekerjaan_id||`node-${r.join("-")}`,name:a,code:o,path:r,level:t.length,raw:e};s.length>0&&s.forEach(t=>{var l,s;const n=e.assignments||e.assignment_map||e.assignmentMap||e[t.fieldId];let i="";if(n&&"object"==typeof n){const e=null!=(s=null!=(l=n[t.id])?l:n[t.fieldId])?s:n[t.label];i=null!=e?e:""}else void 0!==e[t.fieldId]&&(i=e[t.fieldId]);d[t.fieldId||t.id]=null!=i?i:""}),l.push(d),Array.isArray(e.children)&&e.children.length>0&&n(e.children,r)})};return n(e,[]),l}_handleCellValueChanged(e){var t,l;const n=null==e?void 0:e.colDef,i=null==n?void 0:n.field;if(!i)return;const a=null==e?void 0:e.data,o=(null==(t=null==a?void 0:a.raw)?void 0:t.id)||(null==a?void 0:a.id);if(!o)return;const r=s(e.newValue,{min:0,max:100,precision:1});if(!r.isValid&&r.message&&"function"==typeof this.helpers.showToast){const e="error"===r.level?"danger":"warning";this.helpers.showToast(r.message,e)}const d=null!=(l=r.value)?l:0;e.node&&e.node.setDataValue(i,d);const c=(this.currentColumns||[]).find(e=>(e.fieldId||e.id)===i)||null,h=`${o}-${i}`;"function"==typeof this.helpers.onCellChange&&this.helpers.onCellChange({cellKey:h,value:d,pekerjaanId:o,columnId:i,columnMeta:c})}}export{c as A,o as a,n as u};
//# sourceMappingURL=grid-modules-DxQgn-T9.js.map
