{"version":3,"mappings":"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","names":["GanttCanvasOverlay","constructor","tableManager","this","debug","Boolean","_b","_a","options","debugUnifiedTable","_d","_c","state","window","DEBUG_UNIFIED_TABLE","canvas","document","createElement","className","style","cssText","ctx","getContext","visible","barData","dependencies","barRects","tooltip","scrollTarget","_e","bodyScroll","addEventListener","syncWithTable","passive","_bindPointerEvents","show","scrollArea","position","appendChild","console","log","_log","hide","parentNode","removeChild","_hideTooltip","width","scrollWidth","height","scrollHeight","cellRects","getCellBoundingRects","clearRect","cells","length","bars","deps","size","w","h","error","strokeStyle","forEach","rect","strokeRect","x","y","_drawBars","_drawDependencies","renderBars","Array","isArray","renderDependencies","dependencyData","rectIndex","Map","r","key","String","pekerjaanId","has","set","get","push","list","sort","a","b","barsByRow","bar","barsDrawn","barsSkipped","pkjId","rects","rectMap","map","columnId","maxWidth","paddingX","baseX","baseY","fullHeight","Math","max","paddingY","trackHeight","plannedValue","Number","isFinite","planned","min","actualValue","actual","value","plannedWidth","plannedColor","_getPlannedColor","fillStyle","fillRect","actualWidth","actualColor","_resolveActualColor","variance","color","label","drawn","skipped","total","dep","fromRect","find","c","fromPekerjaanId","fromColumnId","toRect","toPekerjaanId","toColumnId","fromX","fromY","toX","toY","lineWidth","beginPath","moveTo","lineTo","stroke","angle","atan2","cos","PI","sin","closePath","fill","_resolveVarianceColor","_getCssVar","name","root","documentElement","getComputedStyle","getPropertyValue","trim","e","_getBtnColor","selector","el","querySelector","getBoundingClientRect","clientX","left","clientY","top","hit","_hitTest","_showTooltip","_ensureTooltip","body","tip","innerHTML","display","event","payload","KurvaSCanvasOverlay","yAxisCanvas","yAxisCtx","curveData","legendElement","_showLegend","_hideLegend","plannedPoints","actualPoints","_drawCurve","_getActualColor","_drawYAxisLabels","warn","renderCurve","dataPoints","points","_mapDataToCanvasPoints","lineCap","lineJoin","point","index","arc","y0percent","columnCenters","_getWeekColumnCenters","dataPoint","weekId","week","progress","cumulativeProgress","columnCenter","reason","_interpolateY","centerX","y0","y100","font","textAlign","textBaseline","pct","fillText","UnifiedTableManager","currentMode","tanstackGrid","overlays","gantt","kurva","mount","container","domTargets","TanStackGridManager","setCellRenderer","containerMounted","updateData","rows","tree","currentRows","cols","timeColumns","currentColumns","_refreshGanttOverlay","_refreshKurvaSOverlay","switchMode","newMode","oldMode","targetRenderer","grid","call","from","to","renderer","_buildBarData","columns","gridRows","gridColumns","flatRows","flatPekerjaan","row","id","pekerjaan_id","nama","raw","subRows","hasTimeMeta","some","meta","timeColumn","col","fieldId","columnMeta","stateManager","_f","stateManagerInstance","_g","mergedPlanned","getAllCellsForMode","_mergeModeState","_h","states","mergedActual","_i","activeMode","_j","progressMode","toLowerCase","plannedSize","actualSize","samplePlannedKeys","keys","slice","sampleActualKeys","samplePlannedValues","entries","sampleActualValues","timeColumnsWithMeta","filter","sampleColumns","sampleRows","rowsForBars","_flattenRows","rowIndex","columnIndex","_resolveColumnMeta","column_id","Set","_k","_l","cellKey","pkjIdRaw","colIdRaw","split","rowInfo","colMeta","_resolveValue","plannedKeys","actualKeys","columnIds","nodes","result","stack","node","shift","children","sub","__spreadProps","__spreadValues","mode","generationMode","type","rangeLabel","weekNumber","modeState","merged","assignmentMap","modifiedCells","fallback","val","_buildCurveData","columnsTotal","plannedCells","actualCells","_calculateCumulativeProgress","cellData","curvePoints","week_number","weekProgress","weekCount","colId","numValue","avgProgress","JadwalKegiatanApp","initialized","gridManager","StateManager","getInstance","dataLoader","timeColumnGenerator","saveHandler","unifiedManager","_gridContainerParent","_gridContainerNextSibling","kurvaSChart","ganttChart","ganttFrozenGrid","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_stateManagerListener","_suppressStateManagerEvent","_currencyFormatter","_getProjectDateRange","start","end","projectStart","parsed","Date","isNaN","getTime","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","floor","ceil","_countWeeklyColumns","initialize","__async","arguments","config","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","volumeMap","isLoading","domRefs","apiEndpoints","projectId","projectName","useUPlotKurva","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","displayMode","useUnifiedTable","disableUnifiedTable","keepLegacyGantt","enableLegacyGantt","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","_bindStateManagerEvents","getCurrentState","defineProperty","configurable","costAssignmentMap","costModifiedCells","hasUnsavedChanges","_handleStateManagerEvent","_unbindStateManagerEvents","removeEventListener","_applyProgressModeSwitch","showToast","_handleStateCommitEvent","_handleStateResetEvent","refreshCells","_updateStatusBar","_updateCharts","modeLabel","_syncToolbarRadios","_syncGridViews","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","disabled","classList","toggle","setAttribute","removeAttribute","getElementById","refreshButton","resetButton","tanstackGridContainer","tanstackGridBody","tanstackGridTopScroll","tanstackGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","dataset","allowedTimeScales","datasetScale","defaultTimeScale","toString","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","weekend","weekEnd","week_end_day","parsedWeekStartDay","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","reset","apiResetProgress","enableUplotKurva","_attachToolbarEvents","_initTanStackGridIfNeeded","saveChanges","refresh","_handleResetProgress","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","KeyboardShortcuts","register","Toast","info","description","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","warning","querySelectorAll","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","preventDefault","_showKeyboardShortcutsHelp","getShortcuts","initializeUXEnhancements","modalHtml","s","replace","join","existingModal","remove","insertAdjacentHTML","Modal","ExportManager","format","button","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","enableCostView","toggleView","_setCostToggleButtonState","viewMode","add","isCostMode","iconClass","textContent","_activateDefaultCostView","groupName","handler","radios","radio","target","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","confirm","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","text","catch","status","json","_resetEditedCellsState","clear","_clearFailedRows","message","forceReload","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_recalculateAllProgressTotals","_invalidateCachedDataset","clearTimeout","setTimeout","then","data","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","successMessage","next","pyDay","isChecked","nextElementSibling","matches","_updateCostToggleAvailability","setInputMode","oldStats","getStats","newStats","toUpperCase","modifiedCount","assignmentCount","nextMode","previousInputMode","_updateProgressModeIndicator","indicator","bgClass","isActual","nextScale","_renderGrid","nextSibling","bind","onCellChange","_handleGridCellChange","getCellValidationState","_getCellValidationState","topScroll","topScrollInner","DataLoader","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","loadAssignments","_loadKurvaSData","_initializeCharts","statusText","hargaMap","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","_loadChartModules","kurvaSModule","import","n","u","__VITE_PRELOAD__","KurvaSChartClass","KurvaSUPlotChart","default","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","Promise","resolve","ganttContainer","ganttView","ganttTab","_initializeUnifiedGanttOverlay","host","_ensureGanttHost","gridPayload","_getDisplayTimeColumns","_applyGanttOverlayStyles","styleId","head","minHeight","_moveGridContainerTo","_restoreGridContainerPosition","parent","insertBefore","_prepareGanttData","pekerjaanNodes","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","actualVal","round","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_rencana","progress_realisasi","satuan","projectMeta","project_id","project_name","start_date","end_date","project","milestones","_setupLazyChartLoading","_bindUnifiedTabSync","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","scrollTop","deltaY","_escapeHtml","char","_validateRowTotalsBeforeSave","ButtonStateManager","setLoading","success","setSuccess","setError","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","_buildTimeColumns","tahap","rawId","order","urutan","startDate","tanggal_mulai","endDate","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","_fetchJson","_0","url","errorText","displayColumns","activeTimeColumns","updateTopScrollMetrics","_renderLegacyGrid","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","_calculateRowTotalPercent","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","_getRowCostCapacity","costFields","field","_getMergedCostCells","_calculateAllCostTotals","totals","_formatCurrency","Intl","NumberFormat","currency","maximumFractionDigits","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","costViolations","totalCost","combined","concat","messages","pekerjaanCount","totalProgress","_calculateProjectProgress","aggregate","avg","pekerjaanTotals","numericValue","sum","_buildAssignmentsPayload","assignments","_parseCellKey","proportion","tahapan_id","_getSaveMode","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","_buildMonthlyColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","endLabel","_coerceDate","_m","_n","rangeText","_formatShortRange","childColumns","readOnly","date","getDate","padStart","getMonth","separatorIndex","indexOf","cookieValue","cookie","cookies","substring","decodeURIComponent","displayValue","isVolumeMode","validation","valueType","normalizedValue","resolvedPekerjaanId","gridTab","destroy","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/gantt/GanttCanvasOverlay.js","../../../../../../js/src/modules/kurva-s/KurvaSCanvasOverlay.js","../../../../../../js/src/modules/unified/UnifiedTableManager.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["export class GanttCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.debug = Boolean(\n      this.tableManager?.options?.debugUnifiedTable ||\n      this.tableManager?.state?.debugUnifiedTable ||\n      window.DEBUG_UNIFIED_TABLE\n    );\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'gantt-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 10;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n    this.visible = false;\n    this.barData = [];\n    this.dependencies = [];\n    this.barRects = [];\n    this.tooltip = null;\n\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          this.syncWithTable();\n        }\n      }, { passive: true });\n    }\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n    scrollArea.appendChild(this.canvas);\n    this.visible = true;\n    console.log('[GanttOverlay]  OVERLAY SHOWN - Cyan planned (#0dcaf0), Yellow actual (#ffc107)');\n    this._log('show');\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n    this.visible = false;\n    this._log('hide');\n    this._hideTooltip();\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this.canvas.width = scrollArea.scrollWidth;\n    this.canvas.height = scrollArea.scrollHeight;\n\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\n      ? this.tableManager.getCellBoundingRects()\n      : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.barRects = [];\n    this._log('sync', {\n      cells: cellRects.length,\n      bars: this.barData.length,\n      deps: this.dependencies.length,\n      size: { w: this.canvas.width, h: this.canvas.height },\n    });\n\n    if (this.barData.length > 0 && cellRects.length === 0) {\n      console.error('[GanttOverlay] Have bar data but no cell rects. Overlay cannot draw bars.', {\n        bars: this.barData.length,\n      });\n    }\n\n    // Outline cells only when debugging alignment\n    if (this.debug) {\n      this.ctx.strokeStyle = '#e2e8f0';\n      cellRects.forEach((rect) => {\n        this.ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\n      });\n    }\n\n    this._drawBars(cellRects);\n    this._drawDependencies(cellRects);\n  }\n\n  renderBars(barData) {\n    this.barData = Array.isArray(barData) ? barData : [];\n    this._log('renderBars', { bars: this.barData.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  renderDependencies(dependencyData) {\n    this.dependencies = Array.isArray(dependencyData) ? dependencyData : [];\n    this._log('renderDependencies', { deps: this.dependencies.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _drawBars(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.barData.length === 0) {\n      return;\n    }\n    // Group cell rects by pekerjaan\n    const rectIndex = new Map();\n    cellRects.forEach((r) => {\n      const key = String(r.pekerjaanId);\n      if (!rectIndex.has(key)) rectIndex.set(key, []);\n      rectIndex.get(key).push(r);\n    });\n    rectIndex.forEach((list) => list.sort((a, b) => a.x - b.x));\n\n    const barsByRow = new Map();\n    this.barData.forEach((bar) => {\n      const key = String(bar.pekerjaanId);\n      if (!barsByRow.has(key)) barsByRow.set(key, []);\n      barsByRow.get(key).push(bar);\n    });\n\n    let barsDrawn = 0;\n    let barsSkipped = 0;\n\n    barsByRow.forEach((bars, pkjId) => {\n      const rects = rectIndex.get(pkjId) || [];\n      const rectMap = new Map(rects.map((r) => [String(r.columnId), r]));\n      // track heights for stacked view: planned bottom, actual top\n      bars.forEach((bar) => {\n        const rect = rectMap.get(String(bar.columnId));\n        if (!rect) {\n          barsSkipped += 1;\n          return;\n        }\n        const paddingX = 0; // no gap to keep continuity\n        const paddingY = 2;\n        const maxWidth = rect.width - paddingX * 2;\n        const baseX = rect.x + paddingX;\n        const baseY = rect.y + paddingY;\n        const fullHeight = Math.max(8, rect.height - paddingY * 2);\n        const trackHeight = fullHeight / 2; // split planned/actual vertically\n\n        const plannedValue = Number.isFinite(bar.planned) ? Math.max(0, Math.min(100, bar.planned)) : 0;\n        const actualValue = Number.isFinite(bar.actual) ? Math.max(0, Math.min(100, bar.actual)) : Math.max(0, Math.min(100, bar.value || 0));\n\n        // Planned track (bottom half): full width only if >0, otherwise gap\n        const plannedWidth = maxWidth > 0 && plannedValue > 0 ? maxWidth : 0;\n        const plannedColor = this._getPlannedColor(); // #0dcaf0\n        this.ctx.fillStyle = plannedColor;\n        if (plannedWidth > 0) {\n          this.ctx.fillRect(baseX, baseY + trackHeight, plannedWidth, trackHeight - 1);\n        }\n\n        // Actual track (top half): full width only if >0, otherwise gap\n        const actualWidth = maxWidth > 0 && actualValue > 0 ? maxWidth : 0;\n        const actualColor = this._resolveActualColor(bar.variance); // #ffc107\n        this.ctx.fillStyle = actualColor;\n        if (actualWidth > 0) {\n          this.ctx.fillRect(baseX, baseY, actualWidth, trackHeight - 1);\n        }\n\n        // Debug first bar\n        if (barsDrawn === 0 && (plannedWidth > 0 || actualWidth > 0)) {\n          console.log('[GanttOverlay] First bar rendered:', {\n            pekerjaanId: bar.pekerjaanId,\n            planned: { value: plannedValue, width: plannedWidth, color: plannedColor },\n            actual: { value: actualValue, width: actualWidth, color: actualColor },\n            position: { x: baseX, y: baseY, height: trackHeight }\n          });\n        }\n\n        this.barRects.push({\n          x: baseX,\n          y: baseY,\n          width: Math.max(actualWidth, plannedWidth),\n          height: fullHeight,\n          pekerjaanId: bar.pekerjaanId,\n          columnId: bar.columnId,\n          value: actualValue,\n          planned: plannedValue,\n          variance: bar.variance,\n          label: bar.label,\n          color: actualColor,\n        });\n        barsDrawn += 1;\n      });\n    });\n\n    this._log('bars:drawn', { drawn: barsDrawn, skipped: barsSkipped, total: this.barData.length });\n  }\n\n  _drawDependencies(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.dependencies.length === 0) {\n      return;\n    }\n\n    this.dependencies.forEach((dep) => {\n      const fromRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.fromPekerjaanId && c.columnId === dep.fromColumnId,\n      );\n      const toRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.toPekerjaanId && c.columnId === dep.toColumnId,\n      );\n      if (!fromRect || !toRect) return;\n\n      const fromX = fromRect.x + fromRect.width;\n      const fromY = fromRect.y + fromRect.height / 2;\n      const toX = toRect.x;\n      const toY = toRect.y + toRect.height / 2;\n\n      this.ctx.strokeStyle = dep.color || '#94a3b8';\n      this.ctx.lineWidth = 1.5;\n      this.ctx.beginPath();\n      this.ctx.moveTo(fromX, fromY);\n      this.ctx.lineTo(toX, toY);\n      this.ctx.stroke();\n\n      const arrowSize = 5;\n      const angle = Math.atan2(toY - fromY, toX - fromX);\n      this.ctx.beginPath();\n      this.ctx.moveTo(toX, toY);\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle - Math.PI / 6), toY - arrowSize * Math.sin(angle - Math.PI / 6));\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle + Math.PI / 6), toY - arrowSize * Math.sin(angle + Math.PI / 6));\n      this.ctx.closePath();\n      this.ctx.fillStyle = dep.color || '#94a3b8';\n      this.ctx.fill();\n    });\n  }\n\n  _resolveVarianceColor(variance) {\n    if (!Number.isFinite(variance)) return '#3b82f6';\n    if (variance < -0.1) return '#ef4444';\n    if (variance > 0.1) return '#22c55e';\n    return '#3b82f6';\n  }\n\n  _resolveActualColor(variance) {\n    // ALWAYS use yellow/warning color for actual bars\n    // This matches the toolbar btn-outline-warning color\n    return '#ffc107';\n  }\n\n  _getPlannedColor() {\n    // ALWAYS use cyan/info color for planned bars\n    // This matches the toolbar btn-outline-info color\n    return '#0dcaf0';\n  }\n\n  _getCssVar(name) {\n    try {\n      const root = document.documentElement;\n      const value = getComputedStyle(root).getPropertyValue(name);\n      return value && value.trim().length ? value.trim() : null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _getBtnColor(selector) {\n    try {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      const style = getComputedStyle(el);\n      return style.getPropertyValue('background-color')?.trim() ||\n        style.getPropertyValue('border-color')?.trim() ||\n        style.getPropertyValue('color')?.trim() ||\n        null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _bindPointerEvents() {\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible || !this.barRects.length) return;\n      const rect = this.canvas.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const hit = this._hitTest(x, y);\n      if (hit) {\n        this._showTooltip(e.clientX, e.clientY, hit);\n      } else {\n        this._hideTooltip();\n      }\n    });\n\n    this.canvas.addEventListener('mouseleave', () => {\n      this._hideTooltip();\n    });\n  }\n\n  _hitTest(x, y) {\n    return this.barRects.find(\n      (b) => x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height,\n    );\n  }\n\n  _ensureTooltip() {\n    if (this.tooltip) return this.tooltip;\n    this.tooltip = document.createElement('div');\n    this.tooltip.className = 'gantt-overlay-tooltip';\n    this.tooltip.style.cssText = `\n      position: fixed;\n      padding: 4px 8px;\n      background: rgba(17,24,39,0.85);\n      color: #f8fafc;\n      border-radius: 4px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: 20;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.25);\n    `;\n    document.body.appendChild(this.tooltip);\n    return this.tooltip;\n  }\n\n  _showTooltip(clientX, clientY, hit) {\n    const tip = this._ensureTooltip();\n    const name = hit.label || hit.pekerjaanId;\n    const planned = Number.isFinite(hit.planned) ? `${hit.planned}%` : '-';\n    const actual = Number.isFinite(hit.value) ? `${hit.value}%` : '-';\n    const variance = Number.isFinite(hit.variance) ? `${hit.variance}%` : '-';\n    tip.innerHTML = `Pekerjaan: ${name}<br/>Kolom: ${hit.columnId}<br/>Planned: ${planned}<br/>Actual: ${actual}<br/>Variance: ${variance}`;\n    tip.style.left = `${clientX + 10}px`;\n    tip.style.top = `${clientY + 10}px`;\n    tip.style.display = 'block';\n  }\n\n  _hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.style.display = 'none';\n    }\n  }\n\n  _log(event, payload) {\n    if (!this.debug) return;\n    console.log(`[GanttOverlay] ${event}`, payload || {});\n  }\n}\n","/**\n * Kurva-S Canvas Overlay\n * Plots S-curve as overlay on top of table grid\n * - Y-axis inverted: 0% at bottom (last row), 100% at top (first row)\n * - X-axis: Plots at center of each week column\n * - Shows both planned and actual curves\n * - Y-axis labels on right side of table\n * - Legend for planned vs actual\n */\n\nexport class KurvaSCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.debug = Boolean(\n      this.tableManager?.options?.debugUnifiedTable ||\n      this.tableManager?.state?.debugUnifiedTable ||\n      window.DEBUG_UNIFIED_TABLE\n    );\n\n    // Main canvas for curve plotting\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'kurva-s-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 10;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n\n    // Y-axis canvas (right side)\n    this.yAxisCanvas = document.createElement('canvas');\n    this.yAxisCanvas.className = 'kurva-s-yaxis-overlay';\n    this.yAxisCanvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      right: 0;\n      pointer-events: none;\n      z-index: 11;\n      width: 60px;\n    `;\n    this.yAxisCtx = this.yAxisCanvas.getContext('2d');\n\n    this.visible = false;\n    this.curveData = { planned: [], actual: [] };\n    this.legendElement = null;\n\n    // Scroll sync\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          this.syncWithTable();\n        }\n      }, { passive: true });\n    }\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n    scrollArea.appendChild(this.canvas);\n    scrollArea.appendChild(this.yAxisCanvas);\n\n    this.visible = true;\n    console.log('[KurvaSOverlay]  OVERLAY SHOWN - Cyan planned (#0dcaf0), Yellow actual (#ffc107)');\n    this._log('show');\n    this._showLegend();\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n    if (this.yAxisCanvas.parentNode) {\n      this.yAxisCanvas.parentNode.removeChild(this.yAxisCanvas);\n    }\n\n    this.visible = false;\n    this._log('hide');\n    this._hideLegend();\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    // Resize canvas to match table\n    this.canvas.width = scrollArea.scrollWidth;\n    this.canvas.height = scrollArea.scrollHeight;\n    this.yAxisCanvas.height = scrollArea.scrollHeight;\n\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\n      ? this.tableManager.getCellBoundingRects()\n      : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.yAxisCtx.clearRect(0, 0, this.yAxisCanvas.width, this.yAxisCanvas.height);\n\n    this._log('sync', {\n      cells: cellRects.length,\n      plannedPoints: this.curveData.planned.length,\n      actualPoints: this.curveData.actual.length,\n      size: { w: this.canvas.width, h: this.canvas.height },\n    });\n\n    if (cellRects.length === 0) {\n      console.warn('[KurvaSOverlay] No cell rects available for plotting');\n      return;\n    }\n\n    // Draw curves\n    this._drawCurve(cellRects, this.curveData.planned, this._getPlannedColor(), 'Planned');\n    this._drawCurve(cellRects, this.curveData.actual, this._getActualColor(), 'Actual');\n\n    // Draw Y-axis labels on right side\n    this._drawYAxisLabels();\n  }\n\n  renderCurve(curveData) {\n    this.curveData = {\n      planned: Array.isArray(curveData.planned) ? curveData.planned : [],\n      actual: Array.isArray(curveData.actual) ? curveData.actual : [],\n    };\n\n    this._log('renderCurve', {\n      plannedPoints: this.curveData.planned.length,\n      actualPoints: this.curveData.actual.length,\n    });\n\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _drawCurve(cellRects, dataPoints, color, label) {\n    if (!Array.isArray(dataPoints) || dataPoints.length === 0) {\n      return;\n    }\n\n    const points = this._mapDataToCanvasPoints(cellRects, dataPoints);\n    if (points.length === 0) {\n      this._log(`_drawCurve:${label}`, { error: 'No points mapped' });\n      return;\n    }\n\n    this._log(`_drawCurve:${label}`, { points: points.length });\n\n    // Draw line connecting points\n    this.ctx.strokeStyle = color;\n    this.ctx.lineWidth = 3;\n    this.ctx.lineCap = 'round';\n    this.ctx.lineJoin = 'round';\n\n    this.ctx.beginPath();\n    points.forEach((point, index) => {\n      if (index === 0) {\n        this.ctx.moveTo(point.x, point.y);\n      } else {\n        this.ctx.lineTo(point.x, point.y);\n      }\n    });\n    this.ctx.stroke();\n\n    // Draw points (nodes)\n    this.ctx.fillStyle = color;\n    points.forEach((point) => {\n      this.ctx.beginPath();\n      this.ctx.arc(point.x, point.y, 5, 0, 2 * Math.PI);\n      this.ctx.fill();\n\n      // White center for better visibility\n      this.ctx.fillStyle = '#ffffff';\n      this.ctx.beginPath();\n      this.ctx.arc(point.x, point.y, 2, 0, 2 * Math.PI);\n      this.ctx.fill();\n      this.ctx.fillStyle = color;\n    });\n  }\n\n  _mapDataToCanvasPoints(cellRects, dataPoints) {\n    const points = [];\n\n    // Get table vertical range (inverted: 0% = bottom, 100% = top)\n    const tableHeight = this.canvas.height;\n    const y0percent = tableHeight - 40; // 0% at BOTTOM\n    const y100percent = 40;              // 100% at TOP\n\n    // Group cell rects by column to find week column centers\n    const columnCenters = this._getWeekColumnCenters(cellRects);\n\n    dataPoints.forEach((dataPoint) => {\n      const columnId = dataPoint.columnId || dataPoint.weekId || dataPoint.week;\n      const progress = Number.isFinite(dataPoint.cumulativeProgress)\n        ? dataPoint.cumulativeProgress\n        : dataPoint.progress || 0;\n\n      // Find X position (center of week column)\n      const columnCenter = columnCenters.get(String(columnId));\n      if (!columnCenter) {\n        this._log('_mapDataToCanvasPoints:skip', {\n          columnId,\n          reason: 'Column center not found',\n        });\n        return;\n      }\n\n      // Calculate Y position (inverted: 0% bottom, 100% top)\n      const y = this._interpolateY(progress, y0percent, y100percent);\n\n      points.push({\n        x: columnCenter,\n        y: y,\n        columnId: columnId,\n        progress: progress,\n      });\n    });\n\n    return points;\n  }\n\n  _getWeekColumnCenters(cellRects) {\n    const columnCenters = new Map();\n\n    cellRects.forEach((rect) => {\n      const columnId = String(rect.columnId);\n      if (!columnCenters.has(columnId)) {\n        // Calculate center X position of this column\n        const centerX = rect.x + rect.width / 2;\n        columnCenters.set(columnId, centerX);\n      }\n    });\n\n    return columnCenters;\n  }\n\n  _interpolateY(progress, y0, y100) {\n    // 0%  y0 (bottom), 100%  y100 (top)\n    // Clamp progress to [0, 100]\n    const clampedProgress = Math.max(0, Math.min(100, progress));\n    return y0 - (clampedProgress / 100) * (y0 - y100);\n  }\n\n  _drawYAxisLabels() {\n    const tableHeight = this.yAxisCanvas.height;\n    const y0 = tableHeight - 40;\n    const y100 = 40;\n\n    // Clear Y-axis canvas\n    this.yAxisCtx.clearRect(0, 0, this.yAxisCanvas.width, this.yAxisCanvas.height);\n\n    // Draw background for Y-axis (semi-transparent white)\n    this.yAxisCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    this.yAxisCtx.fillRect(0, 0, this.yAxisCanvas.width, this.yAxisCanvas.height);\n\n    // Draw border line\n    this.yAxisCtx.strokeStyle = '#dee2e6';\n    this.yAxisCtx.lineWidth = 1;\n    this.yAxisCtx.beginPath();\n    this.yAxisCtx.moveTo(0, 0);\n    this.yAxisCtx.lineTo(0, this.yAxisCanvas.height);\n    this.yAxisCtx.stroke();\n\n    // Draw percentage labels (0%, 20%, 40%, 60%, 80%, 100%)\n    this.yAxisCtx.fillStyle = '#495057';\n    this.yAxisCtx.font = '11px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    this.yAxisCtx.textAlign = 'left';\n    this.yAxisCtx.textBaseline = 'middle';\n\n    const percentages = [0, 20, 40, 60, 80, 100];\n    percentages.forEach((pct) => {\n      const y = this._interpolateY(pct, y0, y100);\n\n      // Draw tick mark\n      this.yAxisCtx.strokeStyle = '#dee2e6';\n      this.yAxisCtx.beginPath();\n      this.yAxisCtx.moveTo(0, y);\n      this.yAxisCtx.lineTo(6, y);\n      this.yAxisCtx.stroke();\n\n      // Draw label text\n      this.yAxisCtx.fillText(`${pct}%`, 10, y);\n    });\n  }\n\n  _showLegend() {\n    if (this.legendElement) {\n      this.legendElement.style.display = 'block';\n      return;\n    }\n\n    // Create legend element\n    this.legendElement = document.createElement('div');\n    this.legendElement.className = 'kurva-s-legend';\n    this.legendElement.style.cssText = `\n      position: absolute;\n      top: 10px;\n      left: 10px;\n      background: rgba(255, 255, 255, 0.95);\n      border: 1px solid #dee2e6;\n      border-radius: 6px;\n      padding: 8px 12px;\n      font-size: 12px;\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      z-index: 12;\n      pointer-events: none;\n    `;\n\n    const plannedColor = this._getPlannedColor();\n    const actualColor = this._getActualColor();\n\n    this.legendElement.innerHTML = `\n      <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 4px;\">\n        <div style=\"width: 20px; height: 3px; background: ${plannedColor}; border-radius: 2px;\"></div>\n        <span style=\"color: #495057;\">Planned</span>\n      </div>\n      <div style=\"display: flex; align-items: center; gap: 8px;\">\n        <div style=\"width: 20px; height: 3px; background: ${actualColor}; border-radius: 2px;\"></div>\n        <span style=\"color: #495057;\">Actual</span>\n      </div>\n    `;\n\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (scrollArea) {\n      scrollArea.appendChild(this.legendElement);\n    }\n  }\n\n  _hideLegend() {\n    if (this.legendElement) {\n      this.legendElement.style.display = 'none';\n    }\n  }\n\n  _getPlannedColor() {\n    // ALWAYS use cyan/info color for planned curve\n    // This matches the toolbar btn-outline-info color\n    return '#0dcaf0';\n  }\n\n  _getActualColor() {\n    // ALWAYS use yellow/warning color for actual curve\n    // This matches the toolbar btn-outline-warning color\n    return '#ffc107';\n  }\n\n  _getCssVar(name) {\n    try {\n      const root = document.documentElement;\n      const value = getComputedStyle(root).getPropertyValue(name);\n      return value && value.trim().length ? value.trim() : null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _getBtnColor(selector) {\n    try {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      const style = getComputedStyle(el);\n      return style.getPropertyValue('background-color')?.trim() ||\n        style.getPropertyValue('border-color')?.trim() ||\n        style.getPropertyValue('color')?.trim() ||\n        null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _bindPointerEvents() {\n    // Add hover tooltip for curve points if needed\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible) return;\n      // TODO: Implement tooltip for curve points if needed\n    });\n  }\n\n  _log(event, payload) {\n    if (!this.debug) return;\n    console.log(`[KurvaSOverlay] ${event}`, payload || {});\n  }\n}\n","import { TanStackGridManager } from '../grid/tanstack-grid-manager.js';\nimport { GanttCanvasOverlay } from '../gantt/GanttCanvasOverlay.js';\nimport { KurvaSCanvasOverlay } from '../kurva-s/KurvaSCanvasOverlay.js';\n\nexport class UnifiedTableManager {\n  constructor(state, options = {}) {\n    this.state = state || {};\n    this.options = options;\n    this.currentMode = 'grid';\n    this.debug = Boolean(this.state?.debugUnifiedTable || this.options?.debugUnifiedTable);\n    this.tanstackGrid = null;\n    this.overlays = {\n      gantt: null,\n      kurva: null, // placeholder for future integration\n    };\n  }\n\n  mount(container, domTargets = {}) {\n    this.tanstackGrid = new TanStackGridManager(this.state, this.options);\n    this.tanstackGrid.mount(container, domTargets);\n    this.tanstackGrid.setCellRenderer('input');\n    this._log('mount', { containerMounted: Boolean(container), debug: this.debug });\n  }\n\n  updateData(payload) {\n    if (this.tanstackGrid) {\n      this._log('updateData', {\n        rows: payload?.tree?.length || this.tanstackGrid.currentRows?.length || 0,\n        cols: payload?.timeColumns?.length || this.tanstackGrid.currentColumns?.length || 0,\n        deps: payload?.dependencies?.length || 0,\n      });\n      this.tanstackGrid.updateData(payload);\n      this._refreshGanttOverlay(payload);\n      this._refreshKurvaSOverlay(payload);\n    }\n  }\n\n  switchMode(newMode) {\n    if (!newMode || newMode === this.currentMode || !this.tanstackGrid) {\n      return;\n    }\n    const oldMode = this.currentMode;\n    const rendererMap = {\n      grid: 'input',\n      gantt: 'gantt',\n      kurva: 'readonly',\n    };\n    const targetRenderer = rendererMap[newMode] || 'input';\n\n    // hide existing overlays\n    if (this.currentMode === 'gantt' && this.overlays.gantt) {\n      this.overlays.gantt.hide();\n    }\n    if (this.currentMode === 'kurva' && this.overlays.kurva) {\n      this.overlays.kurva.hide?.();\n    }\n\n    this.currentMode = newMode;\n    this._log('switchMode', {\n      from: oldMode,\n      to: newMode,\n      renderer: targetRenderer,\n      rows: this.tanstackGrid.currentRows?.length || 0,\n      cols: this.tanstackGrid.currentColumns?.length || 0,\n    });\n    this.tanstackGrid.setCellRenderer(targetRenderer);\n\n    if (newMode === 'gantt') {\n      if (!this.overlays.gantt) {\n        this.overlays.gantt = new GanttCanvasOverlay(this.tanstackGrid);\n      }\n      this.overlays.gantt.show();\n      this._refreshGanttOverlay();\n    }\n\n    if (newMode === 'kurva') {\n      if (!this.overlays.kurva) {\n        this.overlays.kurva = new KurvaSCanvasOverlay(this.tanstackGrid);\n      }\n      this.overlays.kurva.show();\n      this._refreshKurvaSOverlay();\n    }\n  }\n\n  _refreshGanttOverlay(payload = {}) {\n    if (!this.overlays.gantt || !this.tanstackGrid) {\n      return;\n    }\n    const barData = this._buildBarData(payload);\n    const dependencyData = payload.dependencies || [];\n    this._log('refreshGanttOverlay', {\n      bars: barData.length,\n      deps: dependencyData.length,\n    });\n    this.overlays.gantt.renderBars(barData);\n    this.overlays.gantt.renderDependencies(dependencyData);\n  }\n\n  _buildBarData(payload = {}) {\n    let tree = Array.isArray(payload.tree) ? payload.tree : [];\n    let columns = Array.isArray(payload.timeColumns) ? payload.timeColumns : [];\n    const gridRows = this.tanstackGrid?.currentRows || [];\n    const gridColumns = this.tanstackGrid?.currentColumns || [];\n    const flatRows = Array.isArray(this.state?.flatPekerjaan) ? this.state.flatPekerjaan : [];\n\n    if ((!tree.length || tree.length <= 1) && gridRows.length > tree.length) {\n      tree = gridRows;\n    }\n    if ((!tree.length || tree.length <= 1) && flatRows.length) {\n      tree = flatRows.map((row) => ({\n        pekerjaanId: row.id || row.pekerjaan_id,\n        name: row.nama || row.name,\n        raw: row,\n        subRows: [],\n      }));\n    }\n\n    const hasTimeMeta = columns.some((c) => c?.meta?.timeColumn);\n    if ((!columns.length || !hasTimeMeta) && gridColumns.length) {\n      columns = gridColumns;\n    }\n    if (!columns.length && Array.isArray(this.state?.timeColumns)) {\n      columns = this.state.timeColumns.map((col) => ({\n        id: col.id,\n        fieldId: col.fieldId,\n        meta: { timeColumn: true, columnMeta: col },\n      }));\n    }\n\n    const barData = [];\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n    const mergedPlanned = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('planned')\n      : this._mergeModeState(stateManager?.states?.planned);\n    const mergedActual = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('actual')\n      : this._mergeModeState(stateManager?.states?.actual);\n    const activeMode = (this.state?.progressMode || stateManager?.currentMode || 'planned').toLowerCase();\n\n    console.log('[UnifiedTable]  BuildBarData DEBUG:', {\n      rows: tree.length,\n      cols: columns.length,\n      plannedSize: mergedPlanned?.size || 0,\n      actualSize: mergedActual?.size || 0,\n      activeMode,\n      samplePlannedKeys: mergedPlanned ? Array.from(mergedPlanned.keys()).slice(0, 5) : [],\n      sampleActualKeys: mergedActual ? Array.from(mergedActual.keys()).slice(0, 5) : [],\n      samplePlannedValues: mergedPlanned ? Array.from(mergedPlanned.entries()).slice(0, 3) : [],\n      sampleActualValues: mergedActual ? Array.from(mergedActual.entries()).slice(0, 3) : [],\n    });\n\n    this._log('buildBarData:start', {\n      rows: tree.length,\n      cols: columns.length,\n      plannedSize: mergedPlanned?.size || 0,\n      actualSize: mergedActual?.size || 0,\n      activeMode,\n      timeColumnsWithMeta: columns.filter((c) => c.meta?.timeColumn).length,\n      sampleColumns: columns.slice(0, 5).map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id),\n      sampleRows: tree.slice(0, 3).map((r) => r.pekerjaanId || r.id || r.raw?.pekerjaan_id),\n    });\n\n    const rowsForBars = this._flattenRows(tree);\n    const rowIndex = new Map();\n    rowsForBars.forEach((row) => {\n      const pekerjaanId = row.pekerjaanId || row.id || row.raw?.pekerjaan_id;\n      if (!pekerjaanId) return;\n      rowIndex.set(String(pekerjaanId), {\n        label: row.name || row.raw?.nama || pekerjaanId,\n      });\n    });\n\n    const columnIndex = new Map();\n    columns.forEach((col) => {\n      const meta = this._resolveColumnMeta(col);\n      if (!meta?.timeColumn) return;\n      const columnId = col.fieldId || col.id || meta.fieldId || meta.id || meta.columnId || meta.column_id;\n      if (!columnId) return;\n      columnIndex.set(String(columnId), meta);\n    });\n\n    const allKeys = new Set([\n      ...Array.from(mergedPlanned?.keys?.() || []),\n      ...Array.from(mergedActual?.keys?.() || []),\n    ]);\n\n    allKeys.forEach((cellKey) => {\n      const [pkjIdRaw, colIdRaw] = String(cellKey).split('-');\n      const pekerjaanId = String(pkjIdRaw || '').trim();\n      const columnId = String(colIdRaw || '').trim();\n      if (!pekerjaanId || !columnId) {\n        return;\n      }\n      const rowInfo = rowIndex.get(pekerjaanId);\n      const colMeta = columnIndex.get(columnId);\n      if (!rowInfo || !colMeta) {\n        return;\n      }\n      const plannedValue = this._resolveValue(mergedPlanned, cellKey, 0);\n      const actualValue = this._resolveValue(mergedActual, cellKey, plannedValue);\n      if (!Number.isFinite(plannedValue) && !Number.isFinite(actualValue)) {\n        return;\n      }\n      const variance = (Number(actualValue) || 0) - (Number(plannedValue) || 0);\n      barData.push({\n        pekerjaanId,\n        columnId,\n        value: Number(actualValue) || 0,\n        planned: Number(plannedValue) || 0,\n        actual: Number(actualValue) || 0,\n        variance,\n        label: rowInfo.label,\n        color: '#4dabf7',\n      });\n    });\n\n    if (barData.length === 0 && (mergedPlanned?.size > 0 || mergedActual?.size > 0)) {\n      console.warn('[UnifiedTable]  NO BAR DATA despite having cell values! Check:', {\n        'mergedPlanned.size': mergedPlanned?.size || 0,\n        'mergedActual.size': mergedActual?.size || 0,\n        'tree.length': tree.length,\n        'columns.length': columns.length,\n        'timeColumnsWithMeta': columns.filter((c) => c.meta?.timeColumn).length\n      });\n      this._log('buildBarData:debug', {\n        plannedKeys: mergedPlanned ? Array.from(mergedPlanned.keys()).slice(0, 5) : [],\n        actualKeys: mergedActual ? Array.from(mergedActual.keys()).slice(0, 5) : [],\n        columnIds: columns.map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id || c.meta?.columnId || c.meta?.column_id || c.id).slice(0, 5),\n      });\n    }\n\n    this._log('buildBarData:done', { bars: barData.length });\n    return barData;\n  }\n\n  _flattenRows(nodes = []) {\n    const result = [];\n    const stack = Array.isArray(nodes) ? [...nodes] : [];\n    while (stack.length) {\n      const node = stack.shift();\n      if (!node) continue;\n      result.push(node);\n      if (Array.isArray(node.subRows) && node.subRows.length) {\n        stack.push(...node.subRows);\n      } else if (Array.isArray(node.children) && node.children.length) {\n        stack.push(...node.children);\n      } else if (Array.isArray(node.sub) && node.sub.length) {\n        stack.push(...node.sub);\n      }\n    }\n    return result;\n  }\n\n  _resolveColumnMeta(col) {\n    if (!col) return null;\n    if (col.meta?.columnMeta && col.meta?.timeColumn) {\n      return { ...col.meta.columnMeta, timeColumn: true };\n    }\n    if (col.meta?.timeColumn) {\n      return { ...(col.meta.columnMeta || col.meta), timeColumn: true };\n    }\n    const mode = (col.generationMode || col.type || '').toLowerCase();\n    const isTime = mode === 'weekly' || mode === 'monthly' || Boolean(col.rangeLabel || col.weekNumber);\n    if (isTime) {\n      return { ...col, timeColumn: true, columnMeta: col };\n    }\n    return null;\n  }\n\n  _mergeModeState(modeState) {\n    if (!modeState) {\n      return new Map();\n    }\n    const merged = new Map(modeState.assignmentMap || []);\n    (modeState.modifiedCells || new Map()).forEach((value, key) => {\n      merged.set(key, value);\n    });\n    return merged;\n  }\n\n  _resolveValue(map, key, fallback) {\n    if (map && map.has && map.has(key)) {\n      const val = map.get(key);\n      if (Number.isFinite(val)) {\n        return val;\n      }\n    }\n    return fallback;\n  }\n\n  _refreshKurvaSOverlay(payload = {}) {\n    if (!this.overlays.kurva || !this.tanstackGrid) {\n      return;\n    }\n\n    const curveData = this._buildCurveData(payload);\n    this._log('refreshKurvaSOverlay', {\n      plannedPoints: curveData.planned.length,\n      actualPoints: curveData.actual.length,\n    });\n\n    this.overlays.kurva.renderCurve(curveData);\n  }\n\n  _buildCurveData(payload = {}) {\n    // Get columns and state\n    let columns = Array.isArray(payload.timeColumns) ? payload.timeColumns : [];\n    const gridColumns = this.tanstackGrid?.currentColumns || [];\n\n    if (!columns.length && gridColumns.length) {\n      columns = gridColumns;\n    }\n    if (!columns.length && Array.isArray(this.state?.timeColumns)) {\n      columns = this.state.timeColumns;\n    }\n\n    // Filter to time columns only\n    const timeColumns = columns.filter((col) => {\n      const meta = this._resolveColumnMeta(col);\n      return meta?.timeColumn;\n    });\n\n    if (timeColumns.length === 0) {\n      this._log('buildCurveData:noTimeColumns', { columnsTotal: columns.length });\n      return { planned: [], actual: [] };\n    }\n\n    // Get state data\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n    const mergedPlanned = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('planned')\n      : this._mergeModeState(stateManager?.states?.planned);\n    const mergedActual = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('actual')\n      : this._mergeModeState(stateManager?.states?.actual);\n\n    this._log('buildCurveData:state', {\n      timeColumns: timeColumns.length,\n      plannedCells: mergedPlanned?.size || 0,\n      actualCells: mergedActual?.size || 0,\n    });\n\n    // Calculate cumulative progress per week\n    const plannedCurve = this._calculateCumulativeProgress(timeColumns, mergedPlanned);\n    const actualCurve = this._calculateCumulativeProgress(timeColumns, mergedActual);\n\n    return {\n      planned: plannedCurve,\n      actual: actualCurve,\n    };\n  }\n\n  _calculateCumulativeProgress(timeColumns, cellData) {\n    const curvePoints = [];\n    let cumulativeProgress = 0;\n\n    // Sort columns by week order\n    const sortedColumns = [...timeColumns].sort((a, b) => {\n      const weekA = a.weekNumber || a.week_number || 0;\n      const weekB = b.weekNumber || b.week_number || 0;\n      return weekA - weekB;\n    });\n\n    sortedColumns.forEach((col) => {\n      const columnId = col.fieldId || col.id || col.meta?.fieldId || col.meta?.columnId;\n      if (!columnId) return;\n\n      // Sum all progress values for this week across all pekerjaan\n      let weekProgress = 0;\n      let weekCount = 0;\n\n      if (cellData && cellData.size > 0) {\n        cellData.forEach((value, cellKey) => {\n          const [, colId] = String(cellKey).split('-');\n          if (String(colId).trim() === String(columnId).trim()) {\n            const numValue = Number(value);\n            if (Number.isFinite(numValue)) {\n              weekProgress += numValue;\n              weekCount += 1;\n            }\n          }\n        });\n      }\n\n      // Average progress for this week\n      const avgProgress = weekCount > 0 ? weekProgress / weekCount : 0;\n      cumulativeProgress += avgProgress;\n\n      curvePoints.push({\n        columnId: String(columnId),\n        weekNumber: col.weekNumber || col.week_number,\n        weekProgress: avgProgress,\n        cumulativeProgress: Math.min(100, cumulativeProgress), // Cap at 100%\n      });\n    });\n\n    return curvePoints;\n  }\n\n  _log(event, payload) {\n    const enabled = this.debug || Boolean(window.DEBUG_UNIFIED_TABLE);\n    if (!enabled) return;\n    console.log(`[UnifiedTable] ${event}`, payload);\n  }\n}\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { TanStackGridManager } from '@modules/grid/tanstack-grid-manager.js';\r\nimport { UnifiedTableManager } from '@modules/unified/UnifiedTableManager.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.initialized = false;\r\n    this.gridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.saveHandler = null;\r\n    this.unifiedManager = null;\r\n    this._gridContainerParent = null;\r\n    this._gridContainerNextSibling = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n    this._stateManagerListener = null;\r\n    this._suppressStateManagerEvent = false;\r\n    this._currencyFormatter = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useUPlotKurva: true, // uPlot Kurva-S aktif secara default\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n        useUnifiedTable: config.disableUnifiedTable ? false : true,\r\n        // Default: legacy Gantt V2 tetap aktif; bisa dimatikan dengan config.disableLegacyGantt\r\n        keepLegacyGantt: config.enableLegacyGantt ? true : false,\r\n        dependencies: [],\r\n        debugUnifiedTable: Boolean(config.debugUnifiedTable || window.DEBUG_UNIFIED_TABLE),\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n    this._bindStateManagerEvents();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  _bindStateManagerEvents() {\r\n    if (!this.stateManager || this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this._stateManagerListener = (event) => this._handleStateManagerEvent(event);\r\n    this.stateManager.addEventListener(this._stateManagerListener);\r\n    console.log('[JadwalKegiatanApp] StateManager listener attached');\r\n  }\r\n\r\n  _unbindStateManagerEvents() {\r\n    if (!this.stateManager || !this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this.stateManager.removeEventListener(this._stateManagerListener);\r\n    this._stateManagerListener = null;\r\n    console.log('[JadwalKegiatanApp] StateManager listener removed');\r\n  }\r\n\r\n  _handleStateManagerEvent(event = {}) {\r\n    if (!event || typeof event !== 'object') {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'mode-switch':\r\n        if (this._suppressStateManagerEvent) {\r\n          return;\r\n        }\r\n        this._applyProgressModeSwitch(event.newMode, { showToast: false });\r\n        break;\r\n      case 'commit':\r\n        this._handleStateCommitEvent(event);\r\n        break;\r\n      case 'reset':\r\n        this._handleStateResetEvent();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _handleStateCommitEvent(event = {}) {\r\n    if (this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n    this._updateStatusBar();\r\n    this._updateCharts();\r\n    const modeLabel = (event.mode || this.state.progressMode || 'planned') === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    console.log(`[StateManager] Commit event processed for mode: ${modeLabel}`);\r\n  }\r\n\r\n  _handleStateResetEvent() {\r\n    console.log('[StateManager] Reset event received, syncing UI components');\r\n    this.state.progressMode = this.stateManager?.currentMode || 'planned';\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._updateStatusBar('Ready');\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        tanstackGridContainer: document.getElementById('tanstack-grid-container'),\r\n        tanstackGridBody: document.getElementById('tanstack-grid-body'),\r\n        tanstackGridTopScroll: document.getElementById('tanstack-grid-scroll-top'),\r\n        tanstackGridTopScrollInner: document.getElementById('tanstack-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (!domRefs.tanstackGridContainer) {\r\n      throw new Error('TanStack grid container #tanstack-grid-container tidak ditemukan');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    if (typeof dataset.enableUplotKurva !== 'undefined') {\r\n      this.state.useUPlotKurva = dataset.enableUplotKurva !== 'false';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    this._initTanStackGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    if (this.kurvaSChart?.options?.enableCostView === false) {\r\n      toggleBtn.classList.add('d-none');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    document.querySelectorAll('input[name=\"progressMode\"]').forEach((radio) => {\r\n      const isChecked = radio.value === progressMode;\r\n      if (radio.checked !== isChecked) {\r\n        radio.checked = isChecked;\r\n      }\r\n      const label = radio.nextElementSibling;\r\n      if (label && label.matches('.btn')) {\r\n        label.setAttribute('aria-selected', String(isChecked));\r\n      }\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this._suppressStateManagerEvent = true;\r\n    this.stateManager.switchMode(normalized);\r\n    this._suppressStateManagerEvent = false;\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    this._applyProgressModeSwitch(normalized, { showToast: true });\r\n  }\r\n\r\n  _applyProgressModeSwitch(nextMode, options = {}) {\r\n    const normalized = nextMode === 'actual' ? 'actual' : 'planned';\r\n    const previousInputMode = this.state.inputMode || 'percentage';\r\n    this.state.progressMode = normalized;\r\n\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n    }\r\n\r\n    if (this.gridManager && typeof this.gridManager.setInputMode === 'function') {\r\n      const currentMode = this.state.inputMode || 'percentage';\r\n      if (currentMode !== previousInputMode) {\r\n        this.gridManager.setInputMode(currentMode);\r\n      }\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._updateCostToggleAvailability();\r\n    this._updateProgressModeIndicator(normalized);\r\n    this._syncGridViews();\r\n    this._updateCharts();\r\n\r\n    if (options.showToast) {\r\n      const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n      this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n    }\r\n  }\r\n\r\n  _updateProgressModeIndicator(mode) {\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (!indicator) {\r\n      return;\r\n    }\r\n    const normalized = mode === 'actual' ? 'actual' : 'planned';\r\n    const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n    const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n    indicator.textContent = `Mode: ${label}`;\r\n    indicator.className = `badge ${bgClass} ms-2`;\r\n    indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize TanStack Table grid when enabled\r\n   */\r\n  _initTanStackGridIfNeeded() {\r\n    const container = this.state.domRefs.tanstackGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] TanStack grid container not available');\r\n      return;\r\n    }\r\n\r\n    if (!this._gridContainerParent) {\r\n      this._gridContainerParent = container.parentNode || null;\r\n      this._gridContainerNextSibling = container.nextSibling || null;\r\n    }\r\n\r\n    container.classList.remove('d-none');\r\n\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this.unifiedManager = new UnifiedTableManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n          debugUnifiedTable: this.state.debugUnifiedTable,\r\n        });\r\n        this.unifiedManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    } else {\r\n      if (!this.gridManager) {\r\n        this.gridManager = new TanStackGridManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n        });\r\n        this.gridManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Step 3.6: Ensure dependencies array exists (for unified Gantt overlay)\r\n      this.state.dependencies = this.state.dependencies || [];\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.useUPlotKurva) {\r\n      console.warn('[JadwalKegiatanApp] uPlot dimatikan, melewati inisialisasi chart');\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const kurvaSModule = await import('@modules/kurva-s/uplot-chart.js');\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSUPlotChart || kurvaSModule.default;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n          enableCostView: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    console.log('[JadwalKegiatanApp] Rendering Gantt via unified table overlay');\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this._initializeUnifiedGanttOverlay(ganttContainer);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async _initializeUnifiedGanttOverlay(ganttContainer) {\r\n    if (!this.unifiedManager) {\r\n      this._initTanStackGridIfNeeded();\r\n    }\r\n    if (!this.unifiedManager) {\r\n      console.warn('[JadwalKegiatanApp] Unified manager not available for Gantt overlay');\r\n      return;\r\n    }\r\n\r\n    const host = this._ensureGanttHost(ganttContainer);\r\n    if (!host) {\r\n      console.warn('[JadwalKegiatanApp] Unable to prepare Gantt host for unified overlay');\r\n      return;\r\n    }\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: this._getDisplayTimeColumns(),\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n    if (this.state.debugUnifiedTable) {\r\n      console.log('[UnifiedGanttOverlay] Apply payload', {\r\n        rows: gridPayload.tree.length,\r\n        columns: gridPayload.timeColumns.length,\r\n        deps: gridPayload.dependencies.length,\r\n      });\r\n    }\r\n    this.unifiedManager.updateData(gridPayload);\r\n    this.unifiedManager.switchMode('gantt');\r\n    this._applyGanttOverlayStyles(host);\r\n  }\r\n\r\n  _applyGanttOverlayStyles(host) {\r\n    if (!host) return;\r\n    host.classList.add('gantt-overlay-mode');\r\n    const styleId = 'gantt-overlay-style';\r\n    if (!document.getElementById(styleId)) {\r\n      const style = document.createElement('style');\r\n      style.id = styleId;\r\n      style.textContent = `\r\n        /* Biarkan header/frozen columns tetap tampil untuk konteks */\r\n        .gantt-overlay-mode .tanstack-grid-header { display: block !important; }\r\n        /* Sembunyikan konten text pada sel time-column saja, jangan menggangu pinned kolom */\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { color: transparent; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell * { visibility: hidden; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { pointer-events: none; }\r\n        /* Izinkan scroll tetap berjalan */\r\n        .gantt-overlay-mode .tanstack-grid-body { overflow: auto; }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n  }\r\n\r\n  _ensureGanttHost(ganttContainer) {\r\n    if (!ganttContainer) {\r\n      return null;\r\n    }\r\n    let host = ganttContainer.querySelector('.unified-gantt-host');\r\n    if (!host) {\r\n      host = document.createElement('div');\r\n      host.className = 'unified-gantt-host';\r\n      host.style.position = 'relative';\r\n      host.style.minHeight = '420px';\r\n      host.style.width = '100%';\r\n      ganttContainer.innerHTML = '';\r\n      ganttContainer.appendChild(host);\r\n    } else {\r\n      host.innerHTML = '';\r\n    }\r\n\r\n    this._moveGridContainerTo(host);\r\n    return host;\r\n  }\r\n\r\n  _moveGridContainerTo(target) {\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    if (!container || !target || container.parentNode === target) {\r\n      return;\r\n    }\r\n    target.appendChild(container);\r\n  }\r\n\r\n  _restoreGridContainerPosition() {\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    const parent = this._gridContainerParent;\r\n    if (!container || !parent) {\r\n      return;\r\n    }\r\n    if (container.parentNode === parent) {\r\n      return;\r\n    }\r\n    if (this._gridContainerNextSibling && this._gridContainerNextSibling.parentNode === parent) {\r\n      parent.insertBefore(container, this._gridContainerNextSibling);\r\n    } else {\r\n      parent.appendChild(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n    this._bindUnifiedTabSync();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update Gantt V2 with latest data\r\n    if (this.ganttFrozenGrid && typeof this.ganttFrozenGrid.update === 'function') {\r\n      try {\r\n        this.ganttFrozenGrid.update();\r\n        console.log('[JadwalKegiatanApp]  Gantt V2 chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n    this.state.dependencies = this.state.dependencies || [];\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: displayColumns,\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n\r\n    if (this.state.useUnifiedTable && this.unifiedManager) {\r\n      if (this.state.debugUnifiedTable) {\r\n        console.log('[UnifiedTab] Sync grid payload', {\r\n          rows: gridPayload.tree.length,\r\n          columns: gridPayload.timeColumns.length,\r\n          deps: gridPayload.dependencies.length,\r\n          mode: this.state.progressMode,\r\n          displayScale: this.state.displayScale || this.state.timeScale,\r\n        });\r\n      }\r\n      this.unifiedManager.updateData(gridPayload);\r\n    } else if (this.gridManager) {\r\n      this.gridManager.updateData(gridPayload);\r\n      if (typeof this.gridManager.updateTopScrollMetrics === 'function') {\r\n        this.gridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _renderGrid() {\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this._initTanStackGridIfNeeded();\r\n      }\r\n      if (this.unifiedManager) {\r\n        this._syncGridViews();\r\n        return;\r\n      }\r\n    }\r\n    if (this.gridManager) {\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n    if (typeof this._renderLegacyGrid === 'function') {\r\n      this._renderLegacyGrid();\r\n    }\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.gridManager) {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getRowCostCapacity(pekerjaanId) {\r\n    const hargaMap = this.state?.hargaMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (hargaMap instanceof Map && hargaMap.has(numericId)) {\r\n      return Number(hargaMap.get(numericId)) || 0;\r\n    }\r\n    if (hargaMap && typeof hargaMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(hargaMap, key)) {\r\n        return Number(hargaMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode) {\r\n      const costFields = [\r\n        'budgeted_cost',\r\n        'total_biaya',\r\n        'totalBiaya',\r\n        'total_cost',\r\n        'biaya',\r\n      ];\r\n      for (const field of costFields) {\r\n        if (typeof fallbackNode[field] !== 'undefined') {\r\n          const numeric = Number(fallbackNode[field]);\r\n          if (Number.isFinite(numeric)) {\r\n            return numeric;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getMergedCostCells(modeState) {\r\n    const merged = new Map();\r\n    if (modeState?.costAssignmentMap instanceof Map) {\r\n      modeState.costAssignmentMap.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    if (modeState?.costModifiedCells instanceof Map) {\r\n      modeState.costModifiedCells.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    return merged;\r\n  }\r\n\r\n  _calculateAllCostTotals() {\r\n    const totals = new Map();\r\n    const modeState = this._getCurrentModeState();\r\n    if (!modeState) {\r\n      return totals;\r\n    }\r\n    const merged = this._getMergedCostCells(modeState);\r\n    merged.forEach((value, cellKey) => {\r\n      const pekerjaanId = parseInt((cellKey || '').split('-')[0], 10);\r\n      if (!Number.isFinite(pekerjaanId)) {\r\n        return;\r\n      }\r\n      totals.set(pekerjaanId, (totals.get(pekerjaanId) || 0) + Number(value));\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  _formatCurrency(value) {\r\n    const numeric = Number(value) || 0;\r\n    if (!this._currencyFormatter && typeof Intl !== 'undefined') {\r\n      this._currencyFormatter = new Intl.NumberFormat('id-ID', {\r\n        style: 'currency',\r\n        currency: 'IDR',\r\n        maximumFractionDigits: 0,\r\n      });\r\n    }\r\n    if (this._currencyFormatter) {\r\n      return this._currencyFormatter.format(numeric);\r\n    }\r\n    return `Rp ${numeric.toLocaleString('id-ID')}`;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    const costViolations = [];\r\n    const normalizedMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    if (normalizedMode === 'actual') {\r\n      const costTotals = this._calculateAllCostTotals();\r\n      costTotals.forEach((totalCost, pekerjaanId) => {\r\n        if (!Number.isFinite(totalCost)) {\r\n          return;\r\n        }\r\n        const capacity = this._getRowCostCapacity(pekerjaanId);\r\n        const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 1) : 1;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (totalCost > capacity + tolerance) {\r\n            costViolations.push({\r\n              type: 'cost',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalCost,\r\n              capacity,\r\n            });\r\n          }\r\n        } else if (totalCost > tolerance) {\r\n          costViolations.push({\r\n            type: 'cost',\r\n            pekerjaan_id: pekerjaanId,\r\n            total: totalCost,\r\n            capacity: 0,\r\n            missingCapacity: true,\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0 && costViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations, costViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      if (item.type === 'cost') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: biaya aktual tidak dapat disimpan karena master biaya 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total biaya ${this._formatCurrency(item.total)} > batas ${this._formatCurrency(item.capacity)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n    return this._buildMonthlyColumns(sourceColumns);\r\n  }\r\n\r\n  _buildMonthlyColumns(sourceColumns) {\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n      const startDate = this._coerceDate(blockColumns[0]?.startDate || blockColumns[0]?.start_date);\r\n      const endDate = this._coerceDate(blockColumns[blockColumns.length - 1]?.endDate || blockColumns[blockColumns.length - 1]?.end_date);\r\n      const rangeText = this._formatShortRange(startDate, endDate);\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel: rangeText || rangeLabel,\r\n        rangeText,\r\n        startDate,\r\n        endDate,\r\n        tooltip: startLabel && endLabel ? `${startLabel} \\u2014 ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n        readOnly: true,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _coerceDate(value) {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Number.isNaN(value.getTime()) ? null : value;\r\n    }\r\n    const parsed = new Date(value);\r\n    return Number.isNaN(parsed.getTime()) ? null : parsed;\r\n  }\r\n\r\n  _formatShortRange(startDate, endDate) {\r\n    const format = (date) => {\r\n      if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\r\n        return '';\r\n      }\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      return `${day}/${month}`;\r\n    };\r\n    const start = format(startDate);\r\n    const end = format(endDate);\r\n    if (start && end) {\r\n      return `${start} - ${end}`;\r\n    }\r\n    return start || end || '';\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  _bindUnifiedTabSync() {\r\n    if (!this.state.useUnifiedTable) {\r\n      return;\r\n    }\r\n    const scurveTab =\r\n      document.querySelector('#scurve-tab') ||\r\n      document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n    const ganttTab =\r\n      document.querySelector('#gantt-tab') ||\r\n      document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n    const gridTab =\r\n      document.querySelector('#grid-tab') ||\r\n      document.querySelector('[data-bs-target=\"#grid-view\"]');\r\n\r\n    if (scurveTab) {\r\n      const handler = () => {\r\n        this._restoreGridContainerPosition();\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> kurva');\r\n          }\r\n        }\r\n      };\r\n      scurveTab.addEventListener('shown.bs.tab', handler);\r\n      scurveTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (ganttTab) {\r\n      const handler = () => {\r\n        const ganttContainer = document.getElementById('gantt-redesign-container');\r\n        if (ganttContainer) {\r\n          this._initializeUnifiedGanttOverlay(ganttContainer);\r\n        } else if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('gantt');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> gantt (no overlay host)');\r\n          }\r\n        }\r\n      };\r\n      ganttTab.addEventListener('shown.bs.tab', handler);\r\n      ganttTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (gridTab) {\r\n      const handler = () => {\r\n        this._restoreGridContainerPosition();\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('grid');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> grid');\r\n          }\r\n        }\r\n      };\r\n      gridTab.addEventListener('shown.bs.tab', handler);\r\n      gridTab.addEventListener('click', handler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    this._unbindStateManagerEvents();\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.destroy();\r\n      this.gridManager = null;\r\n    }\r\n    this.unifiedManager = null;\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n\r\n"],"file":"assets/js/jadwal-kegiatan-B5tOsYbZ.js"}