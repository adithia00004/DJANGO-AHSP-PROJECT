/* =========================================================
   List Pekerjaan — CSS (Final Drop-in)
   - Sidebar overlay (show/hidden) sinkron dengan JS
   - Sticky thead pakai --lp-topbar-h
   - Select2 stabil (clamp 2 baris)
   - Preview Uraian 2-baris + edit state
   ========================================================= */

/* ============================== */
/* ====== VARIABLES & SCALES ==== */
/* ============================== */
:root{
  /* scale */
  --fib-0:.618rem; --fib-1:1rem; --fib-2:1.618rem; --fib-3:2.618rem;

  /* layout */
  --lp-topbar-h:64px;
  --lp-overlay-z:12030;
  --lp-sidebar-w:486px;

  /* z-index anchors */
  --lp-topbar-z:12000;
  --lp-thead-z:calc(var(--lp-topbar-z) - 2);
  --lp-ac-z:1042;

  /* clamp defaults */
  --lp-clamp-font:.75rem;
  --lp-clamp-line:1.05rem;
  --lp-clamp-pad-v:4px;

  /* toolbar */
  --lp-toolbar-fs:.75rem;
  --lp-toolbar-py:.375rem;

  /* uraian */
  --lp-urai-line:1.25rem;
  --lp-urai-pad-v:6px;
}

/* === Bridge tokens ke core (sinkronisasi pasif, aman) === */
:root {
  --dp-topbar-h: var(--lp-topbar-h);
}

/* Scoped defaults khusus halaman */
.list-pekerjaan{
  --lp-header-z:1030;
  --lp-panel-z:1032;

  /* lebar kolom (mudah di-tuning) */
  --col-num-w:55px;
  --col-mode-w:144px;
  --col-ref-w:377px;
  --col-urai-w:377px;
  --col-sat-w:89px;
  --col-act-w:89px;
}

/* ============================== */
/* ========= LEGACY WIDTHS ====== */
/* ============================== */
.table.list-pekerjaan .col-num{ width:48px; text-align:center; }
.table.list-pekerjaan .col-mode{ width:110px; }
.table.list-pekerjaan .col-ref{ width:420px; }
.table.list-pekerjaan .col-urai{ width:420px; }
.table.list-pekerjaan .col-sat{ width:110px; }
.table.list-pekerjaan .col-act{ width:56px; text-align:center; }

/* Legacy compact */
#lp-app.compact .card-header{ padding:.3rem .5rem; }
#lp-app.compact .card-body{ padding:.5rem; }
#lp-app.compact .table{ font-size:.9rem; }
#lp-app.compact .table td,
#lp-app.compact .table th{ padding:.25rem .4rem; }
#lp-app.compact .form-control.form-control-sm,
#lp-app.compact .form-select.form-select-sm{ padding:.15rem .35rem; height:calc(1.5em + .4rem); }

/* ============================== */
/* ============ TABLE =========== */
/* ============================== */
.table.lp-table{ width:100%; border-collapse:separate; border-spacing:0; }
.table.lp-table thead th{
  position:sticky; top:var(--lp-topbar-h); z-index:var(--lp-thead-z) !important;
  background:#f7f8fa; border-bottom:1px solid #e5e7eb;
  font-size:12px; font-weight:500; text-transform:uppercase; letter-spacing:.03em;
  padding:8px 10px;
}
.table.lp-table tbody td{ padding:10px; vertical-align:middle; border-bottom:1px solid #e5e7eb; }

/* kolom modern via variabel */
.col-num{ width:var(--col-num-w); text-align:center; }
.col-mode{ width:var(--col-mode-w); }
.col-ref{ width:var(--col-ref-w); }
.col-urai{ width:var(--col-urai-w); }
.col-sat{ width:var(--col-sat-w); }
.col-act{ width:var(--col-act-w); text-align:center; }

/* paksa override untuk tabel modern */
.table.list-pekerjaan.lp-table .col-ref{ width:var(--col-ref-w) !important; }
.table.list-pekerjaan.lp-table .col-urai{ width:var(--col-urai-w) !important; }
.table.list-pekerjaan.lp-table .col-mode{ width:var(--col-mode-w) !important; }
.table.list-pekerjaan.lp-table .col-sat{ width:var(--col-sat-w) !important; }
.table.list-pekerjaan.lp-table .col-act{ width:var(--col-act-w) !important; }

/* Responsive tuning */
@media (max-width:1399.98px){ .list-pekerjaan{ --col-ref-w:533px; --col-urai-w:377px; } }
@media (max-width:1199.98px){ .list-pekerjaan{ --col-ref-w:377px; --col-urai-w:377px; } }
@media (max-width:991.98px){ .list-pekerjaan{ --col-ref-w:377px; --col-urai-w:233px; } }
@media (max-width:767.98px){
  .list-pekerjaan{ --col-mode-w:144px; --col-ref-w:233px; --col-urai-w:233px; --col-sat-w:72px; --col-act-w:72px; }
}

/* ============================== */
/* ============ MISC ============ */
/* ============================== */
.lp-row{ display:table-row; }
.lp-row:hover{ background:#fcfdff; }
.source-badge{ display:inline-block; padding:.25rem .5rem; font-size:.75rem; border-radius:.35rem; }

#btn-save-fab{
  position:fixed; right:18px; bottom:18px; z-index:1030;
  border-radius:999px; box-shadow:0 6px 16px rgba(0,0,0,.2);
  padding:.7rem 1.1rem;
}

/* ============================== */
/* =========== SELECT2 ========== */
/* ============================== */
.select2-host{ position:relative; min-width:260px; }
.ref-select.is-enhanced,
.native-select.is-enhanced{ position:absolute !important; left:-9999px !important; }

.list-pekerjaan .select2-container{ width:100% !important; z-index:var(--lp-ac-z); }
.list-pekerjaan .select2-container .select2-selection--single{
  min-height:34px; border-radius:.375rem; display:flex; align-items:center; padding:4px 8px;
}
.list-pekerjaan .select2-container .select2-selection__rendered{
  white-space:normal !important; word-break:break-word; overflow-wrap:anywhere;
  line-height:1.25rem; font-size:.875rem; padding-right:2rem;
}

/* Dropdown results */
.list-pekerjaan .s2-dropdown-wrap .select2-results__option,
.list-pekerjaan .select2-container .select2-results__option{
  white-space:normal; word-break:break-word; line-height:1.25rem; font-size:.875rem; padding:6px 8px;
}

/* ============================== */
/* ===== REF COLUMN (CLAMP) ===== */
/* ============================== */
.table.lp-table{ --lp-clamp-font:.75rem; --lp-clamp-line:1.05rem; --lp-clamp-pad-v:4px; }

.list-pekerjaan td.col-ref,
.list-pekerjaan td.col-ref > div,
.list-pekerjaan td.col-ref .select2-host,
.list-pekerjaan td.col-ref .select2-container{ min-width:0 !important; max-width:100% !important; width:100% !important; }

/* tinggi selection = 2 baris clamp */
.list-pekerjaan td.col-ref .select2-container .select2-selection--single{
  height:calc((var(--lp-clamp-line) * 2) + (var(--lp-clamp-pad-v) * 2)) !important;
  min-height:calc((var(--lp-clamp-line) * 2) + (var(--lp-clamp-pad-v) * 2)) !important;
  align-items:flex-start !important; padding-top:var(--lp-clamp-pad-v) !important; padding-bottom:var(--lp-clamp-pad-v) !important;
  border-radius:.6rem !important;
}

/* isi selection (clamp 2 baris) */
.list-pekerjaan td.col-ref .select2-container .select2-selection__rendered,
.list-pekerjaan td.col-ref .s2-selection-wrap{
  display:-webkit-box !important; -webkit-box-orient:vertical !important; -webkit-line-clamp:2 !important; line-clamp:2 !important; overflow:hidden !important;
  white-space:normal !important; word-break:break-word !important; overflow-wrap:anywhere !important;
  font-size:var(--lp-clamp-font) !important; line-height:var(--lp-clamp-line) !important;
  max-height:calc(var(--lp-clamp-line) * 2) !important; padding-right:2rem !important;
}

/* z-index konsisten saat dropdown terbuka */
.list-pekerjaan td.col-ref,
.list-pekerjaan td.col-ref .select2-host{ overflow:visible !important; }
.list-pekerjaan .select2-host{ position:relative; z-index:auto; }
.list-pekerjaan .select2-host.s2-open{ z-index:var(--lp-ac-z) !important; }
.list-pekerjaan .select2-host.s2-open .select2-dropdown{ z-index:calc(var(--lp-ac-z) + 1) !important; }
.list-pekerjaan .select2-container--open{ z-index:var(--lp-ac-z) !important; }

/* ============================== */
/* ========= OVERLAY NAV ======== */
/* ============================== */
body.lp-overlay-open{ overflow:hidden; }
#lp-sidebar{
  position:fixed; inset:0; display:none;
  z-index:var(--lp-overlay-z);
  background:rgba(0,0,0,.22);
  -webkit-backdrop-filter:blur(2px); backdrop-filter:blur(2px);
}
#lp-sidebar.is-open{ display:block; }
#lp-sidebar.is-open .lp-sidebar-inner{ transform: translateX(0); opacity: 1; }
#lp-sidebar.show{ display:block; }
@supports not ((backdrop-filter:blur(2px)) or (-webkit-backdrop-filter:blur(2px))){
  #lp-sidebar{ background:rgba(0,0,0,.35); }
}
#lp-sidebar .lp-sidebar-inner{
  position:absolute; right:10px; left:auto; top:var(--lp-topbar-h);
  width:min(92vw, var(--lp-sidebar-w));
  height:calc(100vh - var(--lp-topbar-h) - 16px);
  display:flex; flex-direction:column; overflow:auto;
  background:rgba(22,24,28,.96); color:#e9ecef;
  border:1px solid rgba(255,255,255,.08); border-radius:.5rem; box-shadow:0 12px 28px rgba(0,0,0,.35);
  padding:.75rem;
  transform:translateX(16px); opacity:0;
  transition:transform .22s ease, opacity .22s ease; z-index:1;
}
#lp-sidebar.show .lp-sidebar-inner{ transform:translateX(0); opacity:1; }

#lp-sidebar .lp-resizer{
  position:absolute; left:-6px; top:0; bottom:0; width:8px; cursor:ew-resize;
  background:linear-gradient(to left, rgba(255,255,255,.08), transparent);
  border-top-left-radius:.5rem; border-bottom-left-radius:.5rem;
}

/* Sidebar tree */
#lp-nav .lp-node__header{ display:flex; align-items:center; gap:.5rem; padding:.35rem .5rem; border-radius:.375rem; cursor:pointer; }
#lp-nav .lp-node__header:hover{ background:rgba(255,255,255,.06); }
#lp-nav .lp-node__toggle{ width:1.25rem; height:1.25rem; border-radius:.25rem; border:1px solid rgba(255,255,255,.2); display:inline-flex; align-items:center; justify-content:center; font-size:.8rem; color:#dee2e6; }
#lp-nav .lp-node__label{ color:#f1f3f5; text-decoration:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-size:var(--fib-1); }
#lp-nav .lp-node__label:hover{ text-decoration:underline; }
#lp-nav .lp-node__count{ color:#ced4da; font-size:.85em; }
#lp-nav .lp-node__children{ margin-left:1.25rem; padding-left:.5rem; border-left:1px dashed rgba(255,255,255,.2); }
#lp-nav .lp-node--active > .lp-node__header{ background:rgba(13,110,253,.25); outline:1px solid rgba(13,110,253,.35); }
#lp-nav .lp-hit{ background:rgba(255,236,153,.35); border-radius:.25rem; padding:0 .125rem; }

/* Fokus keyboard */
#lp-nav .lp-node__header:focus-visible,
#lp-nav .lp-node__label:focus-visible{ outline:2px solid #4dabf7; outline-offset:2px; }

/* Sidebar search & autocomplete */
.lp-sidebar-search,.lp-toolbar-search{ position:relative; }
.lp-sidebar-search .input-group .form-control,
.lp-sidebar-search .input-group .input-group-text{ font-size:var(--fib-1); }

.lp-autocomplete{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  z-index:calc(var(--lp-overlay-z) + 1); background:#fff; color:#212529;
  border:1px solid rgba(0,0,0,.08); border-radius:.5rem; box-shadow:0 12px 28px rgba(0,0,0,.18);
  max-height:min(45vh, 21rem); overflow:auto; padding:.25rem;
}
.lp-ac-group{ padding:.35rem .5rem; border-top:1px dashed #e9ecef; }
.lp-ac-group:first-child{ border-top:0; }
.lp-ac-title{ font-size:.75rem; font-weight:600; color:#6c757d; margin-bottom:.25rem; }
.lp-ac-item{ display:flex; align-items:center; gap:.5rem; padding:.4rem .55rem; border-radius:.375rem; cursor:pointer; }
.lp-ac-item:hover, .lp-ac-item.is-active{ background:#f7f8fa; }
.lp-ac-item .lp-ac-text{ flex:1 1 auto; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.lp-ac-item .lp-hit{ background:rgba(255,236,153,.35); border-radius:.25rem; padding:0 .125rem; }

/* ============================== */
/* ============ BUTTONS ========= */
/* ============================== */
.btn-add-sub, .btn-add-pekerjaan, .lp-btn-wide{ white-space:nowrap; padding:.375rem .85rem; }
.btn-add-sub, .btn-add-pekerjaan{ background:#0d6efd; border-color:#0d6efd; color:#fff; }
.btn-add-sub:hover, .btn-add-pekerjaan:hover{ background:#0b5ed7; border-color:#0a58ca; color:#fff; }
.btn-add-sub:focus, .btn-add-pekerjaan:focus{ box-shadow:0 0 0 .2rem rgba(13,110,253,.25); }

#lp-app .btn.btn-add-sub,
#lp-app .btn.btn-add-pekerjaan{
  --bs-btn-bg:#0d6efd; --bs-btn-color:#fff; --bs-btn-border-color:#0d6efd;
  --bs-btn-hover-bg:#0b5ed7; --bs-btn-hover-border-color:#0a58ca;
  --bs-btn-focus-shadow-rgb:13,110,253;
  background-color:var(--bs-btn-bg) !important; border-color:var(--bs-btn-border-color) !important; color:var(--bs-btn-color) !important;
}

/* ============================== */
/* =========== TOPBAR =========== */
/* ============================== */
#dp-topbar{ position:sticky; top:0; z-index:var(--lp-topbar-z) !important; }
.table.lp-table thead th{ top:var(--lp-topbar-h); z-index:var(--lp-thead-z) !important; }

/* ============================== */
/* ========= TOOLBAR AREA ======= */
/* ============================== */
#lp-app .lp-toolbar{ gap:.5rem; }
#lp-app .lp-toolbar > .ms-auto{
  display:flex !important; align-items:center !important; gap:.5rem !important;
  flex:1 1 auto !important; min-width:0 !important;
}
#lp-app .lp-toolbar-search{
  max-width:none !important; width:100% !important;
  flex:1 1 clamp(24rem, 50vw, 48rem) !important; min-width:0 !important;
}
#lp-app .lp-toolbar-search .form-control,
#lp-app .lp-toolbar-search .input-group-text{
  font-size:var(--lp-toolbar-fs) !important; line-height:1.5 !important;
  padding-top:var(--lp-toolbar-py) !important; padding-bottom:var(--lp-toolbar-py) !important;
}
#lp-toolbar-find{
  font-size:var(--lp-toolbar-fs) !important; line-height:1.5 !important;
  padding-top:var(--lp-toolbar-py) !important; padding-bottom:var(--lp-toolbar-py) !important;
  flex:0 0 auto !important; display:inline-flex !important; align-items:center !important; white-space:nowrap !important;
}
@media (min-width:768px){ #lp-app .lp-toolbar{ flex-wrap:nowrap !important; } }

/* ============================== */
/* ============ URAIAN ========== */
/* ============================== */
/* Kontainer cell */
.table.lp-table td.col-urai{ position:relative; }

/* Textarea (mode edit) — auto-resize via JS */
.table.lp-table td.col-urai .form-control.uraian{
  width:100%;
  font-size:var(--lp-clamp-font);
  line-height:var(--lp-clamp-line);
  white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere;
  min-height:calc((var(--lp-clamp-line) * 2) + (var(--lp-urai-pad-v) * 2)) !important;
  padding-top:var(--lp-urai-pad-v) !important;
  padding-bottom:var(--lp-urai-pad-v) !important;
  overflow-y:hidden;  /* auto-resize via JS */
  resize:vertical;
  visibility:visible; /* default terlihat saat editing */
}

/* Preview ringkas 2 baris — default hidden, muncul saat blur */
.lp-urai-preview{
  position:absolute; inset:0; z-index:2;
  padding:var(--lp-urai-pad-v) .75rem;
  font-size:var(--lp-clamp-font);
  line-height:var(--lp-clamp-line);
  color:inherit; background:var(--bs-body-bg, #fff);
  border:1px solid transparent; border-radius:.375rem;
  white-space:normal; word-break:break-word; overflow-wrap:anywhere;
  display:none; overflow:hidden;
  display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; line-clamp:2;
}

/* State: saat TIDAK mengedit -> sembunyikan textarea, tampilkan preview */
td.col-urai:not(.is-editing) .form-control.uraian{ visibility:hidden !important; }
td.col-urai:not(.is-editing) .lp-urai-preview{ display:-webkit-box; }

/* === FIX: caret terlihat saat editing col-urai === */
.table.lp-table td.col-urai .form-control.uraian{
  position: relative; z-index: 1; visibility: visible; caret-color: auto;
}
td.col-urai:not(.is-editing) .form-control.uraian{ visibility: hidden !important; }
td.col-urai:not(.is-editing) .lp-urai-preview{
  display: -webkit-box !important; display: block; z-index: 0; pointer-events: auto;
}
td.col-urai.is-editing .lp-urai-preview{ display: none !important; pointer-events: none; }
td.col-urai.is-editing .form-control.uraian{ visibility: visible !important; z-index: 1 !important; }

/* ============================== */
/* ======= SMALL RESPONSIVE ===== */
/* ============================== */
@media (max-width:420px){ #lp-sidebar .lp-sidebar-inner{ right:.75rem; left:.75rem; width:auto; } }
@media (prefers-reduced-motion:reduce){ #lp-sidebar .lp-sidebar-inner{ transition:none; } }

/* Matikan hover-edge (base_detail) di halaman ini */
.list-pekerjaan .lp-sidebar-hotspot,
.list-pekerjaan #lpSidebar{ display:none !important; }
