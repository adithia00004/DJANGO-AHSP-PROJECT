/* =====================================================================
   LIST_PEKERJAAN.CSS — Feel v1 (legacy) untuk Batch 2
   - Menonjolkan layout "kartu Klasifikasi → Sub berisi tabel lokal"
   - Tabel global #lp-table disembunyikan (fallback tetap ada)
   - Komponen: toolbar, overlay, tree nav, kartu, sub-table, Select2, uraian preview
   ===================================================================== */

/* ============== VAR & RESET TIPIS ============== */
/* Menggunakan variabel dari core.css: --dp-*, --ux-*, --lp-* */

/* ============== TOOLBAR ============== */
.lp-toolbar{
  min-height: var(--lp-toolbar-h);
  background: var(--dp-c-bg);
  border-bottom: 1px solid var(--dp-c-border);
  gap: .5rem;
}
#lp-app .lp-toolbar > .ms-auto{
  display:flex !important; align-items:center !important; gap:.5rem !important;
  flex:1 1 auto !important; min-width:0 !important;
}
#lp-app .lp-toolbar-search{
  max-width:none !important; width:100% !important;
  flex:1 1 clamp(24rem, 50vw, 48rem) !important; min-width:0 !important;
}
#lp-app .lp-toolbar-search .form-control,
#lp-app .lp-toolbar-search .input-group-text,
#lp-toolbar-find{
  font-size: var(--lp-toolbar-fs) !important;
  line-height: 1.5 !important;
  padding-top: var(--lp-toolbar-py) !important;
  padding-bottom: var(--lp-toolbar-py) !important;
}

/* Font default kontrol interaktif (kompak) */
#lp-app .form-control,
#lp-app .form-select,
#lp-app .input-group-text,
#lp-app .btn.lp-btn{ font-size: var(--ux-font-xs); }

/* Tombol aksi cepat */
#btn-add-klas{ white-space: nowrap; }
#lp-app .btn-add-sub,
#lp-app .btn-add-pekerjaan,
#lp-app .btn-del{
  font-size: var(--ux-font-sm);
  line-height: 1.35;
  padding: .375rem .85rem;
  white-space: nowrap;
}
#lp-app .btn-add-sub:not(.btn-primary),
#lp-app .btn-add-pekerjaan:not(.btn-primary){
  background: var(--bs-primary);
  border-color: var(--bs-primary);
  color:#fff;
}

/* ============== OVERLAY / SIDEBAR ============== */
body.lp-overlay-open{ overflow:hidden; }

#lp-sidebar{
  position:fixed; inset:0; display:none;
  z-index: var(--lp-overlay-z);
  background: rgba(0,0,0,.22);
}
#lp-sidebar.is-open,
#lp-sidebar.show{ display:block; }
#lp-sidebar .lp-sidebar-inner{
  position:absolute; right:10px; top:var(--dp-topbar-h); left:auto;
  width: clamp(320px, var(--lp-sidebar-w), 760px);
  height: calc(100vh - var(--dp-topbar-h) - 16px);
  display:flex; flex-direction:column; overflow:auto;
  padding:.75rem;
  transform:translateX(16px); opacity:0;
  background: var(--dp-c-bg); color: var(--dp-c-text);
  border:1px solid var(--dp-c-border); border-radius:.5rem; box-shadow: var(--dp-shadow-lg);
  transition: transform .16s ease, opacity .16s ease; z-index:1;
}
#lp-sidebar.is-open .lp-sidebar-inner,
#lp-sidebar.show    .lp-sidebar-inner{ transform:translateX(0); opacity:1; }

#lp-sidebar .lp-resizer{
  position:absolute; left:-6px; top:0; bottom:0; width:8px; cursor:ew-resize;
  background:linear-gradient(to left, rgba(255,255,255,.08), transparent);
  border-top-left-radius:.5rem; border-bottom-left-radius:.5rem;
}

/* Hotspot kanan (desktop only) */
.lp-overlay-hotspot{
  position: fixed;
  top: var(--lp-topbar-h);
  right: 0; bottom: 0; width: 10px;
  z-index: var(--lp-overlay-z);
  pointer-events: auto; background: transparent;
}
@media (max-width: 991.98px){ .lp-overlay-hotspot{ display:none; } }

/* Sidebar tree & search */
#lp-nav .lp-node__header{
  display:flex; align-items:center; gap:.5rem; padding:.35rem .5rem;
  border-radius:.375rem; cursor:pointer;
}
#lp-nav .lp-node__header:hover{ background: var(--dp-c-surface-2); }
#lp-nav .lp-node__toggle{
  width:1.25rem; height:1.25rem; border-radius:.25rem;
  border:1px solid var(--dp-c-border); display:inline-flex; align-items:center; justify-content:center;
  font-size:.8rem; color:var(--dp-c-muted);
}
#lp-nav .lp-node__label{
  color: var(--dp-c-text); text-decoration:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  font-size: var(--ux-font-md);
}
#lp-nav .lp-node__label:hover{ text-decoration:underline; }
#lp-nav .lp-node__count{ color:var(--dp-c-muted); font-size:.75em; }
#lp-nav .lp-node__children{ border-left:1px dashed var(--dp-c-border); }
#lp-nav .lp-node--active > .lp-node__header{
  background: var(--dp-c-primary-subtle);
  outline:1px solid color-mix(in srgb, var(--dp-c-primary) 35%, transparent);
}
#lp-nav .lp-hit{ background: var(--ux-hit-bg); }
#lp-nav .lp-node__header:focus-visible,
#lp-nav .lp-node__label:focus-visible{ outline:2px solid #4dabf7; outline-offset:2px; }

.lp-sidebar-search,.lp-toolbar-search{ position:relative; }
.lp-sidebar-search .input-group .form-control,
.lp-sidebar-search .input-group .input-group-text{ font-size: var(--ux-font-md); }
.lp-autocomplete{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  z-index: calc(var(--lp-overlay-z) + 1);
  background: var(--dp-c-bg); color: var(--dp-c-text);
  border:1px solid var(--dp-c-border); border-radius:.5rem; box-shadow: var(--dp-shadow-lg);
  max-height:min(45vh, 21rem); overflow:auto; padding:.25rem;
}
.lp-ac-group{ padding:.35rem .5rem; border-top:1px dashed var(--dp-c-border); }
.lp-ac-title{ font-size:.75rem; font-weight:600; color:var(--dp-c-muted); margin-bottom:.25rem; }
.lp-ac-group:first-child{ border-top:0; }
.lp-ac-item{ display:flex; align-items:center; gap:.5rem; padding:.4rem .55rem; border-radius:.375rem; cursor:pointer; }
.lp-ac-item:hover, .lp-ac-item.is-active{ background: var(--dp-c-surface-2); }
.lp-ac-item .lp-ac-text{
  flex:1 1 auto; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  font-size: var(--ux-font-xs);
}
.lp-ac-item .lp-hit{ background:var(--ux-hit-bg); border-radius:.25rem; padding:0 .125rem; }

/* ============== MAIN AREA (Feel v1) ============== */
/* Sembunyikan tabel global jika masih ada (fallback tetap ada di DOM) */
.lp-main .lp-table-wrap{ display:none !important; }

/* Kartu Klasifikasi */
#klas-list{ margin-bottom: 2rem; }
#klas-list .card{ border:1px solid var(--dp-c-border); border-radius:.6rem; }
#klas-list .card-header{
  background: var(--dp-c-surface-2);
  padding:.5rem .75rem;
  display:flex; gap:.5rem; align-items:center;
}
#klas-list .card-body{ padding:.75rem; }

/* Input nama Klas/Sub */
#klas-list .klas-name,
#klas-list .sub-name{
  font-size: var(--ux-font-sm);
}

/* Block Sub */
#klas-list .sub-wrap > div{
  background: var(--dp-c-surface-1);
}

/* Tabel lokal di dalam Sub (kompak, mirip v1) */
#klas-list table.list-pekerjaan{ width:100%; border-collapse:separate; border-spacing:0; }
#klas-list table.list-pekerjaan thead th{
  background: var(--dp-c-surface-2);
  border-bottom:1px solid var(--dp-c-border);
  font-size: var(--ux-font-xs); font-weight:600; text-transform:uppercase; letter-spacing:.03em;
  padding:5px 5px;
}
#klas-list table.list-pekerjaan tbody td{
  padding:10px; vertical-align:middle; border-bottom:1px solid var(--dp-c-border);
  color: var(--dp-c-text);
}
#klas-list table.list-pekerjaan td.col-act,
#klas-list table.list-pekerjaan th.col-num,
#klas-list table.list-pekerjaan td.col-num{ text-align:center; }

/* Uraian cell (2-lines clamp + inline edit feel lama) */
#klas-list td.col-urai{ position:relative; }
#klas-list td.col-urai .form-control.uraian{
  width:100%;
  font-size: var(--ux-font-xs);
  line-height: var(--lp-urai-line);
  white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere;
  min-height: calc((var(--lp-urai-line) * 1.5) + (var(--lp-urai-pad-v) * 2)) !important;
  padding-top: var(--lp-urai-pad-v) !important; padding-bottom: var(--lp-urai-pad-v) !important;
  overflow-y:hidden; resize:vertical; visibility:visible;
}
#klas-list td.col-urai .lp-urai-preview{
  position:absolute;inset: 5px; ; z-index:2;
  padding: var(--lp-urai-pad-v) .75rem;
  font-size: var(--lp-clamp-font); line-height: var(--lp-clamp-line);
  color: var(--dp-c-text); background: var(--dp-c-bg);
  border:1px solid transparent; border-radius:.375rem;
  white-space:normal; word-break:break-word; overflow-wrap:anywhere;
  display:none; overflow:hidden;
  display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; line-clamp:2;
}
#klas-list td.col-urai:not(.is-editing) .form-control.uraian{ visibility: hidden !important; }
#klas-list td.col-urai:not(.is-editing) .lp-urai-preview{ display: -webkit-box !important; display:block; z-index: 0; pointer-events:auto; }
#klas-list td.col-urai.is-editing .lp-urai-preview{ display: none !important; pointer-events: none; }
#klas-list td.col-urai.is-editing .form-control.uraian{ visibility: visible !important; z-index: 1 !important; }
#klas-list td.col-urai .form-control.uraian[readonly]{ color: var(--ux-color-muted); cursor: default; }

/* Select2 (feel lama) */
.select2-host{ position:relative; min-width:260px; }
.ref-select.is-enhanced,
.native-select.is-enhanced{ position:absolute !important; left:-9999px !important; }

.list-pekerjaan .select2-container{ width:100% !important; z-index: auto; }
.list-pekerjaan .select2-container .select2-selection--single{
  min-height:34px; border-radius:.375rem; display:flex; align-items:center; padding:4px 8px;
  border: 1px solid var(--dp-c-border);
  background: var(--dp-c-bg); color: var(--dp-c-text);
}
.list-pekerjaan .select2-container .select2-selection__rendered{
  white-space:normal !important; word-break:break-word; overflow-wrap:anywhere;
  line-height:1.25rem; font-size: var(--ux-font-xs); padding-right:2rem;
}
.select2-container--default.select2-container--focus .select2-selection--single{
  border-color: var(--dp-c-primary) !important;
  box-shadow: 0 0 0 .2rem var(--dp-c-focus) !important;
}
.list-pekerjaan .select2-dropdown{
  background: var(--dp-c-bg); color: var(--dp-c-text);
  border: 1px solid var(--dp-c-border); box-shadow: var(--dp-shadow-lg);
  z-index: var(--lp-z-select2);
}
.list-pekerjaan .select2-results__option{ font-size: var(--ux-font-xs); }
.list-pekerjaan .select2-host{ position:relative; z-index:auto; }
.list-pekerjaan .select2-host.s2-open{ z-index: calc(var(--lp-z-select2) - 1) !important; }
.list-pekerjaan .select2-host.s2-open .select2-dropdown{ z-index: var(--dp-z-dropdown) !important; }

/* Kolom “Referensi” clamp 2 baris (selection) */
#klas-list td.col-ref .select2-container .select2-selection--single{
  height: calc((var(--lp-clamp-line) * 2) + (var(--lp-clamp-pad-v) * 2)) !important;
  min-height: calc((var(--lp-clamp-line) * 2) + (var(--lp-clamp-pad-v) * 2)) !important;
  align-items:flex-start !important;
  padding-top: var(--lp-clamp-pad-v) !important; padding-bottom: var(--lp-clamp-pad-v) !important;
  border-radius:.6rem !important;
}
#klas-list td.col-ref .select2-container .select2-selection__rendered,
#klas-list td.col-ref .s2-selection-wrap{
  display:-webkit-box !important; -webkit-box-orient:vertical !important; -webkit-line-clamp:2 !important; line-clamp:2 !important; overflow:hidden !important;
  white-space:normal !important; word-break:break-word !important; overflow-wrap:anywhere !important;
  font-size: var(--lp-clamp-font) !important; line-height: var(--lp-clamp-line) !important;
  max-height: calc(var(--lp-clamp-line) * 2) !important; padding-right:2rem !important;
}

/* Mode selector (kolom Sumber) kecil */
#klas-list td.col-mode .form-select{
  font-size: var(--ux-font-xs);
  line-height:1.3;
  padding:.25rem .5rem;
  height:auto; min-height:calc(1.5em + .5rem);
}

/* Hover & badges */
.lp-row{ display:table-row; }
.lp-row:hover{ background: var(--dp-row-hover); }
.source-badge{ display:inline-block; padding:.25rem .5rem; font-size:.75rem; border-radius:.35rem; }

/* ============== COMPACT PREFERENCES ============== */
#lp-app.compact .card-header{ padding:.35rem .5rem; }
#lp-app.compact .card-body{ padding:.5rem; }
#lp-app.compact .table{ font-size:.9rem; }
#lp-app.compact .table td,
#lp-app.compact .table th{ padding:.25rem .4rem; }
#lp-app.compact .form-control.form-control-sm,
#lp-app.compact .form-select.form-select-sm{ padding:.15rem .35rem; height:calc(1.5em + .4rem); }

/* ============== FAB SAVE ============== */
#btn-save-fab{
  position:fixed; right:18px; bottom:18px; z-index: var(--dp-z-toolbar);
  border-radius:999px; box-shadow: var(--dp-shadow-md);
  padding:.7rem 1.1rem;
}

/* ============== RESPONSIVE & MISC ============== */
@media (max-width:420px){ #lp-sidebar .lp-sidebar-inner{ right:.75rem; left:.75rem; width:auto; } }
@media (prefers-reduced-motion:reduce){ #lp-sidebar .lp-sidebar-inner{ transition:none; } }

/* Nonaktifkan sidebar lama jika ada */
.list-pekerjaan #lpSidebar{ display:none !important; }

/* Anchor flash */
.lp-flash{ animation: lpFlash 1.6s ease; }
@keyframes lpFlash{
  0%{box-shadow:0 0 0 0 rgba(13,110,253,0), inset 0 0 0 0 rgba(13,110,253,0);}
  12%{box-shadow:0 0 0 6px rgba(13,110,253,.22), inset 0 0 0 1px rgba(13,110,253,.35);}
  40%{box-shadow:0 0 0 0 rgba(13,110,253,0), inset 0 0 0 1px rgba(13,110,253,.35);}
  100%{box-shadow:0 0 0 0 rgba(13,110,253,0), inset 0 0 0 0 rgba(13,110,253,0);}
}


/* ==== [LEBARKAN URAIAN | PERSEMPIT REF] ==== */

/* 1) Tabel lokal (di dalam kartu Sub) — dipakai harian */
#klas-list table.list-pekerjaan{
  table-layout: fixed; /* penting: agar width kolom dipatuhi */
}

/* Atur lebar kolom (silakan ubah persentasenya sesuai selera) */
#klas-list table.list-pekerjaan .col-num  { width: 35px; }
#klas-list table.list-pekerjaan .col-mode { width: 175px; }
#klas-list table.list-pekerjaan .col-ref  { width: 35%; }   /* dipersempit */
#klas-list table.list-pekerjaan .col-urai { width: 45%; }   /* diperlebar */
#klas-list table.list-pekerjaan .col-sat  { width: 96px; }
#klas-list table.list-pekerjaan .col-act  { width: 64px; }

/* Pastikan isi kolom Referensi tidak ‘ngelawan’ */
#klas-list td.col-ref,
#klas-list td.col-ref > div,
#klas-list td.col-ref .select2-host,
#klas-list td.col-ref .select2-container{
  min-width: 0 !important;
  max-width: 100% !important;
  width: 100% !important;
}

/* 2) Tabel global fallback (#lp-table) — jarang dipakai, tapi sekalian rapikan */
#lp-table{
  table-layout: fixed;
}
#lp-table col.col-num  { width: 35px; }
#lp-table col.col-mode { width: 175px; }
#lp-table col.col-ref  { width: 35%; }   /* dipersempit */
#lp-table col.col-urai { width: 45%; }   /* diperlebar */
#lp-table col.col-sat  { width: 96px; }
#lp-table col.col-act  { width: 64px; }

/* Bonus: dukung clamp/select2 supaya tidak melar */
#lp-table tbody td:nth-child(3),
#lp-table tbody td:nth-child(3) > div,
#lp-table tbody td:nth-child(3) .select2-host,
#lp-table tbody td:nth-child(3) .select2-container{
  min-width: 0 !important;
  max-width: 100% !important;
  width: 100% !important;
}
