{"version":3,"file":"core-modules-t2ZCVRBW.js","sources":["../../../../../../js/src/modules/core/mode-state.js","../../../../../../js/src/modules/core/state-manager.js","../../../../../../js/src/modules/core/data-loader.js","../../../../../../js/src/modules/core/time-column-generator.js","../../../../../../js/src/modules/core/save-handler.js"],"sourcesContent":["/**\n * ModeState - Holds state for a single progress mode (planned or actual)\n *\n * Phase 0.2: StateManager Architecture\n *\n * This class encapsulates all data for one mode:\n * - assignmentMap: Saved data from backend (Map<cellKey, value>)\n * - modifiedCells: Unsaved changes from user input (Map<cellKey, value>)\n * - isDirty: Flag indicating if cache needs invalidation\n *\n * @class ModeState\n */\nexport class ModeState {\n  /**\n   * Create a new ModeState\n   */\n  constructor() {\n    /**\n     * Saved assignment values from backend\n     * Key format: \"{pekerjaanId}-{columnId}\"\n     * Value: number (percentage 0-100)\n     * @type {Map<string, number>}\n     */\n    this.assignmentMap = new Map();\n\n    /**\n     * Modified cell values (unsaved changes)\n     * Key format: \"{pekerjaanId}-{columnId}\"\n     * Value: number (percentage 0-100)\n     * @type {Map<string, number>}\n     */\n    this.modifiedCells = new Map();\n\n    /**\n     * Saved actual cost values (only applicable for actual mode but shared API)\n     * Key format: \"{pekerjaanId}-{columnId}\"\n     * Value: number (rupiah)\n     * @type {Map<string, number>}\n     */\n    this.costAssignmentMap = new Map();\n\n    /**\n     * Modified actual cost values waiting to be saved\n     * Key format: \"{pekerjaanId}-{columnId}\"\n     * Value: number (rupiah)\n     * @type {Map<string, number>}\n     */\n    this.costModifiedCells = new Map();\n\n    /**\n     * Dirty flag for cache invalidation\n     * Set to true when modifiedCells changes\n     * @type {boolean}\n     */\n    this.isDirty = false;\n  }\n\n  /**\n   * Serialize state to JSON\n   * Useful for debugging and persistence\n   * @returns {Object}\n   */\n  toJSON() {\n    return {\n      assignmentMap: Array.from(this.assignmentMap.entries()),\n      modifiedCells: Array.from(this.modifiedCells.entries()),\n      costAssignmentMap: Array.from(this.costAssignmentMap.entries()),\n      costModifiedCells: Array.from(this.costModifiedCells.entries()),\n      isDirty: this.isDirty\n    };\n  }\n\n  /**\n   * Deserialize state from JSON\n   * @param {Object} data - Serialized state data\n   * @returns {ModeState}\n   */\n  static fromJSON(data) {\n    const state = new ModeState();\n\n    if (data.assignmentMap && Array.isArray(data.assignmentMap)) {\n      state.assignmentMap = new Map(data.assignmentMap);\n    }\n\n    if (data.modifiedCells && Array.isArray(data.modifiedCells)) {\n      state.modifiedCells = new Map(data.modifiedCells);\n    }\n\n    if (data.costAssignmentMap && Array.isArray(data.costAssignmentMap)) {\n      state.costAssignmentMap = new Map(data.costAssignmentMap);\n    }\n\n    if (data.costModifiedCells && Array.isArray(data.costModifiedCells)) {\n      state.costModifiedCells = new Map(data.costModifiedCells);\n    }\n\n    if (typeof data.isDirty === 'boolean') {\n      state.isDirty = data.isDirty;\n    }\n\n    return state;\n  }\n\n  /**\n   * Get statistics about this mode state\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      assignmentCount: this.assignmentMap.size,\n      modifiedCount: this.modifiedCells.size,\n      costAssignmentCount: this.costAssignmentMap.size,\n      costModifiedCount: this.costModifiedCells.size,\n      isDirty: this.isDirty,\n      hasUnsavedChanges: this.modifiedCells.size > 0 || this.costModifiedCells.size > 0\n    };\n  }\n\n  /**\n   * Clear all data from this mode state\n   */\n  clear() {\n    this.assignmentMap.clear();\n    this.modifiedCells.clear();\n    this.costAssignmentMap.clear();\n    this.costModifiedCells.clear();\n    this.isDirty = true;\n  }\n\n  /**\n   * Clone this mode state (deep copy)\n   * @returns {ModeState}\n   */\n  clone() {\n    const cloned = new ModeState();\n    cloned.assignmentMap = new Map(this.assignmentMap);\n    cloned.modifiedCells = new Map(this.modifiedCells);\n    cloned.costAssignmentMap = new Map(this.costAssignmentMap);\n    cloned.costModifiedCells = new Map(this.costModifiedCells);\n    cloned.isDirty = this.isDirty;\n    return cloned;\n  }\n}\n\nexport default ModeState;\n","/**\n * StateManager - Singleton for managing dual-mode progress state\n *\n * Phase 0.2: StateManager Architecture\n *\n * This class replaces the fragmented state management pattern with a single\n * source of truth. It manages both 'planned' and 'actual' progress states\n * and provides a clean API for reading/writing cell values.\n *\n * Key features:\n * - Singleton pattern (one instance per application)\n * - Dual state architecture (planned vs actual)\n * - Smart caching with automatic invalidation\n * - Event-driven updates (pub/sub pattern)\n * - Thread-safe state switching\n *\n * @class StateManager\n */\n\nimport { ModeState } from './mode-state.js';\n\nconst LOG_PREFIX = '[StateManager]';\n\nexport class StateManager {\n  /**\n   * Singleton instance\n   * @private\n   * @static\n   * @type {StateManager|null}\n   */\n  static instance = null;\n\n  /**\n   * Get singleton instance\n   * @returns {StateManager}\n   */\n  static getInstance() {\n    if (!StateManager.instance) {\n      StateManager.instance = new StateManager();\n      console.log(LOG_PREFIX, 'Singleton instance created');\n    }\n    return StateManager.instance;\n  }\n\n  /**\n   * Private constructor (use getInstance() instead)\n   * @private\n   */\n  constructor() {\n    if (StateManager.instance) {\n      throw new Error('StateManager is a singleton. Use StateManager.getInstance()');\n    }\n\n    /**\n     * Current progress mode ('planned' or 'actual')\n     * @type {string}\n     */\n    this.currentMode = 'planned';\n\n    /**\n     * Mode-specific state storage\n     * @type {Object}\n     */\n    this.states = {\n      planned: new ModeState(),\n      actual: new ModeState()\n    };\n\n    /**\n     * Merged cell values cache\n     * Key: \"cells:{mode}\"\n     * Value: Map<cellKey, number>\n     * @private\n     * @type {Map<string, Map<string, number>>}\n     */\n    this._mergedCellsCache = new Map();\n\n    /**\n     * Event listeners for state changes\n     * @private\n     * @type {Set<Function>}\n     */\n    this._listeners = new Set();\n\n    console.log(LOG_PREFIX, 'Initialized with dual state architecture');\n  }\n\n  /**\n   * Get value for a specific cell\n   * Reads from modifiedCells first, then assignmentMap\n   *\n   * @param {number|string} pekerjaanId - Pekerjaan ID\n   * @param {string} columnId - Column ID (e.g., \"col_123\")\n   * @returns {number} Cell value (0 if not found)\n   */\n  getCellValue(pekerjaanId, columnId) {\n    const state = this._getCurrentState();\n    const cellKey = `${pekerjaanId}-${columnId}`;\n\n    // Priority: modifiedCells > assignmentMap > 0\n    return state.modifiedCells.get(cellKey) ??\n           state.assignmentMap.get(cellKey) ??\n           0;\n  }\n\n  /**\n   * Get all cell values for a specific mode (merged view)\n   * Returns assignmentMap + modifiedCells combined\n   * Uses cache for performance\n   *\n   * @param {string} mode - 'planned' or 'actual'\n   * @returns {Map<string, number>} Merged cell values\n   */\n  getAllCellsForMode(mode) {\n    const modeState = this.states[mode];\n    if (!modeState) {\n      console.error(LOG_PREFIX, `Invalid mode: ${mode}`);\n      return new Map();\n    }\n\n    const cacheKey = `cells:${mode}`;\n\n    // Return cached if available and not dirty\n    if (this._mergedCellsCache.has(cacheKey) && !modeState.isDirty) {\n      return this._mergedCellsCache.get(cacheKey);\n    }\n\n    // Build merged map: assignmentMap + modifiedCells\n    const merged = new Map(modeState.assignmentMap);\n\n    // Override with modified cells\n    modeState.modifiedCells.forEach((value, key) => {\n      merged.set(key, value);\n    });\n\n    // Cache it\n    this._mergedCellsCache.set(cacheKey, merged);\n    modeState.isDirty = false;\n\n    console.log(LOG_PREFIX, `Built merged cells for ${mode.toUpperCase()}: ${merged.size} cells`);\n\n    return merged;\n  }\n\n  /**\n   * Set value for a specific cell (user input)\n   * Writes to modifiedCells, invalidates cache\n   *\n   * @param {number|string} pekerjaanId - Pekerjaan ID\n   * @param {string} columnId - Column ID\n   * @param {number|string} value - Cell value (percentage)\n   */\n  setCellValue(pekerjaanId, columnId, value) {\n    const state = this._getCurrentState();\n    const cellKey = `${pekerjaanId}-${columnId}`;\n    const numericValue = parseFloat(value);\n\n    if (Number.isNaN(numericValue)) {\n      console.warn(LOG_PREFIX, `Invalid value for cell ${cellKey}:`, value);\n      return;\n    }\n\n    // Write to modifiedCells\n    state.modifiedCells.set(cellKey, numericValue);\n\n    // Invalidate cache\n    this._invalidateCache(this.currentMode);\n\n    // Mark as dirty\n    state.isDirty = true;\n\n    console.log(LOG_PREFIX, `Cell ${cellKey} = ${numericValue}% (${this.currentMode.toUpperCase()} mode)`);\n  }\n\n  /**\n   * Switch to a different progress mode\n   * @param {string} newMode - 'planned' or 'actual'\n   */\n  switchMode(newMode) {\n    if (newMode !== 'planned' && newMode !== 'actual') {\n      console.error(LOG_PREFIX, `Invalid mode: ${newMode}`);\n      return;\n    }\n\n    if (this.currentMode === newMode) {\n      console.log(LOG_PREFIX, `Already in ${newMode.toUpperCase()} mode`);\n      return;\n    }\n\n    const oldMode = this.currentMode;\n    this.currentMode = newMode;\n\n    console.log(LOG_PREFIX, `Switched: ${oldMode.toUpperCase()} → ${newMode.toUpperCase()}`);\n\n    // Notify listeners\n    this._notifyListeners({\n      type: 'mode-switch',\n      oldMode,\n      newMode\n    });\n  }\n\n  /**\n   * Commit modified cells to assignmentMap (after save)\n   * Clears modifiedCells and invalidates cache\n   */\n  commitChanges() {\n    const state = this._getCurrentState();\n\n    // Move modifiedCells → assignmentMap\n    state.modifiedCells.forEach((value, key) => {\n      state.assignmentMap.set(key, value);\n    });\n\n    // Move costModifiedCells → costAssignmentMap (used for actual mode)\n    state.costModifiedCells.forEach((value, key) => {\n      if (value === null || typeof value === 'undefined') {\n        state.costAssignmentMap.delete(key);\n        return;\n      }\n      const numeric = Number(value);\n      if (Number.isFinite(numeric) && numeric >= 0) {\n        state.costAssignmentMap.set(key, numeric);\n      } else {\n        state.costAssignmentMap.delete(key);\n      }\n    });\n\n    const count = state.modifiedCells.size + state.costModifiedCells.size;\n    state.modifiedCells.clear();\n    state.costModifiedCells.clear();\n\n    // Invalidate cache\n    this._invalidateCache(this.currentMode);\n\n    console.log(LOG_PREFIX, `Committed ${count} changes to ${this.currentMode.toUpperCase()} assignmentMap`);\n\n    // Notify listeners\n    this._notifyListeners({\n      type: 'commit',\n      mode: this.currentMode,\n      count\n    });\n  }\n\n  /**\n   * Load initial data into assignmentMap\n   * Used by DataLoader after fetching from backend\n   *\n   * @param {string} mode - 'planned' or 'actual'\n   * @param {Map<string, number>} dataMap - Cell key → value map\n   */\n  loadData(mode, dataMap, costDataMap = new Map()) {\n    const state = this.states[mode];\n    if (!state) {\n      console.error(LOG_PREFIX, `Invalid mode: ${mode}`);\n      return;\n    }\n\n    // Replace assignmentMap\n    state.assignmentMap = new Map(dataMap);\n    if (costDataMap instanceof Map) {\n      state.costAssignmentMap = new Map(costDataMap);\n    }\n\n    // Clear modified cells\n    state.modifiedCells.clear();\n    state.costModifiedCells.clear();\n\n    // Invalidate cache\n    this._invalidateCache(mode);\n\n    console.log(LOG_PREFIX, `Loaded ${dataMap.size} assignments into ${mode.toUpperCase()} state`);\n  }\n\n  /**\n   * Set initial value for a cell (from backend data)\n   * Used during data loading phase\n   *\n   * @param {number|string} pekerjaanId\n   * @param {string} columnId\n   * @param {number} plannedValue\n   * @param {number} actualValue\n   */\n  setInitialValue(pekerjaanId, columnId, plannedValue = 0, actualValue = 0, options = {}) {\n    const cellKey = `${pekerjaanId}-${columnId}`;\n\n    // Set planned value\n    if (Number.isFinite(plannedValue) && plannedValue > 0) {\n      this.states.planned.assignmentMap.set(cellKey, plannedValue);\n    }\n\n    // Set actual value\n    if (Number.isFinite(actualValue) && actualValue > 0) {\n      this.states.actual.assignmentMap.set(cellKey, actualValue);\n    }\n\n    const hasCostProp =\n      Object.prototype.hasOwnProperty.call(options || {}, 'actualCost') ||\n      Object.prototype.hasOwnProperty.call(options || {}, 'actual_cost') ||\n      Object.prototype.hasOwnProperty.call(options || {}, 'cost');\n    const actualCost = Number(options?.actualCost ?? options?.cost ?? options?.actual_cost);\n    if (Number.isFinite(actualCost) && actualCost >= 0) {\n      this.states.actual.costAssignmentMap.set(cellKey, actualCost);\n    } else if (hasCostProp) {\n      this.states.actual.costAssignmentMap.delete(cellKey);\n    }\n  }\n\n  /**\n   * Add event listener for state changes\n   * @param {Function} callback - Listener function\n   */\n  addEventListener(callback) {\n    if (typeof callback !== 'function') {\n      console.error(LOG_PREFIX, 'Event listener must be a function');\n      return;\n    }\n\n    this._listeners.add(callback);\n    console.log(LOG_PREFIX, `Added event listener (total: ${this._listeners.size})`);\n  }\n\n  /**\n   * Remove event listener\n   * @param {Function} callback - Listener function\n   */\n  removeEventListener(callback) {\n    this._listeners.delete(callback);\n  }\n\n  /**\n   * Check if there are unsaved changes in current mode\n   * @returns {boolean}\n   */\n  hasUnsavedChanges() {\n    const state = this._getCurrentState();\n    return (\n      (state.modifiedCells && state.modifiedCells.size > 0) ||\n      (state.costModifiedCells && state.costModifiedCells.size > 0)\n    );\n  }\n\n  /**\n   * Get statistics about state manager\n   * @returns {Object}\n   */\n  getStats() {\n    return {\n      currentMode: this.currentMode,\n      planned: this.states.planned.getStats(),\n      actual: this.states.actual.getStats(),\n      cacheSize: this._mergedCellsCache.size,\n      listenerCount: this._listeners.size\n    };\n  }\n\n  /**\n   * Get current mode state\n   * @private\n   * @returns {ModeState}\n   */\n  _getCurrentState() {\n    return this.states[this.currentMode];\n  }\n\n  /**\n   * Invalidate cache for a specific mode\n   * @private\n   * @param {string} mode\n   */\n  _invalidateCache(mode) {\n    const cacheKey = `cells:${mode}`;\n    this._mergedCellsCache.delete(cacheKey);\n\n    const state = this.states[mode];\n    if (state) {\n      state.isDirty = true;\n    }\n  }\n\n  /**\n   * Notify all event listeners\n   * @private\n   * @param {Object} event - Event data\n   */\n  _notifyListeners(event) {\n    this._listeners.forEach(listener => {\n      try {\n        listener(event);\n      } catch (error) {\n        console.error(LOG_PREFIX, 'Listener error:', error);\n      }\n    });\n  }\n\n  /**\n   * Clear all data (use with caution)\n   */\n  reset() {\n    this.states.planned.clear();\n    this.states.actual.clear();\n    this._mergedCellsCache.clear();\n    this.currentMode = 'planned';\n\n    console.log(LOG_PREFIX, 'State reset');\n\n    this._notifyListeners({ type: 'reset' });\n  }\n\n  /**\n   * Export state for debugging\n   * @returns {Object}\n   */\n  exportState() {\n    return {\n      currentMode: this.currentMode,\n      planned: this.states.planned.toJSON(),\n      actual: this.states.actual.toJSON(),\n      stats: this.getStats()\n    };\n  }\n}\n\n// Phase 0: Export to global scope for testing and debugging\nif (typeof window !== 'undefined') {\n  window.StateManager = StateManager;\n}\n\nexport default StateManager;\n","/**\n * Data Loader Module (ES6 Modern Version)\n * Handles all data loading operations for Jadwal Kegiatan page\n *\n * Migrated from: jadwal_pekerjaan/kelola_tahapan/data_loader_module.js\n * Date: 2025-11-19\n * Phase 0.3: Integrated with StateManager\n */\n\nimport { StateManager } from './state-manager.js';\n\n// =========================================================================\n// UTILITY FUNCTIONS\n// =========================================================================\n\n/**\n * Get CSRF token from cookies\n * @returns {string|null} CSRF token\n */\nfunction getCookie(name) {\n  let cookieValue = null;\n  if (document.cookie && document.cookie !== '') {\n    const cookies = document.cookie.split(';');\n    for (let i = 0; i < cookies.length; i++) {\n      const cookie = cookies[i].trim();\n      if (cookie.substring(0, name.length + 1) === (name + '=')) {\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n        break;\n      }\n    }\n  }\n  return cookieValue;\n}\n\n/**\n * Make API call with automatic CSRF handling\n * @param {string} url - API endpoint\n * @param {Object} options - Fetch options\n * @returns {Promise<any>} JSON response\n */\nasync function apiCall(url, options = {}) {\n  const method = (options.method || 'GET').toUpperCase();\n  const needsCSRF = ['POST', 'PUT', 'DELETE', 'PATCH'].includes(method);\n\n  if (needsCSRF) {\n    options.headers = options.headers || {};\n    options.headers['X-CSRFToken'] = getCookie('csrftoken');\n  }\n\n  const response = await fetch(url, {\n    credentials: 'same-origin',\n    ...options\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({}));\n    throw new Error(error.error || `HTTP ${response.status}`);\n  }\n\n  return response.json();\n}\n\n/**\n * Derive time scale mode from tahapan list\n * @param {Array} tahapanList - List of tahapan\n * @param {string} fallbackMode - Default mode if can't detect\n * @returns {string} Detected mode (daily|weekly|monthly|custom)\n */\nfunction deriveTimeScaleFromTahapan(tahapanList, fallbackMode = 'weekly') {\n  if (!Array.isArray(tahapanList) || tahapanList.length === 0) {\n    return fallbackMode;\n  }\n\n  const autoCounts = { daily: 0, weekly: 0, monthly: 0 };\n  let autoTotal = 0;\n  let manualCount = 0;\n\n  tahapanList.forEach((tahap) => {\n    if (tahap && tahap.is_auto_generated && typeof tahap.generation_mode === 'string') {\n      const mode = tahap.generation_mode.toLowerCase();\n      if (autoCounts.hasOwnProperty(mode)) {\n        autoCounts[mode] += 1;\n        autoTotal += 1;\n      }\n    } else {\n      manualCount += 1;\n    }\n  });\n\n  // If auto-generated tahapan exist, use dominant mode\n  if (autoTotal > 0) {\n    const dominantMode = Object.entries(autoCounts).reduce((bestMode, entry) => {\n      const [mode, count] = entry;\n      if (!bestMode) return mode;\n      if (count > autoCounts[bestMode]) return mode;\n      return bestMode;\n    }, '');\n\n    if (dominantMode && autoCounts[dominantMode] > 0) {\n      return dominantMode;\n    }\n  }\n\n  // If only manual tahapan exist, it's custom mode\n  if (manualCount > 0) {\n    return 'custom';\n  }\n\n  return fallbackMode;\n}\n\n/**\n * Initialize expanded nodes set for tree\n * @param {Array} tree - Pekerjaan tree\n * @param {Object} state - Application state\n */\nfunction initialiseExpandedNodes(tree, state) {\n  if (!Array.isArray(tree) || tree.length === 0) {\n    return;\n  }\n\n  if (!(state.expandedNodes instanceof Set)) {\n    state.expandedNodes = new Set();\n  }\n\n  // If already initialized, skip\n  if (state.expandedNodes.size > 0) {\n    return;\n  }\n\n  // Expand all nodes by default\n  const collectIds = (nodes) => {\n    nodes.forEach((node) => {\n      if (!node || !node.id) return;\n      if (node.children && node.children.length > 0) {\n        state.expandedNodes.add(node.id);\n        collectIds(node.children);\n      }\n    });\n  };\n\n  collectIds(tree);\n}\n\n/**\n * Build hierarchical pekerjaan tree from API response\n * @param {Object} response - API response\n * @returns {Array} Tree structure\n */\nfunction buildPekerjaanTree(response) {\n  const tree = [];\n  const data = response.klasifikasi || response;\n\n  if (!Array.isArray(data)) return tree;\n\n  data.forEach(klas => {\n    const klasNode = {\n      id: `klas-${klas.id || klas.nama}`,\n      type: 'klasifikasi',\n      nama: klas.name || klas.nama || 'Klasifikasi',\n      children: [],\n      level: 0,\n      expanded: true\n    };\n\n    // Store for enrichment\n    const klasifikasiId = klas.id;\n    const klasifikasiName = klas.name || klas.nama || 'Klasifikasi';\n    const klasifikasiKode = klas.kode || '';\n\n    if (klas.sub && Array.isArray(klas.sub)) {\n      klas.sub.forEach(sub => {\n        const subNode = {\n          id: `sub-${sub.id || sub.nama}`,\n          type: 'sub-klasifikasi',\n          nama: sub.name || sub.nama || 'Sub-Klasifikasi',\n          children: [],\n          level: 1,\n          expanded: true\n        };\n\n        // Store for enrichment\n        const subKlasifikasiId = sub.id;\n        const subKlasifikasiName = sub.name || sub.nama || 'Sub-Klasifikasi';\n        const subKlasifikasiKode = sub.kode || '';\n\n        if (sub.pekerjaan && Array.isArray(sub.pekerjaan)) {\n          sub.pekerjaan.forEach(pkj => {\n            const pkjNode = {\n              id: pkj.id || pkj.pekerjaan_id,\n              type: 'pekerjaan',\n              kode: pkj.snapshot_kode || pkj.kode || '',\n              nama: pkj.snapshot_uraian || pkj.uraian || '',\n              volume: pkj.volume || 0,\n              satuan: pkj.snapshot_satuan || pkj.satuan || '-',\n              level: 2,\n              budgeted_cost: Number.parseFloat(pkj.budgeted_cost ?? pkj.total_cost ?? 0) || 0,\n\n              // ✅ ADD: Parent information for Gantt Chart\n              klasifikasi_id: klasifikasiId,\n              klasifikasi_name: klasifikasiName,\n              klasifikasi_kode: klasifikasiKode,\n              sub_klasifikasi_id: subKlasifikasiId,\n              sub_klasifikasi_name: subKlasifikasiName,\n              sub_klasifikasi_kode: subKlasifikasiKode\n            };\n            subNode.children.push(pkjNode);\n          });\n        }\n\n        klasNode.children.push(subNode);\n      });\n    }\n\n    tree.push(klasNode);\n  });\n\n  return tree;\n}\n\n/**\n * Flatten tree structure for easy access\n * @param {Array} tree - Hierarchical tree\n * @param {Array} result - Accumulator\n * @returns {Array} Flattened list\n */\nfunction flattenTree(tree, result = []) {\n  tree.forEach(node => {\n    result.push(node);\n    if (node.children && node.children.length > 0) {\n      flattenTree(node.children, result);\n    }\n  });\n  return result;\n}\n\n// =========================================================================\n// DATA LOADER CLASS\n// =========================================================================\n\n/**\n * DataLoader class - handles all data loading operations\n */\nexport class DataLoader {\n  constructor(state, options = {}) {\n    if (!state) {\n      throw new Error('[DataLoader] State is required');\n    }\n\n    this.state = state;\n    this.options = options;\n    this.projectId = state.projectId;\n\n    // Phase 0.3: Initialize StateManager\n    this.stateManager = StateManager.getInstance();\n\n    // Initialize state maps if not exist\n    if (!this.state.volumeMap) {\n      this.state.volumeMap = new Map();\n    }\n    // Phase 0.3: assignmentMap now managed by StateManager\n    // Legacy code may still access via this.state.assignmentMap (delegation getter)\n    if (!this.state.cache) {\n      this.state.cache = {};\n    }\n\n    console.log('[DataLoader] Phase 0.3: Initialized with StateManager');\n  }\n\n  /**\n   * Load all data required for the page\n   * @param {Object} options - Load options\n   * @returns {Promise<Object>} Load result with metadata\n   */\n  async loadAllData(options = {}) {\n    // Prevent duplicate loading\n    if (this.state.cache.initialLoadInProgress) {\n      console.info('[DataLoader] loadAllData skipped (already in progress)');\n      return null;\n    }\n\n    // Skip if already loaded\n    if (!options.force && this.state.cache.initialLoadCompleted && options.skipIfLoaded) {\n      console.info('[DataLoader] loadAllData skipped (already completed)');\n      return this.state.cache.initialLoadResult || null;\n    }\n\n    this.state.cache.initialLoadInProgress = true;\n\n    try {\n      console.log('[DataLoader] Loading all data...');\n\n      // Step 1: Load base data in parallel\n      await Promise.all([\n        this.loadTahapan(),\n        this.loadPekerjaan(),\n        this.loadVolumes()\n      ]);\n\n      // Step 2: Time columns will be generated by TimeColumnGenerator\n      // (We don't call it here, will be handled by main app)\n\n      // Step 3: Load assignments (depends on time columns being generated)\n      await this.loadAssignments();\n\n      this.state.cache.initialLoadCompleted = true;\n      this.state.cache.initialLoadResult = {\n        completedAt: Date.now(),\n        tahapanCount: this.state.tahapanList?.length || 0,\n        pekerjaanCount: this.state.flatPekerjaan?.filter(node => node.type === 'pekerjaan').length || 0,\n      };\n\n      console.log('[DataLoader] ✅ All data loaded successfully:', this.state.cache.initialLoadResult);\n      return this.state.cache.initialLoadResult;\n\n    } catch (error) {\n      console.error('[DataLoader] ❌ Load data failed:', error);\n      this.state.cache.initialLoadError = error;\n      throw error;\n    } finally {\n      this.state.cache.initialLoadInProgress = false;\n    }\n  }\n\n  /**\n   * Load tahapan data from API\n   * @returns {Promise<Array>} List of tahapan\n   */\n  async loadTahapan() {\n    try {\n      const url = this.state.apiBase || `/detail_project/api/project/${this.projectId}/tahapan/`;\n      const data = await apiCall(url);\n\n      this.state.tahapanList = (data.tahapan || data || []).sort((a, b) => a.urutan - b.urutan);\n\n      // Auto-detect time scale mode from tahapan\n      const detectedMode = deriveTimeScaleFromTahapan(\n        this.state.tahapanList,\n        this.state.timeScale || 'weekly'\n      );\n      this.state.timeScale = detectedMode;\n\n      console.log(`[DataLoader] ✅ Loaded ${this.state.tahapanList.length} tahapan, mode: ${detectedMode}`);\n      return this.state.tahapanList;\n    } catch (error) {\n      console.error('[DataLoader] ❌ Failed to load tahapan:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Load pekerjaan tree data from API\n   * @returns {Promise<Array>} Pekerjaan tree\n   */\n  async loadPekerjaan() {\n    try {\n      const url = `/detail_project/api/project/${this.projectId}/list-pekerjaan/tree/`;\n      const response = await apiCall(url);\n\n      // Build hierarchical tree\n      const tree = buildPekerjaanTree(response);\n      this.state.pekerjaanTree = tree;\n\n      // Flatten for easy access\n      this.state.flatPekerjaan = flattenTree(tree);\n\n      // Initialize expanded nodes\n      initialiseExpandedNodes(tree, this.state);\n\n      console.log(`[DataLoader] ✅ Loaded ${this.state.flatPekerjaan.length} pekerjaan nodes`);\n      return this.state.pekerjaanTree;\n    } catch (error) {\n      console.error('[DataLoader] ❌ Failed to load pekerjaan:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Load volume data for all pekerjaan\n   * @returns {Promise<Map>} Volume map\n   */\n  async loadVolumes() {\n    try {\n      const url = `/detail_project/api/project/${this.projectId}/volume-pekerjaan/list/`;\n      const data = await apiCall(url);\n\n      this.state.volumeMap.clear();\n\n      const volumes = data.items || data.volumes || data.data || [];\n      if (Array.isArray(volumes)) {\n        volumes.forEach(v => {\n          const pkjId = v.pekerjaan_id || v.id;\n          const qty = parseFloat(v.quantity || v.volume || v.qty) || 0;\n          if (pkjId) {\n            this.state.volumeMap.set(pkjId, qty);\n          }\n        });\n      }\n\n      console.log(`[DataLoader] ✅ Loaded ${this.state.volumeMap.size} volume entries`);\n      return this.state.volumeMap;\n    } catch (error) {\n      console.error('[DataLoader] ❌ Failed to load volumes:', error);\n      // Don't throw, volumes are optional\n      return this.state.volumeMap;\n    }\n  }\n\n  /**\n   * Load assignments (progress data) for all pekerjaan\n   * @returns {Promise<Map>} Assignment map\n   */\n  async loadAssignments() {\n    try {\n      // Phase 0.3: Clear StateManager data (both modes)\n      this.stateManager.states.planned.assignmentMap.clear();\n      this.stateManager.states.actual.assignmentMap.clear();\n      console.log('[DataLoader] Phase 0.3: Loading assignments (attempting API v2)...');\n\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(node => node.type === 'pekerjaan');\n      const totalNodes = pekerjaanNodes.length;\n\n      if (totalNodes === 0) {\n        console.info('[DataLoader] No pekerjaan nodes found for assignments');\n        return this.state.assignmentMap;\n      }\n\n      await this._loadAssignmentsViaV2();\n      return this.state.assignmentMap;\n    } catch (error) {\n      console.error('[DataLoader] ❌ Failed to load assignments:', error);\n      return this.state.assignmentMap;\n    }\n  }\n\n  /**\n   * Reload specific data type\n   * @param {string} type - Data type (tahapan|pekerjaan|volumes|assignments)\n   * @returns {Promise<any>} Loaded data\n   */\n  async reload(type) {\n    const loaders = {\n      tahapan: () => this.loadTahapan(),\n      pekerjaan: () => this.loadPekerjaan(),\n      volumes: () => this.loadVolumes(),\n      assignments: () => this.loadAssignments()\n    };\n\n    const loader = loaders[type];\n    if (!loader) {\n      throw new Error(`[DataLoader] Unknown reload type: ${type}`);\n    }\n\n    console.log(`[DataLoader] Reloading ${type}...`);\n    return loader();\n  }\n\n  _buildWeekColumnIndex() {\n    const weekColumnIndex = {};\n    if (Array.isArray(this.state.timeColumns)) {\n      this.state.timeColumns.forEach((col) => {\n        const weekNumber = Number(col.weekNumber || col.week_number || col.urutan);\n        if (Number.isFinite(weekNumber) && weekNumber >= 1 && col.id) {\n          weekColumnIndex[weekNumber] = col;\n        }\n      });\n    }\n    return weekColumnIndex;\n  }\n\n  async _loadAssignmentsViaV2() {\n    const url = `/detail_project/api/v2/project/${this.projectId}/assignments/`;\n    const data = await apiCall(url);\n\n    if (!data || !Array.isArray(data.assignments)) {\n      console.info('[DataLoader] API v2 returned no assignments array (treating as empty dataset)');\n      return;\n    }\n\n    if (data.assignments.length === 0) {\n      console.info('[DataLoader] API v2 assignments empty (no progress recorded yet)');\n      return;\n    }\n\n    const weekColumnIndex = this._buildWeekColumnIndex();\n    let mapped = 0;\n\n    data.assignments.forEach((item) => {\n      const pekerjaanId = Number(item.pekerjaan_id || item.pekerjaanId || item.id);\n      const weekNumber = Number(item.week_number || item.weekNumber);\n\n      // Phase 0.3: Read both planned and actual proportions\n      const plannedProportion = parseFloat(item.planned_proportion) || 0;\n      const actualProportion = parseFloat(item.actual_proportion) || 0;\n      const rawCost = item.actual_cost ?? item.actualCost ?? null;\n      const actualCost = rawCost === null || typeof rawCost === 'undefined'\n        ? null\n        : Number.parseFloat(rawCost);\n\n      if (!pekerjaanId || !weekNumber) {\n        return;\n      }\n\n      const column = weekColumnIndex[weekNumber];\n      if (!column) {\n        return;\n      }\n\n      const columnKey = column.fieldId || column.id;\n      if (!columnKey) {\n        return;\n      }\n\n      // Phase 0.3: Use StateManager.setInitialValue to set both planned and actual\n      const options = {};\n      if (actualCost !== null && !Number.isNaN(actualCost) && Number.isFinite(actualCost)) {\n        options.actualCost = actualCost;\n      }\n\n      this.stateManager.setInitialValue(\n        pekerjaanId,\n        columnKey,\n        plannedProportion,\n        actualProportion,\n        options\n      );\n      mapped += 1;\n    });\n\n    // Phase 0.3: Log loaded data statistics\n    const stats = this.stateManager.getStats();\n    console.log(`[DataLoader] Phase 0.3: Loaded ${mapped} assignments via API v2`);\n    console.log(`[DataLoader] Planned: ${stats.planned.assignmentCount} assignments`);\n    console.log(`[DataLoader] Actual: ${stats.actual.assignmentCount} assignments`);\n  }\n}\n\n// Export utilities for external use\nexport {\n  apiCall,\n  getCookie,\n  deriveTimeScaleFromTahapan,\n  buildPekerjaanTree,\n  flattenTree,\n  initialiseExpandedNodes\n};\n","/**\n * Time Column Generator Module (ES6 Modern Version)\n * Generates time columns for different modes: daily, weekly, monthly, custom\n *\n * Migrated from: jadwal_pekerjaan/kelola_tahapan/time_column_generator_module.js\n * Date: 2025-11-19\n */\n\n// =========================================================================\n// CONSTANTS\n// =========================================================================\n\nconst ONE_DAY_MS = 24 * 60 * 60 * 1000;\n\n// =========================================================================\n// UTILITY FUNCTIONS\n// =========================================================================\n\n/**\n * Format date to short format (DD MMM)\n * @param {Date} date - Date to format\n * @returns {string} Formatted date\n */\nfunction formatDayMonth(date) {\n  if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n    return '';\n  }\n  const day = date.getDate().toString().padStart(2, '0');\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  return `${day}/${month}`;\n}\n\n/**\n * Format date for display\n * @param {Date} date - Date to format\n * @param {string} format - Format type (short|iso|long)\n * @returns {string} Formatted date\n */\nfunction formatDate(date, format = 'short') {\n  if (format === 'short') {\n    const day = date.getDate().toString().padStart(2, '0');\n    const month = date.toLocaleString('id-ID', { month: 'short' });\n    return `${day} ${month}`;\n  } else if (format === 'iso') {\n    return date.toISOString().split('T')[0];\n  }\n  return date.toLocaleDateString('id-ID');\n}\n\n/**\n * Get week number for a date relative to project start\n * @param {Date} targetDate - Target date\n * @param {Date} projectStart - Project start date\n * @param {Object} options - Additional options\n * @param {number} options.weekEndDay - JS weekday (0=Sunday) marking end of week\n * @returns {number} Week number (1-based)\n */\nfunction getWeekNumberForDate(targetDate, projectStart, options = {}) {\n  if (!(targetDate instanceof Date) || Number.isNaN(targetDate.getTime())) {\n    return 1;\n  }\n\n  if (!(projectStart instanceof Date) || Number.isNaN(projectStart.getTime())) {\n    return 1;\n  }\n\n  if (targetDate <= projectStart) {\n    return 1;\n  }\n\n  const resolvedWeekEnd =\n    Number.isInteger(options.weekEndDay) && !Number.isNaN(options.weekEndDay)\n      ? ((options.weekEndDay % 7) + 7) % 7\n      : 0; // Default: Sunday\n\n  // Calculate first week end\n  const firstWeekEnd = new Date(projectStart);\n  const offsetToEnd = (resolvedWeekEnd - projectStart.getDay() + 7) % 7;\n  firstWeekEnd.setDate(firstWeekEnd.getDate() + offsetToEnd);\n\n  if (targetDate <= firstWeekEnd) {\n    return 1;\n  }\n\n  // Calculate week number\n  const daysAfterFirst = Math.floor((targetDate - firstWeekEnd) / ONE_DAY_MS);\n  return 1 + Math.floor((daysAfterFirst + 6) / 7);\n}\n\n// =========================================================================\n// TIME COLUMN GENERATOR CLASS\n// =========================================================================\n\n/**\n * TimeColumnGenerator class - generates time columns from tahapan data\n */\nexport class TimeColumnGenerator {\n  constructor(state) {\n    if (!state) {\n      throw new Error('[TimeColumnGenerator] State is required');\n    }\n\n    this.state = state;\n  }\n\n  /**\n   * Generate time columns from loaded tahapan data\n   * Maps database tahapan to grid time columns based on current time scale mode.\n   *\n   * FILTERING LOGIC:\n   * - daily/weekly/monthly: Shows ONLY auto-generated tahapan with matching generation_mode\n   * - custom: Shows ALL tahapan (both auto-generated and manually created)\n   *\n   * CRITICAL: Each column MUST have tahapanId for save functionality to work!\n   *\n   * @returns {Array} Generated time columns\n   */\n  generate() {\n    this.state.timeColumns = [];\n    this._projectStartCache = undefined;\n    this._jsWeekEndDayCache = undefined;\n\n    const timeScale = this.state.timeScale || 'custom';\n    const tahapanList = this.state.tahapanList || [];\n\n    console.log(`[TimeColumnGenerator] Generating columns for mode: ${timeScale}`);\n    console.log(`[TimeColumnGenerator] Available tahapan in database: ${tahapanList.length}`);\n\n    // Map tahapan to time columns\n    tahapanList.forEach((tahap, index) => {\n      // For daily/weekly/monthly modes, only include tahapan with matching generation_mode\n      // For custom mode, include all tahapan\n      let shouldInclude = false;\n\n      if (timeScale === 'custom') {\n        // Custom mode: include all tahapan\n        shouldInclude = true;\n      } else {\n        // Daily/weekly/monthly: only include AUTO-GENERATED tahapan with matching generation_mode\n        shouldInclude = (\n          tahap.is_auto_generated === true &&\n          tahap.generation_mode === timeScale\n        );\n      }\n\n      if (shouldInclude) {\n        const column = this._createColumn(tahap, index);\n        this.state.timeColumns.push(column);\n      }\n    });\n\n    // FALLBACK: If no columns generated, show all tahapan\n    if (this.state.timeColumns.length === 0 && tahapanList.length > 0) {\n      console.warn(`[TimeColumnGenerator] No auto-generated tahapan found for mode \"${timeScale}\"`);\n      console.warn(`[TimeColumnGenerator] Showing all ${tahapanList.length} tahapan as fallback`);\n\n      tahapanList.forEach((tahap, index) => {\n        const column = this._createColumn(tahap, index);\n        this.state.timeColumns.push(column);\n      });\n    }\n\n    console.log(`[TimeColumnGenerator] ✅ Generated ${this.state.timeColumns.length} time columns`);\n    return this.state.timeColumns;\n  }\n\n  /**\n   * Create a column object from tahapan data\n   * @param {Object} tahap - Tahapan data\n   * @param {number} index - Index in list\n   * @returns {Object} Column object\n   * @private\n   */\n  _createColumn(tahap, index) {\n    const startDate = tahap.tanggal_mulai ? new Date(tahap.tanggal_mulai) : null;\n    const endDate = tahap.tanggal_selesai ? new Date(tahap.tanggal_selesai) : null;\n\n    let label = tahap.nama || `Tahap ${index + 1}`;\n    let rangeLabel = '';\n    let rangeText = '';\n    let tooltip = label;\n    let weekNumber = null;\n    let shortStart = '';\n    let shortEnd = '';\n    const resolvedOrder =\n      Number.isInteger(tahap.urutan) && tahap.urutan >= 0 ? tahap.urutan : index;\n\n    const isWeeklyMode =\n      (this.state.timeScale || '').toLowerCase() === 'weekly' ||\n      (tahap.generation_mode || '').toLowerCase() === 'weekly';\n    const projectStartDate = this._getProjectStartDate();\n    const jsWeekEndDay = this._getJsWeekEndDay();\n    const computedWeekNumber =\n      isWeeklyMode && startDate && projectStartDate\n        ? getWeekNumberForDate(startDate, projectStartDate, { weekEndDay: jsWeekEndDay })\n        : null;\n\n    // Special formatting for weekly mode\n    if (\n      tahap.is_auto_generated === true &&\n      tahap.generation_mode === 'weekly' &&\n      startDate &&\n      endDate\n    ) {\n      weekNumber = computedWeekNumber ?? resolvedOrder + 1;\n\n      shortStart = formatDayMonth(startDate);\n      shortEnd = formatDayMonth(endDate);\n\n      label = `Week ${weekNumber}`;\n      rangeLabel = `( ${shortStart} - ${shortEnd} )`;\n      rangeText = `${shortStart}\\u00A0-\\u00A0${shortEnd}`;\n\n      const longStart = startDate.toLocaleDateString('id-ID', {\n        weekday: 'long',\n        day: '2-digit',\n        month: 'long',\n        year: 'numeric'\n      });\n      const longEnd = endDate.toLocaleDateString('id-ID', {\n        weekday: 'long',\n        day: '2-digit',\n        month: 'long',\n        year: 'numeric'\n      });\n\n      tooltip = `Week ${weekNumber}: ${longStart} - ${longEnd}`;\n    } else if (startDate && endDate) {\n      shortStart = formatDayMonth(startDate);\n      shortEnd = formatDayMonth(endDate);\n      rangeLabel = `( ${shortStart} - ${shortEnd} )`;\n      rangeText = `${shortStart}\\u00A0-\\u00A0${shortEnd}`;\n    }\n\n    if (!weekNumber && isWeeklyMode) {\n      weekNumber = computedWeekNumber ?? resolvedOrder + 1;\n    }\n\n    const safeTahapanId = tahap.tahapan_id || tahap.id || resolvedOrder;\n    const fieldId = `col_${safeTahapanId}`;\n\n    return {\n      id: `tahap-${safeTahapanId}`,\n      fieldId,\n      tahapanId: tahap.tahapan_id,  // CRITICAL: Link to database tahapan!\n      label,\n      rangeLabel,\n      rangeText,\n      tooltip,\n      type: tahap.generation_mode || 'custom',\n      isAutoGenerated: tahap.is_auto_generated || false,\n      generationMode: tahap.generation_mode || 'custom',\n      index: resolvedOrder,\n      weekNumber,\n      startDate,\n      endDate,\n      urutan: tahap.urutan || index\n    };\n  }\n\n  /**\n   * Get column by ID\n   * @param {string} columnId - Column ID\n   * @returns {Object|null} Column object\n   */\n  getColumnById(columnId) {\n    return this.state.timeColumns.find(col => col.id === columnId) || null;\n  }\n\n  /**\n   * Get column by tahapan ID\n   * @param {number} tahapanId - Tahapan ID\n   * @returns {Object|null} Column object\n   */\n  getColumnByTahapanId(tahapanId) {\n    return this.state.timeColumns.find(col => col.tahapanId === tahapanId) || null;\n  }\n\n  /**\n   * Get columns for date range\n   * @param {Date} startDate - Start date\n   * @param {Date} endDate - End date\n   * @returns {Array} Columns in range\n   */\n  getColumnsInRange(startDate, endDate) {\n    return this.state.timeColumns.filter(col => {\n      if (!col.startDate || !col.endDate) return false;\n      return col.startDate <= endDate && col.endDate >= startDate;\n    });\n  }\n\n  /**\n   * Regenerate columns (refresh from tahapan list)\n   * @returns {Array} New time columns\n   */\n  regenerate() {\n    console.log('[TimeColumnGenerator] Regenerating columns...');\n    return this.generate();\n  }\n\n  _getProjectStartDate() {\n    if (typeof this._projectStartCache !== 'undefined') {\n      return this._projectStartCache;\n    }\n    const raw = this.state.projectStart;\n    if (!raw) {\n      this._projectStartCache = null;\n      return this._projectStartCache;\n    }\n    if (raw instanceof Date) {\n      this._projectStartCache = Number.isNaN(raw.getTime()) ? null : raw;\n      return this._projectStartCache;\n    }\n    const parsed = new Date(raw);\n    this._projectStartCache = Number.isNaN(parsed.getTime()) ? null : parsed;\n    return this._projectStartCache;\n  }\n\n  _getJsWeekEndDay() {\n    if (typeof this._jsWeekEndDayCache !== 'undefined') {\n      return this._jsWeekEndDayCache;\n    }\n    const pyWeekEnd = Number(this.state.weekEndDay);\n    const normalizedPy = Number.isFinite(pyWeekEnd) ? ((pyWeekEnd % 7) + 7) % 7 : 6;\n    this._jsWeekEndDayCache = (normalizedPy + 1) % 7; // Convert Monday-based to JS Sunday-based\n    return this._jsWeekEndDayCache;\n  }\n}\n\n// Export utilities\nexport {\n  formatDate,\n  formatDayMonth,\n  getWeekNumberForDate\n};\n","/**\r\n * Save Handler Module (ES6 Modern Version)\r\n * Handles saving modified cells to Django backend\r\n *\r\n * Migrated from: jadwal_pekerjaan/kelola_tahapan/save_handler_module.js\r\n * Date: 2025-11-19\r\n * Phase 0.3: Integrated with StateManager\r\n */\r\n\r\nimport { StateManager } from './state-manager.js';\r\n\r\n// =========================================================================\r\n// UTILITY FUNCTIONS\r\n// =========================================================================\r\n\r\n/**\r\n * Get CSRF token from cookies\r\n * @returns {string|null} CSRF token\r\n */\r\nfunction getCookie(name) {\r\n  let cookieValue = null;\r\n  if (document.cookie && document.cookie !== '') {\r\n    const cookies = document.cookie.split(';');\r\n    for (let i = 0; i < cookies.length; i++) {\r\n      const cookie = cookies[i].trim();\r\n      if (cookie.substring(0, name.length + 1) === (name + '=')) {\r\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return cookieValue;\r\n}\r\n\r\n// =========================================================================\r\n// SAVE HANDLER CLASS\r\n// =========================================================================\r\n\r\n/**\r\n * SaveHandler - Manages save operations for grid data\r\n * Handles building payloads, API calls, and state updates\r\n */\r\nexport class SaveHandler {\r\n  /**\r\n   * Create a SaveHandler instance\r\n   * @param {Object} state - Application state\r\n   * @param {Object} options - Configuration options\r\n   * @param {string} options.apiUrl - API endpoint URL\r\n   * @param {Function} options.onSuccess - Success callback\r\n   * @param {Function} options.onError - Error callback\r\n   * @param {Function} options.showToast - Toast notification function\r\n   */\r\n  constructor(state, options = {}) {\r\n    if (!state) {\r\n      throw new Error('[SaveHandler] State is required');\r\n    }\r\n\r\n    this.state = state;\r\n    this.options = options;\r\n\r\n    // Phase 0.3: Initialize StateManager\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // API configuration\r\n    this.apiUrl = options.apiUrl || `/detail_project/api/project/${state.projectId}/pekerjaan/assign_weekly/`;\r\n\r\n    // Callbacks\r\n    this.onSuccess = options.onSuccess || (() => {});\r\n    this.onError = options.onError || ((err) => console.error(err));\r\n    this.showToast = options.showToast || ((msg, type) => console.log(`[${type}] ${msg}`));\r\n\r\n    // Save state\r\n    this.isSaving = false;\r\n\r\n    console.log('[SaveHandler] Phase 0.3: Initialized with StateManager');\r\n    console.log('[SaveHandler] API:', this.apiUrl);\r\n  }\r\n\r\n  // =======================================================================\r\n  // MAIN SAVE OPERATION\r\n  // =======================================================================\r\n\r\n  /**\r\n   * Save all modified cells to server\r\n   * Main entry point for save operation\r\n   * @returns {Promise<Object>} Save result\r\n   */\r\n  async save() {\r\n    if (this.isSaving) {\r\n      console.warn('[SaveHandler] Save already in progress');\r\n      this.showToast('Penyimpanan sedang berlangsung...', 'warning');\r\n      return { success: false, reason: 'already_saving' };\r\n    }\r\n\r\n    console.log('[SaveHandler] Starting save operation...');\r\n    this.isSaving = true;\r\n\r\n    try {\r\n      // Check if there are any changes\r\n      const hasCostChanges = this._hasCostChanges();\r\n      if ((!this.state.modifiedCells || this.state.modifiedCells.size === 0) && !hasCostChanges) {\r\n        console.warn('[SaveHandler] No modified cells to save');\r\n        this.showToast('Tidak ada perubahan untuk disimpan', 'info');\r\n        this.isSaving = false;\r\n        return { success: false, reason: 'no_changes' };\r\n      }\r\n\r\n      // Build payload\r\n      const payload = this._buildPayload();\r\n      const payloadCount = payload.assignments?.length ?? payload.items?.length ?? 0;\r\n      console.log(`[SaveHandler] Built payload with ${payloadCount} items`);\r\n\r\n      // Send to server\r\n      const result = await this._sendToServer(payload);\r\n\r\n      // Handle success\r\n      this._handleSaveSuccess(result);\r\n\r\n      this.isSaving = false;\r\n      return { success: true, result };\r\n\r\n    } catch (error) {\r\n      // Handle error\r\n      this._handleSaveError(error);\r\n      this.isSaving = false;\r\n      return { success: false, error };\r\n    }\r\n  }\r\n\r\n  // =======================================================================\r\n  // PAYLOAD BUILDING\r\n  // =======================================================================\r\n\r\n  /**\r\n   * Build save payload from modified cells\r\n   * Converts modifiedCells Map to API format\r\n   * @returns {Object} Payload object\r\n   * @private\r\n   */\r\n  _buildPayload() {\r\n    const assignments = [];\r\n\r\n    // Phase 2E.1: Log which mode's modifiedCells we're reading from\r\n    const progressMode = this.state?.progressMode || 'planned';\r\n    const modeState = this.stateManager.states[progressMode];\r\n    const modifiedCells = modeState?.modifiedCells || this.state.modifiedCells || new Map();\r\n    const costModifiedCells = progressMode === 'actual' ? (modeState?.costModifiedCells || new Map()) : new Map();\r\n    const cellsToSave = new Set();\r\n\r\n    modifiedCells.forEach((_, cellKey) => cellsToSave.add(cellKey));\r\n    if (progressMode === 'actual' && costModifiedCells instanceof Map) {\r\n      costModifiedCells.forEach((_, cellKey) => cellsToSave.add(cellKey));\r\n    }\r\n\r\n    console.log(\r\n      `[SaveHandler] Building payload from ${progressMode.toUpperCase()} modifiedCells` +\r\n      ` (cells: ${modifiedCells.size}, cost: ${costModifiedCells.size})`\r\n    );\r\n\r\n    // Convert modifiedCells Map to array of assignments\r\n    // Phase 2E.1: Property delegation ensures this reads from current mode's modifiedCells\r\n    cellsToSave.forEach((cellKey) => {\r\n      const value = modifiedCells.has(cellKey) ? modifiedCells.get(cellKey) : undefined;\r\n      // Parse cellKey (format: \"nodeId-columnId\")\r\n      const [pekerjaanId, tahapanId] = cellKey.split('-');\r\n\r\n      if (!pekerjaanId || !tahapanId) {\r\n        console.warn(`[SaveHandler] Invalid cell key: ${cellKey}`);\r\n        return;\r\n      }\r\n\r\n      // Get numeric value\r\n      let proportion = typeof value === 'undefined' ? this._getSavedValue(cellKey) : parseFloat(value);\r\n      if (!Number.isFinite(proportion)) {\r\n        proportion = 0;\r\n      }\r\n\r\n      // Get column info for additional metadata\r\n      const column = this.state.timeColumns?.find((col) => {\r\n        const key = col.fieldId || col.id;\r\n        return key?.toString() === tahapanId.toString();\r\n      });\r\n\r\n      // Build item\r\n      // Backend expects generic 'proportion' field - it will convert to planned/actual based on mode\r\n      const item = {\r\n        pekerjaan_id: parseInt(pekerjaanId, 10),\r\n        proportion: Number(proportion.toFixed(2)),\r\n      };\r\n\r\n      const targetField = progressMode === 'actual' ? 'actual_proportion' : 'planned_proportion';\r\n      item[targetField] = item.proportion;\r\n\r\n      if (column) {\r\n        const tahapanPrimaryId =\r\n          column.tahapanId ??\r\n          column.tahapan_id ??\r\n          (Number.isFinite(Number(column.id)) ? Number(column.id) : null);\r\n        if (tahapanPrimaryId) {\r\n          item.tahapan_id = tahapanPrimaryId;\r\n        }\r\n\r\n        if (column.startDate) {\r\n          item.week_start = this._formatDate(column.startDate);\r\n        }\r\n        if (column.endDate) {\r\n          item.week_end = this._formatDate(column.endDate);\r\n        }\r\n        if (Number.isFinite(column.weekNumber)) {\r\n          item.week_number = column.weekNumber;\r\n        }\r\n\r\n        if (!item.week_number) {\r\n          const normalizedOrder = Number.isFinite(column.index)\r\n            ? Number(column.index)\r\n            : Number.isFinite(column.order)\r\n              ? Number(column.order)\r\n              : Number.isFinite(column.urutan)\r\n                ? Number(column.urutan)\r\n                : null;\r\n          if (normalizedOrder !== null) {\r\n            item.week_number = normalizedOrder + 1;\r\n          }\r\n        }\r\n      } else {\r\n        const numericTahapan = parseInt(tahapanId, 10);\r\n        if (Number.isFinite(numericTahapan)) {\r\n          item.tahapan_id = numericTahapan;\r\n        }\r\n      }\r\n\r\n      if (!item.week_number) {\r\n        const fallbackWeek = parseInt(item.tahapan_id ?? tahapanId, 10);\r\n        if (Number.isFinite(fallbackWeek)) {\r\n          item.week_number = fallbackWeek;\r\n        } else {\r\n          // Default to 1 as last resort to satisfy backend validation\r\n          item.week_number = 1;\r\n        }\r\n      }\r\n\r\n      if (progressMode === 'actual' && costModifiedCells instanceof Map && costModifiedCells.has(cellKey)) {\r\n        const costValue = Number(costModifiedCells.get(cellKey));\r\n        if (Number.isFinite(costValue) && costValue >= 0) {\r\n          item.actual_cost = Number(costValue.toFixed(2));\r\n        }\r\n      }\r\n\r\n      assignments.push(item);\r\n    });\r\n\r\n    console.log(`[SaveHandler] Built ${assignments.length} assignment items`);\r\n\r\n    // Phase 2E.1: progressMode already declared at top of function\r\n    console.log(`[SaveHandler] Progress Mode: ${progressMode.toUpperCase()} - Will save to ${progressMode === 'actual' ? 'actual_proportion' : 'planned_proportion'} field`);\r\n\r\n    const payload = {\r\n      assignments,\r\n      mode: progressMode,  // Phase 2E.1: 'planned' or 'actual' (determines field to update)\r\n      project_id: this.state.projectId,\r\n      week_end_day: this.state.weekEndDay ?? 6,\r\n    };\r\n\r\n    console.log(`[SaveHandler] Payload:`, JSON.stringify(payload, null, 2));\r\n\r\n    return payload;\r\n  }\r\n\r\n  /**\r\n   * Format date for API (YYYY-MM-DD)\r\n   * @param {Date} date - Date to format\r\n   * @returns {string} Formatted date\r\n   * @private\r\n   */\r\n  _formatDate(date) {\r\n    if (!(date instanceof Date)) {\r\n      date = new Date(date);\r\n    }\r\n    if (Number.isNaN(date.getTime())) {\r\n      return '';\r\n    }\r\n    return date.toISOString().split('T')[0];\r\n  }\r\n\r\n  // =======================================================================\r\n  // API COMMUNICATION\r\n  // =======================================================================\r\n\r\n  /**\r\n   * Send payload to server\r\n   * @param {Object} payload - Payload to send\r\n   * @returns {Promise<Object>} Server response\r\n   * @private\r\n   */\r\n  async _sendToServer(payload) {\r\n    console.log('[SaveHandler] Sending request to:', this.apiUrl);\r\n    console.log('[SaveHandler] Payload:', payload);\r\n\r\n    const csrfToken = getCookie('csrftoken');\r\n\r\n    const response = await fetch(this.apiUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-CSRFToken': csrfToken\r\n      },\r\n      credentials: 'same-origin',\r\n      body: JSON.stringify(payload)\r\n    });\r\n\r\n    if (!response.ok) {\r\n      let errorData = {};\r\n      let parsedBody = null;\r\n      try {\r\n        parsedBody = await response.json();\r\n        errorData = parsedBody || {};\r\n      } catch (jsonError) {\r\n        const fallbackText = await response.text().catch(() => '');\r\n        errorData = { message: fallbackText };\r\n      }\r\n\r\n      const errorMsg = errorData.error || errorData.message || `HTTP ${response.status}`;\r\n      const error = new Error(errorMsg);\r\n      if (errorData.errors) {\r\n        error.details = errorData.errors;\r\n      }\r\n      if (errorData.validation_errors) {\r\n        error.validationErrors = errorData.validation_errors;\r\n      }\r\n      if (typeof errorData === 'object') {\r\n        error.payload = errorData;\r\n      }\r\n      throw error;\r\n    }\r\n\r\n    const result = await response.json();\r\n    console.log('[SaveHandler] Server response:', result);\r\n\r\n    return result;\r\n  }\r\n\r\n  // =======================================================================\r\n  // RESPONSE HANDLING\r\n  // =======================================================================\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Server response\r\n   * @private\r\n   */\r\n  _handleSaveSuccess(result) {\r\n    console.log('[SaveHandler] ✅ Save successful');\r\n\r\n    const progressMode = (this.state?.progressMode || 'planned').toLowerCase();\r\n    const modeState = this.stateManager?.states?.[progressMode];\r\n    const pendingModifiedCount = modeState?.modifiedCells?.size ?? this.state.modifiedCells.size;\r\n\r\n    // Update assignmentMap with saved values\r\n    this._updateAssignmentMap();\r\n\r\n    // Clear modified cells\r\n    this.state.modifiedCells.clear();\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n\r\n    // Update UI status\r\n    if (this.state.cache) {\r\n      this.state.cache.hasUnsavedChanges = false;\r\n    }\r\n\r\n    // Show success message\r\n    const apiSavedTotal = (Number(result.created_count) || 0) + (Number(result.updated_count) || 0);\r\n    const fallbackSaved = Number(result.saved_count) || Number(result.count) || pendingModifiedCount;\r\n    const savedCount = apiSavedTotal > 0 ? apiSavedTotal : fallbackSaved;\r\n    const modeLabel = progressMode === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    const message = `Berhasil menyimpan ${savedCount} perubahan (${modeLabel})`;\r\n    this.showToast(message, 'success');\r\n    this.showToast(message, 'success');\r\n\r\n    // Call success callback\r\n    if (typeof this.onSuccess === 'function') {\r\n      this.onSuccess(result);\r\n    }\r\n\r\n    console.log(`[SaveHandler] Saved ${savedCount} assignments, cleared ${pendingModifiedCount} modified cells`);\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _handleSaveError(error) {\r\n    console.error('[SaveHandler] ❌ Save failed:', error);\r\n\r\n    const detailMessages = [];\r\n    if (Array.isArray(error.validationErrors) && error.validationErrors.length > 0) {\r\n      error.validationErrors.slice(0, 3).forEach((item) => {\r\n        if (item?.error) {\r\n          detailMessages.push(`• ${item.error}`);\r\n        }\r\n      });\r\n      if (error.validationErrors.length > 3) {\r\n        detailMessages.push(`(+${error.validationErrors.length - 3} lagi)`);\r\n      }\r\n    }\r\n\r\n    if (Array.isArray(error.details) && error.details.length > 0) {\r\n      error.details.slice(0, 3).forEach((item) => {\r\n        if (item?.error) {\r\n          detailMessages.push(`• ${item.error}`);\r\n        }\r\n      });\r\n      if (error.details.length > 3) {\r\n        detailMessages.push(`(+${error.details.length - 3} lagi)`);\r\n      }\r\n    }\r\n\r\n    let message = `Gagal menyimpan: ${error.message}`;\r\n    if (detailMessages.length > 0) {\r\n      message += `\\n${detailMessages.join('\\n')}`;\r\n    }\r\n    this.showToast(message, 'danger', 5000);\r\n\r\n    // Call error callback\r\n    if (typeof this.onError === 'function') {\r\n      this.onError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   * @private\r\n   */\r\n  _getCurrentModeState() {\r\n    // Phase 2E.1: Support dual state architecture\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    return progressMode === 'actual'\r\n      ? this.state.actualState\r\n      : this.state.plannedState;\r\n  }\r\n\r\n  /**\r\n   * Update assignmentMap with modified values\r\n   * Phase 0.3: Delegate to StateManager.commitChanges()\r\n   * @private\r\n   */\r\n  _updateAssignmentMap() {\r\n    // Phase 0.3: StateManager handles moving modifiedCells → assignmentMap\r\n    this.stateManager.commitChanges();\r\n\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const stats = this.stateManager.states[progressMode].getStats();\r\n    console.log(`[SaveHandler] Phase 0.3: StateManager committed changes for ${progressMode.toUpperCase()}`);\r\n    console.log(`[SaveHandler] New state: ${stats.assignmentCount} assignments, ${stats.modifiedCount} modified`);\r\n  }\r\n\r\n  _hasCostChanges() {\r\n    const progressMode = this.state?.progressMode || 'planned';\r\n    if (progressMode !== 'actual') {\r\n      return false;\r\n    }\r\n    const costMap = this.state.costModifiedCells;\r\n    return costMap instanceof Map ? costMap.size > 0 : false;\r\n  }\r\n\r\n  _getSavedValue(cellKey) {\r\n    const assignmentMap = this.state.assignmentMap;\r\n    if (!assignmentMap) {\r\n      return 0;\r\n    }\r\n    if (assignmentMap instanceof Map) {\r\n      return Number(assignmentMap.get(cellKey)) || 0;\r\n    }\r\n    if (typeof assignmentMap === 'object' && assignmentMap !== null) {\r\n      return Number(assignmentMap[cellKey]) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  // =======================================================================\r\n  // UTILITY METHODS\r\n  // =======================================================================\r\n\r\n  /**\r\n   * Check if there are unsaved changes\r\n   * Phase 0.3: Delegate to StateManager\r\n   * @returns {boolean} True if has unsaved changes\r\n   */\r\n  hasUnsavedChanges() {\r\n    return this.stateManager.hasUnsavedChanges();\r\n  }\r\n\r\n  /**\r\n   * Get count of modified cells\r\n   * Phase 0.3: Delegate to StateManager\r\n   * @returns {number} Number of modified cells\r\n   */\r\n  getModifiedCount() {\r\n    const mode = this.state.progressMode || 'planned';\r\n    return this.stateManager.states[mode].modifiedCells.size;\r\n  }\r\n\r\n  /**\r\n   * Validate payload before sending\r\n   * @param {Object} payload - Payload to validate\r\n   * @returns {Object} Validation result\r\n   */\r\n  validatePayload(payload) {\r\n    const errors = [];\r\n    const warnings = [];\r\n\r\n    const assignments = Array.isArray(payload?.assignments)\r\n      ? payload.assignments\r\n      : Array.isArray(payload?.items)\r\n        ? payload.items\r\n        : null;\r\n\r\n    if (!assignments) {\r\n      errors.push('Invalid payload structure');\r\n      return { isValid: false, errors, warnings };\r\n    }\r\n\r\n    if (assignments.length === 0) {\r\n      warnings.push('No items to save');\r\n    }\r\n\r\n    // Validate each item\r\n    assignments.forEach((item, index) => {\r\n      if (!item.pekerjaan_id) {\r\n        errors.push(`Item ${index}: Missing pekerjaan_id`);\r\n      }\r\n      if (!item.week_number) {\r\n        warnings.push(`Item ${index}: Missing week_number (akan memakai default)`);\r\n      }\r\n      if (typeof item.proportion === 'undefined') {\r\n        errors.push(`Item ${index}: Missing proportion value`);\r\n      } else if (!Number.isFinite(item.proportion)) {\r\n        errors.push(`Item ${index}: Invalid proportion value`);\r\n      } else if (item.proportion < 0 || item.proportion > 100) {\r\n        warnings.push(`Item ${index}: Proportion out of range (${item.proportion}%)`);\r\n      }\r\n    });\r\n\r\n    const isValid = errors.length === 0;\r\n\r\n    if (!isValid) {\r\n      console.error('[SaveHandler] Payload validation failed:', errors);\r\n    }\r\n\r\n    if (warnings.length > 0) {\r\n      console.warn('[SaveHandler] Payload validation warnings:', warnings);\r\n    }\r\n\r\n    return { isValid, errors, warnings };\r\n  }\r\n\r\n  /**\r\n   * Cancel save operation\r\n   */\r\n  cancel() {\r\n    if (this.isSaving) {\r\n      console.log('[SaveHandler] Cancelling save operation...');\r\n      this.isSaving = false;\r\n      // Note: Cannot actually abort fetch request without AbortController\r\n      // This just sets the flag\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get save statistics\r\n   * @returns {Object} Save statistics\r\n   */\r\n  getStats() {\r\n    return {\r\n      modifiedCells: this.getModifiedCount(),\r\n      isSaving: this.isSaving,\r\n      hasUnsavedChanges: this.hasUnsavedChanges(),\r\n      apiUrl: this.apiUrl\r\n    };\r\n  }\r\n}\r\n\r\n// Export utility functions\r\nexport {\r\n  getCookie\r\n};\r\n"],"names":["ModeState","constructor","this","assignmentMap","Map","modifiedCells","costAssignmentMap","costModifiedCells","isDirty","toJSON","Array","from","entries","fromJSON","data","state","isArray","getStats","assignmentCount","size","modifiedCount","costAssignmentCount","costModifiedCount","hasUnsavedChanges","clear","clone","cloned","LOG_PREFIX","_StateManager","getInstance","instance","console","log","Error","currentMode","states","planned","actual","_mergedCellsCache","_listeners","Set","getCellValue","pekerjaanId","columnId","_a","_b","_getCurrentState","cellKey","get","getAllCellsForMode","mode","modeState","error","cacheKey","has","merged","forEach","value","key","set","toUpperCase","setCellValue","numericValue","parseFloat","Number","isNaN","warn","_invalidateCache","switchMode","newMode","oldMode","_notifyListeners","type","commitChanges","delete","numeric","isFinite","count","loadData","dataMap","costDataMap","setInitialValue","plannedValue","actualValue","options","hasCostProp","Object","prototype","hasOwnProperty","call","actualCost","cost","actual_cost","addEventListener","callback","add","removeEventListener","cacheSize","listenerCount","event","listener","reset","exportState","stats","StateManager","apiCall","_0","__async","arguments","url","method","includes","headers","name","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","getCookie","response","fetch","__spreadValues","credentials","ok","json","catch","status","flattenTree","tree","result","node","push","children","window","DataLoader","projectId","stateManager","volumeMap","cache","loadAllData","initialLoadInProgress","info","force","initialLoadCompleted","skipIfLoaded","initialLoadResult","Promise","all","loadTahapan","loadPekerjaan","loadVolumes","loadAssignments","completedAt","Date","now","tahapanCount","tahapanList","pekerjaanCount","flatPekerjaan","filter","initialLoadError","apiBase","tahapan","sort","a","b","urutan","detectedMode","fallbackMode","autoCounts","daily","weekly","monthly","autoTotal","manualCount","tahap","is_auto_generated","generation_mode","toLowerCase","dominantMode","reduce","bestMode","entry","deriveTimeScaleFromTahapan","timeScale","klasifikasi","klas","klasNode","id","nama","level","expanded","klasifikasiId","klasifikasiName","klasifikasiKode","kode","sub","subNode","subKlasifikasiId","subKlasifikasiName","subKlasifikasiKode","pekerjaan","pkj","pkjNode","pekerjaan_id","snapshot_kode","snapshot_uraian","uraian","volume","satuan","snapshot_satuan","budgeted_cost","total_cost","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","buildPekerjaanTree","pekerjaanTree","expandedNodes","collectIds","nodes","initialiseExpandedNodes","volumes","items","v","pkjId","qty","quantity","pekerjaanNodes","_loadAssignmentsViaV2","reload","loader","assignments","_buildWeekColumnIndex","weekColumnIndex","timeColumns","col","weekNumber","week_number","mapped","item","plannedProportion","planned_proportion","actualProportion","actual_proportion","rawCost","column","columnKey","fieldId","formatDayMonth","date","getTime","getDate","toString","padStart","getMonth","TimeColumnGenerator","generate","_projectStartCache","_jsWeekEndDayCache","index","shouldInclude","_createColumn","startDate","tanggal_mulai","endDate","tanggal_selesai","label","rangeLabel","rangeText","tooltip","shortStart","shortEnd","resolvedOrder","isInteger","isWeeklyMode","projectStartDate","_getProjectStartDate","jsWeekEndDay","_getJsWeekEndDay","computedWeekNumber","targetDate","projectStart","resolvedWeekEnd","weekEndDay","firstWeekEnd","offsetToEnd","getDay","setDate","daysAfterFirst","Math","floor","getWeekNumberForDate","toLocaleDateString","weekday","day","month","year","safeTahapanId","tahapan_id","tahapanId","isAutoGenerated","generationMode","getColumnById","find","getColumnByTahapanId","getColumnsInRange","regenerate","raw","parsed","pyWeekEnd","normalizedPy","SaveHandler","apiUrl","onSuccess","onError","err","showToast","msg","isSaving","save","_c","_d","success","reason","hasCostChanges","_hasCostChanges","payload","_buildPayload","payloadCount","_sendToServer","_handleSaveSuccess","_handleSaveError","progressMode","cellsToSave","_","proportion","_getSavedValue","parseInt","toFixed","tahapanPrimaryId","week_start","_formatDate","week_end","normalizedOrder","order","numericTahapan","fallbackWeek","costValue","project_id","week_end_day","JSON","stringify","toISOString","csrfToken","body","errorData","parsedBody","jsonError","message","text","errorMsg","errors","details","validation_errors","validationErrors","_e","pendingModifiedCount","_updateAssignmentMap","cellVolumeOverrides","apiSavedTotal","created_count","updated_count","fallbackSaved","saved_count","savedCount","detailMessages","slice","join","_getCurrentModeState","actualState","plannedState","costMap","getModifiedCount","validatePayload","warnings","isValid","cancel"],"mappings":"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"}