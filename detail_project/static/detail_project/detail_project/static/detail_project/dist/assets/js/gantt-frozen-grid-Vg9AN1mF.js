var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;import{T as i}from"./jadwal-kegiatan-BbGjCNf_.js";import"./vendor-export-CxtsESY6.js";import"./grid-modules-B7d76Eao.js";import"./vendor-ag-grid-CNpf5Dvm.js";import"./core-modules-0szNTacm.js";class r{constructor(e,i={}){if(this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error("Gantt container not found");this.options=((e,i)=>{for(var r in i||(i={}))n.call(i,r)&&o(e,r,i[r]);if(t)for(var r of t(i))a.call(i,r)&&o(e,r,i[r]);return e})({rowHeight:i.rowHeight||40,frozenColumnWidth:280,volumeColumnWidth:70,satuanColumnWidth:70,timelineColumnWidth:100,timeScale:i.timeScale||"week"},i),this.state={rows:[],timelineColumns:[],scrollTop:0,scrollLeft:0,initialized:!1,expandedNodes:new Map},this.elements={gridContainer:null},this.themeObserver=null,this.pekerjaan=[],this.timeColumns=[]}initialize(e){return t=this,n=null,a=function*(){var t,n,a,o,r;console.log("ðŸš€ Initializing Gantt Frozen Grid V2 (Phase 2: Real Data)...");try{this.app=e,this.stateManager=e.stateManager,this.timeColumnGenerator=e.timeColumnGenerator,console.log("[GanttV2] App references:",{hasStateManager:!!this.stateManager,hasTimeColumnGenerator:!!this.timeColumnGenerator,hasFlatPekerjaan:!!(null==(t=e.state)?void 0:t.flatPekerjaan)});const s=e.state.flatPekerjaan||[],l=(null==(a=null==(n=this.timeColumnGenerator)?void 0:n.state)?void 0:a.timeColumns)||(null==(o=e.state)?void 0:o.timeColumns)||[];if(console.log("[GanttV2] Data loaded:",{pekerjaanCount:s.length,timeColumnsCount:l.length,timeScale:(null==(r=e.state)?void 0:r.timeScale)||"unknown"}),!(l.length>0)){console.warn("[GanttV2] âš ï¸ NO TIME COLUMNS! TimeColumnGenerator might not be initialized."),console.log("[GanttV2] TimeColumnGenerator object:",this.timeColumnGenerator),console.warn("[GanttV2] Falling back to DEMO mode with hardcoded 20 weeks...");const e=this._generateDemoTimeColumns(20);return this._buildDOM(e.length),this._renderRealData(s,e),this.state.initialized=!0,console.log("âœ… Gantt Frozen Grid V2 initialized (DEMO MODE - no TimeColumnGenerator)"),void i.success("ðŸ“Š Gantt Chart loaded (Demo Mode)",2e3)}{console.log("[GanttV2] First 3 columns:",l.slice(0,3)),console.log("[GanttV2] First 3 column IDs:",l.slice(0,3).map(e=>e.id)),console.log("[GanttV2] Last 3 columns:",l.slice(-3)),console.log("[GanttV2] Last 3 column IDs:",l.slice(-3).map(e=>e.id));const e=l[0];console.log("[GanttV2] First column structure:",{id:e.id,tahapanId:e.tahapanId,label:e.label})}s.length>0&&(console.log("[GanttV2] First pekerjaan:",s[0]),console.log("[GanttV2] Pekerjaan types:",s.slice(0,5).map(e=>{var t;return{id:e.id,type:e.type,level:e.level,nama:null==(t=e.nama)?void 0:t.substring(0,30)}}))),this.pekerjaan=s,this.timeColumns=l,this._initializeExpandState(s),this._buildDOM(l.length),this._renderRealData(s,l),this._setupThemeObserver(s,l),this.state.initialized=!0,console.log("âœ… Gantt Frozen Grid V2 initialized successfully"),i.success("ðŸ“Š Gantt Chart loaded",2e3)}catch(s){throw console.error("âŒ Failed to initialize Gantt Frozen Grid:",s),s}},new Promise((e,o)=>{var i=e=>{try{s(a.next(e))}catch(t){o(t)}},r=e=>{try{s(a.throw(e))}catch(t){o(t)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,r);s((a=a.apply(t,n)).next())});var t,n,a}_buildDOM(e){this.container.innerHTML="",this.container.className="gantt-frozen-container";const t=document.documentElement.getAttribute("data-bs-theme"),n="dark"===t;console.log("[GanttV2] Theme detection:",{"data-bs-theme":t,isDarkMode:n,hasTimeColumns:e});const a=n?"#1e1e1e":"#ffffff",o=n?"#404040":"#dee2e6",i=document.createElement("div");i.className="gantt-grid",i.style.cssText=`\n      display: grid;\n      grid-template-columns: 280px 70px 70px repeat(${e}, 100px);\n      overflow: auto;\n      height: 600px;\n      background: ${a};\n      border: 1px solid ${o};\n    `,this.container.appendChild(i),this.elements.gridContainer=i,this.isDarkMode=n,this.borderColor=o}_renderRealData(e,t){this._renderHeaders(t),this._renderDataRows(e,t)}_renderHeaders(e){const t=this.isDarkMode?"#2d2d2d":"var(--bs-light, #f8f9fa)",n=this.isDarkMode?"#e0e0e0":"#212529";[{label:"Pekerjaan",width:"280px"},{label:"Volume",width:"70px"},{label:"Satuan",width:"70px"}].forEach((e,a)=>{const o=document.createElement("div");o.className="gantt-header-cell frozen",o.style.cssText=`\n        position: sticky;\n        left: ${this._calculateStickyLeft(a)}px;\n        top: 0;\n        z-index: 20;\n        background: ${t};\n        color: ${n};\n        font-weight: 600;\n        padding: 0.75rem 1rem;\n        border-bottom: 2px solid ${this.borderColor};\n        border-right: ${2===a?"2px":"1px"} solid ${this.borderColor};\n        display: flex;\n        align-items: center;\n      `,o.textContent=e.label,this.elements.gridContainer.appendChild(o)}),e.forEach((e,a)=>{const o=document.createElement("div");o.className="gantt-header-cell timeline",o.style.cssText=`\n        position: sticky;\n        top: 0;\n        z-index: 10;\n        background: ${t};\n        color: ${n};\n        font-weight: 600;\n        padding: 0.75rem 0.5rem;\n        border-bottom: 2px solid ${this.borderColor};\n        border-right: 1px solid ${this.isDarkMode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"};\n        text-align: center;\n        font-size: 0.875rem;\n      `,o.textContent=e.label||e.id,this.elements.gridContainer.appendChild(o)}),console.log(`[GanttV2] Rendered ${e.length} timeline headers`)}_renderDataRows(e,t){if(!e||0===e.length)return void console.warn("[GanttV2] No pekerjaan data to render");const n=this._getVisibleRows(e);console.log(`[GanttV2] Rendering ${n.length}/${e.length} visible rows`),n.forEach(e=>{const n=e.level||0,a=e.children&&e.children.length>0;this._createFrozenCell(e.nama||e.name||"Unknown",0,n,"left",e,a),this._createFrozenCell(e.volume||0,1,0,"right"),this._createFrozenCell(e.satuan||"-",2,0,"center"),this._renderTimelineCells(e,t)}),console.log(`âœ… Rendered ${n.length} rows`)}_createFrozenCell(e,t,n=0,a="left",o=null,i=!1){const r=document.createElement("div");r.className="gantt-cell frozen";const s=this._calculateStickyLeft(t),l=0===t?.5+1.5*n+"rem":"0.5rem",d=this.isDarkMode?"#1e1e1e":"white",c=this.isDarkMode?"#e0e0e0":"#212529";if(r.style.cssText=`\n      position: sticky;\n      left: ${s}px;\n      z-index: 5;\n      background: ${d};\n      color: ${c};\n      padding: 0.5rem;\n      padding-left: ${l};\n      border-bottom: 1px solid ${this.borderColor};\n      border-right: ${2===t?"2px":"1px"} solid ${this.borderColor};\n      display: flex;\n      align-items: center;\n      justify-content: ${"right"===a?"flex-end":"center"===a?"center":"flex-start"};\n      font-size: 0.875rem;\n      height: ${this.options.rowHeight}px;\n      box-sizing: border-box;\n      ${0===t?"\n        overflow: hidden;\n        text-overflow: ellipsis;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        line-height: 1.4;\n        max-height: calc(1.4em * 2);\n      ":""}\n    `,0===t&&i&&o){const e=!1!==this.state.expandedNodes.get(o.id),t=document.createElement("span");t.className="gantt-toggle",t.textContent=e?"â–¼":"â–¶",t.style.cssText=`\n        margin-right: 0.5rem;\n        cursor: pointer;\n        user-select: none;\n        font-size: 0.75rem;\n        color: ${this.isDarkMode?"#9ca3af":"#6b7280"};\n        transition: transform 0.2s ease;\n      `,t.addEventListener("click",e=>{e.stopPropagation(),this._toggleNodeExpand(o.id)}),r.appendChild(t)}const h=document.createElement("span");return h.textContent=e,0!==t||i||(h.style.marginLeft=i?"0":"1.25rem"),r.appendChild(h),this.elements.gridContainer.appendChild(r),r}_renderTimelineCells(e,t){var n;const a=this.stateManager.getAllCellsForMode("planned"),o=this.stateManager.getAllCellsForMode("actual"),i=this._extractAssignmentsForPekerjaan(e.id,a,t),r=this._extractAssignmentsForPekerjaan(e.id,o,t);if("pekerjaan"===e.type&&(console.log(`[GanttV2] Row ${e.id} (${null==(n=e.nama)?void 0:n.substring(0,30)}) assignments:`,{planned:i.length,actual:r.length,plannedSample:i.slice(0,3),actualSample:r.slice(0,3),plannedCellsTotal:a.size,actualCellsTotal:o.size}),a.size>0)){const e=Array.from(a.keys()).slice(0,5);console.log("[GanttV2] Sample planned cell keys:",e)}const s=this._getBarRange(i,t),l=this._getBarRange(r,t);t.forEach((e,n)=>{const a=this._createTimelineCell(n);s&&n>=s.startIndex&&n<=s.endIndex&&this._addContinuousBarSegment(a,"planned",n,s,i,t),l&&n>=l.startIndex&&n<=l.endIndex&&this._addContinuousBarSegment(a,"actual",n,l,r,t),this.elements.gridContainer.appendChild(a)})}_extractAssignmentsForPekerjaan(e,t,n){const a=[],o=String(e);let i=!1;return t.forEach((t,r)=>{const[s,l]=r.split("-");if(s===o&&t>0){const o=parseInt(l.replace("col_",""));i||(console.log(`[GanttV2] First match for pekerjaan ${e}:`,{cellKey:r,columnId:l,tahapanId:o,value:t,timeColumnsHasId:n.some(e=>e.tahapanId===o)}),i=!0),a.push({tahapan_id:o,volume:t})}}),a}_getBarRange(e,t){if(!e||0===e.length)return null;let n=1/0,a=-1;return e.forEach(e=>{const o=t.findIndex(t=>t.tahapanId===e.tahapan_id);-1!==o&&(n=Math.min(n,o),a=Math.max(a,o))}),n===1/0?null:{startIndex:n,endIndex:a}}_addContinuousBarSegment(e,t,n,a,o,i){const r=n===a.startIndex,s=n===a.endIndex,l=r&&s,d=i[n],c=o.find(e=>d&&e.tahapan_id===d.tahapanId),h=(null==c?void 0:c.volume)||0,m="planned"===t?{bg:this.isDarkMode?"rgba(66, 153, 225, 0.5)":"rgba(13, 110, 253, 0.5)",border:this.isDarkMode?"#4299e1":"#0d6efd",progress:this.isDarkMode?"#2c5282":"#084298"}:{bg:this.isDarkMode?"rgba(237, 137, 54, 0.9)":"rgba(253, 126, 20, 0.9)",border:this.isDarkMode?"#ed8936":"#dc6d08",progress:this.isDarkMode?"#9c4221":"#b34d00"},p=document.createElement("div");if(p.className=`gantt-bar-continuous ${t}`,p.style.cssText=`\n      position: absolute;\n      top: ${"planned"===t?"25%":"50%"};\n      left: 0;\n      width: 100%;\n      height: 20px;\n      transform: translateY(-50%);\n      background: ${m.bg};\n      border-top: 2px solid ${m.border};\n      border-bottom: 2px solid ${m.border};\n      ${r||l?`border-left: 2px solid ${m.border}; border-top-left-radius: 4px; border-bottom-left-radius: 4px;`:""}\n      ${s||l?`border-right: 2px solid ${m.border}; border-top-right-radius: 4px; border-bottom-right-radius: 4px;`:""}\n      z-index: ${"actual"===t?"3":"2"};\n      overflow: hidden;\n    `,h>0){const e=document.createElement("div");e.className="gantt-bar-progress",e.style.cssText=`\n        position: absolute;\n        left: 0;\n        top: 0;\n        height: 100%;\n        width: ${Math.min(h,100)}%;\n        background: ${m.progress};\n        opacity: 0.6;\n      `,p.appendChild(e)}e.appendChild(p)}_createTimelineCell(e){const t=document.createElement("div");t.className="gantt-cell timeline",t.dataset.colIndex=e;const n=this.isDarkMode?"#1e1e1e":"white";return t.style.cssText=`\n      position: relative;\n      border-bottom: 1px solid ${this.borderColor};\n      border-right: 1px solid ${this.isDarkMode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"};\n      background: ${n};\n      height: ${this.options.rowHeight}px;\n      box-sizing: border-box;\n    `,t}_calculateStickyLeft(e){return[0,280,350][e]||0}_generateDemoTimeColumns(e){const t=[];for(let n=0;n<e;n++)t.push({id:1e3+n,label:`W${n+1}`,startDate:new Date(2025,0,1+7*n),endDate:new Date(2025,0,8+7*n)});return t}_initializeExpandState(e){e.forEach(e=>{e.children&&e.children.length>0&&this.state.expandedNodes.set(e.id,!0)}),console.log(`[GanttV2] Initialized expand state for ${this.state.expandedNodes.size} parent nodes`)}_getVisibleRows(e){const t=[],n=new Set;return e.forEach(e=>{const a=e.parent_id||e.parentId;if(a&&n.has(a))return void n.add(e.id);t.push(e);!1===this.state.expandedNodes.get(e.id)&&n.add(e.id)}),t}_toggleNodeExpand(e){const t=!this.state.expandedNodes.get(e);this.state.expandedNodes.set(e,t),console.log(`[GanttV2] Node ${e} ${t?"expanded":"collapsed"}`),this._buildDOM(this.timeColumns.length),this._renderRealData(this.pekerjaan,this.timeColumns)}_setupThemeObserver(e,t){this.themeObserver&&this.themeObserver.disconnect(),this.themeObserver=new MutationObserver(n=>{n.forEach(n=>{if("attributes"===n.type&&"data-bs-theme"===n.attributeName){const n=document.documentElement.getAttribute("data-bs-theme");console.log("[GanttV2] Theme changed to:",n),this._buildDOM(t.length),this._renderRealData(e,t),i.info(`ðŸŽ¨ Gantt theme updated: ${n}`,1500)}})}),this.themeObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),console.log("[GanttV2] Theme observer setup complete")}destroy(){this.themeObserver&&(this.themeObserver.disconnect(),this.themeObserver=null),this.container&&(this.container.innerHTML=""),this.state.initialized=!1,console.log("Gantt Frozen Grid destroyed")}}export{r as GanttFrozenGrid};
//# sourceMappingURL=gantt-frozen-grid-Vg9AN1mF.js.map
