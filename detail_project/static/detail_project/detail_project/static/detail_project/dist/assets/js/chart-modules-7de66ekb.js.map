{"version":3,"file":"chart-modules-7de66ekb.js","sources":["../../../../../../js/src/modules/shared/ux-enhancements.js","../../../../../../../../../node_modules/uplot/dist/uPlot.esm.js","../../../../../../js/src/modules/shared/chart-utils.js","../../../../../../js/src/modules/kurva-s/week-zero-helpers.js","../../../../../../js/src/modules/kurva-s/dataset-builder.js","../../../../../../js/src/modules/kurva-s/uplot-chart.js"],"sourcesContent":["/**\r\n * UX Enhancements Module\r\n * Provides keyboard shortcuts, ripple effects, and other UX improvements\r\n * @module ux-enhancements\r\n */\r\n\r\n/**\r\n * Keyboard Shortcuts Manager\r\n */\r\nexport class KeyboardShortcuts {\r\n  constructor() {\r\n    this.shortcuts = new Map();\r\n    this.enabled = true;\r\n    this._boundHandler = this._handleKeyDown.bind(this);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    document.addEventListener('keydown', this._boundHandler);\r\n    console.log('âŒ¨ï¸ Keyboard shortcuts initialized');\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * @param {string} key - Key combination (e.g., 'ctrl+s', 'alt+p')\r\n   * @param {Function} callback - Function to call when shortcut triggered\r\n   * @param {Object} options - Additional options\r\n   */\r\n  register(key, callback, options = {}) {\r\n    const { description = '', preventDefault = true } = options;\r\n\r\n    this.shortcuts.set(key.toLowerCase(), {\r\n      callback,\r\n      description,\r\n      preventDefault\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unregister a keyboard shortcut\r\n   */\r\n  unregister(key) {\r\n    this.shortcuts.delete(key.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  _handleKeyDown(event) {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input/textarea\r\n    const activeElement = document.activeElement;\r\n    const isInput = activeElement.tagName === 'INPUT' ||\r\n                   activeElement.tagName === 'TEXTAREA' ||\r\n                   activeElement.isContentEditable;\r\n\r\n    // Build key combination string\r\n    const parts = [];\r\n    if (event.ctrlKey) parts.push('ctrl');\r\n    if (event.altKey) parts.push('alt');\r\n    if (event.shiftKey) parts.push('shift');\r\n    if (event.metaKey) parts.push('meta');\r\n\r\n    const key = event.key.toLowerCase();\r\n    if (!['control', 'alt', 'shift', 'meta'].includes(key)) {\r\n      parts.push(key);\r\n    }\r\n\r\n    const combo = parts.join('+');\r\n    const shortcut = this.shortcuts.get(combo);\r\n\r\n    if (shortcut) {\r\n      // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X in inputs\r\n      const allowedInInput = ['ctrl+a', 'ctrl+c', 'ctrl+v', 'ctrl+x', 'ctrl+z'];\r\n      if (isInput && !allowedInInput.includes(combo)) {\r\n        return;\r\n      }\r\n\r\n      if (shortcut.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      shortcut.callback(event);\r\n      console.log(`âŒ¨ï¸ Shortcut triggered: ${combo}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable shortcuts\r\n   */\r\n  enable() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * Disable shortcuts\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getShortcuts() {\r\n    return Array.from(this.shortcuts.entries()).map(([key, data]) => ({\r\n      key,\r\n      description: data.description\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    document.removeEventListener('keydown', this._boundHandler);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n/**\r\n * Ripple Effect Manager\r\n */\r\nexport class RippleEffect {\r\n  /**\r\n   * Add ripple effect to element\r\n   * @param {HTMLElement} element - Target element\r\n   */\r\n  static add(element) {\r\n    if (!element) return;\r\n\r\n    element.classList.add('btn-ripple');\r\n\r\n    // Optional: Add click listener for more control\r\n    element.addEventListener('click', function(e) {\r\n      const ripple = document.createElement('span');\r\n      ripple.classList.add('ripple-circle');\r\n\r\n      const rect = this.getBoundingClientRect();\r\n      const size = Math.max(rect.width, rect.height);\r\n      const x = e.clientX - rect.left - size / 2;\r\n      const y = e.clientY - rect.top - size / 2;\r\n\r\n      ripple.style.width = ripple.style.height = size + 'px';\r\n      ripple.style.left = x + 'px';\r\n      ripple.style.top = y + 'px';\r\n\r\n      this.appendChild(ripple);\r\n\r\n      setTimeout(() => ripple.remove(), 600);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add ripple to multiple elements\r\n   * @param {string} selector - CSS selector\r\n   */\r\n  static addToAll(selector) {\r\n    document.querySelectorAll(selector).forEach(el => {\r\n      RippleEffect.add(el);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Button State Manager\r\n */\r\nexport class ButtonStateManager {\r\n  /**\r\n   * Set button to loading state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {string} loadingText - Optional loading text\r\n   */\r\n  static setLoading(button, loadingText = 'Loading...') {\r\n    if (!button) return;\r\n\r\n    button.dataset.originalText = button.innerHTML;\r\n    button.disabled = true;\r\n    button.classList.add('loading');\r\n\r\n    const spinner = '<span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>';\r\n    button.innerHTML = spinner + loadingText;\r\n  }\r\n\r\n  /**\r\n   * Set button to success state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show success state (ms)\r\n   */\r\n  static setSuccess(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('success');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('success');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Set button to error state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show error state (ms)\r\n   */\r\n  static setError(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('error');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Reset button to normal state\r\n   * @param {HTMLElement} button - Button element\r\n   */\r\n  static reset(button) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading', 'success', 'error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark button with \"has changes\" indicator\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} hasChanges - Whether there are unsaved changes\r\n   */\r\n  static markChanges(button, hasChanges) {\r\n    if (!button) return;\r\n\r\n    if (hasChanges) {\r\n      button.classList.add('has-changes');\r\n      button.setAttribute('data-tooltip', 'You have unsaved changes');\r\n    } else {\r\n      button.classList.remove('has-changes');\r\n      button.removeAttribute('data-tooltip');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toast Notifications (wrapper untuk DP.core.toast)\r\n */\r\nexport class Toast {\r\n  /**\r\n   * Show success toast\r\n   */\r\n  static success(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'success', duration);\r\n    } else {\r\n      console.log(`âœ… ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error toast\r\n   */\r\n  static error(message, duration = 3000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'danger', duration);\r\n    } else {\r\n      console.error(`âŒ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show warning toast\r\n   */\r\n  static warning(message, duration = 2000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'warning', duration);\r\n    } else {\r\n      console.warn(`âš ï¸ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show info toast\r\n   */\r\n  static info(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'info', duration);\r\n    } else {\r\n      console.info(`â„¹ï¸ ${message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Smooth Scroll Helper\r\n */\r\nexport class SmoothScroll {\r\n  /**\r\n   * Scroll to element smoothly\r\n   * @param {HTMLElement|string} target - Element or selector\r\n   * @param {Object} options - Scroll options\r\n   */\r\n  static to(target, options = {}) {\r\n    const element = typeof target === 'string'\r\n      ? document.querySelector(target)\r\n      : target;\r\n\r\n    if (!element) return;\r\n\r\n    const {\r\n      offset = 0,\r\n      behavior = 'smooth',\r\n      block = 'start'\r\n    } = options;\r\n\r\n    const elementPosition = element.getBoundingClientRect().top;\r\n    const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n    window.scrollTo({\r\n      top: offsetPosition,\r\n      behavior\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Scroll to top\r\n   */\r\n  static toTop() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      behavior: 'smooth'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce utility\r\n */\r\nexport function debounce(func, wait = 300) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle utility\r\n */\r\nexport function throttle(func, limit = 100) {\r\n  let inThrottle;\r\n  return function executedFunction(...args) {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize all UX enhancements\r\n */\r\nexport function initializeUXEnhancements() {\r\n  console.log('ðŸŽ¨ Initializing UX enhancements...');\r\n\r\n  // Add ripple effects to all primary buttons\r\n  RippleEffect.addToAll('.btn-primary, .btn-save, .btn-danger');\r\n\r\n  // Add tooltips to buttons with title attribute\r\n  document.querySelectorAll('button[title]').forEach(btn => {\r\n    if (!btn.hasAttribute('data-tooltip')) {\r\n      btn.setAttribute('data-tooltip', btn.getAttribute('title'));\r\n    }\r\n  });\r\n\r\n  console.log('âœ… UX enhancements initialized');\r\n}\r\n\r\n/**\r\n * Default export\r\n */\r\nexport default {\r\n  KeyboardShortcuts,\r\n  RippleEffect,\r\n  ButtonStateManager,\r\n  Toast,\r\n  SmoothScroll,\r\n  debounce,\r\n  throttle,\r\n  initializeUXEnhancements\r\n};\r\n","/**\n* Copyright (c) 2025, Leon Sorokin\n* All rights reserved. (MIT Licensed)\n*\n* uPlot.js (Î¼Plot)\n* A small, fast chart for time series, lines, areas, ohlc & bars\n* https://github.com/leeoniya/uPlot (v1.6.32)\n*/\n\nconst FEAT_TIME          = true;\n\nconst pre = \"u-\";\n\nconst UPLOT          =       \"uplot\";\nconst ORI_HZ         = pre + \"hz\";\nconst ORI_VT         = pre + \"vt\";\nconst TITLE          = pre + \"title\";\nconst WRAP           = pre + \"wrap\";\nconst UNDER          = pre + \"under\";\nconst OVER           = pre + \"over\";\nconst AXIS           = pre + \"axis\";\nconst OFF            = pre + \"off\";\nconst SELECT         = pre + \"select\";\nconst CURSOR_X       = pre + \"cursor-x\";\nconst CURSOR_Y       = pre + \"cursor-y\";\nconst CURSOR_PT      = pre + \"cursor-pt\";\nconst LEGEND         = pre + \"legend\";\nconst LEGEND_LIVE    = pre + \"live\";\nconst LEGEND_INLINE  = pre + \"inline\";\nconst LEGEND_SERIES  = pre + \"series\";\nconst LEGEND_MARKER  = pre + \"marker\";\nconst LEGEND_LABEL   = pre + \"label\";\nconst LEGEND_VALUE   = pre + \"value\";\n\nconst WIDTH       = \"width\";\nconst HEIGHT      = \"height\";\nconst TOP         = \"top\";\nconst BOTTOM      = \"bottom\";\nconst LEFT        = \"left\";\nconst RIGHT       = \"right\";\nconst hexBlack    = \"#000\";\nconst transparent = hexBlack + \"0\";\n\nconst mousemove   = \"mousemove\";\nconst mousedown   = \"mousedown\";\nconst mouseup     = \"mouseup\";\nconst mouseenter  = \"mouseenter\";\nconst mouseleave  = \"mouseleave\";\nconst dblclick    = \"dblclick\";\nconst resize      = \"resize\";\nconst scroll      = \"scroll\";\n\nconst change      = \"change\";\nconst dppxchange  = \"dppxchange\";\n\nconst LEGEND_DISP = \"--\";\n\nconst domEnv = typeof window != 'undefined';\n\nconst doc = domEnv ? document  : null;\nconst win = domEnv ? window    : null;\nconst nav = domEnv ? navigator : null;\n\nlet pxRatio;\n\n//export const canHover = domEnv && !win.matchMedia('(hover: none)').matches;\n\nlet query;\n\nfunction setPxRatio() {\n\tlet _pxRatio = devicePixelRatio;\n\n\t// during print preview, Chrome fires off these dppx queries even without changes\n\tif (pxRatio != _pxRatio) {\n\t\tpxRatio = _pxRatio;\n\n\t\tquery && off(change, query, setPxRatio);\n\t\tquery = matchMedia(`(min-resolution: ${pxRatio - 0.001}dppx) and (max-resolution: ${pxRatio + 0.001}dppx)`);\n\t\ton(change, query, setPxRatio);\n\n\t\twin.dispatchEvent(new CustomEvent(dppxchange));\n\t}\n}\n\nfunction addClass(el, c) {\n\tif (c != null) {\n\t\tlet cl = el.classList;\n\t\t!cl.contains(c) && cl.add(c);\n\t}\n}\n\nfunction remClass(el, c) {\n\tlet cl = el.classList;\n\tcl.contains(c) && cl.remove(c);\n}\n\nfunction setStylePx(el, name, value) {\n\tel.style[name] = value + \"px\";\n}\n\nfunction placeTag(tag, cls, targ, refEl) {\n\tlet el = doc.createElement(tag);\n\n\tif (cls != null)\n\t\taddClass(el, cls);\n\n\tif (targ != null)\n\t\ttarg.insertBefore(el, refEl);\n\n\treturn el;\n}\n\nfunction placeDiv(cls, targ) {\n\treturn placeTag(\"div\", cls, targ);\n}\n\nconst xformCache = new WeakMap();\n\nfunction elTrans(el, xPos, yPos, xMax, yMax) {\n\tlet xform = \"translate(\" + xPos + \"px,\" + yPos + \"px)\";\n\tlet xformOld = xformCache.get(el);\n\n\tif (xform != xformOld) {\n\t\tel.style.transform = xform;\n\t\txformCache.set(el, xform);\n\n\t\tif (xPos < 0 || yPos < 0 || xPos > xMax || yPos > yMax)\n\t\t\taddClass(el, OFF);\n\t\telse\n\t\t\tremClass(el, OFF);\n\t}\n}\n\nconst colorCache = new WeakMap();\n\nfunction elColor(el, background, borderColor) {\n\tlet newColor = background + borderColor;\n\tlet oldColor = colorCache.get(el);\n\n\tif (newColor != oldColor) {\n\t\tcolorCache.set(el, newColor);\n\t\tel.style.background = background;\n\t\tel.style.borderColor = borderColor;\n\t}\n}\n\nconst sizeCache = new WeakMap();\n\nfunction elSize(el, newWid, newHgt, centered) {\n\tlet newSize = newWid + \"\" + newHgt;\n\tlet oldSize = sizeCache.get(el);\n\n\tif (newSize != oldSize) {\n\t\tsizeCache.set(el, newSize);\n\t\tel.style.height = newHgt + \"px\";\n\t\tel.style.width = newWid + \"px\";\n\t\tel.style.marginLeft = centered ? -newWid/2 + \"px\" : 0;\n\t\tel.style.marginTop = centered ? -newHgt/2 + \"px\" : 0;\n\t}\n}\n\nconst evOpts = {passive: true};\nconst evOpts2 = {...evOpts, capture: true};\n\nfunction on(ev, el, cb, capt) {\n\tel.addEventListener(ev, cb, capt ? evOpts2 : evOpts);\n}\n\nfunction off(ev, el, cb, capt) {\n\tel.removeEventListener(ev, cb, evOpts);\n}\n\ndomEnv && setPxRatio();\n\n// binary search for index of closest value\nfunction closestIdx(num, arr, lo, hi) {\n\tlet mid;\n\tlo = lo || 0;\n\thi = hi || arr.length - 1;\n\tlet bitwise = hi <= 2147483647;\n\n\twhile (hi - lo > 1) {\n\t\tmid = bitwise ? (lo + hi) >> 1 : floor((lo + hi) / 2);\n\n\t\tif (arr[mid] < num)\n\t\t\tlo = mid;\n\t\telse\n\t\t\thi = mid;\n\t}\n\n\tif (num - arr[lo] <= arr[hi] - num)\n\t\treturn lo;\n\n\treturn hi;\n}\n\nfunction makeIndexOfs(predicate) {\n\t let indexOfs = (data, _i0, _i1) => {\n\t\tlet i0 = -1;\n\t\tlet i1 = -1;\n\n\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti0 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = _i1; i >= _i0; i--) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti1 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn [i0, i1];\n\t };\n\n\t return indexOfs;\n}\n\nconst notNullish = v => v != null;\nconst isPositive = v => v != null && v > 0;\n\nconst nonNullIdxs = makeIndexOfs(notNullish);\nconst positiveIdxs = makeIndexOfs(isPositive);\n\nfunction getMinMax(data, _i0, _i1, sorted = 0, log = false) {\n//\tconsole.log(\"getMinMax()\");\n\n\tlet getEdgeIdxs = log ? positiveIdxs : nonNullIdxs;\n\tlet predicate = log ? isPositive : notNullish;\n\n\t[_i0, _i1] = getEdgeIdxs(data, _i0, _i1);\n\n\tlet _min = data[_i0];\n\tlet _max = data[_i0];\n\n\tif (_i0 > -1) {\n\t\tif (sorted == 1) {\n\t\t\t_min = data[_i0];\n\t\t\t_max = data[_i1];\n\t\t}\n\t\telse if (sorted == -1) {\n\t\t\t_min = data[_i1];\n\t\t\t_max = data[_i0];\n\t\t}\n\t\telse {\n\t\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\t\tlet v = data[i];\n\n\t\t\t\tif (predicate(v)) {\n\t\t\t\t\tif (v < _min)\n\t\t\t\t\t\t_min = v;\n\t\t\t\t\telse if (v > _max)\n\t\t\t\t\t\t_max = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [_min ?? inf, _max ?? -inf]; // todo: fix to return nulls\n}\n\nfunction rangeLog(min, max, base, fullMags) {\n\tlet minSign = sign(min);\n\tlet maxSign = sign(max);\n\n\tif (min == max) {\n\t\tif (minSign == -1) {\n\t\t\tmin *= base;\n\t\t\tmax /= base;\n\t\t}\n\t\telse {\n\t\t\tmin /= base;\n\t\t\tmax *= base;\n\t\t}\n\t}\n\n\tlet logFn = base == 10 ? log10 : log2;\n\n\tlet growMinAbs = minSign == 1 ? floor : ceil;\n\tlet growMaxAbs = maxSign == 1 ? ceil : floor;\n\n\tlet minExp = growMinAbs(logFn(abs(min)));\n\tlet maxExp = growMaxAbs(logFn(abs(max)));\n\n\tlet minIncr = pow(base, minExp);\n\tlet maxIncr = pow(base, maxExp);\n\n\t// fix values like Math.pow(10, -5) === 0.000009999999999999999\n\tif (base == 10) {\n\t\tif (minExp < 0)\n\t\t\tminIncr = roundDec(minIncr, -minExp);\n\t\tif (maxExp < 0)\n\t\t\tmaxIncr = roundDec(maxIncr, -maxExp);\n\t}\n\n\tif (fullMags || base == 2) {\n\t\tmin = minIncr * minSign;\n\t\tmax = maxIncr * maxSign;\n\t}\n\telse {\n\t\tmin = incrRoundDn(min, minIncr);\n\t\tmax = incrRoundUp(max, maxIncr);\n\t}\n\n\treturn [min, max];\n}\n\nfunction rangeAsinh(min, max, base, fullMags) {\n\tlet minMax = rangeLog(min, max, base, fullMags);\n\n\tif (min == 0)\n\t\tminMax[0] = 0;\n\n\tif (max == 0)\n\t\tminMax[1] = 0;\n\n\treturn minMax;\n}\n\nconst rangePad = 0.1;\n\nconst autoRangePart = {\n\tmode: 3,\n\tpad: rangePad,\n};\n\nconst _eqRangePart = {\n\tpad:  0,\n\tsoft: null,\n\tmode: 0,\n};\n\nconst _eqRange = {\n\tmin: _eqRangePart,\n\tmax: _eqRangePart,\n};\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction rangeNum(_min, _max, mult, extra) {\n\tif (isObj(mult))\n\t\treturn _rangeNum(_min, _max, mult);\n\n\t_eqRangePart.pad  = mult;\n\t_eqRangePart.soft = extra ? 0 : null;\n\t_eqRangePart.mode = extra ? 3 : 0;\n\n\treturn _rangeNum(_min, _max, _eqRange);\n}\n\n// nullish coalesce\nfunction ifNull(lh, rh) {\n\treturn lh == null ? rh : lh;\n}\n\n// checks if given index range in an array contains a non-null value\n// aka a range-bounded Array.some()\nfunction hasData(data, idx0, idx1) {\n\tidx0 = ifNull(idx0, 0);\n\tidx1 = ifNull(idx1, data.length - 1);\n\n\twhile (idx0 <= idx1) {\n\t\tif (data[idx0] != null)\n\t\t\treturn true;\n\t\tidx0++;\n\t}\n\n\treturn false;\n}\n\nfunction _rangeNum(_min, _max, cfg) {\n\tlet cmin = cfg.min;\n\tlet cmax = cfg.max;\n\n\tlet padMin = ifNull(cmin.pad, 0);\n\tlet padMax = ifNull(cmax.pad, 0);\n\n\tlet hardMin = ifNull(cmin.hard, -inf);\n\tlet hardMax = ifNull(cmax.hard,  inf);\n\n\tlet softMin = ifNull(cmin.soft,  inf);\n\tlet softMax = ifNull(cmax.soft, -inf);\n\n\tlet softMinMode = ifNull(cmin.mode, 0);\n\tlet softMaxMode = ifNull(cmax.mode, 0);\n\n\tlet delta = _max - _min;\n\tlet deltaMag = log10(delta);\n\n\tlet scalarMax = max(abs(_min), abs(_max));\n\tlet scalarMag = log10(scalarMax);\n\n\tlet scalarMagDelta = abs(scalarMag - deltaMag);\n\n\t// this handles situations like 89.7, 89.69999999999999\n\t// by assuming 0.001x deltas are precision errors\n//\tif (delta > 0 && delta < abs(_max) / 1e3)\n//\t\tdelta = 0;\n\n\t// treat data as flat if delta is less than 1e-24\n\t// or range is 11+ orders of magnitude below raw values, e.g. 99999999.99999996 - 100000000.00000004\n\tif (delta < 1e-24 || scalarMagDelta > 10) {\n\t\tdelta = 0;\n\n\t\t// if soft mode is 2 and all vals are flat at 0, avoid the 0.1 * 1e3 fallback\n\t\t// this prevents 0,0,0 from ranging to -100,100 when softMin/softMax are -1,1\n\t\tif (_min == 0 || _max == 0) {\n\t\t\tdelta = 1e-24;\n\n\t\t\tif (softMinMode == 2 && softMin != inf)\n\t\t\t\tpadMin = 0;\n\n\t\t\tif (softMaxMode == 2 && softMax != -inf)\n\t\t\t\tpadMax = 0;\n\t\t}\n\t}\n\n\tlet nonZeroDelta = delta || scalarMax || 1e3;\n\tlet mag          = log10(nonZeroDelta);\n\tlet base         = pow(10, floor(mag));\n\n\tlet _padMin  = nonZeroDelta * (delta == 0 ? (_min == 0 ? .1 : 1) : padMin);\n\tlet _newMin  = roundDec(incrRoundDn(_min - _padMin, base/10), 24);\n\tlet _softMin = _min >= softMin && (softMinMode == 1 || softMinMode == 3 && _newMin <= softMin || softMinMode == 2 && _newMin >= softMin) ? softMin : inf;\n\tlet minLim   = max(hardMin, _newMin < _softMin && _min >= _softMin ? _softMin : min(_softMin, _newMin));\n\n\tlet _padMax  = nonZeroDelta * (delta == 0 ? (_max == 0 ? .1 : 1) : padMax);\n\tlet _newMax  = roundDec(incrRoundUp(_max + _padMax, base/10), 24);\n\tlet _softMax = _max <= softMax && (softMaxMode == 1 || softMaxMode == 3 && _newMax >= softMax || softMaxMode == 2 && _newMax <= softMax) ? softMax : -inf;\n\tlet maxLim   = min(hardMax, _newMax > _softMax && _max <= _softMax ? _softMax : max(_softMax, _newMax));\n\n\tif (minLim == maxLim && minLim == 0)\n\t\tmaxLim = 100;\n\n\treturn [minLim, maxLim];\n}\n\n// alternative: https://stackoverflow.com/a/2254896\nconst numFormatter = new Intl.NumberFormat(domEnv ? nav.language : 'en-US');\nconst fmtNum = val => numFormatter.format(val);\n\nconst M = Math;\n\nconst PI = M.PI;\nconst abs = M.abs;\nconst floor = M.floor;\nconst round = M.round;\nconst ceil = M.ceil;\nconst min = M.min;\nconst max = M.max;\nconst pow = M.pow;\nconst sign = M.sign;\nconst log10 = M.log10;\nconst log2 = M.log2;\n// TODO: seems like this needs to match asinh impl if the passed v is tweaked?\nconst sinh =  (v, linthresh = 1) => M.sinh(v) * linthresh;\nconst asinh = (v, linthresh = 1) => M.asinh(v / linthresh);\n\nconst inf = Infinity;\n\nfunction numIntDigits(x) {\n\treturn (log10((x ^ (x >> 31)) - (x >> 31)) | 0) + 1;\n}\n\nfunction clamp(num, _min, _max) {\n\treturn min(max(num, _min), _max);\n}\n\nfunction isFn(v) {\n\treturn typeof v == \"function\";\n}\n\nfunction fnOrSelf(v) {\n\treturn isFn(v) ? v : () => v;\n}\n\nconst noop = () => {};\n\n// note: these identity fns may get deoptimized if reused for different arg types\n// a TS version would enforce they stay monotyped and require making variants\nconst retArg0 = _0 => _0;\n\nconst retArg1 = (_0, _1) => _1;\n\nconst retNull = _ => null;\n\nconst retTrue = _ => true;\n\nconst retEq = (a, b) => a == b;\n\nconst regex6 = /\\.\\d*?(?=9{6,}|0{6,})/gm;\n\n// e.g. 17999.204999999998 -> 17999.205\nconst fixFloat = val => {\n\tif (isInt(val) || fixedDec.has(val))\n\t\treturn val;\n\n\tconst str = `${val}`;\n\n\tconst match = str.match(regex6);\n\n\tif (match == null)\n\t\treturn val;\n\n\tlet len = match[0].length - 1;\n\n\t// e.g. 1.0000000000000001e-24\n\tif (str.indexOf('e-') != -1) {\n\t\tlet [num, exp] = str.split('e');\n\t\treturn +`${fixFloat(num)}e${exp}`;\n\t}\n\n\treturn roundDec(val, len);\n};\n\nfunction incrRound(num, incr) {\n\treturn fixFloat(roundDec(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundUp(num, incr) {\n\treturn fixFloat(ceil(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundDn(num, incr) {\n\treturn fixFloat(floor(fixFloat(num/incr))*incr);\n}\n\n// https://stackoverflow.com/a/48764436\n// rounds half away from zero\nfunction roundDec(val, dec = 0) {\n\tif (isInt(val))\n\t\treturn val;\n//\telse if (dec == 0)\n//\t\treturn round(val);\n\n\tlet p = 10 ** dec;\n\tlet n = (val * p) * (1 + Number.EPSILON);\n\treturn round(n) / p;\n}\n\nconst fixedDec = new Map();\n\nfunction guessDec(num) {\n\treturn ((\"\"+num).split(\".\")[1] || \"\").length;\n}\n\nfunction genIncrs(base, minExp, maxExp, mults) {\n\tlet incrs = [];\n\n\tlet multDec = mults.map(guessDec);\n\n\tfor (let exp = minExp; exp < maxExp; exp++) {\n\t\tlet expa = abs(exp);\n\t\tlet mag = roundDec(pow(base, exp), expa);\n\n\t\tfor (let i = 0; i < mults.length; i++) {\n\t\t\tlet _incr = base == 10 ? +`${mults[i]}e${exp}` : mults[i] * mag;\n\t\t\tlet dec = (exp >= 0 ? 0 : expa) + (exp >= multDec[i] ? 0 : multDec[i]);\n\t\t\tlet incr = base == 10 ? _incr : roundDec(_incr, dec);\n\t\t\tincrs.push(incr);\n\t\t\tfixedDec.set(incr, dec);\n\t\t}\n\t}\n\n\treturn incrs;\n}\n\n//export const assign = Object.assign;\n\nconst EMPTY_OBJ = {};\nconst EMPTY_ARR = [];\n\nconst nullNullTuple = [null, null];\n\nconst isArr = Array.isArray;\nconst isInt = Number.isInteger;\nconst isUndef = v => v === void 0;\n\nfunction isStr(v) {\n\treturn typeof v == 'string';\n}\n\nfunction isObj(v) {\n\tlet is = false;\n\n\tif (v != null) {\n\t\tlet c = v.constructor;\n\t\tis = c == null || c == Object;\n\t}\n\n\treturn is;\n}\n\nfunction fastIsObj(v) {\n\treturn v != null && typeof v == 'object';\n}\n\nconst TypedArray = Object.getPrototypeOf(Uint8Array);\n\nconst __proto__ = \"__proto__\";\n\nfunction copy(o, _isObj = isObj) {\n\tlet out;\n\n\tif (isArr(o)) {\n\t\tlet val = o.find(v => v != null);\n\n\t\tif (isArr(val) || _isObj(val)) {\n\t\t\tout = Array(o.length);\n\t\t\tfor (let i = 0; i < o.length; i++)\n\t\t\t\tout[i] = copy(o[i], _isObj);\n\t\t}\n\t\telse\n\t\t\tout = o.slice();\n\t}\n\telse if (o instanceof TypedArray) // also (ArrayBuffer.isView(o) && !(o instanceof DataView))\n\t\tout = o.slice();\n\telse if (_isObj(o)) {\n\t\tout = {};\n\t\tfor (let k in o) {\n\t\t\tif (k != __proto__)\n\t\t\t\tout[k] = copy(o[k], _isObj);\n\t\t}\n\t}\n\telse\n\t\tout = o;\n\n\treturn out;\n}\n\nfunction assign(targ) {\n\tlet args = arguments;\n\n\tfor (let i = 1; i < args.length; i++) {\n\t\tlet src = args[i];\n\n\t\tfor (let key in src) {\n\t\t\tif (key != __proto__) {\n\t\t\t\tif (isObj(targ[key]))\n\t\t\t\t\tassign(targ[key], copy(src[key]));\n\t\t\t\telse\n\t\t\t\t\ttarg[key] = copy(src[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn targ;\n}\n\n// nullModes\nconst NULL_REMOVE = 0;  // nulls are converted to undefined (e.g. for spanGaps: true)\nconst NULL_RETAIN = 1;  // nulls are retained, with alignment artifacts set to undefined (default)\nconst NULL_EXPAND = 2;  // nulls are expanded to include any adjacent alignment artifacts\n\n// sets undefined values to nulls when adjacent to existing nulls (minesweeper)\nfunction nullExpand(yVals, nullIdxs, alignedLen) {\n\tfor (let i = 0, xi, lastNullIdx = -1; i < nullIdxs.length; i++) {\n\t\tlet nullIdx = nullIdxs[i];\n\n\t\tif (nullIdx > lastNullIdx) {\n\t\t\txi = nullIdx - 1;\n\t\t\twhile (xi >= 0 && yVals[xi] == null)\n\t\t\t\tyVals[xi--] = null;\n\n\t\t\txi = nullIdx + 1;\n\t\t\twhile (xi < alignedLen && yVals[xi] == null)\n\t\t\t\tyVals[lastNullIdx = xi++] = null;\n\t\t}\n\t}\n}\n\n// nullModes is a tables-matched array indicating how to treat nulls in each series\n// output is sorted ASC on the joined field (table[0]) and duplicate join values are collapsed\nfunction join(tables, nullModes) {\n\tif (allHeadersSame(tables)) {\n\t//\tconsole.log('cheap join!');\n\n\t\tlet table = tables[0].slice();\n\n\t\tfor (let i = 1; i < tables.length; i++)\n\t\t\ttable.push(...tables[i].slice(1));\n\n\t\tif (!isAsc(table[0]))\n\t\t\ttable = sortCols(table);\n\n\t\treturn table;\n\t}\n\n\tlet xVals = new Set();\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\t\tlet len = xs.length;\n\n\t\tfor (let i = 0; i < len; i++)\n\t\t\txVals.add(xs[i]);\n\t}\n\n\tlet data = [Array.from(xVals).sort((a, b) => a - b)];\n\n\tlet alignedLen = data[0].length;\n\n\tlet xIdxs = new Map();\n\n\tfor (let i = 0; i < alignedLen; i++)\n\t\txIdxs.set(data[0][i], i);\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\n\t\tfor (let si = 1; si < t.length; si++) {\n\t\t\tlet ys = t[si];\n\n\t\t\tlet yVals = Array(alignedLen).fill(undefined);\n\n\t\t\tlet nullMode = nullModes ? nullModes[ti][si] : NULL_RETAIN;\n\n\t\t\tlet nullIdxs = [];\n\n\t\t\tfor (let i = 0; i < ys.length; i++) {\n\t\t\t\tlet yVal = ys[i];\n\t\t\t\tlet alignedIdx = xIdxs.get(xs[i]);\n\n\t\t\t\tif (yVal === null) {\n\t\t\t\t\tif (nullMode != NULL_REMOVE) {\n\t\t\t\t\t\tyVals[alignedIdx] = yVal;\n\n\t\t\t\t\t\tif (nullMode == NULL_EXPAND)\n\t\t\t\t\t\t\tnullIdxs.push(alignedIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tyVals[alignedIdx] = yVal;\n\t\t\t}\n\n\t\t\tnullExpand(yVals, nullIdxs, alignedLen);\n\n\t\t\tdata.push(yVals);\n\t\t}\n\t}\n\n\treturn data;\n}\n\nconst microTask = typeof queueMicrotask == \"undefined\" ? fn => Promise.resolve().then(fn) : queueMicrotask;\n\n// TODO: https://github.com/dy/sort-ids (~2x faster for 1e5+ arrays)\nfunction sortCols(table) {\n\tlet head = table[0];\n\tlet rlen = head.length;\n\n\tlet idxs = Array(rlen);\n\tfor (let i = 0; i < idxs.length; i++)\n\t\tidxs[i] = i;\n\n\tidxs.sort((i0, i1) => head[i0] - head[i1]);\n\n\tlet table2 = [];\n\tfor (let i = 0; i < table.length; i++) {\n\t\tlet row = table[i];\n\t\tlet row2 = Array(rlen);\n\n\t\tfor (let j = 0; j < rlen; j++)\n\t\t\trow2[j] = row[idxs[j]];\n\n\t\ttable2.push(row2);\n\t}\n\n\treturn table2;\n}\n\n// test if we can do cheap join (all join fields same)\nfunction allHeadersSame(tables) {\n\tlet vals0 = tables[0][0];\n\tlet len0 = vals0.length;\n\n\tfor (let i = 1; i < tables.length; i++) {\n\t\tlet vals1 = tables[i][0];\n\n\t\tif (vals1.length != len0)\n\t\t\treturn false;\n\n\t\tif (vals1 != vals0) {\n\t\t\tfor (let j = 0; j < len0; j++) {\n\t\t\t\tif (vals1[j] != vals0[j])\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction isAsc(vals, samples = 100) {\n\tconst len = vals.length;\n\n\t// empty or single value\n\tif (len <= 1)\n\t\treturn true;\n\n\t// skip leading & trailing nullish\n\tlet firstIdx = 0;\n\tlet lastIdx = len - 1;\n\n\twhile (firstIdx <= lastIdx && vals[firstIdx] == null)\n\t\tfirstIdx++;\n\n\twhile (lastIdx >= firstIdx && vals[lastIdx] == null)\n\t\tlastIdx--;\n\n\t// all nullish or one value surrounded by nullish\n\tif (lastIdx <= firstIdx)\n\t\treturn true;\n\n\tconst stride = max(1, floor((lastIdx - firstIdx + 1) / samples));\n\n\tfor (let prevVal = vals[firstIdx], i = firstIdx + stride; i <= lastIdx; i += stride) {\n\t\tconst v = vals[i];\n\n\t\tif (v != null) {\n\t\t\tif (v <= prevVal)\n\t\t\t\treturn false;\n\n\t\t\tprevVal = v;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nconst months = [\n\t\"January\",\n\t\"February\",\n\t\"March\",\n\t\"April\",\n\t\"May\",\n\t\"June\",\n\t\"July\",\n\t\"August\",\n\t\"September\",\n\t\"October\",\n\t\"November\",\n\t\"December\",\n];\n\nconst days = [\n\t\"Sunday\",\n\t\"Monday\",\n\t\"Tuesday\",\n\t\"Wednesday\",\n\t\"Thursday\",\n\t\"Friday\",\n\t\"Saturday\",\n];\n\nfunction slice3(str) {\n\treturn str.slice(0, 3);\n}\n\nconst days3 = days.map(slice3);\n\nconst months3 = months.map(slice3);\n\nconst engNames = {\n\tMMMM: months,\n\tMMM:  months3,\n\tWWWW: days,\n\tWWW:  days3,\n};\n\nfunction zeroPad2(int) {\n\treturn (int < 10 ? '0' : '') + int;\n}\n\nfunction zeroPad3(int) {\n\treturn (int < 10 ? '00' : int < 100 ? '0' : '') + int;\n}\n\n/*\nfunction suffix(int) {\n\tlet mod10 = int % 10;\n\n\treturn int + (\n\t\tmod10 == 1 && int != 11 ? \"st\" :\n\t\tmod10 == 2 && int != 12 ? \"nd\" :\n\t\tmod10 == 3 && int != 13 ? \"rd\" : \"th\"\n\t);\n}\n*/\n\nconst subs = {\n\t// 2019\n\tYYYY:\td => d.getFullYear(),\n\t// 19\n\tYY:\t\td => (d.getFullYear()+'').slice(2),\n\t// July\n\tMMMM:\t(d, names) => names.MMMM[d.getMonth()],\n\t// Jul\n\tMMM:\t(d, names) => names.MMM[d.getMonth()],\n\t// 07\n\tMM:\t\td => zeroPad2(d.getMonth()+1),\n\t// 7\n\tM:\t\td => d.getMonth()+1,\n\t// 09\n\tDD:\t\td => zeroPad2(d.getDate()),\n\t// 9\n\tD:\t\td => d.getDate(),\n\t// Monday\n\tWWWW:\t(d, names) => names.WWWW[d.getDay()],\n\t// Mon\n\tWWW:\t(d, names) => names.WWW[d.getDay()],\n\t// 03\n\tHH:\t\td => zeroPad2(d.getHours()),\n\t// 3\n\tH:\t\td => d.getHours(),\n\t// 9 (12hr, unpadded)\n\th:\t\td => {let h = d.getHours(); return h == 0 ? 12 : h > 12 ? h - 12 : h;},\n\t// AM\n\tAA:\t\td => d.getHours() >= 12 ? 'PM' : 'AM',\n\t// am\n\taa:\t\td => d.getHours() >= 12 ? 'pm' : 'am',\n\t// a\n\ta:\t\td => d.getHours() >= 12 ? 'p' : 'a',\n\t// 09\n\tmm:\t\td => zeroPad2(d.getMinutes()),\n\t// 9\n\tm:\t\td => d.getMinutes(),\n\t// 09\n\tss:\t\td => zeroPad2(d.getSeconds()),\n\t// 9\n\ts:\t\td => d.getSeconds(),\n\t// 374\n\tfff:\td => zeroPad3(d.getMilliseconds()),\n};\n\nfunction fmtDate(tpl, names) {\n\tnames = names || engNames;\n\tlet parts = [];\n\n\tlet R = /\\{([a-z]+)\\}|[^{]+/gi, m;\n\n\twhile (m = R.exec(tpl))\n\t\tparts.push(m[0][0] == '{' ? subs[m[1]] : m[0]);\n\n\treturn d => {\n\t\tlet out = '';\n\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t\tout += typeof parts[i] == \"string\" ? parts[i] : parts[i](d, names);\n\n\t\treturn out;\n\t}\n}\n\nconst localTz = new Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n// https://stackoverflow.com/questions/15141762/how-to-initialize-a-javascript-date-to-a-particular-time-zone/53652131#53652131\nfunction tzDate(date, tz) {\n\tlet date2;\n\n\t// perf optimization\n\tif (tz == 'UTC' || tz == 'Etc/UTC')\n\t\tdate2 = new Date(+date + date.getTimezoneOffset() * 6e4);\n\telse if (tz == localTz)\n\t\tdate2 = date;\n\telse {\n\t\tdate2 = new Date(date.toLocaleString('en-US', {timeZone: tz}));\n\t\tdate2.setMilliseconds(date.getMilliseconds());\n\t}\n\n\treturn date2;\n}\n\n//export const series = [];\n\n// default formatters:\n\nconst onlyWhole = v => v % 1 == 0;\n\nconst allMults = [1,2,2.5,5];\n\n// ...0.01, 0.02, 0.025, 0.05, 0.1, 0.2, 0.25, 0.5\nconst decIncrs = genIncrs(10, -32, 0, allMults);\n\n// 1, 2, 2.5, 5, 10, 20, 25, 50...\nconst oneIncrs = genIncrs(10, 0, 32, allMults);\n\n// 1, 2,      5, 10, 20, 25, 50...\nconst wholeIncrs = oneIncrs.filter(onlyWhole);\n\nconst numIncrs = decIncrs.concat(oneIncrs);\n\nconst NL = \"\\n\";\n\nconst yyyy    = \"{YYYY}\";\nconst NLyyyy  = NL + yyyy;\nconst md      = \"{M}/{D}\";\nconst NLmd    = NL + md;\nconst NLmdyy  = NLmd + \"/{YY}\";\n\nconst aa      = \"{aa}\";\nconst hmm     = \"{h}:{mm}\";\nconst hmmaa   = hmm + aa;\nconst NLhmmaa = NL + hmmaa;\nconst ss      = \":{ss}\";\n\nconst _ = null;\n\nfunction genTimeStuffs(ms) {\n\tlet\ts  = ms * 1e3,\n\t\tm  = s  * 60,\n\t\th  = m  * 60,\n\t\td  = h  * 24,\n\t\tmo = d  * 30,\n\t\ty  = d  * 365;\n\n\t// min of 1e-3 prevents setting a temporal x ticks too small since Date objects cannot advance ticks smaller than 1ms\n\tlet subSecIncrs = ms == 1 ? genIncrs(10, 0, 3, allMults).filter(onlyWhole) : genIncrs(10, -3, 0, allMults);\n\n\tlet timeIncrs = subSecIncrs.concat([\n\t\t// minute divisors (# of secs)\n\t\ts,\n\t\ts * 5,\n\t\ts * 10,\n\t\ts * 15,\n\t\ts * 30,\n\t\t// hour divisors (# of mins)\n\t\tm,\n\t\tm * 5,\n\t\tm * 10,\n\t\tm * 15,\n\t\tm * 30,\n\t\t// day divisors (# of hrs)\n\t\th,\n\t\th * 2,\n\t\th * 3,\n\t\th * 4,\n\t\th * 6,\n\t\th * 8,\n\t\th * 12,\n\t\t// month divisors TODO: need more?\n\t\td,\n\t\td * 2,\n\t\td * 3,\n\t\td * 4,\n\t\td * 5,\n\t\td * 6,\n\t\td * 7,\n\t\td * 8,\n\t\td * 9,\n\t\td * 10,\n\t\td * 15,\n\t\t// year divisors (# months, approx)\n\t\tmo,\n\t\tmo * 2,\n\t\tmo * 3,\n\t\tmo * 4,\n\t\tmo * 6,\n\t\t// century divisors\n\t\ty,\n\t\ty * 2,\n\t\ty * 5,\n\t\ty * 10,\n\t\ty * 25,\n\t\ty * 50,\n\t\ty * 100,\n\t]);\n\n\t// [0]:   minimum num secs in the tick incr\n\t// [1]:   default tick format\n\t// [2-7]: rollover tick formats\n\t// [8]:   mode: 0: replace [1] -> [2-7], 1: concat [1] + [2-7]\n\tconst _timeAxisStamps = [\n\t//   tick incr    default          year                    month   day                   hour    min       sec   mode\n\t\t[y,           yyyy,            _,                      _,      _,                    _,      _,        _,       1],\n\t\t[d * 28,      \"{MMM}\",         NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[d,           md,              NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[h,           \"{h}\" + aa,      NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[m,           hmmaa,           NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[s,           ss,              NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t\t[ms,          ss + \".{fff}\",   NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t];\n\n\t// the ensures that axis ticks, values & grid are aligned to logical temporal breakpoints and not an arbitrary timestamp\n\t// https://www.timeanddate.com/time/dst/\n\t// https://www.timeanddate.com/time/dst/2019.html\n\t// https://www.epochconverter.com/timezones\n\tfunction timeAxisSplits(tzDate) {\n\t\treturn (self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace) => {\n\t\t\tlet splits = [];\n\t\t\tlet isYr = foundIncr >= y;\n\t\t\tlet isMo = foundIncr >= mo && foundIncr < y;\n\n\t\t\t// get the timezone-adjusted date\n\t\t\tlet minDate = tzDate(scaleMin);\n\t\t\tlet minDateTs = roundDec(minDate * ms, 3);\n\n\t\t\t// get ts of 12am (this lands us at or before the original scaleMin)\n\t\t\tlet minMin = mkDate(minDate.getFullYear(), isYr ? 0 : minDate.getMonth(), isMo || isYr ? 1 : minDate.getDate());\n\t\t\tlet minMinTs = roundDec(minMin * ms, 3);\n\n\t\t\tif (isMo || isYr) {\n\t\t\t\tlet moIncr = isMo ? foundIncr / mo : 0;\n\t\t\t\tlet yrIncr = isYr ? foundIncr / y  : 0;\n\t\t\t//\tlet tzOffset = scaleMin - minDateTs;\t\t// needed?\n\t\t\t\tlet split = minDateTs == minMinTs ? minDateTs : roundDec(mkDate(minMin.getFullYear() + yrIncr, minMin.getMonth() + moIncr, 1) * ms, 3);\n\t\t\t\tlet splitDate = new Date(round(split / ms));\n\t\t\t\tlet baseYear = splitDate.getFullYear();\n\t\t\t\tlet baseMonth = splitDate.getMonth();\n\n\t\t\t\tfor (let i = 0; split <= scaleMax; i++) {\n\t\t\t\t\tlet next = mkDate(baseYear + yrIncr * i, baseMonth + moIncr * i, 1);\n\t\t\t\t\tlet offs = next - tzDate(roundDec(next * ms, 3));\n\n\t\t\t\t\tsplit = roundDec((+next + offs) * ms, 3);\n\n\t\t\t\t\tif (split <= scaleMax)\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet incr0 = foundIncr >= d ? d : foundIncr;\n\t\t\t\tlet tzOffset = floor(scaleMin) - floor(minDateTs);\n\t\t\t\tlet split = minMinTs + tzOffset + incrRoundUp(minDateTs - minMinTs, incr0);\n\t\t\t\tsplits.push(split);\n\n\t\t\t\tlet date0 = tzDate(split);\n\n\t\t\t\tlet prevHour = date0.getHours() + (date0.getMinutes() / m) + (date0.getSeconds() / h);\n\t\t\t\tlet incrHours = foundIncr / h;\n\n\t\t\t\tlet minSpace = self.axes[axisIdx]._space;\n\t\t\t\tlet pctSpace = foundSpace / minSpace;\n\n\t\t\t\twhile (1) {\n\t\t\t\t\tsplit = roundDec(split + foundIncr, ms == 1 ? 0 : 3);\n\n\t\t\t\t\tif (split > scaleMax)\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tif (incrHours > 1) {\n\t\t\t\t\t\tlet expectedHour = floor(roundDec(prevHour + incrHours, 6)) % 24;\n\t\t\t\t\t\tlet splitDate = tzDate(split);\n\t\t\t\t\t\tlet actualHour = splitDate.getHours();\n\n\t\t\t\t\t\tlet dstShift = actualHour - expectedHour;\n\n\t\t\t\t\t\tif (dstShift > 1)\n\t\t\t\t\t\t\tdstShift = -1;\n\n\t\t\t\t\t\tsplit -= dstShift * h;\n\n\t\t\t\t\t\tprevHour = (prevHour + incrHours) % 24;\n\n\t\t\t\t\t\t// add a tick only if it's further than 70% of the min allowed label spacing\n\t\t\t\t\t\tlet prevSplit = splits[splits.length - 1];\n\t\t\t\t\t\tlet pctIncr = roundDec((split - prevSplit) / foundIncr, 3);\n\n\t\t\t\t\t\tif (pctIncr * pctSpace >= .7)\n\t\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn splits;\n\t\t}\n\t}\n\n\treturn [\n\t\ttimeIncrs,\n\t\t_timeAxisStamps,\n\t\ttimeAxisSplits,\n\t];\n}\n\nconst [ timeIncrsMs, _timeAxisStampsMs, timeAxisSplitsMs ] = genTimeStuffs(1);\nconst [ timeIncrsS,  _timeAxisStampsS,  timeAxisSplitsS  ] = genTimeStuffs(1e-3);\n\n// base 2\ngenIncrs(2, -53, 53, [1]);\n\n/*\nconsole.log({\n\tdecIncrs,\n\toneIncrs,\n\twholeIncrs,\n\tnumIncrs,\n\ttimeIncrs,\n\tfixedDec,\n});\n*/\n\nfunction timeAxisStamps(stampCfg, fmtDate) {\n\treturn stampCfg.map(s => s.map((v, i) =>\n\t\ti == 0 || i == 8 || v == null ? v : fmtDate(i == 1 || s[8] == 0 ? v : s[1] + v)\n\t));\n}\n\n// TODO: will need to accept spaces[] and pull incr into the loop when grid will be non-uniform, eg for log scales.\n// currently we ignore this for months since they're *nearly* uniform and the added complexity is not worth it\nfunction timeAxisVals(tzDate, stamps) {\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => {\n\t\tlet s = stamps.find(s => foundIncr >= s[0]) || stamps[stamps.length - 1];\n\n\t\t// these track boundaries when a full label is needed again\n\t\tlet prevYear;\n\t\tlet prevMnth;\n\t\tlet prevDate;\n\t\tlet prevHour;\n\t\tlet prevMins;\n\t\tlet prevSecs;\n\n\t\treturn splits.map(split => {\n\t\t\tlet date = tzDate(split);\n\n\t\t\tlet newYear = date.getFullYear();\n\t\t\tlet newMnth = date.getMonth();\n\t\t\tlet newDate = date.getDate();\n\t\t\tlet newHour = date.getHours();\n\t\t\tlet newMins = date.getMinutes();\n\t\t\tlet newSecs = date.getSeconds();\n\n\t\t\tlet stamp = (\n\t\t\t\tnewYear != prevYear && s[2] ||\n\t\t\t\tnewMnth != prevMnth && s[3] ||\n\t\t\t\tnewDate != prevDate && s[4] ||\n\t\t\t\tnewHour != prevHour && s[5] ||\n\t\t\t\tnewMins != prevMins && s[6] ||\n\t\t\t\tnewSecs != prevSecs && s[7] ||\n\t\t\t\t                       s[1]\n\t\t\t);\n\n\t\t\tprevYear = newYear;\n\t\t\tprevMnth = newMnth;\n\t\t\tprevDate = newDate;\n\t\t\tprevHour = newHour;\n\t\t\tprevMins = newMins;\n\t\t\tprevSecs = newSecs;\n\n\t\t\treturn stamp(date);\n\t\t});\n\t}\n}\n\n// for when axis.values is defined as a static fmtDate template string\nfunction timeAxisVal(tzDate, dateTpl) {\n\tlet stamp = fmtDate(dateTpl);\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => splits.map(split => stamp(tzDate(split)));\n}\n\nfunction mkDate(y, m, d) {\n\treturn new Date(y, m, d);\n}\n\nfunction timeSeriesStamp(stampCfg, fmtDate) {\n\treturn fmtDate(stampCfg);\n}\nconst _timeSeriesStamp = '{YYYY}-{MM}-{DD} {h}:{mm}{aa}';\n\nfunction timeSeriesVal(tzDate, stamp) {\n\treturn (self, val, seriesIdx, dataIdx) => dataIdx == null ? LEGEND_DISP : stamp(tzDate(val));\n}\n\nfunction legendStroke(self, seriesIdx) {\n\tlet s = self.series[seriesIdx];\n\treturn s.width ? s.stroke(self, seriesIdx) : s.points.width ? s.points.stroke(self, seriesIdx) : null;\n}\n\nfunction legendFill(self, seriesIdx) {\n\treturn self.series[seriesIdx].fill(self, seriesIdx);\n}\n\nconst legendOpts = {\n\tshow: true,\n\tlive: true,\n\tisolate: false,\n\tmount: noop,\n\tmarkers: {\n\t\tshow: true,\n\t\twidth: 2,\n\t\tstroke: legendStroke,\n\t\tfill: legendFill,\n\t\tdash: \"solid\",\n\t},\n\tidx: null,\n\tidxs: null,\n\tvalues: [],\n};\n\nfunction cursorPointShow(self, si) {\n\tlet o = self.cursor.points;\n\n\tlet pt = placeDiv();\n\n\tlet size = o.size(self, si);\n\tsetStylePx(pt, WIDTH, size);\n\tsetStylePx(pt, HEIGHT, size);\n\n\tlet mar = size / -2;\n\tsetStylePx(pt, \"marginLeft\", mar);\n\tsetStylePx(pt, \"marginTop\", mar);\n\n\tlet width = o.width(self, si, size);\n\twidth && setStylePx(pt, \"borderWidth\", width);\n\n\treturn pt;\n}\n\nfunction cursorPointFill(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._fill || sp._stroke;\n}\n\nfunction cursorPointStroke(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._stroke || sp._fill;\n}\n\nfunction cursorPointSize(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp.size;\n}\n\nconst moveTuple = [0,0];\n\nfunction cursorMove(self, mouseLeft1, mouseTop1) {\n\tmoveTuple[0] = mouseLeft1;\n\tmoveTuple[1] = mouseTop1;\n\treturn moveTuple;\n}\n\nfunction filtBtn0(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\te.button == 0 && (!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nfunction filtTarg(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\t(!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nconst cursorOpts = {\n\tshow: true,\n\tx: true,\n\ty: true,\n\tlock: false,\n\tmove: cursorMove,\n\tpoints: {\n\t\tone:    false,\n\t\tshow:   cursorPointShow,\n\t\tsize:   cursorPointSize,\n\t\twidth:  0,\n\t\tstroke: cursorPointStroke,\n\t\tfill:   cursorPointFill,\n\t},\n\n\tbind: {\n\t\tmousedown:   filtBtn0,\n\t\tmouseup:     filtBtn0,\n\t\tclick:       filtBtn0, // legend clicks, not .u-over clicks\n\t\tdblclick:    filtBtn0,\n\n\t\tmousemove:   filtTarg,\n\t\tmouseleave:  filtTarg,\n\t\tmouseenter:  filtTarg,\n\t},\n\n\tdrag: {\n\t\tsetScale: true,\n\t\tx: true,\n\t\ty: false,\n\t\tdist: 0,\n\t\tuni: null,\n\t\tclick: (self, e) => {\n\t\t//\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t},\n\t\t_x: false,\n\t\t_y: false,\n\t},\n\n\tfocus: {\n\t\tdist: (self, seriesIdx, dataIdx, valPos, curPos) => valPos - curPos,\n\t\tprox: -1,\n\t\tbias: 0,\n\t},\n\n\thover: {\n\t\tskip: [void 0],\n\t\tprox: null,\n\t\tbias: 0,\n\t},\n\n\tleft: -10,\n\ttop: -10,\n\tidx: null,\n\tdataIdx: null,\n\tidxs: null,\n\n\tevent: null,\n};\n\nconst axisLines = {\n\tshow: true,\n\tstroke: \"rgba(0,0,0,0.07)\",\n\twidth: 2,\n//\tdash: [],\n};\n\nconst grid = assign({}, axisLines, {\n\tfilter: retArg1,\n});\n\nconst ticks = assign({}, grid, {\n\tsize: 10,\n});\n\nconst border = assign({}, axisLines, {\n\tshow: false,\n});\n\nconst font      = '12px system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\"';\nconst labelFont = \"bold \" + font;\nconst lineGap = 1.5;\t// font-size multiplier\n\nconst xAxisOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tstroke: hexBlack,\n\tspace: 50,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 2,\n//\tclass: \"x-vals\",\n//\tincrs: timeIncrs,\n//\tvalues: timeVals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\nconst numSeriesLabel = \"Value\";\nconst timeSeriesLabel = \"Time\";\n\nconst xSeriesOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tauto: false,\n\tsorted: 1,\n//\tlabel: \"Time\",\n//\tvalue: v => stamp(new Date(v * 1e3)),\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n};\n\nfunction numAxisVals(self, splits, axisIdx, foundSpace, foundIncr) {\n\treturn splits.map(v => v == null ? \"\" : fmtNum(v));\n}\n\nfunction numAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet splits = [];\n\n\tlet numDec = fixedDec.get(foundIncr) || 0;\n\n\tscaleMin = forceMin ? scaleMin : roundDec(incrRoundUp(scaleMin, foundIncr), numDec);\n\n\tfor (let val = scaleMin; val <= scaleMax; val = roundDec(val + foundIncr, numDec))\n\t\tsplits.push(Object.is(val, -0) ? 0 : val);\t\t// coalesces -0\n\n\treturn splits;\n}\n\n// this doesnt work for sin, which needs to come off from 0 independently in pos and neg dirs\nfunction logAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tconst splits = [];\n\n\tconst logBase = self.scales[self.axes[axisIdx].scale].log;\n\n\tconst logFn = logBase == 10 ? log10 : log2;\n\n\tconst exp = floor(logFn(scaleMin));\n\n\tfoundIncr = pow(logBase, exp);\n\n\t// boo: 10 ** -24 === 1.0000000000000001e-24\n\t// this grabs the proper 1e-24 one\n\tif (logBase == 10)\n\t\tfoundIncr = numIncrs[closestIdx(foundIncr, numIncrs)];\n\n\tlet split = scaleMin;\n\tlet nextMagIncr = foundIncr * logBase;\n\n\tif (logBase == 10)\n\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\n\tdo {\n\t\tsplits.push(split);\n\t\tsplit = split + foundIncr;\n\n\t\tif (logBase == 10 && !fixedDec.has(split))\n\t\t\tsplit = roundDec(split, fixedDec.get(foundIncr));\n\n\t\tif (split >= nextMagIncr) {\n\t\t\tfoundIncr = split;\n\t\t\tnextMagIncr = foundIncr * logBase;\n\n\t\t\tif (logBase == 10)\n\t\t\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\t\t}\n\t} while (split <= scaleMax);\n\n\treturn splits;\n}\n\nfunction asinhAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet sc = self.scales[self.axes[axisIdx].scale];\n\n\tlet linthresh = sc.asinh;\n\n\tlet posSplits = scaleMax > linthresh ? logAxisSplits(self, axisIdx, max(linthresh, scaleMin), scaleMax, foundIncr) : [linthresh];\n\tlet zero = scaleMax >= 0 && scaleMin <= 0 ? [0] : [];\n\tlet negSplits = scaleMin < -linthresh ? logAxisSplits(self, axisIdx, max(linthresh, -scaleMax), -scaleMin, foundIncr): [linthresh];\n\n\treturn negSplits.reverse().map(v => -v).concat(zero, posSplits);\n}\n\nconst RE_ALL   = /./;\nconst RE_12357 = /[12357]/;\nconst RE_125   = /[125]/;\nconst RE_1     = /1/;\n\nconst _filt = (splits, distr, re, keepMod) => splits.map((v, i) => ((distr == 4 && v == 0) || i % keepMod == 0 && re.test(v.toExponential()[v < 0 ? 1 : 0])) ? v : null);\n\nfunction log10AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet sc = self.scales[scaleKey];\n\n//\tif (sc.distr == 3 && sc.log == 2)\n//\t\treturn splits;\n\n\tlet valToPos = self.valToPos;\n\n\tlet minSpace = axis._space;\n\n\tlet _10 = valToPos(10, scaleKey);\n\n\tlet re = (\n\t\tvalToPos(9, scaleKey) - _10 >= minSpace ? RE_ALL :\n\t\tvalToPos(7, scaleKey) - _10 >= minSpace ? RE_12357 :\n\t\tvalToPos(5, scaleKey) - _10 >= minSpace ? RE_125 :\n\t\tRE_1\n\t);\n\n\tif (re == RE_1) {\n\t\tlet magSpace = abs(valToPos(1, scaleKey) - _10);\n\n\t\tif (magSpace < minSpace)\n\t\t\treturn _filt(splits.slice().reverse(), sc.distr, re, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\t}\n\n\treturn _filt(splits, sc.distr, re, 1);\n}\n\nfunction log2AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet minSpace = axis._space;\n\tlet valToPos = self.valToPos;\n\n\tlet magSpace = abs(valToPos(1, scaleKey) - valToPos(2, scaleKey));\n\n\tif (magSpace < minSpace)\n\t\treturn _filt(splits.slice().reverse(), 3, RE_ALL, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\n\treturn splits;\n}\n\nfunction numSeriesVal(self, val, seriesIdx, dataIdx) {\n\treturn dataIdx == null ? LEGEND_DISP : val == null ? \"\" : fmtNum(val);\n}\n\nconst yAxisOpts = {\n\tshow: true,\n\tscale: \"y\",\n\tstroke: hexBlack,\n\tspace: 30,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 3,\n//\tclass: \"y-vals\",\n//\tincrs: numIncrs,\n//\tvalues: (vals, space) => vals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\n// takes stroke width\nfunction ptDia(width, mult) {\n\tlet dia = 3 + (width || 1) * 2;\n\treturn roundDec(dia * mult, 3);\n}\n\nfunction seriesPointsShow(self, si) {\n\tlet { scale, idxs } = self.series[0];\n\tlet xData = self._data[0];\n\tlet p0 = self.valToPos(xData[idxs[0]], scale, true);\n\tlet p1 = self.valToPos(xData[idxs[1]], scale, true);\n\tlet dim = abs(p1 - p0);\n\n\tlet s = self.series[si];\n//\tconst dia = ptDia(s.width, pxRatio);\n\tlet maxPts = dim / (s.points.space * pxRatio);\n\treturn idxs[1] - idxs[0] <= maxPts;\n}\n\nconst facet = {\n\tscale: null,\n\tauto: true,\n\tsorted: 0,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n};\n\nconst gaps = (self, seriesIdx, idx0, idx1, nullGaps) => nullGaps;\n\nconst xySeriesOpts = {\n\tshow: true,\n\tauto: true,\n\tsorted: 0,\n\tgaps,\n\talpha: 1,\n\tfacets: [\n\t\tassign({}, facet, {scale: 'x'}),\n\t\tassign({}, facet, {scale: 'y'}),\n\t],\n};\n\nconst ySeriesOpts = {\n\tscale: \"y\",\n\tauto: true,\n\tsorted: 0,\n\tshow: true,\n\tspanGaps: false,\n\tgaps,\n\talpha: 1,\n\tpoints: {\n\t\tshow: seriesPointsShow,\n\t\tfilter: null,\n\t//  paths:\n\t//\tstroke: \"#000\",\n\t//\tfill: \"#fff\",\n\t//\twidth: 1,\n\t//\tsize: 10,\n\t},\n//\tlabel: \"Value\",\n//\tvalue: v => v,\n\tvalues: null,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n\n\tpath: null,\n\tclip: null,\n};\n\nfunction clampScale(self, val, scaleMin, scaleMax, scaleKey) {\n/*\n\tif (val < 0) {\n\t\tlet cssHgt = self.bbox.height / pxRatio;\n\t\tlet absPos = self.valToPos(abs(val), scaleKey);\n\t\tlet fromBtm = cssHgt - absPos;\n\t\treturn self.posToVal(cssHgt + fromBtm, scaleKey);\n\t}\n*/\n\treturn scaleMin / 10;\n}\n\nconst xScaleOpts = {\n\ttime: FEAT_TIME,\n\tauto: true,\n\tdistr: 1,\n\tlog: 10,\n\tasinh: 1,\n\tmin: null,\n\tmax: null,\n\tdir: 1,\n\tori: 0,\n};\n\nconst yScaleOpts = assign({}, xScaleOpts, {\n\ttime: false,\n\tori: 1,\n});\n\nconst syncs = {};\n\nfunction _sync(key, opts) {\n\tlet s = syncs[key];\n\n\tif (!s) {\n\t\ts = {\n\t\t\tkey,\n\t\t\tplots: [],\n\t\t\tsub(plot) {\n\t\t\t\ts.plots.push(plot);\n\t\t\t},\n\t\t\tunsub(plot) {\n\t\t\t\ts.plots = s.plots.filter(c => c != plot);\n\t\t\t},\n\t\t\tpub(type, self, x, y, w, h, i) {\n\t\t\t\tfor (let j = 0; j < s.plots.length; j++)\n\t\t\t\t\ts.plots[j] != self && s.plots[j].pub(type, self, x, y, w, h, i);\n\t\t\t},\n\t\t};\n\n\t\tif (key != null)\n\t\t\tsyncs[key] = s;\n\t}\n\n\treturn s;\n}\n\nconst BAND_CLIP_FILL   = 1 << 0;\nconst BAND_CLIP_STROKE = 1 << 1;\n\nfunction orient(u, seriesIdx, cb) {\n\tconst mode = u.mode;\n\tconst series = u.series[seriesIdx];\n\tconst data = mode == 2 ? u._data[seriesIdx] : u._data;\n\tconst scales = u.scales;\n\tconst bbox   = u.bbox;\n\n\tlet dx = data[0],\n\t\tdy = mode == 2 ? data[1] : data[seriesIdx],\n\t\tsx = mode == 2 ? scales[series.facets[0].scale] : scales[u.series[0].scale],\n\t\tsy = mode == 2 ? scales[series.facets[1].scale] : scales[series.scale],\n\t\tl = bbox.left,\n\t\tt = bbox.top,\n\t\tw = bbox.width,\n\t\th = bbox.height,\n\t\tH = u.valToPosH,\n\t\tV = u.valToPosV;\n\n\treturn (sx.ori == 0\n\t\t? cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tH,\n\t\t\tV,\n\t\t\tl,\n\t\t\tt,\n\t\t\tw,\n\t\t\th,\n\t\t\tmoveToH,\n\t\t\tlineToH,\n\t\t\trectH,\n\t\t\tarcH,\n\t\t\tbezierCurveToH,\n\t\t)\n\t\t: cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tV,\n\t\t\tH,\n\t\t\tt,\n\t\t\tl,\n\t\t\th,\n\t\t\tw,\n\t\t\tmoveToV,\n\t\t\tlineToV,\n\t\t\trectV,\n\t\t\tarcV,\n\t\t\tbezierCurveToV,\n\t\t)\n\t);\n}\n\nfunction bandFillClipDirs(self, seriesIdx) {\n\tlet fillDir = 0;\n\n\t// 2 bits, -1 | 1\n\tlet clipDirs = 0;\n\n\tlet bands = ifNull(self.bands, EMPTY_ARR);\n\n\tfor (let i = 0; i < bands.length; i++) {\n\t\tlet b = bands[i];\n\n\t\t// is a \"from\" band edge\n\t\tif (b.series[0] == seriesIdx)\n\t\t\tfillDir = b.dir;\n\t\t// is a \"to\" band edge\n\t\telse if (b.series[1] == seriesIdx) {\n\t\t\tif (b.dir == 1)\n\t\t\t\tclipDirs |= 1;\n\t\t\telse\n\t\t\t\tclipDirs |= 2;\n\t\t}\n\t}\n\n\treturn [\n\t\tfillDir,\n\t\t(\n\t\t\tclipDirs == 1 ? -1 : // neg only\n\t\t\tclipDirs == 2 ?  1 : // pos only\n\t\t\tclipDirs == 3 ?  2 : // both\n\t\t\t                 0   // neither\n\t\t)\n\t];\n}\n\nfunction seriesFillTo(self, seriesIdx, dataMin, dataMax, bandFillDir) {\n\tlet mode = self.mode;\n\tlet series = self.series[seriesIdx];\n\tlet scaleKey = mode == 2 ? series.facets[1].scale : series.scale;\n\tlet scale = self.scales[scaleKey];\n\n\treturn (\n\t\tbandFillDir == -1 ? scale.min :\n\t\tbandFillDir ==  1 ? scale.max :\n\t\tscale.distr ==  3 ? (\n\t\t\tscale.dir == 1 ? scale.min :\n\t\t\tscale.max\n\t\t) : 0\n\t);\n}\n\n// creates inverted band clip path (from stroke path -> yMax || yMin)\n// clipDir is always inverse of fillDir\n// default clip dir is upwards (1), since default band fill is downwards/fillBelowTo (-1) (highIdx -> lowIdx)\nfunction clipBandLine(self, seriesIdx, idx0, idx1, strokePath, clipDir) {\n\treturn orient(self, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\tlet pxRound = series.pxRound;\n\n\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\tconst lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\tlet frIdx, toIdx;\n\n\t\tif (dir == 1) {\n\t\t\tfrIdx = idx0;\n\t\t\ttoIdx = idx1;\n\t\t}\n\t\telse {\n\t\t\tfrIdx = idx1;\n\t\t\ttoIdx = idx0;\n\t\t}\n\n\t\t// path start\n\t\tlet x0 = pxRound(valToPosX(dataX[frIdx], scaleX, xDim, xOff));\n\t\tlet y0 = pxRound(valToPosY(dataY[frIdx], scaleY, yDim, yOff));\n\t\t// path end x\n\t\tlet x1 = pxRound(valToPosX(dataX[toIdx], scaleX, xDim, xOff));\n\t\t// upper or lower y limit\n\t\tlet yLimit = pxRound(valToPosY(clipDir == 1 ? scaleY.max : scaleY.min, scaleY, yDim, yOff));\n\n\t\tlet clip = new Path2D(strokePath);\n\n\t\tlineTo(clip, x1, yLimit);\n\t\tlineTo(clip, x0, yLimit);\n\t\tlineTo(clip, x0, y0);\n\n\t\treturn clip;\n\t});\n}\n\nfunction clipGaps(gaps, ori, plotLft, plotTop, plotWid, plotHgt) {\n\tlet clip = null;\n\n\t// create clip path (invert gaps and non-gaps)\n\tif (gaps.length > 0) {\n\t\tclip = new Path2D();\n\n\t\tconst rect = ori == 0 ? rectH : rectV;\n\n\t\tlet prevGapEnd = plotLft;\n\n\t\tfor (let i = 0; i < gaps.length; i++) {\n\t\t\tlet g = gaps[i];\n\n\t\t\tif (g[1] > g[0]) {\n\t\t\t\tlet w = g[0] - prevGapEnd;\n\n\t\t\t\tw > 0 && rect(clip, prevGapEnd, plotTop, w, plotTop + plotHgt);\n\n\t\t\t\tprevGapEnd = g[1];\n\t\t\t}\n\t\t}\n\n\t\tlet w = plotLft + plotWid - prevGapEnd;\n\n\t\t// hack to ensure we expand the clip enough to avoid cutting off strokes at edges\n\t\tlet maxStrokeWidth = 10;\n\n\t\tw > 0 && rect(clip, prevGapEnd, plotTop - maxStrokeWidth / 2, w, plotTop + plotHgt + maxStrokeWidth);\n\t}\n\n\treturn clip;\n}\n\nfunction addGap(gaps, fromX, toX) {\n\tlet prevGap = gaps[gaps.length - 1];\n\n\tif (prevGap && prevGap[0] == fromX)\t\t\t// TODO: gaps must be encoded at stroke widths?\n\t\tprevGap[1] = toX;\n\telse\n\t\tgaps.push([fromX, toX]);\n}\n\nfunction findGaps(xs, ys, idx0, idx1, dir, pixelForX, align) {\n\tlet gaps = [];\n\tlet len = xs.length;\n\n\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\tlet yVal = ys[i];\n\n\t\tif (yVal === null) {\n\t\t\tlet fr = i, to = i;\n\n\t\t\tif (dir == 1) {\n\t\t\t\twhile (++i <= idx1 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\twhile (--i >= idx0 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\n\t\t\tlet frPx = pixelForX(xs[fr]);\n\t\t\tlet toPx = to == fr ? frPx : pixelForX(xs[to]);\n\n\t\t\t// if value adjacent to edge null is same pixel, then it's partially\n\t\t\t// filled and gap should start at next pixel\n\t\t\tlet fri2 = fr - dir;\n\t\t\tlet frPx2 = align <= 0 && fri2 >= 0 && fri2 < len ? pixelForX(xs[fri2]) : frPx;\n\t\t//\tif (frPx2 == frPx)\n\t\t//\t\tfrPx++;\n\t\t//\telse\n\t\t\t\tfrPx = frPx2;\n\n\t\t\tlet toi2 = to + dir;\n\t\t\tlet toPx2 = align >= 0 && toi2 >= 0 && toi2 < len ? pixelForX(xs[toi2]) : toPx;\n\t\t//\tif (toPx2 == toPx)\n\t\t//\t\ttoPx--;\n\t\t//\telse\n\t\t\t\ttoPx = toPx2;\n\n\t\t\tif (toPx >= frPx)\n\t\t\t\tgaps.push([frPx, toPx]); // addGap\n\t\t}\n\t}\n\n\treturn gaps;\n}\n\nfunction pxRoundGen(pxAlign) {\n\treturn pxAlign == 0 ? retArg0 : pxAlign == 1 ? round : v => incrRound(v, pxAlign);\n}\n\n/*\n// inefficient linear interpolation that does bi-directinal scans on each call\nexport function costlyLerp(i, idx0, idx1, _dirX, dataY) {\n\tlet prevNonNull = nonNullIdx(dataY, _dirX == 1 ? idx0 : idx1, i, -_dirX);\n\tlet nextNonNull = nonNullIdx(dataY, i, _dirX == 1 ? idx1 : idx0,  _dirX);\n\n\tlet prevVal = dataY[prevNonNull];\n\tlet nextVal = dataY[nextNonNull];\n\n\treturn prevVal + (i - prevNonNull) / (nextNonNull - prevNonNull) * (nextVal - prevVal);\n}\n*/\n\nfunction rect(ori) {\n\tlet moveTo = ori == 0 ?\n\t\tmoveToH :\n\t\tmoveToV;\n\n\tlet arcTo = ori == 0 ?\n\t\t(p, x1, y1, x2, y2, r) => { p.arcTo(x1, y1, x2, y2, r); } :\n\t\t(p, y1, x1, y2, x2, r) => { p.arcTo(x1, y1, x2, y2, r); };\n\n\tlet rect = ori == 0 ?\n\t\t(p, x, y, w, h) => { p.rect(x, y, w, h); } :\n\t\t(p, y, x, h, w) => { p.rect(x, y, w, h); };\n\n\t// TODO (pending better browser support): https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/roundRect\n\treturn (p, x, y, w, h, endRad = 0, baseRad = 0) => {\n\t\tif (endRad == 0 && baseRad == 0)\n\t\t\trect(p, x, y, w, h);\n\t\telse {\n\t\t\tendRad  = min(endRad,  w / 2, h / 2);\n\t\t\tbaseRad = min(baseRad, w / 2, h / 2);\n\n\t\t\t// adapted from https://stackoverflow.com/questions/1255512/how-to-draw-a-rounded-rectangle-using-html-canvas/7838871#7838871\n\t\t\tmoveTo(p, x + endRad, y);\n\t\t\tarcTo(p, x + w, y, x + w, y + h, endRad);\n\t\t\tarcTo(p, x + w, y + h, x, y + h, baseRad);\n\t\t\tarcTo(p, x, y + h, x, y, baseRad);\n\t\t\tarcTo(p, x, y, x + w, y, endRad);\n\t\t\tp.closePath();\n\t\t}\n\t};\n}\n\n// orientation-inverting canvas functions\nconst moveToH = (p, x, y) => { p.moveTo(x, y); };\nconst moveToV = (p, y, x) => { p.moveTo(x, y); };\nconst lineToH = (p, x, y) => { p.lineTo(x, y); };\nconst lineToV = (p, y, x) => { p.lineTo(x, y); };\nconst rectH = rect(0);\nconst rectV = rect(1);\nconst arcH = (p, x, y, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst arcV = (p, y, x, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst bezierCurveToH = (p, bp1x, bp1y, bp2x, bp2y, p2x, p2y) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\nconst bezierCurveToV = (p, bp1y, bp1x, bp2y, bp2x, p2y, p2x) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\n\n// TODO: drawWrap(seriesIdx, drawPoints) (save, restore, translate, clip)\nfunction points(opts) {\n\treturn (u, seriesIdx, idx0, idx1, filtIdxs) => {\n\t//\tlog(\"drawPoints()\", arguments);\n\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet { pxRound, points } = series;\n\n\t\t\tlet moveTo, arc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tarc = arcH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tarc = arcV;\n\t\t\t}\n\n\t\t\tconst width = roundDec(points.width * pxRatio, 3);\n\n\t\t\tlet rad = (points.size - points.width) / 2 * pxRatio;\n\t\t\tlet dia = roundDec(rad * 2, 3);\n\n\t\t\tlet fill = new Path2D();\n\t\t\tlet clip = new Path2D();\n\n\t\t\tlet { left: lft, top: top, width: wid, height: hgt } = u.bbox;\n\n\t\t\trectH(clip,\n\t\t\t\tlft - dia,\n\t\t\t\ttop - dia,\n\t\t\t\twid + dia * 2,\n\t\t\t\thgt + dia * 2,\n\t\t\t);\n\n\t\t\tconst drawPoint = pi => {\n\t\t\t\tif (dataY[pi] != null) {\n\t\t\t\t\tlet x = pxRound(valToPosX(dataX[pi], scaleX, xDim, xOff));\n\t\t\t\t\tlet y = pxRound(valToPosY(dataY[pi], scaleY, yDim, yOff));\n\n\t\t\t\t\tmoveTo(fill, x + rad, y);\n\t\t\t\t\tarc(fill, x, y, rad, 0, PI * 2);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (filtIdxs)\n\t\t\t\tfiltIdxs.forEach(drawPoint);\n\t\t\telse {\n\t\t\t\tfor (let pi = idx0; pi <= idx1; pi++)\n\t\t\t\t\tdrawPoint(pi);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstroke: width > 0 ? fill : null,\n\t\t\t\tfill,\n\t\t\t\tclip,\n\t\t\t\tflags: BAND_CLIP_FILL | BAND_CLIP_STROKE,\n\t\t\t};\n\t\t});\n\t};\n}\n\nfunction _drawAcc(lineTo) {\n\treturn (stroke, accX, minY, maxY, inY, outY) => {\n\t\tif (minY != maxY) {\n\t\t\tif (inY != minY && outY != minY)\n\t\t\t\tlineTo(stroke, accX, minY);\n\t\t\tif (inY != maxY && outY != maxY)\n\t\t\t\tlineTo(stroke, accX, maxY);\n\n\t\t\tlineTo(stroke, accX, outY);\n\t\t}\n\t};\n}\n\nconst drawAccH = _drawAcc(lineToH);\nconst drawAccV = _drawAcc(lineToV);\n\nfunction linear(opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo, drawAcc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tdrawAcc = drawAccH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tdrawAcc = drawAccV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet hasGap = false;\n\n\t\t\t// decimate when number of points >= 4x available pixels\n\t\t\tconst decimate = idx1 - idx0 >= xDim * 4;\n\n\t\t\tif (decimate) {\n\t\t\t\tlet xForPixel = pos => u.posToVal(pos, scaleX.key, true);\n\n\t\t\t\tlet minY = null,\n\t\t\t\t\tmaxY = null,\n\t\t\t\t\tinY, outY, drawnAtX;\n\n\t\t\t\tlet accX = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\n\t\t\t\tlet idx0px = pixelForX(dataX[idx0]);\n\t\t\t\tlet idx1px = pixelForX(dataX[idx1]);\n\n\t\t\t\t// tracks limit of current x bucket to avoid having to get x pixel for every x value\n\t\t\t\tlet nextAccXVal = xForPixel(dir == 1 ? idx0px + 1 : idx1px - 1);\n\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet reuseAccX = dir == 1 ? (xVal < nextAccXVal) : (xVal > nextAccXVal);\n\t\t\t\t\tlet x = reuseAccX ? accX :  pixelForX(xVal);\n\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (x == accX) {\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\n\t\t\t\t\t\t\tif (minY == null) {\n\t\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\t\tinY = minY = maxY = outY;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (outY < minY)\n\t\t\t\t\t\t\t\t\tminY = outY;\n\t\t\t\t\t\t\t\telse if (outY > maxY)\n\t\t\t\t\t\t\t\t\tmaxY = outY;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (minY != null)\n\t\t\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\tminY = maxY = inY = outY;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tminY = maxY = null;\n\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taccX = x;\n\t\t\t\t\t\tnextAccXVal = xForPixel(accX + dir);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (minY != null && minY != maxY && drawnAtX != accX)\n\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\thasGap = true;\n\t\t\t\t\telse if (yVal != null)\n\t\t\t\t\t\tlineTo(stroke, pixelForX(dataX[i]), pixelForY(yVal));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillToVal = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillToVal);\n\n\t\t\t\tlet frX = pixelForX(dataX[idx0]);\n\t\t\t\tlet toX = pixelForX(dataX[idx1]);\n\n\t\t\t\tif (dir == -1)\n\t\t\t\t\t[toX, frX] = [frX, toX];\n\n\t\t\t\tlineTo(fill, toX, fillToY);\n\t\t\t\tlineTo(fill, frX, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) { // skip in mode: 2?\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\thasGap && gaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\n// BUG: align: -1 behaves like align: 1 when scale.dir: -1\nfunction stepped(opts) {\n\tconst align = ifNull(opts.align, 1);\n\t// whether to draw ascenders/descenders at null/gap bondaries\n\tconst ascDesc = ifNull(opts.ascDesc, false);\n\tconst alignGaps = ifNull(opts.alignGaps, 0);\n\tconst extend = ifNull(opts.extend, false);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet { left, width } = u.bbox;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet prevYPos  = pixelForY(dataY[dir == 1 ? idx0 : idx1]);\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet firstXPosExt = firstXPos;\n\n\t\t\tif (extend && align == -1) {\n\t\t\t\tfirstXPosExt = left;\n\t\t\t\tlineTo(stroke, firstXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlineTo(stroke, firstXPos, prevYPos);\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal1 = dataY[i];\n\n\t\t\t\tif (yVal1 == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet x1 = pixelForX(dataX[i]);\n\t\t\t\tlet y1 = pixelForY(yVal1);\n\n\t\t\t\tif (align == 1)\n\t\t\t\t\tlineTo(stroke, x1, prevYPos);\n\t\t\t\telse\n\t\t\t\t\tlineTo(stroke, prevXPos, y1);\n\n\t\t\t\tlineTo(stroke, x1, y1);\n\n\t\t\t\tprevYPos = y1;\n\t\t\t\tprevXPos = x1;\n\t\t\t}\n\n\t\t\tlet prevXPosExt = prevXPos;\n\n\t\t\tif (extend && align == 1) {\n\t\t\t\tprevXPosExt = left + width;\n\t\t\t\tlineTo(stroke, prevXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPosExt, fillToY);\n\t\t\t\tlineTo(fill, firstXPosExt, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t// expand/contract clips for ascenders/descenders\n\t\t\t\tlet halfStroke = (series.width * pxRatio) / 2;\n\t\t\t\tlet startsOffset = (ascDesc || align ==  1) ?  halfStroke : -halfStroke;\n\t\t\t\tlet endsOffset   = (ascDesc || align == -1) ? -halfStroke :  halfStroke;\n\n\t\t\t\tgaps.forEach(g => {\n\t\t\t\t\tg[0] += startsOffset;\n\t\t\t\t\tg[1] += endsOffset;\n\t\t\t\t});\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid = inf) {\n\tif (dataX.length > 1) {\n\t\t// prior index with non-undefined y data\n\t\tlet prevIdx = null;\n\n\t\t// scan full dataset for smallest adjacent delta\n\t\t// will not work properly for non-linear x scales, since does not do expensive valToPosX calcs till end\n\t\tfor (let i = 0, minDelta = Infinity; i < dataX.length; i++) {\n\t\t\tif (dataY[i] !== undefined) {\n\t\t\t\tif (prevIdx != null) {\n\t\t\t\t\tlet delta = abs(dataX[i] - dataX[prevIdx]);\n\n\t\t\t\t\tif (delta < minDelta) {\n\t\t\t\t\t\tminDelta = delta;\n\t\t\t\t\t\tcolWid = abs(valToPosX(dataX[i], scaleX, xDim, xOff) - valToPosX(dataX[prevIdx], scaleX, xDim, xOff));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprevIdx = i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn colWid;\n}\n\nfunction bars(opts) {\n\topts = opts || EMPTY_OBJ;\n\tconst size = ifNull(opts.size, [0.6, inf, 1]);\n\tconst align = opts.align || 0;\n\tconst _extraGap = (opts.gap || 0);\n\n\tlet ro = opts.radius;\n\n\tro =\n\t\t// [valueRadius, baselineRadius]\n\t\tro == null ? [0, 0] :\n\t\ttypeof ro == 'number' ? [ro, 0] : ro;\n\n\tconst radiusFn = fnOrSelf(ro);\n\n\tconst gapFactor = 1 - size[0];\n\tconst _maxWidth  = ifNull(size[1], inf);\n\tconst _minWidth  = ifNull(size[2], 1);\n\n\tconst disp = ifNull(opts.disp, EMPTY_OBJ);\n\tconst _each = ifNull(opts.each, _ => {});\n\n\tconst { fill: dispFills, stroke: dispStrokes } = disp;\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet pxRound = series.pxRound;\n\t\t\tlet _align = align;\n\n\t\t\tlet extraGap = _extraGap * pxRatio;\n\t\t\tlet maxWidth = _maxWidth * pxRatio;\n\t\t\tlet minWidth = _minWidth * pxRatio;\n\n\t\t\tlet valRadius, baseRadius;\n\n\t\t\tif (scaleX.ori == 0)\n\t\t\t\t[valRadius, baseRadius] = radiusFn(u, seriesIdx);\n\t\t\telse\n\t\t\t\t[baseRadius, valRadius] = radiusFn(u, seriesIdx);\n\n\t\t\tconst _dirX = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\t//\tconst _dirY = scaleY.dir * (scaleY.ori == 1 ? 1 : -1);\n\n\t\t\tlet rect = scaleX.ori == 0 ? rectH : rectV;\n\n\t\t\tlet each = scaleX.ori == 0 ? _each : (u, seriesIdx, i, top, lft, hgt, wid) => {\n\t\t\t\t_each(u, seriesIdx, i, lft, top, wid, hgt);\n\t\t\t};\n\n\t\t\t// band where this series is the \"from\" edge\n\t\t\tlet band = ifNull(u.bands, EMPTY_ARR).find(b => b.series[0] == seriesIdx);\n\n\t\t\tlet fillDir = band != null ? band.dir : 0;\n\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, fillDir);\n\t\t\tlet fillToY = pxRound(valToPosY(fillTo, scaleY, yDim, yOff));\n\n\t\t\t// barWid is to center of stroke\n\t\t\tlet xShift, barWid, fullGap, colWid = xDim;\n\n\t\t\tlet strokeWidth = pxRound(series.width * pxRatio);\n\n\t\t\tlet multiPath = false;\n\n\t\t\tlet fillColors = null;\n\t\t\tlet fillPaths = null;\n\t\t\tlet strokeColors = null;\n\t\t\tlet strokePaths = null;\n\n\t\t\tif (dispFills != null && (strokeWidth == 0 || dispStrokes != null)) {\n\t\t\t\tmultiPath = true;\n\n\t\t\t\tfillColors = dispFills.values(u, seriesIdx, idx0, idx1);\n\t\t\t\tfillPaths = new Map();\n\t\t\t\t(new Set(fillColors)).forEach(color => {\n\t\t\t\t\tif (color != null)\n\t\t\t\t\t\tfillPaths.set(color, new Path2D());\n\t\t\t\t});\n\n\t\t\t\tif (strokeWidth > 0) {\n\t\t\t\t\tstrokeColors = dispStrokes.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tstrokePaths = new Map();\n\t\t\t\t\t(new Set(strokeColors)).forEach(color => {\n\t\t\t\t\t\tif (color != null)\n\t\t\t\t\t\t\tstrokePaths.set(color, new Path2D());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet { x0, size } = disp;\n\n\t\t\tif (x0 != null && size != null) {\n\t\t\t\t_align = 1;\n\t\t\t\tdataX = x0.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (x0.unit == 2)\n\t\t\t\t\tdataX = dataX.map(pct => u.posToVal(xOff + pct * xDim, scaleX.key, true));\n\n\t\t\t\t// assumes uniform sizes, for now\n\t\t\t\tlet sizes = size.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (size.unit == 2)\n\t\t\t\t\tbarWid = sizes[0] * xDim;\n\t\t\t\telse\n\t\t\t\t\tbarWid = valToPosX(sizes[0], scaleX, xDim, xOff) - valToPosX(0, scaleX, xDim, xOff); // assumes linear scale (delta from 0)\n\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid - barWid;\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid * gapFactor;\n\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t\tbarWid = colWid - fullGap;\n\t\t\t}\n\n\t\t\tif (fullGap < 1)\n\t\t\t\tfullGap = 0;\n\n\t\t\tif (strokeWidth >= barWid / 2)\n\t\t\t\tstrokeWidth = 0;\n\n\t\t\t// for small gaps, disable pixel snapping since gap inconsistencies become noticible and annoying\n\t\t\tif (fullGap < 5)\n\t\t\t\tpxRound = retArg0;\n\n\t\t\tlet insetStroke = fullGap > 0;\n\n\t\t\tlet rawBarWid = colWid - fullGap - (insetStroke ? strokeWidth : 0);\n\n\t\t\tbarWid = pxRound(clamp(rawBarWid, minWidth, maxWidth));\n\n\t\t\txShift = (_align == 0 ? barWid / 2 : _align == _dirX ? 0 : barWid) - _align * _dirX * ((_align == 0 ? extraGap / 2 : 0) + (insetStroke ? strokeWidth / 2 : 0));\n\n\n\t\t\tconst _paths = {stroke: null, fill: null, clip: null, band: null, gaps: null, flags: 0};  // disp, geom\n\n\t\t\tconst stroke = multiPath ? null : new Path2D();\n\n\t\t\tlet dataY0 = null;\n\n\t\t\tif (band != null)\n\t\t\t\tdataY0 = u.data[band.series[1]];\n\t\t\telse {\n\t\t\t\tlet { y0, y1 } = disp;\n\n\t\t\t\tif (y0 != null && y1 != null) {\n\t\t\t\t\tdataY = y1.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tdataY0 = y0.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet radVal = valRadius * barWid;\n\t\t\tlet radBase = baseRadius * barWid;\n\n\t\t\tfor (let i = _dirX == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += _dirX) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (dataY0 != null) {\n\t\t\t\t\tlet yVal0 = dataY0[i] ?? 0;\n\n\t\t\t\t\tif (yVal - yVal0 == 0)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tfillToY = valToPosY(yVal0, scaleY, yDim, yOff);\n\t\t\t\t}\n\n\t\t\t\tlet xVal = scaleX.distr != 2 || disp != null ? dataX[i] : i;\n\n\t\t\t\t// TODO: all xPos can be pre-computed once for all series in aligned set\n\t\t\t\tlet xPos = valToPosX(xVal, scaleX, xDim, xOff);\n\t\t\t\tlet yPos = valToPosY(ifNull(yVal, fillTo), scaleY, yDim, yOff);\n\n\t\t\t\tlet lft = pxRound(xPos - xShift);\n\t\t\t\tlet btm = pxRound(max(yPos, fillToY));\n\t\t\t\tlet top = pxRound(min(yPos, fillToY));\n\t\t\t\t// this includes the stroke\n\t\t\t\tlet barHgt = btm - top;\n\n\t\t\t\tif (yVal != null) {  // && yVal != fillTo (0 height bar)\n\t\t\t\t\tlet rv = yVal < 0 ? radBase : radVal;\n\t\t\t\t\tlet rb = yVal < 0 ? radVal : radBase;\n\n\t\t\t\t\tif (multiPath) {\n\t\t\t\t\t\tif (strokeWidth > 0 && strokeColors[i] != null)\n\t\t\t\t\t\t\trect(strokePaths.get(strokeColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\t\tif (fillColors[i] != null)\n\t\t\t\t\t\t\trect(fillPaths.get(fillColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\trect(stroke, lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\teach(u, seriesIdx, i,\n\t\t\t\t\t\tlft    - strokeWidth / 2,\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\tbarWid + strokeWidth,\n\t\t\t\t\t\tbarHgt,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strokeWidth > 0)\n\t\t\t\t_paths.stroke = multiPath ? strokePaths : stroke;\n\t\t\telse if (!multiPath) {\n\t\t\t\t_paths._fill = series.width == 0 ? series._fill : series._stroke ?? series._fill;\n\t\t\t\t_paths.width = 0;\n\t\t\t}\n\n\t\t\t_paths.fill = multiPath ? fillPaths : stroke;\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction splineInterp(interp, opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet moveTo, bezierCurveTo, lineTo;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tbezierCurveTo = bezierCurveToH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tbezierCurveTo = bezierCurveToV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet xCoords = [];\n\t\t\tlet yCoords = [];\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal != null) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet xPos = pixelForX(xVal);\n\n\t\t\t\t\txCoords.push(prevXPos = xPos);\n\t\t\t\t\tyCoords.push(pixelForY(dataY[i]));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst _paths = {stroke: interp(xCoords, yCoords, moveTo, lineTo, bezierCurveTo, pxRound), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPos, fillToY);\n\t\t\t\tlineTo(fill, firstXPos, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\n\t\t\t//  if FEAT_PATHS: false in rollup.config.js\n\t\t\t//\tu.ctx.save();\n\t\t\t//\tu.ctx.beginPath();\n\t\t\t//\tu.ctx.rect(u.bbox.left, u.bbox.top, u.bbox.width, u.bbox.height);\n\t\t\t//\tu.ctx.clip();\n\t\t\t//\tu.ctx.strokeStyle = u.series[sidx].stroke;\n\t\t\t//\tu.ctx.stroke(stroke);\n\t\t\t//\tu.ctx.fillStyle = u.series[sidx].fill;\n\t\t\t//\tu.ctx.fill(fill);\n\t\t\t//\tu.ctx.restore();\n\t\t\t//\treturn null;\n\t\t});\n\t};\n}\n\nfunction monotoneCubic(opts) {\n\treturn splineInterp(_monotoneCubic, opts);\n}\n\n// Monotone Cubic Spline interpolation, adapted from the Chartist.js implementation:\n// https://github.com/gionkunz/chartist-js/blob/e7e78201bffe9609915e5e53cfafa29a5d6c49f9/src/scripts/interpolation.js#L240-L369\nfunction _monotoneCubic(xs, ys, moveTo, lineTo, bezierCurveTo, pxRound) {\n\tconst n = xs.length;\n\n\tif (n < 2)\n\t\treturn null;\n\n\tconst path = new Path2D();\n\n\tmoveTo(path, xs[0], ys[0]);\n\n\tif (n == 2)\n\t\tlineTo(path, xs[1], ys[1]);\n\telse {\n\t\tlet ms  = Array(n),\n\t\t\tds  = Array(n - 1),\n\t\t\tdys = Array(n - 1),\n\t\t\tdxs = Array(n - 1);\n\n\t\t// calc deltas and derivative\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tdys[i] = ys[i + 1] - ys[i];\n\t\t\tdxs[i] = xs[i + 1] - xs[i];\n\t\t\tds[i]  = dys[i] / dxs[i];\n\t\t}\n\n\t\t// determine desired slope (m) at each point using Fritsch-Carlson method\n\t\t// http://math.stackexchange.com/questions/45218/implementation-of-monotone-cubic-interpolation\n\t\tms[0] = ds[0];\n\n\t\tfor (let i = 1; i < n - 1; i++) {\n\t\t\tif (ds[i] === 0 || ds[i - 1] === 0 || (ds[i - 1] > 0) !== (ds[i] > 0))\n\t\t\t\tms[i] = 0;\n\t\t\telse {\n\t\t\t\tms[i] = 3 * (dxs[i - 1] + dxs[i]) / (\n\t\t\t\t\t(2 * dxs[i] + dxs[i - 1]) / ds[i - 1] +\n\t\t\t\t\t(dxs[i] + 2 * dxs[i - 1]) / ds[i]\n\t\t\t\t);\n\n\t\t\t\tif (!isFinite(ms[i]))\n\t\t\t\t\tms[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\tms[n - 1] = ds[n - 2];\n\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tbezierCurveTo(\n\t\t\t\tpath,\n\t\t\t\txs[i] + dxs[i] / 3,\n\t\t\t\tys[i] + ms[i] * dxs[i] / 3,\n\t\t\t\txs[i + 1] - dxs[i] / 3,\n\t\t\t\tys[i + 1] - ms[i + 1] * dxs[i] / 3,\n\t\t\t\txs[i + 1],\n\t\t\t\tys[i + 1],\n\t\t\t);\n\t\t}\n\t}\n\n\treturn path;\n}\n\nconst cursorPlots = new Set();\n\nfunction invalidateRects() {\n\tfor (let u of cursorPlots)\n\t\tu.syncRect(true);\n}\n\nif (domEnv) {\n\ton(resize, win, invalidateRects);\n\ton(scroll, win, invalidateRects, true);\n\ton(dppxchange, win, () => { uPlot.pxRatio = pxRatio; });\n}\n\nconst linearPath = linear() ;\nconst pointsPath = points() ;\n\nfunction setDefaults(d, xo, yo, initY) {\n\tlet d2 = initY ? [d[0], d[1]].concat(d.slice(2)) : [d[0]].concat(d.slice(1));\n\treturn d2.map((o, i) => setDefault(o, i, xo, yo));\n}\n\nfunction setDefaults2(d, xyo) {\n\treturn d.map((o, i) => i == 0 ? {} : assign({}, xyo, o));  // todo: assign() will not merge facet arrays\n}\n\nfunction setDefault(o, i, xo, yo) {\n\treturn assign({}, (i == 0 ? xo : yo), o);\n}\n\nfunction snapNumX(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : [dataMin, dataMax];\n}\n\nconst snapTimeX = snapNumX;\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction snapNumY(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, rangePad, true);\n}\n\nfunction snapLogY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeLog(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapLogX = snapLogY;\n\nfunction snapAsinhY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeAsinh(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapAsinhX = snapAsinhY;\n\n// dim is logical (getClientBoundingRect) pixels, not canvas pixels\nfunction findIncr(minVal, maxVal, incrs, dim, minSpace) {\n\tlet intDigits = max(numIntDigits(minVal), numIntDigits(maxVal));\n\n\tlet delta = maxVal - minVal;\n\n\tlet incrIdx = closestIdx((minSpace / dim) * delta, incrs);\n\n\tdo {\n\t\tlet foundIncr = incrs[incrIdx];\n\t\tlet foundSpace = dim * foundIncr / delta;\n\n\t\tif (foundSpace >= minSpace && intDigits + (foundIncr < 5 ? fixedDec.get(foundIncr) : 0) <= 17)\n\t\t\treturn [foundIncr, foundSpace];\n\t} while (++incrIdx < incrs.length);\n\n\treturn [0, 0];\n}\n\nfunction pxRatioFont(font) {\n\tlet fontSize, fontSizeCss;\n\tfont = font.replace(/(\\d+)px/, (m, p1) => (fontSize = round((fontSizeCss = +p1) * pxRatio)) + 'px');\n\treturn [font, fontSize, fontSizeCss];\n}\n\nfunction syncFontSize(axis) {\n\tif (axis.show) {\n\t\t[axis.font, axis.labelFont].forEach(f => {\n\t\t\tlet size = roundDec(f[2] * pxRatio, 1);\n\t\t\tf[0] = f[0].replace(/[0-9.]+px/, size + 'px');\n\t\t\tf[1] = size;\n\t\t});\n\t}\n}\n\nfunction uPlot(opts, data, then) {\n\tconst self = {\n\t\tmode: ifNull(opts.mode, 1),\n\t};\n\n\tconst mode = self.mode;\n\n\tfunction getHPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? (1 - pct) : pct);\n\t}\n\n\tfunction getVPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? pct : (1 - pct));\n\t}\n\n\tfunction getPos(val, scale, dim, off) {\n\t\treturn scale.ori == 0 ? getHPos(val, scale, dim, off) : getVPos(val, scale, dim, off);\n\t}\n\n\tself.valToPosH = getHPos;\n\tself.valToPosV = getVPos;\n\n\tlet ready = false;\n\tself.status = 0;\n\n\tconst root = self.root = placeDiv(UPLOT);\n\n\tif (opts.id != null)\n\t\troot.id = opts.id;\n\n\taddClass(root, opts.class);\n\n\tif (opts.title) {\n\t\tlet title = placeDiv(TITLE, root);\n\t\ttitle.textContent = opts.title;\n\t}\n\n\tconst can = placeTag(\"canvas\");\n\tconst ctx = self.ctx = can.getContext(\"2d\");\n\n\tconst wrap = placeDiv(WRAP, root);\n\n\ton(\"click\", wrap, e => {\n\t\tif (e.target === over) {\n\t\t\tlet didDrag = mouseLeft1 != mouseLeft0 || mouseTop1 != mouseTop0;\n\t\t\tdidDrag && drag.click(self, e);\n\t\t}\n\t}, true);\n\n\tconst under = self.under = placeDiv(UNDER, wrap);\n\twrap.appendChild(can);\n\tconst over = self.over = placeDiv(OVER, wrap);\n\n\topts = copy(opts);\n\n\tconst pxAlign = +ifNull(opts.pxAlign, 1);\n\n\tconst pxRound = pxRoundGen(pxAlign);\n\n\t(opts.plugins || []).forEach(p => {\n\t\tif (p.opts)\n\t\t\topts = p.opts(self, opts) || opts;\n\t});\n\n\tconst ms = opts.ms || 1e-3;\n\n\tconst series  = self.series = mode == 1 ?\n\t\tsetDefaults(opts.series || [], xSeriesOpts, ySeriesOpts, false) :\n\t\tsetDefaults2(opts.series || [null], xySeriesOpts);\n\tconst axes    = self.axes   = setDefaults(opts.axes   || [], xAxisOpts,   yAxisOpts,    true);\n\tconst scales  = self.scales = {};\n\tconst bands   = self.bands  = opts.bands || [];\n\n\tbands.forEach(b => {\n\t\tb.fill = fnOrSelf(b.fill || null);\n\t\tb.dir = ifNull(b.dir, -1);\n\t});\n\n\tconst xScaleKey = mode == 2 ? series[1].facets[0].scale : series[0].scale;\n\n\tconst drawOrderMap = {\n\t\taxes: drawAxesGrid,\n\t\tseries: drawSeries,\n\t};\n\n\tconst drawOrder = (opts.drawOrder || [\"axes\", \"series\"]).map(key => drawOrderMap[key]);\n\n\tfunction initValToPct(sc) {\n\t\tconst getVal = (\n\t\t\tsc.distr == 3   ? val => log10(val > 0 ? val : sc.clamp(self, val, sc.min, sc.max, sc.key)) :\n\t\t\tsc.distr == 4   ? val => asinh(val, sc.asinh) :\n\t\t\tsc.distr == 100 ? val => sc.fwd(val) :\n\t\t\tval => val\n\t\t);\n\n\t\treturn val => {\n\t\t\tlet _val = getVal(val);\n\t\t\tlet { _min, _max } = sc;\n\t\t\tlet delta = _max - _min;\n\t\t\treturn (_val - _min) / delta;\n\t\t};\n\t}\n\n\tfunction initScale(scaleKey) {\n\t\tlet sc = scales[scaleKey];\n\n\t\tif (sc == null) {\n\t\t\tlet scaleOpts = (opts.scales || EMPTY_OBJ)[scaleKey] || EMPTY_OBJ;\n\n\t\t\tif (scaleOpts.from != null) {\n\t\t\t\t// ensure parent is initialized\n\t\t\t\tinitScale(scaleOpts.from);\n\t\t\t\t// dependent scales inherit\n\t\t\t\tlet sc = assign({}, scales[scaleOpts.from], scaleOpts, {key: scaleKey});\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t\tscales[scaleKey] = sc;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsc = scales[scaleKey] = assign({}, (scaleKey == xScaleKey ? xScaleOpts : yScaleOpts), scaleOpts);\n\n\t\t\t\tsc.key = scaleKey;\n\n\t\t\t\tlet isTime = sc.time;\n\n\t\t\t\tlet rn = sc.range;\n\n\t\t\t\tlet rangeIsArr = isArr(rn);\n\n\t\t\t\tif (scaleKey != xScaleKey || (mode == 2 && !isTime)) {\n\t\t\t\t\t// if range array has null limits, it should be auto\n\t\t\t\t\tif (rangeIsArr && (rn[0] == null || rn[1] == null)) {\n\t\t\t\t\t\trn = {\n\t\t\t\t\t\t\tmin: rn[0] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[0],\n\t\t\t\t\t\t\t\tsoft: rn[0],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmax: rn[1] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[1],\n\t\t\t\t\t\t\t\tsoft: rn[1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t\trangeIsArr = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rangeIsArr && isObj(rn)) {\n\t\t\t\t\t\tlet cfg = rn;\n\t\t\t\t\t\t// this is similar to snapNumY\n\t\t\t\t\t\trn = (self, dataMin, dataMax) => dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, cfg);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsc.range = fnOrSelf(rn || (isTime ? snapTimeX : scaleKey == xScaleKey ?\n\t\t\t\t\t(sc.distr == 3 ? snapLogX : sc.distr == 4 ? snapAsinhX : snapNumX) :\n\t\t\t\t\t(sc.distr == 3 ? snapLogY : sc.distr == 4 ? snapAsinhY : snapNumY)\n\t\t\t\t));\n\n\t\t\t\tsc.auto = fnOrSelf(rangeIsArr ? false : sc.auto);\n\n\t\t\t\tsc.clamp = fnOrSelf(sc.clamp || clampScale);\n\n\t\t\t\t// caches for expensive ops like asinh() & log()\n\t\t\t\tsc._min = sc._max = null;\n\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitScale(\"x\");\n\tinitScale(\"y\");\n\n\t// TODO: init scales from facets in mode: 2\n\tif (mode == 1) {\n\t\tseries.forEach(s => {\n\t\t\tinitScale(s.scale);\n\t\t});\n\t}\n\n\taxes.forEach(a => {\n\t\tinitScale(a.scale);\n\t});\n\n\tfor (let k in opts.scales)\n\t\tinitScale(k);\n\n\tconst scaleX = scales[xScaleKey];\n\n\tconst xScaleDistr = scaleX.distr;\n\n\tlet valToPosX, valToPosY;\n\n\tif (scaleX.ori == 0) {\n\t\taddClass(root, ORI_HZ);\n\t\tvalToPosX = getHPos;\n\t\tvalToPosY = getVPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotWid;\n\t\t\txOffCan = plotLft;\n\t\t\tyDimCan = plotHgt;\n\t\t\tyOffCan = plotTop;\n\n\t\t\txDimCss = plotWidCss;\n\t\t\txOffCss = plotLftCss;\n\t\t\tyDimCss = plotHgtCss;\n\t\t\tyOffCss = plotTopCss;\n\t\t};\n\t\t*/\n\t}\n\telse {\n\t\taddClass(root, ORI_VT);\n\t\tvalToPosX = getVPos;\n\t\tvalToPosY = getHPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotHgt;\n\t\t\txOffCan = plotTop;\n\t\t\tyDimCan = plotWid;\n\t\t\tyOffCan = plotLft;\n\n\t\t\txDimCss = plotHgtCss;\n\t\t\txOffCss = plotTopCss;\n\t\t\tyDimCss = plotWidCss;\n\t\t\tyOffCss = plotLftCss;\n\t\t};\n\t\t*/\n\t}\n\n\tconst pendScales = {};\n\n\t// explicitly-set initial scales\n\tfor (let k in scales) {\n\t\tlet sc = scales[k];\n\n\t\tif (sc.min != null || sc.max != null) {\n\t\t\tpendScales[k] = {min: sc.min, max: sc.max};\n\t\t\tsc.min = sc.max = null;\n\t\t}\n\t}\n\n//\tself.tz = opts.tz || Intl.DateTimeFormat().resolvedOptions().timeZone;\n\tconst _tzDate  = (opts.tzDate || (ts => new Date(round(ts / ms))));\n\tconst _fmtDate = (opts.fmtDate || fmtDate);\n\n\tconst _timeAxisSplits = (ms == 1 ? timeAxisSplitsMs(_tzDate) : timeAxisSplitsS(_tzDate));\n\tconst _timeAxisVals   = timeAxisVals(_tzDate, timeAxisStamps((ms == 1 ? _timeAxisStampsMs : _timeAxisStampsS), _fmtDate));\n\tconst _timeSeriesVal  = timeSeriesVal(_tzDate, timeSeriesStamp(_timeSeriesStamp, _fmtDate));\n\n\tconst activeIdxs = [];\n\n\tconst legend     = (self.legend = assign({}, legendOpts, opts.legend));\n\tconst cursor     =                (self.cursor = assign({}, cursorOpts, {drag: {y: mode == 2}}, opts.cursor));\n\tconst showLegend = legend.show;\n\tconst showCursor =                cursor.show;\n\tconst markers    = legend.markers;\n\n\t{\n\t\tlegend.idxs = activeIdxs;\n\n\t\tmarkers.width  = fnOrSelf(markers.width);\n\t\tmarkers.dash   = fnOrSelf(markers.dash);\n\t\tmarkers.stroke = fnOrSelf(markers.stroke);\n\t\tmarkers.fill   = fnOrSelf(markers.fill);\n\t}\n\n\tlet legendTable;\n\tlet legendHead;\n\tlet legendBody;\n\tlet legendRows = [];\n\tlet legendCells = [];\n\tlet legendCols;\n\tlet multiValLegend = false;\n\tlet NULL_LEGEND_VALUES = {};\n\n\tif (legend.live) {\n\t\tconst getMultiVals = series[1] ? series[1].values : null;\n\t\tmultiValLegend = getMultiVals != null;\n\t\tlegendCols = multiValLegend ? getMultiVals(self, 1, 0) : {_: 0};\n\n\t\tfor (let k in legendCols)\n\t\t\tNULL_LEGEND_VALUES[k] = LEGEND_DISP;\n\t}\n\n\tif (showLegend) {\n\t\tlegendTable = placeTag(\"table\", LEGEND, root);\n\t\tlegendBody = placeTag(\"tbody\", null, legendTable);\n\n\t\t// allows legend to be moved out of root\n\t\tlegend.mount(self, legendTable);\n\n\t\tif (multiValLegend) {\n\t\t\tlegendHead = placeTag(\"thead\", null, legendTable, legendBody);\n\n\t\t\tlet head = placeTag(\"tr\", null, legendHead);\n\t\t\tplaceTag(\"th\", null, head);\n\n\t\t\tfor (var key in legendCols)\n\t\t\t\tplaceTag(\"th\", LEGEND_LABEL, head).textContent = key;\n\t\t}\n\t\telse {\n\t\t\taddClass(legendTable, LEGEND_INLINE);\n\t\t\tlegend.live && addClass(legendTable, LEGEND_LIVE);\n\t\t}\n\t}\n\n\tconst son  = {show: true};\n\tconst soff = {show: false};\n\n\tfunction initLegendRow(s, i) {\n\t\tif (i == 0 && (multiValLegend || !legend.live || mode == 2))\n\t\t\treturn nullNullTuple;\n\n\t\tlet cells = [];\n\n\t\tlet row = placeTag(\"tr\", LEGEND_SERIES, legendBody, legendBody.childNodes[i]);\n\n\t\taddClass(row, s.class);\n\n\t\tif (!s.show)\n\t\t\taddClass(row, OFF);\n\n\t\tlet label = placeTag(\"th\", null, row);\n\n\t\tif (markers.show) {\n\t\t\tlet indic = placeDiv(LEGEND_MARKER, label);\n\n\t\t\tif (i > 0) {\n\t\t\t\tlet width  = markers.width(self, i);\n\n\t\t\t\tif (width)\n\t\t\t\t\tindic.style.border = width + \"px \" + markers.dash(self, i) + \" \" + markers.stroke(self, i);\n\n\t\t\t\tindic.style.background = markers.fill(self, i);\n\t\t\t}\n\t\t}\n\n\t\tlet text = placeDiv(LEGEND_LABEL, label);\n\n\t\tif (s.label instanceof HTMLElement)\n\t\t\ttext.appendChild(s.label);\n\t\telse\n\t\t\ttext.textContent = s.label;\n\n\t\tif (i > 0) {\n\t\t\tif (!markers.show)\n\t\t\t\ttext.style.color = s.width > 0 ? markers.stroke(self, i) : markers.fill(self, i);\n\n\t\t\tonMouse(\"click\", label, e => {\n\t\t\t\tif (cursor._lock)\n\t\t\t\t\treturn;\n\n\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\tlet seriesIdx = series.indexOf(s);\n\n\t\t\t\tif ((e.ctrlKey || e.metaKey) != legend.isolate) {\n\t\t\t\t\t// if any other series is shown, isolate this one. else show all\n\t\t\t\t\tlet isolate = series.some((s, i) => i > 0 && i != seriesIdx && s.show);\n\n\t\t\t\t\tseries.forEach((s, i) => {\n\t\t\t\t\t\ti > 0 && setSeries(i, isolate ? (i == seriesIdx ? son : soff) : son, true, syncOpts.setSeries);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsetSeries(seriesIdx, {show: !s.show}, true, syncOpts.setSeries);\n\t\t\t}, false);\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tonMouse(mouseenter, label, e => {\n\t\t\t\t\tif (cursor._lock)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\t\tsetSeries(series.indexOf(s), FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t\t\t}, false);\n\t\t\t}\n\t\t}\n\n\t\tfor (var key in legendCols) {\n\t\t\tlet v = placeTag(\"td\", LEGEND_VALUE, row);\n\t\t\tv.textContent = \"--\";\n\t\t\tcells.push(v);\n\t\t}\n\n\t\treturn [row, cells];\n\t}\n\n\tconst mouseListeners = new Map();\n\n\tfunction onMouse(ev, targ, fn, onlyTarg = true) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\t\tconst listener = cursor.bind[ev](self, targ, fn, onlyTarg);\n\n\t\tif (listener) {\n\t\t\ton(ev, targ, targListeners[ev] = listener);\n\t\t\tmouseListeners.set(targ, targListeners);\n\t\t}\n\t}\n\n\tfunction offMouse(ev, targ, fn) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\n\t\tfor (let k in targListeners) {\n\t\t\tif (ev == null || k == ev) {\n\t\t\t\toff(k, targ, targListeners[k]);\n\t\t\t\tdelete targListeners[k];\n\t\t\t}\n\t\t}\n\n\t\tif (ev == null)\n\t\t\tmouseListeners.delete(targ);\n\t}\n\n\tlet fullWidCss = 0;\n\tlet fullHgtCss = 0;\n\n\tlet plotWidCss = 0;\n\tlet plotHgtCss = 0;\n\n\t// plot margins to account for axes\n\tlet plotLftCss = 0;\n\tlet plotTopCss = 0;\n\n\t// previous values for diffing\n\tlet _plotLftCss = plotLftCss;\n\tlet _plotTopCss = plotTopCss;\n\tlet _plotWidCss = plotWidCss;\n\tlet _plotHgtCss = plotHgtCss;\n\n\n\tlet plotLft = 0;\n\tlet plotTop = 0;\n\tlet plotWid = 0;\n\tlet plotHgt = 0;\n\n\tself.bbox = {};\n\n\tlet shouldSetScales = false;\n\tlet shouldSetSize = false;\n\tlet shouldConvergeSize = false;\n\tlet shouldSetCursor = false;\n\tlet shouldSetSelect = false;\n\tlet shouldSetLegend = false;\n\n\tfunction _setSize(width, height, force) {\n\t\tif (force || (width != self.width || height != self.height))\n\t\t\tcalcSize(width, height);\n\n\t\tresetYSeries(false);\n\n\t\tshouldConvergeSize = true;\n\t\tshouldSetSize = true;\n\n\t\tcommit();\n\t}\n\n\tfunction calcSize(width, height) {\n\t//\tlog(\"calcSize()\", arguments);\n\n\t\tself.width  = fullWidCss = plotWidCss = width;\n\t\tself.height = fullHgtCss = plotHgtCss = height;\n\t\tplotLftCss  = plotTopCss = 0;\n\n\t\tcalcPlotRect();\n\t\tcalcAxesRects();\n\n\t\tlet bb = self.bbox;\n\n\t\tplotLft = bb.left   = incrRound(plotLftCss * pxRatio, 0.5);\n\t\tplotTop = bb.top    = incrRound(plotTopCss * pxRatio, 0.5);\n\t\tplotWid = bb.width  = incrRound(plotWidCss * pxRatio, 0.5);\n\t\tplotHgt = bb.height = incrRound(plotHgtCss * pxRatio, 0.5);\n\n\t//\tupdOriDims();\n\t}\n\n\t// ensures size calc convergence\n\tconst CYCLE_LIMIT = 3;\n\n\tfunction convergeSize() {\n\t\tlet converged = false;\n\n\t\tlet cycleNum = 0;\n\n\t\twhile (!converged) {\n\t\t\tcycleNum++;\n\n\t\t\tlet axesConverged = axesCalc(cycleNum);\n\t\t\tlet paddingConverged = paddingCalc(cycleNum);\n\n\t\t\tconverged = cycleNum == CYCLE_LIMIT || (axesConverged && paddingConverged);\n\n\t\t\tif (!converged) {\n\t\t\t\tcalcSize(self.width, self.height);\n\t\t\t\tshouldSetSize = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setSize({width, height}) {\n\t\t_setSize(width, height);\n\t}\n\n\tself.setSize = setSize;\n\n\t// accumulate axis offsets, reduce canvas width\n\tfunction calcPlotRect() {\n\t\t// easements for edge labels\n\t\tlet hasTopAxis = false;\n\t\tlet hasBtmAxis = false;\n\t\tlet hasRgtAxis = false;\n\t\tlet hasLftAxis = false;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet {side, _size} = axis;\n\t\t\t\tlet isVt = side % 2;\n\t\t\t\tlet labelSize = axis.label != null ? axis.labelSize : 0;\n\n\t\t\t\tlet fullSize = _size + labelSize;\n\n\t\t\t\tif (fullSize > 0) {\n\t\t\t\t\tif (isVt) {\n\t\t\t\t\t\tplotWidCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 3) {\n\t\t\t\t\t\t\tplotLftCss += fullSize;\n\t\t\t\t\t\t\thasLftAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasRgtAxis = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tplotHgtCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 0) {\n\t\t\t\t\t\t\tplotTopCss += fullSize;\n\t\t\t\t\t\t\thasTopAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasBtmAxis = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsidesWithAxes[0] = hasTopAxis;\n\t\tsidesWithAxes[1] = hasRgtAxis;\n\t\tsidesWithAxes[2] = hasBtmAxis;\n\t\tsidesWithAxes[3] = hasLftAxis;\n\n\t\t// hz padding\n\t\tplotWidCss -= _padding[1] + _padding[3];\n\t\tplotLftCss += _padding[3];\n\n\t\t// vt padding\n\t\tplotHgtCss -= _padding[2] + _padding[0];\n\t\tplotTopCss += _padding[0];\n\t}\n\n\tfunction calcAxesRects() {\n\t\t// will accum +\n\t\tlet off1 = plotLftCss + plotWidCss;\n\t\tlet off2 = plotTopCss + plotHgtCss;\n\t\t// will accum -\n\t\tlet off3 = plotLftCss;\n\t\tlet off0 = plotTopCss;\n\n\t\tfunction incrOffset(side, size) {\n\t\t\tswitch (side) {\n\t\t\t\tcase 1: off1 += size; return off1 - size;\n\t\t\t\tcase 2: off2 += size; return off2 - size;\n\t\t\t\tcase 3: off3 -= size; return off3 + size;\n\t\t\t\tcase 0: off0 -= size; return off0 + size;\n\t\t\t}\n\t\t}\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet side = axis.side;\n\n\t\t\t\taxis._pos = incrOffset(side, axis._size);\n\n\t\t\t\tif (axis.label != null)\n\t\t\t\t\taxis._lpos = incrOffset(side, axis.labelSize);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (cursor.dataIdx == null) {\n\t\tlet hov = cursor.hover;\n\n\t\tlet skip = hov.skip = new Set(hov.skip ?? []);\n\t\tskip.add(void 0); // alignment artifacts\n\t\tlet prox = hov.prox = fnOrSelf(hov.prox);\n\t\tlet bias = hov.bias ??= 0;\n\n\t\t// TODO: only scan between in-view idxs (i0, i1)\n\t\tcursor.dataIdx = (self, seriesIdx, cursorIdx, valAtPosX) => {\n\t\t\tif (seriesIdx == 0)\n\t\t\t\treturn cursorIdx;\n\n\t\t\tlet idx2 = cursorIdx;\n\n\t\t\tlet _prox = prox(self, seriesIdx, cursorIdx, valAtPosX) ?? inf;\n\t\t\tlet withProx = _prox >= 0 && _prox < inf;\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\t\tlet cursorLft = cursor.left;\n\n\t\t\tlet xValues = data[0];\n\t\t\tlet yValues = data[seriesIdx];\n\n\t\t\tif (skip.has(yValues[cursorIdx])) {\n\t\t\t\tidx2 = null;\n\n\t\t\t\tlet nonNullLft = null,\n\t\t\t\t\tnonNullRgt = null,\n\t\t\t\t\tj;\n\n\t\t\t\tif (bias == 0 || bias == -1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullLft == null && j-- > 0) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullLft = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (bias == 0 || bias == 1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullRgt == null && j++ < yValues.length) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullRgt = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (nonNullLft != null || nonNullRgt != null) {\n\t\t\t\t\tif (withProx) {\n\t\t\t\t\t\tlet lftPos = nonNullLft == null ? -Infinity : valToPosX(xValues[nonNullLft], scaleX, xDim, 0);\n\t\t\t\t\t\tlet rgtPos = nonNullRgt == null ?  Infinity : valToPosX(xValues[nonNullRgt], scaleX, xDim, 0);\n\n\t\t\t\t\t\tlet lftDelta = cursorLft - lftPos;\n\t\t\t\t\t\tlet rgtDelta = rgtPos - cursorLft;\n\n\t\t\t\t\t\tif (lftDelta <= rgtDelta) {\n\t\t\t\t\t\t\tif (lftDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullLft;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (rgtDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullRgt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tidx2 =\n\t\t\t\t\t\t\tnonNullRgt == null ? nonNullLft :\n\t\t\t\t\t\t\tnonNullLft == null ? nonNullRgt :\n\t\t\t\t\t\t\tcursorIdx - nonNullLft <= nonNullRgt - cursorIdx ? nonNullLft : nonNullRgt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (withProx) {\n\t\t\t\tlet dist = abs(cursorLft - valToPosX(xValues[cursorIdx], scaleX, xDim, 0));\n\n\t\t\t\tif (dist > _prox)\n\t\t\t\t\tidx2 = null;\n\t\t\t}\n\n\t\t\treturn idx2;\n\t\t};\n\t}\n\n\tconst setCursorEvent = e => { cursor.event = e; };\n\n\tcursor.idxs = activeIdxs;\n\n\tcursor._lock = false;\n\n\tlet points = cursor.points;\n\n\tpoints.show   = fnOrSelf(points.show);\n\tpoints.size   = fnOrSelf(points.size);\n\tpoints.stroke = fnOrSelf(points.stroke);\n\tpoints.width  = fnOrSelf(points.width);\n\tpoints.fill   = fnOrSelf(points.fill);\n\n\tconst focus = self.focus = assign({}, opts.focus || {alpha: 0.3}, cursor.focus);\n\n\tconst cursorFocus = focus.prox >= 0;\n\tconst cursorOnePt = cursorFocus && points.one;\n\n\t// series-intersection markers\n\tlet cursorPts = [];\n\t// position caches in CSS pixels\n\tlet cursorPtsLft = [];\n\tlet cursorPtsTop = [];\n\n\tfunction initCursorPt(s, si) {\n\t\tlet pt = points.show(self, si);\n\n\t\tif (pt instanceof HTMLElement) {\n\t\t\taddClass(pt, CURSOR_PT);\n\t\t\taddClass(pt, s.class);\n\t\t\telTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\tover.insertBefore(pt, cursorPts[si]);\n\n\t\t\treturn pt;\n\t\t}\n\t}\n\n\tfunction initSeries(s, i) {\n\t\tif (mode == 1 || i > 0) {\n\t\t\tlet isTime = mode == 1 && scales[s.scale].time;\n\n\t\t\tlet sv = s.value;\n\t\t\ts.value = isTime ? (isStr(sv) ? timeSeriesVal(_tzDate, timeSeriesStamp(sv, _fmtDate)) : sv || _timeSeriesVal) : sv || numSeriesVal;\n\t\t\ts.label = s.label || (isTime ? timeSeriesLabel : numSeriesLabel);\n\t\t}\n\n\t\tif (cursorOnePt || i > 0) {\n\t\t\ts.width  = s.width == null ? 1 : s.width;\n\t\t\ts.paths  = s.paths || linearPath || retNull;\n\t\t\ts.fillTo = fnOrSelf(s.fillTo || seriesFillTo);\n\t\t\ts.pxAlign = +ifNull(s.pxAlign, pxAlign);\n\t\t\ts.pxRound = pxRoundGen(s.pxAlign);\n\n\t\t\ts.stroke = fnOrSelf(s.stroke || null);\n\t\t\ts.fill   = fnOrSelf(s.fill || null);\n\t\t\ts._stroke = s._fill = s._paths = s._focus = null;\n\n\t\t\tlet _ptDia = ptDia(max(1, s.width), 1);\n\t\t\tlet points = s.points = assign({}, {\n\t\t\t\tsize: _ptDia,\n\t\t\t\twidth: max(1, _ptDia * .2),\n\t\t\t\tstroke: s.stroke,\n\t\t\t\tspace: _ptDia * 2,\n\t\t\t\tpaths: pointsPath,\n\t\t\t\t_stroke: null,\n\t\t\t\t_fill: null,\n\t\t\t}, s.points);\n\t\t\tpoints.show   = fnOrSelf(points.show);\n\t\t\tpoints.filter = fnOrSelf(points.filter);\n\t\t\tpoints.fill   = fnOrSelf(points.fill);\n\t\t\tpoints.stroke = fnOrSelf(points.stroke);\n\t\t\tpoints.paths  = fnOrSelf(points.paths);\n\t\t\tpoints.pxAlign = s.pxAlign;\n\t\t}\n\n\t\tif (showLegend) {\n\t\t\tlet rowCells = initLegendRow(s, i);\n\t\t\tlegendRows.splice(i, 0, rowCells[0]);\n\t\t\tlegendCells.splice(i, 0, rowCells[1]);\n\t\t\tlegend.values.push(null);\t// NULL_LEGEND_VALS not yet avil here :(\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 0, null);\n\n\t\t\tlet pt = null;\n\n\t\t\tif (cursorOnePt) {\n\t\t\t\tif (i == 0)\n\t\t\t\t\tpt = initCursorPt(s, i);\n\t\t\t}\n\t\t\telse if (i > 0)\n\t\t\t\tpt = initCursorPt(s, i);\n\n\t\t\tcursorPts.splice(i, 0, pt);\n\t\t\tcursorPtsLft.splice(i, 0, 0);\n\t\t\tcursorPtsTop.splice(i, 0, 0);\n\t\t}\n\n\t\tfire(\"addSeries\", i);\n\t}\n\n\tfunction addSeries(opts, si) {\n\t\tsi = si == null ? series.length : si;\n\n\t\topts = mode == 1 ? setDefault(opts, si, xSeriesOpts, ySeriesOpts) : setDefault(opts, si, {}, xySeriesOpts);\n\n\t\tseries.splice(si, 0, opts);\n\t\tinitSeries(series[si], si);\n\t}\n\n\tself.addSeries = addSeries;\n\n\tfunction delSeries(i) {\n\t\tseries.splice(i, 1);\n\n\t\tif (showLegend) {\n\t\t\tlegend.values.splice(i, 1);\n\n\t\t\tlegendCells.splice(i, 1);\n\t\t\tlet tr = legendRows.splice(i, 1)[0];\n\t\t\toffMouse(null, tr.firstChild);\n\t\t\ttr.remove();\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 1);\n\t\t\tcursorPts.splice(i, 1)[0].remove();\n\t\t\tcursorPtsLft.splice(i, 1);\n\t\t\tcursorPtsTop.splice(i, 1);\n\t\t}\n\n\t\t// TODO: de-init no-longer-needed scales?\n\n\t\tfire(\"delSeries\", i);\n\t}\n\n\tself.delSeries = delSeries;\n\n\tconst sidesWithAxes = [false, false, false, false];\n\n\tfunction initAxis(axis, i) {\n\t\taxis._show = axis.show;\n\n\t\tif (axis.show) {\n\t\t\tlet isVt = axis.side % 2;\n\n\t\t\tlet sc = scales[axis.scale];\n\n\t\t\t// this can occur if all series specify non-default scales\n\t\t\tif (sc == null) {\n\t\t\t\taxis.scale = isVt ? series[1].scale : xScaleKey;\n\t\t\t\tsc = scales[axis.scale];\n\t\t\t}\n\n\t\t\t// also set defaults for incrs & values based on axis distr\n\t\t\tlet isTime = sc.time;\n\n\t\t\taxis.size   = fnOrSelf(axis.size);\n\t\t\taxis.space  = fnOrSelf(axis.space);\n\t\t\taxis.rotate = fnOrSelf(axis.rotate);\n\n\t\t\tif (isArr(axis.incrs)) {\n\t\t\t\taxis.incrs.forEach(incr => {\n\t\t\t\t\t!fixedDec.has(incr) && fixedDec.set(incr, guessDec(incr));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\taxis.incrs  = fnOrSelf(axis.incrs  || (          sc.distr == 2 ? wholeIncrs : (isTime ? (ms == 1 ? timeIncrsMs : timeIncrsS) : numIncrs)));\n\t\t\taxis.splits = fnOrSelf(axis.splits || (isTime && sc.distr == 1 ? _timeAxisSplits : sc.distr == 3 ? logAxisSplits : sc.distr == 4 ? asinhAxisSplits : numAxisSplits));\n\n\t\t\taxis.stroke        = fnOrSelf(axis.stroke);\n\t\t\taxis.grid.stroke   = fnOrSelf(axis.grid.stroke);\n\t\t\taxis.ticks.stroke  = fnOrSelf(axis.ticks.stroke);\n\t\t\taxis.border.stroke = fnOrSelf(axis.border.stroke);\n\n\t\t\tlet av = axis.values;\n\n\t\t\taxis.values = (\n\t\t\t\t// static array of tick values\n\t\t\t\tisArr(av) && !isArr(av[0]) ? fnOrSelf(av) :\n\t\t\t\t// temporal\n\t\t\t\tisTime ? (\n\t\t\t\t\t// config array of fmtDate string tpls\n\t\t\t\t\tisArr(av) ?\n\t\t\t\t\t\ttimeAxisVals(_tzDate, timeAxisStamps(av, _fmtDate)) :\n\t\t\t\t\t// fmtDate string tpl\n\t\t\t\t\tisStr(av) ?\n\t\t\t\t\t\ttimeAxisVal(_tzDate, av) :\n\t\t\t\t\tav || _timeAxisVals\n\t\t\t\t) : av || numAxisVals\n\t\t\t);\n\n\t\t\taxis.filter = fnOrSelf(axis.filter || (          sc.distr >= 3 && sc.log == 10 ? log10AxisValsFilt : sc.distr == 3 && sc.log == 2 ? log2AxisValsFilt : retArg1));\n\n\t\t\taxis.font      = pxRatioFont(axis.font);\n\t\t\taxis.labelFont = pxRatioFont(axis.labelFont);\n\n\t\t\taxis._size   = axis.size(self, null, i, 0);\n\n\t\t\taxis._space  =\n\t\t\taxis._rotate =\n\t\t\taxis._incrs  =\n\t\t\taxis._found  =\t// foundIncrSpace\n\t\t\taxis._splits =\n\t\t\taxis._values = null;\n\n\t\t\tif (axis._size > 0) {\n\t\t\t\tsidesWithAxes[i] = true;\n\t\t\t\taxis._el = placeDiv(AXIS, wrap);\n\t\t\t}\n\n\t\t\t// debug\n\t\t//\taxis._el.style.background = \"#\"  + Math.floor(Math.random()*16777215).toString(16) + '80';\n\t\t}\n\t}\n\n\tfunction autoPadSide(self, side, sidesWithAxes, cycleNum) {\n\t\tlet [hasTopAxis, hasRgtAxis, hasBtmAxis, hasLftAxis] = sidesWithAxes;\n\n\t\tlet ori = side % 2;\n\t\tlet size = 0;\n\n\t\tif (ori == 0 && (hasLftAxis || hasRgtAxis))\n\t\t\tsize = (side == 0 && !hasTopAxis || side == 2 && !hasBtmAxis ? round(xAxisOpts.size / 3) : 0);\n\t\tif (ori == 1 && (hasTopAxis || hasBtmAxis))\n\t\t\tsize = (side == 1 && !hasRgtAxis || side == 3 && !hasLftAxis ? round(yAxisOpts.size / 2) : 0);\n\n\t\treturn size;\n\t}\n\n\tconst padding = self.padding = (opts.padding || [autoPadSide,autoPadSide,autoPadSide,autoPadSide]).map(p => fnOrSelf(ifNull(p, autoPadSide)));\n\tconst _padding = self._padding = padding.map((p, i) => p(self, i, sidesWithAxes, 0));\n\n\tlet dataLen;\n\n\t// rendered data window\n\tlet i0 = null;\n\tlet i1 = null;\n\tconst idxs = mode == 1 ? series[0].idxs : null;\n\n\tlet data0 = null;\n\n\tlet viaAutoScaleX = false;\n\n\tfunction setData(_data, _resetScales) {\n\t\tdata = _data == null ? [] : _data;\n\n\t\tself.data = self._data = data;\n\n\t\tif (mode == 2) {\n\t\t\tdataLen = 0;\n\t\t\tfor (let i = 1; i < series.length; i++)\n\t\t\t\tdataLen += data[i][0].length;\n\t\t}\n\t\telse {\n\t\t\tif (data.length == 0)\n\t\t\t\tself.data = self._data = data = [[]];\n\n\t\t\tdata0 = data[0];\n\t\t\tdataLen = data0.length;\n\n\t\t\tlet scaleData = data;\n\n\t\t\tif (xScaleDistr == 2) {\n\t\t\t\tscaleData = data.slice();\n\n\t\t\t\tlet _data0 = scaleData[0] = Array(dataLen);\n\t\t\t\tfor (let i = 0; i < dataLen; i++)\n\t\t\t\t\t_data0[i] = i;\n\t\t\t}\n\n\t\t\tself._data = data = scaleData;\n\t\t}\n\n\t\tresetYSeries(true);\n\n\t\tfire(\"setData\");\n\n\t\t// forces x axis tick values to re-generate when neither x scale nor y scale changes\n\t\t// in ordinal mode, scale range is by index, so will not change if new data has same length, but tick values are from data\n\t\tif (xScaleDistr == 2) {\n\t\t\tshouldConvergeSize = true;\n\n\t\t\t/* or somewhat cheaper, and uglier:\n\t\t\tif (ready) {\n\t\t\t\t// logic extracted from axesCalc()\n\t\t\t\tlet i = 0;\n\t\t\t\tlet axis = axes[i];\n\t\t\t\tlet _splits = axis._splits.map(i => data0[i]);\n\t\t\t\tlet [_incr, _space] = axis._found;\n\t\t\t\tlet incr = data0[_splits[1]] - data0[_splits[0]];\n\t\t\t\taxis._values = axis.values(self, axis.filter(self, _splits, i, _space, incr), i, _space, incr);\n\t\t\t}\n\t\t\t*/\n\t\t}\n\n\t\tif (_resetScales !== false) {\n\t\t\tlet xsc = scaleX;\n\n\t\t\tif (xsc.auto(self, viaAutoScaleX))\n\t\t\t\tautoScaleX();\n\t\t\telse\n\t\t\t\t_setScale(xScaleKey, xsc.min, xsc.max);\n\n\t\t\tshouldSetCursor = shouldSetCursor || cursor.left >= 0;\n\t\t\tshouldSetLegend = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setData = setData;\n\n\tfunction autoScaleX() {\n\t\tviaAutoScaleX = true;\n\n\t\tlet _min, _max;\n\n\t\tif (mode == 1) {\n\t\t\tif (dataLen > 0) {\n\t\t\t\ti0 = idxs[0] = 0;\n\t\t\t\ti1 = idxs[1] = dataLen - 1;\n\n\t\t\t\t_min = data[0][i0];\n\t\t\t\t_max = data[0][i1];\n\n\t\t\t\tif (xScaleDistr == 2) {\n\t\t\t\t\t_min = i0;\n\t\t\t\t\t_max = i1;\n\t\t\t\t}\n\t\t\t\telse if (_min == _max) {\n\t\t\t\t\tif (xScaleDistr == 3)\n\t\t\t\t\t\t[_min, _max] = rangeLog(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (xScaleDistr == 4)\n\t\t\t\t\t\t[_min, _max] = rangeAsinh(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (scaleX.time)\n\t\t\t\t\t\t_max = _min + round(86400 / ms);\n\t\t\t\t\telse\n\t\t\t\t\t\t[_min, _max] = rangeNum(_min, _max, rangePad, true);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ti0 = idxs[0] = _min = null;\n\t\t\t\ti1 = idxs[1] = _max = null;\n\t\t\t}\n\t\t}\n\n\t\t_setScale(xScaleKey, _min, _max);\n\t}\n\n\tlet ctxStroke, ctxFill, ctxWidth, ctxDash, ctxJoin, ctxCap, ctxFont, ctxAlign, ctxBaseline;\n\tlet ctxAlpha;\n\n\tfunction setCtxStyle(stroke, width, dash, cap, fill, join) {\n\t\tstroke ??= transparent;\n\t\tdash   ??= EMPTY_ARR;\n\t\tcap    ??= \"butt\"; // (â€¿|â€¿)\n\t\tfill   ??= transparent;\n\t\tjoin   ??= \"round\";\n\n\t\tif (stroke != ctxStroke)\n\t\t\tctx.strokeStyle = ctxStroke = stroke;\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (width != ctxWidth)\n\t\t\tctx.lineWidth = ctxWidth = width;\n\t\tif (join != ctxJoin)\n\t\t\tctx.lineJoin = ctxJoin = join;\n\t\tif (cap != ctxCap)\n\t\t\tctx.lineCap = ctxCap = cap;\n\t\tif (dash != ctxDash)\n\t\t\tctx.setLineDash(ctxDash = dash);\n\t}\n\n\tfunction setFontStyle(font, fill, align, baseline) {\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (font != ctxFont)\n\t\t\tctx.font = ctxFont = font;\n\t\tif (align != ctxAlign)\n\t\t\tctx.textAlign = ctxAlign = align;\n\t\tif (baseline != ctxBaseline)\n\t\t\tctx.textBaseline = ctxBaseline = baseline;\n\t}\n\n\tfunction accScale(wsc, psc, facet, data, sorted = 0) {\n\t\tif (data.length > 0 && wsc.auto(self, viaAutoScaleX) && (psc == null || psc.min == null)) {\n\t\t\tlet _i0 = ifNull(i0, 0);\n\t\t\tlet _i1 = ifNull(i1, data.length - 1);\n\n\t\t\t// only run getMinMax() for invalidated series data, else reuse\n\t\t\tlet minMax = facet.min == null ? getMinMax(data, _i0, _i1, sorted, wsc.distr == 3) : [facet.min, facet.max];\n\n\t\t\t// initial min/max\n\t\t\twsc.min = min(wsc.min, facet.min = minMax[0]);\n\t\t\twsc.max = max(wsc.max, facet.max = minMax[1]);\n\t\t}\n\t}\n\n\tconst AUTOSCALE = {min: null, max: null};\n\n\tfunction setScales() {\n\t//\tlog(\"setScales()\", arguments);\n\n\t\t// implicitly add auto scales, and unranged scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null &&\n\t\t\t\t(\n\t\t\t\t\t// scales that have never been set (on init)\n\t\t\t\t\tsc.min == null ||\n\t\t\t\t\t// or auto scales when the x scale was explicitly set\n\t\t\t\t\tpendScales[xScaleKey] != null && sc.auto(self, viaAutoScaleX)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t\t}\n\t\t}\n\n\t\t// implicitly add dependent scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null && sc.from != null && pendScales[sc.from] != null)\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t}\n\n\t\t// explicitly setting the x-scale invalidates everything (acts as redraw)\n\t\tif (pendScales[xScaleKey] != null)\n\t\t\tresetYSeries(true); // TODO: only reset series on auto scales?\n\n\t\tlet wipScales = {};\n\n\t\tfor (let k in pendScales) {\n\t\t\tlet psc = pendScales[k];\n\n\t\t\tif (psc != null) {\n\t\t\t\tlet wsc = wipScales[k] = copy(scales[k], fastIsObj);\n\n\t\t\t\tif (psc.min != null)\n\t\t\t\t\tassign(wsc, psc);\n\t\t\t\telse if (k != xScaleKey || mode == 2) {\n\t\t\t\t\tif (dataLen == 0 && wsc.from == null) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, null, null, k);\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\twsc.min = inf;\n\t\t\t\t\t\twsc.max = -inf;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (dataLen > 0) {\n\t\t\t// pre-range y-scales from y series' data values\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 1) {\n\t\t\t\t\tlet k = s.scale;\n\t\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\t\tif (psc == null)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tlet wsc = wipScales[k];\n\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, wsc.min, wsc.max, k);\n\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\n\t\t\t\t\t\ti0 = closestIdx(wsc.min, data[0]);\n\t\t\t\t\t\ti1 = closestIdx(wsc.max, data[0]);\n\n\t\t\t\t\t\t// don't try to contract same or adjacent idxs\n\t\t\t\t\t\tif (i1 - i0 > 1) {\n\t\t\t\t\t\t\t// closest indices can be outside of view\n\t\t\t\t\t\t\tif (data[0][i0] < wsc.min)\n\t\t\t\t\t\t\t\ti0++;\n\t\t\t\t\t\t\tif (data[0][i1] > wsc.max)\n\t\t\t\t\t\t\t\ti1--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ts.min = data0[i0];\n\t\t\t\t\t\ts.max = data0[i1];\n\t\t\t\t\t}\n\t\t\t\t\telse if (s.show && s.auto)\n\t\t\t\t\t\taccScale(wsc, psc, s, data[i], s.sorted);\n\n\t\t\t\t\ts.idxs[0] = i0;\n\t\t\t\t\ts.idxs[1] = i1;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tif (s.show && s.auto) {\n\t\t\t\t\t\t\t// TODO: only handles, assumes and requires facets[0] / 'x' scale, and facets[1] / 'y' scale\n\t\t\t\t\t\t\tlet [ xFacet, yFacet ] = s.facets;\n\t\t\t\t\t\t\tlet xScaleKey = xFacet.scale;\n\t\t\t\t\t\t\tlet yScaleKey = yFacet.scale;\n\t\t\t\t\t\t\tlet [ xData, yData ] = data[i];\n\n\t\t\t\t\t\t\tlet wscx = wipScales[xScaleKey];\n\t\t\t\t\t\t\tlet wscy = wipScales[yScaleKey];\n\n\t\t\t\t\t\t\t// null can happen when only x is zoomed, but y has static range and doesnt get auto-added to pending\n\t\t\t\t\t\t\twscx != null && accScale(wscx, pendScales[xScaleKey], xFacet, xData, xFacet.sorted);\n\t\t\t\t\t\t\twscy != null && accScale(wscy, pendScales[yScaleKey], yFacet, yData, yFacet.sorted);\n\n\t\t\t\t\t\t\t// temp\n\t\t\t\t\t\t\ts.min = yFacet.min;\n\t\t\t\t\t\t\ts.max = yFacet.max;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// range independent scales\n\t\t\tfor (let k in wipScales) {\n\t\t\t\tlet wsc = wipScales[k];\n\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\tif (wsc.from == null && (psc == null || psc.min == null)) {\n\t\t\t\t\tlet minMax = wsc.range(\n\t\t\t\t\t\tself,\n\t\t\t\t\t\twsc.min ==  inf ? null : wsc.min,\n\t\t\t\t\t\twsc.max == -inf ? null : wsc.max,\n\t\t\t\t\t\tk\n\t\t\t\t\t);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// range dependent scales\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\n\t\t\tif (wsc.from != null) {\n\t\t\t\tlet base = wipScales[wsc.from];\n\n\t\t\t\tif (base.min == null)\n\t\t\t\t\twsc.min = wsc.max = null;\n\t\t\t\telse {\n\t\t\t\t\tlet minMax = wsc.range(self, base.min, base.max, k);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet changed = {};\n\t\tlet anyChanged = false;\n\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (sc.min != wsc.min || sc.max != wsc.max) {\n\t\t\t\tsc.min = wsc.min;\n\t\t\t\tsc.max = wsc.max;\n\n\t\t\t\tlet distr = sc.distr;\n\n\t\t\t\tsc._min = distr == 3 ? log10(sc.min) : distr == 4 ? asinh(sc.min, sc.asinh) : distr == 100 ? sc.fwd(sc.min) : sc.min;\n\t\t\t\tsc._max = distr == 3 ? log10(sc.max) : distr == 4 ? asinh(sc.max, sc.asinh) : distr == 100 ? sc.fwd(sc.max) : sc.max;\n\n\t\t\t\tchanged[k] = anyChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (anyChanged) {\n\t\t\t// invalidate paths of all series on changed scales\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 2) {\n\t\t\t\t\tif (i > 0 && changed.y)\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (changed[s.scale])\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (let k in changed) {\n\t\t\t\tshouldConvergeSize = true;\n\t\t\t\tfire(\"setScale\", k);\n\t\t\t}\n\n\t\t\tif (showCursor && cursor.left >= 0)\n\t\t\t\tshouldSetCursor = shouldSetLegend = true;\n\t\t}\n\n\t\tfor (let k in pendScales)\n\t\t\tpendScales[k] = null;\n\t}\n\n\t// grabs the nearest indices with y data outside of x-scale limits\n\tfunction getOuterIdxs(ydata) {\n\t\tlet _i0 = clamp(i0 - 1, 0, dataLen - 1);\n\t\tlet _i1 = clamp(i1 + 1, 0, dataLen - 1);\n\n\t\twhile (ydata[_i0] == null && _i0 > 0)\n\t\t\t_i0--;\n\n\t\twhile (ydata[_i1] == null && _i1 < dataLen - 1)\n\t\t\t_i1++;\n\n\t\treturn [_i0, _i1];\n\t}\n\n\tfunction drawSeries() {\n\t\tif (dataLen > 0) {\n\t\t\tlet shouldAlpha = series.some(s => s._focus) && ctxAlpha != focus.alpha;\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = focus.alpha;\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tcacheStrokeFill(i, false);\n\t\t\t\t\tcacheStrokeFill(i, true);\n\n\t\t\t\t\tif (s._paths == null) {\n\t\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\t\tlet _idxs = mode == 2 ? [0, data[i][0].length - 1] : getOuterIdxs(data[i]);\n\t\t\t\t\t\ts._paths = s.paths(self, i, _idxs[0], _idxs[1]);\n\n\t\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\ts._paths != null && drawPath(i, false);\n\n\t\t\t\t\t{\n\t\t\t\t\t\tlet _gaps = s._paths != null ? s._paths.gaps : null;\n\n\t\t\t\t\t\tlet show = s.points.show(self, i, i0, i1, _gaps);\n\t\t\t\t\t\tlet idxs = s.points.filter(self, i, show, _gaps);\n\n\t\t\t\t\t\tif (show || idxs) {\n\t\t\t\t\t\t\ts.points._paths = s.points.paths(self, i, i0, i1, idxs);\n\t\t\t\t\t\t\tdrawPath(i, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\n\t\t\t\t\tfire(\"drawSeries\", i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = 1;\n\t\t}\n\t}\n\n\tfunction cacheStrokeFill(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\ts._stroke = s.stroke(self, si);\n\t\ts._fill   = s.fill(self, si);\n\t}\n\n\tfunction drawPath(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\tlet {\n\t\t\tstroke,\n\t\t\tfill,\n\t\t\tclip: gapsClip,\n\t\t\tflags,\n\n\t\t\t_stroke: strokeStyle = s._stroke,\n\t\t\t_fill:   fillStyle   = s._fill,\n\t\t\t_width:  width       = s.width,\n\t\t} = s._paths;\n\n\t\twidth = roundDec(width * pxRatio, 3);\n\n\t\tlet boundsClip = null;\n\t\tlet offset = (width % 2) / 2;\n\n\t\tif (_points && fillStyle == null)\n\t\t\tfillStyle = width > 0 ? \"#fff\" : strokeStyle;\n\n\t\tlet _pxAlign = s.pxAlign == 1 && offset > 0;\n\n\t\t_pxAlign && ctx.translate(offset, offset);\n\n\t\tif (!_points) {\n\t\t\tlet lft = plotLft - width / 2,\n\t\t\t\ttop = plotTop - width / 2,\n\t\t\t\twid = plotWid + width,\n\t\t\t\thgt = plotHgt + width;\n\n\t\t\tboundsClip = new Path2D();\n\t\t\tboundsClip.rect(lft, top, wid, hgt);\n\t\t}\n\n\t\t// the points pathbuilder's gapsClip is its boundsClip, since points dont need gaps clipping, and bounds depend on point size\n\t\tif (_points)\n\t\t\tstrokeFill(strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, gapsClip);\n\t\telse\n\t\t\tfillStroke(si, strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, boundsClip, gapsClip);\n\n\t\t_pxAlign && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction fillStroke(si, strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip) {\n\t\tlet didStrokeFill = false;\n\n\t\t// for all bands where this series is the top edge, create upwards clips using the bottom edges\n\t\t// and apply clips + fill with band fill or dfltFill\n\t\tflags != 0 && bands.forEach((b, bi) => {\n\t\t\t// isUpperEdge?\n\t\t\tif (b.series[0] == si) {\n\t\t\t\tlet lowerEdge = series[b.series[1]];\n\t\t\t\tlet lowerData = data[b.series[1]];\n\n\t\t\t\tlet bandClip = (lowerEdge._paths || EMPTY_OBJ).band;\n\n\t\t\t\tif (isArr(bandClip))\n\t\t\t\t\tbandClip = b.dir == 1 ? bandClip[0] : bandClip[1];\n\n\t\t\t\tlet gapsClip2;\n\n\t\t\t\tlet _fillStyle = null;\n\n\t\t\t\t// hasLowerEdge?\n\t\t\t\tif (lowerEdge.show && bandClip && hasData(lowerData, i0, i1)) {\n\t\t\t\t\t_fillStyle = b.fill(self, bi) || fillStyle;\n\t\t\t\t\tgapsClip2 = lowerEdge._paths.clip;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbandClip = null;\n\n\t\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, _fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip);\n\n\t\t\t\tdidStrokeFill = true;\n\t\t\t}\n\t\t});\n\n\t\tif (!didStrokeFill)\n\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip);\n\t}\n\n\tconst CLIP_FILL_STROKE = BAND_CLIP_FILL | BAND_CLIP_STROKE;\n\n\tfunction strokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip) {\n\t\tsetCtxStyle(strokeStyle, lineWidth, lineDash, lineCap, fillStyle);\n\n\t\tif (boundsClip || gapsClip || bandClip) {\n\t\t\tctx.save();\n\t\t\tboundsClip && ctx.clip(boundsClip);\n\t\t\tgapsClip && ctx.clip(gapsClip);\n\t\t}\n\n\t\tif (bandClip) {\n\t\t\tif ((flags & CLIP_FILL_STROKE) == CLIP_FILL_STROKE) {\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_STROKE) {\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_FILL) {\n\t\t\t\tctx.save();\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.restore();\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdoFill(fillStyle, fillPath);\n\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t}\n\n\t\tif (boundsClip || gapsClip || bandClip)\n\t\t\tctx.restore();\n\t}\n\n\tfunction doStroke(strokeStyle, strokePath, lineWidth) {\n\t\tif (lineWidth > 0) {\n\t\t\tif (strokePath instanceof Map) {\n\t\t\t\tstrokePath.forEach((strokePath, strokeStyle) => {\n\t\t\t\t\tctx.strokeStyle = ctxStroke = strokeStyle;\n\t\t\t\t\tctx.stroke(strokePath);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tstrokePath != null && strokeStyle && ctx.stroke(strokePath);\n\t\t}\n\t}\n\n\tfunction doFill(fillStyle, fillPath) {\n\t\tif (fillPath instanceof Map) {\n\t\t\tfillPath.forEach((fillPath, fillStyle) => {\n\t\t\t\tctx.fillStyle = ctxFill = fillStyle;\n\t\t\t\tctx.fill(fillPath);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\tfillPath != null && fillStyle && ctx.fill(fillPath);\n\t}\n\n\tfunction getIncrSpace(axisIdx, min, max, fullDim) {\n\t\tlet axis = axes[axisIdx];\n\n\t\tlet incrSpace;\n\n\t\tif (fullDim <= 0)\n\t\t\tincrSpace = [0, 0];\n\t\telse {\n\t\t\tlet minSpace = axis._space = axis.space(self, axisIdx, min, max, fullDim);\n\t\t\tlet incrs    = axis._incrs = axis.incrs(self, axisIdx, min, max, fullDim, minSpace);\n\t\t\tincrSpace    = findIncr(min, max, incrs, fullDim, minSpace);\n\t\t}\n\n\t\treturn (axis._found = incrSpace);\n\t}\n\n\tfunction drawOrthoLines(offs, filts, ori, side, pos0, len, width, stroke, dash, cap) {\n\t\tlet offset = (width % 2) / 2;\n\n\t\tpxAlign == 1 && ctx.translate(offset, offset);\n\n\t\tsetCtxStyle(stroke, width, dash, cap, stroke);\n\n\t\tctx.beginPath();\n\n\t\tlet x0, y0, x1, y1, pos1 = pos0 + (side == 0 || side == 3 ? -len : len);\n\n\t\tif (ori == 0) {\n\t\t\ty0 = pos0;\n\t\t\ty1 = pos1;\n\t\t}\n\t\telse {\n\t\t\tx0 = pos0;\n\t\t\tx1 = pos1;\n\t\t}\n\n\t\tfor (let i = 0; i < offs.length; i++) {\n\t\t\tif (filts[i] != null) {\n\t\t\t\tif (ori == 0)\n\t\t\t\t\tx0 = x1 = offs[i];\n\t\t\t\telse\n\t\t\t\t\ty0 = y1 = offs[i];\n\n\t\t\t\tctx.moveTo(x0, y0);\n\t\t\t\tctx.lineTo(x1, y1);\n\t\t\t}\n\t\t}\n\n\t\tctx.stroke();\n\n\t\tpxAlign == 1 && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction axesCalc(cycleNum) {\n\t//\tlog(\"axesCalc()\", arguments);\n\n\t\tlet converged = true;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (!axis.show)\n\t\t\t\treturn;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tif (scale.min == null) {\n\t\t\t\tif (axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = false;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = true;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet {min, max} = scale;\t\t// \t\t// should this toggle them ._show = false\n\n\t\t\tlet [_incr, _space] = getIncrSpace(i, min, max, ori == 0 ? plotWidCss : plotHgtCss);\n\n\t\t\tif (_space == 0)\n\t\t\t\treturn;\n\n\t\t\t// if we're using index positions, force first tick to match passed index\n\t\t\tlet forceMin = scale.distr == 2;\n\n\t\t\tlet _splits = axis._splits = axis.splits(self, i, min, max, _incr, _space, forceMin);\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet values = axis._values = axis.values(self, axis.filter(self, splits, i, _space, incr), i, _space, incr);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\taxis._rotate = side == 2 ? axis.rotate(self, values, i, _space) : 0;\n\n\t\t\tlet oldSize = axis._size;\n\n\t\t\taxis._size = ceil(axis.size(self, values, i, cycleNum));\n\n\t\t\tif (oldSize != null && axis._size != oldSize)\t\t\t// ready && ?\n\t\t\t\tconverged = false;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction paddingCalc(cycleNum) {\n\t\tlet converged = true;\n\n\t\tpadding.forEach((p, i) => {\n\t\t\tlet _p = p(self, i, sidesWithAxes, cycleNum);\n\n\t\t\tif (_p != _padding[i])\n\t\t\t\tconverged = false;\n\n\t\t\t_padding[i] = _p;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction drawAxesGrid() {\n\t\tfor (let i = 0; i < axes.length; i++) {\n\t\t\tlet axis = axes[i];\n\n\t\t\tif (!axis.show || !axis._show)\n\t\t\t\tcontinue;\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet x, y;\n\n\t\t\tlet fillStyle = axis.stroke(self, i);\n\n\t\t\tlet shiftDir = side == 0 || side == 3 ? -1 : 1;\n\n\t\t\tlet [_incr, _space] = axis._found;\n\n\t\t\t// axis label\n\t\t\tif (axis.label != null) {\n\t\t\t\tlet shiftAmt = axis.labelGap * shiftDir;\n\t\t\t\tlet baseLpos = round((axis._lpos + shiftAmt) * pxRatio);\n\n\t\t\t\tsetFontStyle(axis.labelFont[0], fillStyle, \"center\", side == 2 ? TOP : BOTTOM);\n\n\t\t\t\tctx.save();\n\n\t\t\t\tif (ori == 1) {\n\t\t\t\t\tx = y = 0;\n\n\t\t\t\t\tctx.translate(\n\t\t\t\t\t\tbaseLpos,\n\t\t\t\t\t\tround(plotTop + plotHgt / 2),\n\t\t\t\t\t);\n\t\t\t\t\tctx.rotate((side == 3 ? -PI : PI) / 2);\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tx = round(plotLft + plotWid / 2);\n\t\t\t\t\ty = baseLpos;\n\t\t\t\t}\n\n\t\t\t\tlet _label = isFn(axis.label) ? axis.label(self, i, _incr, _space) : axis.label;\n\n\t\t\t\tctx.fillText(_label, x, y);\n\n\t\t\t\tctx.restore();\n\t\t\t}\n\n\t\t\tif (_space == 0)\n\t\t\t\tcontinue;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tlet plotDim = ori == 0 ? plotWid : plotHgt;\n\t\t\tlet plotOff = ori == 0 ? plotLft : plotTop;\n\n\t\t\tlet _splits = axis._splits;\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet ticks = axis.ticks;\n\t\t\tlet border = axis.border;\n\t\t\tlet _tickSize = ticks.show ? ticks.size : 0;\n\t\t\tlet tickSize = round(_tickSize * pxRatio);\n\t\t\tlet axisGap = round((axis.alignTo == 2 ? axis._size - _tickSize - axis.gap : axis.gap) * pxRatio);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\tlet angle = axis._rotate * -PI/180;\n\n\t\t\tlet basePos  = pxRound(axis._pos * pxRatio);\n\t\t\tlet shiftAmt = (tickSize + axisGap) * shiftDir;\n\t\t\tlet finalPos = basePos + shiftAmt;\n\t\t\t    y        = ori == 0 ? finalPos : 0;\n\t\t\t    x        = ori == 1 ? finalPos : 0;\n\n\t\t\tlet font         = axis.font[0];\n\t\t\tlet textAlign    = axis.align == 1 ? LEFT :\n\t\t\t                   axis.align == 2 ? RIGHT :\n\t\t\t                   angle > 0 ? LEFT :\n\t\t\t                   angle < 0 ? RIGHT :\n\t\t\t                   ori == 0 ? \"center\" : side == 3 ? RIGHT : LEFT;\n\t\t\tlet textBaseline = angle ||\n\t\t\t                   ori == 1 ? \"middle\" : side == 2 ? TOP   : BOTTOM;\n\n\t\t\tsetFontStyle(font, fillStyle, textAlign, textBaseline);\n\n\t\t\tlet lineHeight = axis.font[1] * axis.lineGap;\n\n\t\t\tlet canOffs = _splits.map(val => pxRound(getPos(val, scale, plotDim, plotOff)));\n\n\t\t\tlet _values = axis._values;\n\n\t\t\tfor (let i = 0; i < _values.length; i++) {\n\t\t\t\tlet val = _values[i];\n\n\t\t\t\tif (val != null) {\n\t\t\t\t\tif (ori == 0)\n\t\t\t\t\t\tx = canOffs[i];\n\t\t\t\t\telse\n\t\t\t\t\t\ty = canOffs[i];\n\n\t\t\t\t\tval = \"\" + val;\n\n\t\t\t\t\tlet _parts = val.indexOf(\"\\n\") == -1 ? [val] : val.split(/\\n/gm);\n\n\t\t\t\t\tfor (let j = 0; j < _parts.length; j++) {\n\t\t\t\t\t\tlet text = _parts[j];\n\n\t\t\t\t\t\tif (angle) {\n\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\tctx.translate(x, y + j * lineHeight); // can this be replaced with position math?\n\t\t\t\t\t\t\tctx.rotate(angle); // can this be done once?\n\t\t\t\t\t\t\tctx.fillText(text, 0, 0);\n\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tctx.fillText(text, x, y + j * lineHeight);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// ticks\n\t\t\tif (ticks.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tticks.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tside,\n\t\t\t\t\tbasePos,\n\t\t\t\t\ttickSize,\n\t\t\t\t\troundDec(ticks.width * pxRatio, 3),\n\t\t\t\t\tticks.stroke(self, i),\n\t\t\t\t\tticks.dash,\n\t\t\t\t\tticks.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// grid\n\t\t\tlet grid = axis.grid;\n\n\t\t\tif (grid.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tgrid.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tori == 0 ? 2 : 1,\n\t\t\t\t\tori == 0 ? plotTop : plotLft,\n\t\t\t\t\tori == 0 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(grid.width * pxRatio, 3),\n\t\t\t\t\tgrid.stroke(self, i),\n\t\t\t\t\tgrid.dash,\n\t\t\t\t\tgrid.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (border.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\t[basePos],\n\t\t\t\t\t[1],\n\t\t\t\t\tori == 0 ? 1 : 0,\n\t\t\t\t\tori == 0 ? 1 : 2,\n\t\t\t\t\tori == 1 ? plotTop : plotLft,\n\t\t\t\t\tori == 1 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(border.width * pxRatio, 3),\n\t\t\t\t\tborder.stroke(self, i),\n\t\t\t\t\tborder.dash,\n\t\t\t\t\tborder.cap,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfire(\"drawAxes\");\n\t}\n\n\tfunction resetYSeries(minMax) {\n\t//\tlog(\"resetYSeries()\", arguments);\n\n\t\tseries.forEach((s, i) => {\n\t\t\tif (i > 0) {\n\t\t\t\ts._paths = null;\n\n\t\t\t\tif (minMax) {\n\t\t\t\t\tif (mode == 1) {\n\t\t\t\t\t\ts.min = null;\n\t\t\t\t\t\ts.max = null;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ts.facets.forEach(f => {\n\t\t\t\t\t\t\tf.min = null;\n\t\t\t\t\t\t\tf.max = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet queuedCommit = false;\n\tlet deferHooks = false;\n\tlet hooksQueue = [];\n\n\tfunction flushHooks() {\n\t\tdeferHooks = false;\n\n\t\tfor (let i = 0; i < hooksQueue.length; i++)\n\t\t\tfire(...hooksQueue[i]);\n\n\t\thooksQueue.length = 0;\n\t}\n\n\tfunction commit() {\n\t\tif (!queuedCommit) {\n\t\t\tmicroTask(_commit);\n\t\t\tqueuedCommit = true;\n\t\t}\n\t}\n\n\t// manual batching (aka immediate mode), skips microtask queue\n\tfunction batch(fn, _deferHooks = false) {\n\t\tqueuedCommit = true;\n\t\tdeferHooks = _deferHooks;\n\n\t\tfn(self);\n\t\t_commit();\n\n\t\tif (_deferHooks && hooksQueue.length > 0)\n\t\t\tqueueMicrotask(flushHooks);\n\t}\n\n\tself.batch = batch;\n\n\tfunction _commit() {\n\t//\tlog(\"_commit()\", arguments);\n\n\t\tif (shouldSetScales) {\n\t\t\tsetScales();\n\t\t\tshouldSetScales = false;\n\t\t}\n\n\t\tif (shouldConvergeSize) {\n\t\t\tconvergeSize();\n\t\t\tshouldConvergeSize = false;\n\t\t}\n\n\t\tif (shouldSetSize) {\n\t\t\tsetStylePx(under, LEFT,   plotLftCss);\n\t\t\tsetStylePx(under, TOP,    plotTopCss);\n\t\t\tsetStylePx(under, WIDTH,  plotWidCss);\n\t\t\tsetStylePx(under, HEIGHT, plotHgtCss);\n\n\t\t\tsetStylePx(over, LEFT,    plotLftCss);\n\t\t\tsetStylePx(over, TOP,     plotTopCss);\n\t\t\tsetStylePx(over, WIDTH,   plotWidCss);\n\t\t\tsetStylePx(over, HEIGHT,  plotHgtCss);\n\n\t\t\tsetStylePx(wrap, WIDTH,   fullWidCss);\n\t\t\tsetStylePx(wrap, HEIGHT,  fullHgtCss);\n\n\t\t\t// NOTE: mutating this during print preview in Chrome forces transparent\n\t\t\t// canvas pixels to white, even when followed up with clearRect() below\n\t\t\tcan.width  = round(fullWidCss * pxRatio);\n\t\t\tcan.height = round(fullHgtCss * pxRatio);\n\n\t\t\taxes.forEach(({ _el, _show, _size, _pos, side }) => {\n\t\t\t\tif (_el != null) {\n\t\t\t\t\tif (_show) {\n\t\t\t\t\t\tlet posOffset = (side === 3 || side === 0 ? _size : 0);\n\t\t\t\t\t\tlet isVt = side % 2 == 1;\n\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"left\"   : \"top\",    _pos - posOffset);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"width\"  : \"height\", _size);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"top\"    : \"left\",   isVt ? plotTopCss : plotLftCss);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"height\" : \"width\",  isVt ? plotHgtCss : plotWidCss);\n\n\t\t\t\t\t\tremClass(_el, OFF);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\taddClass(_el, OFF);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// invalidate ctx style cache\n\t\t\tctxStroke = ctxFill = ctxWidth = ctxJoin = ctxCap = ctxFont = ctxAlign = ctxBaseline = ctxDash = null;\n\t\t\tctxAlpha = 1;\n\n\t\t\tsyncRect(true);\n\n\t\t\tif (\n\t\t\t\tplotLftCss != _plotLftCss ||\n\t\t\t\tplotTopCss != _plotTopCss ||\n\t\t\t\tplotWidCss != _plotWidCss ||\n\t\t\t\tplotHgtCss != _plotHgtCss\n\t\t\t) {\n\t\t\t\tresetYSeries(false);\n\n\t\t\t\tlet pctWid = plotWidCss / _plotWidCss;\n\t\t\t\tlet pctHgt = plotHgtCss / _plotHgtCss;\n\n\t\t\t\tif (showCursor && !shouldSetCursor && cursor.left >= 0) {\n\t\t\t\t\tcursor.left *= pctWid;\n\t\t\t\t\tcursor.top  *= pctHgt;\n\n\t\t\t\t\tvCursor && elTrans(vCursor, round(cursor.left), 0, plotWidCss, plotHgtCss);\n\t\t\t\t\thCursor && elTrans(hCursor, 0, round(cursor.top), plotWidCss, plotHgtCss);\n\n\t\t\t\t\tfor (let i = 0; i < cursorPts.length; i++) {\n\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\tcursorPtsLft[i] *= pctWid;\n\t\t\t\t\t\t\tcursorPtsTop[i] *= pctHgt;\n\t\t\t\t\t\t\telTrans(pt, ceil(cursorPtsLft[i]), ceil(cursorPtsTop[i]), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (select.show && !shouldSetSelect && select.left >= 0 && select.width > 0) {\n\t\t\t\t\tselect.left   *= pctWid;\n\t\t\t\t\tselect.width  *= pctWid;\n\t\t\t\t\tselect.top    *= pctHgt;\n\t\t\t\t\tselect.height *= pctHgt;\n\n\t\t\t\t\tfor (let prop in _hideProps)\n\t\t\t\t\t\tsetStylePx(selectDiv, prop, select[prop]);\n\t\t\t\t}\n\n\t\t\t\t_plotLftCss = plotLftCss;\n\t\t\t\t_plotTopCss = plotTopCss;\n\t\t\t\t_plotWidCss = plotWidCss;\n\t\t\t\t_plotHgtCss = plotHgtCss;\n\t\t\t}\n\n\t\t\tfire(\"setSize\");\n\n\t\t\tshouldSetSize = false;\n\t\t}\n\n\t\tif (fullWidCss > 0 && fullHgtCss > 0) {\n\t\t\tctx.clearRect(0, 0, can.width, can.height);\n\t\t\tfire(\"drawClear\");\n\t\t\tdrawOrder.forEach(fn => fn());\n\t\t\tfire(\"draw\");\n\t\t}\n\n\t\tif (select.show && shouldSetSelect) {\n\t\t\tsetSelect(select);\n\t\t\tshouldSetSelect = false;\n\t\t}\n\n\t\tif (showCursor && shouldSetCursor) {\n\t\t\tupdateCursor(null, true, false);\n\t\t\tshouldSetCursor = false;\n\t\t}\n\n\t\tif (legend.show && legend.live && shouldSetLegend) {\n\t\t\tsetLegend();\n\t\t\tshouldSetLegend = false; // redundant currently\n\t\t}\n\n\t\tif (!ready) {\n\t\t\tready = true;\n\t\t\tself.status = 1;\n\n\t\t\tfire(\"ready\");\n\t\t}\n\n\t\tviaAutoScaleX = false;\n\n\t\tqueuedCommit = false;\n\t}\n\n\tself.redraw = (rebuildPaths, recalcAxes) => {\n\t\tshouldConvergeSize = recalcAxes || false;\n\n\t\tif (rebuildPaths !== false)\n\t\t\t_setScale(xScaleKey, scaleX.min, scaleX.max);\n\t\telse\n\t\t\tcommit();\n\t};\n\n\t// redraw() => setScale('x', scales.x.min, scales.x.max);\n\n\t// explicit, never re-ranged (is this actually true? for x and y)\n\tfunction setScale(key, opts) {\n\t\tlet sc = scales[key];\n\n\t\tif (sc.from == null) {\n\t\t\tif (dataLen == 0) {\n\t\t\t\tlet minMax = sc.range(self, opts.min, opts.max, key);\n\t\t\t\topts.min = minMax[0];\n\t\t\t\topts.max = minMax[1];\n\t\t\t}\n\n\t\t\tif (opts.min > opts.max) {\n\t\t\t\tlet _min = opts.min;\n\t\t\t\topts.min = opts.max;\n\t\t\t\topts.max = _min;\n\t\t\t}\n\n\t\t\tif (dataLen > 1 && opts.min != null && opts.max != null && opts.max - opts.min < 1e-16)\n\t\t\t\treturn;\n\n\t\t\tif (key == xScaleKey) {\n\t\t\t\tif (sc.distr == 2 && dataLen > 0) {\n\t\t\t\t\topts.min = closestIdx(opts.min, data[0]);\n\t\t\t\t\topts.max = closestIdx(opts.max, data[0]);\n\n\t\t\t\t\tif (opts.min == opts.max)\n\t\t\t\t\t\topts.max++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t//\tlog(\"setScale()\", arguments);\n\n\t\t\tpendScales[key] = opts;\n\n\t\t\tshouldSetScales = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setScale = setScale;\n\n//\tINTERACTION\n\n\tlet xCursor;\n\tlet yCursor;\n\tlet vCursor;\n\tlet hCursor;\n\n\t// starting position before cursor.move\n\tlet rawMouseLeft0;\n\tlet rawMouseTop0;\n\n\t// starting position\n\tlet mouseLeft0;\n\tlet mouseTop0;\n\n\t// current position before cursor.move\n\tlet rawMouseLeft1;\n\tlet rawMouseTop1;\n\n\t// current position\n\tlet mouseLeft1;\n\tlet mouseTop1;\n\n\tlet dragging = false;\n\n\tconst drag = cursor.drag;\n\n\tlet dragX = drag.x;\n\tlet dragY = drag.y;\n\n\tif (showCursor) {\n\t\tif (cursor.x)\n\t\t\txCursor = placeDiv(CURSOR_X, over);\n\t\tif (cursor.y)\n\t\t\tyCursor = placeDiv(CURSOR_Y, over);\n\n\t\tif (scaleX.ori == 0) {\n\t\t\tvCursor = xCursor;\n\t\t\thCursor = yCursor;\n\t\t}\n\t\telse {\n\t\t\tvCursor = yCursor;\n\t\t\thCursor = xCursor;\n\t\t}\n\n\t\tmouseLeft1 = cursor.left;\n\t\tmouseTop1 = cursor.top;\n\t}\n\n\tconst select = self.select = assign({\n\t\tshow:   true,\n\t\tover:   true,\n\t\tleft:   0,\n\t\twidth:  0,\n\t\ttop:    0,\n\t\theight: 0,\n\t}, opts.select);\n\n\tconst selectDiv = select.show ? placeDiv(SELECT, select.over ? over : under) : null;\n\n\tfunction setSelect(opts, _fire) {\n\t\tif (select.show) {\n\t\t\tfor (let prop in opts) {\n\t\t\t\tselect[prop] = opts[prop];\n\n\t\t\t\tif (prop in _hideProps)\n\t\t\t\t\tsetStylePx(selectDiv, prop, opts[prop]);\n\t\t\t}\n\n\t\t\t_fire !== false && fire(\"setSelect\");\n\t\t}\n\t}\n\n\tself.setSelect = setSelect;\n\n\tfunction toggleDOM(i) {\n\t\tlet s = series[i];\n\n\t\tif (s.show)\n\t\t\tshowLegend && remClass(legendRows[i], OFF);\n\t\telse {\n\t\t\tshowLegend && addClass(legendRows[i], OFF);\n\n\t\t\tif (showCursor) {\n\t\t\t\tlet pt = cursorOnePt ? cursorPts[0] : cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _setScale(key, min, max) {\n\t\tsetScale(key, {min, max});\n\t}\n\n\tfunction setSeries(i, opts, _fire, _pub) {\n\t//\tlog(\"setSeries()\", arguments);\n\n\t\tif (opts.focus != null)\n\t\t\tsetFocus(i);\n\n\t\tif (opts.show != null) {\n\t\t\tseries.forEach((s, si) => {\n\t\t\t\tif (si > 0 && (i == si || i == null)) {\n\t\t\t\t\ts.show = opts.show;\n\t\t\t\t\ttoggleDOM(si);\n\n\t\t\t\t\tif (mode == 2) {\n\t\t\t\t\t\t_setScale(s.facets[0].scale, null, null);\n\t\t\t\t\t\t_setScale(s.facets[1].scale, null, null);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\t_setScale(s.scale, null, null);\n\n\t\t\t\t\tcommit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_fire !== false && fire(\"setSeries\", i, opts);\n\n\t\t_pub && pubSync(\"setSeries\", self, i, opts);\n\t}\n\n\tself.setSeries = setSeries;\n\n\tfunction setBand(bi, opts) {\n\t\tassign(bands[bi], opts);\n\t}\n\n\tfunction addBand(opts, bi) {\n\t\topts.fill = fnOrSelf(opts.fill || null);\n\t\topts.dir = ifNull(opts.dir, -1);\n\t\tbi = bi == null ? bands.length : bi;\n\t\tbands.splice(bi, 0, opts);\n\t}\n\n\tfunction delBand(bi) {\n\t\tif (bi == null)\n\t\t\tbands.length = 0;\n\t\telse\n\t\t\tbands.splice(bi, 1);\n\t}\n\n\tself.addBand = addBand;\n\tself.setBand = setBand;\n\tself.delBand = delBand;\n\n\tfunction setAlpha(i, value) {\n\t\tseries[i].alpha = value;\n\n\t\tif (showCursor && cursorPts[i] != null)\n\t\t\tcursorPts[i].style.opacity = value;\n\n\t\tif (showLegend && legendRows[i])\n\t\t\tlegendRows[i].style.opacity = value;\n\t}\n\n\t// y-distance\n\tlet closestDist;\n\tlet closestSeries;\n\tlet focusedSeries;\n\tconst FOCUS_TRUE  = {focus: true};\n\n\tfunction setFocus(i) {\n\t\tif (i != focusedSeries) {\n\t\t//\tlog(\"setFocus()\", arguments);\n\n\t\t\tlet allFocused = i == null;\n\n\t\t\tlet _setAlpha = focus.alpha != 1;\n\n\t\t\tseries.forEach((s, i2) => {\n\t\t\t\tif (mode == 1 || i2 > 0) {\n\t\t\t\t\tlet isFocused = allFocused || i2 == 0 || i2 == i;\n\t\t\t\t\ts._focus = allFocused ? null : isFocused;\n\t\t\t\t\t_setAlpha && setAlpha(i2, isFocused ? 1 : focus.alpha);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfocusedSeries = i;\n\t\t\t_setAlpha && commit();\n\t\t}\n\t}\n\n\tif (showLegend && cursorFocus) {\n\t\tonMouse(mouseleave, legendTable, e => {\n\t\t\tif (cursor._lock)\n\t\t\t\treturn;\n\n\t\t\tsetCursorEvent(e);\n\n\t\t\tif (focusedSeries != null)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t});\n\t}\n\n\tfunction posToVal(pos, scale, can) {\n\t\tlet sc = scales[scale];\n\n\t\tif (can)\n\t\t\tpos = pos / pxRatio - (sc.ori == 1 ? plotTopCss : plotLftCss);\n\n\t\tlet dim = plotWidCss;\n\n\t\tif (sc.ori == 1) {\n\t\t\tdim = plotHgtCss;\n\t\t\tpos = dim - pos;\n\t\t}\n\n\t\tif (sc.dir == -1)\n\t\t\tpos = dim - pos;\n\n\t\tlet _min = sc._min,\n\t\t\t_max = sc._max,\n\t\t\tpct = pos / dim;\n\n\t\tlet sv = _min + (_max - _min) * pct;\n\n\t\tlet distr = sc.distr;\n\n\t\treturn (\n\t\t\tdistr == 3 ? pow(10, sv) :\n\t\t\tdistr == 4 ? sinh(sv, sc.asinh) :\n\t\t\tdistr == 100 ? sc.bwd(sv) :\n\t\t\tsv\n\t\t);\n\t}\n\n\tfunction closestIdxFromXpos(pos, can) {\n\t\tlet v = posToVal(pos, xScaleKey, can);\n\t\treturn closestIdx(v, data[0], i0, i1);\n\t}\n\n\tself.valToIdx = val => closestIdx(val, data[0]);\n\tself.posToIdx = closestIdxFromXpos;\n\tself.posToVal = posToVal;\n\tself.valToPos = (val, scale, can) => (\n\t\tscales[scale].ori == 0 ?\n\t\tgetHPos(val, scales[scale],\n\t\t\tcan ? plotWid : plotWidCss,\n\t\t\tcan ? plotLft : 0,\n\t\t) :\n\t\tgetVPos(val, scales[scale],\n\t\t\tcan ? plotHgt : plotHgtCss,\n\t\t\tcan ? plotTop : 0,\n\t\t)\n\t);\n\n\tself.setCursor = (opts, _fire, _pub) => {\n\t\tmouseLeft1 = opts.left;\n\t\tmouseTop1 = opts.top;\n\t//\tassign(cursor, opts);\n\t\tupdateCursor(null, _fire, _pub);\n\t};\n\n\tfunction setSelH(off, dim) {\n\t\tsetStylePx(selectDiv, LEFT,  select.left = off);\n\t\tsetStylePx(selectDiv, WIDTH, select.width = dim);\n\t}\n\n\tfunction setSelV(off, dim) {\n\t\tsetStylePx(selectDiv, TOP,    select.top = off);\n\t\tsetStylePx(selectDiv, HEIGHT, select.height = dim);\n\t}\n\n\tlet setSelX = scaleX.ori == 0 ? setSelH : setSelV;\n\tlet setSelY = scaleX.ori == 1 ? setSelH : setSelV;\n\n\tfunction syncLegend() {\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tif (i == 0 && multiValLegend)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet vals = legend.values[i];\n\n\t\t\t\tlet j = 0;\n\n\t\t\t\tfor (let k in vals)\n\t\t\t\t\tlegendCells[i][j++].firstChild.nodeValue = vals[k];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setLegend(opts, _fire) {\n\t\tif (opts != null) {\n\t\t\tif (opts.idxs) {\n\t\t\t\topts.idxs.forEach((didx, sidx) => {\n\t\t\t\t\tactiveIdxs[sidx] = didx;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!isUndef(opts.idx))\n\t\t\t\tactiveIdxs.fill(opts.idx);\n\n\t\t\tlegend.idx = activeIdxs[0];\n\t\t}\n\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let sidx = 0; sidx < series.length; sidx++) {\n\t\t\t\tif (sidx > 0 || mode == 1 && !multiValLegend)\n\t\t\t\t\tsetLegendValues(sidx, activeIdxs[sidx]);\n\t\t\t}\n\n\t\t\tsyncLegend();\n\t\t}\n\n\t\tshouldSetLegend = false;\n\n\t\t_fire !== false && fire(\"setLegend\");\n\t}\n\n\tself.setLegend = setLegend;\n\n\tfunction setLegendValues(sidx, idx) {\n\t\tlet s = series[sidx];\n\t\tlet src = sidx == 0 && xScaleDistr == 2 ? data0 : data[sidx];\n\t\tlet val;\n\n\t\tif (multiValLegend)\n\t\t\tval = s.values(self, sidx, idx) ?? NULL_LEGEND_VALUES;\n\t\telse {\n\t\t\tval = s.value(self, idx == null ? null : src[idx], sidx, idx);\n\t\t\tval = val == null ? NULL_LEGEND_VALUES : {_: val};\n\t\t}\n\n\t\tlegend.values[sidx] = val;\n\t}\n\n\tfunction updateCursor(src, _fire, _pub) {\n\t//\tts == null && log(\"updateCursor()\", arguments);\n\n\t\trawMouseLeft1 = mouseLeft1;\n\t\trawMouseTop1 = mouseTop1;\n\n\t\t[mouseLeft1, mouseTop1] = cursor.move(self, mouseLeft1, mouseTop1);\n\n\t\tcursor.left = mouseLeft1;\n\t\tcursor.top = mouseTop1;\n\n\t\tif (showCursor) {\n\t\t\tvCursor && elTrans(vCursor, round(mouseLeft1), 0, plotWidCss, plotHgtCss);\n\t\t\thCursor && elTrans(hCursor, 0, round(mouseTop1), plotWidCss, plotHgtCss);\n\t\t}\n\n\t\tlet idx;\n\n\t\t// when zooming to an x scale range between datapoints the binary search\n\t\t// for nearest min/max indices results in this condition. cheap hack :D\n\t\tlet noDataInRange = i0 > i1; // works for mode 1 only\n\n\t\tclosestDist = inf;\n\t\tclosestSeries = null;\n\n\t\t// TODO: extract\n\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\tlet yDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss;\n\n\t\t// if cursor hidden, hide points & clear legend vals\n\t\tif (mouseLeft1 < 0 || dataLen == 0 || noDataInRange) {\n\t\t\tidx = cursor.idx = null;\n\n\t\t\tfor (let i = 0; i < series.length; i++) {\n\t\t\t\tlet pt = cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\n\t\t\tif (cursorFocus)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, src == null && syncOpts.setSeries);\n\n\t\t\tif (legend.live) {\n\t\t\t\tactiveIdxs.fill(idx);\n\t\t\t\tshouldSetLegend = true;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t//\tlet pctY = 1 - (y / rect.height);\n\n\t\t\tlet mouseXPos, valAtPosX, xPos;\n\n\t\t\tif (mode == 1) {\n\t\t\t\tmouseXPos = scaleX.ori == 0 ? mouseLeft1 : mouseTop1;\n\t\t\t\tvalAtPosX = posToVal(mouseXPos, xScaleKey);\n\t\t\t\tidx = cursor.idx = closestIdx(valAtPosX, data[0], i0, i1);\n\t\t\t\txPos = valToPosX(data[0][idx], scaleX, xDim, 0);\n\t\t\t}\n\n\t\t\t// closest pt values\n\t\t\tlet _ptLft = -10;\n\t\t\tlet _ptTop = -10;\n\t\t\tlet _ptWid = 0;\n\t\t\tlet _ptHgt = 0;\n\t\t\tlet _centered = true;\n\t\t\tlet _ptFill = '';\n\t\t\tlet _ptStroke = '';\n\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tlet s = series[i];\n\n\t\t\t\tlet idx1  = activeIdxs[i];\n\t\t\t\tlet yVal1 = idx1 == null ? null : (mode == 1 ? data[i][idx1] : data[i][1][idx1]);\n\n\t\t\t\tlet idx2  = cursor.dataIdx(self, i, idx, valAtPosX);\n\t\t\t\tlet yVal2 = idx2 == null ? null : (mode == 1 ? data[i][idx2] : data[i][1][idx2]);\n\n\t\t\t\tshouldSetLegend = shouldSetLegend || yVal2 != yVal1 || idx2 != idx1;\n\n\t\t\t\tactiveIdxs[i] = idx2;\n\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet xPos2 = idx2 == null ? -10 : idx2 == idx ? xPos : valToPosX(mode == 1 ? data[0][idx2] : data[i][0][idx2], scaleX, xDim, 0);\n\n\t\t\t\t\t// this doesnt really work for state timeline, heatmap, status history (where the value maps to color, not y coords)\n\t\t\t\t\tlet yPos = yVal2 == null ? -10 : valToPosY(yVal2, mode == 1 ? scales[s.scale] : scales[s.facets[1].scale], yDim, 0);\n\n\t\t\t\t\tif (cursorFocus && yVal2 != null) {\n\t\t\t\t\t\tlet mouseYPos = scaleX.ori == 1 ? mouseLeft1 : mouseTop1;\n\t\t\t\t\t\tlet dist = abs(focus.dist(self, i, idx2, yPos, mouseYPos));\n\n\t\t\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t\t\tlet bias = focus.bias;\n\n\t\t\t\t\t\t\tif (bias != 0) {\n\t\t\t\t\t\t\t\tlet mouseYVal = posToVal(mouseYPos, s.scale);\n\n\t\t\t\t\t\t\t\tlet seriesYValSign = yVal2     >= 0 ? 1 : -1;\n\t\t\t\t\t\t\t\tlet mouseYValSign  = mouseYVal >= 0 ? 1 : -1;\n\n\t\t\t\t\t\t\t\t// with a focus bias, we will never cross zero when prox testing\n\t\t\t\t\t\t\t\t// it's either closest towards zero, or closest away from zero\n\t\t\t\t\t\t\t\tif (mouseYValSign == seriesYValSign && (\n\t\t\t\t\t\t\t\t\tmouseYValSign == 1 ?\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 >= mouseYVal : yVal2 <= mouseYVal) :  // >= 0\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 <= mouseYVal : yVal2 >= mouseYVal)    //  < 0\n\t\t\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldSetLegend || cursorOnePt) {\n\t\t\t\t\t\tlet hPos, vPos;\n\n\t\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\t\thPos = xPos2;\n\t\t\t\t\t\t\tvPos = yPos;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\thPos = yPos;\n\t\t\t\t\t\t\tvPos = xPos2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet ptWid, ptHgt, ptLft, ptTop,\n\t\t\t\t\t\t\tptStroke, ptFill,\n\t\t\t\t\t\t\tcentered = true,\n\t\t\t\t\t\t\tgetBBox = points.bbox;\n\n\t\t\t\t\t\tif (getBBox != null) {\n\t\t\t\t\t\t\tcentered = false;\n\n\t\t\t\t\t\t\tlet bbox = getBBox(self, i);\n\n\t\t\t\t\t\t\tptLft = bbox.left;\n\t\t\t\t\t\t\tptTop = bbox.top;\n\t\t\t\t\t\t\tptWid = bbox.width;\n\t\t\t\t\t\t\tptHgt = bbox.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tptLft = hPos;\n\t\t\t\t\t\t\tptTop = vPos;\n\t\t\t\t\t\t\tptWid = ptHgt = points.size(self, i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tptFill = points.fill(self, i);\n\t\t\t\t\t\tptStroke = points.stroke(self, i);\n\n\t\t\t\t\t\tif (cursorOnePt) {\n\t\t\t\t\t\t\tif (i == closestSeries && closestDist <= focus.prox) {\n\t\t\t\t\t\t\t\t_ptLft = ptLft;\n\t\t\t\t\t\t\t\t_ptTop = ptTop;\n\t\t\t\t\t\t\t\t_ptWid = ptWid;\n\t\t\t\t\t\t\t\t_ptHgt = ptHgt;\n\t\t\t\t\t\t\t\t_centered = centered;\n\t\t\t\t\t\t\t\t_ptFill = ptFill;\n\t\t\t\t\t\t\t\t_ptStroke = ptStroke;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\t\tcursorPtsLft[i] = ptLft;\n\t\t\t\t\t\t\t\tcursorPtsTop[i] = ptTop;\n\n\t\t\t\t\t\t\t\telSize(pt, ptWid, ptHgt, centered);\n\t\t\t\t\t\t\t\telColor(pt, ptFill, ptStroke);\n\t\t\t\t\t\t\t\telTrans(pt, ceil(ptLft), ceil(ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if only using single hover point (at cursorPts[0])\n\t\t\t// we have trigger styling at last visible series (once closestSeries is settled)\n\t\t\tif (cursorOnePt) {\n\t\t\t\t// some of this logic is similar to series focus below, since it matches the behavior by design\n\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tlet focusChanged = focusedSeries == null ? closestDist <= p : (closestDist > p || closestSeries != focusedSeries);\n\n\t\t\t\tif (shouldSetLegend || focusChanged) {\n\t\t\t\t\tlet pt = cursorPts[0];\n\n\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\tcursorPtsLft[0] = _ptLft;\n\t\t\t\t\t\tcursorPtsTop[0] = _ptTop;\n\n\t\t\t\t\t\telSize(pt, _ptWid, _ptHgt, _centered);\n\t\t\t\t\t\telColor(pt, _ptFill, _ptStroke);\n\t\t\t\t\t\telTrans(pt, ceil(_ptLft), ceil(_ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// nit: cursor.drag.setSelect is assumed always true\n\t\tif (select.show && dragging) {\n\t\t\tif (src != null) {\n\t\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\t\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\t\t\t\tlet [xKeySrc, yKeySrc] = src.cursor.sync.scales;\n\n\t\t\t\t// match the dragX/dragY implicitness/explicitness of src\n\t\t\t\tlet sdrag = src.cursor.drag;\n\t\t\t\tdragX = sdrag._x;\n\t\t\t\tdragY = sdrag._y;\n\n\t\t\t\tif (dragX || dragY) {\n\t\t\t\t\tlet { left, top, width, height } = src.select;\n\n\t\t\t\t\tlet sori = src.scales[xKeySrc].ori;\n\t\t\t\t\tlet sPosToVal = src.posToVal;\n\n\t\t\t\t\tlet sOff, sDim, sc, a, b;\n\n\t\t\t\t\tlet matchingX = xKey != null && matchXKeys(xKey, xKeySrc);\n\t\t\t\t\tlet matchingY = yKey != null && matchYKeys(yKey, yKeySrc);\n\n\t\t\t\t\tif (matchingX && dragX) {\n\t\t\t\t\t\tif (sori == 0) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[xKey];\n\n\t\t\t\t\t\ta = valToPosX(sPosToVal(sOff, xKeySrc),        sc, xDim, 0);\n\t\t\t\t\t\tb = valToPosX(sPosToVal(sOff + sDim, xKeySrc), sc, xDim, 0);\n\n\t\t\t\t\t\tsetSelX(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelX(0, xDim);\n\n\t\t\t\t\tif (matchingY && dragY) {\n\t\t\t\t\t\tif (sori == 1) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[yKey];\n\n\t\t\t\t\t\ta = valToPosY(sPosToVal(sOff, yKeySrc),        sc, yDim, 0);\n\t\t\t\t\t\tb = valToPosY(sPosToVal(sOff + sDim, yKeySrc), sc, yDim, 0);\n\n\t\t\t\t\t\tsetSelY(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\thideSelect();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet rawDX = abs(rawMouseLeft1 - rawMouseLeft0);\n\t\t\t\tlet rawDY = abs(rawMouseTop1 - rawMouseTop0);\n\n\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\tlet _rawDX = rawDX;\n\t\t\t\t\trawDX = rawDY;\n\t\t\t\t\trawDY = _rawDX;\n\t\t\t\t}\n\n\t\t\t\tdragX = drag.x && rawDX >= drag.dist;\n\t\t\t\tdragY = drag.y && rawDY >= drag.dist;\n\n\t\t\t\tlet uni = drag.uni;\n\n\t\t\t\tif (uni != null) {\n\t\t\t\t\t// only calc drag status if they pass the dist thresh\n\t\t\t\t\tif (dragX && dragY) {\n\t\t\t\t\t\tdragX = rawDX >= uni;\n\t\t\t\t\t\tdragY = rawDY >= uni;\n\n\t\t\t\t\t\t// force unidirectionality when both are under uni limit\n\t\t\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\t\t\tif (rawDY > rawDX)\n\t\t\t\t\t\t\t\tdragY = true;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdragX = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (drag.x && drag.y && (dragX || dragY))\n\t\t\t\t\t// if omni with no uni then both dragX / dragY should be true if either is true\n\t\t\t\t\tdragX = dragY = true;\n\n\t\t\t\tlet p0, p1;\n\n\t\t\t\tif (dragX) {\n\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelX(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragY)\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\n\t\t\t\tif (dragY) {\n\t\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelY(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragX)\n\t\t\t\t\t\tsetSelX(0, xDim);\n\t\t\t\t}\n\n\t\t\t\t// the drag didn't pass the dist requirement\n\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\tsetSelX(0, 0);\n\t\t\t\t\tsetSelY(0, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdrag._x = dragX;\n\t\tdrag._y = dragY;\n\n\t\tif (src == null) {\n\t\t\tif (_pub) {\n\t\t\t\tif (syncKey != null) {\n\t\t\t\t\tlet [xSyncKey, ySyncKey] = syncOpts.scales;\n\n\t\t\t\t\tsyncOpts.values[0] = xSyncKey != null ? posToVal(scaleX.ori == 0 ? mouseLeft1 : mouseTop1, xSyncKey) : null;\n\t\t\t\t\tsyncOpts.values[1] = ySyncKey != null ? posToVal(scaleX.ori == 1 ? mouseLeft1 : mouseTop1, ySyncKey) : null;\n\t\t\t\t}\n\n\t\t\t\tpubSync(mousemove, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, idx);\n\t\t\t}\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tlet shouldPub = _pub && syncOpts.setSeries;\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tif (focusedSeries == null) {\n\t\t\t\t\tif (closestDist <= p)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (closestDist > p)\n\t\t\t\t\t\tsetSeries(null, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t\telse if (closestSeries != focusedSeries)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (shouldSetLegend) {\n\t\t\tlegend.idx = idx;\n\t\t\tsetLegend();\n\t\t}\n\n\t\t_fire !== false && fire(\"setCursor\");\n\t}\n\n\tlet rect = null;\n\n\tObject.defineProperty(self, 'rect', {\n\t\tget() {\n\t\t\tif (rect == null)\n\t\t\t\tsyncRect(false);\n\n\t\t\treturn rect;\n\t\t},\n\t});\n\n\tfunction syncRect(defer = false) {\n\t\tif (defer)\n\t\t\trect = null;\n\t\telse {\n\t\t\trect = over.getBoundingClientRect();\n\t\t\tfire(\"syncRect\", rect);\n\t\t}\n\t}\n\n\tfunction mouseMove(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\t// Chrome on Windows has a bug which triggers a stray mousemove event after an initial mousedown event\n\t\t// when clicking into a plot as part of re-focusing the browser window.\n\t\t// we gotta ignore it to avoid triggering a phantom drag / setSelect\n\t\t// However, on touch-only devices Chrome-based browsers trigger a 0-distance mousemove before mousedown\n\t\t// so we don't ignore it when mousedown has set the dragging flag\n\t\tif (dragging && e != null && e.movementX == 0 && e.movementY == 0)\n\t\t\treturn;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, e != null);\n\n\t\tif (e != null)\n\t\t\tupdateCursor(null, true, true);\n\t\telse\n\t\t\tupdateCursor(src, true, false);\n\t}\n\n\tfunction cacheMouse(e, src, _l, _t, _w, _h, _i, initial, snap) {\n\t\tif (rect == null)\n\t\t\tsyncRect(false);\n\n\t\tsetCursorEvent(e);\n\n\t\tif (e != null) {\n\t\t\t_l = e.clientX - rect.left;\n\t\t\t_t = e.clientY - rect.top;\n\t\t}\n\t\telse {\n\t\t\tif (_l < 0 || _t < 0) {\n\t\t\t\tmouseLeft1 = -10;\n\t\t\t\tmouseTop1 = -10;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\n\t\t\tlet syncOptsSrc = src.cursor.sync;\n\t\t\tlet [xValSrc, yValSrc] = syncOptsSrc.values;\n\t\t\tlet [xKeySrc, yKeySrc] = syncOptsSrc.scales;\n\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\n\t\t\tlet rotSrc = src.axes[0].side % 2 == 1;\n\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss,\n\t\t\t\tyDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss,\n\t\t\t\t_xDim = rotSrc ? _h : _w,\n\t\t\t\t_yDim = rotSrc ? _w : _h,\n\t\t\t\t_xPos = rotSrc ? _t : _l,\n\t\t\t\t_yPos = rotSrc ? _l : _t;\n\n\t\t\tif (xKeySrc != null)\n\t\t\t\t_l = matchXKeys(xKey, xKeySrc) ? getPos(xValSrc, scales[xKey], xDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_l = xDim * (_xPos/_xDim);\n\n\t\t\tif (yKeySrc != null)\n\t\t\t\t_t = matchYKeys(yKey, yKeySrc) ? getPos(yValSrc, scales[yKey], yDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_t = yDim * (_yPos/_yDim);\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\tlet __l = _l;\n\t\t\t\t_l = _t;\n\t\t\t\t_t = __l;\n\t\t\t}\n\t\t}\n\n\t\tif (snap && (src == null || src.cursor.event.type == mousemove)) {\n\t\t\tif (_l <= 1 || _l >= plotWidCss - 1)\n\t\t\t\t_l = incrRound(_l, plotWidCss);\n\n\t\t\tif (_t <= 1 || _t >= plotHgtCss - 1)\n\t\t\t\t_t = incrRound(_t, plotHgtCss);\n\t\t}\n\n\t\tif (initial) {\n\t\t\trawMouseLeft0 = _l;\n\t\t\trawMouseTop0 = _t;\n\n\t\t\t[mouseLeft0, mouseTop0] = cursor.move(self, _l, _t);\n\t\t}\n\t\telse {\n\t\t\tmouseLeft1 = _l;\n\t\t\tmouseTop1 = _t;\n\t\t}\n\t}\n\n\tconst _hideProps = {\n\t\twidth: 0,\n\t\theight: 0,\n\t\tleft: 0,\n\t\ttop: 0,\n\t};\n\n\tfunction hideSelect() {\n\t\tsetSelect(_hideProps, false);\n\t}\n\n\tlet downSelectLeft;\n\tlet downSelectTop;\n\tlet downSelectWidth;\n\tlet downSelectHeight;\n\n\tfunction mouseDown(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = true;\n\t\tdragX = dragY = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, true, false);\n\n\t\tif (e != null) {\n\t\t\tonMouse(mouseup, doc, mouseUp, false);\n\t\t\tpubSync(mousedown, self, mouseLeft0, mouseTop0, plotWidCss, plotHgtCss, null);\n\t\t}\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tdownSelectLeft   = left;\n\t\tdownSelectTop    = top;\n\t\tdownSelectWidth  = width;\n\t\tdownSelectHeight = height;\n\n\t//\thideSelect();\n\t}\n\n\tfunction mouseUp(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, true);\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tlet hasSelect = width > 0 || height > 0;\n\t\tlet chgSelect = (\n\t\t\tdownSelectLeft   != left   ||\n\t\t\tdownSelectTop    != top    ||\n\t\t\tdownSelectWidth  != width  ||\n\t\t\tdownSelectHeight != height\n\t\t);\n\n\t\thasSelect && chgSelect && setSelect(select);\n\n\t\tif (drag.setScale && hasSelect && chgSelect) {\n\t\t//\tif (syncKey != null) {\n\t\t//\t\tdragX = drag.x;\n\t\t//\t\tdragY = drag.y;\n\t\t//\t}\n\n\t\t\tlet xOff = left,\n\t\t\t\txDim = width,\n\t\t\t\tyOff = top,\n\t\t\t\tyDim = height;\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\txOff = top,\n\t\t\t\txDim = height,\n\t\t\t\tyOff = left,\n\t\t\t\tyDim = width;\n\t\t\t}\n\n\t\t\tif (dragX) {\n\t\t\t\t_setScale(xScaleKey,\n\t\t\t\t\tposToVal(xOff, xScaleKey),\n\t\t\t\t\tposToVal(xOff + xDim, xScaleKey)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (dragY) {\n\t\t\t\tfor (let k in scales) {\n\t\t\t\t\tlet sc = scales[k];\n\n\t\t\t\t\tif (k != xScaleKey && sc.from == null && sc.min != inf) {\n\t\t\t\t\t\t_setScale(k,\n\t\t\t\t\t\t\tposToVal(yOff + yDim, k),\n\t\t\t\t\t\t\tposToVal(yOff, k)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideSelect();\n\t\t}\n\t\telse if (cursor.lock) {\n\t\t\tcursor._lock = !cursor._lock;\n\t\t\tupdateCursor(src, true, e != null);\n\t\t}\n\n\t\tif (e != null) {\n\t\t\toffMouse(mouseup, doc);\n\t\t\tpubSync(mouseup, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t\t}\n\t}\n\n\tfunction mouseLeave(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tlet _dragging = dragging;\n\n\t\tif (dragging) {\n\t\t\t// handle case when mousemove aren't fired all the way to edges by browser\n\t\t\tlet snapH = true;\n\t\t\tlet snapV = true;\n\t\t\tlet snapProx = 10;\n\n\t\t\tlet dragH, dragV;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tdragH = dragX;\n\t\t\t\tdragV = dragY;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdragH = dragY;\n\t\t\t\tdragV = dragX;\n\t\t\t}\n\n\t\t\tif (dragH && dragV) {\n\t\t\t\t// maybe omni corner snap\n\t\t\t\tsnapH = mouseLeft1 <= snapProx || mouseLeft1 >= plotWidCss - snapProx;\n\t\t\t\tsnapV = mouseTop1  <= snapProx || mouseTop1  >= plotHgtCss - snapProx;\n\t\t\t}\n\n\t\t\tif (dragH && snapH)\n\t\t\t\tmouseLeft1 = mouseLeft1 < mouseLeft0 ? 0 : plotWidCss;\n\n\t\t\tif (dragV && snapV)\n\t\t\t\tmouseTop1 = mouseTop1 < mouseTop0 ? 0 : plotHgtCss;\n\n\t\t\tupdateCursor(null, true, true);\n\n\t\t\tdragging = false;\n\t\t}\n\n\t\tmouseLeft1 = -10;\n\t\tmouseTop1 = -10;\n\n\t\tactiveIdxs.fill(null);\n\n\t\t// passing a non-null timestamp to force sync/mousemove event\n\t\tupdateCursor(null, true, true);\n\n\t\tif (_dragging)\n\t\t\tdragging = _dragging;\n\t}\n\n\tfunction dblClick(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tautoScaleX();\n\n\t\thideSelect();\n\n\t\tif (e != null)\n\t\t\tpubSync(dblclick, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t}\n\n\tfunction syncPxRatio() {\n\t\taxes.forEach(syncFontSize);\n\t\t_setSize(self.width, self.height, true);\n\t}\n\n\ton(dppxchange, win, syncPxRatio);\n\n\t// internal pub/sub\n\tconst events = {};\n\n\tevents.mousedown = mouseDown;\n\tevents.mousemove = mouseMove;\n\tevents.mouseup = mouseUp;\n\tevents.dblclick = dblClick;\n\tevents[\"setSeries\"] = (e, src, idx, opts) => {\n\t\tlet seriesIdxMatcher = syncOpts.match[2];\n\t\tidx = seriesIdxMatcher(self, src, idx);\n\t\tidx != -1 && setSeries(idx, opts, true, false);\n\t};\n\n\tif (showCursor) {\n\t\tonMouse(mousedown,  over, mouseDown);\n\t\tonMouse(mousemove,  over, mouseMove);\n\t\tonMouse(mouseenter, over, e => {\n\t\t\tsetCursorEvent(e);\n\t\t\tsyncRect(false);\n\t\t});\n\t\tonMouse(mouseleave, over, mouseLeave);\n\n\t\tonMouse(dblclick, over, dblClick);\n\n\t\tcursorPlots.add(self);\n\n\t\tself.syncRect = syncRect;\n\t}\n\n\t// external on/off\n\tconst hooks = self.hooks = opts.hooks || {};\n\n\tfunction fire(evName, a1, a2) {\n\t\tif (deferHooks)\n\t\t\thooksQueue.push([evName, a1, a2]);\n\t\telse {\n\t\t\tif (evName in hooks) {\n\t\t\t\thooks[evName].forEach(fn => {\n\t\t\t\t\tfn.call(null, self, a1, a2);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t(opts.plugins || []).forEach(p => {\n\t\tfor (let evName in p.hooks)\n\t\t\thooks[evName] = (hooks[evName] || []).concat(p.hooks[evName]);\n\t});\n\n\tconst seriesIdxMatcher = (self, src, srcSeriesIdx) => srcSeriesIdx;\n\n\tconst syncOpts = assign({\n\t\tkey: null,\n\t\tsetSeries: false,\n\t\tfilters: {\n\t\t\tpub: retTrue,\n\t\t\tsub: retTrue,\n\t\t},\n\t\tscales: [xScaleKey, series[1] ? series[1].scale : null],\n\t\tmatch: [retEq, retEq, seriesIdxMatcher],\n\t\tvalues: [null, null],\n\t}, cursor.sync);\n\n\tif (syncOpts.match.length == 2)\n\t\tsyncOpts.match.push(seriesIdxMatcher);\n\n\tcursor.sync = syncOpts;\n\n\tconst syncKey = syncOpts.key;\n\n\tconst sync = _sync(syncKey);\n\n\tfunction pubSync(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.pub(type, src, x, y, w, h, i))\n\t\t\tsync.pub(type, src, x, y, w, h, i);\n\t}\n\n\tsync.sub(self);\n\n\tfunction pub(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.sub(type, src, x, y, w, h, i))\n\t\t\tevents[type](null, src, x, y, w, h, i);\n\t}\n\n\tself.pub = pub;\n\n\tfunction destroy() {\n\t\tsync.unsub(self);\n\t\tcursorPlots.delete(self);\n\t\tmouseListeners.clear();\n\t\toff(dppxchange, win, syncPxRatio);\n\t\troot.remove();\n\t\tlegendTable?.remove(); // in case mounted outside of root\n\t\tfire(\"destroy\");\n\t}\n\n\tself.destroy = destroy;\n\n\tfunction _init() {\n\t\tfire(\"init\", opts, data);\n\n\t\tsetData(data || opts.data, false);\n\n\t\tif (pendScales[xScaleKey])\n\t\t\tsetScale(xScaleKey, pendScales[xScaleKey]);\n\t\telse\n\t\t\tautoScaleX();\n\n\t\tshouldSetSelect = select.show && (select.width > 0 || select.height > 0);\n\t\tshouldSetCursor = shouldSetLegend = true;\n\n\t\t_setSize(opts.width, opts.height);\n\t}\n\n\tseries.forEach(initSeries);\n\n\taxes.forEach(initAxis);\n\n\tif (then) {\n\t\tif (then instanceof HTMLElement) {\n\t\t\tthen.appendChild(root);\n\t\t\t_init();\n\t\t}\n\t\telse\n\t\t\tthen(self, _init);\n\t}\n\telse\n\t\t_init();\n\n\treturn self;\n}\n\nuPlot.assign = assign;\nuPlot.fmtNum = fmtNum;\nuPlot.rangeNum = rangeNum;\nuPlot.rangeLog = rangeLog;\nuPlot.rangeAsinh = rangeAsinh;\nuPlot.orient   = orient;\nuPlot.pxRatio = pxRatio;\n\n{\n\tuPlot.join = join;\n}\n\n{\n\tuPlot.fmtDate = fmtDate;\n\tuPlot.tzDate  = tzDate;\n}\n\nuPlot.sync = _sync;\n\n{\n\tuPlot.addGap = addGap;\n\tuPlot.clipGaps = clipGaps;\n\n\tlet paths = uPlot.paths = {\n\t\tpoints,\n\t};\n\n\t(paths.linear  = linear);\n\t(paths.stepped = stepped);\n\t(paths.bars    = bars);\n\t(paths.spline  = monotoneCubic);\n}\n\nexport { uPlot as default };\n","/**\n * Chart Utilities Module\n * Shared utilities for Kurva-S and Gantt charts\n *\n * Migrated from legacy chart modules\n * Date: 2025-11-20\n */\n\n// =========================================================================\n// CONSTANTS\n// =========================================================================\n\nexport const ONE_DAY_MS = 24 * 60 * 60 * 1000;\n\n// =========================================================================\n// THEME UTILITIES\n// =========================================================================\n\n/**\n * Get theme-specific colors for charts\n * Supports Bootstrap dark/light theme\n *\n * @returns {Object} Theme colors\n */\nexport function getThemeColors() {\n  const theme = document.documentElement.getAttribute('data-bs-theme') || 'light';\n\n  if (theme === 'dark') {\n    return {\n      text: '#f8fafc',\n      axis: '#cbd5e1',\n      plannedLine: '#60a5fa',\n      plannedArea: 'rgba(96, 165, 250, 0.15)',\n      actualLine: '#34d399',\n      actualArea: 'rgba(52, 211, 153, 0.18)',\n      costActualLine: '#f87171',\n      costActualArea: 'rgba(248, 113, 113, 0.18)',\n      gridLine: '#334155',\n      background: '#1e293b',\n    };\n  }\n\n  return {\n    text: '#1f2937',\n    axis: '#374151',\n    plannedLine: '#0d6efd',\n    plannedArea: 'rgba(13, 110, 253, 0.12)',\n    actualLine: '#198754',\n    actualArea: 'rgba(25, 135, 84, 0.12)',\n    costActualLine: '#dc3545',\n    costActualArea: 'rgba(220, 53, 69, 0.12)',\n    gridLine: '#e5e7eb',\n    background: '#ffffff',\n  };\n}\n\n/**\n * Setup theme observer for chart updates\n * Watches for data-bs-theme attribute changes\n *\n * @param {Function} callback - Called when theme changes\n * @returns {MutationObserver} Observer instance\n */\nexport function setupThemeObserver(callback) {\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {\n        const theme = document.documentElement.getAttribute('data-bs-theme');\n        console.log('[ChartUtils] Theme changed to:', theme);\n        callback(theme);\n      }\n    });\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['data-bs-theme']\n  });\n\n  return observer;\n}\n\n// =========================================================================\n// DATE UTILITIES\n// =========================================================================\n\n/**\n * Normalize date to Date object\n * Handles multiple input formats: Date, ISO string, timestamp\n *\n * @param {Date|string|number} input - Date input\n * @returns {Date|null} Normalized date or null if invalid\n */\nexport function normalizeDate(input) {\n  if (!input) return null;\n\n  // Already a Date object\n  if (input instanceof Date) {\n    return Number.isNaN(input.getTime()) ? null : input;\n  }\n\n  // ISO string or other string format\n  if (typeof input === 'string') {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  // Timestamp\n  if (typeof input === 'number' && Number.isFinite(input)) {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  return null;\n}\n\n/**\n * Format date to YYYY-MM-DD string\n *\n * @param {Date} date - Date to format\n * @returns {string} Formatted date string\n */\nexport function formatDate(date) {\n  if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n    return '';\n  }\n\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * Calculate date range from time columns\n *\n * @param {Array} columns - Array of time column objects\n * @returns {Object} {startDate, endDate}\n */\nexport function calculateDateRange(columns) {\n  if (!Array.isArray(columns) || columns.length === 0) {\n    return { startDate: null, endDate: null };\n  }\n\n  let minDate = null;\n  let maxDate = null;\n\n  columns.forEach(col => {\n    const start = normalizeDate(col.startDate);\n    const end = normalizeDate(col.endDate);\n\n    if (start && (!minDate || start < minDate)) {\n      minDate = start;\n    }\n\n    if (end && (!maxDate || end > maxDate)) {\n      maxDate = end;\n    }\n  });\n\n  return { startDate: minDate, endDate: maxDate };\n}\n\n/**\n * Get sorted time columns\n * Sorts by startDate, then by index\n *\n * @param {Array} columns - Time columns\n * @returns {Array} Sorted columns\n */\nexport function getSortedColumns(columns) {\n  if (!Array.isArray(columns)) return [];\n\n  return columns.slice().sort((a, b) => {\n    const aStart = normalizeDate(a.startDate);\n    const bStart = normalizeDate(b.startDate);\n\n    if (aStart && bStart) {\n      return aStart.getTime() - bStart.getTime();\n    }\n\n    return (a.index || 0) - (b.index || 0);\n  });\n}\n\n// =========================================================================\n// VOLUME UTILITIES\n// =========================================================================\n\n/**\n * Build volume lookup map from state\n * Handles both Map and Object formats\n *\n * @param {Object} state - Application state\n * @returns {Map} Volume lookup (pekerjaanId â†’ volume)\n */\nexport function buildVolumeLookup(state) {\n  const lookup = new Map();\n\n  const setVolume = (key, value) => {\n    const numericKey = Number(key);\n    const volume = Number.isFinite(value) && value > 0 ? value : null;\n\n    if (volume === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), volume);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), volume);\n    }\n  };\n\n  // Handle Map format\n  if (state.volumeMap instanceof Map) {\n    state.volumeMap.forEach((value, key) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n  // Handle Object format\n  else if (state.volumeMap && typeof state.volumeMap === 'object') {\n    Object.entries(state.volumeMap).forEach(([key, value]) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get volume for a specific pekerjaan\n *\n * @param {Map} volumeLookup - Volume lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found\n * @returns {number} Volume value\n */\nexport function getVolumeForPekerjaan(volumeLookup, pekerjaanId, fallback = 1) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (volumeLookup.has(variant)) {\n      return volumeLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n/**\n * Build harga (cost) lookup map from state\n * Phase 2F.0: Kurva S should use HARGA (Rupiah) instead of volume\n *\n * @param {Object} state - Application state\n * @returns {Map} Harga lookup map (pekerjaanId â†’ total harga in Rp)\n */\nexport function buildHargaLookup(state) {\n  const lookup = new Map();\n\n  const setHarga = (key, value) => {\n    const numericKey = Number(key);\n    const harga = Number.isFinite(value) && value >= 0 ? value : null;\n\n    if (harga === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), harga);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), harga);\n    }\n  };\n\n  // Handle Map format\n  if (state.hargaMap instanceof Map) {\n    state.hargaMap.forEach((value, key) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n  // Handle Object format\n  else if (state.hargaMap && typeof state.hargaMap === 'object') {\n    Object.entries(state.hargaMap).forEach(([key, value]) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get harga for a specific pekerjaan\n * Phase 2F.0: Used for harga-weighted Kurva S calculation\n *\n * @param {Map} hargaLookup - Harga lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found (default: 0)\n * @returns {number} Total harga (Rp) for the pekerjaan\n */\nexport function getHargaForPekerjaan(hargaLookup, pekerjaanId, fallback = 0) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (hargaLookup.has(variant)) {\n      return hargaLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n// =========================================================================\n// DATA UTILITIES\n// =========================================================================\n\n/**\n * Build cell value map from assignmentMap and modifiedCells\n * Modified cells override assignment values\n *\n * @deprecated Phase 0.5: Use StateManager.getAllCellsForMode() instead\n * This function is redundant with StateManager's built-in merge logic.\n *\n * Migration guide:\n * BEFORE: const cellValues = buildCellValueMap(state);\n * AFTER:  const cellValues = stateManager.getAllCellsForMode('planned');\n *\n * @param {Object} state - Application state\n * @returns {Map} Cell value map (cellKey â†’ percentage)\n */\nexport function buildCellValueMap(state) {\n  console.warn('[chart-utils] buildCellValueMap() is deprecated. Use StateManager.getAllCellsForMode() instead.');\n\n  const map = new Map();\n\n  const assignValue = (key, value) => {\n    const numeric = parseFloat(value);\n    map.set(String(key), Number.isFinite(numeric) ? numeric : 0);\n  };\n\n  // First, load saved assignment values\n  if (state.assignmentMap instanceof Map) {\n    state.assignmentMap.forEach((value, key) => assignValue(key, value));\n  } else if (state.assignmentMap && typeof state.assignmentMap === 'object') {\n    Object.entries(state.assignmentMap).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  // Then, override with modified cells (unsaved changes)\n  if (state.modifiedCells instanceof Map) {\n    state.modifiedCells.forEach((value, key) => assignValue(key, value));\n  } else if (state.modifiedCells && typeof state.modifiedCells === 'object') {\n    Object.entries(state.modifiedCells).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  return map;\n}\n\n/**\n * Collect all pekerjaan IDs from state and cell values\n *\n * @param {Object} state - Application state\n * @param {Map} cellValues - Cell value map\n * @returns {Set} Set of pekerjaan IDs\n */\nexport function collectPekerjaanIds(state, cellValues) {\n  const ids = new Set();\n\n  // From flatPekerjaan array\n  if (Array.isArray(state.flatPekerjaan)) {\n    state.flatPekerjaan.forEach((node) => {\n      if (node && (node.type === 'pekerjaan' || typeof node.type === 'undefined')) {\n        ids.add(String(node.id));\n      }\n    });\n  }\n\n  // From cell keys (format: \"pekerjaanId-tahapanId\")\n  cellValues.forEach((_, key) => {\n    const [pekerjaanId] = String(key).split('-');\n    if (pekerjaanId) {\n      ids.add(pekerjaanId);\n    }\n  });\n\n  return ids;\n}\n\n// =========================================================================\n// NUMBER UTILITIES\n// =========================================================================\n\n/**\n * Format percentage for display\n *\n * @param {number} value - Percentage value (0-100)\n * @param {number} decimals - Number of decimal places\n * @returns {string} Formatted percentage\n */\nexport function formatPercentage(value, decimals = 1) {\n  if (!Number.isFinite(value)) return '0%';\n\n  const rounded = decimals === 0\n    ? Math.round(value)\n    : parseFloat(value.toFixed(decimals));\n\n  return `${rounded}%`;\n}\n\n/**\n * Format number as Indonesian Rupiah\n * Phase 2F.0: Display currency in Kurva S tooltips\n *\n * @param {number} amount - Amount in Rupiah\n * @returns {string} Formatted currency string (e.g., \"Rp 1.234.567\")\n */\nexport function formatRupiah(amount) {\n  if (!Number.isFinite(amount)) return 'Rp 0';\n\n  // Format with thousand separators (Indonesian style)\n  const formatted = Math.round(amount).toLocaleString('id-ID');\n  return `Rp ${formatted}`;\n}\n\n/**\n * Clamp number between min and max\n *\n * @param {number} value - Value to clamp\n * @param {number} min - Minimum value\n * @param {number} max - Maximum value\n * @returns {number} Clamped value\n */\nexport function clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n// =========================================================================\n// RESIZE UTILITIES\n// =========================================================================\n\n/**\n * Create debounced resize handler\n *\n * @param {Function} callback - Function to call on resize\n * @param {number} delay - Debounce delay in ms\n * @returns {Function} Debounced handler\n */\nexport function createResizeHandler(callback, delay = 150) {\n  let timeoutId = null;\n\n  return function debouncedResize() {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = setTimeout(() => {\n      callback();\n      timeoutId = null;\n    }, delay);\n  };\n}\n\n/**\n * Setup resize observer for chart container\n *\n * @param {HTMLElement} container - Container element\n * @param {Function} callback - Called when container resizes\n * @returns {ResizeObserver} Observer instance\n */\nexport function setupResizeObserver(container, callback) {\n  if (!container || typeof ResizeObserver === 'undefined') {\n    return null;\n  }\n\n  const observer = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n      if (entry.target === container) {\n        callback(entry.contentRect);\n      }\n    }\n  });\n\n  observer.observe(container);\n\n  return observer;\n}\n\n// =========================================================================\n// VALIDATION UTILITIES\n// =========================================================================\n\n/**\n * Validate chart data\n *\n * @param {Object} data - Chart data\n * @returns {Object} {isValid, errors}\n */\nexport function validateChartData(data) {\n  const errors = [];\n\n  if (!data || typeof data !== 'object') {\n    errors.push('Chart data must be an object');\n    return { isValid: false, errors };\n  }\n\n  if (!Array.isArray(data.xAxis)) {\n    errors.push('xAxis must be an array');\n  }\n\n  if (!Array.isArray(data.series)) {\n    errors.push('series must be an array');\n  }\n\n  if (data.xAxis && data.series) {\n    data.series.forEach((serie, index) => {\n      if (!Array.isArray(serie.data)) {\n        errors.push(`Series ${index} data must be an array`);\n      } else if (serie.data.length !== data.xAxis.length) {\n        errors.push(`Series ${index} length (${serie.data.length}) doesn't match xAxis (${data.xAxis.length})`);\n      }\n    });\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n// =========================================================================\n// EXPORT ALL\n// =========================================================================\n\nexport default {\n  // Constants\n  ONE_DAY_MS,\n\n  // Theme\n  getThemeColors,\n  setupThemeObserver,\n\n  // Date\n  normalizeDate,\n  formatDate,\n  calculateDateRange,\n  getSortedColumns,\n\n  // Volume\n  buildVolumeLookup,\n  getVolumeForPekerjaan,\n\n  // Harga (Phase 2F.0)\n  buildHargaLookup,\n  getHargaForPekerjaan,\n\n  // Data\n  buildCellValueMap,\n  collectPekerjaanIds,\n\n  // Number\n  formatPercentage,\n  formatRupiah,\n  clamp,\n\n  // Resize\n  createResizeHandler,\n  setupResizeObserver,\n\n  // Validation\n  validateChartData,\n};\n","/**\n * Helpers to ensure Kurva S datasets always start from Week 0 (0% progress).\n */\n\n/**\n * Create zero-week metadata entry for cost datasets.\n * @returns {Object}\n */\nexport function createZeroWeekEntry() {\n  return {\n    week_number: 0,\n    week_start: null,\n    week_end: null,\n    cost: 0,\n    cumulative_cost: 0,\n    cumulative_percent: 0,\n    pekerjaan_breakdown: {},\n  };\n}\n\n/**\n * Prepend zero-week detail information for tooltips / metadata.\n * @param {Array|Object} details\n * @param {string} zeroLabel\n * @param {boolean} isCostView\n * @returns {Array|Object}\n */\nexport function prependZeroDetails(details, zeroLabel, isCostView) {\n  if (Array.isArray(details)) {\n    return [\n      {\n        label: zeroLabel,\n        planned: 0,\n        actual: 0,\n        variance: 0,\n        start: null,\n        end: null,\n        tooltip: zeroLabel,\n      },\n      ...details,\n    ];\n  }\n\n  if (isCostView && details && typeof details === 'object') {\n    const zeroWeek = createZeroWeekEntry();\n    return {\n      ...details,\n      weeks: Array.isArray(details.weeks) ? [zeroWeek, ...details.weeks] : details.weeks,\n      actualWeeks: Array.isArray(details.actualWeeks) ? [zeroWeek, ...details.actualWeeks] : details.actualWeeks,\n    };\n  }\n\n  return details;\n}\n\n/**\n * Ensure dataset starts with Week 0.\n * @param {Object} dataset\n * @returns {Object}\n */\nexport function ensureWeekZeroDataset(dataset) {\n  if (!dataset || !Array.isArray(dataset.labels) || dataset.labels.length === 0) {\n    return dataset;\n  }\n\n  const firstLabel = String(dataset.labels[0] || '').toLowerCase();\n  if (firstLabel.includes('week 0') || firstLabel === 'w0') {\n    return dataset;\n  }\n\n  const zeroLabel = dataset.viewMode === 'cost' ? 'W0' : 'Week 0';\n  const plannedSeries = Array.isArray(dataset.planned) ? dataset.planned : [];\n  const actualSeries = Array.isArray(dataset.actual) ? dataset.actual : [];\n\n  const updated = {\n    ...dataset,\n    labels: [zeroLabel, ...dataset.labels],\n    planned: [0, ...plannedSeries],\n    actual: [0, ...actualSeries],\n  };\n\n  if (Array.isArray(dataset.acSeries)) {\n    updated.acSeries = [0, ...dataset.acSeries];\n  }\n\n  updated.details = prependZeroDetails(dataset.details, zeroLabel, dataset.viewMode === 'cost');\n\n  return updated;\n}\n\nexport default {\n  ensureWeekZeroDataset,\n  prependZeroDetails,\n  createZeroWeekEntry,\n};\n","import {\n  getSortedColumns,\n  buildVolumeLookup,\n  buildHargaLookup,\n  collectPekerjaanIds,\n  getHargaForPekerjaan,\n  getVolumeForPekerjaan,\n  buildCellValueMap,\n  formatRupiah,\n  normalizeDate,\n} from '../shared/chart-utils.js';\nimport { ensureWeekZeroDataset } from './week-zero-helpers.js';\n\nconst LOG_PREFIX = '[KurvaSDataset]';\n\nexport function buildProgressDataset(state) {\n  const columns = getSortedColumns(state?.timeColumns);\n  if (!columns || columns.length === 0) {\n    console.warn(LOG_PREFIX, 'No time columns available');\n    return null;\n  }\n\n  const volumeLookup = buildVolumeLookup(state);\n  const hargaLookup = buildHargaLookup(state);\n  const stateManager = state?.stateManager;\n\n  let plannedCellValues;\n  let actualCellValues;\n  if (stateManager) {\n    plannedCellValues = stateManager.getAllCellsForMode('planned') || new Map();\n    actualCellValues = stateManager.getAllCellsForMode('actual') || new Map();\n  } else {\n    const plannedState = state?.plannedState || state;\n    const actualState = state?.actualState || state;\n    plannedCellValues = buildCellValueMap(plannedState);\n    actualCellValues = buildCellValueMap(actualState);\n  }\n\n  if (!plannedCellValues || !(plannedCellValues instanceof Map)) {\n    plannedCellValues = new Map();\n  }\n  if (!actualCellValues || !(actualCellValues instanceof Map)) {\n    actualCellValues = new Map();\n  }\n\n  const pekerjaanIds = new Set([\n    ...collectPekerjaanIds(state, plannedCellValues),\n    ...collectPekerjaanIds(state, actualCellValues),\n  ]);\n\n  let totalBiaya = parseFloat(state?.totalBiayaProject || 0);\n  if (!totalBiaya || totalBiaya <= 0) {\n    pekerjaanIds.forEach((id) => {\n      totalBiaya += getHargaForPekerjaan(hargaLookup, id, 0);\n    });\n  }\n  const useHargaCalculation = totalBiaya > 0 && hargaLookup.size > 0;\n\n  let totalVolume = 0;\n  if (!useHargaCalculation) {\n    pekerjaanIds.forEach((id) => {\n      totalVolume += getVolumeForPekerjaan(volumeLookup, id, 1);\n    });\n    if (!Number.isFinite(totalVolume) || totalVolume <= 0) {\n      totalVolume = pekerjaanIds.size || 1;\n    }\n  }\n\n  const columnIndexById = new Map();\n  columns.forEach((col, index) => {\n    columnIndexById.set(String(col.id), index);\n  });\n\n  const labels = generateLabels(columns);\n  const plannedSeries = calculatePlannedCurve(\n    columns,\n    volumeLookup,\n    hargaLookup,\n    plannedCellValues,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualColumnTotals = calculateColumnTotals(\n    columns,\n    actualCellValues,\n    volumeLookup,\n    hargaLookup,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualSeries = calculateActualCurve(\n    columns,\n    actualColumnTotals,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  const details = buildDetailData(\n    columns,\n    labels,\n    plannedSeries,\n    actualSeries,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    details,\n    totalVolume,\n    totalBiaya,\n    columnTotals: actualColumnTotals,\n    useHargaCalculation,\n    viewMode: 'progress',\n  });\n}\n\nexport function buildCostDataset(costData) {\n  if (!costData) {\n    console.error(LOG_PREFIX, 'No cost data available');\n    return null;\n  }\n\n  const weeklyData = costData.weeklyData || {};\n  const summary = costData.summary || {};\n  const evm = costData.evm;\n\n  if (evm && Array.isArray(evm.labels) && evm.labels.length > 0) {\n    const totalCost = evm.summary?.bac || summary?.total_project_cost || 0;\n    const weeklySummary = buildCostWeeklySummary(\n      weeklyData?.planned || [],\n      weeklyData?.actual || [],\n      totalCost,\n      evm.labels\n    );\n    const plannedSeries = evm.pv_percent || [];\n    const actualSeries = evm.ev_percent || [];\n    const acSeries = evm.ac_percent || actualSeries;\n    const varianceSeries = plannedSeries.map((value, index) =>\n      Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n    );\n    const varianceCostSeries = weeklySummary.map((entry) => entry.varianceCostValue || 0);\n    return ensureWeekZeroDataset({\n      labels: evm.labels,\n      planned: plannedSeries,\n      actual: actualSeries,\n      acSeries,\n      varianceSeries,\n      varianceCostSeries,\n      details: {\n        totalCost,\n        weeks: weeklyData?.planned || [],\n        actualWeeks: weeklyData?.actual || [],\n        weeklySummary,\n        evmSummary: evm.summary,\n        evm,\n      },\n      evm,\n      totalBiaya: totalCost,\n      useHargaCalculation: true,\n      viewMode: 'cost',\n    });\n  }\n\n  const labels = (weeklyData.planned || []).map((w) => `W${w.week_number}`);\n  const plannedSeries = (weeklyData.planned || []).map((w) => w.cumulative_percent);\n  const actualSeries = (weeklyData.actual || []).map((w) => w.cumulative_percent);\n  const acSeries = actualSeries.length\n    ? actualSeries\n    : (weeklyData.earned || []).map((w) => w.cumulative_percent);\n  const varianceSeries = plannedSeries.map((value, index) =>\n    Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n  );\n\n  const details = {\n    totalCost: summary?.total_project_cost || 0,\n    plannedCost: summary?.planned_cost || 0,\n    actualCost: summary?.actual_cost || 0,\n    weeks: weeklyData.planned || [],\n    actualWeeks: weeklyData.actual || [],\n    viewMode: 'cost',\n  };\n  const weeklySummary = buildCostWeeklySummary(\n    weeklyData.planned || [],\n    weeklyData.actual || [],\n    details.totalCost,\n    labels\n  );\n\n  console.log(LOG_PREFIX, 'Cost dataset built:', {\n    labels: labels.length,\n    plannedPoints: plannedSeries.length,\n    actualPoints: actualSeries.length,\n    totalCost: formatRupiah(details.totalCost),\n  });\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    acSeries,\n    varianceSeries,\n    varianceCostSeries: weeklySummary.map((entry) => entry.varianceCostValue || 0),\n    details: {\n      ...details,\n      weeklySummary,\n    },\n    totalBiaya: details.totalCost,\n    useHargaCalculation: true,\n    viewMode: 'cost',\n  });\n}\n\nfunction generateLabels(columns) {\n  return columns.map((col, index) => {\n    const label =\n      col?.label ||\n      col?.displayLabel ||\n      col?.display_name ||\n      col?.name ||\n      `Week ${index + 1}`;\n\n    if (col?.start_date && col?.end_date) {\n      return `${label} (${col.start_date} - ${col.end_date})`;\n    }\n\n    return label;\n  });\n}\n\nfunction calculatePlannedCurve(\n  columns,\n  volumeLookup,\n  hargaLookup,\n  cellValues,\n  totalValue,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const plannedTotals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    if (!columnIndexById.has(columnId)) {\n      return;\n    }\n\n    const columnIndex = columnIndexById.get(columnId);\n    if (columnIndex === undefined) {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    }\n  });\n\n  let cumulative = 0;\n  return plannedTotals.map((value) => {\n    cumulative += value;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction calculateColumnTotals(\n  columns,\n  cellValues,\n  volumeLookup,\n  hargaLookup,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const totals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    const columnIndex = columnIndexById.get(columnId);\n    if (typeof columnIndex === 'undefined') {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    }\n  });\n\n  return totals;\n}\n\nfunction calculateActualCurve(columns, columnTotals, totalValue, useHargaCalculation) {\n  let cumulative = 0;\n  return columns.map((_, index) => {\n    cumulative += columnTotals[index] || 0;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction buildDetailData(\n  columns,\n  labels,\n  plannedSeries,\n  actualSeries,\n  totalValue = 0,\n  useHargaCalculation = false\n) {\n  return columns.map((column, index) => {\n    const label = labels[index] || `Week ${index + 1}`;\n    const planned = plannedSeries[index] || 0;\n    const actual = actualSeries[index] || 0;\n    const variance = Number((actual - planned).toFixed(2));\n    let plannedCostValue = null;\n    let actualCostValue = null;\n    let varianceCostValue = null;\n    if (useHargaCalculation) {\n      plannedCostValue = Number(((planned / 100) * (totalValue || 0)).toFixed(2));\n      actualCostValue = Number(((actual / 100) * (totalValue || 0)).toFixed(2));\n      varianceCostValue = Number(((actualCostValue - plannedCostValue)).toFixed(2));\n    }\n\n    return {\n      label,\n      planned,\n      actual,\n      variance,\n      start: normalizeDate(column?.startDate || column?.start_date || column?.start),\n      end: normalizeDate(column?.endDate || column?.end_date || column?.end),\n      metadata: column,\n      plannedCostValue,\n      actualCostValue,\n      varianceCostValue,\n    };\n  });\n}\n\nfunction buildCostWeeklySummary(plannedWeeks = [], actualWeeks = [], totalCost = 0, labels = []) {\n  const maxLength = Math.max(plannedWeeks.length, actualWeeks.length, labels.length);\n  const summary = [];\n  for (let index = 0; index < maxLength; index += 1) {\n    const plannedEntry = plannedWeeks[index] || {};\n    const actualEntry = actualWeeks[index] || {};\n    const label =\n      labels[index] ||\n      plannedEntry.label ||\n      actualEntry.label ||\n      `W${plannedEntry.week_number || actualEntry.week_number || index + 1}`;\n    const plannedPercent = Number(\n      plannedEntry.cumulative_percent ??\n        plannedEntry.percent ??\n        plannedEntry.value ??\n        plannedEntry.cumulative ??\n        0\n    );\n    const actualPercent = Number(\n      actualEntry.cumulative_percent ??\n        actualEntry.percent ??\n        actualEntry.value ??\n        actualEntry.cumulative ??\n        0\n    );\n    const plannedCostValue = resolveCostValue(plannedEntry, plannedPercent, totalCost);\n    const actualCostValue = resolveCostValue(actualEntry, actualPercent, totalCost);\n    const variancePercent = Number(((actualPercent - plannedPercent)).toFixed(2));\n    const varianceCostValue = Number((actualCostValue - plannedCostValue).toFixed(2));\n\n    summary.push({\n      label,\n      weekNumber: plannedEntry.week_number ?? actualEntry.week_number ?? index + 1,\n      plannedPercent: Number.isFinite(plannedPercent) ? plannedPercent : 0,\n      actualPercent: Number.isFinite(actualPercent) ? actualPercent : 0,\n      plannedCostValue,\n      actualCostValue,\n      variancePercent,\n      varianceCostValue,\n      range: {\n        start: normalizeDate(\n          plannedEntry.week_start ||\n            plannedEntry.start_date ||\n            actualEntry.week_start ||\n            actualEntry.start_date\n        ),\n        end: normalizeDate(\n          plannedEntry.week_end || plannedEntry.end_date || actualEntry.week_end || actualEntry.end_date\n        ),\n      },\n    });\n  }\n  return summary;\n}\n\nfunction resolveCostValue(weekEntry, percent, totalCost) {\n  const numericPercent = Number(\n    percent ??\n      weekEntry?.cumulative_percent ??\n      weekEntry?.percent ??\n      weekEntry?.value ??\n      0\n  );\n  const cumulative = toNumber(\n    weekEntry?.cumulative_cost ??\n      weekEntry?.cumulative ??\n      weekEntry?.accumulated_cost ??\n      weekEntry?.acc_cost\n  );\n  if (Number.isFinite(cumulative) && cumulative > 0) {\n    return cumulative;\n  }\n  const singleCost = toNumber(weekEntry?.cost);\n  if (Number.isFinite(singleCost) && singleCost > 0 && !weekEntry?.cumulative_cost) {\n    return singleCost;\n  }\n  if (!Number.isFinite(totalCost) || totalCost <= 0) {\n    return 0;\n  }\n  return Number((((numericPercent || 0) / 100) * totalCost).toFixed(2));\n}\n\nfunction toNumber(value) {\n  if (typeof value === 'number') {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Number(value);\n    return Number.isFinite(parsed) ? parsed : NaN;\n  }\n  return NaN;\n}\n","import uPlot from 'uplot';\nimport 'uplot/dist/uPlot.min.css';\n\nimport {\n  getThemeColors,\n  setupThemeObserver,\n  createResizeHandler,\n  setupResizeObserver,\n  formatPercentage,\n  formatRupiah,\n} from '../shared/chart-utils.js';\nimport { buildProgressDataset, buildCostDataset } from './dataset-builder.js';\n\nconst LOG_PREFIX = '[KurvaSUPlot]';\nconst DEFAULT_OPTIONS = {\n  height: 520,\n  enableCostView: true,\n};\n\nexport class KurvaSUPlotChart {\n  constructor(state, options = {}) {\n    this.state = state;\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n    this.viewMode = 'progress';\n    this.chartInstance = null;\n    this.container = null;\n    this.tooltipEl = null;\n    this.resizeHandler = null;\n    this.resizeObserver = null;\n    this.themeObserver = null;\n    this.currentDataset = null;\n    this.costData = null;\n    this.isLoadingCostData = false;\n\n    // Interaction helpers\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n    this._scaleBounds = null;\n    this._dateFormatter = null;\n  }\n\n  initialize(container) {\n    if (!container) {\n      console.error(LOG_PREFIX, 'Container element is required');\n      return false;\n    }\n\n    this.container = container;\n    if (getComputedStyle(container).position === 'static') {\n      this.container.style.position = 'relative';\n    }\n\n    this._createTooltip();\n\n    this.themeObserver = setupThemeObserver(() => this._rebuild());\n    this.resizeHandler = createResizeHandler(() => this.resize());\n    window.addEventListener('resize', this.resizeHandler);\n    this.resizeObserver = setupResizeObserver(container, () => this.resize());\n\n    const success = this.update();\n    if (!success) {\n      console.warn(LOG_PREFIX, 'Unable to render Kurva-S chart (no dataset)');\n    }\n    return true;\n  }\n\n  update(dataset) {\n    const resolvedDataset = dataset || buildProgressDataset(this.state);\n    if (!resolvedDataset) {\n      return false;\n    }\n    this.currentDataset = resolvedDataset;\n    this.viewMode = resolvedDataset.viewMode || this.viewMode || 'progress';\n\n    const transformedData = this._transformDataset(resolvedDataset);\n    const colors = getThemeColors();\n\n    if (!this.chartInstance) {\n      const options = this._buildChartOptions(resolvedDataset, colors);\n      this.chartInstance = new uPlot(options, transformedData, this.container);\n      this._updateScaleBounds();\n      this._attachInteractions();\n    } else {\n      this.chartInstance.setData(transformedData);\n      this._updateScaleBounds();\n    }\n\n    this._updateTooltipPosition();\n    return true;\n  }\n\n  resize() {\n    if (!this.chartInstance || !this.container) {\n      return;\n    }\n    this.chartInstance.setSize({\n      width: this.container.clientWidth || 800,\n      height: this.options.height,\n    });\n  }\n\n  async toggleView(mode) {\n    const nextMode = (mode || (this.viewMode === 'progress' ? 'cost' : 'progress')).toLowerCase();\n    if (nextMode === this.viewMode) {\n      return true;\n    }\n\n    if (nextMode === 'cost') {\n      if (!this.options.enableCostView) {\n        console.warn(LOG_PREFIX, 'Cost view disabled on uPlot chart');\n        return false;\n      }\n      if (!this.costData) {\n        const data = await this.fetchCostData();\n        if (!data) {\n          return false;\n        }\n      }\n      const costDataset = buildCostDataset(this.costData);\n      if (!costDataset) {\n        console.warn(LOG_PREFIX, 'Cost dataset not available');\n        return false;\n      }\n      this.viewMode = 'cost';\n      this.update(costDataset);\n      return true;\n    }\n\n    this.viewMode = 'progress';\n    this.update();\n    return true;\n  }\n\n  dispose() {\n    this._detachInteractions();\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    if (this.resizeHandler) {\n      window.removeEventListener('resize', this.resizeHandler);\n      this.resizeHandler = null;\n    }\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n    if (this.themeObserver) {\n      this.themeObserver.disconnect();\n      this.themeObserver = null;\n    }\n    if (this.tooltipEl) {\n      this.tooltipEl.remove();\n      this.tooltipEl = null;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal helpers\n  // ---------------------------------------------------------------------------\n\n  _rebuild() {\n    if (!this.container) {\n      return;\n    }\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    this.update(this.currentDataset);\n  }\n\n  async fetchCostData() {\n    if (!this.options.enableCostView) {\n      console.log(LOG_PREFIX, 'Cost view disabled');\n      return null;\n    }\n\n    const projectId = this.state?.projectId;\n    if (!projectId) {\n      console.warn(LOG_PREFIX, 'Cannot load cost data without project ID');\n      return null;\n    }\n\n    if (this.isLoadingCostData) {\n      return null;\n    }\n\n    try {\n      this.isLoadingCostData = true;\n      const url = `/detail_project/api/v2/project/${projectId}/kurva-s-harga/`;\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      const data = await response.json();\n      if (data?.error) {\n        throw new Error(data.error);\n      }\n      this.costData = data;\n      console.log(LOG_PREFIX, 'Cost data loaded for uPlot chart');\n      return data;\n    } catch (error) {\n      console.error(LOG_PREFIX, 'Failed to load cost data:', error);\n      return null;\n    } finally {\n      this.isLoadingCostData = false;\n    }\n  }\n\n  _transformDataset(dataset) {\n    const xValues = dataset.labels.map((_, idx) => idx);\n    const planned = dataset.planned.map((value) => Number(value) || 0);\n\n    if (dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries)) {\n      const actualCost = dataset.acSeries.map((value) => Number(value) || 0);\n      return [xValues, planned, actualCost];\n    }\n\n    const actual = dataset.actual.map((value) => Number(value) || 0);\n    return [xValues, planned, actual];\n  }\n\n  _buildChartOptions(dataset, colors) {\n    const isCostView = dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries);\n    return {\n      width: this.container?.clientWidth || 800,\n      height: this.options.height,\n      scales: {\n        x: { time: false },\n        y: { auto: true },\n      },\n      axes: [\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          values: (u, vals) =>\n            vals.map((v) => {\n              if (!Number.isFinite(v)) {\n                return '';\n              }\n              const nearestIndex = Math.round(v);\n              if (Math.abs(v - nearestIndex) > 0.01) {\n                return '';\n              }\n              if (nearestIndex < 0 || nearestIndex >= dataset.labels.length) {\n                return '';\n              }\n              return dataset.labels[nearestIndex] || `Week ${nearestIndex + 1}`;\n            }),\n        },\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          label: isCostView ? '% of Total Cost' : 'Progress %',\n          values: (u, vals) => vals.map((v) => `${Math.round(v)}%`),\n        },\n      ],\n      legend: {\n        show: true,\n      },\n      series: [\n        {},\n        {\n          label: isCostView ? 'Rencana (PV)' : 'Rencana',\n          stroke: colors.plannedLine,\n          width: 2,\n          fill: colors.plannedArea,\n        },\n        isCostView\n          ? {\n              label: 'Realisasi (AC)',\n              stroke: colors.costActualLine || colors.actualLine,\n              width: 3,\n              fill: colors.costActualArea || colors.actualArea,\n            }\n          : {\n              label: 'Realisasi',\n              stroke: colors.actualLine,\n              width: 2,\n              fill: colors.actualArea,\n            },\n      ],\n      cursor: {\n        drag: { x: true, y: false },\n        focus: { prox: 32 },\n      },\n      select: {\n        show: true,\n      },\n      hooks: {\n        ready: [\n          () => {\n            this._updateScaleBounds();\n            this._attachInteractions();\n          },\n        ],\n        setCursor: [\n          (u) => this._updateTooltip(u),\n        ],\n        setScale: [\n          () => this._updateTooltipPosition(),\n        ],\n        dblclick: [\n          (u) => {\n            const first = u.data[0][0];\n            const last = u.data[0][u.data[0].length - 1];\n            u.setScale('x', { min: first, max: last });\n          },\n        ],\n      },\n    };\n  }\n\n  _attachInteractions() {\n    if (this._interactionAttached || !this.chartInstance) {\n      return;\n    }\n    const target = this.chartInstance.over || this.container;\n    if (!target) {\n      return;\n    }\n    this._interactionTarget = target;\n    this._wheelHandler = (event) => this._handleWheelInteraction(event);\n    target.addEventListener('wheel', this._wheelHandler, { passive: false });\n    this._interactionAttached = true;\n  }\n\n  _detachInteractions() {\n    if (this._interactionAttached && this._interactionTarget && this._wheelHandler) {\n      this._interactionTarget.removeEventListener('wheel', this._wheelHandler);\n    }\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n  }\n\n  _handleWheelInteraction(event) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const isZoomGesture = event.ctrlKey || event.metaKey;\n    const isPanGesture = !isZoomGesture && event.shiftKey;\n    if (!isZoomGesture && !isPanGesture) {\n      return;\n    }\n\n    event.preventDefault();\n\n    const bounds = this._scaleBounds;\n    const scale = this.chartInstance.scales?.x || {};\n    const currentMin = Number.isFinite(scale.min) ? scale.min : bounds.min;\n    const currentMax = Number.isFinite(scale.max) ? scale.max : bounds.max;\n\n    if (isZoomGesture) {\n      const zoomIntensity = 0.12;\n      const direction = event.deltaY > 0 ? 1 : -1;\n      const factor = Math.max(0.2, 1 + zoomIntensity * direction);\n\n      const overRect = (this.chartInstance.over || this.container).getBoundingClientRect();\n      const cursorX = event.clientX - overRect.left;\n      const cursorVal = this.chartInstance.posToVal(cursorX, 'x');\n      const resolvedCursor = Number.isFinite(cursorVal) ? cursorVal : (currentMin + currentMax) / 2;\n\n      const newMin = resolvedCursor - (resolvedCursor - currentMin) * factor;\n      const newMax = resolvedCursor + (currentMax - resolvedCursor) * factor;\n      this._setScaleBounded(newMin, newMax);\n      return;\n    }\n\n    const range = currentMax - currentMin;\n    const panStep = Math.max(1, range * 0.15);\n    const delta = event.deltaY > 0 ? panStep : -panStep;\n    this._setScaleBounded(currentMin + delta, currentMax + delta);\n  }\n\n  _setScaleBounded(targetMin, targetMax) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const bounds = this._scaleBounds;\n    const boundsSpan = bounds.max - bounds.min;\n    if (boundsSpan <= 0) {\n      return;\n    }\n\n    const minWindow = 1;\n    let minVal = Math.min(targetMin, targetMax);\n    let maxVal = Math.max(targetMin, targetMax);\n    let windowSize = Math.max(minWindow, maxVal - minVal);\n\n    if (windowSize > boundsSpan) {\n      windowSize = boundsSpan;\n    }\n\n    minVal = Math.max(bounds.min, Math.min(minVal, bounds.max - windowSize));\n    maxVal = minVal + windowSize;\n    if (maxVal > bounds.max) {\n      maxVal = bounds.max;\n      minVal = maxVal - windowSize;\n    }\n\n    this.chartInstance.setScale('x', { min: minVal, max: maxVal });\n  }\n\n  _updateScaleBounds() {\n    if (!this.chartInstance || !Array.isArray(this.chartInstance.data?.[0])) {\n      return;\n    }\n    const xValues = this.chartInstance.data[0];\n    if (!xValues.length) {\n      return;\n    }\n    this._scaleBounds = {\n      min: xValues[0],\n      max: xValues[xValues.length - 1],\n    };\n  }\n\n  _createTooltip() {\n    const tooltip = document.createElement('div');\n    tooltip.className = 'kurva-s-tooltip';\n    tooltip.style.position = 'absolute';\n    tooltip.style.pointerEvents = 'none';\n    tooltip.style.padding = '8px 10px';\n    tooltip.style.borderRadius = '6px';\n    tooltip.style.background = 'rgba(15, 23, 42, 0.85)';\n    tooltip.style.color = '#fff';\n    tooltip.style.fontSize = '12px';\n    tooltip.style.transform = 'translate(-50%, -100%)';\n    tooltip.style.opacity = '0';\n    tooltip.style.transition = 'opacity 0.15s ease';\n\n    this.tooltipEl = tooltip;\n    this.container.appendChild(tooltip);\n  }\n\n  _updateTooltip(u) {\n    if (!this.tooltipEl || !this.currentDataset) {\n      return;\n    }\n\n    const idx = u.cursor.idx;\n    if (idx == null || idx < 0 || idx >= this.currentDataset.labels.length) {\n      this.tooltipEl.style.opacity = '0';\n      return;\n    }\n\n    const labels = this.currentDataset.labels || [];\n    const label = labels[idx] || `Week ${idx + 1}`;\n    const planned = this.currentDataset.planned[idx] ?? 0;\n    const detailArray = Array.isArray(this.currentDataset.details) ? this.currentDataset.details : null;\n    const detailObject = !detailArray && this.currentDataset.details ? this.currentDataset.details : {};\n    const totalCost = Number(detailObject.totalCost || this.currentDataset.totalBiaya || 0) || 0;\n    const weeklyCostSummary = Array.isArray(detailObject.weeklySummary) ? detailObject.weeklySummary : null;\n    const summaryEntry = weeklyCostSummary ? weeklyCostSummary[idx] : null;\n    const isCostView = (this.viewMode || this.currentDataset.viewMode) === 'cost';\n\n    const htmlParts = [\n      `<div style=\"font-weight:600;margin-bottom:4px;\">${label}</div>`,\n    ];\n\n    if (isCostView) {\n      const acSeries = Array.isArray(this.currentDataset.acSeries)\n        ? this.currentDataset.acSeries\n        : this.currentDataset.actual || [];\n      const actual = acSeries[idx] ?? 0;\n      const variance = summaryEntry?.variancePercent ?? Number((actual - planned).toFixed(2));\n      const plannedWeek = Array.isArray(detailObject.weeks) ? detailObject.weeks[idx] : null;\n      const actualWeek = Array.isArray(detailObject.actualWeeks) ? detailObject.actualWeeks[idx] : null;\n      const rangeText = this._formatWeekRange(plannedWeek, actualWeek);\n      const plannedAmount =\n        typeof summaryEntry?.plannedCostValue === 'number'\n          ? formatRupiah(summaryEntry.plannedCostValue)\n          : this._resolveCostAmount(plannedWeek, planned, totalCost);\n      const actualAmount =\n        typeof summaryEntry?.actualCostValue === 'number'\n          ? formatRupiah(summaryEntry.actualCostValue)\n          : this._resolveCostAmount(actualWeek, actual, totalCost);\n      const varianceAmount =\n        typeof summaryEntry?.varianceCostValue === 'number'\n          ? formatRupiah(summaryEntry.varianceCostValue)\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n      htmlParts.push(\n        `<div>Rencana (PV): <strong>${formatPercentage(planned)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span></div>`,\n        `<div>Realisasi (AC): <strong>${formatPercentage(actual)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span></div>`,\n        `<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${varianceAmount ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`,\n      );\n    } else {\n      const actual = this.currentDataset.actual[idx] ?? 0;\n      const variance = Number((actual - planned).toFixed(2));\n      const detail = detailArray ? detailArray[idx] : null;\n      const startLabel = detail?.start ? this._formatDateLabel(detail.start) : '';\n      const endLabel = detail?.end ? this._formatDateLabel(detail.end) : '';\n      const rangeText = this._composeRangeText(startLabel, endLabel);\n      const useHarga = Boolean(this.currentDataset.useHargaCalculation && totalCost > 0);\n      const plannedAmountValue =\n        typeof detail?.plannedCostValue === 'number' ? detail.plannedCostValue : (totalCost * planned) / 100;\n      const actualAmountValue =\n        typeof detail?.actualCostValue === 'number' ? detail.actualCostValue : (totalCost * actual) / 100;\n      const plannedAmount = useHarga ? formatRupiah(plannedAmountValue || 0) : '';\n      const actualAmount = useHarga ? formatRupiah(actualAmountValue || 0) : '';\n      const varianceAmount =\n        useHarga && typeof detail?.varianceCostValue === 'number'\n          ? formatRupiah(detail.varianceCostValue)\n          : useHarga\n          ? formatRupiah((actualAmountValue || 0) - (plannedAmountValue || 0))\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n\n      htmlParts.push(`<div>Rencana: <strong>${formatPercentage(planned)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Realisasi: <strong>${formatPercentage(actual)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${useHarga ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`);\n    }\n\n    this.tooltipEl.innerHTML = htmlParts.join('');\n\n    const xValue = u.data[0][idx];\n    const left = u.valToPos(xValue, 'x');\n    const seriesIndex = Math.min(2, u.data.length - 1);\n    let seriesValue = u.data[seriesIndex]?.[idx];\n    if (!Number.isFinite(seriesValue)) {\n      seriesValue = u.data[1]?.[idx] ?? 0;\n    }\n    const top = u.valToPos(seriesValue, 'y');\n    this.tooltipEl.style.left = `${left}px`;\n    this.tooltipEl.style.top = `${top}px`;\n    this.tooltipEl.style.opacity = '1';\n  }\n\n  _updateTooltipPosition() {\n    if (!this.chartInstance || !this.tooltipEl) {\n      return;\n    }\n    const { idx } = this.chartInstance.cursor;\n    if (idx != null) {\n      this._updateTooltip(this.chartInstance);\n    }\n  }\n\n  _formatDateLabel(input) {\n    if (!input) {\n      return '';\n    }\n    let date = input;\n    if (!(input instanceof Date)) {\n      date = new Date(input);\n    }\n    if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n      return '';\n    }\n    if (!this._dateFormatter && typeof Intl !== 'undefined' && typeof Intl.DateTimeFormat === 'function') {\n      try {\n        this._dateFormatter = new Intl.DateTimeFormat('id-ID', {\n          day: '2-digit',\n          month: 'short',\n          year: 'numeric',\n        });\n      } catch (error) {\n        console.warn(LOG_PREFIX, 'Intl.DateTimeFormat unavailable, falling back to basic formatter:', error);\n        this._dateFormatter = null;\n      }\n    }\n    if (this._dateFormatter) {\n      return this._dateFormatter.format(date);\n    }\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n    return `${day}/${month}/${year}`;\n  }\n\n  _formatWeekRange(plannedWeek, actualWeek) {\n    const startRaw = plannedWeek?.week_start || actualWeek?.week_start;\n    const endRaw = plannedWeek?.week_end || actualWeek?.week_end;\n    const startLabel = startRaw ? this._formatDateLabel(new Date(startRaw)) : '';\n    const endLabel = endRaw ? this._formatDateLabel(new Date(endRaw)) : '';\n    return this._composeRangeText(startLabel, endLabel);\n  }\n\n  _composeRangeText(startLabel, endLabel) {\n    if (startLabel && endLabel) {\n      return `${startLabel} - ${endLabel}`;\n    }\n    return startLabel || endLabel || '';\n  }\n\n  _getVarianceColor(value) {\n    if (value > 0.1) {\n      return '#f87171';\n    }\n    if (value < -0.1) {\n      return '#22c55e';\n    }\n    return '#cbd5e1';\n  }\n\n  _resolveCostAmount(weekEntry, percent, totalCost) {\n    if (weekEntry) {\n      const cumulative = this._parseNumber(weekEntry.cumulative_cost);\n      if (Number.isFinite(cumulative) && cumulative > 0) {\n        return formatRupiah(cumulative);\n      }\n      const singleCost = this._parseNumber(weekEntry.cost);\n      if (Number.isFinite(singleCost) && singleCost > 0) {\n        return formatRupiah(singleCost);\n      }\n    }\n\n    if (!Number.isFinite(totalCost) || totalCost <= 0) {\n      return formatRupiah(0);\n    }\n    return formatRupiah((totalCost * percent) / 100);\n  }\n\n  _parseNumber(value) {\n    if (typeof value === 'number') {\n      return value;\n    }\n    if (typeof value === 'string') {\n      const parsed = Number(value);\n      return Number.isFinite(parsed) ? parsed : NaN;\n    }\n    return NaN;\n  }\n}\n\nexport default KurvaSUPlotChart;\n"],"names":["KeyboardShortcuts","constructor","this","shortcuts","Map","enabled","_boundHandler","_handleKeyDown","bind","init","document","addEventListener","console","log","register","key","callback","options","description","preventDefault","set","toLowerCase","unregister","delete","event","activeElement","isInput","tagName","isContentEditable","parts","ctrlKey","push","altKey","shiftKey","metaKey","includes","combo","join","shortcut","get","enable","disable","getShortcuts","Array","from","entries","map","data","destroy","removeEventListener","clear","RippleEffect","add","element","classList","e","ripple","createElement","rect","getBoundingClientRect","size","Math","max","width","height","x","clientX","left","y","clientY","top","style","appendChild","setTimeout","remove","addToAll","selector","querySelectorAll","forEach","el","ButtonStateManager","setLoading","button","loadingText","dataset","originalText","innerHTML","disabled","setSuccess","duration","setError","reset","markChanges","hasChanges","setAttribute","removeAttribute","Toast","success","message","_a","_b","window","DP","core","toast","show","error","warning","warn","info","initializeUXEnhancements","btn","hasAttribute","getAttribute","OFF","pre","LEGEND_LABEL","WIDTH","HEIGHT","TOP","BOTTOM","LEFT","RIGHT","hexBlack","transparent","mousemove","mousedown","mouseup","mouseenter","mouseleave","dblclick","change","dppxchange","LEGEND_DISP","domEnv","doc","win","nav","navigator","pxRatio","query","addClass","c","cl","contains","remClass","setStylePx","name","value","placeTag","tag","cls","targ","refEl","insertBefore","placeDiv","xformCache","WeakMap","elTrans","xPos","yPos","xMax","yMax","xform","transform","colorCache","elColor","background","borderColor","newColor","sizeCache","elSize","newWid","newHgt","centered","newSize","marginLeft","marginTop","evOpts","passive","evOpts2","__spreadProps","__spreadValues","capture","on","ev","cb","capt","off","closestIdx","num","arr","lo","hi","mid","bitwise","length","floor","makeIndexOfs","predicate","_i0","_i1","i0","i1","i","setPxRatio","_pxRatio","devicePixelRatio","matchMedia","dispatchEvent","CustomEvent","notNullish","v","isPositive","nonNullIdxs","positiveIdxs","rangeLog","min","base","fullMags","minSign","sign","maxSign","logFn","log10","log2","growMaxAbs","ceil","minExp","abs","maxExp","minIncr","pow","maxIncr","roundDec","incrRoundDn","incrRoundUp","rangeAsinh","minMax","autoRangePart","mode","pad","_eqRangePart","soft","_eqRange","rangeNum","_min","_max","mult","extra","isObj","_rangeNum","ifNull","lh","rh","cfg","cmin","cmax","padMin","padMax","hardMin","hard","inf","hardMax","softMin","softMax","softMinMode","softMaxMode","delta","deltaMag","scalarMax","scalarMag","scalarMagDelta","nonZeroDelta","mag","_newMin","_softMin","minLim","_newMax","_softMax","maxLim","numFormatter","Intl","NumberFormat","language","fmtNum","val","format","M","PI","round","asinh","linthresh","Infinity","numIntDigits","clamp","isFn","fnOrSelf","retArg0","_0","retArg1","_1","retNull","_","retTrue","retEq","a","b","regex6","fixFloat","isInt","fixedDec","has","str","match","len","indexOf","exp","split","incrRound","incr","dec","p","__pow","n","Number","EPSILON","guessDec","genIncrs","mults","incrs","multDec","expa","_incr","EMPTY_OBJ","EMPTY_ARR","nullNullTuple","isArr","isArray","isInteger","isStr","is","Object","fastIsObj","TypedArray","getPrototypeOf","Uint8Array","__proto__","copy","o","_isObj","out","find","slice","k","assign","args","arguments","src","nullExpand","yVals","nullIdxs","alignedLen","xi","lastNullIdx","nullIdx","microTask","queueMicrotask","fn","Promise","resolve","then","months","days","slice3","days3","months3","engNames","MMMM","MMM","WWWW","WWW","zeroPad2","int","subs","YYYY","d","getFullYear","YY","names","getMonth","MM","DD","getDate","D","getDay","HH","getHours","H","h","AA","aa","mm","getMinutes","m","ss","getSeconds","s","fff","zeroPad3","getMilliseconds","fmtDate","tpl","R","exec","localTz","DateTimeFormat","resolvedOptions","timeZone","onlyWhole","allMults","decIncrs","oneIncrs","wholeIncrs","filter","numIncrs","concat","yyyy","NLyyyy","md","NLmd","NLmdyy","hmmaa","NLhmmaa","genTimeStuffs","ms","mo","tzDate","self","axisIdx","scaleMin","scaleMax","foundIncr","foundSpace","splits","isYr","isMo","minDate","minDateTs","minMin","mkDate","minMinTs","moIncr","yrIncr","splitDate","Date","baseYear","baseMonth","next","offs","incr0","date0","prevHour","incrHours","pctSpace","axes","_space","expectedHour","dstShift","timeIncrsMs","_timeAxisStampsMs","timeAxisSplitsMs","timeIncrsS","_timeAxisStampsS","timeAxisSplitsS","timeAxisStamps","stampCfg","timeAxisVals","stamps","prevYear","prevMnth","prevDate","prevMins","prevSecs","date","newYear","newMnth","newDate","newHour","newMins","newSecs","stamp","timeSeriesStamp","timeSeriesVal","seriesIdx","dataIdx","legendOpts","live","isolate","mount","markers","stroke","series","points","fill","dash","idx","idxs","values","moveTuple","filtBtn0","handle","onlyTarg","target","filtTarg","cursorOpts","lock","move","mouseLeft1","mouseTop1","one","si","cursor","pt","mar","sp","_stroke","_fill","click","drag","setScale","dist","uni","stopPropagation","stopImmediatePropagation","_x","_y","focus","valPos","curPos","prox","bias","hover","skip","axisLines","grid","ticks","border","font","labelFont","xAxisOpts","scale","space","gap","alignTo","labelGap","labelSize","side","lineGap","rotate","xSeriesOpts","auto","sorted","numAxisVals","numAxisSplits","forceMin","numDec","logAxisSplits","logBase","scales","nextMagIncr","asinhAxisSplits","posSplits","zero","reverse","RE_ALL","RE_12357","RE_125","RE_1","_filt","distr","re","keepMod","test","toExponential","log10AxisValsFilt","axis","scaleKey","sc","valToPos","minSpace","_10","magSpace","log2AxisValsFilt","numSeriesVal","yAxisOpts","facet","gaps","idx0","idx1","nullGaps","xySeriesOpts","alpha","facets","ySeriesOpts","spanGaps","xData","_data","p0","p1","maxPts","path","clip","clampScale","xScaleOpts","time","dir","ori","yScaleOpts","syncs","_sync","opts","plots","sub","plot","unsub","pub","type","w","j","orient","u","bbox","dx","dy","sx","sy","l","t","valToPosH","V","valToPosV","moveToH","lineToH","rectH","arcH","bezierCurveToH","moveToV","lineToV","rectV","arcV","bezierCurveToV","bandFillClipDirs","fillDir","clipDirs","bands","seriesFillTo","dataMin","dataMax","bandFillDir","clipBandLine","strokePath","clipDir","dataX","dataY","scaleX","scaleY","valToPosX","valToPosY","xOff","yOff","xDim","yDim","pxRound","lineTo","frIdx","toIdx","x0","y0","x1","yLimit","Path2D","clipGaps","plotLft","plotTop","plotWid","plotHgt","prevGapEnd","g","maxStrokeWidth","findGaps","xs","ys","pixelForX","align","fr","to","frPx","toPx","fri2","toi2","pxRoundGen","pxAlign","moveTo","arcTo","y1","x2","y2","r","endRad","baseRad","closePath","startAngle","endAngle","arc","bp1x","bp1y","bp2x","bp2y","p2x","p2y","bezierCurveTo","filtIdxs","rad","dia","lft","wid","hgt","drawPoint","pi","flags","BAND_CLIP_FILL","_drawAcc","accX","minY","maxY","inY","outY","drawAccH","drawAccV","linear","alignGaps","drawAcc","pixelForY","_paths","band","hasGap","drawnAtX","xForPixel","pos","posToVal","idx0px","idx1px","nextAccXVal","xVal","yVal","bandClipDir","fillToY","fillTo","frX","toX","findColWidth","colWid","prevIdx","minDelta","_monotoneCubic","ds","dys","dxs","isFinite","cursorPlots","Set","invalidateRects","syncRect","uPlot","linearPath","pointsPath","setDefaults","xo","yo","initY","setDefault","snapNumX","snapTimeX","snapNumY","snapLogY","snapLogX","snapAsinhY","snapAsinhX","pxRatioFont","fontSize","fontSizeCss","replace","syncFontSize","f","getHPos","dim","pct","valToPct","getVPos","getPos","ready","status","root","id","class","title","textContent","can","ctx","getContext","wrap","over","mouseLeft0","mouseTop0","under","plugins","xyo","xScaleKey","drawOrderMap","_show","fillStyle","shiftDir","_found","label","shiftAmt","baseLpos","_lpos","setFontStyle","save","translate","_label","fillText","restore","plotDim","plotOff","_splits","data0","_tickSize","tickSize","axisGap","_size","angle","_rotate","basePos","_pos","finalPos","lineHeight","canOffs","_values","_parts","text","drawOrthoLines","cap","fire","dataLen","shouldAlpha","some","_focus","ctxAlpha","globalAlpha","cacheStrokeFill","_ctxAlpha","_idxs","ydata","getOuterIdxs","paths","drawPath","_gaps","drawOrder","initValToPct","getVal","fwd","_val","initScale","scaleOpts","isTime","rn","range","rangeIsArr","xScaleDistr","pendScales","_tzDate","ts","_fmtDate","_timeAxisSplits","_timeAxisVals","_timeSeriesVal","activeIdxs","legend","showLegend","showCursor","legendTable","legendHead","legendBody","legendCols","legendRows","legendCells","multiValLegend","NULL_LEGEND_VALUES","getMultiVals","head","son","soff","mouseListeners","onMouse","targListeners","listener","offMouse","fullWidCss","fullHgtCss","plotWidCss","plotHgtCss","plotLftCss","plotTopCss","_plotLftCss","_plotTopCss","_plotWidCss","_plotHgtCss","shouldSetScales","shouldSetSize","shouldConvergeSize","shouldSetCursor","shouldSetSelect","shouldSetLegend","_setSize","force","calcSize","resetYSeries","commit","hasTopAxis","hasBtmAxis","hasRgtAxis","hasLftAxis","isVt","fullSize","sidesWithAxes","_padding","calcPlotRect","off1","off2","off3","off0","incrOffset","calcAxesRects","bb","CYCLE_LIMIT","setSize","hov","cursorIdx","valAtPosX","idx2","_prox","withProx","cursorLft","xValues","yValues","nonNullLft","nonNullRgt","lftDelta","rgtDelta","setCursorEvent","_lock","cursorFocus","cursorOnePt","cursorPts","cursorPtsLft","cursorPtsTop","initCursorPt","HTMLElement","initSeries","sv","_ptDia","rowCells","cells","row","childNodes","indic","color","setSeries","syncOpts","FOCUS_TRUE","initLegendRow","splice","addSeries","delSeries","tr","firstChild","autoPadSide","cycleNum","padding","ctxStroke","ctxFill","ctxWidth","ctxDash","ctxJoin","ctxCap","ctxFont","ctxAlign","ctxBaseline","viaAutoScaleX","setData","_resetScales","scaleData","_data0","xsc","autoScaleX","_setScale","setCtxStyle","strokeStyle","lineWidth","lineJoin","lineCap","setLineDash","baseline","textAlign","textBaseline","accScale","wsc","psc","getEdgeIdxs","getMinMax","AUTOSCALE","_points","gapsClip","_width","boundsClip","offset","_pxAlign","strokeFill","lineDash","fillPath","didStrokeFill","bi","gapsClip2","lowerEdge","lowerData","bandClip","_fillStyle","hasData","fillStroke","CLIP_FILL_STROKE","doFill","doStroke","getIncrSpace","fullDim","incrSpace","minVal","maxVal","intDigits","incrIdx","findIncr","_incrs","filts","pos0","beginPath","pos1","axesCalc","converged","oldSize","paddingCalc","_p","xCursor","yCursor","vCursor","hCursor","rawMouseLeft0","rawMouseTop0","rawMouseLeft1","rawMouseTop1","queuedCommit","deferHooks","hooksQueue","flushHooks","_commit","wipScales","xFacet","yFacet","yScaleKey","yData","wscx","wscy","changed","anyChanged","setScales","axesConverged","paddingConverged","convergeSize","_el","pctWid","pctHgt","select","prop","_hideProps","selectDiv","clearRect","setSelect","updateCursor","setLegend","batch","_deferHooks","redraw","rebuildPaths","recalcAxes","dragging","dragX","dragY","_fire","_pub","focusedSeries","allFocused","_setAlpha","i2","isFocused","opacity","setAlpha","setFocus","toggleDOM","pubSync","closestDist","closestSeries","addBand","setBand","delBand","sinh","bwd","setSelH","setSelV","valToIdx","posToIdx","setCursor","setSelX","setSelY","didx","sidx","setLegendValues","vals","nodeValue","syncLegend","noDataInRange","mouseXPos","_ptLft","_ptTop","_ptWid","_ptHgt","_centered","_ptFill","_ptStroke","yVal1","yVal2","xPos2","mouseYPos","mouseYVal","mouseYValSign","hPos","vPos","ptWid","ptHgt","ptLft","ptTop","ptStroke","ptFill","getBBox","xKey","yKey","matchXKeys","matchYKeys","xKeySrc","yKeySrc","sync","sdrag","sOff","sDim","sori","sPosToVal","matchingX","matchingY","hideSelect","rawDX","rawDY","_rawDX","syncKey","xSyncKey","ySyncKey","shouldPub","defer","mouseMove","_l","_t","_w","_h","_i","movementX","movementY","cacheMouse","initial","snap","syncOptsSrc","xValSrc","yValSrc","rotSrc","_xDim","_yDim","_xPos","_yPos","__l","defineProperty","downSelectLeft","downSelectTop","downSelectWidth","downSelectHeight","mouseDown","mouseUp","hasSelect","chgSelect","dblClick","syncPxRatio","events","seriesIdxMatcher","_dragging","dragH","dragV","snapH","snapV","snapProx","hooks","evName","a1","a2","call","srcSeriesIdx","filters","_init","av","dateTpl","timeAxisVal","tables","nullModes","vals0","len0","vals1","allHeadersSame","table","samples","firstIdx","lastIdx","stride","prevVal","isAsc","rlen","sort","table2","row2","sortCols","xVals","ti","xIdxs","nullMode","alignedIdx","tz","date2","getTimezoneOffset","toLocaleString","setMilliseconds","addGap","fromX","prevGap","stepped","ascDesc","extend","prevYPos","firstXPos","prevXPos","firstXPosExt","prevXPosExt","halfStroke","startsOffset","endsOffset","bars","_extraGap","ro","radius","radiusFn","gapFactor","_maxWidth","_minWidth","disp","_each","each","dispFills","dispStrokes","valRadius","baseRadius","_align","extraGap","maxWidth","minWidth","_dirX","xShift","barWid","fullGap","strokeWidth","multiPath","fillColors","fillPaths","strokeColors","strokePaths","unit","sizes","insetStroke","dataY0","radVal","radBase","yVal0","btm","barHgt","rv","rb","spline","interp","xCoords","yCoords","splineInterp","normalizeDate","input","isNaN","getTime","getVolumeForPekerjaan","volumeLookup","pekerjaanId","fallback","idVariants","String","variant","getHargaForPekerjaan","hargaLookup","buildCellValueMap","state","assignValue","numeric","parseFloat","assignmentMap","modifiedCells","collectPekerjaanIds","cellValues","ids","flatPekerjaan","node","formatPercentage","decimals","toFixed","formatRupiah","amount","ensureWeekZeroDataset","labels","firstLabel","zeroLabel","viewMode","plannedSeries","planned","actualSeries","actual","updated","acSeries","details","isCostView","variance","start","end","tooltip","zeroWeek","week_number","week_start","week_end","cost","cumulative_cost","cumulative_percent","pekerjaan_breakdown","weeks","actualWeeks","prependZeroDetails","LOG_PREFIX","buildProgressDataset","columns","aStart","startDate","bStart","index","getSortedColumns","timeColumns","lookup","setVolume","numericKey","volume","volumeMap","vol","buildVolumeLookup","setHarga","harga","hargaMap","buildHargaLookup","stateManager","plannedCellValues","actualCellValues","getAllCellsForMode","plannedState","actualState","pekerjaanIds","totalBiaya","totalBiayaProject","useHargaCalculation","totalVolume","columnIndexById","col","displayLabel","display_name","start_date","end_date","generateLabels","totalValue","plannedTotals","cellKey","columnId","columnIndex","numericValue","kontribusi","cumulative","calculatePlannedCurve","actualColumnTotals","totals","calculateColumnTotals","columnTotals","calculateActualCurve","column","plannedCostValue","actualCostValue","varianceCostValue","endDate","metadata","buildDetailData","buildCostWeeklySummary","plannedWeeks","totalCost","_c","_d","_e","_f","_g","_j","maxLength","summary","plannedEntry","actualEntry","plannedPercent","percent","actualPercent","resolveCostValue","variancePercent","weekNumber","weekEntry","numericPercent","toNumber","accumulated_cost","acc_cost","singleCost","parsed","NaN","DEFAULT_OPTIONS","enableCostView","KurvaSUPlotChart","chartInstance","container","tooltipEl","resizeHandler","resizeObserver","themeObserver","currentDataset","costData","isLoadingCostData","_interactionAttached","_wheelHandler","_interactionTarget","_scaleBounds","_dateFormatter","initialize","getComputedStyle","position","_createTooltip","observer","MutationObserver","mutations","mutation","attributeName","theme","documentElement","observe","attributes","attributeFilter","setupThemeObserver","_rebuild","delay","timeoutId","clearTimeout","createResizeHandler","resize","ResizeObserver","entry","contentRect","setupResizeObserver","update","resolvedDataset","transformedData","_transformDataset","colors","plannedLine","plannedArea","actualLine","actualArea","costActualLine","costActualArea","gridLine","_updateScaleBounds","_buildChartOptions","_attachInteractions","_updateTooltipPosition","clientWidth","toggleView","__async","nextMode","fetchCostData","costDataset","weeklyData","evm","bac","total_project_cost","weeklySummary","pv_percent","ev_percent","ac_percent","varianceSeries","varianceCostSeries","evmSummary","earned","plannedCost","planned_cost","actualCost","actual_cost","plannedPoints","actualPoints","buildCostDataset","dispose","_detachInteractions","disconnect","projectId","url","response","fetch","method","headers","ok","Error","statusText","json","nearestIndex","_updateTooltip","first","last","_handleWheelInteraction","isZoomGesture","isPanGesture","bounds","currentMin","currentMax","zoomIntensity","direction","deltaY","factor","overRect","cursorX","cursorVal","resolvedCursor","newMin","newMax","_setScaleBounded","panStep","targetMin","targetMax","boundsSpan","windowSize","className","pointerEvents","borderRadius","transition","detailArray","detailObject","weeklyCostSummary","summaryEntry","htmlParts","plannedWeek","actualWeek","rangeText","_formatWeekRange","plannedAmount","_resolveCostAmount","actualAmount","varianceAmount","varianceColor","_getVarianceColor","detail","startLabel","_formatDateLabel","endLabel","_composeRangeText","useHarga","Boolean","plannedAmountValue","actualAmountValue","xValue","seriesIndex","seriesValue","day","month","year","padStart","startRaw","endRaw","_parseNumber"],"mappings":"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","x_google_ignoreList":[1]}