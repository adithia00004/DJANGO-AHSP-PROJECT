{"version":3,"file":"chart-modules-CIxGXrHP.js","sources":["../../../../../../js/src/modules/shared/canvas-utils.js","../../../../../../js/src/modules/shared/tooltip-manager.js","../../../../../../js/src/modules/gantt/GanttCanvasOverlay.js","../../../../../../js/src/modules/shared/chart-utils.js","../../../../../../js/src/modules/kurva-s/week-zero-helpers.js","../../../../../../js/src/modules/kurva-s/dataset-builder.js","../../../../../../js/src/modules/shared/ux-enhancements.js","../../../../../../../../../node_modules/uplot/dist/uPlot.esm.js","../../../../../../js/src/modules/kurva-s/uplot-chart.js"],"sourcesContent":["/**\n * Canvas Utilities for Kurva S\n * Shared canvas creation and configuration utilities\n *\n * @module modules/kurva-s/canvas-utils\n */\n\n/**\n * Creates a canvas element with standard configuration\n * @param {string} className - CSS class name for the canvas\n * @returns {HTMLCanvasElement} Configured canvas element\n */\nexport function createCanvas(className = 'kurva-s-canvas') {\n  const canvas = document.createElement('canvas');\n  canvas.className = className;\n  canvas.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    pointer-events: auto;\n    background: transparent;\n  `;\n  return canvas;\n}\n\n/**\n * Creates a clip viewport wrapper for canvas\n * ClipViewport is a fixed overlay that clips canvas to visible area\n *\n * @param {string} className - CSS class name for the viewport\n * @param {number} zIndex - Z-index for stacking (default: 10)\n * @returns {HTMLDivElement} Configured clip viewport element\n */\nexport function createClipViewport(className = 'kurva-s-clip-viewport', zIndex = 10) {\n  const clipViewport = document.createElement('div');\n  clipViewport.className = className;\n  clipViewport.style.cssText = `\n    position: absolute;\n    overflow: hidden;\n    pointer-events: auto;\n    z-index: ${zIndex};\n  `;\n  return clipViewport;\n}\n\n/**\n * Gets 2D rendering context from canvas\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @returns {CanvasRenderingContext2D} 2D rendering context\n */\nexport function getContext2D(canvas) {\n  return canvas.getContext('2d');\n}\n\n/**\n * Hit test to find closest point within radius\n * @param {Array<{x, y}>} points - Array of points with x,y coordinates\n * @param {number} x - Test X coordinate\n * @param {number} y - Test Y coordinate\n * @param {number} radius - Hit test radius in pixels\n * @returns {Object|null} Closest point within radius, or null\n */\nexport function hitTestPoint(points, x, y, radius) {\n  if (!points || points.length === 0) return null;\n\n  for (const point of points) {\n    const dx = point.x - x;\n    const dy = point.y - y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    if (distance <= radius) {\n      return point;\n    }\n  }\n  return null;\n}\n\n/**\n * Detects if dark mode is active\n * Checks both data-bs-theme attribute and prefers-color-scheme\n *\n * @returns {boolean} True if dark mode is active\n */\nexport function isDarkMode() {\n  const htmlTheme = document.documentElement.getAttribute('data-bs-theme');\n  if (htmlTheme) {\n    return htmlTheme === 'dark';\n  }\n  return window.matchMedia?.('(prefers-color-scheme: dark)').matches ?? false;\n}\n\n/**\n * Get CSS variable value from document root\n * @param {string} name - CSS variable name (e.g., '--bs-primary')\n * @returns {string|null} Trimmed value or null if not found\n */\nexport function getCssVar(name) {\n  try {\n    const root = document.documentElement;\n    const value = getComputedStyle(root).getPropertyValue(name);\n    return value && value.trim().length ? value.trim() : null;\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Get color from a button element by selector\n * @param {string} selector - CSS selector for button element\n * @returns {string|null} Color value or null if not found\n */\nexport function getBtnColor(selector) {\n  try {\n    const el = document.querySelector(selector);\n    if (!el) return null;\n    const style = getComputedStyle(el);\n    return style.getPropertyValue('background-color')?.trim() ||\n      style.getPropertyValue('border-color')?.trim() ||\n      style.getPropertyValue('color')?.trim() ||\n      null;\n  } catch (e) {\n    return null;\n  }\n}\n\n","/**\n * Tooltip Manager for Kurva S\n * Manages tooltip creation, display, and positioning\n *\n * @module modules/kurva-s/tooltip-manager\n */\n\nimport { isDarkMode } from './canvas-utils.js';\n\n/**\n * TooltipManager class\n * Handles tooltip lifecycle and display for curve points\n */\nexport class TooltipManager {\n  /**\n   * @param {Object} options - Configuration options\n   * @param {number} [options.zIndex=50] - Z-index for tooltip\n   */\n  constructor(options = {}) {\n    this.tooltip = null;\n    this.zIndex = options.zIndex ?? 50;\n  }\n\n  /**\n   * Ensures tooltip element exists and returns it\n   * @returns {HTMLDivElement} Tooltip element\n   */\n  ensureTooltip() {\n    if (this.tooltip) return this.tooltip;\n\n    this.tooltip = document.createElement('div');\n    this.tooltip.className = 'kurva-s-tooltip';\n    this.tooltip.style.cssText = `\n      position: fixed;\n      padding: 8px 12px;\n      background: rgba(17, 24, 39, 0.95);\n      color: #f8fafc;\n      border-radius: 6px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: ${this.zIndex};\n      display: none;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n      line-height: 1.5;\n    `;\n    document.body.appendChild(this.tooltip);\n    return this.tooltip;\n  }\n\n  /**\n   * Shows tooltip at specified position with point data\n   * @param {number} clientX - Mouse X position (client coordinates)\n   * @param {number} clientY - Mouse Y position (client coordinates)\n   * @param {Object} point - Point data\n   * @param {string} point.label - Point label (e.g., \"Planned\", \"Actual\")\n   * @param {string} point.color - Point color\n   * @param {number} [point.weekNumber] - Week number\n   * @param {string} [point.columnId] - Column ID\n   * @param {number} [point.progress] - Cumulative progress (%)\n   * @param {number} [point.weekProgress] - Week progress (%)\n   */\n  show(clientX, clientY, point) {\n    const tip = this.ensureTooltip();\n    const weekLabel = point.weekNumber ? `Week ${point.weekNumber}` : point.columnId;\n    const progressLabel = Number.isFinite(point.progress) ? `${point.progress.toFixed(1)}%` : '-';\n    const weekProgressLabel = Number.isFinite(point.weekProgress) ? `${point.weekProgress.toFixed(1)}%` : '-';\n\n    tip.innerHTML = `\n      <div style=\"font-weight: 600; margin-bottom: 4px; color: ${point.color};\">${point.label}</div>\n      <div><strong>${weekLabel}</strong></div>\n      <div>Cumulative: ${progressLabel}</div>\n      <div>Week Progress: ${weekProgressLabel}</div>\n    `;\n    tip.style.left = `${clientX + 12}px`;\n    tip.style.top = `${clientY + 12}px`;\n    tip.style.display = 'block';\n  }\n\n  /**\n   * Hides the tooltip\n   */\n  hide() {\n    if (this.tooltip) {\n      this.tooltip.style.display = 'none';\n    }\n  }\n\n  /**\n   * Destroys the tooltip element\n   */\n  destroy() {\n    if (this.tooltip) {\n      this.tooltip.remove();\n      this.tooltip = null;\n    }\n  }\n}\n\n/**\n * Creates a legend element for the chart\n * @param {Object} options - Legend options\n * @param {string} options.plannedColor - Planned curve color\n * @param {string} options.actualColor - Actual curve color\n * @param {number} [options.zIndex=40] - Z-index for legend\n * @returns {HTMLDivElement} Legend element\n */\nexport function createLegend(options) {\n  const { plannedColor, actualColor, zIndex = 40 } = options;\n  const darkMode = isDarkMode();\n\n  const legend = document.createElement('div');\n  legend.className = 'kurva-s-legend';\n  legend.style.cssText = `\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    background: ${darkMode ? 'rgba(30, 30, 30, 0.95)' : 'rgba(255, 255, 255, 0.95)'};\n    border: 1px solid ${darkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)'};\n    border-radius: 8px;\n    padding: 8px 12px;\n    font-size: 13px;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, ${darkMode ? '0.5' : '0.15'});\n    z-index: ${zIndex};\n    pointer-events: none;\n    display: flex;\n    gap: 16px;\n    align-items: center;\n  `;\n\n  legend.innerHTML = `\n    <div style=\"display: flex; align-items: center; gap: 6px;\">\n      <span style=\"display: inline-block; width: 24px; height: 3px; background: ${plannedColor}; border-radius: 2px;\"></span>\n      <span style=\"color: ${darkMode ? '#e2e8f0' : '#1e293b'};\">Planned</span>\n    </div>\n    <div style=\"display: flex; align-items: center; gap: 6px;\">\n      <span style=\"display: inline-block; width: 24px; height: 3px; background: ${actualColor}; border-radius: 2px;\"></span>\n      <span style=\"color: ${darkMode ? '#e2e8f0' : '#1e293b'};\">Actual</span>\n    </div>\n  `;\n\n  return legend;\n}\n\n/**\n * Updates legend colors based on current theme\n * @param {HTMLDivElement} legend - Legend element\n * @param {string} plannedColor - Planned curve color\n * @param {string} actualColor - Actual curve color\n */\nexport function updateLegendColors(legend, plannedColor, actualColor) {\n  if (!legend) return;\n\n  const darkMode = isDarkMode();\n  const textColor = darkMode ? '#e2e8f0' : '#1e293b';\n  const bgColor = darkMode ? 'rgba(30, 30, 30, 0.95)' : 'rgba(255, 255, 255, 0.95)';\n  const borderColor = darkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)';\n\n  // Update legend background and border\n  legend.style.background = bgColor;\n  legend.style.border = `1px solid ${borderColor}`;\n  legend.style.boxShadow = `0 4px 12px rgba(0, 0, 0, ${darkMode ? '0.5' : '0.15'})`;\n\n  // Update legend HTML with new colors\n  legend.innerHTML = `\n    <div style=\"display: flex; align-items: center; gap: 6px;\">\n      <span style=\"display: inline-block; width: 24px; height: 3px; background: ${plannedColor}; border-radius: 2px;\"></span>\n      <span style=\"color: ${textColor};\">Planned</span>\n    </div>\n    <div style=\"display: flex; align-items: center; gap: 6px;\">\n      <span style=\"display: inline-block; width: 24px; height: 3px; background: ${actualColor}; border-radius: 2px;\"></span>\n      <span style=\"color: ${textColor};\">Actual</span>\n    </div>\n  `;\n}\n","import { getCssVar, getBtnColor } from '../shared/canvas-utils.js';\nimport { TooltipManager } from '../shared/tooltip-manager.js';\n\nexport class GanttCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.debug = Boolean(\n      this.tableManager?.options?.debugUnifiedTable ||\n      this.tableManager?.state?.debugUnifiedTable ||\n      window.DEBUG_UNIFIED_TABLE\n    );\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'gantt-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n\n    // ClipViewport: container with overflow:hidden to clip canvas\n    // pointer-events:none allows scroll events to pass through to bodyScroll\n    this.clipViewport = document.createElement('div');\n    this.clipViewport.className = 'gantt-clip-viewport';\n    this.clipViewport.style.cssText = `\n      position: absolute;\n      overflow: hidden;\n      pointer-events: none;\n      z-index: 1;\n    `;\n    // Canvas needs pointer-events:auto for tooltip interaction\n    this.canvas.style.pointerEvents = 'auto';\n    this.clipViewport.appendChild(this.canvas);\n    this.visible = false;\n    this.barData = [];\n    this.dependencies = [];\n    this.barRects = [];\n    this.tooltipManager = new TooltipManager({ zIndex: 20 });\n    this.pinnedWidth = 0;\n    this.scrollLeft = 0;\n    this.scrollTop = 0;  // Track vertical scroll for transform\n    this.lastDrawMetrics = { barsDrawn: 0, barsSkipped: 0 };\n\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      // OPTIMIZED: Transform-only scroll (no re-render)\n      // Re-render only happens on: data change, resize, mode switch\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          this._updateTransform();\n        }\n      }, { passive: true });\n\n      // Prevent wheel scroll from propagating to parent containers\n      scrollTarget.addEventListener('wheel', (event) => {\n        const { scrollTop, scrollHeight, clientHeight, scrollLeft, scrollWidth, clientWidth } = scrollTarget;\n\n        const atTop = scrollTop <= 0;\n        const atBottom = scrollTop + clientHeight >= scrollHeight;\n        const atLeft = scrollLeft <= 0;\n        const atRight = scrollLeft + clientWidth >= scrollWidth;\n\n        const scrollingUp = event.deltaY < 0;\n        const scrollingDown = event.deltaY > 0;\n        const scrollingLeft = event.deltaX < 0;\n        const scrollingRight = event.deltaX > 0;\n\n        const shouldPropagate =\n          (atTop && scrollingUp && Math.abs(event.deltaY) > Math.abs(event.deltaX)) ||\n          (atBottom && scrollingDown && Math.abs(event.deltaY) > Math.abs(event.deltaX)) ||\n          (atLeft && scrollingLeft && Math.abs(event.deltaX) > Math.abs(event.deltaY)) ||\n          (atRight && scrollingRight && Math.abs(event.deltaX) > Math.abs(event.deltaY));\n\n        if (!shouldPropagate) {\n          event.stopPropagation();\n        }\n      }, { passive: true });\n    }\n\n    // Forward wheel events from canvas to bodyScroll\n    // Canvas has pointer-events:auto so it captures wheel events, need to forward to scroll\n    this.canvas.addEventListener('wheel', (event) => {\n      const scrollTarget = this.tableManager?.bodyScroll;\n      if (scrollTarget) {\n        scrollTarget.scrollLeft += event.deltaX;\n        scrollTarget.scrollTop += event.deltaY;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    }, { passive: false });  // Need non-passive to call preventDefault\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n\n    // Attach clipViewport as sibling of scrollArea\n    const container = scrollArea.parentElement;\n    if (container && !this.clipViewport.parentNode) {\n      container.appendChild(this.clipViewport);\n    }\n\n    this._updatePinnedClip();\n    this.visible = true;\n    this._log('show', { clipping: true, container: 'sibling-of-bodyScroll' });\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n    if (this.clipViewport.parentNode) {\n      this.clipViewport.parentNode.removeChild(this.clipViewport);\n    }\n    this.visible = false;\n    this._log('hide');\n    this.tooltipManager.hide();\n  }\n\n  // Immediate transform update for smooth scrolling (GPU-accelerated)\n  // Canvas moves via NEGATIVE transform to simulate viewport scrolling\n  _updateTransform() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this.scrollLeft = scrollArea.scrollLeft || 0;\n    this.scrollTop = scrollArea.scrollTop || 0;\n    // Negative transform: canvas shifts opposite to scroll direction\n    this.canvas.style.transform = `translate(${-this.scrollLeft}px, ${-this.scrollTop}px)`;\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    const container = scrollArea?.parentElement;\n    if (!scrollArea || !container) return;\n\n    this._updatePinnedClip();\n    this.scrollLeft = scrollArea.scrollLeft || 0;\n    this.scrollTop = scrollArea.scrollTop || 0;\n\n    // Get header height to position clipViewport below header\n    const header = container.querySelector('.tanstack-grid-header');\n    const headerHeight = header?.offsetHeight || 0;\n\n    // Use bounding rect for accurate viewport sizing\n    const containerRect = container.getBoundingClientRect();\n    const scrollAreaRect = scrollArea.getBoundingClientRect();\n\n    // Margins to avoid covering scrollbars and add spacing\n    const marginLeft = 10;   // Space from frozen columns\n    const marginRight = 20;  // Space for vertical scrollbar\n    const marginTop = 5;     // Space from header\n    const marginBottom = 10;  // Space from bottom\n\n    // ClipViewport: positioned after frozen columns, acts as viewport window\n    const viewportWidth = containerRect.width - this.pinnedWidth - marginLeft - marginRight;\n    const viewportHeight = scrollAreaRect.height - marginTop - marginBottom;\n\n    this.clipViewport.style.left = `${this.pinnedWidth + marginLeft}px`;\n    this.clipViewport.style.top = `${headerHeight + marginTop}px`;\n    this.clipViewport.style.width = `${viewportWidth}px`;\n    this.clipViewport.style.height = `${viewportHeight}px`;\n\n    // Canvas size = FULL content size (both width and height)\n    const MAX_CANVAS_WIDTH = 32000;\n    const MAX_CANVAS_HEIGHT = 16000;\n    // Use full scrollWidth for canvas - pinnedWidth is handled by clipViewport positioning\n    const contentWidth = Math.max(scrollArea.scrollWidth, 100);\n    const contentHeight = scrollArea.scrollHeight || scrollArea.clientHeight;\n\n    this.canvas.width = Math.min(contentWidth, MAX_CANVAS_WIDTH);\n    this.canvas.height = Math.min(contentHeight, MAX_CANVAS_HEIGHT);\n\n    // Canvas position inside clipViewport\n    this.canvas.style.position = 'absolute';\n    this.canvas.style.left = '0px';\n    this.canvas.style.top = '0px';\n    // Negative transform for both horizontal and vertical scroll\n    this.canvas.style.transform = `translate(${-this.scrollLeft}px, ${-this.scrollTop}px)`;\n\n    // Use getAllCellBoundingRects for virtual calculation (all cells)\n    // Fallback to getCellBoundingRects for visible-only cells\n    const cellRects = typeof this.tableManager.getAllCellBoundingRects === 'function'\n      ? this.tableManager.getAllCellBoundingRects()\n      : typeof this.tableManager.getCellBoundingRects === 'function'\n        ? this.tableManager.getCellBoundingRects()\n        : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    // Clear and clip to the canvas; mask element handles frozen cover.\n    this.ctx.save();\n    this.barRects = [];\n\n    this._log('sync-debug', {\n      canvasSize: { w: this.canvas.width, h: this.canvas.height },\n      scrollAreaSize: { w: scrollArea.scrollWidth, h: scrollArea.scrollHeight },\n      visibleSize: { w: scrollArea.clientWidth, h: scrollArea.clientHeight },\n      scroll: { left: scrollArea.scrollLeft, top: scrollArea.scrollTop },\n      cellRects: cellRects.length,\n      bars: this.barData.length,\n    });\n\n    // DEBUG: Analyze cellRects column distribution\n    const columnIds = [...new Set(cellRects.map(r => r.columnId))];\n    const maxX = cellRects.length > 0 ? Math.max(...cellRects.map(r => r.x + r.width)) : 0;\n    console.log('[GanttOverlay] ðŸ“ CellRects analysis:', {\n      totalCells: cellRects.length,\n      uniqueColumns: columnIds.length,\n      sampleColumnIds: columnIds.slice(0, 10),\n      maxX: maxX,\n      canvasWidth: this.canvas.width,\n      scrollWidth: scrollArea.scrollWidth,\n    });\n\n    this._log('sync', {\n      cells: cellRects.length,\n      bars: this.barData.length,\n      deps: this.dependencies.length,\n      size: { w: this.canvas.width, h: this.canvas.height },\n      scroll: { left: scrollArea.scrollLeft, top: scrollArea.scrollTop },\n    });\n\n    if (this.barData.length > 0 && cellRects.length === 0) {\n      this._log('warn-no-cell-rects', { bars: this.barData.length });\n    }\n\n    // Outline cells only when debugging alignment\n    if (this.debug) {\n      this.ctx.strokeStyle = '#e2e8f0';\n      cellRects.forEach((rect) => {\n        // Canvas-relative coordinates (no scrollLeft, handled by transform)\n        const canvasX = rect.x - this.pinnedWidth;\n        this.ctx.strokeRect(canvasX, rect.y, rect.width, rect.height);\n      });\n    }\n\n    this._drawBars(cellRects);\n    this._publishMetrics(cellRects, scrollArea);\n    this._drawDependencies(cellRects);\n    this.ctx.restore();\n  }\n\n  renderBars(barData) {\n    this.barData = Array.isArray(barData) ? barData : [];\n    this._log('renderBars', { bars: this.barData.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  renderDependencies(dependencyData) {\n    this.dependencies = Array.isArray(dependencyData) ? dependencyData : [];\n    this._log('renderDependencies', { deps: this.dependencies.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _updatePinnedClip() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    const pinnedWidth = typeof this.tableManager?.getPinnedColumnsWidth === 'function'\n      ? Number(this.tableManager.getPinnedColumnsWidth()) || 0\n      : 0;\n    this.pinnedWidth = Math.max(0, pinnedWidth);\n\n    // FIXED: No need for clip-path anymore since canvas starts after frozen columns\n    // Remove clip-path if exists\n    this.canvas.style.clipPath = '';\n    this.canvas.style.webkitClipPath = '';\n\n    if (scrollArea?.style) {\n      scrollArea.style.setProperty('--gantt-overlay-pinned-width', `${this.pinnedWidth}px`);\n    }\n    this._log('clip', { pinnedWidth: this.pinnedWidth });\n    return this.pinnedWidth;\n  }\n\n  _publishMetrics(cellRects, scrollArea) {\n    const viewportLeft = typeof scrollArea?.scrollLeft === 'number' ? scrollArea.scrollLeft : 0;\n    const viewportWidth = typeof scrollArea?.clientWidth === 'number' ? scrollArea.clientWidth : 0;\n    const viewportRight = viewportWidth ? viewportLeft + viewportWidth : null;\n    const metrics = {\n      timestamp: Date.now(),\n      pinnedWidth: this.pinnedWidth,\n      clipLeft: Math.max(this.pinnedWidth, viewportLeft),\n      viewportLeft,\n      viewportWidth,\n      viewportRight,\n      scrollWidth: scrollArea?.scrollWidth || 0,\n      scrollHeight: scrollArea?.scrollHeight || 0,\n      barsDrawn: this.lastDrawMetrics.barsDrawn || 0,\n      barsSkipped: this.lastDrawMetrics.barsSkipped || 0,\n      cellRects: Array.isArray(cellRects) ? cellRects.length : 0,\n    };\n    if (typeof window !== 'undefined') {\n      window.GanttOverlayMetrics = metrics;\n    }\n    this._log('metrics', metrics);\n    return metrics;\n  }\n\n  _drawBars(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.barData.length === 0) {\n      this.lastDrawMetrics = { barsDrawn: 0, barsSkipped: 0 };\n      return;\n    }\n    const scrollArea = this.tableManager?.bodyScroll;\n    const viewportLeft = typeof scrollArea?.scrollLeft === 'number' ? scrollArea.scrollLeft : 0;\n    const viewportWidth = typeof scrollArea?.clientWidth === 'number' ? scrollArea.clientWidth : 0;\n    const viewportRight = viewportWidth ? viewportLeft + viewportWidth : null;\n    const clipLeft = Math.max(this.pinnedWidth, viewportLeft);\n\n    // Group cell rects by pekerjaan\n    const rectIndex = new Map();\n    cellRects.forEach((r) => {\n      const key = String(r.pekerjaanId);\n      if (!rectIndex.has(key)) rectIndex.set(key, []);\n      rectIndex.get(key).push(r);\n    });\n    rectIndex.forEach((list) => list.sort((a, b) => a.x - b.x));\n\n    const barsByRow = new Map();\n    this.barData.forEach((bar) => {\n      const key = String(bar.pekerjaanId);\n      if (!barsByRow.has(key)) barsByRow.set(key, []);\n      barsByRow.get(key).push(bar);\n    });\n\n    let barsDrawn = 0;\n    let barsSkipped = 0;\n\n    barsByRow.forEach((bars, pkjId) => {\n      const rects = rectIndex.get(pkjId) || [];\n      const rectMap = new Map(rects.map((r) => [String(r.columnId), r]));\n      // track heights for stacked view: planned bottom, actual top\n      bars.forEach((bar) => {\n        const rect = rectMap.get(String(bar.columnId));\n        if (!rect) {\n          barsSkipped += 1;\n          return;\n        }\n\n        // No viewport clipping needed - canvas is full content width\n        // ClipViewport handles visibility, we render ALL bars\n\n        const paddingX = 0; // no gap to keep continuity\n        const paddingY = 3;\n        const topOffset = 7; // Additional offset to move bars down\n        const maxWidth = rect.width - paddingX * 2;\n\n        // Canvas is full content width, so coordinates are relative to pinnedWidth only\n        // No scrollLeft adjustment needed - transform handles viewport positioning\n        const baseX = (rect.x - this.pinnedWidth) + paddingX;\n        const baseY = rect.y + paddingY + topOffset;  // Move down by topOffset\n\n        // Skip bars with negative X (shouldn't happen with correct cell rects)\n        if (baseX < -rect.width) {\n          barsSkipped += 1;\n          return;\n        }\n\n        // Reduce height to account for topOffset (bar is shifted down)\n        const fullHeight = Math.max(8, rect.height - paddingY * 2 - topOffset);\n        const trackHeight = fullHeight / 2; // split planned/actual vertically\n\n        const plannedValue = Number.isFinite(bar.planned) ? Math.max(0, Math.min(100, bar.planned)) : 0;\n        const actualValue = Number.isFinite(bar.actual) ? Math.max(0, Math.min(100, bar.actual)) : Math.max(0, Math.min(100, bar.value || 0));\n\n        // Planned track (bottom half): full width only if >0, otherwise gap\n        const plannedWidth = maxWidth > 0 && plannedValue > 0 ? maxWidth : 0;\n        this.ctx.fillStyle = this._getPlannedColor();\n        if (plannedWidth > 0) {\n          this.ctx.fillRect(baseX, baseY + trackHeight, plannedWidth, trackHeight - 1);\n        }\n\n        // Actual track (top half): full width only if >0, otherwise gap\n        const actualWidth = maxWidth > 0 && actualValue > 0 ? maxWidth : 0;\n        const barColor = bar.color || this._resolveActualColor(bar.variance);\n        this.ctx.fillStyle = barColor;\n        if (actualWidth > 0) {\n          this.ctx.fillRect(baseX, baseY, actualWidth, trackHeight - 1);\n        }\n\n        this.barRects.push({\n          x: baseX,\n          y: baseY,\n          width: Math.max(actualWidth, plannedWidth),\n          height: fullHeight,\n          pekerjaanId: bar.pekerjaanId,\n          columnId: bar.columnId,\n          value: actualValue,\n          planned: plannedValue,\n          variance: bar.variance,\n          label: bar.label,\n          color: barColor,\n        });\n        barsDrawn += 1;\n      });\n    });\n\n    this.lastDrawMetrics = { barsDrawn, barsSkipped };\n    this._log('bars:drawn', { drawn: barsDrawn, skipped: barsSkipped, total: this.barData.length });\n  }\n\n  _drawDependencies(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.dependencies.length === 0) {\n      return;\n    }\n\n    this.dependencies.forEach((dep) => {\n      const fromRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.fromPekerjaanId && c.columnId === dep.fromColumnId,\n      );\n      const toRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.toPekerjaanId && c.columnId === dep.toColumnId,\n      );\n      if (!fromRect || !toRect) return;\n\n      // Canvas-relative coordinates (no scrollLeft, handled by transform)\n      const fromX = (fromRect.x - this.pinnedWidth) + fromRect.width;\n      const fromY = fromRect.y + fromRect.height / 2;\n      const toX = toRect.x - this.pinnedWidth;\n      const toY = toRect.y + toRect.height / 2;\n\n      this.ctx.strokeStyle = dep.color || '#94a3b8';\n      this.ctx.lineWidth = 1.5;\n      this.ctx.beginPath();\n      this.ctx.moveTo(fromX, fromY);\n      this.ctx.lineTo(toX, toY);\n      this.ctx.stroke();\n\n      const arrowSize = 5;\n      const angle = Math.atan2(toY - fromY, toX - fromX);\n      this.ctx.beginPath();\n      this.ctx.moveTo(toX, toY);\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle - Math.PI / 6), toY - arrowSize * Math.sin(angle - Math.PI / 6));\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle + Math.PI / 6), toY - arrowSize * Math.sin(angle + Math.PI / 6));\n      this.ctx.closePath();\n      this.ctx.fillStyle = dep.color || '#94a3b8';\n      this.ctx.fill();\n    });\n  }\n\n  _resolveVarianceColor(variance) {\n    if (!Number.isFinite(variance)) return '#3b82f6';\n    if (variance < -0.1) return '#ef4444';\n    if (variance > 0.1) return '#22c55e';\n    return '#3b82f6';\n  }\n\n  _resolveActualColor(variance) {\n    const cssVar =\n      getCssVar('--gantt-actual-fill') ||\n      getCssVar('--bs-warning') ||\n      getBtnColor('.progress-mode-tabs .btn-outline-warning') ||\n      getBtnColor('.progress-mode-tabs .btn-warning');\n    if (cssVar) return cssVar;\n    return this._resolveVarianceColor(variance);\n  }\n\n  _getPlannedColor() {\n    return (\n      getCssVar('--gantt-bar-fill') ||\n      getCssVar('--bs-info') ||\n      getBtnColor('.progress-mode-tabs .btn-outline-info') ||\n      getBtnColor('.progress-mode-tabs .btn-info') ||\n      '#e2e8f0'\n    );\n  }\n\n  _bindPointerEvents() {\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible || !this.barRects.length) return;\n      const rect = this.canvas.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const hit = this._hitTest(x, y);\n      if (hit) {\n        // Format tooltip content for Gantt bar\n        const tooltipData = {\n          label: `Pekerjaan: ${hit.label || hit.pekerjaanId}`,\n          color: hit.color || '#3b82f6',\n          weekNumber: null,\n          columnId: hit.columnId,\n          progress: hit.value,\n          weekProgress: hit.planned,\n        };\n        this.tooltipManager.show(e.clientX, e.clientY, tooltipData);\n      } else {\n        this.tooltipManager.hide();\n      }\n    });\n\n    this.canvas.addEventListener('mouseleave', () => {\n      this.tooltipManager.hide();\n    });\n  }\n\n  _hitTest(x, y) {\n    return this.barRects.find(\n      (b) => x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height,\n    );\n  }\n\n  _log(event, payload) {\n    if (!this.debug) return;\n    console.log(`[GanttOverlay] ${event}`, payload || {});\n  }\n}\n","/**\n * Chart Utilities Module\n * Shared utilities for Kurva-S and Gantt charts\n *\n * Migrated from legacy chart modules\n * Date: 2025-11-20\n */\n\n// =========================================================================\n// CONSTANTS\n// =========================================================================\n\nexport const ONE_DAY_MS = 24 * 60 * 60 * 1000;\n\n// =========================================================================\n// THEME UTILITIES\n// =========================================================================\n\n/**\n * Get theme-specific colors for charts\n * Supports Bootstrap dark/light theme\n *\n * @returns {Object} Theme colors\n */\nexport function getThemeColors() {\n  const theme = document.documentElement.getAttribute('data-bs-theme') || 'light';\n\n  if (theme === 'dark') {\n    return {\n      text: '#f8fafc',\n      axis: '#cbd5e1',\n      plannedLine: '#60a5fa',\n      plannedArea: 'rgba(96, 165, 250, 0.15)',\n      actualLine: '#34d399',\n      actualArea: 'rgba(52, 211, 153, 0.18)',\n      costActualLine: '#f87171',\n      costActualArea: 'rgba(248, 113, 113, 0.18)',\n      gridLine: '#334155',\n      background: '#1e293b',\n    };\n  }\n\n  return {\n    text: '#1f2937',\n    axis: '#374151',\n    plannedLine: '#0d6efd',\n    plannedArea: 'rgba(13, 110, 253, 0.12)',\n    actualLine: '#198754',\n    actualArea: 'rgba(25, 135, 84, 0.12)',\n    costActualLine: '#dc3545',\n    costActualArea: 'rgba(220, 53, 69, 0.12)',\n    gridLine: '#e5e7eb',\n    background: '#ffffff',\n  };\n}\n\n/**\n * Setup theme observer for chart updates\n * Watches for data-bs-theme attribute changes\n *\n * @param {Function} callback - Called when theme changes\n * @returns {MutationObserver} Observer instance\n */\nexport function setupThemeObserver(callback) {\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {\n        const theme = document.documentElement.getAttribute('data-bs-theme');\n        console.log('[ChartUtils] Theme changed to:', theme);\n        callback(theme);\n      }\n    });\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['data-bs-theme']\n  });\n\n  return observer;\n}\n\n// =========================================================================\n// DATE UTILITIES\n// =========================================================================\n\n/**\n * Normalize date to Date object\n * Handles multiple input formats: Date, ISO string, timestamp\n *\n * @param {Date|string|number} input - Date input\n * @returns {Date|null} Normalized date or null if invalid\n */\nexport function normalizeDate(input) {\n  if (!input) return null;\n\n  // Already a Date object\n  if (input instanceof Date) {\n    return Number.isNaN(input.getTime()) ? null : input;\n  }\n\n  // ISO string or other string format\n  if (typeof input === 'string') {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  // Timestamp\n  if (typeof input === 'number' && Number.isFinite(input)) {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  return null;\n}\n\n/**\n * Format date to YYYY-MM-DD string\n *\n * @param {Date} date - Date to format\n * @returns {string} Formatted date string\n */\nexport function formatDate(date) {\n  if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n    return '';\n  }\n\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * Calculate date range from time columns\n *\n * @param {Array} columns - Array of time column objects\n * @returns {Object} {startDate, endDate}\n */\nexport function calculateDateRange(columns) {\n  if (!Array.isArray(columns) || columns.length === 0) {\n    return { startDate: null, endDate: null };\n  }\n\n  let minDate = null;\n  let maxDate = null;\n\n  columns.forEach(col => {\n    const start = normalizeDate(col.startDate);\n    const end = normalizeDate(col.endDate);\n\n    if (start && (!minDate || start < minDate)) {\n      minDate = start;\n    }\n\n    if (end && (!maxDate || end > maxDate)) {\n      maxDate = end;\n    }\n  });\n\n  return { startDate: minDate, endDate: maxDate };\n}\n\n/**\n * Get sorted time columns\n * Sorts by startDate, then by index\n *\n * @param {Array} columns - Time columns\n * @returns {Array} Sorted columns\n */\nexport function getSortedColumns(columns) {\n  if (!Array.isArray(columns)) return [];\n\n  return columns.slice().sort((a, b) => {\n    const aStart = normalizeDate(a.startDate);\n    const bStart = normalizeDate(b.startDate);\n\n    if (aStart && bStart) {\n      return aStart.getTime() - bStart.getTime();\n    }\n\n    return (a.index || 0) - (b.index || 0);\n  });\n}\n\n// =========================================================================\n// VOLUME UTILITIES\n// =========================================================================\n\n/**\n * Build volume lookup map from state\n * Handles both Map and Object formats\n *\n * @param {Object} state - Application state\n * @returns {Map} Volume lookup (pekerjaanId â†’ volume)\n */\nexport function buildVolumeLookup(state) {\n  const lookup = new Map();\n\n  const setVolume = (key, value) => {\n    const numericKey = Number(key);\n    const volume = Number.isFinite(value) && value > 0 ? value : null;\n\n    if (volume === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), volume);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), volume);\n    }\n  };\n\n  // Handle Map format\n  if (state.volumeMap instanceof Map) {\n    state.volumeMap.forEach((value, key) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n  // Handle Object format\n  else if (state.volumeMap && typeof state.volumeMap === 'object') {\n    Object.entries(state.volumeMap).forEach(([key, value]) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get volume for a specific pekerjaan\n *\n * @param {Map} volumeLookup - Volume lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found\n * @returns {number} Volume value\n */\nexport function getVolumeForPekerjaan(volumeLookup, pekerjaanId, fallback = 1) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (volumeLookup.has(variant)) {\n      return volumeLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n/**\n * Build harga (cost) lookup map from state\n * Phase 2F.0: Kurva S should use HARGA (Rupiah) instead of volume\n *\n * @param {Object} state - Application state\n * @returns {Map} Harga lookup map (pekerjaanId â†’ total harga in Rp)\n */\nexport function buildHargaLookup(state) {\n  const lookup = new Map();\n\n  const setHarga = (key, value) => {\n    const numericKey = Number(key);\n    const harga = Number.isFinite(value) && value >= 0 ? value : null;\n\n    if (harga === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), harga);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), harga);\n    }\n  };\n\n  // Handle Map format\n  if (state.hargaMap instanceof Map) {\n    state.hargaMap.forEach((value, key) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n  // Handle Object format\n  else if (state.hargaMap && typeof state.hargaMap === 'object') {\n    Object.entries(state.hargaMap).forEach(([key, value]) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get harga for a specific pekerjaan\n * Phase 2F.0: Used for harga-weighted Kurva S calculation\n *\n * @param {Map} hargaLookup - Harga lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found (default: 0)\n * @returns {number} Total harga (Rp) for the pekerjaan\n */\nexport function getHargaForPekerjaan(hargaLookup, pekerjaanId, fallback = 0) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (hargaLookup.has(variant)) {\n      return hargaLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n// =========================================================================\n// DATA UTILITIES\n// =========================================================================\n\n/**\n * Build cell value map from assignmentMap and modifiedCells\n * Modified cells override assignment values\n *\n * @deprecated Phase 0.5: Use StateManager.getAllCellsForMode() instead\n * This function is redundant with StateManager's built-in merge logic.\n *\n * Migration guide:\n * BEFORE: const cellValues = buildCellValueMap(state);\n * AFTER:  const cellValues = stateManager.getAllCellsForMode('planned');\n *\n * @param {Object} state - Application state\n * @returns {Map} Cell value map (cellKey â†’ percentage)\n */\nexport function buildCellValueMap(state) {\n  console.warn('[chart-utils] buildCellValueMap() is deprecated. Use StateManager.getAllCellsForMode() instead.');\n\n  const map = new Map();\n\n  const assignValue = (key, value) => {\n    const numeric = parseFloat(value);\n    map.set(String(key), Number.isFinite(numeric) ? numeric : 0);\n  };\n\n  // First, load saved assignment values\n  if (state.assignmentMap instanceof Map) {\n    state.assignmentMap.forEach((value, key) => assignValue(key, value));\n  } else if (state.assignmentMap && typeof state.assignmentMap === 'object') {\n    Object.entries(state.assignmentMap).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  // Then, override with modified cells (unsaved changes)\n  if (state.modifiedCells instanceof Map) {\n    state.modifiedCells.forEach((value, key) => assignValue(key, value));\n  } else if (state.modifiedCells && typeof state.modifiedCells === 'object') {\n    Object.entries(state.modifiedCells).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  return map;\n}\n\n/**\n * Collect all pekerjaan IDs from state and cell values\n *\n * @param {Object} state - Application state\n * @param {Map} cellValues - Cell value map\n * @returns {Set} Set of pekerjaan IDs\n */\nexport function collectPekerjaanIds(state, cellValues) {\n  const ids = new Set();\n\n  // From flatPekerjaan array\n  if (Array.isArray(state.flatPekerjaan)) {\n    state.flatPekerjaan.forEach((node) => {\n      if (node && (node.type === 'pekerjaan' || typeof node.type === 'undefined')) {\n        ids.add(String(node.id));\n      }\n    });\n  }\n\n  // From cell keys (format: \"pekerjaanId-tahapanId\")\n  cellValues.forEach((_, key) => {\n    const [pekerjaanId] = String(key).split('-');\n    if (pekerjaanId) {\n      ids.add(pekerjaanId);\n    }\n  });\n\n  return ids;\n}\n\n// =========================================================================\n// NUMBER UTILITIES\n// =========================================================================\n\n/**\n * Format percentage for display\n *\n * @param {number} value - Percentage value (0-100)\n * @param {number} decimals - Number of decimal places\n * @returns {string} Formatted percentage\n */\nexport function formatPercentage(value, decimals = 1) {\n  if (!Number.isFinite(value)) return '0%';\n\n  const rounded = decimals === 0\n    ? Math.round(value)\n    : parseFloat(value.toFixed(decimals));\n\n  return `${rounded}%`;\n}\n\n/**\n * Format number as Indonesian Rupiah\n * Phase 2F.0: Display currency in Kurva S tooltips\n *\n * @param {number} amount - Amount in Rupiah\n * @returns {string} Formatted currency string (e.g., \"Rp 1.234.567\")\n */\nexport function formatRupiah(amount) {\n  if (!Number.isFinite(amount)) return 'Rp 0';\n\n  // Format with thousand separators (Indonesian style)\n  const formatted = Math.round(amount).toLocaleString('id-ID');\n  return `Rp ${formatted}`;\n}\n\n/**\n * Clamp number between min and max\n *\n * @param {number} value - Value to clamp\n * @param {number} min - Minimum value\n * @param {number} max - Maximum value\n * @returns {number} Clamped value\n */\nexport function clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n// =========================================================================\n// RESIZE UTILITIES\n// =========================================================================\n\n/**\n * Create debounced resize handler\n *\n * @param {Function} callback - Function to call on resize\n * @param {number} delay - Debounce delay in ms\n * @returns {Function} Debounced handler\n */\nexport function createResizeHandler(callback, delay = 150) {\n  let timeoutId = null;\n\n  return function debouncedResize() {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = setTimeout(() => {\n      callback();\n      timeoutId = null;\n    }, delay);\n  };\n}\n\n/**\n * Setup resize observer for chart container\n *\n * @param {HTMLElement} container - Container element\n * @param {Function} callback - Called when container resizes\n * @returns {ResizeObserver} Observer instance\n */\nexport function setupResizeObserver(container, callback) {\n  if (!container || typeof ResizeObserver === 'undefined') {\n    return null;\n  }\n\n  const observer = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n      if (entry.target === container) {\n        callback(entry.contentRect);\n      }\n    }\n  });\n\n  observer.observe(container);\n\n  return observer;\n}\n\n// =========================================================================\n// VALIDATION UTILITIES\n// =========================================================================\n\n/**\n * Validate chart data\n *\n * @param {Object} data - Chart data\n * @returns {Object} {isValid, errors}\n */\nexport function validateChartData(data) {\n  const errors = [];\n\n  if (!data || typeof data !== 'object') {\n    errors.push('Chart data must be an object');\n    return { isValid: false, errors };\n  }\n\n  if (!Array.isArray(data.xAxis)) {\n    errors.push('xAxis must be an array');\n  }\n\n  if (!Array.isArray(data.series)) {\n    errors.push('series must be an array');\n  }\n\n  if (data.xAxis && data.series) {\n    data.series.forEach((serie, index) => {\n      if (!Array.isArray(serie.data)) {\n        errors.push(`Series ${index} data must be an array`);\n      } else if (serie.data.length !== data.xAxis.length) {\n        errors.push(`Series ${index} length (${serie.data.length}) doesn't match xAxis (${data.xAxis.length})`);\n      }\n    });\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n// =========================================================================\n// EXPORT ALL\n// =========================================================================\n\nexport default {\n  // Constants\n  ONE_DAY_MS,\n\n  // Theme\n  getThemeColors,\n  setupThemeObserver,\n\n  // Date\n  normalizeDate,\n  formatDate,\n  calculateDateRange,\n  getSortedColumns,\n\n  // Volume\n  buildVolumeLookup,\n  getVolumeForPekerjaan,\n\n  // Harga (Phase 2F.0)\n  buildHargaLookup,\n  getHargaForPekerjaan,\n\n  // Data\n  buildCellValueMap,\n  collectPekerjaanIds,\n\n  // Number\n  formatPercentage,\n  formatRupiah,\n  clamp,\n\n  // Resize\n  createResizeHandler,\n  setupResizeObserver,\n\n  // Validation\n  validateChartData,\n};\n","/**\n * Helpers to ensure Kurva S datasets always start from Week 0 (0% progress).\n */\n\n/**\n * Create zero-week metadata entry for cost datasets.\n * @returns {Object}\n */\nexport function createZeroWeekEntry() {\n  return {\n    week_number: 0,\n    week_start: null,\n    week_end: null,\n    cost: 0,\n    cumulative_cost: 0,\n    cumulative_percent: 0,\n    pekerjaan_breakdown: {},\n  };\n}\n\n/**\n * Prepend zero-week detail information for tooltips / metadata.\n * @param {Array|Object} details\n * @param {string} zeroLabel\n * @param {boolean} isCostView\n * @returns {Array|Object}\n */\nexport function prependZeroDetails(details, zeroLabel, isCostView) {\n  if (Array.isArray(details)) {\n    return [\n      {\n        label: zeroLabel,\n        planned: 0,\n        actual: 0,\n        variance: 0,\n        start: null,\n        end: null,\n        tooltip: zeroLabel,\n        // AUDIT FIX: Include weekNumber for correct tooltip display\n        weekNumber: 0,\n      },\n      ...details,\n    ];\n  }\n\n  if (isCostView && details && typeof details === 'object') {\n    const zeroWeek = createZeroWeekEntry();\n    return {\n      ...details,\n      weeks: Array.isArray(details.weeks) ? [zeroWeek, ...details.weeks] : details.weeks,\n      actualWeeks: Array.isArray(details.actualWeeks) ? [zeroWeek, ...details.actualWeeks] : details.actualWeeks,\n    };\n  }\n\n  return details;\n}\n\n/**\n * Ensure dataset starts with Week 0.\n * @param {Object} dataset\n * @returns {Object}\n */\nexport function ensureWeekZeroDataset(dataset) {\n  if (!dataset || !Array.isArray(dataset.labels) || dataset.labels.length === 0) {\n    return dataset;\n  }\n\n  const firstLabel = String(dataset.labels[0] || '').toLowerCase();\n  if (firstLabel.includes('week 0') || firstLabel === 'w0') {\n    return dataset;\n  }\n\n  const zeroLabel = dataset.viewMode === 'cost' ? 'W0' : 'Week 0';\n  const plannedSeries = Array.isArray(dataset.planned) ? dataset.planned : [];\n  const actualSeries = Array.isArray(dataset.actual) ? dataset.actual : [];\n\n  const updated = {\n    ...dataset,\n    labels: [zeroLabel, ...dataset.labels],\n    planned: [0, ...plannedSeries],\n    actual: [0, ...actualSeries],\n  };\n\n  if (Array.isArray(dataset.acSeries)) {\n    updated.acSeries = [0, ...dataset.acSeries];\n  }\n\n  updated.details = prependZeroDetails(dataset.details, zeroLabel, dataset.viewMode === 'cost');\n\n  return updated;\n}\n\nexport default {\n  ensureWeekZeroDataset,\n  prependZeroDetails,\n  createZeroWeekEntry,\n};\n","import {\n  getSortedColumns,\n  buildVolumeLookup,\n  buildHargaLookup,\n  collectPekerjaanIds,\n  getHargaForPekerjaan,\n  getVolumeForPekerjaan,\n  buildCellValueMap,\n  formatRupiah,\n  normalizeDate,\n} from '../shared/chart-utils.js';\nimport { ensureWeekZeroDataset } from './week-zero-helpers.js';\n\nconst LOG_PREFIX = '[KurvaSDataset]';\n\nexport function buildProgressDataset(state) {\n  const columns = getSortedColumns(state?.timeColumns);\n  if (!columns || columns.length === 0) {\n    console.warn(LOG_PREFIX, 'No time columns available');\n    return null;\n  }\n\n  const volumeLookup = buildVolumeLookup(state);\n  const hargaLookup = buildHargaLookup(state);\n  const stateManager = state?.stateManager;\n\n  let plannedCellValues;\n  let actualCellValues;\n  if (stateManager) {\n    plannedCellValues = stateManager.getAllCellsForMode('planned') || new Map();\n    actualCellValues = stateManager.getAllCellsForMode('actual') || new Map();\n  } else {\n    const plannedState = state?.plannedState || state;\n    const actualState = state?.actualState || state;\n    plannedCellValues = buildCellValueMap(plannedState);\n    actualCellValues = buildCellValueMap(actualState);\n  }\n\n  if (!plannedCellValues || !(plannedCellValues instanceof Map)) {\n    plannedCellValues = new Map();\n  }\n  if (!actualCellValues || !(actualCellValues instanceof Map)) {\n    actualCellValues = new Map();\n  }\n\n  const pekerjaanIds = new Set([\n    ...collectPekerjaanIds(state, plannedCellValues),\n    ...collectPekerjaanIds(state, actualCellValues),\n  ]);\n\n  let totalBiaya = parseFloat(state?.totalBiayaProject || 0);\n  if (!totalBiaya || totalBiaya <= 0) {\n    pekerjaanIds.forEach((id) => {\n      totalBiaya += getHargaForPekerjaan(hargaLookup, id, 0);\n    });\n  }\n  const useHargaCalculation = totalBiaya > 0 && hargaLookup.size > 0;\n\n  let totalVolume = 0;\n  if (!useHargaCalculation) {\n    pekerjaanIds.forEach((id) => {\n      totalVolume += getVolumeForPekerjaan(volumeLookup, id, 1);\n    });\n    if (!Number.isFinite(totalVolume) || totalVolume <= 0) {\n      totalVolume = pekerjaanIds.size || 1;\n    }\n  }\n\n  const columnIndexById = new Map();\n  columns.forEach((col, index) => {\n    columnIndexById.set(String(col.id), index);\n  });\n\n  const labels = generateLabels(columns);\n  const plannedSeries = calculatePlannedCurve(\n    columns,\n    volumeLookup,\n    hargaLookup,\n    plannedCellValues,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualColumnTotals = calculateColumnTotals(\n    columns,\n    actualCellValues,\n    volumeLookup,\n    hargaLookup,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualSeries = calculateActualCurve(\n    columns,\n    actualColumnTotals,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  const details = buildDetailData(\n    columns,\n    labels,\n    plannedSeries,\n    actualSeries,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    details,\n    totalVolume,\n    totalBiaya,\n    columnTotals: actualColumnTotals,\n    useHargaCalculation,\n    viewMode: 'progress',\n  });\n}\n\nexport function buildCostDataset(costData) {\n  if (!costData) {\n    console.error(LOG_PREFIX, 'No cost data available');\n    return null;\n  }\n\n  const weeklyData = costData.weeklyData || {};\n  const summary = costData.summary || {};\n  const evm = costData.evm;\n\n  if (evm && Array.isArray(evm.labels) && evm.labels.length > 0) {\n    const totalCost = evm.summary?.bac || summary?.total_project_cost || 0;\n    const weeklySummary = buildCostWeeklySummary(\n      weeklyData?.planned || [],\n      weeklyData?.actual || [],\n      totalCost,\n      evm.labels\n    );\n    const plannedSeries = evm.pv_percent || [];\n    const actualSeries = evm.ev_percent || [];\n    const acSeries = evm.ac_percent || actualSeries;\n    const varianceSeries = plannedSeries.map((value, index) =>\n      Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n    );\n    const varianceCostSeries = weeklySummary.map((entry) => entry.varianceCostValue || 0);\n    return ensureWeekZeroDataset({\n      labels: evm.labels,\n      planned: plannedSeries,\n      actual: actualSeries,\n      acSeries,\n      varianceSeries,\n      varianceCostSeries,\n      details: {\n        totalCost,\n        weeks: weeklyData?.planned || [],\n        actualWeeks: weeklyData?.actual || [],\n        weeklySummary,\n        evmSummary: evm.summary,\n        evm,\n      },\n      evm,\n      totalBiaya: totalCost,\n      useHargaCalculation: true,\n      viewMode: 'cost',\n    });\n  }\n\n  const labels = (weeklyData.planned || []).map((w) => `W${w.week_number}`);\n  const plannedSeries = (weeklyData.planned || []).map((w) => w.cumulative_percent);\n  const actualSeries = (weeklyData.actual || []).map((w) => w.cumulative_percent);\n  const acSeries = actualSeries.length\n    ? actualSeries\n    : (weeklyData.earned || []).map((w) => w.cumulative_percent);\n  const varianceSeries = plannedSeries.map((value, index) =>\n    Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n  );\n\n  const details = {\n    totalCost: summary?.total_project_cost || 0,\n    plannedCost: summary?.planned_cost || 0,\n    actualCost: summary?.actual_cost || 0,\n    weeks: weeklyData.planned || [],\n    actualWeeks: weeklyData.actual || [],\n    viewMode: 'cost',\n  };\n  const weeklySummary = buildCostWeeklySummary(\n    weeklyData.planned || [],\n    weeklyData.actual || [],\n    details.totalCost,\n    labels\n  );\n\n  console.log(LOG_PREFIX, 'Cost dataset built:', {\n    labels: labels.length,\n    plannedPoints: plannedSeries.length,\n    actualPoints: actualSeries.length,\n    totalCost: formatRupiah(details.totalCost),\n  });\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    acSeries,\n    varianceSeries,\n    varianceCostSeries: weeklySummary.map((entry) => entry.varianceCostValue || 0),\n    details: {\n      ...details,\n      weeklySummary,\n    },\n    totalBiaya: details.totalCost,\n    useHargaCalculation: true,\n    viewMode: 'cost',\n  });\n}\n\nfunction generateLabels(columns) {\n  return columns.map((col, index) => {\n    const label =\n      col?.label ||\n      col?.displayLabel ||\n      col?.display_name ||\n      col?.name ||\n      `Week ${index + 1}`;\n\n    if (col?.start_date && col?.end_date) {\n      return `${label} (${col.start_date} - ${col.end_date})`;\n    }\n\n    return label;\n  });\n}\n\nfunction calculatePlannedCurve(\n  columns,\n  volumeLookup,\n  hargaLookup,\n  cellValues,\n  totalValue,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const plannedTotals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    if (!columnIndexById.has(columnId)) {\n      return;\n    }\n\n    const columnIndex = columnIndexById.get(columnId);\n    if (columnIndex === undefined) {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    }\n  });\n\n  let cumulative = 0;\n  return plannedTotals.map((value) => {\n    cumulative += value;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction calculateColumnTotals(\n  columns,\n  cellValues,\n  volumeLookup,\n  hargaLookup,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const totals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    const columnIndex = columnIndexById.get(columnId);\n    if (typeof columnIndex === 'undefined') {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    }\n  });\n\n  return totals;\n}\n\nfunction calculateActualCurve(columns, columnTotals, totalValue, useHargaCalculation) {\n  let cumulative = 0;\n  return columns.map((_, index) => {\n    cumulative += columnTotals[index] || 0;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction buildDetailData(\n  columns,\n  labels,\n  plannedSeries,\n  actualSeries,\n  totalValue = 0,\n  useHargaCalculation = false\n) {\n  return columns.map((column, index) => {\n    const label = labels[index] || `Week ${index + 1}`;\n\n    // Cumulative values\n    const plannedCumulative = plannedSeries[index] || 0;\n    const actualCumulative = actualSeries[index] || 0;\n\n    // AUDIT FIX: Calculate WEEK progress (this week only, not cumulative)\n    // Week progress = cumulative[i] - cumulative[i-1]\n    const prevPlannedCumulative = index > 0 ? (plannedSeries[index - 1] || 0) : 0;\n    const prevActualCumulative = index > 0 ? (actualSeries[index - 1] || 0) : 0;\n    const plannedWeekProgress = Number((plannedCumulative - prevPlannedCumulative).toFixed(2));\n    const actualWeekProgress = Number((actualCumulative - prevActualCumulative).toFixed(2));\n\n    const variance = Number((actualCumulative - plannedCumulative).toFixed(2));\n    let plannedCostValue = null;\n    let actualCostValue = null;\n    let varianceCostValue = null;\n    if (useHargaCalculation) {\n      plannedCostValue = Number(((plannedCumulative / 100) * (totalValue || 0)).toFixed(2));\n      actualCostValue = Number(((actualCumulative / 100) * (totalValue || 0)).toFixed(2));\n      varianceCostValue = Number(((actualCostValue - plannedCostValue)).toFixed(2));\n    }\n\n    return {\n      label,\n      // Cumulative progress (for chart Y position)\n      planned: plannedCumulative,\n      actual: actualCumulative,\n      // AUDIT FIX: Week-only progress (for tooltip display)\n      plannedWeekProgress,\n      actualWeekProgress,\n      variance,\n      start: normalizeDate(column?.startDate || column?.start_date || column?.start),\n      end: normalizeDate(column?.endDate || column?.end_date || column?.end),\n      metadata: column,\n      plannedCostValue,\n      actualCostValue,\n      varianceCostValue,\n      // AUDIT FIX: Include weekNumber for correct tooltip display\n      weekNumber: column?.weekNumber || column?.week_number || index + 1,\n    };\n  });\n}\n\nfunction buildCostWeeklySummary(plannedWeeks = [], actualWeeks = [], totalCost = 0, labels = []) {\n  const maxLength = Math.max(plannedWeeks.length, actualWeeks.length, labels.length);\n  const summary = [];\n  for (let index = 0; index < maxLength; index += 1) {\n    const plannedEntry = plannedWeeks[index] || {};\n    const actualEntry = actualWeeks[index] || {};\n    const label =\n      labels[index] ||\n      plannedEntry.label ||\n      actualEntry.label ||\n      `W${plannedEntry.week_number || actualEntry.week_number || index + 1}`;\n    const plannedPercent = Number(\n      plannedEntry.cumulative_percent ??\n      plannedEntry.percent ??\n      plannedEntry.value ??\n      plannedEntry.cumulative ??\n      0\n    );\n    const actualPercent = Number(\n      actualEntry.cumulative_percent ??\n      actualEntry.percent ??\n      actualEntry.value ??\n      actualEntry.cumulative ??\n      0\n    );\n    const plannedCostValue = resolveCostValue(plannedEntry, plannedPercent, totalCost);\n    const actualCostValue = resolveCostValue(actualEntry, actualPercent, totalCost);\n    const variancePercent = Number(((actualPercent - plannedPercent)).toFixed(2));\n    const varianceCostValue = Number((actualCostValue - plannedCostValue).toFixed(2));\n\n    summary.push({\n      label,\n      weekNumber: plannedEntry.week_number ?? actualEntry.week_number ?? index + 1,\n      plannedPercent: Number.isFinite(plannedPercent) ? plannedPercent : 0,\n      actualPercent: Number.isFinite(actualPercent) ? actualPercent : 0,\n      plannedCostValue,\n      actualCostValue,\n      variancePercent,\n      varianceCostValue,\n      range: {\n        start: normalizeDate(\n          plannedEntry.week_start ||\n          plannedEntry.start_date ||\n          actualEntry.week_start ||\n          actualEntry.start_date\n        ),\n        end: normalizeDate(\n          plannedEntry.week_end || plannedEntry.end_date || actualEntry.week_end || actualEntry.end_date\n        ),\n      },\n    });\n  }\n  return summary;\n}\n\nfunction resolveCostValue(weekEntry, percent, totalCost) {\n  const numericPercent = Number(\n    percent ??\n    weekEntry?.cumulative_percent ??\n    weekEntry?.percent ??\n    weekEntry?.value ??\n    0\n  );\n  const cumulative = toNumber(\n    weekEntry?.cumulative_cost ??\n    weekEntry?.cumulative ??\n    weekEntry?.accumulated_cost ??\n    weekEntry?.acc_cost\n  );\n  if (Number.isFinite(cumulative) && cumulative > 0) {\n    return cumulative;\n  }\n  const singleCost = toNumber(weekEntry?.cost);\n  if (Number.isFinite(singleCost) && singleCost > 0 && !weekEntry?.cumulative_cost) {\n    return singleCost;\n  }\n  if (!Number.isFinite(totalCost) || totalCost <= 0) {\n    return 0;\n  }\n  return Number((((numericPercent || 0) / 100) * totalCost).toFixed(2));\n}\n\nfunction toNumber(value) {\n  if (typeof value === 'number') {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Number(value);\n    return Number.isFinite(parsed) ? parsed : NaN;\n  }\n  return NaN;\n}\n","/**\r\n * UX Enhancements Module\r\n * Provides keyboard shortcuts, ripple effects, and other UX improvements\r\n * @module ux-enhancements\r\n */\r\n\r\n/**\r\n * Keyboard Shortcuts Manager\r\n */\r\nexport class KeyboardShortcuts {\r\n  constructor() {\r\n    this.shortcuts = new Map();\r\n    this.enabled = true;\r\n    this._boundHandler = this._handleKeyDown.bind(this);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    document.addEventListener('keydown', this._boundHandler);\r\n    console.log('âŒ¨ï¸ Keyboard shortcuts initialized');\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * @param {string} key - Key combination (e.g., 'ctrl+s', 'alt+p')\r\n   * @param {Function} callback - Function to call when shortcut triggered\r\n   * @param {Object} options - Additional options\r\n   */\r\n  register(key, callback, options = {}) {\r\n    const { description = '', preventDefault = true } = options;\r\n\r\n    this.shortcuts.set(key.toLowerCase(), {\r\n      callback,\r\n      description,\r\n      preventDefault\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unregister a keyboard shortcut\r\n   */\r\n  unregister(key) {\r\n    this.shortcuts.delete(key.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  _handleKeyDown(event) {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input/textarea\r\n    const activeElement = document.activeElement;\r\n    const isInput = activeElement.tagName === 'INPUT' ||\r\n                   activeElement.tagName === 'TEXTAREA' ||\r\n                   activeElement.isContentEditable;\r\n\r\n    // Build key combination string\r\n    const parts = [];\r\n    if (event.ctrlKey) parts.push('ctrl');\r\n    if (event.altKey) parts.push('alt');\r\n    if (event.shiftKey) parts.push('shift');\r\n    if (event.metaKey) parts.push('meta');\r\n\r\n    const key = event.key.toLowerCase();\r\n    if (!['control', 'alt', 'shift', 'meta'].includes(key)) {\r\n      parts.push(key);\r\n    }\r\n\r\n    const combo = parts.join('+');\r\n    const shortcut = this.shortcuts.get(combo);\r\n\r\n    if (shortcut) {\r\n      // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X in inputs\r\n      const allowedInInput = ['ctrl+a', 'ctrl+c', 'ctrl+v', 'ctrl+x', 'ctrl+z'];\r\n      if (isInput && !allowedInInput.includes(combo)) {\r\n        return;\r\n      }\r\n\r\n      if (shortcut.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      shortcut.callback(event);\r\n      console.log(`âŒ¨ï¸ Shortcut triggered: ${combo}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable shortcuts\r\n   */\r\n  enable() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * Disable shortcuts\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getShortcuts() {\r\n    return Array.from(this.shortcuts.entries()).map(([key, data]) => ({\r\n      key,\r\n      description: data.description\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    document.removeEventListener('keydown', this._boundHandler);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n/**\r\n * Ripple Effect Manager\r\n */\r\nexport class RippleEffect {\r\n  /**\r\n   * Add ripple effect to element\r\n   * @param {HTMLElement} element - Target element\r\n   */\r\n  static add(element) {\r\n    if (!element) return;\r\n\r\n    element.classList.add('btn-ripple');\r\n\r\n    // Optional: Add click listener for more control\r\n    element.addEventListener('click', function(e) {\r\n      const ripple = document.createElement('span');\r\n      ripple.classList.add('ripple-circle');\r\n\r\n      const rect = this.getBoundingClientRect();\r\n      const size = Math.max(rect.width, rect.height);\r\n      const x = e.clientX - rect.left - size / 2;\r\n      const y = e.clientY - rect.top - size / 2;\r\n\r\n      ripple.style.width = ripple.style.height = size + 'px';\r\n      ripple.style.left = x + 'px';\r\n      ripple.style.top = y + 'px';\r\n\r\n      this.appendChild(ripple);\r\n\r\n      setTimeout(() => ripple.remove(), 600);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add ripple to multiple elements\r\n   * @param {string} selector - CSS selector\r\n   */\r\n  static addToAll(selector) {\r\n    document.querySelectorAll(selector).forEach(el => {\r\n      RippleEffect.add(el);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Button State Manager\r\n */\r\nexport class ButtonStateManager {\r\n  /**\r\n   * Set button to loading state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {string} loadingText - Optional loading text\r\n   */\r\n  static setLoading(button, loadingText = 'Loading...') {\r\n    if (!button) return;\r\n\r\n    button.dataset.originalText = button.innerHTML;\r\n    button.disabled = true;\r\n    button.classList.add('loading');\r\n\r\n    const spinner = '<span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>';\r\n    button.innerHTML = spinner + loadingText;\r\n  }\r\n\r\n  /**\r\n   * Set button to success state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show success state (ms)\r\n   */\r\n  static setSuccess(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('success');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('success');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Set button to error state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show error state (ms)\r\n   */\r\n  static setError(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('error');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Reset button to normal state\r\n   * @param {HTMLElement} button - Button element\r\n   */\r\n  static reset(button) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading', 'success', 'error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark button with \"has changes\" indicator\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} hasChanges - Whether there are unsaved changes\r\n   */\r\n  static markChanges(button, hasChanges) {\r\n    if (!button) return;\r\n\r\n    if (hasChanges) {\r\n      button.classList.add('has-changes');\r\n      button.setAttribute('data-tooltip', 'You have unsaved changes');\r\n    } else {\r\n      button.classList.remove('has-changes');\r\n      button.removeAttribute('data-tooltip');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toast Notifications (wrapper untuk DP.core.toast)\r\n */\r\nexport class Toast {\r\n  /**\r\n   * Show success toast\r\n   */\r\n  static success(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'success', duration);\r\n    } else {\r\n      console.log(`âœ… ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error toast\r\n   */\r\n  static error(message, duration = 3000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'danger', duration);\r\n    } else {\r\n      console.error(`âŒ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show warning toast\r\n   */\r\n  static warning(message, duration = 2000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'warning', duration);\r\n    } else {\r\n      console.warn(`âš ï¸ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show info toast\r\n   */\r\n  static info(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'info', duration);\r\n    } else {\r\n      console.info(`â„¹ï¸ ${message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Smooth Scroll Helper\r\n */\r\nexport class SmoothScroll {\r\n  /**\r\n   * Scroll to element smoothly\r\n   * @param {HTMLElement|string} target - Element or selector\r\n   * @param {Object} options - Scroll options\r\n   */\r\n  static to(target, options = {}) {\r\n    const element = typeof target === 'string'\r\n      ? document.querySelector(target)\r\n      : target;\r\n\r\n    if (!element) return;\r\n\r\n    const {\r\n      offset = 0,\r\n      behavior = 'smooth',\r\n      block = 'start'\r\n    } = options;\r\n\r\n    const elementPosition = element.getBoundingClientRect().top;\r\n    const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n    window.scrollTo({\r\n      top: offsetPosition,\r\n      behavior\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Scroll to top\r\n   */\r\n  static toTop() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      behavior: 'smooth'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce utility\r\n */\r\nexport function debounce(func, wait = 300) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle utility\r\n */\r\nexport function throttle(func, limit = 100) {\r\n  let inThrottle;\r\n  return function executedFunction(...args) {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize all UX enhancements\r\n */\r\nexport function initializeUXEnhancements() {\r\n  console.log('ðŸŽ¨ Initializing UX enhancements...');\r\n\r\n  // Add ripple effects to all primary buttons\r\n  RippleEffect.addToAll('.btn-primary, .btn-save, .btn-danger');\r\n\r\n  // Add tooltips to buttons with title attribute\r\n  document.querySelectorAll('button[title]').forEach(btn => {\r\n    if (!btn.hasAttribute('data-tooltip')) {\r\n      btn.setAttribute('data-tooltip', btn.getAttribute('title'));\r\n    }\r\n  });\r\n\r\n  console.log('âœ… UX enhancements initialized');\r\n}\r\n\r\n/**\r\n * Default export\r\n */\r\nexport default {\r\n  KeyboardShortcuts,\r\n  RippleEffect,\r\n  ButtonStateManager,\r\n  Toast,\r\n  SmoothScroll,\r\n  debounce,\r\n  throttle,\r\n  initializeUXEnhancements\r\n};\r\n","/**\n* Copyright (c) 2025, Leon Sorokin\n* All rights reserved. (MIT Licensed)\n*\n* uPlot.js (Î¼Plot)\n* A small, fast chart for time series, lines, areas, ohlc & bars\n* https://github.com/leeoniya/uPlot (v1.6.32)\n*/\n\nconst FEAT_TIME          = true;\n\nconst pre = \"u-\";\n\nconst UPLOT          =       \"uplot\";\nconst ORI_HZ         = pre + \"hz\";\nconst ORI_VT         = pre + \"vt\";\nconst TITLE          = pre + \"title\";\nconst WRAP           = pre + \"wrap\";\nconst UNDER          = pre + \"under\";\nconst OVER           = pre + \"over\";\nconst AXIS           = pre + \"axis\";\nconst OFF            = pre + \"off\";\nconst SELECT         = pre + \"select\";\nconst CURSOR_X       = pre + \"cursor-x\";\nconst CURSOR_Y       = pre + \"cursor-y\";\nconst CURSOR_PT      = pre + \"cursor-pt\";\nconst LEGEND         = pre + \"legend\";\nconst LEGEND_LIVE    = pre + \"live\";\nconst LEGEND_INLINE  = pre + \"inline\";\nconst LEGEND_SERIES  = pre + \"series\";\nconst LEGEND_MARKER  = pre + \"marker\";\nconst LEGEND_LABEL   = pre + \"label\";\nconst LEGEND_VALUE   = pre + \"value\";\n\nconst WIDTH       = \"width\";\nconst HEIGHT      = \"height\";\nconst TOP         = \"top\";\nconst BOTTOM      = \"bottom\";\nconst LEFT        = \"left\";\nconst RIGHT       = \"right\";\nconst hexBlack    = \"#000\";\nconst transparent = hexBlack + \"0\";\n\nconst mousemove   = \"mousemove\";\nconst mousedown   = \"mousedown\";\nconst mouseup     = \"mouseup\";\nconst mouseenter  = \"mouseenter\";\nconst mouseleave  = \"mouseleave\";\nconst dblclick    = \"dblclick\";\nconst resize      = \"resize\";\nconst scroll      = \"scroll\";\n\nconst change      = \"change\";\nconst dppxchange  = \"dppxchange\";\n\nconst LEGEND_DISP = \"--\";\n\nconst domEnv = typeof window != 'undefined';\n\nconst doc = domEnv ? document  : null;\nconst win = domEnv ? window    : null;\nconst nav = domEnv ? navigator : null;\n\nlet pxRatio;\n\n//export const canHover = domEnv && !win.matchMedia('(hover: none)').matches;\n\nlet query;\n\nfunction setPxRatio() {\n\tlet _pxRatio = devicePixelRatio;\n\n\t// during print preview, Chrome fires off these dppx queries even without changes\n\tif (pxRatio != _pxRatio) {\n\t\tpxRatio = _pxRatio;\n\n\t\tquery && off(change, query, setPxRatio);\n\t\tquery = matchMedia(`(min-resolution: ${pxRatio - 0.001}dppx) and (max-resolution: ${pxRatio + 0.001}dppx)`);\n\t\ton(change, query, setPxRatio);\n\n\t\twin.dispatchEvent(new CustomEvent(dppxchange));\n\t}\n}\n\nfunction addClass(el, c) {\n\tif (c != null) {\n\t\tlet cl = el.classList;\n\t\t!cl.contains(c) && cl.add(c);\n\t}\n}\n\nfunction remClass(el, c) {\n\tlet cl = el.classList;\n\tcl.contains(c) && cl.remove(c);\n}\n\nfunction setStylePx(el, name, value) {\n\tel.style[name] = value + \"px\";\n}\n\nfunction placeTag(tag, cls, targ, refEl) {\n\tlet el = doc.createElement(tag);\n\n\tif (cls != null)\n\t\taddClass(el, cls);\n\n\tif (targ != null)\n\t\ttarg.insertBefore(el, refEl);\n\n\treturn el;\n}\n\nfunction placeDiv(cls, targ) {\n\treturn placeTag(\"div\", cls, targ);\n}\n\nconst xformCache = new WeakMap();\n\nfunction elTrans(el, xPos, yPos, xMax, yMax) {\n\tlet xform = \"translate(\" + xPos + \"px,\" + yPos + \"px)\";\n\tlet xformOld = xformCache.get(el);\n\n\tif (xform != xformOld) {\n\t\tel.style.transform = xform;\n\t\txformCache.set(el, xform);\n\n\t\tif (xPos < 0 || yPos < 0 || xPos > xMax || yPos > yMax)\n\t\t\taddClass(el, OFF);\n\t\telse\n\t\t\tremClass(el, OFF);\n\t}\n}\n\nconst colorCache = new WeakMap();\n\nfunction elColor(el, background, borderColor) {\n\tlet newColor = background + borderColor;\n\tlet oldColor = colorCache.get(el);\n\n\tif (newColor != oldColor) {\n\t\tcolorCache.set(el, newColor);\n\t\tel.style.background = background;\n\t\tel.style.borderColor = borderColor;\n\t}\n}\n\nconst sizeCache = new WeakMap();\n\nfunction elSize(el, newWid, newHgt, centered) {\n\tlet newSize = newWid + \"\" + newHgt;\n\tlet oldSize = sizeCache.get(el);\n\n\tif (newSize != oldSize) {\n\t\tsizeCache.set(el, newSize);\n\t\tel.style.height = newHgt + \"px\";\n\t\tel.style.width = newWid + \"px\";\n\t\tel.style.marginLeft = centered ? -newWid/2 + \"px\" : 0;\n\t\tel.style.marginTop = centered ? -newHgt/2 + \"px\" : 0;\n\t}\n}\n\nconst evOpts = {passive: true};\nconst evOpts2 = {...evOpts, capture: true};\n\nfunction on(ev, el, cb, capt) {\n\tel.addEventListener(ev, cb, capt ? evOpts2 : evOpts);\n}\n\nfunction off(ev, el, cb, capt) {\n\tel.removeEventListener(ev, cb, evOpts);\n}\n\ndomEnv && setPxRatio();\n\n// binary search for index of closest value\nfunction closestIdx(num, arr, lo, hi) {\n\tlet mid;\n\tlo = lo || 0;\n\thi = hi || arr.length - 1;\n\tlet bitwise = hi <= 2147483647;\n\n\twhile (hi - lo > 1) {\n\t\tmid = bitwise ? (lo + hi) >> 1 : floor((lo + hi) / 2);\n\n\t\tif (arr[mid] < num)\n\t\t\tlo = mid;\n\t\telse\n\t\t\thi = mid;\n\t}\n\n\tif (num - arr[lo] <= arr[hi] - num)\n\t\treturn lo;\n\n\treturn hi;\n}\n\nfunction makeIndexOfs(predicate) {\n\t let indexOfs = (data, _i0, _i1) => {\n\t\tlet i0 = -1;\n\t\tlet i1 = -1;\n\n\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti0 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = _i1; i >= _i0; i--) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti1 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn [i0, i1];\n\t };\n\n\t return indexOfs;\n}\n\nconst notNullish = v => v != null;\nconst isPositive = v => v != null && v > 0;\n\nconst nonNullIdxs = makeIndexOfs(notNullish);\nconst positiveIdxs = makeIndexOfs(isPositive);\n\nfunction getMinMax(data, _i0, _i1, sorted = 0, log = false) {\n//\tconsole.log(\"getMinMax()\");\n\n\tlet getEdgeIdxs = log ? positiveIdxs : nonNullIdxs;\n\tlet predicate = log ? isPositive : notNullish;\n\n\t[_i0, _i1] = getEdgeIdxs(data, _i0, _i1);\n\n\tlet _min = data[_i0];\n\tlet _max = data[_i0];\n\n\tif (_i0 > -1) {\n\t\tif (sorted == 1) {\n\t\t\t_min = data[_i0];\n\t\t\t_max = data[_i1];\n\t\t}\n\t\telse if (sorted == -1) {\n\t\t\t_min = data[_i1];\n\t\t\t_max = data[_i0];\n\t\t}\n\t\telse {\n\t\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\t\tlet v = data[i];\n\n\t\t\t\tif (predicate(v)) {\n\t\t\t\t\tif (v < _min)\n\t\t\t\t\t\t_min = v;\n\t\t\t\t\telse if (v > _max)\n\t\t\t\t\t\t_max = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [_min ?? inf, _max ?? -inf]; // todo: fix to return nulls\n}\n\nfunction rangeLog(min, max, base, fullMags) {\n\tlet minSign = sign(min);\n\tlet maxSign = sign(max);\n\n\tif (min == max) {\n\t\tif (minSign == -1) {\n\t\t\tmin *= base;\n\t\t\tmax /= base;\n\t\t}\n\t\telse {\n\t\t\tmin /= base;\n\t\t\tmax *= base;\n\t\t}\n\t}\n\n\tlet logFn = base == 10 ? log10 : log2;\n\n\tlet growMinAbs = minSign == 1 ? floor : ceil;\n\tlet growMaxAbs = maxSign == 1 ? ceil : floor;\n\n\tlet minExp = growMinAbs(logFn(abs(min)));\n\tlet maxExp = growMaxAbs(logFn(abs(max)));\n\n\tlet minIncr = pow(base, minExp);\n\tlet maxIncr = pow(base, maxExp);\n\n\t// fix values like Math.pow(10, -5) === 0.000009999999999999999\n\tif (base == 10) {\n\t\tif (minExp < 0)\n\t\t\tminIncr = roundDec(minIncr, -minExp);\n\t\tif (maxExp < 0)\n\t\t\tmaxIncr = roundDec(maxIncr, -maxExp);\n\t}\n\n\tif (fullMags || base == 2) {\n\t\tmin = minIncr * minSign;\n\t\tmax = maxIncr * maxSign;\n\t}\n\telse {\n\t\tmin = incrRoundDn(min, minIncr);\n\t\tmax = incrRoundUp(max, maxIncr);\n\t}\n\n\treturn [min, max];\n}\n\nfunction rangeAsinh(min, max, base, fullMags) {\n\tlet minMax = rangeLog(min, max, base, fullMags);\n\n\tif (min == 0)\n\t\tminMax[0] = 0;\n\n\tif (max == 0)\n\t\tminMax[1] = 0;\n\n\treturn minMax;\n}\n\nconst rangePad = 0.1;\n\nconst autoRangePart = {\n\tmode: 3,\n\tpad: rangePad,\n};\n\nconst _eqRangePart = {\n\tpad:  0,\n\tsoft: null,\n\tmode: 0,\n};\n\nconst _eqRange = {\n\tmin: _eqRangePart,\n\tmax: _eqRangePart,\n};\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction rangeNum(_min, _max, mult, extra) {\n\tif (isObj(mult))\n\t\treturn _rangeNum(_min, _max, mult);\n\n\t_eqRangePart.pad  = mult;\n\t_eqRangePart.soft = extra ? 0 : null;\n\t_eqRangePart.mode = extra ? 3 : 0;\n\n\treturn _rangeNum(_min, _max, _eqRange);\n}\n\n// nullish coalesce\nfunction ifNull(lh, rh) {\n\treturn lh == null ? rh : lh;\n}\n\n// checks if given index range in an array contains a non-null value\n// aka a range-bounded Array.some()\nfunction hasData(data, idx0, idx1) {\n\tidx0 = ifNull(idx0, 0);\n\tidx1 = ifNull(idx1, data.length - 1);\n\n\twhile (idx0 <= idx1) {\n\t\tif (data[idx0] != null)\n\t\t\treturn true;\n\t\tidx0++;\n\t}\n\n\treturn false;\n}\n\nfunction _rangeNum(_min, _max, cfg) {\n\tlet cmin = cfg.min;\n\tlet cmax = cfg.max;\n\n\tlet padMin = ifNull(cmin.pad, 0);\n\tlet padMax = ifNull(cmax.pad, 0);\n\n\tlet hardMin = ifNull(cmin.hard, -inf);\n\tlet hardMax = ifNull(cmax.hard,  inf);\n\n\tlet softMin = ifNull(cmin.soft,  inf);\n\tlet softMax = ifNull(cmax.soft, -inf);\n\n\tlet softMinMode = ifNull(cmin.mode, 0);\n\tlet softMaxMode = ifNull(cmax.mode, 0);\n\n\tlet delta = _max - _min;\n\tlet deltaMag = log10(delta);\n\n\tlet scalarMax = max(abs(_min), abs(_max));\n\tlet scalarMag = log10(scalarMax);\n\n\tlet scalarMagDelta = abs(scalarMag - deltaMag);\n\n\t// this handles situations like 89.7, 89.69999999999999\n\t// by assuming 0.001x deltas are precision errors\n//\tif (delta > 0 && delta < abs(_max) / 1e3)\n//\t\tdelta = 0;\n\n\t// treat data as flat if delta is less than 1e-24\n\t// or range is 11+ orders of magnitude below raw values, e.g. 99999999.99999996 - 100000000.00000004\n\tif (delta < 1e-24 || scalarMagDelta > 10) {\n\t\tdelta = 0;\n\n\t\t// if soft mode is 2 and all vals are flat at 0, avoid the 0.1 * 1e3 fallback\n\t\t// this prevents 0,0,0 from ranging to -100,100 when softMin/softMax are -1,1\n\t\tif (_min == 0 || _max == 0) {\n\t\t\tdelta = 1e-24;\n\n\t\t\tif (softMinMode == 2 && softMin != inf)\n\t\t\t\tpadMin = 0;\n\n\t\t\tif (softMaxMode == 2 && softMax != -inf)\n\t\t\t\tpadMax = 0;\n\t\t}\n\t}\n\n\tlet nonZeroDelta = delta || scalarMax || 1e3;\n\tlet mag          = log10(nonZeroDelta);\n\tlet base         = pow(10, floor(mag));\n\n\tlet _padMin  = nonZeroDelta * (delta == 0 ? (_min == 0 ? .1 : 1) : padMin);\n\tlet _newMin  = roundDec(incrRoundDn(_min - _padMin, base/10), 24);\n\tlet _softMin = _min >= softMin && (softMinMode == 1 || softMinMode == 3 && _newMin <= softMin || softMinMode == 2 && _newMin >= softMin) ? softMin : inf;\n\tlet minLim   = max(hardMin, _newMin < _softMin && _min >= _softMin ? _softMin : min(_softMin, _newMin));\n\n\tlet _padMax  = nonZeroDelta * (delta == 0 ? (_max == 0 ? .1 : 1) : padMax);\n\tlet _newMax  = roundDec(incrRoundUp(_max + _padMax, base/10), 24);\n\tlet _softMax = _max <= softMax && (softMaxMode == 1 || softMaxMode == 3 && _newMax >= softMax || softMaxMode == 2 && _newMax <= softMax) ? softMax : -inf;\n\tlet maxLim   = min(hardMax, _newMax > _softMax && _max <= _softMax ? _softMax : max(_softMax, _newMax));\n\n\tif (minLim == maxLim && minLim == 0)\n\t\tmaxLim = 100;\n\n\treturn [minLim, maxLim];\n}\n\n// alternative: https://stackoverflow.com/a/2254896\nconst numFormatter = new Intl.NumberFormat(domEnv ? nav.language : 'en-US');\nconst fmtNum = val => numFormatter.format(val);\n\nconst M = Math;\n\nconst PI = M.PI;\nconst abs = M.abs;\nconst floor = M.floor;\nconst round = M.round;\nconst ceil = M.ceil;\nconst min = M.min;\nconst max = M.max;\nconst pow = M.pow;\nconst sign = M.sign;\nconst log10 = M.log10;\nconst log2 = M.log2;\n// TODO: seems like this needs to match asinh impl if the passed v is tweaked?\nconst sinh =  (v, linthresh = 1) => M.sinh(v) * linthresh;\nconst asinh = (v, linthresh = 1) => M.asinh(v / linthresh);\n\nconst inf = Infinity;\n\nfunction numIntDigits(x) {\n\treturn (log10((x ^ (x >> 31)) - (x >> 31)) | 0) + 1;\n}\n\nfunction clamp(num, _min, _max) {\n\treturn min(max(num, _min), _max);\n}\n\nfunction isFn(v) {\n\treturn typeof v == \"function\";\n}\n\nfunction fnOrSelf(v) {\n\treturn isFn(v) ? v : () => v;\n}\n\nconst noop = () => {};\n\n// note: these identity fns may get deoptimized if reused for different arg types\n// a TS version would enforce they stay monotyped and require making variants\nconst retArg0 = _0 => _0;\n\nconst retArg1 = (_0, _1) => _1;\n\nconst retNull = _ => null;\n\nconst retTrue = _ => true;\n\nconst retEq = (a, b) => a == b;\n\nconst regex6 = /\\.\\d*?(?=9{6,}|0{6,})/gm;\n\n// e.g. 17999.204999999998 -> 17999.205\nconst fixFloat = val => {\n\tif (isInt(val) || fixedDec.has(val))\n\t\treturn val;\n\n\tconst str = `${val}`;\n\n\tconst match = str.match(regex6);\n\n\tif (match == null)\n\t\treturn val;\n\n\tlet len = match[0].length - 1;\n\n\t// e.g. 1.0000000000000001e-24\n\tif (str.indexOf('e-') != -1) {\n\t\tlet [num, exp] = str.split('e');\n\t\treturn +`${fixFloat(num)}e${exp}`;\n\t}\n\n\treturn roundDec(val, len);\n};\n\nfunction incrRound(num, incr) {\n\treturn fixFloat(roundDec(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundUp(num, incr) {\n\treturn fixFloat(ceil(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundDn(num, incr) {\n\treturn fixFloat(floor(fixFloat(num/incr))*incr);\n}\n\n// https://stackoverflow.com/a/48764436\n// rounds half away from zero\nfunction roundDec(val, dec = 0) {\n\tif (isInt(val))\n\t\treturn val;\n//\telse if (dec == 0)\n//\t\treturn round(val);\n\n\tlet p = 10 ** dec;\n\tlet n = (val * p) * (1 + Number.EPSILON);\n\treturn round(n) / p;\n}\n\nconst fixedDec = new Map();\n\nfunction guessDec(num) {\n\treturn ((\"\"+num).split(\".\")[1] || \"\").length;\n}\n\nfunction genIncrs(base, minExp, maxExp, mults) {\n\tlet incrs = [];\n\n\tlet multDec = mults.map(guessDec);\n\n\tfor (let exp = minExp; exp < maxExp; exp++) {\n\t\tlet expa = abs(exp);\n\t\tlet mag = roundDec(pow(base, exp), expa);\n\n\t\tfor (let i = 0; i < mults.length; i++) {\n\t\t\tlet _incr = base == 10 ? +`${mults[i]}e${exp}` : mults[i] * mag;\n\t\t\tlet dec = (exp >= 0 ? 0 : expa) + (exp >= multDec[i] ? 0 : multDec[i]);\n\t\t\tlet incr = base == 10 ? _incr : roundDec(_incr, dec);\n\t\t\tincrs.push(incr);\n\t\t\tfixedDec.set(incr, dec);\n\t\t}\n\t}\n\n\treturn incrs;\n}\n\n//export const assign = Object.assign;\n\nconst EMPTY_OBJ = {};\nconst EMPTY_ARR = [];\n\nconst nullNullTuple = [null, null];\n\nconst isArr = Array.isArray;\nconst isInt = Number.isInteger;\nconst isUndef = v => v === void 0;\n\nfunction isStr(v) {\n\treturn typeof v == 'string';\n}\n\nfunction isObj(v) {\n\tlet is = false;\n\n\tif (v != null) {\n\t\tlet c = v.constructor;\n\t\tis = c == null || c == Object;\n\t}\n\n\treturn is;\n}\n\nfunction fastIsObj(v) {\n\treturn v != null && typeof v == 'object';\n}\n\nconst TypedArray = Object.getPrototypeOf(Uint8Array);\n\nconst __proto__ = \"__proto__\";\n\nfunction copy(o, _isObj = isObj) {\n\tlet out;\n\n\tif (isArr(o)) {\n\t\tlet val = o.find(v => v != null);\n\n\t\tif (isArr(val) || _isObj(val)) {\n\t\t\tout = Array(o.length);\n\t\t\tfor (let i = 0; i < o.length; i++)\n\t\t\t\tout[i] = copy(o[i], _isObj);\n\t\t}\n\t\telse\n\t\t\tout = o.slice();\n\t}\n\telse if (o instanceof TypedArray) // also (ArrayBuffer.isView(o) && !(o instanceof DataView))\n\t\tout = o.slice();\n\telse if (_isObj(o)) {\n\t\tout = {};\n\t\tfor (let k in o) {\n\t\t\tif (k != __proto__)\n\t\t\t\tout[k] = copy(o[k], _isObj);\n\t\t}\n\t}\n\telse\n\t\tout = o;\n\n\treturn out;\n}\n\nfunction assign(targ) {\n\tlet args = arguments;\n\n\tfor (let i = 1; i < args.length; i++) {\n\t\tlet src = args[i];\n\n\t\tfor (let key in src) {\n\t\t\tif (key != __proto__) {\n\t\t\t\tif (isObj(targ[key]))\n\t\t\t\t\tassign(targ[key], copy(src[key]));\n\t\t\t\telse\n\t\t\t\t\ttarg[key] = copy(src[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn targ;\n}\n\n// nullModes\nconst NULL_REMOVE = 0;  // nulls are converted to undefined (e.g. for spanGaps: true)\nconst NULL_RETAIN = 1;  // nulls are retained, with alignment artifacts set to undefined (default)\nconst NULL_EXPAND = 2;  // nulls are expanded to include any adjacent alignment artifacts\n\n// sets undefined values to nulls when adjacent to existing nulls (minesweeper)\nfunction nullExpand(yVals, nullIdxs, alignedLen) {\n\tfor (let i = 0, xi, lastNullIdx = -1; i < nullIdxs.length; i++) {\n\t\tlet nullIdx = nullIdxs[i];\n\n\t\tif (nullIdx > lastNullIdx) {\n\t\t\txi = nullIdx - 1;\n\t\t\twhile (xi >= 0 && yVals[xi] == null)\n\t\t\t\tyVals[xi--] = null;\n\n\t\t\txi = nullIdx + 1;\n\t\t\twhile (xi < alignedLen && yVals[xi] == null)\n\t\t\t\tyVals[lastNullIdx = xi++] = null;\n\t\t}\n\t}\n}\n\n// nullModes is a tables-matched array indicating how to treat nulls in each series\n// output is sorted ASC on the joined field (table[0]) and duplicate join values are collapsed\nfunction join(tables, nullModes) {\n\tif (allHeadersSame(tables)) {\n\t//\tconsole.log('cheap join!');\n\n\t\tlet table = tables[0].slice();\n\n\t\tfor (let i = 1; i < tables.length; i++)\n\t\t\ttable.push(...tables[i].slice(1));\n\n\t\tif (!isAsc(table[0]))\n\t\t\ttable = sortCols(table);\n\n\t\treturn table;\n\t}\n\n\tlet xVals = new Set();\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\t\tlet len = xs.length;\n\n\t\tfor (let i = 0; i < len; i++)\n\t\t\txVals.add(xs[i]);\n\t}\n\n\tlet data = [Array.from(xVals).sort((a, b) => a - b)];\n\n\tlet alignedLen = data[0].length;\n\n\tlet xIdxs = new Map();\n\n\tfor (let i = 0; i < alignedLen; i++)\n\t\txIdxs.set(data[0][i], i);\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\n\t\tfor (let si = 1; si < t.length; si++) {\n\t\t\tlet ys = t[si];\n\n\t\t\tlet yVals = Array(alignedLen).fill(undefined);\n\n\t\t\tlet nullMode = nullModes ? nullModes[ti][si] : NULL_RETAIN;\n\n\t\t\tlet nullIdxs = [];\n\n\t\t\tfor (let i = 0; i < ys.length; i++) {\n\t\t\t\tlet yVal = ys[i];\n\t\t\t\tlet alignedIdx = xIdxs.get(xs[i]);\n\n\t\t\t\tif (yVal === null) {\n\t\t\t\t\tif (nullMode != NULL_REMOVE) {\n\t\t\t\t\t\tyVals[alignedIdx] = yVal;\n\n\t\t\t\t\t\tif (nullMode == NULL_EXPAND)\n\t\t\t\t\t\t\tnullIdxs.push(alignedIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tyVals[alignedIdx] = yVal;\n\t\t\t}\n\n\t\t\tnullExpand(yVals, nullIdxs, alignedLen);\n\n\t\t\tdata.push(yVals);\n\t\t}\n\t}\n\n\treturn data;\n}\n\nconst microTask = typeof queueMicrotask == \"undefined\" ? fn => Promise.resolve().then(fn) : queueMicrotask;\n\n// TODO: https://github.com/dy/sort-ids (~2x faster for 1e5+ arrays)\nfunction sortCols(table) {\n\tlet head = table[0];\n\tlet rlen = head.length;\n\n\tlet idxs = Array(rlen);\n\tfor (let i = 0; i < idxs.length; i++)\n\t\tidxs[i] = i;\n\n\tidxs.sort((i0, i1) => head[i0] - head[i1]);\n\n\tlet table2 = [];\n\tfor (let i = 0; i < table.length; i++) {\n\t\tlet row = table[i];\n\t\tlet row2 = Array(rlen);\n\n\t\tfor (let j = 0; j < rlen; j++)\n\t\t\trow2[j] = row[idxs[j]];\n\n\t\ttable2.push(row2);\n\t}\n\n\treturn table2;\n}\n\n// test if we can do cheap join (all join fields same)\nfunction allHeadersSame(tables) {\n\tlet vals0 = tables[0][0];\n\tlet len0 = vals0.length;\n\n\tfor (let i = 1; i < tables.length; i++) {\n\t\tlet vals1 = tables[i][0];\n\n\t\tif (vals1.length != len0)\n\t\t\treturn false;\n\n\t\tif (vals1 != vals0) {\n\t\t\tfor (let j = 0; j < len0; j++) {\n\t\t\t\tif (vals1[j] != vals0[j])\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction isAsc(vals, samples = 100) {\n\tconst len = vals.length;\n\n\t// empty or single value\n\tif (len <= 1)\n\t\treturn true;\n\n\t// skip leading & trailing nullish\n\tlet firstIdx = 0;\n\tlet lastIdx = len - 1;\n\n\twhile (firstIdx <= lastIdx && vals[firstIdx] == null)\n\t\tfirstIdx++;\n\n\twhile (lastIdx >= firstIdx && vals[lastIdx] == null)\n\t\tlastIdx--;\n\n\t// all nullish or one value surrounded by nullish\n\tif (lastIdx <= firstIdx)\n\t\treturn true;\n\n\tconst stride = max(1, floor((lastIdx - firstIdx + 1) / samples));\n\n\tfor (let prevVal = vals[firstIdx], i = firstIdx + stride; i <= lastIdx; i += stride) {\n\t\tconst v = vals[i];\n\n\t\tif (v != null) {\n\t\t\tif (v <= prevVal)\n\t\t\t\treturn false;\n\n\t\t\tprevVal = v;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nconst months = [\n\t\"January\",\n\t\"February\",\n\t\"March\",\n\t\"April\",\n\t\"May\",\n\t\"June\",\n\t\"July\",\n\t\"August\",\n\t\"September\",\n\t\"October\",\n\t\"November\",\n\t\"December\",\n];\n\nconst days = [\n\t\"Sunday\",\n\t\"Monday\",\n\t\"Tuesday\",\n\t\"Wednesday\",\n\t\"Thursday\",\n\t\"Friday\",\n\t\"Saturday\",\n];\n\nfunction slice3(str) {\n\treturn str.slice(0, 3);\n}\n\nconst days3 = days.map(slice3);\n\nconst months3 = months.map(slice3);\n\nconst engNames = {\n\tMMMM: months,\n\tMMM:  months3,\n\tWWWW: days,\n\tWWW:  days3,\n};\n\nfunction zeroPad2(int) {\n\treturn (int < 10 ? '0' : '') + int;\n}\n\nfunction zeroPad3(int) {\n\treturn (int < 10 ? '00' : int < 100 ? '0' : '') + int;\n}\n\n/*\nfunction suffix(int) {\n\tlet mod10 = int % 10;\n\n\treturn int + (\n\t\tmod10 == 1 && int != 11 ? \"st\" :\n\t\tmod10 == 2 && int != 12 ? \"nd\" :\n\t\tmod10 == 3 && int != 13 ? \"rd\" : \"th\"\n\t);\n}\n*/\n\nconst subs = {\n\t// 2019\n\tYYYY:\td => d.getFullYear(),\n\t// 19\n\tYY:\t\td => (d.getFullYear()+'').slice(2),\n\t// July\n\tMMMM:\t(d, names) => names.MMMM[d.getMonth()],\n\t// Jul\n\tMMM:\t(d, names) => names.MMM[d.getMonth()],\n\t// 07\n\tMM:\t\td => zeroPad2(d.getMonth()+1),\n\t// 7\n\tM:\t\td => d.getMonth()+1,\n\t// 09\n\tDD:\t\td => zeroPad2(d.getDate()),\n\t// 9\n\tD:\t\td => d.getDate(),\n\t// Monday\n\tWWWW:\t(d, names) => names.WWWW[d.getDay()],\n\t// Mon\n\tWWW:\t(d, names) => names.WWW[d.getDay()],\n\t// 03\n\tHH:\t\td => zeroPad2(d.getHours()),\n\t// 3\n\tH:\t\td => d.getHours(),\n\t// 9 (12hr, unpadded)\n\th:\t\td => {let h = d.getHours(); return h == 0 ? 12 : h > 12 ? h - 12 : h;},\n\t// AM\n\tAA:\t\td => d.getHours() >= 12 ? 'PM' : 'AM',\n\t// am\n\taa:\t\td => d.getHours() >= 12 ? 'pm' : 'am',\n\t// a\n\ta:\t\td => d.getHours() >= 12 ? 'p' : 'a',\n\t// 09\n\tmm:\t\td => zeroPad2(d.getMinutes()),\n\t// 9\n\tm:\t\td => d.getMinutes(),\n\t// 09\n\tss:\t\td => zeroPad2(d.getSeconds()),\n\t// 9\n\ts:\t\td => d.getSeconds(),\n\t// 374\n\tfff:\td => zeroPad3(d.getMilliseconds()),\n};\n\nfunction fmtDate(tpl, names) {\n\tnames = names || engNames;\n\tlet parts = [];\n\n\tlet R = /\\{([a-z]+)\\}|[^{]+/gi, m;\n\n\twhile (m = R.exec(tpl))\n\t\tparts.push(m[0][0] == '{' ? subs[m[1]] : m[0]);\n\n\treturn d => {\n\t\tlet out = '';\n\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t\tout += typeof parts[i] == \"string\" ? parts[i] : parts[i](d, names);\n\n\t\treturn out;\n\t}\n}\n\nconst localTz = new Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n// https://stackoverflow.com/questions/15141762/how-to-initialize-a-javascript-date-to-a-particular-time-zone/53652131#53652131\nfunction tzDate(date, tz) {\n\tlet date2;\n\n\t// perf optimization\n\tif (tz == 'UTC' || tz == 'Etc/UTC')\n\t\tdate2 = new Date(+date + date.getTimezoneOffset() * 6e4);\n\telse if (tz == localTz)\n\t\tdate2 = date;\n\telse {\n\t\tdate2 = new Date(date.toLocaleString('en-US', {timeZone: tz}));\n\t\tdate2.setMilliseconds(date.getMilliseconds());\n\t}\n\n\treturn date2;\n}\n\n//export const series = [];\n\n// default formatters:\n\nconst onlyWhole = v => v % 1 == 0;\n\nconst allMults = [1,2,2.5,5];\n\n// ...0.01, 0.02, 0.025, 0.05, 0.1, 0.2, 0.25, 0.5\nconst decIncrs = genIncrs(10, -32, 0, allMults);\n\n// 1, 2, 2.5, 5, 10, 20, 25, 50...\nconst oneIncrs = genIncrs(10, 0, 32, allMults);\n\n// 1, 2,      5, 10, 20, 25, 50...\nconst wholeIncrs = oneIncrs.filter(onlyWhole);\n\nconst numIncrs = decIncrs.concat(oneIncrs);\n\nconst NL = \"\\n\";\n\nconst yyyy    = \"{YYYY}\";\nconst NLyyyy  = NL + yyyy;\nconst md      = \"{M}/{D}\";\nconst NLmd    = NL + md;\nconst NLmdyy  = NLmd + \"/{YY}\";\n\nconst aa      = \"{aa}\";\nconst hmm     = \"{h}:{mm}\";\nconst hmmaa   = hmm + aa;\nconst NLhmmaa = NL + hmmaa;\nconst ss      = \":{ss}\";\n\nconst _ = null;\n\nfunction genTimeStuffs(ms) {\n\tlet\ts  = ms * 1e3,\n\t\tm  = s  * 60,\n\t\th  = m  * 60,\n\t\td  = h  * 24,\n\t\tmo = d  * 30,\n\t\ty  = d  * 365;\n\n\t// min of 1e-3 prevents setting a temporal x ticks too small since Date objects cannot advance ticks smaller than 1ms\n\tlet subSecIncrs = ms == 1 ? genIncrs(10, 0, 3, allMults).filter(onlyWhole) : genIncrs(10, -3, 0, allMults);\n\n\tlet timeIncrs = subSecIncrs.concat([\n\t\t// minute divisors (# of secs)\n\t\ts,\n\t\ts * 5,\n\t\ts * 10,\n\t\ts * 15,\n\t\ts * 30,\n\t\t// hour divisors (# of mins)\n\t\tm,\n\t\tm * 5,\n\t\tm * 10,\n\t\tm * 15,\n\t\tm * 30,\n\t\t// day divisors (# of hrs)\n\t\th,\n\t\th * 2,\n\t\th * 3,\n\t\th * 4,\n\t\th * 6,\n\t\th * 8,\n\t\th * 12,\n\t\t// month divisors TODO: need more?\n\t\td,\n\t\td * 2,\n\t\td * 3,\n\t\td * 4,\n\t\td * 5,\n\t\td * 6,\n\t\td * 7,\n\t\td * 8,\n\t\td * 9,\n\t\td * 10,\n\t\td * 15,\n\t\t// year divisors (# months, approx)\n\t\tmo,\n\t\tmo * 2,\n\t\tmo * 3,\n\t\tmo * 4,\n\t\tmo * 6,\n\t\t// century divisors\n\t\ty,\n\t\ty * 2,\n\t\ty * 5,\n\t\ty * 10,\n\t\ty * 25,\n\t\ty * 50,\n\t\ty * 100,\n\t]);\n\n\t// [0]:   minimum num secs in the tick incr\n\t// [1]:   default tick format\n\t// [2-7]: rollover tick formats\n\t// [8]:   mode: 0: replace [1] -> [2-7], 1: concat [1] + [2-7]\n\tconst _timeAxisStamps = [\n\t//   tick incr    default          year                    month   day                   hour    min       sec   mode\n\t\t[y,           yyyy,            _,                      _,      _,                    _,      _,        _,       1],\n\t\t[d * 28,      \"{MMM}\",         NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[d,           md,              NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[h,           \"{h}\" + aa,      NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[m,           hmmaa,           NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[s,           ss,              NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t\t[ms,          ss + \".{fff}\",   NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t];\n\n\t// the ensures that axis ticks, values & grid are aligned to logical temporal breakpoints and not an arbitrary timestamp\n\t// https://www.timeanddate.com/time/dst/\n\t// https://www.timeanddate.com/time/dst/2019.html\n\t// https://www.epochconverter.com/timezones\n\tfunction timeAxisSplits(tzDate) {\n\t\treturn (self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace) => {\n\t\t\tlet splits = [];\n\t\t\tlet isYr = foundIncr >= y;\n\t\t\tlet isMo = foundIncr >= mo && foundIncr < y;\n\n\t\t\t// get the timezone-adjusted date\n\t\t\tlet minDate = tzDate(scaleMin);\n\t\t\tlet minDateTs = roundDec(minDate * ms, 3);\n\n\t\t\t// get ts of 12am (this lands us at or before the original scaleMin)\n\t\t\tlet minMin = mkDate(minDate.getFullYear(), isYr ? 0 : minDate.getMonth(), isMo || isYr ? 1 : minDate.getDate());\n\t\t\tlet minMinTs = roundDec(minMin * ms, 3);\n\n\t\t\tif (isMo || isYr) {\n\t\t\t\tlet moIncr = isMo ? foundIncr / mo : 0;\n\t\t\t\tlet yrIncr = isYr ? foundIncr / y  : 0;\n\t\t\t//\tlet tzOffset = scaleMin - minDateTs;\t\t// needed?\n\t\t\t\tlet split = minDateTs == minMinTs ? minDateTs : roundDec(mkDate(minMin.getFullYear() + yrIncr, minMin.getMonth() + moIncr, 1) * ms, 3);\n\t\t\t\tlet splitDate = new Date(round(split / ms));\n\t\t\t\tlet baseYear = splitDate.getFullYear();\n\t\t\t\tlet baseMonth = splitDate.getMonth();\n\n\t\t\t\tfor (let i = 0; split <= scaleMax; i++) {\n\t\t\t\t\tlet next = mkDate(baseYear + yrIncr * i, baseMonth + moIncr * i, 1);\n\t\t\t\t\tlet offs = next - tzDate(roundDec(next * ms, 3));\n\n\t\t\t\t\tsplit = roundDec((+next + offs) * ms, 3);\n\n\t\t\t\t\tif (split <= scaleMax)\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet incr0 = foundIncr >= d ? d : foundIncr;\n\t\t\t\tlet tzOffset = floor(scaleMin) - floor(minDateTs);\n\t\t\t\tlet split = minMinTs + tzOffset + incrRoundUp(minDateTs - minMinTs, incr0);\n\t\t\t\tsplits.push(split);\n\n\t\t\t\tlet date0 = tzDate(split);\n\n\t\t\t\tlet prevHour = date0.getHours() + (date0.getMinutes() / m) + (date0.getSeconds() / h);\n\t\t\t\tlet incrHours = foundIncr / h;\n\n\t\t\t\tlet minSpace = self.axes[axisIdx]._space;\n\t\t\t\tlet pctSpace = foundSpace / minSpace;\n\n\t\t\t\twhile (1) {\n\t\t\t\t\tsplit = roundDec(split + foundIncr, ms == 1 ? 0 : 3);\n\n\t\t\t\t\tif (split > scaleMax)\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tif (incrHours > 1) {\n\t\t\t\t\t\tlet expectedHour = floor(roundDec(prevHour + incrHours, 6)) % 24;\n\t\t\t\t\t\tlet splitDate = tzDate(split);\n\t\t\t\t\t\tlet actualHour = splitDate.getHours();\n\n\t\t\t\t\t\tlet dstShift = actualHour - expectedHour;\n\n\t\t\t\t\t\tif (dstShift > 1)\n\t\t\t\t\t\t\tdstShift = -1;\n\n\t\t\t\t\t\tsplit -= dstShift * h;\n\n\t\t\t\t\t\tprevHour = (prevHour + incrHours) % 24;\n\n\t\t\t\t\t\t// add a tick only if it's further than 70% of the min allowed label spacing\n\t\t\t\t\t\tlet prevSplit = splits[splits.length - 1];\n\t\t\t\t\t\tlet pctIncr = roundDec((split - prevSplit) / foundIncr, 3);\n\n\t\t\t\t\t\tif (pctIncr * pctSpace >= .7)\n\t\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn splits;\n\t\t}\n\t}\n\n\treturn [\n\t\ttimeIncrs,\n\t\t_timeAxisStamps,\n\t\ttimeAxisSplits,\n\t];\n}\n\nconst [ timeIncrsMs, _timeAxisStampsMs, timeAxisSplitsMs ] = genTimeStuffs(1);\nconst [ timeIncrsS,  _timeAxisStampsS,  timeAxisSplitsS  ] = genTimeStuffs(1e-3);\n\n// base 2\ngenIncrs(2, -53, 53, [1]);\n\n/*\nconsole.log({\n\tdecIncrs,\n\toneIncrs,\n\twholeIncrs,\n\tnumIncrs,\n\ttimeIncrs,\n\tfixedDec,\n});\n*/\n\nfunction timeAxisStamps(stampCfg, fmtDate) {\n\treturn stampCfg.map(s => s.map((v, i) =>\n\t\ti == 0 || i == 8 || v == null ? v : fmtDate(i == 1 || s[8] == 0 ? v : s[1] + v)\n\t));\n}\n\n// TODO: will need to accept spaces[] and pull incr into the loop when grid will be non-uniform, eg for log scales.\n// currently we ignore this for months since they're *nearly* uniform and the added complexity is not worth it\nfunction timeAxisVals(tzDate, stamps) {\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => {\n\t\tlet s = stamps.find(s => foundIncr >= s[0]) || stamps[stamps.length - 1];\n\n\t\t// these track boundaries when a full label is needed again\n\t\tlet prevYear;\n\t\tlet prevMnth;\n\t\tlet prevDate;\n\t\tlet prevHour;\n\t\tlet prevMins;\n\t\tlet prevSecs;\n\n\t\treturn splits.map(split => {\n\t\t\tlet date = tzDate(split);\n\n\t\t\tlet newYear = date.getFullYear();\n\t\t\tlet newMnth = date.getMonth();\n\t\t\tlet newDate = date.getDate();\n\t\t\tlet newHour = date.getHours();\n\t\t\tlet newMins = date.getMinutes();\n\t\t\tlet newSecs = date.getSeconds();\n\n\t\t\tlet stamp = (\n\t\t\t\tnewYear != prevYear && s[2] ||\n\t\t\t\tnewMnth != prevMnth && s[3] ||\n\t\t\t\tnewDate != prevDate && s[4] ||\n\t\t\t\tnewHour != prevHour && s[5] ||\n\t\t\t\tnewMins != prevMins && s[6] ||\n\t\t\t\tnewSecs != prevSecs && s[7] ||\n\t\t\t\t                       s[1]\n\t\t\t);\n\n\t\t\tprevYear = newYear;\n\t\t\tprevMnth = newMnth;\n\t\t\tprevDate = newDate;\n\t\t\tprevHour = newHour;\n\t\t\tprevMins = newMins;\n\t\t\tprevSecs = newSecs;\n\n\t\t\treturn stamp(date);\n\t\t});\n\t}\n}\n\n// for when axis.values is defined as a static fmtDate template string\nfunction timeAxisVal(tzDate, dateTpl) {\n\tlet stamp = fmtDate(dateTpl);\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => splits.map(split => stamp(tzDate(split)));\n}\n\nfunction mkDate(y, m, d) {\n\treturn new Date(y, m, d);\n}\n\nfunction timeSeriesStamp(stampCfg, fmtDate) {\n\treturn fmtDate(stampCfg);\n}\nconst _timeSeriesStamp = '{YYYY}-{MM}-{DD} {h}:{mm}{aa}';\n\nfunction timeSeriesVal(tzDate, stamp) {\n\treturn (self, val, seriesIdx, dataIdx) => dataIdx == null ? LEGEND_DISP : stamp(tzDate(val));\n}\n\nfunction legendStroke(self, seriesIdx) {\n\tlet s = self.series[seriesIdx];\n\treturn s.width ? s.stroke(self, seriesIdx) : s.points.width ? s.points.stroke(self, seriesIdx) : null;\n}\n\nfunction legendFill(self, seriesIdx) {\n\treturn self.series[seriesIdx].fill(self, seriesIdx);\n}\n\nconst legendOpts = {\n\tshow: true,\n\tlive: true,\n\tisolate: false,\n\tmount: noop,\n\tmarkers: {\n\t\tshow: true,\n\t\twidth: 2,\n\t\tstroke: legendStroke,\n\t\tfill: legendFill,\n\t\tdash: \"solid\",\n\t},\n\tidx: null,\n\tidxs: null,\n\tvalues: [],\n};\n\nfunction cursorPointShow(self, si) {\n\tlet o = self.cursor.points;\n\n\tlet pt = placeDiv();\n\n\tlet size = o.size(self, si);\n\tsetStylePx(pt, WIDTH, size);\n\tsetStylePx(pt, HEIGHT, size);\n\n\tlet mar = size / -2;\n\tsetStylePx(pt, \"marginLeft\", mar);\n\tsetStylePx(pt, \"marginTop\", mar);\n\n\tlet width = o.width(self, si, size);\n\twidth && setStylePx(pt, \"borderWidth\", width);\n\n\treturn pt;\n}\n\nfunction cursorPointFill(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._fill || sp._stroke;\n}\n\nfunction cursorPointStroke(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._stroke || sp._fill;\n}\n\nfunction cursorPointSize(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp.size;\n}\n\nconst moveTuple = [0,0];\n\nfunction cursorMove(self, mouseLeft1, mouseTop1) {\n\tmoveTuple[0] = mouseLeft1;\n\tmoveTuple[1] = mouseTop1;\n\treturn moveTuple;\n}\n\nfunction filtBtn0(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\te.button == 0 && (!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nfunction filtTarg(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\t(!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nconst cursorOpts = {\n\tshow: true,\n\tx: true,\n\ty: true,\n\tlock: false,\n\tmove: cursorMove,\n\tpoints: {\n\t\tone:    false,\n\t\tshow:   cursorPointShow,\n\t\tsize:   cursorPointSize,\n\t\twidth:  0,\n\t\tstroke: cursorPointStroke,\n\t\tfill:   cursorPointFill,\n\t},\n\n\tbind: {\n\t\tmousedown:   filtBtn0,\n\t\tmouseup:     filtBtn0,\n\t\tclick:       filtBtn0, // legend clicks, not .u-over clicks\n\t\tdblclick:    filtBtn0,\n\n\t\tmousemove:   filtTarg,\n\t\tmouseleave:  filtTarg,\n\t\tmouseenter:  filtTarg,\n\t},\n\n\tdrag: {\n\t\tsetScale: true,\n\t\tx: true,\n\t\ty: false,\n\t\tdist: 0,\n\t\tuni: null,\n\t\tclick: (self, e) => {\n\t\t//\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t},\n\t\t_x: false,\n\t\t_y: false,\n\t},\n\n\tfocus: {\n\t\tdist: (self, seriesIdx, dataIdx, valPos, curPos) => valPos - curPos,\n\t\tprox: -1,\n\t\tbias: 0,\n\t},\n\n\thover: {\n\t\tskip: [void 0],\n\t\tprox: null,\n\t\tbias: 0,\n\t},\n\n\tleft: -10,\n\ttop: -10,\n\tidx: null,\n\tdataIdx: null,\n\tidxs: null,\n\n\tevent: null,\n};\n\nconst axisLines = {\n\tshow: true,\n\tstroke: \"rgba(0,0,0,0.07)\",\n\twidth: 2,\n//\tdash: [],\n};\n\nconst grid = assign({}, axisLines, {\n\tfilter: retArg1,\n});\n\nconst ticks = assign({}, grid, {\n\tsize: 10,\n});\n\nconst border = assign({}, axisLines, {\n\tshow: false,\n});\n\nconst font      = '12px system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\"';\nconst labelFont = \"bold \" + font;\nconst lineGap = 1.5;\t// font-size multiplier\n\nconst xAxisOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tstroke: hexBlack,\n\tspace: 50,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 2,\n//\tclass: \"x-vals\",\n//\tincrs: timeIncrs,\n//\tvalues: timeVals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\nconst numSeriesLabel = \"Value\";\nconst timeSeriesLabel = \"Time\";\n\nconst xSeriesOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tauto: false,\n\tsorted: 1,\n//\tlabel: \"Time\",\n//\tvalue: v => stamp(new Date(v * 1e3)),\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n};\n\nfunction numAxisVals(self, splits, axisIdx, foundSpace, foundIncr) {\n\treturn splits.map(v => v == null ? \"\" : fmtNum(v));\n}\n\nfunction numAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet splits = [];\n\n\tlet numDec = fixedDec.get(foundIncr) || 0;\n\n\tscaleMin = forceMin ? scaleMin : roundDec(incrRoundUp(scaleMin, foundIncr), numDec);\n\n\tfor (let val = scaleMin; val <= scaleMax; val = roundDec(val + foundIncr, numDec))\n\t\tsplits.push(Object.is(val, -0) ? 0 : val);\t\t// coalesces -0\n\n\treturn splits;\n}\n\n// this doesnt work for sin, which needs to come off from 0 independently in pos and neg dirs\nfunction logAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tconst splits = [];\n\n\tconst logBase = self.scales[self.axes[axisIdx].scale].log;\n\n\tconst logFn = logBase == 10 ? log10 : log2;\n\n\tconst exp = floor(logFn(scaleMin));\n\n\tfoundIncr = pow(logBase, exp);\n\n\t// boo: 10 ** -24 === 1.0000000000000001e-24\n\t// this grabs the proper 1e-24 one\n\tif (logBase == 10)\n\t\tfoundIncr = numIncrs[closestIdx(foundIncr, numIncrs)];\n\n\tlet split = scaleMin;\n\tlet nextMagIncr = foundIncr * logBase;\n\n\tif (logBase == 10)\n\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\n\tdo {\n\t\tsplits.push(split);\n\t\tsplit = split + foundIncr;\n\n\t\tif (logBase == 10 && !fixedDec.has(split))\n\t\t\tsplit = roundDec(split, fixedDec.get(foundIncr));\n\n\t\tif (split >= nextMagIncr) {\n\t\t\tfoundIncr = split;\n\t\t\tnextMagIncr = foundIncr * logBase;\n\n\t\t\tif (logBase == 10)\n\t\t\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\t\t}\n\t} while (split <= scaleMax);\n\n\treturn splits;\n}\n\nfunction asinhAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet sc = self.scales[self.axes[axisIdx].scale];\n\n\tlet linthresh = sc.asinh;\n\n\tlet posSplits = scaleMax > linthresh ? logAxisSplits(self, axisIdx, max(linthresh, scaleMin), scaleMax, foundIncr) : [linthresh];\n\tlet zero = scaleMax >= 0 && scaleMin <= 0 ? [0] : [];\n\tlet negSplits = scaleMin < -linthresh ? logAxisSplits(self, axisIdx, max(linthresh, -scaleMax), -scaleMin, foundIncr): [linthresh];\n\n\treturn negSplits.reverse().map(v => -v).concat(zero, posSplits);\n}\n\nconst RE_ALL   = /./;\nconst RE_12357 = /[12357]/;\nconst RE_125   = /[125]/;\nconst RE_1     = /1/;\n\nconst _filt = (splits, distr, re, keepMod) => splits.map((v, i) => ((distr == 4 && v == 0) || i % keepMod == 0 && re.test(v.toExponential()[v < 0 ? 1 : 0])) ? v : null);\n\nfunction log10AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet sc = self.scales[scaleKey];\n\n//\tif (sc.distr == 3 && sc.log == 2)\n//\t\treturn splits;\n\n\tlet valToPos = self.valToPos;\n\n\tlet minSpace = axis._space;\n\n\tlet _10 = valToPos(10, scaleKey);\n\n\tlet re = (\n\t\tvalToPos(9, scaleKey) - _10 >= minSpace ? RE_ALL :\n\t\tvalToPos(7, scaleKey) - _10 >= minSpace ? RE_12357 :\n\t\tvalToPos(5, scaleKey) - _10 >= minSpace ? RE_125 :\n\t\tRE_1\n\t);\n\n\tif (re == RE_1) {\n\t\tlet magSpace = abs(valToPos(1, scaleKey) - _10);\n\n\t\tif (magSpace < minSpace)\n\t\t\treturn _filt(splits.slice().reverse(), sc.distr, re, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\t}\n\n\treturn _filt(splits, sc.distr, re, 1);\n}\n\nfunction log2AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet minSpace = axis._space;\n\tlet valToPos = self.valToPos;\n\n\tlet magSpace = abs(valToPos(1, scaleKey) - valToPos(2, scaleKey));\n\n\tif (magSpace < minSpace)\n\t\treturn _filt(splits.slice().reverse(), 3, RE_ALL, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\n\treturn splits;\n}\n\nfunction numSeriesVal(self, val, seriesIdx, dataIdx) {\n\treturn dataIdx == null ? LEGEND_DISP : val == null ? \"\" : fmtNum(val);\n}\n\nconst yAxisOpts = {\n\tshow: true,\n\tscale: \"y\",\n\tstroke: hexBlack,\n\tspace: 30,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 3,\n//\tclass: \"y-vals\",\n//\tincrs: numIncrs,\n//\tvalues: (vals, space) => vals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\n// takes stroke width\nfunction ptDia(width, mult) {\n\tlet dia = 3 + (width || 1) * 2;\n\treturn roundDec(dia * mult, 3);\n}\n\nfunction seriesPointsShow(self, si) {\n\tlet { scale, idxs } = self.series[0];\n\tlet xData = self._data[0];\n\tlet p0 = self.valToPos(xData[idxs[0]], scale, true);\n\tlet p1 = self.valToPos(xData[idxs[1]], scale, true);\n\tlet dim = abs(p1 - p0);\n\n\tlet s = self.series[si];\n//\tconst dia = ptDia(s.width, pxRatio);\n\tlet maxPts = dim / (s.points.space * pxRatio);\n\treturn idxs[1] - idxs[0] <= maxPts;\n}\n\nconst facet = {\n\tscale: null,\n\tauto: true,\n\tsorted: 0,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n};\n\nconst gaps = (self, seriesIdx, idx0, idx1, nullGaps) => nullGaps;\n\nconst xySeriesOpts = {\n\tshow: true,\n\tauto: true,\n\tsorted: 0,\n\tgaps,\n\talpha: 1,\n\tfacets: [\n\t\tassign({}, facet, {scale: 'x'}),\n\t\tassign({}, facet, {scale: 'y'}),\n\t],\n};\n\nconst ySeriesOpts = {\n\tscale: \"y\",\n\tauto: true,\n\tsorted: 0,\n\tshow: true,\n\tspanGaps: false,\n\tgaps,\n\talpha: 1,\n\tpoints: {\n\t\tshow: seriesPointsShow,\n\t\tfilter: null,\n\t//  paths:\n\t//\tstroke: \"#000\",\n\t//\tfill: \"#fff\",\n\t//\twidth: 1,\n\t//\tsize: 10,\n\t},\n//\tlabel: \"Value\",\n//\tvalue: v => v,\n\tvalues: null,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n\n\tpath: null,\n\tclip: null,\n};\n\nfunction clampScale(self, val, scaleMin, scaleMax, scaleKey) {\n/*\n\tif (val < 0) {\n\t\tlet cssHgt = self.bbox.height / pxRatio;\n\t\tlet absPos = self.valToPos(abs(val), scaleKey);\n\t\tlet fromBtm = cssHgt - absPos;\n\t\treturn self.posToVal(cssHgt + fromBtm, scaleKey);\n\t}\n*/\n\treturn scaleMin / 10;\n}\n\nconst xScaleOpts = {\n\ttime: FEAT_TIME,\n\tauto: true,\n\tdistr: 1,\n\tlog: 10,\n\tasinh: 1,\n\tmin: null,\n\tmax: null,\n\tdir: 1,\n\tori: 0,\n};\n\nconst yScaleOpts = assign({}, xScaleOpts, {\n\ttime: false,\n\tori: 1,\n});\n\nconst syncs = {};\n\nfunction _sync(key, opts) {\n\tlet s = syncs[key];\n\n\tif (!s) {\n\t\ts = {\n\t\t\tkey,\n\t\t\tplots: [],\n\t\t\tsub(plot) {\n\t\t\t\ts.plots.push(plot);\n\t\t\t},\n\t\t\tunsub(plot) {\n\t\t\t\ts.plots = s.plots.filter(c => c != plot);\n\t\t\t},\n\t\t\tpub(type, self, x, y, w, h, i) {\n\t\t\t\tfor (let j = 0; j < s.plots.length; j++)\n\t\t\t\t\ts.plots[j] != self && s.plots[j].pub(type, self, x, y, w, h, i);\n\t\t\t},\n\t\t};\n\n\t\tif (key != null)\n\t\t\tsyncs[key] = s;\n\t}\n\n\treturn s;\n}\n\nconst BAND_CLIP_FILL   = 1 << 0;\nconst BAND_CLIP_STROKE = 1 << 1;\n\nfunction orient(u, seriesIdx, cb) {\n\tconst mode = u.mode;\n\tconst series = u.series[seriesIdx];\n\tconst data = mode == 2 ? u._data[seriesIdx] : u._data;\n\tconst scales = u.scales;\n\tconst bbox   = u.bbox;\n\n\tlet dx = data[0],\n\t\tdy = mode == 2 ? data[1] : data[seriesIdx],\n\t\tsx = mode == 2 ? scales[series.facets[0].scale] : scales[u.series[0].scale],\n\t\tsy = mode == 2 ? scales[series.facets[1].scale] : scales[series.scale],\n\t\tl = bbox.left,\n\t\tt = bbox.top,\n\t\tw = bbox.width,\n\t\th = bbox.height,\n\t\tH = u.valToPosH,\n\t\tV = u.valToPosV;\n\n\treturn (sx.ori == 0\n\t\t? cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tH,\n\t\t\tV,\n\t\t\tl,\n\t\t\tt,\n\t\t\tw,\n\t\t\th,\n\t\t\tmoveToH,\n\t\t\tlineToH,\n\t\t\trectH,\n\t\t\tarcH,\n\t\t\tbezierCurveToH,\n\t\t)\n\t\t: cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tV,\n\t\t\tH,\n\t\t\tt,\n\t\t\tl,\n\t\t\th,\n\t\t\tw,\n\t\t\tmoveToV,\n\t\t\tlineToV,\n\t\t\trectV,\n\t\t\tarcV,\n\t\t\tbezierCurveToV,\n\t\t)\n\t);\n}\n\nfunction bandFillClipDirs(self, seriesIdx) {\n\tlet fillDir = 0;\n\n\t// 2 bits, -1 | 1\n\tlet clipDirs = 0;\n\n\tlet bands = ifNull(self.bands, EMPTY_ARR);\n\n\tfor (let i = 0; i < bands.length; i++) {\n\t\tlet b = bands[i];\n\n\t\t// is a \"from\" band edge\n\t\tif (b.series[0] == seriesIdx)\n\t\t\tfillDir = b.dir;\n\t\t// is a \"to\" band edge\n\t\telse if (b.series[1] == seriesIdx) {\n\t\t\tif (b.dir == 1)\n\t\t\t\tclipDirs |= 1;\n\t\t\telse\n\t\t\t\tclipDirs |= 2;\n\t\t}\n\t}\n\n\treturn [\n\t\tfillDir,\n\t\t(\n\t\t\tclipDirs == 1 ? -1 : // neg only\n\t\t\tclipDirs == 2 ?  1 : // pos only\n\t\t\tclipDirs == 3 ?  2 : // both\n\t\t\t                 0   // neither\n\t\t)\n\t];\n}\n\nfunction seriesFillTo(self, seriesIdx, dataMin, dataMax, bandFillDir) {\n\tlet mode = self.mode;\n\tlet series = self.series[seriesIdx];\n\tlet scaleKey = mode == 2 ? series.facets[1].scale : series.scale;\n\tlet scale = self.scales[scaleKey];\n\n\treturn (\n\t\tbandFillDir == -1 ? scale.min :\n\t\tbandFillDir ==  1 ? scale.max :\n\t\tscale.distr ==  3 ? (\n\t\t\tscale.dir == 1 ? scale.min :\n\t\t\tscale.max\n\t\t) : 0\n\t);\n}\n\n// creates inverted band clip path (from stroke path -> yMax || yMin)\n// clipDir is always inverse of fillDir\n// default clip dir is upwards (1), since default band fill is downwards/fillBelowTo (-1) (highIdx -> lowIdx)\nfunction clipBandLine(self, seriesIdx, idx0, idx1, strokePath, clipDir) {\n\treturn orient(self, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\tlet pxRound = series.pxRound;\n\n\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\tconst lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\tlet frIdx, toIdx;\n\n\t\tif (dir == 1) {\n\t\t\tfrIdx = idx0;\n\t\t\ttoIdx = idx1;\n\t\t}\n\t\telse {\n\t\t\tfrIdx = idx1;\n\t\t\ttoIdx = idx0;\n\t\t}\n\n\t\t// path start\n\t\tlet x0 = pxRound(valToPosX(dataX[frIdx], scaleX, xDim, xOff));\n\t\tlet y0 = pxRound(valToPosY(dataY[frIdx], scaleY, yDim, yOff));\n\t\t// path end x\n\t\tlet x1 = pxRound(valToPosX(dataX[toIdx], scaleX, xDim, xOff));\n\t\t// upper or lower y limit\n\t\tlet yLimit = pxRound(valToPosY(clipDir == 1 ? scaleY.max : scaleY.min, scaleY, yDim, yOff));\n\n\t\tlet clip = new Path2D(strokePath);\n\n\t\tlineTo(clip, x1, yLimit);\n\t\tlineTo(clip, x0, yLimit);\n\t\tlineTo(clip, x0, y0);\n\n\t\treturn clip;\n\t});\n}\n\nfunction clipGaps(gaps, ori, plotLft, plotTop, plotWid, plotHgt) {\n\tlet clip = null;\n\n\t// create clip path (invert gaps and non-gaps)\n\tif (gaps.length > 0) {\n\t\tclip = new Path2D();\n\n\t\tconst rect = ori == 0 ? rectH : rectV;\n\n\t\tlet prevGapEnd = plotLft;\n\n\t\tfor (let i = 0; i < gaps.length; i++) {\n\t\t\tlet g = gaps[i];\n\n\t\t\tif (g[1] > g[0]) {\n\t\t\t\tlet w = g[0] - prevGapEnd;\n\n\t\t\t\tw > 0 && rect(clip, prevGapEnd, plotTop, w, plotTop + plotHgt);\n\n\t\t\t\tprevGapEnd = g[1];\n\t\t\t}\n\t\t}\n\n\t\tlet w = plotLft + plotWid - prevGapEnd;\n\n\t\t// hack to ensure we expand the clip enough to avoid cutting off strokes at edges\n\t\tlet maxStrokeWidth = 10;\n\n\t\tw > 0 && rect(clip, prevGapEnd, plotTop - maxStrokeWidth / 2, w, plotTop + plotHgt + maxStrokeWidth);\n\t}\n\n\treturn clip;\n}\n\nfunction addGap(gaps, fromX, toX) {\n\tlet prevGap = gaps[gaps.length - 1];\n\n\tif (prevGap && prevGap[0] == fromX)\t\t\t// TODO: gaps must be encoded at stroke widths?\n\t\tprevGap[1] = toX;\n\telse\n\t\tgaps.push([fromX, toX]);\n}\n\nfunction findGaps(xs, ys, idx0, idx1, dir, pixelForX, align) {\n\tlet gaps = [];\n\tlet len = xs.length;\n\n\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\tlet yVal = ys[i];\n\n\t\tif (yVal === null) {\n\t\t\tlet fr = i, to = i;\n\n\t\t\tif (dir == 1) {\n\t\t\t\twhile (++i <= idx1 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\twhile (--i >= idx0 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\n\t\t\tlet frPx = pixelForX(xs[fr]);\n\t\t\tlet toPx = to == fr ? frPx : pixelForX(xs[to]);\n\n\t\t\t// if value adjacent to edge null is same pixel, then it's partially\n\t\t\t// filled and gap should start at next pixel\n\t\t\tlet fri2 = fr - dir;\n\t\t\tlet frPx2 = align <= 0 && fri2 >= 0 && fri2 < len ? pixelForX(xs[fri2]) : frPx;\n\t\t//\tif (frPx2 == frPx)\n\t\t//\t\tfrPx++;\n\t\t//\telse\n\t\t\t\tfrPx = frPx2;\n\n\t\t\tlet toi2 = to + dir;\n\t\t\tlet toPx2 = align >= 0 && toi2 >= 0 && toi2 < len ? pixelForX(xs[toi2]) : toPx;\n\t\t//\tif (toPx2 == toPx)\n\t\t//\t\ttoPx--;\n\t\t//\telse\n\t\t\t\ttoPx = toPx2;\n\n\t\t\tif (toPx >= frPx)\n\t\t\t\tgaps.push([frPx, toPx]); // addGap\n\t\t}\n\t}\n\n\treturn gaps;\n}\n\nfunction pxRoundGen(pxAlign) {\n\treturn pxAlign == 0 ? retArg0 : pxAlign == 1 ? round : v => incrRound(v, pxAlign);\n}\n\n/*\n// inefficient linear interpolation that does bi-directinal scans on each call\nexport function costlyLerp(i, idx0, idx1, _dirX, dataY) {\n\tlet prevNonNull = nonNullIdx(dataY, _dirX == 1 ? idx0 : idx1, i, -_dirX);\n\tlet nextNonNull = nonNullIdx(dataY, i, _dirX == 1 ? idx1 : idx0,  _dirX);\n\n\tlet prevVal = dataY[prevNonNull];\n\tlet nextVal = dataY[nextNonNull];\n\n\treturn prevVal + (i - prevNonNull) / (nextNonNull - prevNonNull) * (nextVal - prevVal);\n}\n*/\n\nfunction rect(ori) {\n\tlet moveTo = ori == 0 ?\n\t\tmoveToH :\n\t\tmoveToV;\n\n\tlet arcTo = ori == 0 ?\n\t\t(p, x1, y1, x2, y2, r) => { p.arcTo(x1, y1, x2, y2, r); } :\n\t\t(p, y1, x1, y2, x2, r) => { p.arcTo(x1, y1, x2, y2, r); };\n\n\tlet rect = ori == 0 ?\n\t\t(p, x, y, w, h) => { p.rect(x, y, w, h); } :\n\t\t(p, y, x, h, w) => { p.rect(x, y, w, h); };\n\n\t// TODO (pending better browser support): https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/roundRect\n\treturn (p, x, y, w, h, endRad = 0, baseRad = 0) => {\n\t\tif (endRad == 0 && baseRad == 0)\n\t\t\trect(p, x, y, w, h);\n\t\telse {\n\t\t\tendRad  = min(endRad,  w / 2, h / 2);\n\t\t\tbaseRad = min(baseRad, w / 2, h / 2);\n\n\t\t\t// adapted from https://stackoverflow.com/questions/1255512/how-to-draw-a-rounded-rectangle-using-html-canvas/7838871#7838871\n\t\t\tmoveTo(p, x + endRad, y);\n\t\t\tarcTo(p, x + w, y, x + w, y + h, endRad);\n\t\t\tarcTo(p, x + w, y + h, x, y + h, baseRad);\n\t\t\tarcTo(p, x, y + h, x, y, baseRad);\n\t\t\tarcTo(p, x, y, x + w, y, endRad);\n\t\t\tp.closePath();\n\t\t}\n\t};\n}\n\n// orientation-inverting canvas functions\nconst moveToH = (p, x, y) => { p.moveTo(x, y); };\nconst moveToV = (p, y, x) => { p.moveTo(x, y); };\nconst lineToH = (p, x, y) => { p.lineTo(x, y); };\nconst lineToV = (p, y, x) => { p.lineTo(x, y); };\nconst rectH = rect(0);\nconst rectV = rect(1);\nconst arcH = (p, x, y, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst arcV = (p, y, x, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst bezierCurveToH = (p, bp1x, bp1y, bp2x, bp2y, p2x, p2y) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\nconst bezierCurveToV = (p, bp1y, bp1x, bp2y, bp2x, p2y, p2x) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\n\n// TODO: drawWrap(seriesIdx, drawPoints) (save, restore, translate, clip)\nfunction points(opts) {\n\treturn (u, seriesIdx, idx0, idx1, filtIdxs) => {\n\t//\tlog(\"drawPoints()\", arguments);\n\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet { pxRound, points } = series;\n\n\t\t\tlet moveTo, arc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tarc = arcH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tarc = arcV;\n\t\t\t}\n\n\t\t\tconst width = roundDec(points.width * pxRatio, 3);\n\n\t\t\tlet rad = (points.size - points.width) / 2 * pxRatio;\n\t\t\tlet dia = roundDec(rad * 2, 3);\n\n\t\t\tlet fill = new Path2D();\n\t\t\tlet clip = new Path2D();\n\n\t\t\tlet { left: lft, top: top, width: wid, height: hgt } = u.bbox;\n\n\t\t\trectH(clip,\n\t\t\t\tlft - dia,\n\t\t\t\ttop - dia,\n\t\t\t\twid + dia * 2,\n\t\t\t\thgt + dia * 2,\n\t\t\t);\n\n\t\t\tconst drawPoint = pi => {\n\t\t\t\tif (dataY[pi] != null) {\n\t\t\t\t\tlet x = pxRound(valToPosX(dataX[pi], scaleX, xDim, xOff));\n\t\t\t\t\tlet y = pxRound(valToPosY(dataY[pi], scaleY, yDim, yOff));\n\n\t\t\t\t\tmoveTo(fill, x + rad, y);\n\t\t\t\t\tarc(fill, x, y, rad, 0, PI * 2);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (filtIdxs)\n\t\t\t\tfiltIdxs.forEach(drawPoint);\n\t\t\telse {\n\t\t\t\tfor (let pi = idx0; pi <= idx1; pi++)\n\t\t\t\t\tdrawPoint(pi);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstroke: width > 0 ? fill : null,\n\t\t\t\tfill,\n\t\t\t\tclip,\n\t\t\t\tflags: BAND_CLIP_FILL | BAND_CLIP_STROKE,\n\t\t\t};\n\t\t});\n\t};\n}\n\nfunction _drawAcc(lineTo) {\n\treturn (stroke, accX, minY, maxY, inY, outY) => {\n\t\tif (minY != maxY) {\n\t\t\tif (inY != minY && outY != minY)\n\t\t\t\tlineTo(stroke, accX, minY);\n\t\t\tif (inY != maxY && outY != maxY)\n\t\t\t\tlineTo(stroke, accX, maxY);\n\n\t\t\tlineTo(stroke, accX, outY);\n\t\t}\n\t};\n}\n\nconst drawAccH = _drawAcc(lineToH);\nconst drawAccV = _drawAcc(lineToV);\n\nfunction linear(opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo, drawAcc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tdrawAcc = drawAccH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tdrawAcc = drawAccV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet hasGap = false;\n\n\t\t\t// decimate when number of points >= 4x available pixels\n\t\t\tconst decimate = idx1 - idx0 >= xDim * 4;\n\n\t\t\tif (decimate) {\n\t\t\t\tlet xForPixel = pos => u.posToVal(pos, scaleX.key, true);\n\n\t\t\t\tlet minY = null,\n\t\t\t\t\tmaxY = null,\n\t\t\t\t\tinY, outY, drawnAtX;\n\n\t\t\t\tlet accX = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\n\t\t\t\tlet idx0px = pixelForX(dataX[idx0]);\n\t\t\t\tlet idx1px = pixelForX(dataX[idx1]);\n\n\t\t\t\t// tracks limit of current x bucket to avoid having to get x pixel for every x value\n\t\t\t\tlet nextAccXVal = xForPixel(dir == 1 ? idx0px + 1 : idx1px - 1);\n\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet reuseAccX = dir == 1 ? (xVal < nextAccXVal) : (xVal > nextAccXVal);\n\t\t\t\t\tlet x = reuseAccX ? accX :  pixelForX(xVal);\n\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (x == accX) {\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\n\t\t\t\t\t\t\tif (minY == null) {\n\t\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\t\tinY = minY = maxY = outY;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (outY < minY)\n\t\t\t\t\t\t\t\t\tminY = outY;\n\t\t\t\t\t\t\t\telse if (outY > maxY)\n\t\t\t\t\t\t\t\t\tmaxY = outY;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (minY != null)\n\t\t\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\tminY = maxY = inY = outY;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tminY = maxY = null;\n\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taccX = x;\n\t\t\t\t\t\tnextAccXVal = xForPixel(accX + dir);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (minY != null && minY != maxY && drawnAtX != accX)\n\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\thasGap = true;\n\t\t\t\t\telse if (yVal != null)\n\t\t\t\t\t\tlineTo(stroke, pixelForX(dataX[i]), pixelForY(yVal));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillToVal = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillToVal);\n\n\t\t\t\tlet frX = pixelForX(dataX[idx0]);\n\t\t\t\tlet toX = pixelForX(dataX[idx1]);\n\n\t\t\t\tif (dir == -1)\n\t\t\t\t\t[toX, frX] = [frX, toX];\n\n\t\t\t\tlineTo(fill, toX, fillToY);\n\t\t\t\tlineTo(fill, frX, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) { // skip in mode: 2?\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\thasGap && gaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\n// BUG: align: -1 behaves like align: 1 when scale.dir: -1\nfunction stepped(opts) {\n\tconst align = ifNull(opts.align, 1);\n\t// whether to draw ascenders/descenders at null/gap bondaries\n\tconst ascDesc = ifNull(opts.ascDesc, false);\n\tconst alignGaps = ifNull(opts.alignGaps, 0);\n\tconst extend = ifNull(opts.extend, false);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet { left, width } = u.bbox;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet prevYPos  = pixelForY(dataY[dir == 1 ? idx0 : idx1]);\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet firstXPosExt = firstXPos;\n\n\t\t\tif (extend && align == -1) {\n\t\t\t\tfirstXPosExt = left;\n\t\t\t\tlineTo(stroke, firstXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlineTo(stroke, firstXPos, prevYPos);\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal1 = dataY[i];\n\n\t\t\t\tif (yVal1 == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet x1 = pixelForX(dataX[i]);\n\t\t\t\tlet y1 = pixelForY(yVal1);\n\n\t\t\t\tif (align == 1)\n\t\t\t\t\tlineTo(stroke, x1, prevYPos);\n\t\t\t\telse\n\t\t\t\t\tlineTo(stroke, prevXPos, y1);\n\n\t\t\t\tlineTo(stroke, x1, y1);\n\n\t\t\t\tprevYPos = y1;\n\t\t\t\tprevXPos = x1;\n\t\t\t}\n\n\t\t\tlet prevXPosExt = prevXPos;\n\n\t\t\tif (extend && align == 1) {\n\t\t\t\tprevXPosExt = left + width;\n\t\t\t\tlineTo(stroke, prevXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPosExt, fillToY);\n\t\t\t\tlineTo(fill, firstXPosExt, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t// expand/contract clips for ascenders/descenders\n\t\t\t\tlet halfStroke = (series.width * pxRatio) / 2;\n\t\t\t\tlet startsOffset = (ascDesc || align ==  1) ?  halfStroke : -halfStroke;\n\t\t\t\tlet endsOffset   = (ascDesc || align == -1) ? -halfStroke :  halfStroke;\n\n\t\t\t\tgaps.forEach(g => {\n\t\t\t\t\tg[0] += startsOffset;\n\t\t\t\t\tg[1] += endsOffset;\n\t\t\t\t});\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid = inf) {\n\tif (dataX.length > 1) {\n\t\t// prior index with non-undefined y data\n\t\tlet prevIdx = null;\n\n\t\t// scan full dataset for smallest adjacent delta\n\t\t// will not work properly for non-linear x scales, since does not do expensive valToPosX calcs till end\n\t\tfor (let i = 0, minDelta = Infinity; i < dataX.length; i++) {\n\t\t\tif (dataY[i] !== undefined) {\n\t\t\t\tif (prevIdx != null) {\n\t\t\t\t\tlet delta = abs(dataX[i] - dataX[prevIdx]);\n\n\t\t\t\t\tif (delta < minDelta) {\n\t\t\t\t\t\tminDelta = delta;\n\t\t\t\t\t\tcolWid = abs(valToPosX(dataX[i], scaleX, xDim, xOff) - valToPosX(dataX[prevIdx], scaleX, xDim, xOff));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprevIdx = i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn colWid;\n}\n\nfunction bars(opts) {\n\topts = opts || EMPTY_OBJ;\n\tconst size = ifNull(opts.size, [0.6, inf, 1]);\n\tconst align = opts.align || 0;\n\tconst _extraGap = (opts.gap || 0);\n\n\tlet ro = opts.radius;\n\n\tro =\n\t\t// [valueRadius, baselineRadius]\n\t\tro == null ? [0, 0] :\n\t\ttypeof ro == 'number' ? [ro, 0] : ro;\n\n\tconst radiusFn = fnOrSelf(ro);\n\n\tconst gapFactor = 1 - size[0];\n\tconst _maxWidth  = ifNull(size[1], inf);\n\tconst _minWidth  = ifNull(size[2], 1);\n\n\tconst disp = ifNull(opts.disp, EMPTY_OBJ);\n\tconst _each = ifNull(opts.each, _ => {});\n\n\tconst { fill: dispFills, stroke: dispStrokes } = disp;\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet pxRound = series.pxRound;\n\t\t\tlet _align = align;\n\n\t\t\tlet extraGap = _extraGap * pxRatio;\n\t\t\tlet maxWidth = _maxWidth * pxRatio;\n\t\t\tlet minWidth = _minWidth * pxRatio;\n\n\t\t\tlet valRadius, baseRadius;\n\n\t\t\tif (scaleX.ori == 0)\n\t\t\t\t[valRadius, baseRadius] = radiusFn(u, seriesIdx);\n\t\t\telse\n\t\t\t\t[baseRadius, valRadius] = radiusFn(u, seriesIdx);\n\n\t\t\tconst _dirX = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\t//\tconst _dirY = scaleY.dir * (scaleY.ori == 1 ? 1 : -1);\n\n\t\t\tlet rect = scaleX.ori == 0 ? rectH : rectV;\n\n\t\t\tlet each = scaleX.ori == 0 ? _each : (u, seriesIdx, i, top, lft, hgt, wid) => {\n\t\t\t\t_each(u, seriesIdx, i, lft, top, wid, hgt);\n\t\t\t};\n\n\t\t\t// band where this series is the \"from\" edge\n\t\t\tlet band = ifNull(u.bands, EMPTY_ARR).find(b => b.series[0] == seriesIdx);\n\n\t\t\tlet fillDir = band != null ? band.dir : 0;\n\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, fillDir);\n\t\t\tlet fillToY = pxRound(valToPosY(fillTo, scaleY, yDim, yOff));\n\n\t\t\t// barWid is to center of stroke\n\t\t\tlet xShift, barWid, fullGap, colWid = xDim;\n\n\t\t\tlet strokeWidth = pxRound(series.width * pxRatio);\n\n\t\t\tlet multiPath = false;\n\n\t\t\tlet fillColors = null;\n\t\t\tlet fillPaths = null;\n\t\t\tlet strokeColors = null;\n\t\t\tlet strokePaths = null;\n\n\t\t\tif (dispFills != null && (strokeWidth == 0 || dispStrokes != null)) {\n\t\t\t\tmultiPath = true;\n\n\t\t\t\tfillColors = dispFills.values(u, seriesIdx, idx0, idx1);\n\t\t\t\tfillPaths = new Map();\n\t\t\t\t(new Set(fillColors)).forEach(color => {\n\t\t\t\t\tif (color != null)\n\t\t\t\t\t\tfillPaths.set(color, new Path2D());\n\t\t\t\t});\n\n\t\t\t\tif (strokeWidth > 0) {\n\t\t\t\t\tstrokeColors = dispStrokes.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tstrokePaths = new Map();\n\t\t\t\t\t(new Set(strokeColors)).forEach(color => {\n\t\t\t\t\t\tif (color != null)\n\t\t\t\t\t\t\tstrokePaths.set(color, new Path2D());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet { x0, size } = disp;\n\n\t\t\tif (x0 != null && size != null) {\n\t\t\t\t_align = 1;\n\t\t\t\tdataX = x0.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (x0.unit == 2)\n\t\t\t\t\tdataX = dataX.map(pct => u.posToVal(xOff + pct * xDim, scaleX.key, true));\n\n\t\t\t\t// assumes uniform sizes, for now\n\t\t\t\tlet sizes = size.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (size.unit == 2)\n\t\t\t\t\tbarWid = sizes[0] * xDim;\n\t\t\t\telse\n\t\t\t\t\tbarWid = valToPosX(sizes[0], scaleX, xDim, xOff) - valToPosX(0, scaleX, xDim, xOff); // assumes linear scale (delta from 0)\n\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid - barWid;\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid * gapFactor;\n\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t\tbarWid = colWid - fullGap;\n\t\t\t}\n\n\t\t\tif (fullGap < 1)\n\t\t\t\tfullGap = 0;\n\n\t\t\tif (strokeWidth >= barWid / 2)\n\t\t\t\tstrokeWidth = 0;\n\n\t\t\t// for small gaps, disable pixel snapping since gap inconsistencies become noticible and annoying\n\t\t\tif (fullGap < 5)\n\t\t\t\tpxRound = retArg0;\n\n\t\t\tlet insetStroke = fullGap > 0;\n\n\t\t\tlet rawBarWid = colWid - fullGap - (insetStroke ? strokeWidth : 0);\n\n\t\t\tbarWid = pxRound(clamp(rawBarWid, minWidth, maxWidth));\n\n\t\t\txShift = (_align == 0 ? barWid / 2 : _align == _dirX ? 0 : barWid) - _align * _dirX * ((_align == 0 ? extraGap / 2 : 0) + (insetStroke ? strokeWidth / 2 : 0));\n\n\n\t\t\tconst _paths = {stroke: null, fill: null, clip: null, band: null, gaps: null, flags: 0};  // disp, geom\n\n\t\t\tconst stroke = multiPath ? null : new Path2D();\n\n\t\t\tlet dataY0 = null;\n\n\t\t\tif (band != null)\n\t\t\t\tdataY0 = u.data[band.series[1]];\n\t\t\telse {\n\t\t\t\tlet { y0, y1 } = disp;\n\n\t\t\t\tif (y0 != null && y1 != null) {\n\t\t\t\t\tdataY = y1.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tdataY0 = y0.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet radVal = valRadius * barWid;\n\t\t\tlet radBase = baseRadius * barWid;\n\n\t\t\tfor (let i = _dirX == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += _dirX) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (dataY0 != null) {\n\t\t\t\t\tlet yVal0 = dataY0[i] ?? 0;\n\n\t\t\t\t\tif (yVal - yVal0 == 0)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tfillToY = valToPosY(yVal0, scaleY, yDim, yOff);\n\t\t\t\t}\n\n\t\t\t\tlet xVal = scaleX.distr != 2 || disp != null ? dataX[i] : i;\n\n\t\t\t\t// TODO: all xPos can be pre-computed once for all series in aligned set\n\t\t\t\tlet xPos = valToPosX(xVal, scaleX, xDim, xOff);\n\t\t\t\tlet yPos = valToPosY(ifNull(yVal, fillTo), scaleY, yDim, yOff);\n\n\t\t\t\tlet lft = pxRound(xPos - xShift);\n\t\t\t\tlet btm = pxRound(max(yPos, fillToY));\n\t\t\t\tlet top = pxRound(min(yPos, fillToY));\n\t\t\t\t// this includes the stroke\n\t\t\t\tlet barHgt = btm - top;\n\n\t\t\t\tif (yVal != null) {  // && yVal != fillTo (0 height bar)\n\t\t\t\t\tlet rv = yVal < 0 ? radBase : radVal;\n\t\t\t\t\tlet rb = yVal < 0 ? radVal : radBase;\n\n\t\t\t\t\tif (multiPath) {\n\t\t\t\t\t\tif (strokeWidth > 0 && strokeColors[i] != null)\n\t\t\t\t\t\t\trect(strokePaths.get(strokeColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\t\tif (fillColors[i] != null)\n\t\t\t\t\t\t\trect(fillPaths.get(fillColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\trect(stroke, lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\teach(u, seriesIdx, i,\n\t\t\t\t\t\tlft    - strokeWidth / 2,\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\tbarWid + strokeWidth,\n\t\t\t\t\t\tbarHgt,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strokeWidth > 0)\n\t\t\t\t_paths.stroke = multiPath ? strokePaths : stroke;\n\t\t\telse if (!multiPath) {\n\t\t\t\t_paths._fill = series.width == 0 ? series._fill : series._stroke ?? series._fill;\n\t\t\t\t_paths.width = 0;\n\t\t\t}\n\n\t\t\t_paths.fill = multiPath ? fillPaths : stroke;\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction splineInterp(interp, opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet moveTo, bezierCurveTo, lineTo;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tbezierCurveTo = bezierCurveToH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tbezierCurveTo = bezierCurveToV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet xCoords = [];\n\t\t\tlet yCoords = [];\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal != null) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet xPos = pixelForX(xVal);\n\n\t\t\t\t\txCoords.push(prevXPos = xPos);\n\t\t\t\t\tyCoords.push(pixelForY(dataY[i]));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst _paths = {stroke: interp(xCoords, yCoords, moveTo, lineTo, bezierCurveTo, pxRound), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPos, fillToY);\n\t\t\t\tlineTo(fill, firstXPos, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\n\t\t\t//  if FEAT_PATHS: false in rollup.config.js\n\t\t\t//\tu.ctx.save();\n\t\t\t//\tu.ctx.beginPath();\n\t\t\t//\tu.ctx.rect(u.bbox.left, u.bbox.top, u.bbox.width, u.bbox.height);\n\t\t\t//\tu.ctx.clip();\n\t\t\t//\tu.ctx.strokeStyle = u.series[sidx].stroke;\n\t\t\t//\tu.ctx.stroke(stroke);\n\t\t\t//\tu.ctx.fillStyle = u.series[sidx].fill;\n\t\t\t//\tu.ctx.fill(fill);\n\t\t\t//\tu.ctx.restore();\n\t\t\t//\treturn null;\n\t\t});\n\t};\n}\n\nfunction monotoneCubic(opts) {\n\treturn splineInterp(_monotoneCubic, opts);\n}\n\n// Monotone Cubic Spline interpolation, adapted from the Chartist.js implementation:\n// https://github.com/gionkunz/chartist-js/blob/e7e78201bffe9609915e5e53cfafa29a5d6c49f9/src/scripts/interpolation.js#L240-L369\nfunction _monotoneCubic(xs, ys, moveTo, lineTo, bezierCurveTo, pxRound) {\n\tconst n = xs.length;\n\n\tif (n < 2)\n\t\treturn null;\n\n\tconst path = new Path2D();\n\n\tmoveTo(path, xs[0], ys[0]);\n\n\tif (n == 2)\n\t\tlineTo(path, xs[1], ys[1]);\n\telse {\n\t\tlet ms  = Array(n),\n\t\t\tds  = Array(n - 1),\n\t\t\tdys = Array(n - 1),\n\t\t\tdxs = Array(n - 1);\n\n\t\t// calc deltas and derivative\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tdys[i] = ys[i + 1] - ys[i];\n\t\t\tdxs[i] = xs[i + 1] - xs[i];\n\t\t\tds[i]  = dys[i] / dxs[i];\n\t\t}\n\n\t\t// determine desired slope (m) at each point using Fritsch-Carlson method\n\t\t// http://math.stackexchange.com/questions/45218/implementation-of-monotone-cubic-interpolation\n\t\tms[0] = ds[0];\n\n\t\tfor (let i = 1; i < n - 1; i++) {\n\t\t\tif (ds[i] === 0 || ds[i - 1] === 0 || (ds[i - 1] > 0) !== (ds[i] > 0))\n\t\t\t\tms[i] = 0;\n\t\t\telse {\n\t\t\t\tms[i] = 3 * (dxs[i - 1] + dxs[i]) / (\n\t\t\t\t\t(2 * dxs[i] + dxs[i - 1]) / ds[i - 1] +\n\t\t\t\t\t(dxs[i] + 2 * dxs[i - 1]) / ds[i]\n\t\t\t\t);\n\n\t\t\t\tif (!isFinite(ms[i]))\n\t\t\t\t\tms[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\tms[n - 1] = ds[n - 2];\n\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tbezierCurveTo(\n\t\t\t\tpath,\n\t\t\t\txs[i] + dxs[i] / 3,\n\t\t\t\tys[i] + ms[i] * dxs[i] / 3,\n\t\t\t\txs[i + 1] - dxs[i] / 3,\n\t\t\t\tys[i + 1] - ms[i + 1] * dxs[i] / 3,\n\t\t\t\txs[i + 1],\n\t\t\t\tys[i + 1],\n\t\t\t);\n\t\t}\n\t}\n\n\treturn path;\n}\n\nconst cursorPlots = new Set();\n\nfunction invalidateRects() {\n\tfor (let u of cursorPlots)\n\t\tu.syncRect(true);\n}\n\nif (domEnv) {\n\ton(resize, win, invalidateRects);\n\ton(scroll, win, invalidateRects, true);\n\ton(dppxchange, win, () => { uPlot.pxRatio = pxRatio; });\n}\n\nconst linearPath = linear() ;\nconst pointsPath = points() ;\n\nfunction setDefaults(d, xo, yo, initY) {\n\tlet d2 = initY ? [d[0], d[1]].concat(d.slice(2)) : [d[0]].concat(d.slice(1));\n\treturn d2.map((o, i) => setDefault(o, i, xo, yo));\n}\n\nfunction setDefaults2(d, xyo) {\n\treturn d.map((o, i) => i == 0 ? {} : assign({}, xyo, o));  // todo: assign() will not merge facet arrays\n}\n\nfunction setDefault(o, i, xo, yo) {\n\treturn assign({}, (i == 0 ? xo : yo), o);\n}\n\nfunction snapNumX(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : [dataMin, dataMax];\n}\n\nconst snapTimeX = snapNumX;\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction snapNumY(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, rangePad, true);\n}\n\nfunction snapLogY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeLog(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapLogX = snapLogY;\n\nfunction snapAsinhY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeAsinh(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapAsinhX = snapAsinhY;\n\n// dim is logical (getClientBoundingRect) pixels, not canvas pixels\nfunction findIncr(minVal, maxVal, incrs, dim, minSpace) {\n\tlet intDigits = max(numIntDigits(minVal), numIntDigits(maxVal));\n\n\tlet delta = maxVal - minVal;\n\n\tlet incrIdx = closestIdx((minSpace / dim) * delta, incrs);\n\n\tdo {\n\t\tlet foundIncr = incrs[incrIdx];\n\t\tlet foundSpace = dim * foundIncr / delta;\n\n\t\tif (foundSpace >= minSpace && intDigits + (foundIncr < 5 ? fixedDec.get(foundIncr) : 0) <= 17)\n\t\t\treturn [foundIncr, foundSpace];\n\t} while (++incrIdx < incrs.length);\n\n\treturn [0, 0];\n}\n\nfunction pxRatioFont(font) {\n\tlet fontSize, fontSizeCss;\n\tfont = font.replace(/(\\d+)px/, (m, p1) => (fontSize = round((fontSizeCss = +p1) * pxRatio)) + 'px');\n\treturn [font, fontSize, fontSizeCss];\n}\n\nfunction syncFontSize(axis) {\n\tif (axis.show) {\n\t\t[axis.font, axis.labelFont].forEach(f => {\n\t\t\tlet size = roundDec(f[2] * pxRatio, 1);\n\t\t\tf[0] = f[0].replace(/[0-9.]+px/, size + 'px');\n\t\t\tf[1] = size;\n\t\t});\n\t}\n}\n\nfunction uPlot(opts, data, then) {\n\tconst self = {\n\t\tmode: ifNull(opts.mode, 1),\n\t};\n\n\tconst mode = self.mode;\n\n\tfunction getHPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? (1 - pct) : pct);\n\t}\n\n\tfunction getVPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? pct : (1 - pct));\n\t}\n\n\tfunction getPos(val, scale, dim, off) {\n\t\treturn scale.ori == 0 ? getHPos(val, scale, dim, off) : getVPos(val, scale, dim, off);\n\t}\n\n\tself.valToPosH = getHPos;\n\tself.valToPosV = getVPos;\n\n\tlet ready = false;\n\tself.status = 0;\n\n\tconst root = self.root = placeDiv(UPLOT);\n\n\tif (opts.id != null)\n\t\troot.id = opts.id;\n\n\taddClass(root, opts.class);\n\n\tif (opts.title) {\n\t\tlet title = placeDiv(TITLE, root);\n\t\ttitle.textContent = opts.title;\n\t}\n\n\tconst can = placeTag(\"canvas\");\n\tconst ctx = self.ctx = can.getContext(\"2d\");\n\n\tconst wrap = placeDiv(WRAP, root);\n\n\ton(\"click\", wrap, e => {\n\t\tif (e.target === over) {\n\t\t\tlet didDrag = mouseLeft1 != mouseLeft0 || mouseTop1 != mouseTop0;\n\t\t\tdidDrag && drag.click(self, e);\n\t\t}\n\t}, true);\n\n\tconst under = self.under = placeDiv(UNDER, wrap);\n\twrap.appendChild(can);\n\tconst over = self.over = placeDiv(OVER, wrap);\n\n\topts = copy(opts);\n\n\tconst pxAlign = +ifNull(opts.pxAlign, 1);\n\n\tconst pxRound = pxRoundGen(pxAlign);\n\n\t(opts.plugins || []).forEach(p => {\n\t\tif (p.opts)\n\t\t\topts = p.opts(self, opts) || opts;\n\t});\n\n\tconst ms = opts.ms || 1e-3;\n\n\tconst series  = self.series = mode == 1 ?\n\t\tsetDefaults(opts.series || [], xSeriesOpts, ySeriesOpts, false) :\n\t\tsetDefaults2(opts.series || [null], xySeriesOpts);\n\tconst axes    = self.axes   = setDefaults(opts.axes   || [], xAxisOpts,   yAxisOpts,    true);\n\tconst scales  = self.scales = {};\n\tconst bands   = self.bands  = opts.bands || [];\n\n\tbands.forEach(b => {\n\t\tb.fill = fnOrSelf(b.fill || null);\n\t\tb.dir = ifNull(b.dir, -1);\n\t});\n\n\tconst xScaleKey = mode == 2 ? series[1].facets[0].scale : series[0].scale;\n\n\tconst drawOrderMap = {\n\t\taxes: drawAxesGrid,\n\t\tseries: drawSeries,\n\t};\n\n\tconst drawOrder = (opts.drawOrder || [\"axes\", \"series\"]).map(key => drawOrderMap[key]);\n\n\tfunction initValToPct(sc) {\n\t\tconst getVal = (\n\t\t\tsc.distr == 3   ? val => log10(val > 0 ? val : sc.clamp(self, val, sc.min, sc.max, sc.key)) :\n\t\t\tsc.distr == 4   ? val => asinh(val, sc.asinh) :\n\t\t\tsc.distr == 100 ? val => sc.fwd(val) :\n\t\t\tval => val\n\t\t);\n\n\t\treturn val => {\n\t\t\tlet _val = getVal(val);\n\t\t\tlet { _min, _max } = sc;\n\t\t\tlet delta = _max - _min;\n\t\t\treturn (_val - _min) / delta;\n\t\t};\n\t}\n\n\tfunction initScale(scaleKey) {\n\t\tlet sc = scales[scaleKey];\n\n\t\tif (sc == null) {\n\t\t\tlet scaleOpts = (opts.scales || EMPTY_OBJ)[scaleKey] || EMPTY_OBJ;\n\n\t\t\tif (scaleOpts.from != null) {\n\t\t\t\t// ensure parent is initialized\n\t\t\t\tinitScale(scaleOpts.from);\n\t\t\t\t// dependent scales inherit\n\t\t\t\tlet sc = assign({}, scales[scaleOpts.from], scaleOpts, {key: scaleKey});\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t\tscales[scaleKey] = sc;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsc = scales[scaleKey] = assign({}, (scaleKey == xScaleKey ? xScaleOpts : yScaleOpts), scaleOpts);\n\n\t\t\t\tsc.key = scaleKey;\n\n\t\t\t\tlet isTime = sc.time;\n\n\t\t\t\tlet rn = sc.range;\n\n\t\t\t\tlet rangeIsArr = isArr(rn);\n\n\t\t\t\tif (scaleKey != xScaleKey || (mode == 2 && !isTime)) {\n\t\t\t\t\t// if range array has null limits, it should be auto\n\t\t\t\t\tif (rangeIsArr && (rn[0] == null || rn[1] == null)) {\n\t\t\t\t\t\trn = {\n\t\t\t\t\t\t\tmin: rn[0] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[0],\n\t\t\t\t\t\t\t\tsoft: rn[0],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmax: rn[1] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[1],\n\t\t\t\t\t\t\t\tsoft: rn[1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t\trangeIsArr = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rangeIsArr && isObj(rn)) {\n\t\t\t\t\t\tlet cfg = rn;\n\t\t\t\t\t\t// this is similar to snapNumY\n\t\t\t\t\t\trn = (self, dataMin, dataMax) => dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, cfg);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsc.range = fnOrSelf(rn || (isTime ? snapTimeX : scaleKey == xScaleKey ?\n\t\t\t\t\t(sc.distr == 3 ? snapLogX : sc.distr == 4 ? snapAsinhX : snapNumX) :\n\t\t\t\t\t(sc.distr == 3 ? snapLogY : sc.distr == 4 ? snapAsinhY : snapNumY)\n\t\t\t\t));\n\n\t\t\t\tsc.auto = fnOrSelf(rangeIsArr ? false : sc.auto);\n\n\t\t\t\tsc.clamp = fnOrSelf(sc.clamp || clampScale);\n\n\t\t\t\t// caches for expensive ops like asinh() & log()\n\t\t\t\tsc._min = sc._max = null;\n\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitScale(\"x\");\n\tinitScale(\"y\");\n\n\t// TODO: init scales from facets in mode: 2\n\tif (mode == 1) {\n\t\tseries.forEach(s => {\n\t\t\tinitScale(s.scale);\n\t\t});\n\t}\n\n\taxes.forEach(a => {\n\t\tinitScale(a.scale);\n\t});\n\n\tfor (let k in opts.scales)\n\t\tinitScale(k);\n\n\tconst scaleX = scales[xScaleKey];\n\n\tconst xScaleDistr = scaleX.distr;\n\n\tlet valToPosX, valToPosY;\n\n\tif (scaleX.ori == 0) {\n\t\taddClass(root, ORI_HZ);\n\t\tvalToPosX = getHPos;\n\t\tvalToPosY = getVPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotWid;\n\t\t\txOffCan = plotLft;\n\t\t\tyDimCan = plotHgt;\n\t\t\tyOffCan = plotTop;\n\n\t\t\txDimCss = plotWidCss;\n\t\t\txOffCss = plotLftCss;\n\t\t\tyDimCss = plotHgtCss;\n\t\t\tyOffCss = plotTopCss;\n\t\t};\n\t\t*/\n\t}\n\telse {\n\t\taddClass(root, ORI_VT);\n\t\tvalToPosX = getVPos;\n\t\tvalToPosY = getHPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotHgt;\n\t\t\txOffCan = plotTop;\n\t\t\tyDimCan = plotWid;\n\t\t\tyOffCan = plotLft;\n\n\t\t\txDimCss = plotHgtCss;\n\t\t\txOffCss = plotTopCss;\n\t\t\tyDimCss = plotWidCss;\n\t\t\tyOffCss = plotLftCss;\n\t\t};\n\t\t*/\n\t}\n\n\tconst pendScales = {};\n\n\t// explicitly-set initial scales\n\tfor (let k in scales) {\n\t\tlet sc = scales[k];\n\n\t\tif (sc.min != null || sc.max != null) {\n\t\t\tpendScales[k] = {min: sc.min, max: sc.max};\n\t\t\tsc.min = sc.max = null;\n\t\t}\n\t}\n\n//\tself.tz = opts.tz || Intl.DateTimeFormat().resolvedOptions().timeZone;\n\tconst _tzDate  = (opts.tzDate || (ts => new Date(round(ts / ms))));\n\tconst _fmtDate = (opts.fmtDate || fmtDate);\n\n\tconst _timeAxisSplits = (ms == 1 ? timeAxisSplitsMs(_tzDate) : timeAxisSplitsS(_tzDate));\n\tconst _timeAxisVals   = timeAxisVals(_tzDate, timeAxisStamps((ms == 1 ? _timeAxisStampsMs : _timeAxisStampsS), _fmtDate));\n\tconst _timeSeriesVal  = timeSeriesVal(_tzDate, timeSeriesStamp(_timeSeriesStamp, _fmtDate));\n\n\tconst activeIdxs = [];\n\n\tconst legend     = (self.legend = assign({}, legendOpts, opts.legend));\n\tconst cursor     =                (self.cursor = assign({}, cursorOpts, {drag: {y: mode == 2}}, opts.cursor));\n\tconst showLegend = legend.show;\n\tconst showCursor =                cursor.show;\n\tconst markers    = legend.markers;\n\n\t{\n\t\tlegend.idxs = activeIdxs;\n\n\t\tmarkers.width  = fnOrSelf(markers.width);\n\t\tmarkers.dash   = fnOrSelf(markers.dash);\n\t\tmarkers.stroke = fnOrSelf(markers.stroke);\n\t\tmarkers.fill   = fnOrSelf(markers.fill);\n\t}\n\n\tlet legendTable;\n\tlet legendHead;\n\tlet legendBody;\n\tlet legendRows = [];\n\tlet legendCells = [];\n\tlet legendCols;\n\tlet multiValLegend = false;\n\tlet NULL_LEGEND_VALUES = {};\n\n\tif (legend.live) {\n\t\tconst getMultiVals = series[1] ? series[1].values : null;\n\t\tmultiValLegend = getMultiVals != null;\n\t\tlegendCols = multiValLegend ? getMultiVals(self, 1, 0) : {_: 0};\n\n\t\tfor (let k in legendCols)\n\t\t\tNULL_LEGEND_VALUES[k] = LEGEND_DISP;\n\t}\n\n\tif (showLegend) {\n\t\tlegendTable = placeTag(\"table\", LEGEND, root);\n\t\tlegendBody = placeTag(\"tbody\", null, legendTable);\n\n\t\t// allows legend to be moved out of root\n\t\tlegend.mount(self, legendTable);\n\n\t\tif (multiValLegend) {\n\t\t\tlegendHead = placeTag(\"thead\", null, legendTable, legendBody);\n\n\t\t\tlet head = placeTag(\"tr\", null, legendHead);\n\t\t\tplaceTag(\"th\", null, head);\n\n\t\t\tfor (var key in legendCols)\n\t\t\t\tplaceTag(\"th\", LEGEND_LABEL, head).textContent = key;\n\t\t}\n\t\telse {\n\t\t\taddClass(legendTable, LEGEND_INLINE);\n\t\t\tlegend.live && addClass(legendTable, LEGEND_LIVE);\n\t\t}\n\t}\n\n\tconst son  = {show: true};\n\tconst soff = {show: false};\n\n\tfunction initLegendRow(s, i) {\n\t\tif (i == 0 && (multiValLegend || !legend.live || mode == 2))\n\t\t\treturn nullNullTuple;\n\n\t\tlet cells = [];\n\n\t\tlet row = placeTag(\"tr\", LEGEND_SERIES, legendBody, legendBody.childNodes[i]);\n\n\t\taddClass(row, s.class);\n\n\t\tif (!s.show)\n\t\t\taddClass(row, OFF);\n\n\t\tlet label = placeTag(\"th\", null, row);\n\n\t\tif (markers.show) {\n\t\t\tlet indic = placeDiv(LEGEND_MARKER, label);\n\n\t\t\tif (i > 0) {\n\t\t\t\tlet width  = markers.width(self, i);\n\n\t\t\t\tif (width)\n\t\t\t\t\tindic.style.border = width + \"px \" + markers.dash(self, i) + \" \" + markers.stroke(self, i);\n\n\t\t\t\tindic.style.background = markers.fill(self, i);\n\t\t\t}\n\t\t}\n\n\t\tlet text = placeDiv(LEGEND_LABEL, label);\n\n\t\tif (s.label instanceof HTMLElement)\n\t\t\ttext.appendChild(s.label);\n\t\telse\n\t\t\ttext.textContent = s.label;\n\n\t\tif (i > 0) {\n\t\t\tif (!markers.show)\n\t\t\t\ttext.style.color = s.width > 0 ? markers.stroke(self, i) : markers.fill(self, i);\n\n\t\t\tonMouse(\"click\", label, e => {\n\t\t\t\tif (cursor._lock)\n\t\t\t\t\treturn;\n\n\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\tlet seriesIdx = series.indexOf(s);\n\n\t\t\t\tif ((e.ctrlKey || e.metaKey) != legend.isolate) {\n\t\t\t\t\t// if any other series is shown, isolate this one. else show all\n\t\t\t\t\tlet isolate = series.some((s, i) => i > 0 && i != seriesIdx && s.show);\n\n\t\t\t\t\tseries.forEach((s, i) => {\n\t\t\t\t\t\ti > 0 && setSeries(i, isolate ? (i == seriesIdx ? son : soff) : son, true, syncOpts.setSeries);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsetSeries(seriesIdx, {show: !s.show}, true, syncOpts.setSeries);\n\t\t\t}, false);\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tonMouse(mouseenter, label, e => {\n\t\t\t\t\tif (cursor._lock)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\t\tsetSeries(series.indexOf(s), FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t\t\t}, false);\n\t\t\t}\n\t\t}\n\n\t\tfor (var key in legendCols) {\n\t\t\tlet v = placeTag(\"td\", LEGEND_VALUE, row);\n\t\t\tv.textContent = \"--\";\n\t\t\tcells.push(v);\n\t\t}\n\n\t\treturn [row, cells];\n\t}\n\n\tconst mouseListeners = new Map();\n\n\tfunction onMouse(ev, targ, fn, onlyTarg = true) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\t\tconst listener = cursor.bind[ev](self, targ, fn, onlyTarg);\n\n\t\tif (listener) {\n\t\t\ton(ev, targ, targListeners[ev] = listener);\n\t\t\tmouseListeners.set(targ, targListeners);\n\t\t}\n\t}\n\n\tfunction offMouse(ev, targ, fn) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\n\t\tfor (let k in targListeners) {\n\t\t\tif (ev == null || k == ev) {\n\t\t\t\toff(k, targ, targListeners[k]);\n\t\t\t\tdelete targListeners[k];\n\t\t\t}\n\t\t}\n\n\t\tif (ev == null)\n\t\t\tmouseListeners.delete(targ);\n\t}\n\n\tlet fullWidCss = 0;\n\tlet fullHgtCss = 0;\n\n\tlet plotWidCss = 0;\n\tlet plotHgtCss = 0;\n\n\t// plot margins to account for axes\n\tlet plotLftCss = 0;\n\tlet plotTopCss = 0;\n\n\t// previous values for diffing\n\tlet _plotLftCss = plotLftCss;\n\tlet _plotTopCss = plotTopCss;\n\tlet _plotWidCss = plotWidCss;\n\tlet _plotHgtCss = plotHgtCss;\n\n\n\tlet plotLft = 0;\n\tlet plotTop = 0;\n\tlet plotWid = 0;\n\tlet plotHgt = 0;\n\n\tself.bbox = {};\n\n\tlet shouldSetScales = false;\n\tlet shouldSetSize = false;\n\tlet shouldConvergeSize = false;\n\tlet shouldSetCursor = false;\n\tlet shouldSetSelect = false;\n\tlet shouldSetLegend = false;\n\n\tfunction _setSize(width, height, force) {\n\t\tif (force || (width != self.width || height != self.height))\n\t\t\tcalcSize(width, height);\n\n\t\tresetYSeries(false);\n\n\t\tshouldConvergeSize = true;\n\t\tshouldSetSize = true;\n\n\t\tcommit();\n\t}\n\n\tfunction calcSize(width, height) {\n\t//\tlog(\"calcSize()\", arguments);\n\n\t\tself.width  = fullWidCss = plotWidCss = width;\n\t\tself.height = fullHgtCss = plotHgtCss = height;\n\t\tplotLftCss  = plotTopCss = 0;\n\n\t\tcalcPlotRect();\n\t\tcalcAxesRects();\n\n\t\tlet bb = self.bbox;\n\n\t\tplotLft = bb.left   = incrRound(plotLftCss * pxRatio, 0.5);\n\t\tplotTop = bb.top    = incrRound(plotTopCss * pxRatio, 0.5);\n\t\tplotWid = bb.width  = incrRound(plotWidCss * pxRatio, 0.5);\n\t\tplotHgt = bb.height = incrRound(plotHgtCss * pxRatio, 0.5);\n\n\t//\tupdOriDims();\n\t}\n\n\t// ensures size calc convergence\n\tconst CYCLE_LIMIT = 3;\n\n\tfunction convergeSize() {\n\t\tlet converged = false;\n\n\t\tlet cycleNum = 0;\n\n\t\twhile (!converged) {\n\t\t\tcycleNum++;\n\n\t\t\tlet axesConverged = axesCalc(cycleNum);\n\t\t\tlet paddingConverged = paddingCalc(cycleNum);\n\n\t\t\tconverged = cycleNum == CYCLE_LIMIT || (axesConverged && paddingConverged);\n\n\t\t\tif (!converged) {\n\t\t\t\tcalcSize(self.width, self.height);\n\t\t\t\tshouldSetSize = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setSize({width, height}) {\n\t\t_setSize(width, height);\n\t}\n\n\tself.setSize = setSize;\n\n\t// accumulate axis offsets, reduce canvas width\n\tfunction calcPlotRect() {\n\t\t// easements for edge labels\n\t\tlet hasTopAxis = false;\n\t\tlet hasBtmAxis = false;\n\t\tlet hasRgtAxis = false;\n\t\tlet hasLftAxis = false;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet {side, _size} = axis;\n\t\t\t\tlet isVt = side % 2;\n\t\t\t\tlet labelSize = axis.label != null ? axis.labelSize : 0;\n\n\t\t\t\tlet fullSize = _size + labelSize;\n\n\t\t\t\tif (fullSize > 0) {\n\t\t\t\t\tif (isVt) {\n\t\t\t\t\t\tplotWidCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 3) {\n\t\t\t\t\t\t\tplotLftCss += fullSize;\n\t\t\t\t\t\t\thasLftAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasRgtAxis = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tplotHgtCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 0) {\n\t\t\t\t\t\t\tplotTopCss += fullSize;\n\t\t\t\t\t\t\thasTopAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasBtmAxis = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsidesWithAxes[0] = hasTopAxis;\n\t\tsidesWithAxes[1] = hasRgtAxis;\n\t\tsidesWithAxes[2] = hasBtmAxis;\n\t\tsidesWithAxes[3] = hasLftAxis;\n\n\t\t// hz padding\n\t\tplotWidCss -= _padding[1] + _padding[3];\n\t\tplotLftCss += _padding[3];\n\n\t\t// vt padding\n\t\tplotHgtCss -= _padding[2] + _padding[0];\n\t\tplotTopCss += _padding[0];\n\t}\n\n\tfunction calcAxesRects() {\n\t\t// will accum +\n\t\tlet off1 = plotLftCss + plotWidCss;\n\t\tlet off2 = plotTopCss + plotHgtCss;\n\t\t// will accum -\n\t\tlet off3 = plotLftCss;\n\t\tlet off0 = plotTopCss;\n\n\t\tfunction incrOffset(side, size) {\n\t\t\tswitch (side) {\n\t\t\t\tcase 1: off1 += size; return off1 - size;\n\t\t\t\tcase 2: off2 += size; return off2 - size;\n\t\t\t\tcase 3: off3 -= size; return off3 + size;\n\t\t\t\tcase 0: off0 -= size; return off0 + size;\n\t\t\t}\n\t\t}\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet side = axis.side;\n\n\t\t\t\taxis._pos = incrOffset(side, axis._size);\n\n\t\t\t\tif (axis.label != null)\n\t\t\t\t\taxis._lpos = incrOffset(side, axis.labelSize);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (cursor.dataIdx == null) {\n\t\tlet hov = cursor.hover;\n\n\t\tlet skip = hov.skip = new Set(hov.skip ?? []);\n\t\tskip.add(void 0); // alignment artifacts\n\t\tlet prox = hov.prox = fnOrSelf(hov.prox);\n\t\tlet bias = hov.bias ??= 0;\n\n\t\t// TODO: only scan between in-view idxs (i0, i1)\n\t\tcursor.dataIdx = (self, seriesIdx, cursorIdx, valAtPosX) => {\n\t\t\tif (seriesIdx == 0)\n\t\t\t\treturn cursorIdx;\n\n\t\t\tlet idx2 = cursorIdx;\n\n\t\t\tlet _prox = prox(self, seriesIdx, cursorIdx, valAtPosX) ?? inf;\n\t\t\tlet withProx = _prox >= 0 && _prox < inf;\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\t\tlet cursorLft = cursor.left;\n\n\t\t\tlet xValues = data[0];\n\t\t\tlet yValues = data[seriesIdx];\n\n\t\t\tif (skip.has(yValues[cursorIdx])) {\n\t\t\t\tidx2 = null;\n\n\t\t\t\tlet nonNullLft = null,\n\t\t\t\t\tnonNullRgt = null,\n\t\t\t\t\tj;\n\n\t\t\t\tif (bias == 0 || bias == -1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullLft == null && j-- > 0) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullLft = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (bias == 0 || bias == 1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullRgt == null && j++ < yValues.length) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullRgt = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (nonNullLft != null || nonNullRgt != null) {\n\t\t\t\t\tif (withProx) {\n\t\t\t\t\t\tlet lftPos = nonNullLft == null ? -Infinity : valToPosX(xValues[nonNullLft], scaleX, xDim, 0);\n\t\t\t\t\t\tlet rgtPos = nonNullRgt == null ?  Infinity : valToPosX(xValues[nonNullRgt], scaleX, xDim, 0);\n\n\t\t\t\t\t\tlet lftDelta = cursorLft - lftPos;\n\t\t\t\t\t\tlet rgtDelta = rgtPos - cursorLft;\n\n\t\t\t\t\t\tif (lftDelta <= rgtDelta) {\n\t\t\t\t\t\t\tif (lftDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullLft;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (rgtDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullRgt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tidx2 =\n\t\t\t\t\t\t\tnonNullRgt == null ? nonNullLft :\n\t\t\t\t\t\t\tnonNullLft == null ? nonNullRgt :\n\t\t\t\t\t\t\tcursorIdx - nonNullLft <= nonNullRgt - cursorIdx ? nonNullLft : nonNullRgt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (withProx) {\n\t\t\t\tlet dist = abs(cursorLft - valToPosX(xValues[cursorIdx], scaleX, xDim, 0));\n\n\t\t\t\tif (dist > _prox)\n\t\t\t\t\tidx2 = null;\n\t\t\t}\n\n\t\t\treturn idx2;\n\t\t};\n\t}\n\n\tconst setCursorEvent = e => { cursor.event = e; };\n\n\tcursor.idxs = activeIdxs;\n\n\tcursor._lock = false;\n\n\tlet points = cursor.points;\n\n\tpoints.show   = fnOrSelf(points.show);\n\tpoints.size   = fnOrSelf(points.size);\n\tpoints.stroke = fnOrSelf(points.stroke);\n\tpoints.width  = fnOrSelf(points.width);\n\tpoints.fill   = fnOrSelf(points.fill);\n\n\tconst focus = self.focus = assign({}, opts.focus || {alpha: 0.3}, cursor.focus);\n\n\tconst cursorFocus = focus.prox >= 0;\n\tconst cursorOnePt = cursorFocus && points.one;\n\n\t// series-intersection markers\n\tlet cursorPts = [];\n\t// position caches in CSS pixels\n\tlet cursorPtsLft = [];\n\tlet cursorPtsTop = [];\n\n\tfunction initCursorPt(s, si) {\n\t\tlet pt = points.show(self, si);\n\n\t\tif (pt instanceof HTMLElement) {\n\t\t\taddClass(pt, CURSOR_PT);\n\t\t\taddClass(pt, s.class);\n\t\t\telTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\tover.insertBefore(pt, cursorPts[si]);\n\n\t\t\treturn pt;\n\t\t}\n\t}\n\n\tfunction initSeries(s, i) {\n\t\tif (mode == 1 || i > 0) {\n\t\t\tlet isTime = mode == 1 && scales[s.scale].time;\n\n\t\t\tlet sv = s.value;\n\t\t\ts.value = isTime ? (isStr(sv) ? timeSeriesVal(_tzDate, timeSeriesStamp(sv, _fmtDate)) : sv || _timeSeriesVal) : sv || numSeriesVal;\n\t\t\ts.label = s.label || (isTime ? timeSeriesLabel : numSeriesLabel);\n\t\t}\n\n\t\tif (cursorOnePt || i > 0) {\n\t\t\ts.width  = s.width == null ? 1 : s.width;\n\t\t\ts.paths  = s.paths || linearPath || retNull;\n\t\t\ts.fillTo = fnOrSelf(s.fillTo || seriesFillTo);\n\t\t\ts.pxAlign = +ifNull(s.pxAlign, pxAlign);\n\t\t\ts.pxRound = pxRoundGen(s.pxAlign);\n\n\t\t\ts.stroke = fnOrSelf(s.stroke || null);\n\t\t\ts.fill   = fnOrSelf(s.fill || null);\n\t\t\ts._stroke = s._fill = s._paths = s._focus = null;\n\n\t\t\tlet _ptDia = ptDia(max(1, s.width), 1);\n\t\t\tlet points = s.points = assign({}, {\n\t\t\t\tsize: _ptDia,\n\t\t\t\twidth: max(1, _ptDia * .2),\n\t\t\t\tstroke: s.stroke,\n\t\t\t\tspace: _ptDia * 2,\n\t\t\t\tpaths: pointsPath,\n\t\t\t\t_stroke: null,\n\t\t\t\t_fill: null,\n\t\t\t}, s.points);\n\t\t\tpoints.show   = fnOrSelf(points.show);\n\t\t\tpoints.filter = fnOrSelf(points.filter);\n\t\t\tpoints.fill   = fnOrSelf(points.fill);\n\t\t\tpoints.stroke = fnOrSelf(points.stroke);\n\t\t\tpoints.paths  = fnOrSelf(points.paths);\n\t\t\tpoints.pxAlign = s.pxAlign;\n\t\t}\n\n\t\tif (showLegend) {\n\t\t\tlet rowCells = initLegendRow(s, i);\n\t\t\tlegendRows.splice(i, 0, rowCells[0]);\n\t\t\tlegendCells.splice(i, 0, rowCells[1]);\n\t\t\tlegend.values.push(null);\t// NULL_LEGEND_VALS not yet avil here :(\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 0, null);\n\n\t\t\tlet pt = null;\n\n\t\t\tif (cursorOnePt) {\n\t\t\t\tif (i == 0)\n\t\t\t\t\tpt = initCursorPt(s, i);\n\t\t\t}\n\t\t\telse if (i > 0)\n\t\t\t\tpt = initCursorPt(s, i);\n\n\t\t\tcursorPts.splice(i, 0, pt);\n\t\t\tcursorPtsLft.splice(i, 0, 0);\n\t\t\tcursorPtsTop.splice(i, 0, 0);\n\t\t}\n\n\t\tfire(\"addSeries\", i);\n\t}\n\n\tfunction addSeries(opts, si) {\n\t\tsi = si == null ? series.length : si;\n\n\t\topts = mode == 1 ? setDefault(opts, si, xSeriesOpts, ySeriesOpts) : setDefault(opts, si, {}, xySeriesOpts);\n\n\t\tseries.splice(si, 0, opts);\n\t\tinitSeries(series[si], si);\n\t}\n\n\tself.addSeries = addSeries;\n\n\tfunction delSeries(i) {\n\t\tseries.splice(i, 1);\n\n\t\tif (showLegend) {\n\t\t\tlegend.values.splice(i, 1);\n\n\t\t\tlegendCells.splice(i, 1);\n\t\t\tlet tr = legendRows.splice(i, 1)[0];\n\t\t\toffMouse(null, tr.firstChild);\n\t\t\ttr.remove();\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 1);\n\t\t\tcursorPts.splice(i, 1)[0].remove();\n\t\t\tcursorPtsLft.splice(i, 1);\n\t\t\tcursorPtsTop.splice(i, 1);\n\t\t}\n\n\t\t// TODO: de-init no-longer-needed scales?\n\n\t\tfire(\"delSeries\", i);\n\t}\n\n\tself.delSeries = delSeries;\n\n\tconst sidesWithAxes = [false, false, false, false];\n\n\tfunction initAxis(axis, i) {\n\t\taxis._show = axis.show;\n\n\t\tif (axis.show) {\n\t\t\tlet isVt = axis.side % 2;\n\n\t\t\tlet sc = scales[axis.scale];\n\n\t\t\t// this can occur if all series specify non-default scales\n\t\t\tif (sc == null) {\n\t\t\t\taxis.scale = isVt ? series[1].scale : xScaleKey;\n\t\t\t\tsc = scales[axis.scale];\n\t\t\t}\n\n\t\t\t// also set defaults for incrs & values based on axis distr\n\t\t\tlet isTime = sc.time;\n\n\t\t\taxis.size   = fnOrSelf(axis.size);\n\t\t\taxis.space  = fnOrSelf(axis.space);\n\t\t\taxis.rotate = fnOrSelf(axis.rotate);\n\n\t\t\tif (isArr(axis.incrs)) {\n\t\t\t\taxis.incrs.forEach(incr => {\n\t\t\t\t\t!fixedDec.has(incr) && fixedDec.set(incr, guessDec(incr));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\taxis.incrs  = fnOrSelf(axis.incrs  || (          sc.distr == 2 ? wholeIncrs : (isTime ? (ms == 1 ? timeIncrsMs : timeIncrsS) : numIncrs)));\n\t\t\taxis.splits = fnOrSelf(axis.splits || (isTime && sc.distr == 1 ? _timeAxisSplits : sc.distr == 3 ? logAxisSplits : sc.distr == 4 ? asinhAxisSplits : numAxisSplits));\n\n\t\t\taxis.stroke        = fnOrSelf(axis.stroke);\n\t\t\taxis.grid.stroke   = fnOrSelf(axis.grid.stroke);\n\t\t\taxis.ticks.stroke  = fnOrSelf(axis.ticks.stroke);\n\t\t\taxis.border.stroke = fnOrSelf(axis.border.stroke);\n\n\t\t\tlet av = axis.values;\n\n\t\t\taxis.values = (\n\t\t\t\t// static array of tick values\n\t\t\t\tisArr(av) && !isArr(av[0]) ? fnOrSelf(av) :\n\t\t\t\t// temporal\n\t\t\t\tisTime ? (\n\t\t\t\t\t// config array of fmtDate string tpls\n\t\t\t\t\tisArr(av) ?\n\t\t\t\t\t\ttimeAxisVals(_tzDate, timeAxisStamps(av, _fmtDate)) :\n\t\t\t\t\t// fmtDate string tpl\n\t\t\t\t\tisStr(av) ?\n\t\t\t\t\t\ttimeAxisVal(_tzDate, av) :\n\t\t\t\t\tav || _timeAxisVals\n\t\t\t\t) : av || numAxisVals\n\t\t\t);\n\n\t\t\taxis.filter = fnOrSelf(axis.filter || (          sc.distr >= 3 && sc.log == 10 ? log10AxisValsFilt : sc.distr == 3 && sc.log == 2 ? log2AxisValsFilt : retArg1));\n\n\t\t\taxis.font      = pxRatioFont(axis.font);\n\t\t\taxis.labelFont = pxRatioFont(axis.labelFont);\n\n\t\t\taxis._size   = axis.size(self, null, i, 0);\n\n\t\t\taxis._space  =\n\t\t\taxis._rotate =\n\t\t\taxis._incrs  =\n\t\t\taxis._found  =\t// foundIncrSpace\n\t\t\taxis._splits =\n\t\t\taxis._values = null;\n\n\t\t\tif (axis._size > 0) {\n\t\t\t\tsidesWithAxes[i] = true;\n\t\t\t\taxis._el = placeDiv(AXIS, wrap);\n\t\t\t}\n\n\t\t\t// debug\n\t\t//\taxis._el.style.background = \"#\"  + Math.floor(Math.random()*16777215).toString(16) + '80';\n\t\t}\n\t}\n\n\tfunction autoPadSide(self, side, sidesWithAxes, cycleNum) {\n\t\tlet [hasTopAxis, hasRgtAxis, hasBtmAxis, hasLftAxis] = sidesWithAxes;\n\n\t\tlet ori = side % 2;\n\t\tlet size = 0;\n\n\t\tif (ori == 0 && (hasLftAxis || hasRgtAxis))\n\t\t\tsize = (side == 0 && !hasTopAxis || side == 2 && !hasBtmAxis ? round(xAxisOpts.size / 3) : 0);\n\t\tif (ori == 1 && (hasTopAxis || hasBtmAxis))\n\t\t\tsize = (side == 1 && !hasRgtAxis || side == 3 && !hasLftAxis ? round(yAxisOpts.size / 2) : 0);\n\n\t\treturn size;\n\t}\n\n\tconst padding = self.padding = (opts.padding || [autoPadSide,autoPadSide,autoPadSide,autoPadSide]).map(p => fnOrSelf(ifNull(p, autoPadSide)));\n\tconst _padding = self._padding = padding.map((p, i) => p(self, i, sidesWithAxes, 0));\n\n\tlet dataLen;\n\n\t// rendered data window\n\tlet i0 = null;\n\tlet i1 = null;\n\tconst idxs = mode == 1 ? series[0].idxs : null;\n\n\tlet data0 = null;\n\n\tlet viaAutoScaleX = false;\n\n\tfunction setData(_data, _resetScales) {\n\t\tdata = _data == null ? [] : _data;\n\n\t\tself.data = self._data = data;\n\n\t\tif (mode == 2) {\n\t\t\tdataLen = 0;\n\t\t\tfor (let i = 1; i < series.length; i++)\n\t\t\t\tdataLen += data[i][0].length;\n\t\t}\n\t\telse {\n\t\t\tif (data.length == 0)\n\t\t\t\tself.data = self._data = data = [[]];\n\n\t\t\tdata0 = data[0];\n\t\t\tdataLen = data0.length;\n\n\t\t\tlet scaleData = data;\n\n\t\t\tif (xScaleDistr == 2) {\n\t\t\t\tscaleData = data.slice();\n\n\t\t\t\tlet _data0 = scaleData[0] = Array(dataLen);\n\t\t\t\tfor (let i = 0; i < dataLen; i++)\n\t\t\t\t\t_data0[i] = i;\n\t\t\t}\n\n\t\t\tself._data = data = scaleData;\n\t\t}\n\n\t\tresetYSeries(true);\n\n\t\tfire(\"setData\");\n\n\t\t// forces x axis tick values to re-generate when neither x scale nor y scale changes\n\t\t// in ordinal mode, scale range is by index, so will not change if new data has same length, but tick values are from data\n\t\tif (xScaleDistr == 2) {\n\t\t\tshouldConvergeSize = true;\n\n\t\t\t/* or somewhat cheaper, and uglier:\n\t\t\tif (ready) {\n\t\t\t\t// logic extracted from axesCalc()\n\t\t\t\tlet i = 0;\n\t\t\t\tlet axis = axes[i];\n\t\t\t\tlet _splits = axis._splits.map(i => data0[i]);\n\t\t\t\tlet [_incr, _space] = axis._found;\n\t\t\t\tlet incr = data0[_splits[1]] - data0[_splits[0]];\n\t\t\t\taxis._values = axis.values(self, axis.filter(self, _splits, i, _space, incr), i, _space, incr);\n\t\t\t}\n\t\t\t*/\n\t\t}\n\n\t\tif (_resetScales !== false) {\n\t\t\tlet xsc = scaleX;\n\n\t\t\tif (xsc.auto(self, viaAutoScaleX))\n\t\t\t\tautoScaleX();\n\t\t\telse\n\t\t\t\t_setScale(xScaleKey, xsc.min, xsc.max);\n\n\t\t\tshouldSetCursor = shouldSetCursor || cursor.left >= 0;\n\t\t\tshouldSetLegend = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setData = setData;\n\n\tfunction autoScaleX() {\n\t\tviaAutoScaleX = true;\n\n\t\tlet _min, _max;\n\n\t\tif (mode == 1) {\n\t\t\tif (dataLen > 0) {\n\t\t\t\ti0 = idxs[0] = 0;\n\t\t\t\ti1 = idxs[1] = dataLen - 1;\n\n\t\t\t\t_min = data[0][i0];\n\t\t\t\t_max = data[0][i1];\n\n\t\t\t\tif (xScaleDistr == 2) {\n\t\t\t\t\t_min = i0;\n\t\t\t\t\t_max = i1;\n\t\t\t\t}\n\t\t\t\telse if (_min == _max) {\n\t\t\t\t\tif (xScaleDistr == 3)\n\t\t\t\t\t\t[_min, _max] = rangeLog(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (xScaleDistr == 4)\n\t\t\t\t\t\t[_min, _max] = rangeAsinh(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (scaleX.time)\n\t\t\t\t\t\t_max = _min + round(86400 / ms);\n\t\t\t\t\telse\n\t\t\t\t\t\t[_min, _max] = rangeNum(_min, _max, rangePad, true);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ti0 = idxs[0] = _min = null;\n\t\t\t\ti1 = idxs[1] = _max = null;\n\t\t\t}\n\t\t}\n\n\t\t_setScale(xScaleKey, _min, _max);\n\t}\n\n\tlet ctxStroke, ctxFill, ctxWidth, ctxDash, ctxJoin, ctxCap, ctxFont, ctxAlign, ctxBaseline;\n\tlet ctxAlpha;\n\n\tfunction setCtxStyle(stroke, width, dash, cap, fill, join) {\n\t\tstroke ??= transparent;\n\t\tdash   ??= EMPTY_ARR;\n\t\tcap    ??= \"butt\"; // (â€¿|â€¿)\n\t\tfill   ??= transparent;\n\t\tjoin   ??= \"round\";\n\n\t\tif (stroke != ctxStroke)\n\t\t\tctx.strokeStyle = ctxStroke = stroke;\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (width != ctxWidth)\n\t\t\tctx.lineWidth = ctxWidth = width;\n\t\tif (join != ctxJoin)\n\t\t\tctx.lineJoin = ctxJoin = join;\n\t\tif (cap != ctxCap)\n\t\t\tctx.lineCap = ctxCap = cap;\n\t\tif (dash != ctxDash)\n\t\t\tctx.setLineDash(ctxDash = dash);\n\t}\n\n\tfunction setFontStyle(font, fill, align, baseline) {\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (font != ctxFont)\n\t\t\tctx.font = ctxFont = font;\n\t\tif (align != ctxAlign)\n\t\t\tctx.textAlign = ctxAlign = align;\n\t\tif (baseline != ctxBaseline)\n\t\t\tctx.textBaseline = ctxBaseline = baseline;\n\t}\n\n\tfunction accScale(wsc, psc, facet, data, sorted = 0) {\n\t\tif (data.length > 0 && wsc.auto(self, viaAutoScaleX) && (psc == null || psc.min == null)) {\n\t\t\tlet _i0 = ifNull(i0, 0);\n\t\t\tlet _i1 = ifNull(i1, data.length - 1);\n\n\t\t\t// only run getMinMax() for invalidated series data, else reuse\n\t\t\tlet minMax = facet.min == null ? getMinMax(data, _i0, _i1, sorted, wsc.distr == 3) : [facet.min, facet.max];\n\n\t\t\t// initial min/max\n\t\t\twsc.min = min(wsc.min, facet.min = minMax[0]);\n\t\t\twsc.max = max(wsc.max, facet.max = minMax[1]);\n\t\t}\n\t}\n\n\tconst AUTOSCALE = {min: null, max: null};\n\n\tfunction setScales() {\n\t//\tlog(\"setScales()\", arguments);\n\n\t\t// implicitly add auto scales, and unranged scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null &&\n\t\t\t\t(\n\t\t\t\t\t// scales that have never been set (on init)\n\t\t\t\t\tsc.min == null ||\n\t\t\t\t\t// or auto scales when the x scale was explicitly set\n\t\t\t\t\tpendScales[xScaleKey] != null && sc.auto(self, viaAutoScaleX)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t\t}\n\t\t}\n\n\t\t// implicitly add dependent scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null && sc.from != null && pendScales[sc.from] != null)\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t}\n\n\t\t// explicitly setting the x-scale invalidates everything (acts as redraw)\n\t\tif (pendScales[xScaleKey] != null)\n\t\t\tresetYSeries(true); // TODO: only reset series on auto scales?\n\n\t\tlet wipScales = {};\n\n\t\tfor (let k in pendScales) {\n\t\t\tlet psc = pendScales[k];\n\n\t\t\tif (psc != null) {\n\t\t\t\tlet wsc = wipScales[k] = copy(scales[k], fastIsObj);\n\n\t\t\t\tif (psc.min != null)\n\t\t\t\t\tassign(wsc, psc);\n\t\t\t\telse if (k != xScaleKey || mode == 2) {\n\t\t\t\t\tif (dataLen == 0 && wsc.from == null) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, null, null, k);\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\twsc.min = inf;\n\t\t\t\t\t\twsc.max = -inf;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (dataLen > 0) {\n\t\t\t// pre-range y-scales from y series' data values\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 1) {\n\t\t\t\t\tlet k = s.scale;\n\t\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\t\tif (psc == null)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tlet wsc = wipScales[k];\n\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, wsc.min, wsc.max, k);\n\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\n\t\t\t\t\t\ti0 = closestIdx(wsc.min, data[0]);\n\t\t\t\t\t\ti1 = closestIdx(wsc.max, data[0]);\n\n\t\t\t\t\t\t// don't try to contract same or adjacent idxs\n\t\t\t\t\t\tif (i1 - i0 > 1) {\n\t\t\t\t\t\t\t// closest indices can be outside of view\n\t\t\t\t\t\t\tif (data[0][i0] < wsc.min)\n\t\t\t\t\t\t\t\ti0++;\n\t\t\t\t\t\t\tif (data[0][i1] > wsc.max)\n\t\t\t\t\t\t\t\ti1--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ts.min = data0[i0];\n\t\t\t\t\t\ts.max = data0[i1];\n\t\t\t\t\t}\n\t\t\t\t\telse if (s.show && s.auto)\n\t\t\t\t\t\taccScale(wsc, psc, s, data[i], s.sorted);\n\n\t\t\t\t\ts.idxs[0] = i0;\n\t\t\t\t\ts.idxs[1] = i1;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tif (s.show && s.auto) {\n\t\t\t\t\t\t\t// TODO: only handles, assumes and requires facets[0] / 'x' scale, and facets[1] / 'y' scale\n\t\t\t\t\t\t\tlet [ xFacet, yFacet ] = s.facets;\n\t\t\t\t\t\t\tlet xScaleKey = xFacet.scale;\n\t\t\t\t\t\t\tlet yScaleKey = yFacet.scale;\n\t\t\t\t\t\t\tlet [ xData, yData ] = data[i];\n\n\t\t\t\t\t\t\tlet wscx = wipScales[xScaleKey];\n\t\t\t\t\t\t\tlet wscy = wipScales[yScaleKey];\n\n\t\t\t\t\t\t\t// null can happen when only x is zoomed, but y has static range and doesnt get auto-added to pending\n\t\t\t\t\t\t\twscx != null && accScale(wscx, pendScales[xScaleKey], xFacet, xData, xFacet.sorted);\n\t\t\t\t\t\t\twscy != null && accScale(wscy, pendScales[yScaleKey], yFacet, yData, yFacet.sorted);\n\n\t\t\t\t\t\t\t// temp\n\t\t\t\t\t\t\ts.min = yFacet.min;\n\t\t\t\t\t\t\ts.max = yFacet.max;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// range independent scales\n\t\t\tfor (let k in wipScales) {\n\t\t\t\tlet wsc = wipScales[k];\n\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\tif (wsc.from == null && (psc == null || psc.min == null)) {\n\t\t\t\t\tlet minMax = wsc.range(\n\t\t\t\t\t\tself,\n\t\t\t\t\t\twsc.min ==  inf ? null : wsc.min,\n\t\t\t\t\t\twsc.max == -inf ? null : wsc.max,\n\t\t\t\t\t\tk\n\t\t\t\t\t);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// range dependent scales\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\n\t\t\tif (wsc.from != null) {\n\t\t\t\tlet base = wipScales[wsc.from];\n\n\t\t\t\tif (base.min == null)\n\t\t\t\t\twsc.min = wsc.max = null;\n\t\t\t\telse {\n\t\t\t\t\tlet minMax = wsc.range(self, base.min, base.max, k);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet changed = {};\n\t\tlet anyChanged = false;\n\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (sc.min != wsc.min || sc.max != wsc.max) {\n\t\t\t\tsc.min = wsc.min;\n\t\t\t\tsc.max = wsc.max;\n\n\t\t\t\tlet distr = sc.distr;\n\n\t\t\t\tsc._min = distr == 3 ? log10(sc.min) : distr == 4 ? asinh(sc.min, sc.asinh) : distr == 100 ? sc.fwd(sc.min) : sc.min;\n\t\t\t\tsc._max = distr == 3 ? log10(sc.max) : distr == 4 ? asinh(sc.max, sc.asinh) : distr == 100 ? sc.fwd(sc.max) : sc.max;\n\n\t\t\t\tchanged[k] = anyChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (anyChanged) {\n\t\t\t// invalidate paths of all series on changed scales\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 2) {\n\t\t\t\t\tif (i > 0 && changed.y)\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (changed[s.scale])\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (let k in changed) {\n\t\t\t\tshouldConvergeSize = true;\n\t\t\t\tfire(\"setScale\", k);\n\t\t\t}\n\n\t\t\tif (showCursor && cursor.left >= 0)\n\t\t\t\tshouldSetCursor = shouldSetLegend = true;\n\t\t}\n\n\t\tfor (let k in pendScales)\n\t\t\tpendScales[k] = null;\n\t}\n\n\t// grabs the nearest indices with y data outside of x-scale limits\n\tfunction getOuterIdxs(ydata) {\n\t\tlet _i0 = clamp(i0 - 1, 0, dataLen - 1);\n\t\tlet _i1 = clamp(i1 + 1, 0, dataLen - 1);\n\n\t\twhile (ydata[_i0] == null && _i0 > 0)\n\t\t\t_i0--;\n\n\t\twhile (ydata[_i1] == null && _i1 < dataLen - 1)\n\t\t\t_i1++;\n\n\t\treturn [_i0, _i1];\n\t}\n\n\tfunction drawSeries() {\n\t\tif (dataLen > 0) {\n\t\t\tlet shouldAlpha = series.some(s => s._focus) && ctxAlpha != focus.alpha;\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = focus.alpha;\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tcacheStrokeFill(i, false);\n\t\t\t\t\tcacheStrokeFill(i, true);\n\n\t\t\t\t\tif (s._paths == null) {\n\t\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\t\tlet _idxs = mode == 2 ? [0, data[i][0].length - 1] : getOuterIdxs(data[i]);\n\t\t\t\t\t\ts._paths = s.paths(self, i, _idxs[0], _idxs[1]);\n\n\t\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\ts._paths != null && drawPath(i, false);\n\n\t\t\t\t\t{\n\t\t\t\t\t\tlet _gaps = s._paths != null ? s._paths.gaps : null;\n\n\t\t\t\t\t\tlet show = s.points.show(self, i, i0, i1, _gaps);\n\t\t\t\t\t\tlet idxs = s.points.filter(self, i, show, _gaps);\n\n\t\t\t\t\t\tif (show || idxs) {\n\t\t\t\t\t\t\ts.points._paths = s.points.paths(self, i, i0, i1, idxs);\n\t\t\t\t\t\t\tdrawPath(i, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\n\t\t\t\t\tfire(\"drawSeries\", i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = 1;\n\t\t}\n\t}\n\n\tfunction cacheStrokeFill(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\ts._stroke = s.stroke(self, si);\n\t\ts._fill   = s.fill(self, si);\n\t}\n\n\tfunction drawPath(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\tlet {\n\t\t\tstroke,\n\t\t\tfill,\n\t\t\tclip: gapsClip,\n\t\t\tflags,\n\n\t\t\t_stroke: strokeStyle = s._stroke,\n\t\t\t_fill:   fillStyle   = s._fill,\n\t\t\t_width:  width       = s.width,\n\t\t} = s._paths;\n\n\t\twidth = roundDec(width * pxRatio, 3);\n\n\t\tlet boundsClip = null;\n\t\tlet offset = (width % 2) / 2;\n\n\t\tif (_points && fillStyle == null)\n\t\t\tfillStyle = width > 0 ? \"#fff\" : strokeStyle;\n\n\t\tlet _pxAlign = s.pxAlign == 1 && offset > 0;\n\n\t\t_pxAlign && ctx.translate(offset, offset);\n\n\t\tif (!_points) {\n\t\t\tlet lft = plotLft - width / 2,\n\t\t\t\ttop = plotTop - width / 2,\n\t\t\t\twid = plotWid + width,\n\t\t\t\thgt = plotHgt + width;\n\n\t\t\tboundsClip = new Path2D();\n\t\t\tboundsClip.rect(lft, top, wid, hgt);\n\t\t}\n\n\t\t// the points pathbuilder's gapsClip is its boundsClip, since points dont need gaps clipping, and bounds depend on point size\n\t\tif (_points)\n\t\t\tstrokeFill(strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, gapsClip);\n\t\telse\n\t\t\tfillStroke(si, strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, boundsClip, gapsClip);\n\n\t\t_pxAlign && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction fillStroke(si, strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip) {\n\t\tlet didStrokeFill = false;\n\n\t\t// for all bands where this series is the top edge, create upwards clips using the bottom edges\n\t\t// and apply clips + fill with band fill or dfltFill\n\t\tflags != 0 && bands.forEach((b, bi) => {\n\t\t\t// isUpperEdge?\n\t\t\tif (b.series[0] == si) {\n\t\t\t\tlet lowerEdge = series[b.series[1]];\n\t\t\t\tlet lowerData = data[b.series[1]];\n\n\t\t\t\tlet bandClip = (lowerEdge._paths || EMPTY_OBJ).band;\n\n\t\t\t\tif (isArr(bandClip))\n\t\t\t\t\tbandClip = b.dir == 1 ? bandClip[0] : bandClip[1];\n\n\t\t\t\tlet gapsClip2;\n\n\t\t\t\tlet _fillStyle = null;\n\n\t\t\t\t// hasLowerEdge?\n\t\t\t\tif (lowerEdge.show && bandClip && hasData(lowerData, i0, i1)) {\n\t\t\t\t\t_fillStyle = b.fill(self, bi) || fillStyle;\n\t\t\t\t\tgapsClip2 = lowerEdge._paths.clip;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbandClip = null;\n\n\t\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, _fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip);\n\n\t\t\t\tdidStrokeFill = true;\n\t\t\t}\n\t\t});\n\n\t\tif (!didStrokeFill)\n\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip);\n\t}\n\n\tconst CLIP_FILL_STROKE = BAND_CLIP_FILL | BAND_CLIP_STROKE;\n\n\tfunction strokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip) {\n\t\tsetCtxStyle(strokeStyle, lineWidth, lineDash, lineCap, fillStyle);\n\n\t\tif (boundsClip || gapsClip || bandClip) {\n\t\t\tctx.save();\n\t\t\tboundsClip && ctx.clip(boundsClip);\n\t\t\tgapsClip && ctx.clip(gapsClip);\n\t\t}\n\n\t\tif (bandClip) {\n\t\t\tif ((flags & CLIP_FILL_STROKE) == CLIP_FILL_STROKE) {\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_STROKE) {\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_FILL) {\n\t\t\t\tctx.save();\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.restore();\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdoFill(fillStyle, fillPath);\n\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t}\n\n\t\tif (boundsClip || gapsClip || bandClip)\n\t\t\tctx.restore();\n\t}\n\n\tfunction doStroke(strokeStyle, strokePath, lineWidth) {\n\t\tif (lineWidth > 0) {\n\t\t\tif (strokePath instanceof Map) {\n\t\t\t\tstrokePath.forEach((strokePath, strokeStyle) => {\n\t\t\t\t\tctx.strokeStyle = ctxStroke = strokeStyle;\n\t\t\t\t\tctx.stroke(strokePath);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tstrokePath != null && strokeStyle && ctx.stroke(strokePath);\n\t\t}\n\t}\n\n\tfunction doFill(fillStyle, fillPath) {\n\t\tif (fillPath instanceof Map) {\n\t\t\tfillPath.forEach((fillPath, fillStyle) => {\n\t\t\t\tctx.fillStyle = ctxFill = fillStyle;\n\t\t\t\tctx.fill(fillPath);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\tfillPath != null && fillStyle && ctx.fill(fillPath);\n\t}\n\n\tfunction getIncrSpace(axisIdx, min, max, fullDim) {\n\t\tlet axis = axes[axisIdx];\n\n\t\tlet incrSpace;\n\n\t\tif (fullDim <= 0)\n\t\t\tincrSpace = [0, 0];\n\t\telse {\n\t\t\tlet minSpace = axis._space = axis.space(self, axisIdx, min, max, fullDim);\n\t\t\tlet incrs    = axis._incrs = axis.incrs(self, axisIdx, min, max, fullDim, minSpace);\n\t\t\tincrSpace    = findIncr(min, max, incrs, fullDim, minSpace);\n\t\t}\n\n\t\treturn (axis._found = incrSpace);\n\t}\n\n\tfunction drawOrthoLines(offs, filts, ori, side, pos0, len, width, stroke, dash, cap) {\n\t\tlet offset = (width % 2) / 2;\n\n\t\tpxAlign == 1 && ctx.translate(offset, offset);\n\n\t\tsetCtxStyle(stroke, width, dash, cap, stroke);\n\n\t\tctx.beginPath();\n\n\t\tlet x0, y0, x1, y1, pos1 = pos0 + (side == 0 || side == 3 ? -len : len);\n\n\t\tif (ori == 0) {\n\t\t\ty0 = pos0;\n\t\t\ty1 = pos1;\n\t\t}\n\t\telse {\n\t\t\tx0 = pos0;\n\t\t\tx1 = pos1;\n\t\t}\n\n\t\tfor (let i = 0; i < offs.length; i++) {\n\t\t\tif (filts[i] != null) {\n\t\t\t\tif (ori == 0)\n\t\t\t\t\tx0 = x1 = offs[i];\n\t\t\t\telse\n\t\t\t\t\ty0 = y1 = offs[i];\n\n\t\t\t\tctx.moveTo(x0, y0);\n\t\t\t\tctx.lineTo(x1, y1);\n\t\t\t}\n\t\t}\n\n\t\tctx.stroke();\n\n\t\tpxAlign == 1 && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction axesCalc(cycleNum) {\n\t//\tlog(\"axesCalc()\", arguments);\n\n\t\tlet converged = true;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (!axis.show)\n\t\t\t\treturn;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tif (scale.min == null) {\n\t\t\t\tif (axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = false;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = true;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet {min, max} = scale;\t\t// \t\t// should this toggle them ._show = false\n\n\t\t\tlet [_incr, _space] = getIncrSpace(i, min, max, ori == 0 ? plotWidCss : plotHgtCss);\n\n\t\t\tif (_space == 0)\n\t\t\t\treturn;\n\n\t\t\t// if we're using index positions, force first tick to match passed index\n\t\t\tlet forceMin = scale.distr == 2;\n\n\t\t\tlet _splits = axis._splits = axis.splits(self, i, min, max, _incr, _space, forceMin);\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet values = axis._values = axis.values(self, axis.filter(self, splits, i, _space, incr), i, _space, incr);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\taxis._rotate = side == 2 ? axis.rotate(self, values, i, _space) : 0;\n\n\t\t\tlet oldSize = axis._size;\n\n\t\t\taxis._size = ceil(axis.size(self, values, i, cycleNum));\n\n\t\t\tif (oldSize != null && axis._size != oldSize)\t\t\t// ready && ?\n\t\t\t\tconverged = false;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction paddingCalc(cycleNum) {\n\t\tlet converged = true;\n\n\t\tpadding.forEach((p, i) => {\n\t\t\tlet _p = p(self, i, sidesWithAxes, cycleNum);\n\n\t\t\tif (_p != _padding[i])\n\t\t\t\tconverged = false;\n\n\t\t\t_padding[i] = _p;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction drawAxesGrid() {\n\t\tfor (let i = 0; i < axes.length; i++) {\n\t\t\tlet axis = axes[i];\n\n\t\t\tif (!axis.show || !axis._show)\n\t\t\t\tcontinue;\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet x, y;\n\n\t\t\tlet fillStyle = axis.stroke(self, i);\n\n\t\t\tlet shiftDir = side == 0 || side == 3 ? -1 : 1;\n\n\t\t\tlet [_incr, _space] = axis._found;\n\n\t\t\t// axis label\n\t\t\tif (axis.label != null) {\n\t\t\t\tlet shiftAmt = axis.labelGap * shiftDir;\n\t\t\t\tlet baseLpos = round((axis._lpos + shiftAmt) * pxRatio);\n\n\t\t\t\tsetFontStyle(axis.labelFont[0], fillStyle, \"center\", side == 2 ? TOP : BOTTOM);\n\n\t\t\t\tctx.save();\n\n\t\t\t\tif (ori == 1) {\n\t\t\t\t\tx = y = 0;\n\n\t\t\t\t\tctx.translate(\n\t\t\t\t\t\tbaseLpos,\n\t\t\t\t\t\tround(plotTop + plotHgt / 2),\n\t\t\t\t\t);\n\t\t\t\t\tctx.rotate((side == 3 ? -PI : PI) / 2);\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tx = round(plotLft + plotWid / 2);\n\t\t\t\t\ty = baseLpos;\n\t\t\t\t}\n\n\t\t\t\tlet _label = isFn(axis.label) ? axis.label(self, i, _incr, _space) : axis.label;\n\n\t\t\t\tctx.fillText(_label, x, y);\n\n\t\t\t\tctx.restore();\n\t\t\t}\n\n\t\t\tif (_space == 0)\n\t\t\t\tcontinue;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tlet plotDim = ori == 0 ? plotWid : plotHgt;\n\t\t\tlet plotOff = ori == 0 ? plotLft : plotTop;\n\n\t\t\tlet _splits = axis._splits;\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet ticks = axis.ticks;\n\t\t\tlet border = axis.border;\n\t\t\tlet _tickSize = ticks.show ? ticks.size : 0;\n\t\t\tlet tickSize = round(_tickSize * pxRatio);\n\t\t\tlet axisGap = round((axis.alignTo == 2 ? axis._size - _tickSize - axis.gap : axis.gap) * pxRatio);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\tlet angle = axis._rotate * -PI/180;\n\n\t\t\tlet basePos  = pxRound(axis._pos * pxRatio);\n\t\t\tlet shiftAmt = (tickSize + axisGap) * shiftDir;\n\t\t\tlet finalPos = basePos + shiftAmt;\n\t\t\t    y        = ori == 0 ? finalPos : 0;\n\t\t\t    x        = ori == 1 ? finalPos : 0;\n\n\t\t\tlet font         = axis.font[0];\n\t\t\tlet textAlign    = axis.align == 1 ? LEFT :\n\t\t\t                   axis.align == 2 ? RIGHT :\n\t\t\t                   angle > 0 ? LEFT :\n\t\t\t                   angle < 0 ? RIGHT :\n\t\t\t                   ori == 0 ? \"center\" : side == 3 ? RIGHT : LEFT;\n\t\t\tlet textBaseline = angle ||\n\t\t\t                   ori == 1 ? \"middle\" : side == 2 ? TOP   : BOTTOM;\n\n\t\t\tsetFontStyle(font, fillStyle, textAlign, textBaseline);\n\n\t\t\tlet lineHeight = axis.font[1] * axis.lineGap;\n\n\t\t\tlet canOffs = _splits.map(val => pxRound(getPos(val, scale, plotDim, plotOff)));\n\n\t\t\tlet _values = axis._values;\n\n\t\t\tfor (let i = 0; i < _values.length; i++) {\n\t\t\t\tlet val = _values[i];\n\n\t\t\t\tif (val != null) {\n\t\t\t\t\tif (ori == 0)\n\t\t\t\t\t\tx = canOffs[i];\n\t\t\t\t\telse\n\t\t\t\t\t\ty = canOffs[i];\n\n\t\t\t\t\tval = \"\" + val;\n\n\t\t\t\t\tlet _parts = val.indexOf(\"\\n\") == -1 ? [val] : val.split(/\\n/gm);\n\n\t\t\t\t\tfor (let j = 0; j < _parts.length; j++) {\n\t\t\t\t\t\tlet text = _parts[j];\n\n\t\t\t\t\t\tif (angle) {\n\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\tctx.translate(x, y + j * lineHeight); // can this be replaced with position math?\n\t\t\t\t\t\t\tctx.rotate(angle); // can this be done once?\n\t\t\t\t\t\t\tctx.fillText(text, 0, 0);\n\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tctx.fillText(text, x, y + j * lineHeight);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// ticks\n\t\t\tif (ticks.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tticks.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tside,\n\t\t\t\t\tbasePos,\n\t\t\t\t\ttickSize,\n\t\t\t\t\troundDec(ticks.width * pxRatio, 3),\n\t\t\t\t\tticks.stroke(self, i),\n\t\t\t\t\tticks.dash,\n\t\t\t\t\tticks.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// grid\n\t\t\tlet grid = axis.grid;\n\n\t\t\tif (grid.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tgrid.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tori == 0 ? 2 : 1,\n\t\t\t\t\tori == 0 ? plotTop : plotLft,\n\t\t\t\t\tori == 0 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(grid.width * pxRatio, 3),\n\t\t\t\t\tgrid.stroke(self, i),\n\t\t\t\t\tgrid.dash,\n\t\t\t\t\tgrid.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (border.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\t[basePos],\n\t\t\t\t\t[1],\n\t\t\t\t\tori == 0 ? 1 : 0,\n\t\t\t\t\tori == 0 ? 1 : 2,\n\t\t\t\t\tori == 1 ? plotTop : plotLft,\n\t\t\t\t\tori == 1 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(border.width * pxRatio, 3),\n\t\t\t\t\tborder.stroke(self, i),\n\t\t\t\t\tborder.dash,\n\t\t\t\t\tborder.cap,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfire(\"drawAxes\");\n\t}\n\n\tfunction resetYSeries(minMax) {\n\t//\tlog(\"resetYSeries()\", arguments);\n\n\t\tseries.forEach((s, i) => {\n\t\t\tif (i > 0) {\n\t\t\t\ts._paths = null;\n\n\t\t\t\tif (minMax) {\n\t\t\t\t\tif (mode == 1) {\n\t\t\t\t\t\ts.min = null;\n\t\t\t\t\t\ts.max = null;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ts.facets.forEach(f => {\n\t\t\t\t\t\t\tf.min = null;\n\t\t\t\t\t\t\tf.max = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet queuedCommit = false;\n\tlet deferHooks = false;\n\tlet hooksQueue = [];\n\n\tfunction flushHooks() {\n\t\tdeferHooks = false;\n\n\t\tfor (let i = 0; i < hooksQueue.length; i++)\n\t\t\tfire(...hooksQueue[i]);\n\n\t\thooksQueue.length = 0;\n\t}\n\n\tfunction commit() {\n\t\tif (!queuedCommit) {\n\t\t\tmicroTask(_commit);\n\t\t\tqueuedCommit = true;\n\t\t}\n\t}\n\n\t// manual batching (aka immediate mode), skips microtask queue\n\tfunction batch(fn, _deferHooks = false) {\n\t\tqueuedCommit = true;\n\t\tdeferHooks = _deferHooks;\n\n\t\tfn(self);\n\t\t_commit();\n\n\t\tif (_deferHooks && hooksQueue.length > 0)\n\t\t\tqueueMicrotask(flushHooks);\n\t}\n\n\tself.batch = batch;\n\n\tfunction _commit() {\n\t//\tlog(\"_commit()\", arguments);\n\n\t\tif (shouldSetScales) {\n\t\t\tsetScales();\n\t\t\tshouldSetScales = false;\n\t\t}\n\n\t\tif (shouldConvergeSize) {\n\t\t\tconvergeSize();\n\t\t\tshouldConvergeSize = false;\n\t\t}\n\n\t\tif (shouldSetSize) {\n\t\t\tsetStylePx(under, LEFT,   plotLftCss);\n\t\t\tsetStylePx(under, TOP,    plotTopCss);\n\t\t\tsetStylePx(under, WIDTH,  plotWidCss);\n\t\t\tsetStylePx(under, HEIGHT, plotHgtCss);\n\n\t\t\tsetStylePx(over, LEFT,    plotLftCss);\n\t\t\tsetStylePx(over, TOP,     plotTopCss);\n\t\t\tsetStylePx(over, WIDTH,   plotWidCss);\n\t\t\tsetStylePx(over, HEIGHT,  plotHgtCss);\n\n\t\t\tsetStylePx(wrap, WIDTH,   fullWidCss);\n\t\t\tsetStylePx(wrap, HEIGHT,  fullHgtCss);\n\n\t\t\t// NOTE: mutating this during print preview in Chrome forces transparent\n\t\t\t// canvas pixels to white, even when followed up with clearRect() below\n\t\t\tcan.width  = round(fullWidCss * pxRatio);\n\t\t\tcan.height = round(fullHgtCss * pxRatio);\n\n\t\t\taxes.forEach(({ _el, _show, _size, _pos, side }) => {\n\t\t\t\tif (_el != null) {\n\t\t\t\t\tif (_show) {\n\t\t\t\t\t\tlet posOffset = (side === 3 || side === 0 ? _size : 0);\n\t\t\t\t\t\tlet isVt = side % 2 == 1;\n\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"left\"   : \"top\",    _pos - posOffset);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"width\"  : \"height\", _size);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"top\"    : \"left\",   isVt ? plotTopCss : plotLftCss);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"height\" : \"width\",  isVt ? plotHgtCss : plotWidCss);\n\n\t\t\t\t\t\tremClass(_el, OFF);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\taddClass(_el, OFF);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// invalidate ctx style cache\n\t\t\tctxStroke = ctxFill = ctxWidth = ctxJoin = ctxCap = ctxFont = ctxAlign = ctxBaseline = ctxDash = null;\n\t\t\tctxAlpha = 1;\n\n\t\t\tsyncRect(true);\n\n\t\t\tif (\n\t\t\t\tplotLftCss != _plotLftCss ||\n\t\t\t\tplotTopCss != _plotTopCss ||\n\t\t\t\tplotWidCss != _plotWidCss ||\n\t\t\t\tplotHgtCss != _plotHgtCss\n\t\t\t) {\n\t\t\t\tresetYSeries(false);\n\n\t\t\t\tlet pctWid = plotWidCss / _plotWidCss;\n\t\t\t\tlet pctHgt = plotHgtCss / _plotHgtCss;\n\n\t\t\t\tif (showCursor && !shouldSetCursor && cursor.left >= 0) {\n\t\t\t\t\tcursor.left *= pctWid;\n\t\t\t\t\tcursor.top  *= pctHgt;\n\n\t\t\t\t\tvCursor && elTrans(vCursor, round(cursor.left), 0, plotWidCss, plotHgtCss);\n\t\t\t\t\thCursor && elTrans(hCursor, 0, round(cursor.top), plotWidCss, plotHgtCss);\n\n\t\t\t\t\tfor (let i = 0; i < cursorPts.length; i++) {\n\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\tcursorPtsLft[i] *= pctWid;\n\t\t\t\t\t\t\tcursorPtsTop[i] *= pctHgt;\n\t\t\t\t\t\t\telTrans(pt, ceil(cursorPtsLft[i]), ceil(cursorPtsTop[i]), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (select.show && !shouldSetSelect && select.left >= 0 && select.width > 0) {\n\t\t\t\t\tselect.left   *= pctWid;\n\t\t\t\t\tselect.width  *= pctWid;\n\t\t\t\t\tselect.top    *= pctHgt;\n\t\t\t\t\tselect.height *= pctHgt;\n\n\t\t\t\t\tfor (let prop in _hideProps)\n\t\t\t\t\t\tsetStylePx(selectDiv, prop, select[prop]);\n\t\t\t\t}\n\n\t\t\t\t_plotLftCss = plotLftCss;\n\t\t\t\t_plotTopCss = plotTopCss;\n\t\t\t\t_plotWidCss = plotWidCss;\n\t\t\t\t_plotHgtCss = plotHgtCss;\n\t\t\t}\n\n\t\t\tfire(\"setSize\");\n\n\t\t\tshouldSetSize = false;\n\t\t}\n\n\t\tif (fullWidCss > 0 && fullHgtCss > 0) {\n\t\t\tctx.clearRect(0, 0, can.width, can.height);\n\t\t\tfire(\"drawClear\");\n\t\t\tdrawOrder.forEach(fn => fn());\n\t\t\tfire(\"draw\");\n\t\t}\n\n\t\tif (select.show && shouldSetSelect) {\n\t\t\tsetSelect(select);\n\t\t\tshouldSetSelect = false;\n\t\t}\n\n\t\tif (showCursor && shouldSetCursor) {\n\t\t\tupdateCursor(null, true, false);\n\t\t\tshouldSetCursor = false;\n\t\t}\n\n\t\tif (legend.show && legend.live && shouldSetLegend) {\n\t\t\tsetLegend();\n\t\t\tshouldSetLegend = false; // redundant currently\n\t\t}\n\n\t\tif (!ready) {\n\t\t\tready = true;\n\t\t\tself.status = 1;\n\n\t\t\tfire(\"ready\");\n\t\t}\n\n\t\tviaAutoScaleX = false;\n\n\t\tqueuedCommit = false;\n\t}\n\n\tself.redraw = (rebuildPaths, recalcAxes) => {\n\t\tshouldConvergeSize = recalcAxes || false;\n\n\t\tif (rebuildPaths !== false)\n\t\t\t_setScale(xScaleKey, scaleX.min, scaleX.max);\n\t\telse\n\t\t\tcommit();\n\t};\n\n\t// redraw() => setScale('x', scales.x.min, scales.x.max);\n\n\t// explicit, never re-ranged (is this actually true? for x and y)\n\tfunction setScale(key, opts) {\n\t\tlet sc = scales[key];\n\n\t\tif (sc.from == null) {\n\t\t\tif (dataLen == 0) {\n\t\t\t\tlet minMax = sc.range(self, opts.min, opts.max, key);\n\t\t\t\topts.min = minMax[0];\n\t\t\t\topts.max = minMax[1];\n\t\t\t}\n\n\t\t\tif (opts.min > opts.max) {\n\t\t\t\tlet _min = opts.min;\n\t\t\t\topts.min = opts.max;\n\t\t\t\topts.max = _min;\n\t\t\t}\n\n\t\t\tif (dataLen > 1 && opts.min != null && opts.max != null && opts.max - opts.min < 1e-16)\n\t\t\t\treturn;\n\n\t\t\tif (key == xScaleKey) {\n\t\t\t\tif (sc.distr == 2 && dataLen > 0) {\n\t\t\t\t\topts.min = closestIdx(opts.min, data[0]);\n\t\t\t\t\topts.max = closestIdx(opts.max, data[0]);\n\n\t\t\t\t\tif (opts.min == opts.max)\n\t\t\t\t\t\topts.max++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t//\tlog(\"setScale()\", arguments);\n\n\t\t\tpendScales[key] = opts;\n\n\t\t\tshouldSetScales = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setScale = setScale;\n\n//\tINTERACTION\n\n\tlet xCursor;\n\tlet yCursor;\n\tlet vCursor;\n\tlet hCursor;\n\n\t// starting position before cursor.move\n\tlet rawMouseLeft0;\n\tlet rawMouseTop0;\n\n\t// starting position\n\tlet mouseLeft0;\n\tlet mouseTop0;\n\n\t// current position before cursor.move\n\tlet rawMouseLeft1;\n\tlet rawMouseTop1;\n\n\t// current position\n\tlet mouseLeft1;\n\tlet mouseTop1;\n\n\tlet dragging = false;\n\n\tconst drag = cursor.drag;\n\n\tlet dragX = drag.x;\n\tlet dragY = drag.y;\n\n\tif (showCursor) {\n\t\tif (cursor.x)\n\t\t\txCursor = placeDiv(CURSOR_X, over);\n\t\tif (cursor.y)\n\t\t\tyCursor = placeDiv(CURSOR_Y, over);\n\n\t\tif (scaleX.ori == 0) {\n\t\t\tvCursor = xCursor;\n\t\t\thCursor = yCursor;\n\t\t}\n\t\telse {\n\t\t\tvCursor = yCursor;\n\t\t\thCursor = xCursor;\n\t\t}\n\n\t\tmouseLeft1 = cursor.left;\n\t\tmouseTop1 = cursor.top;\n\t}\n\n\tconst select = self.select = assign({\n\t\tshow:   true,\n\t\tover:   true,\n\t\tleft:   0,\n\t\twidth:  0,\n\t\ttop:    0,\n\t\theight: 0,\n\t}, opts.select);\n\n\tconst selectDiv = select.show ? placeDiv(SELECT, select.over ? over : under) : null;\n\n\tfunction setSelect(opts, _fire) {\n\t\tif (select.show) {\n\t\t\tfor (let prop in opts) {\n\t\t\t\tselect[prop] = opts[prop];\n\n\t\t\t\tif (prop in _hideProps)\n\t\t\t\t\tsetStylePx(selectDiv, prop, opts[prop]);\n\t\t\t}\n\n\t\t\t_fire !== false && fire(\"setSelect\");\n\t\t}\n\t}\n\n\tself.setSelect = setSelect;\n\n\tfunction toggleDOM(i) {\n\t\tlet s = series[i];\n\n\t\tif (s.show)\n\t\t\tshowLegend && remClass(legendRows[i], OFF);\n\t\telse {\n\t\t\tshowLegend && addClass(legendRows[i], OFF);\n\n\t\t\tif (showCursor) {\n\t\t\t\tlet pt = cursorOnePt ? cursorPts[0] : cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _setScale(key, min, max) {\n\t\tsetScale(key, {min, max});\n\t}\n\n\tfunction setSeries(i, opts, _fire, _pub) {\n\t//\tlog(\"setSeries()\", arguments);\n\n\t\tif (opts.focus != null)\n\t\t\tsetFocus(i);\n\n\t\tif (opts.show != null) {\n\t\t\tseries.forEach((s, si) => {\n\t\t\t\tif (si > 0 && (i == si || i == null)) {\n\t\t\t\t\ts.show = opts.show;\n\t\t\t\t\ttoggleDOM(si);\n\n\t\t\t\t\tif (mode == 2) {\n\t\t\t\t\t\t_setScale(s.facets[0].scale, null, null);\n\t\t\t\t\t\t_setScale(s.facets[1].scale, null, null);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\t_setScale(s.scale, null, null);\n\n\t\t\t\t\tcommit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_fire !== false && fire(\"setSeries\", i, opts);\n\n\t\t_pub && pubSync(\"setSeries\", self, i, opts);\n\t}\n\n\tself.setSeries = setSeries;\n\n\tfunction setBand(bi, opts) {\n\t\tassign(bands[bi], opts);\n\t}\n\n\tfunction addBand(opts, bi) {\n\t\topts.fill = fnOrSelf(opts.fill || null);\n\t\topts.dir = ifNull(opts.dir, -1);\n\t\tbi = bi == null ? bands.length : bi;\n\t\tbands.splice(bi, 0, opts);\n\t}\n\n\tfunction delBand(bi) {\n\t\tif (bi == null)\n\t\t\tbands.length = 0;\n\t\telse\n\t\t\tbands.splice(bi, 1);\n\t}\n\n\tself.addBand = addBand;\n\tself.setBand = setBand;\n\tself.delBand = delBand;\n\n\tfunction setAlpha(i, value) {\n\t\tseries[i].alpha = value;\n\n\t\tif (showCursor && cursorPts[i] != null)\n\t\t\tcursorPts[i].style.opacity = value;\n\n\t\tif (showLegend && legendRows[i])\n\t\t\tlegendRows[i].style.opacity = value;\n\t}\n\n\t// y-distance\n\tlet closestDist;\n\tlet closestSeries;\n\tlet focusedSeries;\n\tconst FOCUS_TRUE  = {focus: true};\n\n\tfunction setFocus(i) {\n\t\tif (i != focusedSeries) {\n\t\t//\tlog(\"setFocus()\", arguments);\n\n\t\t\tlet allFocused = i == null;\n\n\t\t\tlet _setAlpha = focus.alpha != 1;\n\n\t\t\tseries.forEach((s, i2) => {\n\t\t\t\tif (mode == 1 || i2 > 0) {\n\t\t\t\t\tlet isFocused = allFocused || i2 == 0 || i2 == i;\n\t\t\t\t\ts._focus = allFocused ? null : isFocused;\n\t\t\t\t\t_setAlpha && setAlpha(i2, isFocused ? 1 : focus.alpha);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfocusedSeries = i;\n\t\t\t_setAlpha && commit();\n\t\t}\n\t}\n\n\tif (showLegend && cursorFocus) {\n\t\tonMouse(mouseleave, legendTable, e => {\n\t\t\tif (cursor._lock)\n\t\t\t\treturn;\n\n\t\t\tsetCursorEvent(e);\n\n\t\t\tif (focusedSeries != null)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t});\n\t}\n\n\tfunction posToVal(pos, scale, can) {\n\t\tlet sc = scales[scale];\n\n\t\tif (can)\n\t\t\tpos = pos / pxRatio - (sc.ori == 1 ? plotTopCss : plotLftCss);\n\n\t\tlet dim = plotWidCss;\n\n\t\tif (sc.ori == 1) {\n\t\t\tdim = plotHgtCss;\n\t\t\tpos = dim - pos;\n\t\t}\n\n\t\tif (sc.dir == -1)\n\t\t\tpos = dim - pos;\n\n\t\tlet _min = sc._min,\n\t\t\t_max = sc._max,\n\t\t\tpct = pos / dim;\n\n\t\tlet sv = _min + (_max - _min) * pct;\n\n\t\tlet distr = sc.distr;\n\n\t\treturn (\n\t\t\tdistr == 3 ? pow(10, sv) :\n\t\t\tdistr == 4 ? sinh(sv, sc.asinh) :\n\t\t\tdistr == 100 ? sc.bwd(sv) :\n\t\t\tsv\n\t\t);\n\t}\n\n\tfunction closestIdxFromXpos(pos, can) {\n\t\tlet v = posToVal(pos, xScaleKey, can);\n\t\treturn closestIdx(v, data[0], i0, i1);\n\t}\n\n\tself.valToIdx = val => closestIdx(val, data[0]);\n\tself.posToIdx = closestIdxFromXpos;\n\tself.posToVal = posToVal;\n\tself.valToPos = (val, scale, can) => (\n\t\tscales[scale].ori == 0 ?\n\t\tgetHPos(val, scales[scale],\n\t\t\tcan ? plotWid : plotWidCss,\n\t\t\tcan ? plotLft : 0,\n\t\t) :\n\t\tgetVPos(val, scales[scale],\n\t\t\tcan ? plotHgt : plotHgtCss,\n\t\t\tcan ? plotTop : 0,\n\t\t)\n\t);\n\n\tself.setCursor = (opts, _fire, _pub) => {\n\t\tmouseLeft1 = opts.left;\n\t\tmouseTop1 = opts.top;\n\t//\tassign(cursor, opts);\n\t\tupdateCursor(null, _fire, _pub);\n\t};\n\n\tfunction setSelH(off, dim) {\n\t\tsetStylePx(selectDiv, LEFT,  select.left = off);\n\t\tsetStylePx(selectDiv, WIDTH, select.width = dim);\n\t}\n\n\tfunction setSelV(off, dim) {\n\t\tsetStylePx(selectDiv, TOP,    select.top = off);\n\t\tsetStylePx(selectDiv, HEIGHT, select.height = dim);\n\t}\n\n\tlet setSelX = scaleX.ori == 0 ? setSelH : setSelV;\n\tlet setSelY = scaleX.ori == 1 ? setSelH : setSelV;\n\n\tfunction syncLegend() {\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tif (i == 0 && multiValLegend)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet vals = legend.values[i];\n\n\t\t\t\tlet j = 0;\n\n\t\t\t\tfor (let k in vals)\n\t\t\t\t\tlegendCells[i][j++].firstChild.nodeValue = vals[k];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setLegend(opts, _fire) {\n\t\tif (opts != null) {\n\t\t\tif (opts.idxs) {\n\t\t\t\topts.idxs.forEach((didx, sidx) => {\n\t\t\t\t\tactiveIdxs[sidx] = didx;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!isUndef(opts.idx))\n\t\t\t\tactiveIdxs.fill(opts.idx);\n\n\t\t\tlegend.idx = activeIdxs[0];\n\t\t}\n\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let sidx = 0; sidx < series.length; sidx++) {\n\t\t\t\tif (sidx > 0 || mode == 1 && !multiValLegend)\n\t\t\t\t\tsetLegendValues(sidx, activeIdxs[sidx]);\n\t\t\t}\n\n\t\t\tsyncLegend();\n\t\t}\n\n\t\tshouldSetLegend = false;\n\n\t\t_fire !== false && fire(\"setLegend\");\n\t}\n\n\tself.setLegend = setLegend;\n\n\tfunction setLegendValues(sidx, idx) {\n\t\tlet s = series[sidx];\n\t\tlet src = sidx == 0 && xScaleDistr == 2 ? data0 : data[sidx];\n\t\tlet val;\n\n\t\tif (multiValLegend)\n\t\t\tval = s.values(self, sidx, idx) ?? NULL_LEGEND_VALUES;\n\t\telse {\n\t\t\tval = s.value(self, idx == null ? null : src[idx], sidx, idx);\n\t\t\tval = val == null ? NULL_LEGEND_VALUES : {_: val};\n\t\t}\n\n\t\tlegend.values[sidx] = val;\n\t}\n\n\tfunction updateCursor(src, _fire, _pub) {\n\t//\tts == null && log(\"updateCursor()\", arguments);\n\n\t\trawMouseLeft1 = mouseLeft1;\n\t\trawMouseTop1 = mouseTop1;\n\n\t\t[mouseLeft1, mouseTop1] = cursor.move(self, mouseLeft1, mouseTop1);\n\n\t\tcursor.left = mouseLeft1;\n\t\tcursor.top = mouseTop1;\n\n\t\tif (showCursor) {\n\t\t\tvCursor && elTrans(vCursor, round(mouseLeft1), 0, plotWidCss, plotHgtCss);\n\t\t\thCursor && elTrans(hCursor, 0, round(mouseTop1), plotWidCss, plotHgtCss);\n\t\t}\n\n\t\tlet idx;\n\n\t\t// when zooming to an x scale range between datapoints the binary search\n\t\t// for nearest min/max indices results in this condition. cheap hack :D\n\t\tlet noDataInRange = i0 > i1; // works for mode 1 only\n\n\t\tclosestDist = inf;\n\t\tclosestSeries = null;\n\n\t\t// TODO: extract\n\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\tlet yDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss;\n\n\t\t// if cursor hidden, hide points & clear legend vals\n\t\tif (mouseLeft1 < 0 || dataLen == 0 || noDataInRange) {\n\t\t\tidx = cursor.idx = null;\n\n\t\t\tfor (let i = 0; i < series.length; i++) {\n\t\t\t\tlet pt = cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\n\t\t\tif (cursorFocus)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, src == null && syncOpts.setSeries);\n\n\t\t\tif (legend.live) {\n\t\t\t\tactiveIdxs.fill(idx);\n\t\t\t\tshouldSetLegend = true;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t//\tlet pctY = 1 - (y / rect.height);\n\n\t\t\tlet mouseXPos, valAtPosX, xPos;\n\n\t\t\tif (mode == 1) {\n\t\t\t\tmouseXPos = scaleX.ori == 0 ? mouseLeft1 : mouseTop1;\n\t\t\t\tvalAtPosX = posToVal(mouseXPos, xScaleKey);\n\t\t\t\tidx = cursor.idx = closestIdx(valAtPosX, data[0], i0, i1);\n\t\t\t\txPos = valToPosX(data[0][idx], scaleX, xDim, 0);\n\t\t\t}\n\n\t\t\t// closest pt values\n\t\t\tlet _ptLft = -10;\n\t\t\tlet _ptTop = -10;\n\t\t\tlet _ptWid = 0;\n\t\t\tlet _ptHgt = 0;\n\t\t\tlet _centered = true;\n\t\t\tlet _ptFill = '';\n\t\t\tlet _ptStroke = '';\n\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tlet s = series[i];\n\n\t\t\t\tlet idx1  = activeIdxs[i];\n\t\t\t\tlet yVal1 = idx1 == null ? null : (mode == 1 ? data[i][idx1] : data[i][1][idx1]);\n\n\t\t\t\tlet idx2  = cursor.dataIdx(self, i, idx, valAtPosX);\n\t\t\t\tlet yVal2 = idx2 == null ? null : (mode == 1 ? data[i][idx2] : data[i][1][idx2]);\n\n\t\t\t\tshouldSetLegend = shouldSetLegend || yVal2 != yVal1 || idx2 != idx1;\n\n\t\t\t\tactiveIdxs[i] = idx2;\n\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet xPos2 = idx2 == null ? -10 : idx2 == idx ? xPos : valToPosX(mode == 1 ? data[0][idx2] : data[i][0][idx2], scaleX, xDim, 0);\n\n\t\t\t\t\t// this doesnt really work for state timeline, heatmap, status history (where the value maps to color, not y coords)\n\t\t\t\t\tlet yPos = yVal2 == null ? -10 : valToPosY(yVal2, mode == 1 ? scales[s.scale] : scales[s.facets[1].scale], yDim, 0);\n\n\t\t\t\t\tif (cursorFocus && yVal2 != null) {\n\t\t\t\t\t\tlet mouseYPos = scaleX.ori == 1 ? mouseLeft1 : mouseTop1;\n\t\t\t\t\t\tlet dist = abs(focus.dist(self, i, idx2, yPos, mouseYPos));\n\n\t\t\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t\t\tlet bias = focus.bias;\n\n\t\t\t\t\t\t\tif (bias != 0) {\n\t\t\t\t\t\t\t\tlet mouseYVal = posToVal(mouseYPos, s.scale);\n\n\t\t\t\t\t\t\t\tlet seriesYValSign = yVal2     >= 0 ? 1 : -1;\n\t\t\t\t\t\t\t\tlet mouseYValSign  = mouseYVal >= 0 ? 1 : -1;\n\n\t\t\t\t\t\t\t\t// with a focus bias, we will never cross zero when prox testing\n\t\t\t\t\t\t\t\t// it's either closest towards zero, or closest away from zero\n\t\t\t\t\t\t\t\tif (mouseYValSign == seriesYValSign && (\n\t\t\t\t\t\t\t\t\tmouseYValSign == 1 ?\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 >= mouseYVal : yVal2 <= mouseYVal) :  // >= 0\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 <= mouseYVal : yVal2 >= mouseYVal)    //  < 0\n\t\t\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldSetLegend || cursorOnePt) {\n\t\t\t\t\t\tlet hPos, vPos;\n\n\t\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\t\thPos = xPos2;\n\t\t\t\t\t\t\tvPos = yPos;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\thPos = yPos;\n\t\t\t\t\t\t\tvPos = xPos2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet ptWid, ptHgt, ptLft, ptTop,\n\t\t\t\t\t\t\tptStroke, ptFill,\n\t\t\t\t\t\t\tcentered = true,\n\t\t\t\t\t\t\tgetBBox = points.bbox;\n\n\t\t\t\t\t\tif (getBBox != null) {\n\t\t\t\t\t\t\tcentered = false;\n\n\t\t\t\t\t\t\tlet bbox = getBBox(self, i);\n\n\t\t\t\t\t\t\tptLft = bbox.left;\n\t\t\t\t\t\t\tptTop = bbox.top;\n\t\t\t\t\t\t\tptWid = bbox.width;\n\t\t\t\t\t\t\tptHgt = bbox.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tptLft = hPos;\n\t\t\t\t\t\t\tptTop = vPos;\n\t\t\t\t\t\t\tptWid = ptHgt = points.size(self, i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tptFill = points.fill(self, i);\n\t\t\t\t\t\tptStroke = points.stroke(self, i);\n\n\t\t\t\t\t\tif (cursorOnePt) {\n\t\t\t\t\t\t\tif (i == closestSeries && closestDist <= focus.prox) {\n\t\t\t\t\t\t\t\t_ptLft = ptLft;\n\t\t\t\t\t\t\t\t_ptTop = ptTop;\n\t\t\t\t\t\t\t\t_ptWid = ptWid;\n\t\t\t\t\t\t\t\t_ptHgt = ptHgt;\n\t\t\t\t\t\t\t\t_centered = centered;\n\t\t\t\t\t\t\t\t_ptFill = ptFill;\n\t\t\t\t\t\t\t\t_ptStroke = ptStroke;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\t\tcursorPtsLft[i] = ptLft;\n\t\t\t\t\t\t\t\tcursorPtsTop[i] = ptTop;\n\n\t\t\t\t\t\t\t\telSize(pt, ptWid, ptHgt, centered);\n\t\t\t\t\t\t\t\telColor(pt, ptFill, ptStroke);\n\t\t\t\t\t\t\t\telTrans(pt, ceil(ptLft), ceil(ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if only using single hover point (at cursorPts[0])\n\t\t\t// we have trigger styling at last visible series (once closestSeries is settled)\n\t\t\tif (cursorOnePt) {\n\t\t\t\t// some of this logic is similar to series focus below, since it matches the behavior by design\n\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tlet focusChanged = focusedSeries == null ? closestDist <= p : (closestDist > p || closestSeries != focusedSeries);\n\n\t\t\t\tif (shouldSetLegend || focusChanged) {\n\t\t\t\t\tlet pt = cursorPts[0];\n\n\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\tcursorPtsLft[0] = _ptLft;\n\t\t\t\t\t\tcursorPtsTop[0] = _ptTop;\n\n\t\t\t\t\t\telSize(pt, _ptWid, _ptHgt, _centered);\n\t\t\t\t\t\telColor(pt, _ptFill, _ptStroke);\n\t\t\t\t\t\telTrans(pt, ceil(_ptLft), ceil(_ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// nit: cursor.drag.setSelect is assumed always true\n\t\tif (select.show && dragging) {\n\t\t\tif (src != null) {\n\t\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\t\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\t\t\t\tlet [xKeySrc, yKeySrc] = src.cursor.sync.scales;\n\n\t\t\t\t// match the dragX/dragY implicitness/explicitness of src\n\t\t\t\tlet sdrag = src.cursor.drag;\n\t\t\t\tdragX = sdrag._x;\n\t\t\t\tdragY = sdrag._y;\n\n\t\t\t\tif (dragX || dragY) {\n\t\t\t\t\tlet { left, top, width, height } = src.select;\n\n\t\t\t\t\tlet sori = src.scales[xKeySrc].ori;\n\t\t\t\t\tlet sPosToVal = src.posToVal;\n\n\t\t\t\t\tlet sOff, sDim, sc, a, b;\n\n\t\t\t\t\tlet matchingX = xKey != null && matchXKeys(xKey, xKeySrc);\n\t\t\t\t\tlet matchingY = yKey != null && matchYKeys(yKey, yKeySrc);\n\n\t\t\t\t\tif (matchingX && dragX) {\n\t\t\t\t\t\tif (sori == 0) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[xKey];\n\n\t\t\t\t\t\ta = valToPosX(sPosToVal(sOff, xKeySrc),        sc, xDim, 0);\n\t\t\t\t\t\tb = valToPosX(sPosToVal(sOff + sDim, xKeySrc), sc, xDim, 0);\n\n\t\t\t\t\t\tsetSelX(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelX(0, xDim);\n\n\t\t\t\t\tif (matchingY && dragY) {\n\t\t\t\t\t\tif (sori == 1) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[yKey];\n\n\t\t\t\t\t\ta = valToPosY(sPosToVal(sOff, yKeySrc),        sc, yDim, 0);\n\t\t\t\t\t\tb = valToPosY(sPosToVal(sOff + sDim, yKeySrc), sc, yDim, 0);\n\n\t\t\t\t\t\tsetSelY(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\thideSelect();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet rawDX = abs(rawMouseLeft1 - rawMouseLeft0);\n\t\t\t\tlet rawDY = abs(rawMouseTop1 - rawMouseTop0);\n\n\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\tlet _rawDX = rawDX;\n\t\t\t\t\trawDX = rawDY;\n\t\t\t\t\trawDY = _rawDX;\n\t\t\t\t}\n\n\t\t\t\tdragX = drag.x && rawDX >= drag.dist;\n\t\t\t\tdragY = drag.y && rawDY >= drag.dist;\n\n\t\t\t\tlet uni = drag.uni;\n\n\t\t\t\tif (uni != null) {\n\t\t\t\t\t// only calc drag status if they pass the dist thresh\n\t\t\t\t\tif (dragX && dragY) {\n\t\t\t\t\t\tdragX = rawDX >= uni;\n\t\t\t\t\t\tdragY = rawDY >= uni;\n\n\t\t\t\t\t\t// force unidirectionality when both are under uni limit\n\t\t\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\t\t\tif (rawDY > rawDX)\n\t\t\t\t\t\t\t\tdragY = true;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdragX = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (drag.x && drag.y && (dragX || dragY))\n\t\t\t\t\t// if omni with no uni then both dragX / dragY should be true if either is true\n\t\t\t\t\tdragX = dragY = true;\n\n\t\t\t\tlet p0, p1;\n\n\t\t\t\tif (dragX) {\n\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelX(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragY)\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\n\t\t\t\tif (dragY) {\n\t\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelY(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragX)\n\t\t\t\t\t\tsetSelX(0, xDim);\n\t\t\t\t}\n\n\t\t\t\t// the drag didn't pass the dist requirement\n\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\tsetSelX(0, 0);\n\t\t\t\t\tsetSelY(0, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdrag._x = dragX;\n\t\tdrag._y = dragY;\n\n\t\tif (src == null) {\n\t\t\tif (_pub) {\n\t\t\t\tif (syncKey != null) {\n\t\t\t\t\tlet [xSyncKey, ySyncKey] = syncOpts.scales;\n\n\t\t\t\t\tsyncOpts.values[0] = xSyncKey != null ? posToVal(scaleX.ori == 0 ? mouseLeft1 : mouseTop1, xSyncKey) : null;\n\t\t\t\t\tsyncOpts.values[1] = ySyncKey != null ? posToVal(scaleX.ori == 1 ? mouseLeft1 : mouseTop1, ySyncKey) : null;\n\t\t\t\t}\n\n\t\t\t\tpubSync(mousemove, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, idx);\n\t\t\t}\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tlet shouldPub = _pub && syncOpts.setSeries;\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tif (focusedSeries == null) {\n\t\t\t\t\tif (closestDist <= p)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (closestDist > p)\n\t\t\t\t\t\tsetSeries(null, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t\telse if (closestSeries != focusedSeries)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (shouldSetLegend) {\n\t\t\tlegend.idx = idx;\n\t\t\tsetLegend();\n\t\t}\n\n\t\t_fire !== false && fire(\"setCursor\");\n\t}\n\n\tlet rect = null;\n\n\tObject.defineProperty(self, 'rect', {\n\t\tget() {\n\t\t\tif (rect == null)\n\t\t\t\tsyncRect(false);\n\n\t\t\treturn rect;\n\t\t},\n\t});\n\n\tfunction syncRect(defer = false) {\n\t\tif (defer)\n\t\t\trect = null;\n\t\telse {\n\t\t\trect = over.getBoundingClientRect();\n\t\t\tfire(\"syncRect\", rect);\n\t\t}\n\t}\n\n\tfunction mouseMove(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\t// Chrome on Windows has a bug which triggers a stray mousemove event after an initial mousedown event\n\t\t// when clicking into a plot as part of re-focusing the browser window.\n\t\t// we gotta ignore it to avoid triggering a phantom drag / setSelect\n\t\t// However, on touch-only devices Chrome-based browsers trigger a 0-distance mousemove before mousedown\n\t\t// so we don't ignore it when mousedown has set the dragging flag\n\t\tif (dragging && e != null && e.movementX == 0 && e.movementY == 0)\n\t\t\treturn;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, e != null);\n\n\t\tif (e != null)\n\t\t\tupdateCursor(null, true, true);\n\t\telse\n\t\t\tupdateCursor(src, true, false);\n\t}\n\n\tfunction cacheMouse(e, src, _l, _t, _w, _h, _i, initial, snap) {\n\t\tif (rect == null)\n\t\t\tsyncRect(false);\n\n\t\tsetCursorEvent(e);\n\n\t\tif (e != null) {\n\t\t\t_l = e.clientX - rect.left;\n\t\t\t_t = e.clientY - rect.top;\n\t\t}\n\t\telse {\n\t\t\tif (_l < 0 || _t < 0) {\n\t\t\t\tmouseLeft1 = -10;\n\t\t\t\tmouseTop1 = -10;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\n\t\t\tlet syncOptsSrc = src.cursor.sync;\n\t\t\tlet [xValSrc, yValSrc] = syncOptsSrc.values;\n\t\t\tlet [xKeySrc, yKeySrc] = syncOptsSrc.scales;\n\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\n\t\t\tlet rotSrc = src.axes[0].side % 2 == 1;\n\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss,\n\t\t\t\tyDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss,\n\t\t\t\t_xDim = rotSrc ? _h : _w,\n\t\t\t\t_yDim = rotSrc ? _w : _h,\n\t\t\t\t_xPos = rotSrc ? _t : _l,\n\t\t\t\t_yPos = rotSrc ? _l : _t;\n\n\t\t\tif (xKeySrc != null)\n\t\t\t\t_l = matchXKeys(xKey, xKeySrc) ? getPos(xValSrc, scales[xKey], xDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_l = xDim * (_xPos/_xDim);\n\n\t\t\tif (yKeySrc != null)\n\t\t\t\t_t = matchYKeys(yKey, yKeySrc) ? getPos(yValSrc, scales[yKey], yDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_t = yDim * (_yPos/_yDim);\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\tlet __l = _l;\n\t\t\t\t_l = _t;\n\t\t\t\t_t = __l;\n\t\t\t}\n\t\t}\n\n\t\tif (snap && (src == null || src.cursor.event.type == mousemove)) {\n\t\t\tif (_l <= 1 || _l >= plotWidCss - 1)\n\t\t\t\t_l = incrRound(_l, plotWidCss);\n\n\t\t\tif (_t <= 1 || _t >= plotHgtCss - 1)\n\t\t\t\t_t = incrRound(_t, plotHgtCss);\n\t\t}\n\n\t\tif (initial) {\n\t\t\trawMouseLeft0 = _l;\n\t\t\trawMouseTop0 = _t;\n\n\t\t\t[mouseLeft0, mouseTop0] = cursor.move(self, _l, _t);\n\t\t}\n\t\telse {\n\t\t\tmouseLeft1 = _l;\n\t\t\tmouseTop1 = _t;\n\t\t}\n\t}\n\n\tconst _hideProps = {\n\t\twidth: 0,\n\t\theight: 0,\n\t\tleft: 0,\n\t\ttop: 0,\n\t};\n\n\tfunction hideSelect() {\n\t\tsetSelect(_hideProps, false);\n\t}\n\n\tlet downSelectLeft;\n\tlet downSelectTop;\n\tlet downSelectWidth;\n\tlet downSelectHeight;\n\n\tfunction mouseDown(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = true;\n\t\tdragX = dragY = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, true, false);\n\n\t\tif (e != null) {\n\t\t\tonMouse(mouseup, doc, mouseUp, false);\n\t\t\tpubSync(mousedown, self, mouseLeft0, mouseTop0, plotWidCss, plotHgtCss, null);\n\t\t}\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tdownSelectLeft   = left;\n\t\tdownSelectTop    = top;\n\t\tdownSelectWidth  = width;\n\t\tdownSelectHeight = height;\n\n\t//\thideSelect();\n\t}\n\n\tfunction mouseUp(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, true);\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tlet hasSelect = width > 0 || height > 0;\n\t\tlet chgSelect = (\n\t\t\tdownSelectLeft   != left   ||\n\t\t\tdownSelectTop    != top    ||\n\t\t\tdownSelectWidth  != width  ||\n\t\t\tdownSelectHeight != height\n\t\t);\n\n\t\thasSelect && chgSelect && setSelect(select);\n\n\t\tif (drag.setScale && hasSelect && chgSelect) {\n\t\t//\tif (syncKey != null) {\n\t\t//\t\tdragX = drag.x;\n\t\t//\t\tdragY = drag.y;\n\t\t//\t}\n\n\t\t\tlet xOff = left,\n\t\t\t\txDim = width,\n\t\t\t\tyOff = top,\n\t\t\t\tyDim = height;\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\txOff = top,\n\t\t\t\txDim = height,\n\t\t\t\tyOff = left,\n\t\t\t\tyDim = width;\n\t\t\t}\n\n\t\t\tif (dragX) {\n\t\t\t\t_setScale(xScaleKey,\n\t\t\t\t\tposToVal(xOff, xScaleKey),\n\t\t\t\t\tposToVal(xOff + xDim, xScaleKey)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (dragY) {\n\t\t\t\tfor (let k in scales) {\n\t\t\t\t\tlet sc = scales[k];\n\n\t\t\t\t\tif (k != xScaleKey && sc.from == null && sc.min != inf) {\n\t\t\t\t\t\t_setScale(k,\n\t\t\t\t\t\t\tposToVal(yOff + yDim, k),\n\t\t\t\t\t\t\tposToVal(yOff, k)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideSelect();\n\t\t}\n\t\telse if (cursor.lock) {\n\t\t\tcursor._lock = !cursor._lock;\n\t\t\tupdateCursor(src, true, e != null);\n\t\t}\n\n\t\tif (e != null) {\n\t\t\toffMouse(mouseup, doc);\n\t\t\tpubSync(mouseup, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t\t}\n\t}\n\n\tfunction mouseLeave(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tlet _dragging = dragging;\n\n\t\tif (dragging) {\n\t\t\t// handle case when mousemove aren't fired all the way to edges by browser\n\t\t\tlet snapH = true;\n\t\t\tlet snapV = true;\n\t\t\tlet snapProx = 10;\n\n\t\t\tlet dragH, dragV;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tdragH = dragX;\n\t\t\t\tdragV = dragY;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdragH = dragY;\n\t\t\t\tdragV = dragX;\n\t\t\t}\n\n\t\t\tif (dragH && dragV) {\n\t\t\t\t// maybe omni corner snap\n\t\t\t\tsnapH = mouseLeft1 <= snapProx || mouseLeft1 >= plotWidCss - snapProx;\n\t\t\t\tsnapV = mouseTop1  <= snapProx || mouseTop1  >= plotHgtCss - snapProx;\n\t\t\t}\n\n\t\t\tif (dragH && snapH)\n\t\t\t\tmouseLeft1 = mouseLeft1 < mouseLeft0 ? 0 : plotWidCss;\n\n\t\t\tif (dragV && snapV)\n\t\t\t\tmouseTop1 = mouseTop1 < mouseTop0 ? 0 : plotHgtCss;\n\n\t\t\tupdateCursor(null, true, true);\n\n\t\t\tdragging = false;\n\t\t}\n\n\t\tmouseLeft1 = -10;\n\t\tmouseTop1 = -10;\n\n\t\tactiveIdxs.fill(null);\n\n\t\t// passing a non-null timestamp to force sync/mousemove event\n\t\tupdateCursor(null, true, true);\n\n\t\tif (_dragging)\n\t\t\tdragging = _dragging;\n\t}\n\n\tfunction dblClick(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tautoScaleX();\n\n\t\thideSelect();\n\n\t\tif (e != null)\n\t\t\tpubSync(dblclick, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t}\n\n\tfunction syncPxRatio() {\n\t\taxes.forEach(syncFontSize);\n\t\t_setSize(self.width, self.height, true);\n\t}\n\n\ton(dppxchange, win, syncPxRatio);\n\n\t// internal pub/sub\n\tconst events = {};\n\n\tevents.mousedown = mouseDown;\n\tevents.mousemove = mouseMove;\n\tevents.mouseup = mouseUp;\n\tevents.dblclick = dblClick;\n\tevents[\"setSeries\"] = (e, src, idx, opts) => {\n\t\tlet seriesIdxMatcher = syncOpts.match[2];\n\t\tidx = seriesIdxMatcher(self, src, idx);\n\t\tidx != -1 && setSeries(idx, opts, true, false);\n\t};\n\n\tif (showCursor) {\n\t\tonMouse(mousedown,  over, mouseDown);\n\t\tonMouse(mousemove,  over, mouseMove);\n\t\tonMouse(mouseenter, over, e => {\n\t\t\tsetCursorEvent(e);\n\t\t\tsyncRect(false);\n\t\t});\n\t\tonMouse(mouseleave, over, mouseLeave);\n\n\t\tonMouse(dblclick, over, dblClick);\n\n\t\tcursorPlots.add(self);\n\n\t\tself.syncRect = syncRect;\n\t}\n\n\t// external on/off\n\tconst hooks = self.hooks = opts.hooks || {};\n\n\tfunction fire(evName, a1, a2) {\n\t\tif (deferHooks)\n\t\t\thooksQueue.push([evName, a1, a2]);\n\t\telse {\n\t\t\tif (evName in hooks) {\n\t\t\t\thooks[evName].forEach(fn => {\n\t\t\t\t\tfn.call(null, self, a1, a2);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t(opts.plugins || []).forEach(p => {\n\t\tfor (let evName in p.hooks)\n\t\t\thooks[evName] = (hooks[evName] || []).concat(p.hooks[evName]);\n\t});\n\n\tconst seriesIdxMatcher = (self, src, srcSeriesIdx) => srcSeriesIdx;\n\n\tconst syncOpts = assign({\n\t\tkey: null,\n\t\tsetSeries: false,\n\t\tfilters: {\n\t\t\tpub: retTrue,\n\t\t\tsub: retTrue,\n\t\t},\n\t\tscales: [xScaleKey, series[1] ? series[1].scale : null],\n\t\tmatch: [retEq, retEq, seriesIdxMatcher],\n\t\tvalues: [null, null],\n\t}, cursor.sync);\n\n\tif (syncOpts.match.length == 2)\n\t\tsyncOpts.match.push(seriesIdxMatcher);\n\n\tcursor.sync = syncOpts;\n\n\tconst syncKey = syncOpts.key;\n\n\tconst sync = _sync(syncKey);\n\n\tfunction pubSync(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.pub(type, src, x, y, w, h, i))\n\t\t\tsync.pub(type, src, x, y, w, h, i);\n\t}\n\n\tsync.sub(self);\n\n\tfunction pub(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.sub(type, src, x, y, w, h, i))\n\t\t\tevents[type](null, src, x, y, w, h, i);\n\t}\n\n\tself.pub = pub;\n\n\tfunction destroy() {\n\t\tsync.unsub(self);\n\t\tcursorPlots.delete(self);\n\t\tmouseListeners.clear();\n\t\toff(dppxchange, win, syncPxRatio);\n\t\troot.remove();\n\t\tlegendTable?.remove(); // in case mounted outside of root\n\t\tfire(\"destroy\");\n\t}\n\n\tself.destroy = destroy;\n\n\tfunction _init() {\n\t\tfire(\"init\", opts, data);\n\n\t\tsetData(data || opts.data, false);\n\n\t\tif (pendScales[xScaleKey])\n\t\t\tsetScale(xScaleKey, pendScales[xScaleKey]);\n\t\telse\n\t\t\tautoScaleX();\n\n\t\tshouldSetSelect = select.show && (select.width > 0 || select.height > 0);\n\t\tshouldSetCursor = shouldSetLegend = true;\n\n\t\t_setSize(opts.width, opts.height);\n\t}\n\n\tseries.forEach(initSeries);\n\n\taxes.forEach(initAxis);\n\n\tif (then) {\n\t\tif (then instanceof HTMLElement) {\n\t\t\tthen.appendChild(root);\n\t\t\t_init();\n\t\t}\n\t\telse\n\t\t\tthen(self, _init);\n\t}\n\telse\n\t\t_init();\n\n\treturn self;\n}\n\nuPlot.assign = assign;\nuPlot.fmtNum = fmtNum;\nuPlot.rangeNum = rangeNum;\nuPlot.rangeLog = rangeLog;\nuPlot.rangeAsinh = rangeAsinh;\nuPlot.orient   = orient;\nuPlot.pxRatio = pxRatio;\n\n{\n\tuPlot.join = join;\n}\n\n{\n\tuPlot.fmtDate = fmtDate;\n\tuPlot.tzDate  = tzDate;\n}\n\nuPlot.sync = _sync;\n\n{\n\tuPlot.addGap = addGap;\n\tuPlot.clipGaps = clipGaps;\n\n\tlet paths = uPlot.paths = {\n\t\tpoints,\n\t};\n\n\t(paths.linear  = linear);\n\t(paths.stepped = stepped);\n\t(paths.bars    = bars);\n\t(paths.spline  = monotoneCubic);\n}\n\nexport { uPlot as default };\n","import uPlot from 'uplot';\nimport 'uplot/dist/uPlot.min.css';\n\nimport {\n  getThemeColors,\n  setupThemeObserver,\n  createResizeHandler,\n  setupResizeObserver,\n  formatPercentage,\n  formatRupiah,\n} from '../shared/chart-utils.js';\nimport { buildProgressDataset, buildCostDataset } from './dataset-builder.js';\n\nconst LOG_PREFIX = '[KurvaSUPlot]';\nconst DEFAULT_OPTIONS = {\n  height: 520,\n  enableCostView: true,\n};\n\nexport class KurvaSUPlotChart {\n  constructor(state, options = {}) {\n    this.state = state;\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n    this.viewMode = 'progress';\n    this.chartInstance = null;\n    this.container = null;\n    this.tooltipEl = null;\n    this.resizeHandler = null;\n    this.resizeObserver = null;\n    this.themeObserver = null;\n    this.currentDataset = null;\n    this.costData = null;\n    this.isLoadingCostData = false;\n\n    // Interaction helpers\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n    this._scaleBounds = null;\n    this._dateFormatter = null;\n  }\n\n  initialize(container) {\n    if (!container) {\n      console.error(LOG_PREFIX, 'Container element is required');\n      return false;\n    }\n\n    this.container = container;\n    if (getComputedStyle(container).position === 'static') {\n      this.container.style.position = 'relative';\n    }\n\n    this._createTooltip();\n\n    this.themeObserver = setupThemeObserver(() => this._rebuild());\n    this.resizeHandler = createResizeHandler(() => this.resize());\n    window.addEventListener('resize', this.resizeHandler);\n    this.resizeObserver = setupResizeObserver(container, () => this.resize());\n\n    const success = this.update();\n    if (!success) {\n      console.warn(LOG_PREFIX, 'Unable to render Kurva-S chart (no dataset)');\n    }\n    return true;\n  }\n\n  update(dataset) {\n    const resolvedDataset = dataset || buildProgressDataset(this.state);\n    if (!resolvedDataset) {\n      return false;\n    }\n    this.currentDataset = resolvedDataset;\n    this.viewMode = resolvedDataset.viewMode || this.viewMode || 'progress';\n\n    const transformedData = this._transformDataset(resolvedDataset);\n    const colors = getThemeColors();\n\n    if (!this.chartInstance) {\n      const options = this._buildChartOptions(resolvedDataset, colors);\n      this.chartInstance = new uPlot(options, transformedData, this.container);\n      this._updateScaleBounds();\n      this._attachInteractions();\n    } else {\n      this.chartInstance.setData(transformedData);\n      this._updateScaleBounds();\n    }\n\n    this._updateTooltipPosition();\n    return true;\n  }\n\n  resize() {\n    if (!this.chartInstance || !this.container) {\n      return;\n    }\n    this.chartInstance.setSize({\n      width: this.container.clientWidth || 800,\n      height: this.options.height,\n    });\n  }\n\n  async toggleView(mode) {\n    const nextMode = (mode || (this.viewMode === 'progress' ? 'cost' : 'progress')).toLowerCase();\n    if (nextMode === this.viewMode) {\n      return true;\n    }\n\n    if (nextMode === 'cost') {\n      if (!this.options.enableCostView) {\n        console.warn(LOG_PREFIX, 'Cost view disabled on uPlot chart');\n        return false;\n      }\n      if (!this.costData) {\n        const data = await this.fetchCostData();\n        if (!data) {\n          return false;\n        }\n      }\n      const costDataset = buildCostDataset(this.costData);\n      if (!costDataset) {\n        console.warn(LOG_PREFIX, 'Cost dataset not available');\n        return false;\n      }\n      this.viewMode = 'cost';\n      this.update(costDataset);\n      return true;\n    }\n\n    this.viewMode = 'progress';\n    this.update();\n    return true;\n  }\n\n  /**\n   * Render chart with monthly granularity\n   *\n   * Transforms weekly data to monthly for export purposes.\n   * Labels are displayed as M1, M2, M3... instead of W1, W2, W3...\n   *\n   * @param {Array} monthlyData - Monthly cumulative data\n   *   [{month: 1, label: 'M1', planned: 50, actual: 45}, ...]\n   * @returns {boolean} Success status\n   */\n  renderMonthlyMode(monthlyData) {\n    if (!Array.isArray(monthlyData) || monthlyData.length === 0) {\n      console.warn(LOG_PREFIX, 'Invalid monthly data');\n      return false;\n    }\n\n    console.log(LOG_PREFIX, `Rendering monthly mode with ${monthlyData.length} months`);\n\n    // Build dataset in uPlot format\n    const monthlyDataset = {\n      labels: monthlyData.map(m => m.label || `M${m.month}`),\n      planned: monthlyData.map(m => m.planned || 0),\n      actual: monthlyData.map(m => m.actual || 0),\n      viewMode: 'progress',\n      granularity: 'monthly'  // Mark as monthly for axis formatting\n    };\n\n    // Update chart with monthly data\n    return this.update(monthlyDataset);\n  }\n\n  /**\n   * Restore chart to weekly mode\n   *\n   * Re-renders chart with original weekly data.\n   *\n   * @param {Array} weeklyData - Weekly cumulative data (optional, uses state if not provided)\n   * @returns {boolean} Success status\n   */\n  renderWeeklyMode(weeklyData = null) {\n    console.log(LOG_PREFIX, 'Restoring weekly mode');\n\n    if (weeklyData) {\n      // Build dataset from provided weekly data\n      const weeklyDataset = {\n        labels: weeklyData.map((w, i) => `W${i + 1}`),\n        planned: weeklyData.map(w => w.planned || 0),\n        actual: weeklyData.map(w => w.actual || 0),\n        viewMode: 'progress',\n        granularity: 'weekly'\n      };\n      return this.update(weeklyDataset);\n    } else {\n      // Use original state data\n      return this.update();\n    }\n  }\n\n  dispose() {\n    this._detachInteractions();\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    if (this.resizeHandler) {\n      window.removeEventListener('resize', this.resizeHandler);\n      this.resizeHandler = null;\n    }\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n    if (this.themeObserver) {\n      this.themeObserver.disconnect();\n      this.themeObserver = null;\n    }\n    if (this.tooltipEl) {\n      this.tooltipEl.remove();\n      this.tooltipEl = null;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal helpers\n  // ---------------------------------------------------------------------------\n\n  _rebuild() {\n    if (!this.container) {\n      return;\n    }\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    this.update(this.currentDataset);\n  }\n\n  async fetchCostData() {\n    if (!this.options.enableCostView) {\n      console.log(LOG_PREFIX, 'Cost view disabled');\n      return null;\n    }\n\n    const projectId = this.state?.projectId;\n    if (!projectId) {\n      console.warn(LOG_PREFIX, 'Cannot load cost data without project ID');\n      return null;\n    }\n\n    if (this.isLoadingCostData) {\n      return null;\n    }\n\n    try {\n      this.isLoadingCostData = true;\n      const url = `/detail_project/api/v2/project/${projectId}/kurva-s-harga/`;\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      const data = await response.json();\n      if (data?.error) {\n        throw new Error(data.error);\n      }\n      this.costData = data;\n      console.log(LOG_PREFIX, 'Cost data loaded for uPlot chart');\n      return data;\n    } catch (error) {\n      console.error(LOG_PREFIX, 'Failed to load cost data:', error);\n      return null;\n    } finally {\n      this.isLoadingCostData = false;\n    }\n  }\n\n  _transformDataset(dataset) {\n    const xValues = dataset.labels.map((_, idx) => idx);\n    const planned = dataset.planned.map((value) => Number(value) || 0);\n\n    if (dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries)) {\n      const actualCost = dataset.acSeries.map((value) => Number(value) || 0);\n      return [xValues, planned, actualCost];\n    }\n\n    const actual = dataset.actual.map((value) => Number(value) || 0);\n    return [xValues, planned, actual];\n  }\n\n  _buildChartOptions(dataset, colors) {\n    const isCostView = dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries);\n    return {\n      width: this.container?.clientWidth || 800,\n      height: this.options.height,\n      scales: {\n        x: { time: false },\n        y: { auto: true },\n      },\n      axes: [\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          values: (u, vals) =>\n            vals.map((v) => {\n              if (!Number.isFinite(v)) {\n                return '';\n              }\n              const nearestIndex = Math.round(v);\n              if (Math.abs(v - nearestIndex) > 0.01) {\n                return '';\n              }\n              if (nearestIndex < 0 || nearestIndex >= dataset.labels.length) {\n                return '';\n              }\n              return dataset.labels[nearestIndex] || `Week ${nearestIndex + 1}`;\n            }),\n        },\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          label: isCostView ? '% of Total Cost' : 'Progress %',\n          values: (u, vals) => vals.map((v) => `${Math.round(v)}%`),\n        },\n      ],\n      legend: {\n        show: true,\n      },\n      series: [\n        {},\n        {\n          label: isCostView ? 'Rencana (PV)' : 'Rencana',\n          stroke: colors.plannedLine,\n          width: 2,\n          fill: colors.plannedArea,\n        },\n        isCostView\n          ? {\n              label: 'Realisasi (AC)',\n              stroke: colors.costActualLine || colors.actualLine,\n              width: 3,\n              fill: colors.costActualArea || colors.actualArea,\n            }\n          : {\n              label: 'Realisasi',\n              stroke: colors.actualLine,\n              width: 2,\n              fill: colors.actualArea,\n            },\n      ],\n      cursor: {\n        drag: { x: true, y: false },\n        focus: { prox: 32 },\n      },\n      select: {\n        show: true,\n      },\n      hooks: {\n        ready: [\n          () => {\n            this._updateScaleBounds();\n            this._attachInteractions();\n          },\n        ],\n        setCursor: [\n          (u) => this._updateTooltip(u),\n        ],\n        setScale: [\n          () => this._updateTooltipPosition(),\n        ],\n        dblclick: [\n          (u) => {\n            const first = u.data[0][0];\n            const last = u.data[0][u.data[0].length - 1];\n            u.setScale('x', { min: first, max: last });\n          },\n        ],\n      },\n    };\n  }\n\n  _attachInteractions() {\n    if (this._interactionAttached || !this.chartInstance) {\n      return;\n    }\n    const target = this.chartInstance.over || this.container;\n    if (!target) {\n      return;\n    }\n    this._interactionTarget = target;\n    this._wheelHandler = (event) => this._handleWheelInteraction(event);\n    target.addEventListener('wheel', this._wheelHandler, { passive: false });\n    this._interactionAttached = true;\n  }\n\n  _detachInteractions() {\n    if (this._interactionAttached && this._interactionTarget && this._wheelHandler) {\n      this._interactionTarget.removeEventListener('wheel', this._wheelHandler);\n    }\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n  }\n\n  _handleWheelInteraction(event) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const isZoomGesture = event.ctrlKey || event.metaKey;\n    const isPanGesture = !isZoomGesture && event.shiftKey;\n    if (!isZoomGesture && !isPanGesture) {\n      return;\n    }\n\n    event.preventDefault();\n\n    const bounds = this._scaleBounds;\n    const scale = this.chartInstance.scales?.x || {};\n    const currentMin = Number.isFinite(scale.min) ? scale.min : bounds.min;\n    const currentMax = Number.isFinite(scale.max) ? scale.max : bounds.max;\n\n    if (isZoomGesture) {\n      const zoomIntensity = 0.12;\n      const direction = event.deltaY > 0 ? 1 : -1;\n      const factor = Math.max(0.2, 1 + zoomIntensity * direction);\n\n      const overRect = (this.chartInstance.over || this.container).getBoundingClientRect();\n      const cursorX = event.clientX - overRect.left;\n      const cursorVal = this.chartInstance.posToVal(cursorX, 'x');\n      const resolvedCursor = Number.isFinite(cursorVal) ? cursorVal : (currentMin + currentMax) / 2;\n\n      const newMin = resolvedCursor - (resolvedCursor - currentMin) * factor;\n      const newMax = resolvedCursor + (currentMax - resolvedCursor) * factor;\n      this._setScaleBounded(newMin, newMax);\n      return;\n    }\n\n    const range = currentMax - currentMin;\n    const panStep = Math.max(1, range * 0.15);\n    const delta = event.deltaY > 0 ? panStep : -panStep;\n    this._setScaleBounded(currentMin + delta, currentMax + delta);\n  }\n\n  _setScaleBounded(targetMin, targetMax) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const bounds = this._scaleBounds;\n    const boundsSpan = bounds.max - bounds.min;\n    if (boundsSpan <= 0) {\n      return;\n    }\n\n    const minWindow = 1;\n    let minVal = Math.min(targetMin, targetMax);\n    let maxVal = Math.max(targetMin, targetMax);\n    let windowSize = Math.max(minWindow, maxVal - minVal);\n\n    if (windowSize > boundsSpan) {\n      windowSize = boundsSpan;\n    }\n\n    minVal = Math.max(bounds.min, Math.min(minVal, bounds.max - windowSize));\n    maxVal = minVal + windowSize;\n    if (maxVal > bounds.max) {\n      maxVal = bounds.max;\n      minVal = maxVal - windowSize;\n    }\n\n    this.chartInstance.setScale('x', { min: minVal, max: maxVal });\n  }\n\n  _updateScaleBounds() {\n    if (!this.chartInstance || !Array.isArray(this.chartInstance.data?.[0])) {\n      return;\n    }\n    const xValues = this.chartInstance.data[0];\n    if (!xValues.length) {\n      return;\n    }\n    this._scaleBounds = {\n      min: xValues[0],\n      max: xValues[xValues.length - 1],\n    };\n  }\n\n  _createTooltip() {\n    const tooltip = document.createElement('div');\n    tooltip.className = 'kurva-s-tooltip';\n    tooltip.style.position = 'absolute';\n    tooltip.style.pointerEvents = 'none';\n    tooltip.style.padding = '8px 10px';\n    tooltip.style.borderRadius = '6px';\n    tooltip.style.background = 'rgba(15, 23, 42, 0.85)';\n    tooltip.style.color = '#fff';\n    tooltip.style.fontSize = '12px';\n    tooltip.style.transform = 'translate(-50%, -100%)';\n    tooltip.style.opacity = '0';\n    tooltip.style.transition = 'opacity 0.15s ease';\n\n    this.tooltipEl = tooltip;\n    this.container.appendChild(tooltip);\n  }\n\n  _updateTooltip(u) {\n    if (!this.tooltipEl || !this.currentDataset) {\n      return;\n    }\n\n    const idx = u.cursor.idx;\n    if (idx == null || idx < 0 || idx >= this.currentDataset.labels.length) {\n      this.tooltipEl.style.opacity = '0';\n      return;\n    }\n\n    const labels = this.currentDataset.labels || [];\n    const label = labels[idx] || `Week ${idx + 1}`;\n    const planned = this.currentDataset.planned[idx] ?? 0;\n    const detailArray = Array.isArray(this.currentDataset.details) ? this.currentDataset.details : null;\n    const detailObject = !detailArray && this.currentDataset.details ? this.currentDataset.details : {};\n    const totalCost = Number(detailObject.totalCost || this.currentDataset.totalBiaya || 0) || 0;\n    const weeklyCostSummary = Array.isArray(detailObject.weeklySummary) ? detailObject.weeklySummary : null;\n    const summaryEntry = weeklyCostSummary ? weeklyCostSummary[idx] : null;\n    const isCostView = (this.viewMode || this.currentDataset.viewMode) === 'cost';\n\n    const htmlParts = [\n      `<div style=\"font-weight:600;margin-bottom:4px;\">${label}</div>`,\n    ];\n\n    if (isCostView) {\n      const acSeries = Array.isArray(this.currentDataset.acSeries)\n        ? this.currentDataset.acSeries\n        : this.currentDataset.actual || [];\n      const actual = acSeries[idx] ?? 0;\n      const variance = summaryEntry?.variancePercent ?? Number((actual - planned).toFixed(2));\n      const plannedWeek = Array.isArray(detailObject.weeks) ? detailObject.weeks[idx] : null;\n      const actualWeek = Array.isArray(detailObject.actualWeeks) ? detailObject.actualWeeks[idx] : null;\n      const rangeText = this._formatWeekRange(plannedWeek, actualWeek);\n      const plannedAmount =\n        typeof summaryEntry?.plannedCostValue === 'number'\n          ? formatRupiah(summaryEntry.plannedCostValue)\n          : this._resolveCostAmount(plannedWeek, planned, totalCost);\n      const actualAmount =\n        typeof summaryEntry?.actualCostValue === 'number'\n          ? formatRupiah(summaryEntry.actualCostValue)\n          : this._resolveCostAmount(actualWeek, actual, totalCost);\n      const varianceAmount =\n        typeof summaryEntry?.varianceCostValue === 'number'\n          ? formatRupiah(summaryEntry.varianceCostValue)\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n      htmlParts.push(\n        `<div>Rencana (PV): <strong>${formatPercentage(planned)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span></div>`,\n        `<div>Realisasi (AC): <strong>${formatPercentage(actual)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span></div>`,\n        `<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${varianceAmount ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`,\n      );\n    } else {\n      const actual = this.currentDataset.actual[idx] ?? 0;\n      const variance = Number((actual - planned).toFixed(2));\n      const detail = detailArray ? detailArray[idx] : null;\n      const startLabel = detail?.start ? this._formatDateLabel(detail.start) : '';\n      const endLabel = detail?.end ? this._formatDateLabel(detail.end) : '';\n      const rangeText = this._composeRangeText(startLabel, endLabel);\n      const useHarga = Boolean(this.currentDataset.useHargaCalculation && totalCost > 0);\n      const plannedAmountValue =\n        typeof detail?.plannedCostValue === 'number' ? detail.plannedCostValue : (totalCost * planned) / 100;\n      const actualAmountValue =\n        typeof detail?.actualCostValue === 'number' ? detail.actualCostValue : (totalCost * actual) / 100;\n      const plannedAmount = useHarga ? formatRupiah(plannedAmountValue || 0) : '';\n      const actualAmount = useHarga ? formatRupiah(actualAmountValue || 0) : '';\n      const varianceAmount =\n        useHarga && typeof detail?.varianceCostValue === 'number'\n          ? formatRupiah(detail.varianceCostValue)\n          : useHarga\n          ? formatRupiah((actualAmountValue || 0) - (plannedAmountValue || 0))\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n\n      htmlParts.push(`<div>Rencana: <strong>${formatPercentage(planned)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Realisasi: <strong>${formatPercentage(actual)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${useHarga ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`);\n    }\n\n    this.tooltipEl.innerHTML = htmlParts.join('');\n\n    const xValue = u.data[0][idx];\n    const left = u.valToPos(xValue, 'x');\n    const seriesIndex = Math.min(2, u.data.length - 1);\n    let seriesValue = u.data[seriesIndex]?.[idx];\n    if (!Number.isFinite(seriesValue)) {\n      seriesValue = u.data[1]?.[idx] ?? 0;\n    }\n    const top = u.valToPos(seriesValue, 'y');\n    this.tooltipEl.style.left = `${left}px`;\n    this.tooltipEl.style.top = `${top}px`;\n    this.tooltipEl.style.opacity = '1';\n  }\n\n  _updateTooltipPosition() {\n    if (!this.chartInstance || !this.tooltipEl) {\n      return;\n    }\n    const { idx } = this.chartInstance.cursor;\n    if (idx != null) {\n      this._updateTooltip(this.chartInstance);\n    }\n  }\n\n  _formatDateLabel(input) {\n    if (!input) {\n      return '';\n    }\n    let date = input;\n    if (!(input instanceof Date)) {\n      date = new Date(input);\n    }\n    if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n      return '';\n    }\n    if (!this._dateFormatter && typeof Intl !== 'undefined' && typeof Intl.DateTimeFormat === 'function') {\n      try {\n        this._dateFormatter = new Intl.DateTimeFormat('id-ID', {\n          day: '2-digit',\n          month: 'short',\n          year: 'numeric',\n        });\n      } catch (error) {\n        console.warn(LOG_PREFIX, 'Intl.DateTimeFormat unavailable, falling back to basic formatter:', error);\n        this._dateFormatter = null;\n      }\n    }\n    if (this._dateFormatter) {\n      return this._dateFormatter.format(date);\n    }\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n    return `${day}/${month}/${year}`;\n  }\n\n  _formatWeekRange(plannedWeek, actualWeek) {\n    const startRaw = plannedWeek?.week_start || actualWeek?.week_start;\n    const endRaw = plannedWeek?.week_end || actualWeek?.week_end;\n    const startLabel = startRaw ? this._formatDateLabel(new Date(startRaw)) : '';\n    const endLabel = endRaw ? this._formatDateLabel(new Date(endRaw)) : '';\n    return this._composeRangeText(startLabel, endLabel);\n  }\n\n  _composeRangeText(startLabel, endLabel) {\n    if (startLabel && endLabel) {\n      return `${startLabel} - ${endLabel}`;\n    }\n    return startLabel || endLabel || '';\n  }\n\n  _getVarianceColor(value) {\n    if (value > 0.1) {\n      return '#f87171';\n    }\n    if (value < -0.1) {\n      return '#22c55e';\n    }\n    return '#cbd5e1';\n  }\n\n  _resolveCostAmount(weekEntry, percent, totalCost) {\n    if (weekEntry) {\n      const cumulative = this._parseNumber(weekEntry.cumulative_cost);\n      if (Number.isFinite(cumulative) && cumulative > 0) {\n        return formatRupiah(cumulative);\n      }\n      const singleCost = this._parseNumber(weekEntry.cost);\n      if (Number.isFinite(singleCost) && singleCost > 0) {\n        return formatRupiah(singleCost);\n      }\n    }\n\n    if (!Number.isFinite(totalCost) || totalCost <= 0) {\n      return formatRupiah(0);\n    }\n    return formatRupiah((totalCost * percent) / 100);\n  }\n\n  _parseNumber(value) {\n    if (typeof value === 'number') {\n      return value;\n    }\n    if (typeof value === 'string') {\n      const parsed = Number(value);\n      return Number.isFinite(parsed) ? parsed : NaN;\n    }\n    return NaN;\n  }\n}\n\nexport default KurvaSUPlotChart;\n"],"names":["getCssVar","name","root","document","documentElement","value","getComputedStyle","getPropertyValue","trim","length","e","getBtnColor","selector","el","querySelector","style","_a","_b","_c","TooltipManager","constructor","options","this","tooltip","zIndex","ensureTooltip","createElement","className","cssText","body","appendChild","show","clientX","clientY","point","tip","weekLabel","weekNumber","columnId","progressLabel","Number","isFinite","progress","toFixed","weekProgressLabel","weekProgress","innerHTML","color","label","left","top","display","hide","destroy","remove","GanttCanvasOverlay","tableManager","debug","Boolean","debugUnifiedTable","_d","state","window","DEBUG_UNIFIED_TABLE","canvas","ctx","getContext","clipViewport","pointerEvents","visible","barData","dependencies","barRects","tooltipManager","pinnedWidth","scrollLeft","scrollTop","lastDrawMetrics","barsDrawn","barsSkipped","scrollTarget","_e","bodyScroll","addEventListener","_updateTransform","passive","event","scrollHeight","clientHeight","scrollWidth","clientWidth","atTop","atBottom","atLeft","atRight","scrollingUp","deltaY","scrollingDown","scrollingLeft","deltaX","scrollingRight","Math","abs","stopPropagation","preventDefault","_bindPointerEvents","scrollArea","position","container","parentElement","parentNode","_updatePinnedClip","_log","clipping","syncWithTable","removeChild","transform","header","headerHeight","offsetHeight","containerRect","getBoundingClientRect","scrollAreaRect","viewportWidth","width","viewportHeight","height","contentWidth","max","contentHeight","min","cellRects","getAllCellBoundingRects","getCellBoundingRects","clearRect","save","canvasSize","w","h","scrollAreaSize","visibleSize","scroll","bars","columnIds","Set","map","r","maxX","x","console","log","totalCells","uniqueColumns","sampleColumnIds","slice","canvasWidth","cells","deps","size","strokeStyle","forEach","rect","canvasX","strokeRect","y","_drawBars","_publishMetrics","_drawDependencies","restore","renderBars","Array","isArray","renderDependencies","dependencyData","getPinnedColumnsWidth","clipPath","webkitClipPath","setProperty","viewportLeft","viewportRight","metrics","timestamp","Date","now","clipLeft","GanttOverlayMetrics","rectIndex","Map","key","String","pekerjaanId","has","set","get","push","list","sort","a","b","barsByRow","bar","pkjId","rects","rectMap","maxWidth","paddingX","baseX","baseY","fullHeight","paddingY","trackHeight","plannedValue","planned","actualValue","actual","plannedWidth","fillStyle","_getPlannedColor","fillRect","actualWidth","barColor","_resolveActualColor","variance","drawn","skipped","total","dep","fromRect","find","c","fromPekerjaanId","fromColumnId","toRect","toPekerjaanId","toColumnId","fromX","fromY","toX","toY","lineWidth","beginPath","moveTo","lineTo","stroke","angle","atan2","cos","PI","sin","closePath","fill","_resolveVarianceColor","cssVar","hit","_hitTest","tooltipData","payload","normalizeDate","input","isNaN","getTime","date","getVolumeForPekerjaan","volumeLookup","fallback","idVariants","variant","buildHargaLookup","lookup","setHarga","numericKey","harga","hargaMap","parseFloat","Object","entries","getHargaForPekerjaan","hargaLookup","buildCellValueMap","warn","assignValue","numeric","assignmentMap","modifiedCells","collectPekerjaanIds","cellValues","ids","flatPekerjaan","node","type","add","id","_","split","formatPercentage","decimals","round","formatRupiah","amount","toLocaleString","ensureWeekZeroDataset","dataset","labels","firstLabel","toLowerCase","includes","zeroLabel","viewMode","plannedSeries","actualSeries","updated","__spreadProps","acSeries","details","isCostView","start","end","zeroWeek","week_number","week_start","week_end","cost","cumulative_cost","cumulative_percent","pekerjaan_breakdown","weeks","actualWeeks","prependZeroDetails","LOG_PREFIX","buildProgressDataset","columns","aStart","startDate","bStart","index","getSortedColumns","timeColumns","setVolume","volume","volumeMap","vol","buildVolumeLookup","stateManager","plannedCellValues","actualCellValues","getAllCellsForMode","plannedState","actualState","pekerjaanIds","totalBiaya","totalBiayaProject","useHargaCalculation","totalVolume","columnIndexById","col","displayLabel","display_name","start_date","end_date","generateLabels","totalValue","plannedTotals","cellKey","columnIndex","numericValue","kontribusi","cumulative","calculatePlannedCurve","actualColumnTotals","totals","calculateColumnTotals","columnTotals","calculateActualCurve","column","plannedCumulative","actualCumulative","prevPlannedCumulative","prevActualCumulative","plannedWeekProgress","actualWeekProgress","plannedCostValue","actualCostValue","varianceCostValue","endDate","metadata","buildDetailData","buildCostDataset","costData","error","weeklyData","summary","evm","totalCost","bac","total_project_cost","weeklySummary","buildCostWeeklySummary","pv_percent","ev_percent","ac_percent","varianceSeries","varianceCostSeries","entry","evmSummary","earned","plannedCost","planned_cost","actualCost","actual_cost","plannedPoints","actualPoints","plannedWeeks","maxLength","plannedEntry","actualEntry","plannedPercent","percent","actualPercent","_h","_g","_f","resolveCostValue","variancePercent","_j","_i","range","weekEntry","numericPercent","toNumber","accumulated_cost","acc_cost","singleCost","parsed","NaN","KeyboardShortcuts","shortcuts","enabled","_boundHandler","_handleKeyDown","bind","init","register","callback","description","unregister","delete","activeElement","isInput","tagName","isContentEditable","parts","ctrlKey","altKey","shiftKey","metaKey","combo","join","shortcut","enable","disable","getShortcuts","from","data","removeEventListener","clear","RippleEffect","element","classList","ripple","setTimeout","addToAll","querySelectorAll","ButtonStateManager","setLoading","button","loadingText","originalText","disabled","setSuccess","duration","setError","reset","markChanges","hasChanges","setAttribute","removeAttribute","Toast","success","message","DP","core","toast","warning","info","initializeUXEnhancements","btn","hasAttribute","getAttribute","OFF","pre","LEGEND_LABEL","WIDTH","HEIGHT","TOP","BOTTOM","LEFT","RIGHT","hexBlack","transparent","mousemove","mousedown","mouseup","mouseenter","mouseleave","dblclick","change","dppxchange","LEGEND_DISP","domEnv","doc","win","nav","navigator","pxRatio","query","addClass","cl","contains","remClass","setStylePx","placeTag","tag","cls","targ","refEl","insertBefore","placeDiv","xformCache","WeakMap","elTrans","xPos","yPos","xMax","yMax","xform","colorCache","elColor","background","borderColor","newColor","sizeCache","elSize","newWid","newHgt","centered","newSize","marginLeft","marginTop","evOpts","evOpts2","__spreadValues","capture","on","ev","cb","capt","off","closestIdx","num","arr","lo","hi","mid","bitwise","floor","makeIndexOfs","predicate","_i0","_i1","i0","i1","i","setPxRatio","_pxRatio","devicePixelRatio","matchMedia","dispatchEvent","CustomEvent","notNullish","v","isPositive","nonNullIdxs","positiveIdxs","rangeLog","base","fullMags","minSign","sign","maxSign","logFn","log10","log2","growMaxAbs","ceil","minExp","maxExp","minIncr","pow","maxIncr","roundDec","incrRoundDn","incrRoundUp","rangeAsinh","minMax","autoRangePart","mode","pad","_eqRangePart","soft","_eqRange","rangeNum","_min","_max","mult","extra","isObj","_rangeNum","ifNull","lh","rh","cfg","cmin","cmax","padMin","padMax","hardMin","hard","inf","hardMax","softMin","softMax","softMinMode","softMaxMode","delta","deltaMag","scalarMax","scalarMag","scalarMagDelta","nonZeroDelta","mag","_newMin","_softMin","minLim","_newMax","_softMax","maxLim","numFormatter","Intl","NumberFormat","language","fmtNum","val","format","M","asinh","linthresh","Infinity","numIntDigits","clamp","isFn","fnOrSelf","retArg0","_0","retArg1","_1","retNull","retTrue","retEq","regex6","fixFloat","isInt","fixedDec","str","match","len","indexOf","exp","incrRound","incr","dec","p","__pow","n","EPSILON","guessDec","genIncrs","mults","incrs","multDec","expa","_incr","EMPTY_OBJ","EMPTY_ARR","nullNullTuple","isArr","isInteger","isStr","is","fastIsObj","TypedArray","getPrototypeOf","Uint8Array","__proto__","copy","o","_isObj","out","k","assign","args","arguments","src","nullExpand","yVals","nullIdxs","alignedLen","xi","lastNullIdx","nullIdx","microTask","queueMicrotask","fn","Promise","resolve","then","months","days","slice3","days3","months3","engNames","MMMM","MMM","WWWW","WWW","zeroPad2","int","subs","YYYY","d","getFullYear","YY","names","getMonth","MM","DD","getDate","D","getDay","HH","getHours","H","AA","aa","mm","getMinutes","m","ss","getSeconds","s","fff","zeroPad3","getMilliseconds","fmtDate","tpl","R","exec","localTz","DateTimeFormat","resolvedOptions","timeZone","onlyWhole","allMults","decIncrs","oneIncrs","wholeIncrs","filter","numIncrs","concat","yyyy","NLyyyy","md","NLmd","NLmdyy","hmmaa","NLhmmaa","genTimeStuffs","ms","mo","tzDate","self","axisIdx","scaleMin","scaleMax","foundIncr","foundSpace","splits","isYr","isMo","minDate","minDateTs","minMin","mkDate","minMinTs","moIncr","yrIncr","splitDate","baseYear","baseMonth","next","offs","incr0","date0","prevHour","incrHours","pctSpace","axes","_space","expectedHour","dstShift","timeIncrsMs","_timeAxisStampsMs","timeAxisSplitsMs","timeIncrsS","_timeAxisStampsS","timeAxisSplitsS","timeAxisStamps","stampCfg","timeAxisVals","stamps","prevYear","prevMnth","prevDate","prevMins","prevSecs","newYear","newMnth","newDate","newHour","newMins","newSecs","stamp","timeSeriesStamp","timeSeriesVal","seriesIdx","dataIdx","legendOpts","live","isolate","mount","markers","series","points","dash","idx","idxs","values","moveTuple","filtBtn0","handle","onlyTarg","target","filtTarg","cursorOpts","lock","move","mouseLeft1","mouseTop1","one","si","cursor","pt","mar","sp","_stroke","_fill","click","drag","setScale","dist","uni","stopImmediatePropagation","_x","_y","focus","valPos","curPos","prox","bias","hover","skip","axisLines","grid","ticks","border","font","labelFont","xAxisOpts","scale","space","gap","alignTo","labelGap","labelSize","side","lineGap","rotate","xSeriesOpts","auto","sorted","numAxisVals","numAxisSplits","forceMin","numDec","logAxisSplits","logBase","scales","nextMagIncr","asinhAxisSplits","posSplits","zero","reverse","RE_ALL","RE_12357","RE_125","RE_1","_filt","distr","re","keepMod","test","toExponential","log10AxisValsFilt","axis","scaleKey","sc","valToPos","minSpace","_10","magSpace","log2AxisValsFilt","numSeriesVal","yAxisOpts","facet","gaps","idx0","idx1","nullGaps","xySeriesOpts","alpha","facets","ySeriesOpts","spanGaps","xData","_data","p0","p1","maxPts","path","clip","clampScale","xScaleOpts","time","dir","ori","yScaleOpts","syncs","_sync","opts","plots","sub","plot","unsub","pub","j","orient","u","bbox","dx","dy","sx","sy","l","t","valToPosH","V","valToPosV","moveToH","lineToH","rectH","arcH","bezierCurveToH","moveToV","lineToV","rectV","arcV","bezierCurveToV","bandFillClipDirs","fillDir","clipDirs","bands","seriesFillTo","dataMin","dataMax","bandFillDir","clipBandLine","strokePath","clipDir","dataX","dataY","scaleX","scaleY","valToPosX","valToPosY","xOff","yOff","xDim","yDim","pxRound","frIdx","toIdx","x0","y0","x1","yLimit","Path2D","clipGaps","plotLft","plotTop","plotWid","plotHgt","prevGapEnd","g","maxStrokeWidth","findGaps","xs","ys","pixelForX","align","fr","to","frPx","toPx","fri2","toi2","pxRoundGen","pxAlign","arcTo","y1","x2","y2","endRad","baseRad","startAngle","endAngle","arc","bp1x","bp1y","bp2x","bp2y","p2x","p2y","bezierCurveTo","filtIdxs","rad","dia","lft","wid","hgt","drawPoint","pi","flags","BAND_CLIP_FILL","_drawAcc","accX","minY","maxY","inY","outY","drawAccH","drawAccV","linear","alignGaps","drawAcc","pixelForY","_paths","band","hasGap","drawnAtX","xForPixel","pos","posToVal","idx0px","idx1px","nextAccXVal","xVal","yVal","bandClipDir","fillToY","fillTo","frX","findColWidth","colWid","prevIdx","minDelta","_monotoneCubic","ds","dys","dxs","cursorPlots","invalidateRects","syncRect","uPlot","linearPath","pointsPath","setDefaults","xo","yo","initY","setDefault","snapNumX","snapTimeX","snapNumY","snapLogY","snapLogX","snapAsinhY","snapAsinhX","pxRatioFont","fontSize","fontSizeCss","replace","syncFontSize","f","getHPos","dim","pct","valToPct","getVPos","getPos","ready","status","class","title","textContent","can","wrap","over","mouseLeft0","mouseTop0","under","plugins","xyo","xScaleKey","drawOrderMap","_show","shiftDir","_found","shiftAmt","baseLpos","_lpos","setFontStyle","translate","_label","fillText","plotDim","plotOff","_splits","data0","_tickSize","tickSize","axisGap","_size","_rotate","basePos","_pos","finalPos","lineHeight","canOffs","_values","_parts","text","drawOrthoLines","cap","fire","dataLen","shouldAlpha","some","_focus","ctxAlpha","globalAlpha","cacheStrokeFill","_ctxAlpha","_idxs","ydata","getOuterIdxs","paths","drawPath","_gaps","drawOrder","initValToPct","getVal","fwd","_val","initScale","scaleOpts","isTime","rn","rangeIsArr","xScaleDistr","pendScales","_tzDate","ts","_fmtDate","_timeAxisSplits","_timeAxisVals","_timeSeriesVal","activeIdxs","legend","showLegend","showCursor","legendTable","legendHead","legendBody","legendCols","legendRows","legendCells","multiValLegend","NULL_LEGEND_VALUES","getMultiVals","head","son","soff","mouseListeners","onMouse","targListeners","listener","offMouse","fullWidCss","fullHgtCss","plotWidCss","plotHgtCss","plotLftCss","plotTopCss","_plotLftCss","_plotTopCss","_plotWidCss","_plotHgtCss","shouldSetScales","shouldSetSize","shouldConvergeSize","shouldSetCursor","shouldSetSelect","shouldSetLegend","_setSize","force","calcSize","resetYSeries","commit","hasTopAxis","hasBtmAxis","hasRgtAxis","hasLftAxis","isVt","fullSize","sidesWithAxes","_padding","calcPlotRect","off1","off2","off3","off0","incrOffset","calcAxesRects","bb","CYCLE_LIMIT","setSize","hov","cursorIdx","valAtPosX","idx2","_prox","withProx","cursorLft","xValues","yValues","nonNullLft","nonNullRgt","lftDelta","rgtDelta","setCursorEvent","_lock","cursorFocus","cursorOnePt","cursorPts","cursorPtsLft","cursorPtsTop","initCursorPt","HTMLElement","initSeries","sv","_ptDia","rowCells","row","childNodes","indic","setSeries","syncOpts","FOCUS_TRUE","initLegendRow","splice","addSeries","delSeries","tr","firstChild","autoPadSide","cycleNum","padding","ctxStroke","ctxFill","ctxWidth","ctxDash","ctxJoin","ctxCap","ctxFont","ctxAlign","ctxBaseline","viaAutoScaleX","setData","_resetScales","scaleData","_data0","xsc","autoScaleX","_setScale","setCtxStyle","lineJoin","lineCap","setLineDash","baseline","textAlign","textBaseline","accScale","wsc","psc","getEdgeIdxs","getMinMax","AUTOSCALE","_points","gapsClip","_width","boundsClip","offset","_pxAlign","strokeFill","lineDash","fillPath","didStrokeFill","bi","gapsClip2","lowerEdge","lowerData","bandClip","_fillStyle","hasData","fillStroke","CLIP_FILL_STROKE","doFill","doStroke","getIncrSpace","fullDim","incrSpace","minVal","maxVal","intDigits","incrIdx","findIncr","_incrs","filts","pos0","pos1","axesCalc","converged","oldSize","paddingCalc","_p","xCursor","yCursor","vCursor","hCursor","rawMouseLeft0","rawMouseTop0","rawMouseLeft1","rawMouseTop1","queuedCommit","deferHooks","hooksQueue","flushHooks","_commit","wipScales","xFacet","yFacet","yScaleKey","yData","wscx","wscy","changed","anyChanged","setScales","axesConverged","paddingConverged","convergeSize","_el","pctWid","pctHgt","select","prop","_hideProps","selectDiv","setSelect","updateCursor","setLegend","batch","_deferHooks","redraw","rebuildPaths","recalcAxes","dragging","dragX","dragY","_fire","_pub","focusedSeries","allFocused","_setAlpha","i2","isFocused","opacity","setAlpha","setFocus","toggleDOM","pubSync","closestDist","closestSeries","addBand","setBand","delBand","sinh","bwd","setSelH","setSelV","valToIdx","posToIdx","setCursor","setSelX","setSelY","didx","sidx","setLegendValues","vals","nodeValue","syncLegend","noDataInRange","mouseXPos","_ptLft","_ptTop","_ptWid","_ptHgt","_centered","_ptFill","_ptStroke","yVal1","yVal2","xPos2","mouseYPos","mouseYVal","mouseYValSign","hPos","vPos","ptWid","ptHgt","ptLft","ptTop","ptStroke","ptFill","getBBox","xKey","yKey","matchXKeys","matchYKeys","xKeySrc","yKeySrc","sync","sdrag","sOff","sDim","sori","sPosToVal","matchingX","matchingY","hideSelect","rawDX","rawDY","_rawDX","syncKey","xSyncKey","ySyncKey","shouldPub","defer","mouseMove","_l","_t","_w","movementX","movementY","cacheMouse","initial","snap","syncOptsSrc","xValSrc","yValSrc","rotSrc","_xDim","_yDim","_xPos","_yPos","__l","defineProperty","downSelectLeft","downSelectTop","downSelectWidth","downSelectHeight","mouseDown","mouseUp","hasSelect","chgSelect","dblClick","syncPxRatio","events","seriesIdxMatcher","_dragging","dragH","dragV","snapH","snapV","snapProx","hooks","evName","a1","a2","call","srcSeriesIdx","filters","_init","av","dateTpl","timeAxisVal","tables","nullModes","vals0","len0","vals1","allHeadersSame","table","samples","firstIdx","lastIdx","stride","prevVal","isAsc","rlen","table2","row2","sortCols","xVals","ti","xIdxs","nullMode","alignedIdx","tz","date2","getTimezoneOffset","setMilliseconds","addGap","prevGap","stepped","ascDesc","extend","prevYPos","firstXPos","prevXPos","firstXPosExt","prevXPosExt","halfStroke","startsOffset","endsOffset","_extraGap","ro","radius","radiusFn","gapFactor","_maxWidth","_minWidth","disp","_each","each","dispFills","dispStrokes","valRadius","baseRadius","_align","extraGap","minWidth","_dirX","xShift","barWid","fullGap","strokeWidth","multiPath","fillColors","fillPaths","strokeColors","strokePaths","unit","sizes","insetStroke","dataY0","radVal","radBase","yVal0","btm","barHgt","rv","rb","spline","interp","xCoords","yCoords","splineInterp","DEFAULT_OPTIONS","enableCostView","KurvaSUPlotChart","chartInstance","tooltipEl","resizeHandler","resizeObserver","themeObserver","currentDataset","isLoadingCostData","_interactionAttached","_wheelHandler","_interactionTarget","_scaleBounds","_dateFormatter","initialize","_createTooltip","observer","MutationObserver","mutations","mutation","attributeName","theme","observe","attributes","attributeFilter","setupThemeObserver","_rebuild","delay","timeoutId","clearTimeout","createResizeHandler","resize","ResizeObserver","contentRect","setupResizeObserver","update","resolvedDataset","transformedData","_transformDataset","colors","plannedLine","plannedArea","actualLine","actualArea","costActualLine","costActualArea","gridLine","_updateScaleBounds","_buildChartOptions","_attachInteractions","_updateTooltipPosition","toggleView","__async","nextMode","fetchCostData","costDataset","renderMonthlyMode","monthlyData","monthlyDataset","month","granularity","renderWeeklyMode","weeklyDataset","dispose","_detachInteractions","disconnect","projectId","url","response","fetch","method","headers","ok","Error","statusText","json","nearestIndex","_updateTooltip","first","last","_handleWheelInteraction","isZoomGesture","isPanGesture","bounds","currentMin","currentMax","zoomIntensity","direction","factor","overRect","cursorX","cursorVal","resolvedCursor","newMin","newMax","_setScaleBounded","panStep","targetMin","targetMax","boundsSpan","windowSize","borderRadius","transition","detailArray","detailObject","weeklyCostSummary","summaryEntry","htmlParts","plannedWeek","actualWeek","rangeText","_formatWeekRange","plannedAmount","_resolveCostAmount","actualAmount","varianceAmount","varianceColor","_getVarianceColor","detail","startLabel","_formatDateLabel","endLabel","_composeRangeText","useHarga","plannedAmountValue","actualAmountValue","xValue","seriesIndex","seriesValue","day","year","padStart","startRaw","endRaw","_parseNumber"],"mappings":"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","x_google_ignoreList":[7]}