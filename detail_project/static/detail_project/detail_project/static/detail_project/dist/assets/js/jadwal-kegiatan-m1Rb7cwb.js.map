{"version":3,"mappings":"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","names":["KurvaSCanvasOverlay","constructor","tableManager","options","this","debug","Boolean","_b","_a","debugUnifiedTable","_d","_c","state","window","DEBUG_UNIFIED_TABLE","_missingColumnLog","Set","scrollLeft","_syncScheduled","pinnedWidth","mode","projectId","canvas","document","createElement","className","style","cssText","ctx","getContext","yAxisContainer","visible","curveData","planned","actual","legendElement","curvePoints","tooltip","scrollTarget","_e","bodyScroll","addEventListener","_updateTransform","requestAnimationFrame","syncWithTable","passive","_bindPointerEvents","show","scrollArea","position","parentNode","removeChild","appendChild","display","_log","overlay","_showLegend","_renderWithRetry","hide","_hideLegend","message","_getPinnedWidth","viewportWidth","clientWidth","canvasWidth","Math","max","min","canvasHeight","clientHeight","width","height","axisHeight","axisLeft","axisTop","scrollTop","left","top","transform","pointerEvents","zIndex","axisWidth","cellRects","getCellBoundingRects","clearRect","canvasSize","w","h","scrollAreaSize","scrollWidth","scrollHeight","visibleSize","scroll","length","plannedPoints","actualPoints","canvasVisible","canvasParent","cells","size","_drawCurve","_getPlannedColor","_getActualColor","_drawYAxisLabels","pinnedCols","getPinnedColumnsWidth","call","total","header","previousElementSibling","querySelectorAll","forEach","cell","offsetWidth","setMode","__async","_loadCostMode","_loadProgressMode","console","error","response","fetch","credentials","ok","Error","status","costData","json","buildCostDataset","__vitePreload","import","then","n","d","__VITE_PRELOAD__","dataset","_convertDatasetSeriesToCurvePoints","renderCurve","updateCurvaS","seriesKey","series","labels","details","map","cumulativeProgress","index","detail","label","columnId","metadata","id","fieldId","weekNumber","match","String","weekProgress","Number","_g","_f","plannedPercent","_i","_h","actualPercent","Array","isArray","dataPoints","color","info","points","_mapDataToCanvasPoints","sample","strokeStyle","lineWidth","lineCap","lineJoin","beginPath","point","moveTo","x","y","lineTo","stroke","fillStyle","arc","PI","fill","push","viewportHeight","y0percent","y100percent","columnGridLines","_getWeekGridLines","reduce","earliest","rect","week0X","week0Y","_interpolateY","progress","dataPoint","weekId","week","isFinite","columnGridLine","get","has","add","availableColumns","Map","canvasRelativeX","set","from","entries","slice","y0","y100","attempt","maxAttempts","hasSize","hasCells","innerHTML","bg","inset","background","borderLeft","pct","tick","borderTop","textContent","font","lineHeight","_updateLegendColors","isDarkMode","_isDarkMode","plannedColor","actualColor","textColor","body","borderColor","boxShadow","span","bodyClassList","classList","contains","matchMedia","matches","_getCssVar","name","root","documentElement","value","getComputedStyle","getPropertyValue","trim","e","_getBtnColor","selector","el","querySelector","getBoundingClientRect","clientX","clientY","hit","_hitTestPoint","_showTooltip","cursor","_hideTooltip","radius","dx","dy","sqrt","_ensureTooltip","tip","weekLabel","progressLabel","toFixed","weekProgressLabel","event","payload","log","UnifiedTableManager","currentMode","tanstackGrid","overlays","gantt","kurva","mount","container","domTargets","TanStackGridManager","setCellRenderer","containerMounted","updateData","rows","tree","currentRows","cols","timeColumns","currentColumns","deps","dependencies","_refreshGanttOverlay","_refreshKurvaSOverlay","switchMode","newMode","oldMode","targetRenderer","grid","to","renderer","GanttCanvasOverlay","barData","_buildBarData","dependencyData","bars","renderBars","renderDependencies","columns","gridRows","gridColumns","flatRows","flatPekerjaan","row","pekerjaanId","pekerjaan_id","nama","raw","subRows","hasTimeMeta","some","c","meta","timeColumn","col","columnMeta","stateManager","stateManagerInstance","mergedPlanned","getAllCellsForMode","_mergeModeState","states","mergedActual","activeMode","_j","progressMode","toLowerCase","plannedSize","actualSize","samplePlannedKeys","keys","sampleActualKeys","samplePlannedValues","sampleActualValues","timeColumnsWithMeta","filter","sampleColumns","sampleRows","r","rowsForBars","_flattenRows","rowIndex","columnIndex","_resolveColumnMeta","column_id","_k","_l","cellKey","pkjIdRaw","colIdRaw","split","rowInfo","colMeta","plannedValue","_resolveValue","actualValue","variance","warn","plannedKeys","actualKeys","columnIds","nodes","result","stack","node","shift","children","sub","__spreadProps","__spreadValues","generationMode","type","rangeLabel","modeState","merged","assignmentMap","modifiedCells","key","fallback","val","_buildCurveData","setKurvaMode","columnsTotal","datasetState","totalBiayaProject","totalBiaya","buildProgressDataset","plannedCurve","_convertDatasetToCurvePoints","actualCurve","useHargaCalculation","totalVolume","AppInitializer","StateManager","getInstance","buildState","config","existingState","createTimeColumnIndex","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","volumeMap","isLoading","domRefs","apiEndpoints","projectName","projectStart","projectEnd","useUPlotKurva","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","displayMode","useUnifiedTable","disableUnifiedTable","keepLegacyGantt","enableLegacyGantt","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","kelolaTahapanPageState","buildDomRefs","getElementById","saveButton","refreshButton","resetButton","tanstackGridContainer","tanstackGridBody","tanstackGridTopScroll","tanstackGridTopScrollInner","scurveChart","ganttChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","EventBinder","app","attachAll","_attachToolbarEvents","_initTanStackGridIfNeeded","dom","saveChanges","refresh","_handleResetProgress","_syncToolbarRadios","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","keyboardShortcuts","KeyboardShortcuts","register","Toast","description","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","disabled","volumeRadio","costRadio","warning","dropdown","toggle","bsDropdown","bootstrap","Dropdown","preventDefault","_showKeyboardShortcutsHelp","getShortcuts","initializeUXEnhancements","setAttribute","modalHtml","s","replace","join","existingModal","remove","firstElementChild","modal","Modal","DataOrchestrator","loadInitialData","arguments","forceReload","_recalculateAllProgressTotals","_syncGridViews","_showSkeleton","apiBase","tahapan","dataLoader","DataLoader","timeColumnGenerator","TimeColumnGenerator","saveHandler","SaveHandler","apiUrl","save","onSuccess","_onSaveSuccess","onError","_onSaveError","showToast","msg","loadAllData","skipIfLoaded","force","generate","normalizedDisplayScale","_isEnforcingWeekly","weeklyCount","_countWeeklyColumns","expectedWeeks","_estimateExpectedWeeklyColumns","firstColumnMode","regenerateTimeline","_getWeekStartDay","_getWeekEndDay","loadAssignments","_loadKurvaSData","_createTimeColumnIndex","_initializeCharts","_updateCharts","_hideSkeleton","endpoint","regenerateTahapan","_isRegeneratingTimeline","_queuedRegeneratePayload","confirm","_resetEditedCellsState","statusLabel","_updateStatusBar","toastLabel","method","headers","_getCsrfToken","JSON","stringify","week_start_day","week_end_day","_invalidateCachedDataset","successMessage","next","UXManager","syncToolbarRadios","_setRadioGroupChecked","ariaSelected","_updateCostToggleAvailability","attachRadioGroupHandler","groupName","handler","radios","radio","target","isChecked","nextElementSibling","setupWeekBoundaryControls","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","derivedStart","setupCostViewToggle","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","kurvaSChart","enableCostView","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","updateLabel","_loadCostView","showSkeleton","skeleton","view","hideSkeleton","setTimeout","ChartCoordinator","initializeCharts","_setupLazyChartLoading","_bindUnifiedTabSync","scurveTab","ganttTab","unifiedManager","_chartModulesLoaded","_loadChartModules","once","_chartModulesLoading","_initializeRedesignedGantt","updateChartsThrottled","_chartUpdatePending","updateCharts","_chartUpdateDelay","update","ganttFrozenGrid","initializeChartsAfterLoad","KurvaSChartClass","useIdealCurve","steepnessFactor","smoothCurves","showArea","initialize","activatePromise","_activateDefaultCostView","catch","retryCount","Promise","resolve","ganttContainer","ganttView","_initializeUnifiedGanttOverlay","host","_ensureGanttHost","gridPayload","_getDisplayTimeColumns","_applyGanttOverlayStyles","styleId","head","minHeight","_moveGridContainerTo","_restoreGridContainerPosition","parent","_gridContainerParent","_gridContainerNextSibling","insertBefore","_prepareGanttData","data","pekerjaanNodes","start","tanggal_mulai","start_date","_fallbackDate","end","tanggal_selesai","end_date","progress_rencana","progress_plan","progress_realisasi","progress_actual","volume","satuan","projectMeta","project_id","project_name","project","milestones","offset","today","Date","created_at","setDate","getDate","toISOString","parsed","isNaN","getTime","JadwalKegiatanApp","initialized","gridManager","eventBinder","dataOrchestrator","uxManager","chartCoordinator","_weekBoundarySaveTimer","_pendingWeekBoundary","_exportManagerInstance","_exportBindingsAttached","_costViewAutoActivated","_ganttScrollSyncHandlers","_stateManagerListener","_suppressStateManagerEvent","_currencyFormatter","_getProjectDateRange","parsedEnd","getFullYear","diffDays","floor","ceil","week_number","appInitializer","JadwalPekerjaanApp","bind","_ensureStateCollections","_setupStateDelegation","_bindStateManagerEvents","_updateSaveButtonState","_applyDataset","_attachEvents","_loadInitialData","getCurrentState","defineProperty","configurable","costAssignmentMap","costModifiedCells","hasUnsavedChanges","_handleStateManagerEvent","_unbindStateManagerEvents","removeEventListener","_applyProgressModeSwitch","_handleStateCommitEvent","_handleStateResetEvent","refreshCells","modeLabel","_getCurrentModeState","hasFailures","removeAttribute","rootElement","allowedTimeScales","datasetScale","defaultTimeScale","toString","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","weekend","weekEnd","parsedWeekStartDay","normalized","endpoints","base","apiTahapan","listPekerjaan","apiListPekerjaan","apiVolume","assignmentsBase","apiAssignmentsBase","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","apiRegenerateTahapan","reset","apiResetProgress","enableUplotKurva","ExportManager","format","button","exportAs","toggleView","_setCostToggleButtonState","viewMode","isCostMode","iconClass","text","clear","_clearFailedRows","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","clearTimeout","resolvedStart","resolvedEnd","_regenerateTimeline","pyDay","setInputMode","oldStats","getStats","newStats","toUpperCase","modifiedCount","assignmentCount","nextMode","previousInputMode","_updateProgressModeIndicator","indicator","bgClass","isActual","nextScale","_renderGrid","nextSibling","onCellChange","_handleGridCellChange","getCellValidationState","_getCellValidationState","topScroll","topScrollInner","statusText","hargaMap","k","v","parseFloat","pekerjaanMeta","hargaCount","totalBiayaFormatted","toLocaleString","kurvaSModule","u","KurvaSUPlotChart","default","_initializeChartsAfterLoad","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","actualVal","round","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","_updateChartsThrottled","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","deltaY","_escapeHtml","char","_validateRowTotalsBeforeSave","ButtonStateManager","setLoading","success","setSuccess","setError","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","_buildTimeColumns","tahap","rawId","order","urutan","startDate","endDate","isAutoGenerated","is_auto_generated","generation_mode","_fetchJson","_0","url","errorText","displayColumns","activeTimeColumns","updateTopScrollMetrics","_renderLegacyGrid","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","_getContainerValue","prototype","hasOwnProperty","_calculateRowTotalPercent","fieldKey","numeric","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","find","_getRowCostCapacity","costFields","field","_getMergedCostCells","_calculateAllCostTotals","totals","_formatCurrency","Intl","NumberFormat","currency","maximumFractionDigits","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","costViolations","totalCost","combined","concat","messages","pekerjaanCount","totalProgress","_calculateProjectProgress","aggregate","avg","pekerjaanTotals","numericValue","sum","_buildAssignmentsPayload","assignments","_parseCellKey","proportion","tahapan_id","_getSaveMode","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","_buildMonthlyColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","endLabel","_coerceDate","_m","_n","rangeText","_formatShortRange","childColumns","readOnly","date","padStart","getMonth","separatorIndex","indexOf","cookieValue","cookie","cookies","substring","decodeURIComponent","displayValue","isVolumeMode","validation","valueType","normalizedValue","resolvedPekerjaanId","gridTab","kurvaSContainer","destroy","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/kurva-s/KurvaSCanvasOverlay.js","../../../../../../js/src/modules/unified/UnifiedTableManager.js","../../../../../../js/src/modules/app/AppInitializer.js","../../../../../../js/src/modules/app/EventBinder.js","../../../../../../js/src/modules/app/DataOrchestrator.js","../../../../../../js/src/modules/app/UXManager.js","../../../../../../js/src/modules/app/ChartCoordinator.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["/**\r\n * Kurva-S Canvas Overlay\r\n * Plots S-curve as overlay on top of table grid\r\n * - Y-axis inverted: 0% at bottom (last row), 100% at top (first row)\r\n * - X-axis: Plots at center of each week column\r\n * - Shows both planned and actual curves\r\n * - Y-axis labels on right side of table\r\n * - Legend for planned vs actual\r\n */\r\n\r\nexport class KurvaSCanvasOverlay {\r\n  constructor(tableManager, options = {}) {\r\n    this.tableManager = tableManager;\r\n    this.debug = Boolean(\r\n      this.tableManager?.options?.debugUnifiedTable ||\r\n      this.tableManager?.state?.debugUnifiedTable ||\r\n      window.DEBUG_UNIFIED_TABLE\r\n    );\r\n    this._missingColumnLog = new Set();\r\n\r\n    // PHASE 1 FIX: Track scroll position and pinned width for transform compensation\r\n    this.scrollLeft = 0;\r\n    this._syncScheduled = false;\r\n    this.pinnedWidth = 0;\r\n\r\n    // PHASE 4 FIX: Cost mode support\r\n    this.mode = 'progress';  // 'progress' or 'cost'\r\n    this.projectId = options.projectId || null;\r\n\r\n    // Main canvas for curve plotting\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.className = 'kurva-s-canvas-overlay';\r\n    this.canvas.style.cssText = `\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      pointer-events: auto;\r\n      z-index: 10;\r\n    `;\r\n    this.ctx = this.canvas.getContext('2d');\r\n\r\n    // Y-axis container (HTML ticks)\r\n    this.yAxisContainer = document.createElement('div');\r\n    this.yAxisContainer.className = 'kurva-s-yaxis-overlay';\r\n    this.yAxisContainer.style.cssText = `\r\n      position: absolute;\r\n      top: 0;\r\n      right: 0;\r\n      width: 80px;\r\n      pointer-events: none;\r\n      z-index: 11;\r\n      display: none;\r\n    `;\r\n\r\n    this.visible = false;\r\n    this.curveData = { planned: [], actual: [] };\r\n    this.legendElement = null;\r\n    this.curvePoints = []; // For tooltip hit-testing\r\n    this.tooltip = null;\r\n\r\n    // FIX 1: Scroll updates transform immediately and throttles resync\r\n    const scrollTarget = this.tableManager?.bodyScroll;\r\n    if (scrollTarget) {\r\n      scrollTarget.addEventListener('scroll', () => {\r\n        if (this.visible) {\r\n          this._updateTransform();\r\n          if (!this._syncScheduled) {\r\n            this._syncScheduled = true;\r\n            requestAnimationFrame(() => {\r\n              this._syncScheduled = false;\r\n              if (this.visible) {\r\n                this.syncWithTable();\r\n              }\r\n            });\r\n          }\r\n        }\r\n      }, { passive: true });\r\n    }\r\n\r\n    this._bindPointerEvents();\r\n  }\r\n\r\n  show() {\r\n    if (this.visible) return;\r\n    const scrollArea = this.tableManager?.bodyScroll;\r\n    if (!scrollArea) return;\r\n\r\n    scrollArea.style.position = scrollArea.style.position || 'relative';\r\n\r\n    // Ensure canvas is removed first to avoid duplication\r\n    if (this.canvas.parentNode) {\r\n      this.canvas.parentNode.removeChild(this.canvas);\r\n    }\r\n    scrollArea.appendChild(this.canvas);\r\n    this.canvas.style.display = 'block';  // Ensure visible\r\n\r\n    // Attach Y-axis container\r\n    if (this.yAxisContainer.parentNode) {\r\n      this.yAxisContainer.parentNode.removeChild(this.yAxisContainer);\r\n    }\r\n    scrollArea.appendChild(this.yAxisContainer);\r\n    this.yAxisContainer.style.display = 'block';\r\n\r\n    this.visible = true;\r\n    this._log('show', { overlay: true });\r\n    this._showLegend();\r\n    this._renderWithRetry();\r\n  }\r\n\r\n  hide() {\r\n    if (!this.visible) return;\r\n\r\n    if (this.canvas.parentNode) {\r\n      this.canvas.parentNode.removeChild(this.canvas);\r\n    }\r\n    if (this.yAxisContainer?.parentNode) {\r\n      this.yAxisContainer.parentNode.removeChild(this.yAxisContainer);\r\n    }\r\n\r\n    this.visible = false;\r\n    this._log('hide');\r\n    this._hideLegend();\r\n  }\r\n\r\n  syncWithTable() {\r\n    const scrollArea = this.tableManager?.bodyScroll;\r\n    if (!scrollArea) {\r\n      this._log('warn-no-scroll-area', { message: 'No scrollArea found' });\r\n      return;\r\n    }\r\n\r\n    // PHASE 1 FIX: Update pinned width and scroll position\r\n    this.pinnedWidth = this._getPinnedWidth(scrollArea);\r\n    this.scrollLeft = scrollArea.scrollLeft || 0;\r\n\r\n    // PHASE 1 FIX: Viewport-sized canvas (NOT full scrollWidth to avoid >32k px blank canvas)\r\n    const viewportWidth = scrollArea.clientWidth - this.pinnedWidth;\r\n    const MAX_CANVAS_WIDTH = 32000;  // Browser safety limit\r\n    const MAX_CANVAS_HEIGHT = 16000;\r\n\r\n    // DEBUG: Ensure we have valid dimensions\r\n    const canvasWidth = Math.max(100, Math.min(viewportWidth, MAX_CANVAS_WIDTH));\r\n    const canvasHeight = Math.max(100, Math.min(scrollArea.clientHeight, MAX_CANVAS_HEIGHT));\r\n\r\n    this.canvas.width = canvasWidth;\r\n    this.canvas.height = canvasHeight;\r\n\r\n    // Set CSS size explicitly\r\n    this.canvas.style.width = `${canvasWidth}px`;\r\n    this.canvas.style.height = `${canvasHeight}px`;\r\n\r\n    // Position Y-axis container (HTML ticks) at right of visible viewport\r\n    const axisWidth = 80;\r\n    const axisHeight = canvasHeight;\r\n    const axisLeft = this.scrollLeft + scrollArea.clientWidth - axisWidth;\r\n    const axisTop = scrollArea.scrollTop || 0;\r\n    if (this.yAxisContainer) {\r\n      this.yAxisContainer.style.width = `${axisWidth}px`;\r\n      this.yAxisContainer.style.height = `${axisHeight}px`;\r\n      this.yAxisContainer.style.left = `${axisLeft}px`;\r\n      this.yAxisContainer.style.top = `${axisTop}px`;\r\n      this.yAxisContainer.style.display = this.visible ? 'block' : 'none';\r\n    }\r\n\r\n    // PHASE 1 FIX: Transform compensation for scroll (keeps canvas fixed at frozen boundary)\r\n    this.canvas.style.position = 'absolute';\r\n    this.canvas.style.left = `${this.pinnedWidth}px`;  // Start AFTER frozen column\r\n    this.canvas.style.top = '0px';\r\n    this.canvas.style.transform = `translateX(${this.scrollLeft}px)`;  // Compensate scroll\r\n    this.canvas.style.pointerEvents = 'auto';\r\n    this.canvas.style.zIndex = '10';\r\n\r\n    // Position Y-axis container to the right of visible viewport\r\n    if (this.yAxisContainer) {\r\n      const axisWidth = 80;\r\n      const axisHeight = canvasHeight;\r\n      const axisLeft = this.scrollLeft + scrollArea.clientWidth - axisWidth;\r\n      const axisTop = scrollArea.scrollTop || 0;\r\n      this.yAxisContainer.style.width = `${axisWidth}px`;\r\n      this.yAxisContainer.style.height = `${axisHeight}px`;\r\n      this.yAxisContainer.style.left = `${axisLeft}px`;\r\n      this.yAxisContainer.style.top = `${axisTop}px`;\r\n      this.yAxisContainer.style.display = this.visible ? 'block' : 'none';\r\n    }\r\n\r\n    this._log('canvas-sizing', {\r\n      viewportWidth,\r\n      pinnedWidth: this.pinnedWidth,\r\n      canvasWidth,\r\n      canvasHeight,\r\n      scrollLeft: this.scrollLeft,\r\n      transform: this.canvas.style.transform,\r\n      left: this.canvas.style.left,\r\n    });\r\n\r\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\r\n      ? this.tableManager.getCellBoundingRects()\r\n      : [];\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.curvePoints = []; // Reset curve points for hit-testing\r\n\r\n    this._log('sync-debug', {\r\n      canvasSize: { w: this.canvas.width, h: this.canvas.height },\r\n      scrollAreaSize: { w: scrollArea.scrollWidth, h: scrollArea.scrollHeight },\r\n      visibleSize: { w: scrollArea.clientWidth, h: scrollArea.clientHeight },\r\n      scroll: { left: scrollArea.scrollLeft, top: scrollArea.scrollTop },\r\n      cellRects: cellRects.length,\r\n      plannedPoints: this.curveData.planned.length,\r\n      actualPoints: this.curveData.actual.length,\r\n      canvasVisible: this.visible,\r\n      canvasParent: this.canvas.parentNode ? 'attached' : 'detached',\r\n    });\r\n\r\n    this._log('sync', {\r\n      cells: cellRects.length,\r\n      plannedPoints: this.curveData.planned.length,\r\n      actualPoints: this.curveData.actual.length,\r\n      size: { w: this.canvas.width, h: this.canvas.height },\r\n    });\r\n\r\n    if (cellRects.length === 0) {\r\n      this._log('warn-no-cell-rects', { message: 'No cell rects available for plotting' });\r\n      return;\r\n    }\r\n\r\n    // Draw curves (canvas-relative coordinates)\r\n    this._drawCurve(cellRects, this.curveData.planned, this._getPlannedColor(), 'Planned');\r\n    this._drawCurve(cellRects, this.curveData.actual, this._getActualColor(), 'Actual');\r\n\r\n    // Draw Y-axis labels (HTML-based)\r\n    this._drawYAxisLabels(canvasHeight);\r\n  }\r\n\r\n  // PHASE 1 FIX: Get frozen column width from table manager\r\n  _getPinnedWidth(scrollArea) {\r\n    const pinnedCols = this.tableManager?.getPinnedColumnsWidth?.();\r\n    if (pinnedCols && pinnedCols > 0) {\r\n      return pinnedCols;\r\n    }\r\n\r\n    let total = 0;\r\n    const header = scrollArea?.previousElementSibling;\r\n    if (header) {\r\n      const pinned = header.querySelectorAll('th[data-pinned=\"left\"], td[data-pinned=\"left\"]');\r\n      pinned.forEach((cell) => {\r\n        total += cell.offsetWidth || 0;\r\n      });\r\n    }\r\n\r\n    return total;\r\n  }\r\n\r\n  // PHASE 1 FIX: Immediate transform update for smooth scrolling (GPU-accelerated <1ms)\r\n  _updateTransform() {\r\n    const scrollArea = this.tableManager?.bodyScroll;\r\n    if (!scrollArea) return;\r\n\r\n    this.scrollLeft = scrollArea.scrollLeft || 0;\r\n    this.canvas.style.transform = `translateX(${this.scrollLeft}px)`;\r\n  }\r\n\r\n  // PHASE 4 FIX: Set mode (progress or cost) and reload data\r\n  async setMode(mode) {\r\n    if (mode !== 'progress' && mode !== 'cost') {\r\n      console.error('[KurvaSOverlay] Invalid mode:', mode);\r\n      return;\r\n    }\r\n\r\n    this.mode = mode;\r\n    this._log('mode-changed', { mode });\r\n\r\n    if (this.mode === 'cost') {\r\n      await this._loadCostMode();\r\n    } else {\r\n      await this._loadProgressMode();\r\n    }\r\n  }\r\n\r\n  // PHASE 4 FIX: Load cost mode data from API\r\n  async _loadCostMode() {\r\n    if (!this.projectId) {\r\n      console.error('[KurvaSOverlay] Cannot load cost mode: no projectId');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\r\n        `/detail_project/api/v2/project/${this.projectId}/kurva-s-harga/`,\r\n        { credentials: 'include' }\r\n      );\r\n      if (!response.ok) {\r\n        throw new Error(`API error: ${response.status}`);\r\n      }\r\n\r\n      const costData = await response.json();\r\n      this._log('cost-data-loaded', costData);\r\n\r\n      // Import buildCostDataset dynamically\r\n      const { buildCostDataset } = await import('./dataset-builder.js');\r\n      const dataset = buildCostDataset(costData);\r\n\r\n      if (!dataset) {\r\n        console.error('[KurvaSOverlay] Failed to build cost dataset');\r\n        return;\r\n      }\r\n\r\n      // Convert to curve format\r\n      const curveData = {\r\n        planned: this._convertDatasetSeriesToCurvePoints(dataset, 'planned'),\r\n        actual: this._convertDatasetSeriesToCurvePoints(dataset, 'actual'),\r\n      };\r\n\r\n      this.renderCurve(curveData);\r\n    } catch (error) {\r\n      console.error('[KurvaSOverlay] Failed to load cost mode:', error);\r\n    }\r\n  }\r\n\r\n  // PHASE 4 FIX: Load progress mode data from UnifiedTableManager\r\n  async _loadProgressMode() {\r\n    // Progress mode uses grid-based data from UnifiedTableManager\r\n    // Trigger a refresh by calling tableManager's updateCurvaS\r\n    if (typeof this.tableManager?.updateCurvaS === 'function') {\r\n      this.tableManager.updateCurvaS();\r\n    } else {\r\n      this._log('warn-update-curvas-missing', { message: 'updateCurvaS not available' })\r\n    }\r\n  }\r\n\r\n  // PHASE 4 FIX: Convert dataset series to curve points format\r\n  _convertDatasetSeriesToCurvePoints(dataset, seriesKey) {\r\n    const series = dataset[seriesKey] || [];\r\n    const labels = dataset.labels || [];\r\n    const details = dataset.details || [];\r\n\r\n    return series.map((cumulativeProgress, index) => {\r\n      const detail = details[index] || {};\r\n      const label = labels[index] || `Week ${index + 1}`;\r\n\r\n      // Extract column ID from detail or label\r\n      const columnId = detail?.metadata?.id ||\r\n                      detail?.metadata?.fieldId ||\r\n                      detail?.metadata?.columnId ||\r\n                      detail?.weekNumber ||\r\n                      label.match(/W(\\d+)/)?.[1] ||\r\n                      `week_${index + 1}`;\r\n\r\n      return {\r\n        columnId: String(columnId),\r\n        weekNumber: detail?.weekNumber || detail?.metadata?.weekNumber || index + 1,\r\n        weekProgress: Number(\r\n          seriesKey === 'planned'\r\n            ? (detail.planned ?? detail.plannedPercent ?? cumulativeProgress)\r\n            : (detail.actual ?? detail.actualPercent ?? cumulativeProgress)\r\n        ) || 0,\r\n        cumulativeProgress: Number(cumulativeProgress) || 0,\r\n        label: label,\r\n      };\r\n    });\r\n  }\r\n\r\n  renderCurve(curveData) {\r\n    this.curveData = {\r\n      planned: Array.isArray(curveData.planned) ? curveData.planned : [],\r\n      actual: Array.isArray(curveData.actual) ? curveData.actual : [],\r\n    };\r\n\r\n    this._log('renderCurve', {\r\n      plannedPoints: this.curveData.planned.length,\r\n      actualPoints: this.curveData.actual.length,\r\n    });\r\n\r\n    if (this.visible) {\r\n      this.syncWithTable();\r\n    }\r\n  }\r\n\r\n  _drawCurve(cellRects, dataPoints, color, label) {\r\n    if (!Array.isArray(dataPoints) || dataPoints.length === 0) {\r\n      this._log(`_drawCurve:${label}`, { info: 'No dataPoints' });\r\n      return;\r\n    }\r\n\r\n    const points = this._mapDataToCanvasPoints(cellRects, dataPoints);\r\n    if (points.length === 0) {\r\n      this._log(`_drawCurve:${label}`, { error: 'No points mapped' });\r\n      return;\r\n    }\r\n\r\n    this._log(`_drawCurve:${label}`, { points: points.length, sample: points[0] });\r\n\r\n    // Draw line connecting points\r\n    this.ctx.strokeStyle = color;\r\n    this.ctx.lineWidth = 3;\r\n    this.ctx.lineCap = 'round';\r\n    this.ctx.lineJoin = 'round';\r\n\r\n    this.ctx.beginPath();\r\n    points.forEach((point, index) => {\r\n      if (index === 0) {\r\n        this.ctx.moveTo(point.x, point.y);\r\n      } else {\r\n        this.ctx.lineTo(point.x, point.y);\r\n      }\r\n    });\r\n    this.ctx.stroke();\r\n\r\n    // Draw points (nodes) with hover detection data\r\n    this.ctx.fillStyle = color;\r\n    points.forEach((point) => {\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(point.x, point.y, 6, 0, 2 * Math.PI);\r\n      this.ctx.fill();\r\n\r\n      // White center for better visibility\r\n      this.ctx.fillStyle = '#ffffff';\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(point.x, point.y, 2.5, 0, 2 * Math.PI);\r\n      this.ctx.fill();\r\n      this.ctx.fillStyle = color;\r\n\r\n      // Store point data for tooltip\r\n      point.color = color;\r\n      point.label = label;\r\n    });\r\n\r\n    // Store points for hover detection\r\n    if (!this.curvePoints) this.curvePoints = [];\r\n    this.curvePoints.push(...points);\r\n  }\r\n\r\n  _mapDataToCanvasPoints(cellRects, dataPoints) {\r\n    const points = [];\r\n\r\n    // DEBUG FIX: Use viewport height for Y calculations, not full scrollHeight\r\n    // Y-axis should be relative to visible viewport, not entire table\r\n    const scrollArea = this.tableManager?.bodyScroll;\r\n    const viewportHeight = scrollArea ? scrollArea.clientHeight : this.canvas.height;\r\n\r\n    const y0percent = viewportHeight - 40; // 0% at BOTTOM of viewport\r\n    const y100percent = 40;                 // 100% at TOP of viewport\r\n\r\n    this._log('_mapDataToCanvasPoints', {\r\n      canvasHeight: this.canvas.height,\r\n      viewportHeight,\r\n      y0percent,\r\n      y100percent,\r\n      dataPoints: dataPoints.length,\r\n      cellRects: cellRects.length,\r\n    });\r\n\r\n    // PHASE 2 FIX: Group cell rects by column to find week grid lines (right edges)\r\n    const columnGridLines = this._getWeekGridLines(cellRects);\r\n\r\n    // FIX 2: Add Week 0 node at 0% progress (grid kiri Week 1)\r\n    if (cellRects.length > 0 && dataPoints.length > 0) {\r\n      const firstWeekRect = cellRects.reduce((earliest, rect) => {\r\n        return (!earliest || rect.x < earliest.x) ? rect : earliest;\r\n      }, null);\r\n\r\n      if (firstWeekRect) {\r\n        const week0X = -this.scrollLeft;\r\n        const week0Y = this._interpolateY(0, y0percent, y100percent); // 0% progress\r\n\r\n        points.push({\r\n          x: week0X,\r\n          y: week0Y,\r\n          columnId: 'week_0',\r\n          progress: 0,\r\n          weekNumber: 0,\r\n          weekProgress: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    dataPoints.forEach((dataPoint) => {\r\n      const columnId = dataPoint.columnId || dataPoint.weekId || dataPoint.week;\r\n      const progress = Number.isFinite(dataPoint.cumulativeProgress)\r\n        ? dataPoint.cumulativeProgress\r\n        : dataPoint.progress || 0;\r\n\r\n      const columnGridLine = columnGridLines.get(String(columnId));\r\n      if (!columnGridLine) {\r\n        if (this.debug && !this._missingColumnLog.has(String(columnId))) {\r\n          this._missingColumnLog.add(String(columnId));\r\n          this._log('skip-missing-column', { columnId, availableColumns: columnGridLines.size })\r\n        }\r\n        return;\r\n      }\r\n\r\n      const y = this._interpolateY(progress, y0percent, y100percent);\r\n\r\n      points.push({\r\n        x: columnGridLine,\r\n        y,\r\n        columnId,\r\n        progress,\r\n        weekNumber: dataPoint.weekNumber,\r\n        weekProgress: dataPoint.weekProgress,\r\n      });\r\n    });\r\n\r\n    return points;\r\n  }\r\n\r\n  // PHASE 2 FIX: Get grid lines (right edges) in canvas-relative coordinates\r\n  _getWeekGridLines(cellRects) {\r\n    const columnGridLines = new Map();\r\n\r\n    cellRects.forEach((rect) => {\r\n      const columnId = String(rect.columnId);\r\n      if (!columnGridLines.has(columnId)) {\r\n        // PHASE 2 FIX: Grid line = right edge of column (absolute coordinates)\r\n        const absoluteGridLine = rect.x + rect.width;\r\n\r\n        // PHASE 2 FIX: Convert to canvas-relative coordinates\r\n        // Canvas starts at pinnedWidth, so X=0 on canvas = pinnedWidth in absolute\r\n        // Also compensate for scroll: canvasX = absoluteX - pinnedWidth - scrollLeft\r\n        const canvasRelativeX = absoluteGridLine - this.pinnedWidth - this.scrollLeft;\r\n\r\n        columnGridLines.set(columnId, canvasRelativeX);\r\n      }\r\n    });\r\n\r\n    this._log('grid-lines', {\r\n      sample: Array.from(columnGridLines.entries()).slice(0, 3),\r\n      pinnedWidth: this.pinnedWidth,\r\n      scrollLeft: this.scrollLeft\r\n    });\r\n    return columnGridLines;\r\n  }\r\n\r\n  _interpolateY(progress, y0, y100) {\r\n    // 0%  y0 (bottom), 100%  y100 (top)\r\n    // Clamp progress to [0, 100]\r\n    const clampedProgress = Math.max(0, Math.min(100, progress));\r\n    return y0 - (clampedProgress / 100) * (y0 - y100);\r\n  }\r\n\r\n  _renderWithRetry(attempt = 1, maxAttempts = 3) {\r\n    if (!this.visible) return;\r\n\r\n    const cellRects = typeof this.tableManager?.getCellBoundingRects === 'function'\r\n      ? this.tableManager.getCellBoundingRects()\r\n      : [];\r\n\r\n    const hasSize = this.canvas.width > 0 && this.canvas.height > 0;\r\n    const hasCells = Array.isArray(cellRects) && cellRects.length > 0;\r\n\r\n    if (hasSize && hasCells) {\r\n      this.syncWithTable();\r\n      return;\r\n    }\r\n\r\n    if (attempt < maxAttempts) {\r\n      requestAnimationFrame(() => this._renderWithRetry(attempt + 1, maxAttempts));\r\n    } else {\r\n      this._log('render-retry-exhausted', { hasSize, hasCells })\r\n    }\r\n  }\r\n\r\n  _drawYAxisLabels(canvasHeight) {\r\n    if (!this.yAxisContainer) return;\r\n    this.yAxisContainer.innerHTML = '';\r\n\r\n    const y0 = canvasHeight - 40;\r\n    const y100 = 40;\r\n\r\n    // Background\r\n    const bg = document.createElement('div');\r\n    bg.style.position = 'absolute';\r\n    bg.style.inset = '0';\r\n    bg.style.background = 'rgba(255, 255, 255, 0.9)';\r\n    bg.style.borderLeft = '1px solid #dee2e6';\r\n    this.yAxisContainer.appendChild(bg);\r\n\r\n    const percentages = [0, 20, 40, 60, 80, 100];\r\n    percentages.forEach((pct) => {\r\n      const y = this._interpolateY(pct, y0, y100);\r\n\r\n      const tick = document.createElement('div');\r\n      tick.style.position = 'absolute';\r\n      tick.style.left = '0';\r\n      tick.style.top = `${y}px`;\r\n      tick.style.width = '100%';\r\n      tick.style.height = '1px';\r\n      tick.style.borderTop = '1px solid #dee2e6';\r\n      this.yAxisContainer.appendChild(tick);\r\n\r\n      const label = document.createElement('div');\r\n      label.textContent = `${pct}%`;\r\n      label.style.position = 'absolute';\r\n      label.style.left = '10px';\r\n      label.style.top = `${y - 6}px`;\r\n      label.style.font = '11px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\r\n      label.style.color = '#495057';\r\n      label.style.lineHeight = '12px';\r\n      this.yAxisContainer.appendChild(label);\r\n    });\r\n  }\r\n\r\n  _showLegend() {\r\n    if (this.legendElement) {\r\n      this.legendElement.style.display = 'flex';\r\n      this._updateLegendColors(); // Update for dark/light mode\r\n      return;\r\n    }\r\n\r\n    // Detect dark mode\r\n    const isDarkMode = this._isDarkMode();\r\n\r\n    // Create legend element - repositioned to top-right to reduce overlap\r\n    this.legendElement = document.createElement('div');\r\n    this.legendElement.className = 'kurva-s-legend';\r\n    this.legendElement.style.cssText = `\r\n      position: fixed;\r\n      top: 10px;\r\n      right: 10px;\r\n      background: ${isDarkMode ? 'rgba(30, 30, 30, 0.95)' : 'rgba(255, 255, 255, 0.95)'};\r\n      border: 1px solid ${isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)'};\r\n      border-radius: 8px;\r\n      padding: 8px 12px;\r\n      font-size: 13px;\r\n      font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, ${isDarkMode ? '0.5' : '0.15'});\r\n      z-index: 25;\r\n      pointer-events: none;\r\n      display: flex;\r\n      gap: 16px;\r\n      align-items: center;\r\n    `;\r\n\r\n    const plannedColor = this._getPlannedColor();\r\n    const actualColor = this._getActualColor();\r\n    const textColor = isDarkMode ? '#e5e7eb' : '#374151';\r\n\r\n    this.legendElement.innerHTML = `\r\n      <div style=\"display: flex; align-items: center; gap: 6px;\">\r\n        <div style=\"width: 24px; height: 4px; background: ${plannedColor}; border-radius: 2px;\"></div>\r\n        <span style=\"color: ${textColor}; font-weight: 500;\">Planned</span>\r\n      </div>\r\n      <div style=\"display: flex; align-items: center; gap: 6px;\">\r\n        <div style=\"width: 24px; height: 4px; background: ${actualColor}; border-radius: 2px;\"></div>\r\n        <span style=\"color: ${textColor}; font-weight: 500;\">Actual</span>\r\n      </div>\r\n    `;\r\n\r\n    document.body.appendChild(this.legendElement);\r\n  }\r\n\r\n  _updateLegendColors() {\r\n    if (!this.legendElement) return;\r\n    const isDarkMode = this._isDarkMode();\r\n    this.legendElement.style.background = isDarkMode ? 'rgba(30, 30, 30, 0.95)' : 'rgba(255, 255, 255, 0.95)';\r\n    this.legendElement.style.borderColor = isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)';\r\n    this.legendElement.style.boxShadow = `0 4px 12px rgba(0, 0, 0, ${isDarkMode ? '0.5' : '0.15'})`;\r\n\r\n    const textColor = isDarkMode ? '#e5e7eb' : '#374151';\r\n    const spans = this.legendElement.querySelectorAll('span');\r\n    spans.forEach(span => span.style.color = textColor);\r\n  }\r\n\r\n  _isDarkMode() {\r\n    // Check if body has dark mode class or if system prefers dark mode\r\n    const bodyClassList = document.body.classList;\r\n    if (bodyClassList.contains('dark-mode') || bodyClassList.contains('dark')) {\r\n      return true;\r\n    }\r\n    // Check CSS variable or system preference\r\n    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n  }\r\n\r\n  _hideLegend() {\r\n    if (this.legendElement) {\r\n      this.legendElement.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  _getPlannedColor() {\r\n    // ALWAYS use cyan/info color for planned curve\r\n    // This matches the toolbar btn-outline-info color\r\n    return '#0dcaf0';\r\n  }\r\n\r\n  _getActualColor() {\r\n    // ALWAYS use yellow/warning color for actual curve\r\n    // This matches the toolbar btn-outline-warning color\r\n    return '#ffc107';\r\n  }\r\n\r\n  _getCssVar(name) {\r\n    try {\r\n      const root = document.documentElement;\r\n      const value = getComputedStyle(root).getPropertyValue(name);\r\n      return value && value.trim().length ? value.trim() : null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  _getBtnColor(selector) {\r\n    try {\r\n      const el = document.querySelector(selector);\r\n      if (!el) return null;\r\n      const style = getComputedStyle(el);\r\n      return style.getPropertyValue('background-color')?.trim() ||\r\n        style.getPropertyValue('border-color')?.trim() ||\r\n        style.getPropertyValue('color')?.trim() ||\r\n        null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  _bindPointerEvents() {\r\n    // Add hover tooltip for curve points\r\n    this.canvas.addEventListener('mousemove', (e) => {\r\n      if (!this.visible || !this.curvePoints || this.curvePoints.length === 0) return;\r\n\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      const x = e.clientX - rect.left;\r\n      const y = e.clientY - rect.top;\r\n\r\n      // Hit test: find closest point within 10px radius\r\n      const hit = this._hitTestPoint(x, y, 10);\r\n      if (hit) {\r\n        this._showTooltip(e.clientX, e.clientY, hit);\r\n        this.canvas.style.cursor = 'pointer';\r\n      } else {\r\n        this._hideTooltip();\r\n        this.canvas.style.cursor = 'default';\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener('mouseleave', () => {\r\n      this._hideTooltip();\r\n      this.canvas.style.cursor = 'default';\r\n    });\r\n  }\r\n\r\n  _hitTestPoint(x, y, radius) {\r\n    if (!this.curvePoints) return null;\r\n\r\n    for (const point of this.curvePoints) {\r\n      const dx = point.x - x;\r\n      const dy = point.y - y;\r\n      const distance = Math.sqrt(dx * dx + dy * dy);\r\n      if (distance <= radius) {\r\n        return point;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _ensureTooltip() {\r\n    if (this.tooltip) return this.tooltip;\r\n    this.tooltip = document.createElement('div');\r\n    this.tooltip.className = 'kurvas-overlay-tooltip';\r\n    this.tooltip.style.cssText = `\r\n      position: fixed;\r\n      padding: 8px 12px;\r\n      background: rgba(17, 24, 39, 0.95);\r\n      color: #f8fafc;\r\n      border-radius: 6px;\r\n      font-size: 12px;\r\n      pointer-events: none;\r\n      z-index: 30;\r\n      display: none;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n      line-height: 1.5;\r\n    `;\r\n    document.body.appendChild(this.tooltip);\r\n    return this.tooltip;\r\n  }\r\n\r\n  _showTooltip(clientX, clientY, point) {\r\n    const tip = this._ensureTooltip();\r\n    const weekLabel = point.weekNumber ? `Week ${point.weekNumber}` : point.columnId;\r\n    const progressLabel = Number.isFinite(point.progress) ? `${point.progress.toFixed(1)}%` : '-';\r\n    const weekProgressLabel = Number.isFinite(point.weekProgress) ? `${point.weekProgress.toFixed(1)}%` : '-';\r\n\r\n    tip.innerHTML = `\r\n      <div style=\"font-weight: 600; margin-bottom: 4px; color: ${point.color};\">${point.label}</div>\r\n      <div><strong>${weekLabel}</strong></div>\r\n      <div>Cumulative: ${progressLabel}</div>\r\n      <div>Week Progress: ${weekProgressLabel}</div>\r\n    `;\r\n    tip.style.left = `${clientX + 12}px`;\r\n    tip.style.top = `${clientY + 12}px`;\r\n    tip.style.display = 'block';\r\n  }\r\n\r\n  _hideTooltip() {\r\n    if (this.tooltip) {\r\n      this.tooltip.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  _log(event, payload) {\r\n    if (!this.debug) return;\r\n    console.log(`[KurvaSOverlay] ${event}`, payload || {});\r\n  }\r\n}\r\n","import { TanStackGridManager } from '../grid/tanstack-grid-manager.js';\nimport { GanttCanvasOverlay } from '../gantt/GanttCanvasOverlay.js';\nimport { KurvaSCanvasOverlay } from '../kurva-s/KurvaSCanvasOverlay.js';\nimport { buildProgressDataset } from '../kurva-s/dataset-builder.js';\n\nexport class UnifiedTableManager {\n  constructor(state, options = {}) {\n    this.state = state || {};\n    this.options = options;\n    this.currentMode = 'grid';\n    this.debug = Boolean(this.state?.debugUnifiedTable || this.options?.debugUnifiedTable);\n    this.tanstackGrid = null;\n    this.overlays = {\n      gantt: null,\n      kurva: null, // placeholder for future integration\n    };\n  }\n\n  mount(container, domTargets = {}) {\n    this.tanstackGrid = new TanStackGridManager(this.state, this.options);\n    this.tanstackGrid.mount(container, domTargets);\n    this.tanstackGrid.setCellRenderer('input');\n    this._log('mount', { containerMounted: Boolean(container), debug: this.debug });\n  }\n\n  updateData(payload) {\n    if (this.tanstackGrid) {\n      this._log('updateData', {\n        rows: payload?.tree?.length || this.tanstackGrid.currentRows?.length || 0,\n        cols: payload?.timeColumns?.length || this.tanstackGrid.currentColumns?.length || 0,\n        deps: payload?.dependencies?.length || 0,\n      });\n      this.tanstackGrid.updateData(payload);\n      this._refreshGanttOverlay(payload);\n      this._refreshKurvaSOverlay(payload);\n    }\n  }\n\n  switchMode(newMode) {\n    if (!newMode || newMode === this.currentMode || !this.tanstackGrid) {\n      return;\n    }\n    const oldMode = this.currentMode;\n    const rendererMap = {\n      grid: 'input',\n      gantt: 'gantt',\n      kurva: 'readonly',\n    };\n    const targetRenderer = rendererMap[newMode] || 'input';\n\n    // hide existing overlays\n    if (this.currentMode === 'gantt' && this.overlays.gantt) {\n      this.overlays.gantt.hide();\n    }\n    if (this.currentMode === 'kurva' && this.overlays.kurva) {\n      this.overlays.kurva.hide?.();\n    }\n\n    this.currentMode = newMode;\n    this._log('switchMode', {\n      from: oldMode,\n      to: newMode,\n      renderer: targetRenderer,\n      rows: this.tanstackGrid.currentRows?.length || 0,\n      cols: this.tanstackGrid.currentColumns?.length || 0,\n    });\n    this.tanstackGrid.setCellRenderer(targetRenderer);\n\n    if (newMode === 'gantt') {\n      if (!this.overlays.gantt) {\n        this.overlays.gantt = new GanttCanvasOverlay(this.tanstackGrid);\n      }\n      this.overlays.gantt.show();\n      this._refreshGanttOverlay();\n    }\n\n    if (newMode === 'kurva') {\n      if (!this.overlays.kurva) {\n        // PHASE 4 FIX: Pass projectId for cost mode support\n        const projectId = this.state?.projectId || this.options?.projectId || null;\n        this.overlays.kurva = new KurvaSCanvasOverlay(this.tanstackGrid, { projectId });\n      }\n      this.overlays.kurva.show();\n      this._refreshKurvaSOverlay();\n    }\n  }\n\n  _refreshGanttOverlay(payload = {}) {\n    if (!this.overlays.gantt || !this.tanstackGrid) {\n      return;\n    }\n    const barData = this._buildBarData(payload);\n    const dependencyData = payload.dependencies || [];\n    this._log('refreshGanttOverlay', {\n      bars: barData.length,\n      deps: dependencyData.length,\n    });\n    this.overlays.gantt.renderBars(barData);\n    this.overlays.gantt.renderDependencies(dependencyData);\n  }\n\n  _buildBarData(payload = {}) {\n    let tree = Array.isArray(payload.tree) ? payload.tree : [];\n    let columns = Array.isArray(payload.timeColumns) ? payload.timeColumns : [];\n    const gridRows = this.tanstackGrid?.currentRows || [];\n    const gridColumns = this.tanstackGrid?.currentColumns || [];\n    const flatRows = Array.isArray(this.state?.flatPekerjaan) ? this.state.flatPekerjaan : [];\n\n    if ((!tree.length || tree.length <= 1) && gridRows.length > tree.length) {\n      tree = gridRows;\n    }\n    if ((!tree.length || tree.length <= 1) && flatRows.length) {\n      tree = flatRows.map((row) => ({\n        pekerjaanId: row.id || row.pekerjaan_id,\n        name: row.nama || row.name,\n        raw: row,\n        subRows: [],\n      }));\n    }\n\n    const hasTimeMeta = columns.some((c) => c?.meta?.timeColumn);\n    if ((!columns.length || !hasTimeMeta) && gridColumns.length) {\n      columns = gridColumns;\n    }\n    if (!columns.length && Array.isArray(this.state?.timeColumns)) {\n      columns = this.state.timeColumns.map((col) => ({\n        id: col.id,\n        fieldId: col.fieldId,\n        meta: { timeColumn: true, columnMeta: col },\n      }));\n    }\n\n    const barData = [];\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n    const mergedPlanned = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('planned')\n      : this._mergeModeState(stateManager?.states?.planned);\n    const mergedActual = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('actual')\n      : this._mergeModeState(stateManager?.states?.actual);\n    const activeMode = (this.state?.progressMode || stateManager?.currentMode || 'planned').toLowerCase();\n\n    console.log('[UnifiedTable]  BuildBarData DEBUG:', {\n      rows: tree.length,\n      cols: columns.length,\n      plannedSize: mergedPlanned?.size || 0,\n      actualSize: mergedActual?.size || 0,\n      activeMode,\n      samplePlannedKeys: mergedPlanned ? Array.from(mergedPlanned.keys()).slice(0, 5) : [],\n      sampleActualKeys: mergedActual ? Array.from(mergedActual.keys()).slice(0, 5) : [],\n      samplePlannedValues: mergedPlanned ? Array.from(mergedPlanned.entries()).slice(0, 3) : [],\n      sampleActualValues: mergedActual ? Array.from(mergedActual.entries()).slice(0, 3) : [],\n    });\n\n    this._log('buildBarData:start', {\n      rows: tree.length,\n      cols: columns.length,\n      plannedSize: mergedPlanned?.size || 0,\n      actualSize: mergedActual?.size || 0,\n      activeMode,\n      timeColumnsWithMeta: columns.filter((c) => c.meta?.timeColumn).length,\n      sampleColumns: columns.slice(0, 5).map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id),\n      sampleRows: tree.slice(0, 3).map((r) => r.pekerjaanId || r.id || r.raw?.pekerjaan_id),\n    });\n\n    const rowsForBars = this._flattenRows(tree);\n    const rowIndex = new Map();\n    rowsForBars.forEach((row) => {\n      const pekerjaanId = row.pekerjaanId || row.id || row.raw?.pekerjaan_id;\n      if (!pekerjaanId) return;\n      rowIndex.set(String(pekerjaanId), {\n        label: row.name || row.raw?.nama || pekerjaanId,\n      });\n    });\n\n    const columnIndex = new Map();\n    columns.forEach((col) => {\n      const meta = this._resolveColumnMeta(col);\n      if (!meta?.timeColumn) return;\n      const columnId = col.fieldId || col.id || meta.fieldId || meta.id || meta.columnId || meta.column_id;\n      if (!columnId) return;\n      columnIndex.set(String(columnId), meta);\n    });\n\n    const allKeys = new Set([\n      ...Array.from(mergedPlanned?.keys?.() || []),\n      ...Array.from(mergedActual?.keys?.() || []),\n    ]);\n\n    allKeys.forEach((cellKey) => {\n      const [pkjIdRaw, colIdRaw] = String(cellKey).split('-');\n      const pekerjaanId = String(pkjIdRaw || '').trim();\n      const columnId = String(colIdRaw || '').trim();\n      if (!pekerjaanId || !columnId) {\n        return;\n      }\n      const rowInfo = rowIndex.get(pekerjaanId);\n      const colMeta = columnIndex.get(columnId);\n      if (!rowInfo || !colMeta) {\n        return;\n      }\n      const plannedValue = this._resolveValue(mergedPlanned, cellKey, 0);\n      const actualValue = this._resolveValue(mergedActual, cellKey, plannedValue);\n      if (!Number.isFinite(plannedValue) && !Number.isFinite(actualValue)) {\n        return;\n      }\n      const variance = (Number(actualValue) || 0) - (Number(plannedValue) || 0);\n      barData.push({\n        pekerjaanId,\n        columnId,\n        value: Number(actualValue) || 0,\n        planned: Number(plannedValue) || 0,\n        actual: Number(actualValue) || 0,\n        variance,\n        label: rowInfo.label,\n        color: '#4dabf7',\n      });\n    });\n\n    if (barData.length === 0 && (mergedPlanned?.size > 0 || mergedActual?.size > 0)) {\n      console.warn('[UnifiedTable]  NO BAR DATA despite having cell values! Check:', {\n        'mergedPlanned.size': mergedPlanned?.size || 0,\n        'mergedActual.size': mergedActual?.size || 0,\n        'tree.length': tree.length,\n        'columns.length': columns.length,\n        'timeColumnsWithMeta': columns.filter((c) => c.meta?.timeColumn).length\n      });\n      this._log('buildBarData:debug', {\n        plannedKeys: mergedPlanned ? Array.from(mergedPlanned.keys()).slice(0, 5) : [],\n        actualKeys: mergedActual ? Array.from(mergedActual.keys()).slice(0, 5) : [],\n        columnIds: columns.map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id || c.meta?.columnId || c.meta?.column_id || c.id).slice(0, 5),\n      });\n    }\n\n    this._log('buildBarData:done', { bars: barData.length });\n    return barData;\n  }\n\n  _flattenRows(nodes = []) {\n    const result = [];\n    const stack = Array.isArray(nodes) ? [...nodes] : [];\n    while (stack.length) {\n      const node = stack.shift();\n      if (!node) continue;\n      result.push(node);\n      if (Array.isArray(node.subRows) && node.subRows.length) {\n        stack.push(...node.subRows);\n      } else if (Array.isArray(node.children) && node.children.length) {\n        stack.push(...node.children);\n      } else if (Array.isArray(node.sub) && node.sub.length) {\n        stack.push(...node.sub);\n      }\n    }\n    return result;\n  }\n\n  _resolveColumnMeta(col) {\n    if (!col) return null;\n    if (col.meta?.columnMeta && col.meta?.timeColumn) {\n      return { ...col.meta.columnMeta, timeColumn: true };\n    }\n    if (col.meta?.timeColumn) {\n      return { ...(col.meta.columnMeta || col.meta), timeColumn: true };\n    }\n    const mode = (col.generationMode || col.type || '').toLowerCase();\n    const isTime = mode === 'weekly' || mode === 'monthly' || Boolean(col.rangeLabel || col.weekNumber);\n    if (isTime) {\n      return { ...col, timeColumn: true, columnMeta: col };\n    }\n    return null;\n  }\n\n  _mergeModeState(modeState) {\n    if (!modeState) {\n      return new Map();\n    }\n    const merged = new Map(modeState.assignmentMap || []);\n    (modeState.modifiedCells || new Map()).forEach((value, key) => {\n      merged.set(key, value);\n    });\n    return merged;\n  }\n\n  _resolveValue(map, key, fallback) {\n    if (map && map.has && map.has(key)) {\n      const val = map.get(key);\n      if (Number.isFinite(val)) {\n        return val;\n      }\n    }\n    return fallback;\n  }\n\n  _refreshKurvaSOverlay(payload = {}) {\n    if (!this.overlays.kurva || !this.tanstackGrid) {\n      return;\n    }\n\n    const curveData = this._buildCurveData(payload);\n    this._log('refreshKurvaSOverlay', {\n      plannedPoints: curveData.planned.length,\n      actualPoints: curveData.actual.length,\n    });\n\n    this.overlays.kurva.renderCurve(curveData);\n  }\n\n  // Exposed for KurvaSCanvasOverlay progress refresh\n  updateCurvaS(payload = {}) {\n    this._refreshKurvaSOverlay(payload);\n  }\n\n  // PHASE 4 FIX: Set Kurva-S mode (progress or cost)\n  async setKurvaMode(mode) {\n    if (!this.overlays.kurva) {\n      console.warn('[UnifiedTable] Cannot set Kurva mode: overlay not initialized');\n      return;\n    }\n\n    this._log('setKurvaMode', { mode });\n    await this.overlays.kurva.setMode(mode);\n  }\n\n  // PHASE 3 FIX: Use dataset-builder.js with volume/harga weighting instead of simple average\n  _buildCurveData(payload = {}) {\n    // Get columns and state\n    let columns = Array.isArray(payload.timeColumns) ? payload.timeColumns : [];\n    const gridColumns = this.tanstackGrid?.currentColumns || [];\n\n    if (!columns.length && gridColumns.length) {\n      columns = gridColumns;\n    }\n    if (!columns.length && Array.isArray(this.state?.timeColumns)) {\n      columns = this.state.timeColumns;\n    }\n\n    // Filter to time columns only\n    const timeColumns = columns.filter((col) => {\n      const meta = this._resolveColumnMeta(col);\n      return meta?.timeColumn;\n    });\n\n    if (timeColumns.length === 0) {\n      this._log('buildCurveData:noTimeColumns', { columnsTotal: columns.length });\n      return { planned: [], actual: [] };\n    }\n\n    // Get state data\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n\n    // PHASE 3 FIX: Build state object for dataset-builder.js\n    const datasetState = {\n      timeColumns: timeColumns,\n      stateManager: stateManager,\n      tree: this.state?.tree || payload?.tree || [],\n      totalBiayaProject: this.state?.totalBiayaProject || payload?.totalBiayaProject || 0,\n    };\n\n    this._log('buildCurveData:state', {\n      timeColumns: timeColumns.length,\n      tree: datasetState.tree.length,\n      totalBiaya: datasetState.totalBiayaProject,\n    });\n\n    // PHASE 3 FIX: Use buildProgressDataset with weighted calculations\n    const dataset = buildProgressDataset(datasetState);\n\n    if (!dataset) {\n      this._log('buildCurveData:noDataset', { state: datasetState });\n      return { planned: [], actual: [] };\n    }\n\n    // Convert dataset format to curve points format\n    const plannedCurve = this._convertDatasetToCurvePoints(dataset, 'planned');\n    const actualCurve = this._convertDatasetToCurvePoints(dataset, 'actual');\n\n    this._log('buildCurveData:result', {\n      plannedPoints: plannedCurve.length,\n      actualPoints: actualCurve.length,\n      useHargaCalculation: dataset.useHargaCalculation,\n      totalBiaya: dataset.totalBiaya,\n      totalVolume: dataset.totalVolume,\n    });\n\n    return {\n      planned: plannedCurve,\n      actual: actualCurve,\n    };\n  }\n\n  // PHASE 3 FIX: Convert dataset-builder.js format to curve points format\n  _convertDatasetToCurvePoints(dataset, seriesKey) {\n    const series = dataset[seriesKey] || [];\n    const labels = dataset.labels || [];\n    const details = dataset.details || [];\n\n    return series.map((cumulativeProgress, index) => {\n      const detail = details[index] || {};\n      const label = labels[index] || `Week ${index + 1}`;\n\n      // Extract column ID from detail or label\n      const columnId = detail?.metadata?.id ||\n                      detail?.metadata?.fieldId ||\n                      detail?.metadata?.columnId ||\n                      `week_${index + 1}`;\n\n      return {\n        columnId: String(columnId),\n        weekNumber: index + 1,\n        weekProgress: seriesKey === 'planned' ? detail.planned : detail.actual,\n        cumulativeProgress: cumulativeProgress,\n        label: label,\n      };\n    });\n  }\n\n  _log(event, payload) {\n    const enabled = this.debug || Boolean(window.DEBUG_UNIFIED_TABLE);\n    if (!enabled) return;\n    console.log(`[UnifiedTable] ${event}`, payload);\n  }\n}\n","import { StateManager } from '@modules/core/state-manager.js';\n\n/**\n * AppInitializer - Builds initial state and DOM references for Jadwal Kegiatan\n *\n * This class is responsible for:\n * - Creating the initial application state object with all default values\n * - Building DOM references for all UI elements\n * - Maintaining backward compatibility with window.kelolaTahapanPageState\n *\n * Minimal behavior change: mirrors previous _setupState and _setupDomRefs logic.\n *\n * @class AppInitializer\n * @example\n * const initializer = new AppInitializer();\n * const state = initializer.buildState({ projectId: 123 });\n * const domRefs = initializer.buildDomRefs(state);\n */\nexport class AppInitializer {\n  /**\n   * Create a new AppInitializer instance\n   * @param {StateManager|null} stateManager - Optional StateManager instance (defaults to singleton)\n   */\n  constructor(stateManager = null) {\n    this.stateManager = stateManager || StateManager.getInstance();\n  }\n\n  /**\n   * Build initial state object (without side effects beyond window exposure).\n   *\n   * Creates a complete state object with all necessary properties for the Jadwal Kegiatan page.\n   * Includes dual-mode state (planned/actual), DOM refs, API endpoints, and configuration.\n   *\n   * @param {Object} config - Configuration object\n   * @param {number} [config.projectId] - Project ID\n   * @param {string} [config.projectName] - Project name\n   * @param {string} [config.projectStart] - Project start date (ISO format)\n   * @param {string} [config.projectEnd] - Project end date (ISO format)\n   * @param {boolean} [config.disableUnifiedTable] - Disable TanStack unified table\n   * @param {boolean} [config.enableLegacyGantt] - Enable legacy Frappe Gantt\n   * @param {boolean} [config.debugUnifiedTable] - Enable unified table debug logs\n   * @param {Object} [config.initialState] - Additional state properties to merge\n   * @param {Object|null} existingState - Existing state to merge (for hot reload)\n   * @param {Object} options - Additional options\n   * @param {Function} options.createTimeColumnIndex - Function to create time column index\n   * @returns {Object} Complete state object with all properties initialized\n   *\n   * @example\n   * const state = initializer.buildState({\n   *   projectId: 123,\n   *   projectName: 'Construction Project',\n   *   projectStart: '2025-01-01',\n   *   projectEnd: '2025-12-31'\n   * });\n   */\n  buildState(config = {}, existingState = null, options = {}) {\n    const createTimeColumnIndex =\n      typeof options.createTimeColumnIndex === 'function'\n        ? options.createTimeColumnIndex\n        : () => ({});\n\n    const state = Object.assign(\n      {\n        // Shared state (mode-independent)\n        pekerjaanTree: [],\n        timeColumns: [],\n        tahapanList: [],\n        timeColumnIndex: {},\n        expandedNodes: new Set(),\n        volumeMap: new Map(),\n        isLoading: false,\n        error: null,\n        domRefs: {},\n        apiEndpoints: {},\n        projectId: null,\n        projectName: '',\n        projectStart: null,\n        projectEnd: null,\n        useUPlotKurva: true, // uPlot Kurva-S aktif secara default\n        timeScale: 'weekly',\n        inputMode: 'percentage',\n        saveMode: 'weekly',\n        weekStartDay: 0,\n        weekEndDay: 6,\n        displayScale: null,\n        progressMode: 'planned',\n        displayMode: 'percentage',\n        useUnifiedTable: config.disableUnifiedTable ? false : true,\n        keepLegacyGantt: config.enableLegacyGantt ? true : false,\n        dependencies: [],\n        debugUnifiedTable: Boolean(config.debugUnifiedTable || window.DEBUG_UNIFIED_TABLE),\n\n        // Phase 0.3: StateManager reference\n        stateManager: this.stateManager,\n\n        // Mode-specific non-cell data\n        plannedState: {\n          progressTotals: new Map(),\n          volumeTotals: new Map(),\n          cellVolumeOverrides: new Map(),\n          cellValidationMap: new Map(),\n          failedRows: new Set(),\n          autoWarningRows: new Set(),\n          volumeWarningRows: new Set(),\n          validationWarningRows: new Set(),\n          saveErrorRows: new Set(),\n          apiFailedRows: new Set(),\n          showCompletionWarnings: false,\n          isDirty: false,\n        },\n        actualState: {\n          progressTotals: new Map(),\n          volumeTotals: new Map(),\n          cellVolumeOverrides: new Map(),\n          cellValidationMap: new Map(),\n          failedRows: new Set(),\n          autoWarningRows: new Set(),\n          volumeWarningRows: new Set(),\n          validationWarningRows: new Set(),\n          saveErrorRows: new Set(),\n          apiFailedRows: new Set(),\n          showCompletionWarnings: false,\n          isDirty: false,\n        },\n\n        // Backward compatibility placeholders\n        progressTotals: null,\n        volumeTotals: null,\n        cellVolumeOverrides: null,\n        cellValidationMap: null,\n        failedRows: null,\n        autoWarningRows: null,\n        volumeWarningRows: null,\n        validationWarningRows: null,\n        saveErrorRows: null,\n        apiFailedRows: null,\n        showCompletionWarnings: false,\n        isDirty: false,\n      },\n      existingState || {},\n      config.initialState || {}\n    );\n\n    // Expose to window for backwards compatibility\n    window.kelolaTahapanPageState = state;\n\n    // Build time column index early\n    state.timeColumnIndex = createTimeColumnIndex(state.timeColumns);\n\n    return state;\n  }\n\n  /**\n   * Build DOM references (pure function).\n   *\n   * Queries the DOM for all required UI elements and stores references in state.domRefs.\n   * This is called once during initialization to avoid repeated DOM queries.\n   *\n   * @param {Object} state - Application state object\n   * @param {Object} config - Configuration object\n   * @param {Object} [config.domRefs] - Additional DOM refs to merge\n   * @returns {Object} DOM references object with all UI elements\n   *\n   * @property {HTMLElement} root - Main app container (#tahapan-grid-app)\n   * @property {HTMLButtonElement} saveButton - Save button (#save-button)\n   * @property {HTMLButtonElement} refreshButton - Refresh button (#refresh-button)\n   * @property {HTMLButtonElement} resetButton - Reset progress button (#btn-reset-progress)\n   * @property {HTMLElement} tanstackGridContainer - TanStack grid container\n   * @property {HTMLElement} tanstackGridBody - TanStack grid body\n   * @property {HTMLElement} scurveChart - S-Curve chart container\n   * @property {HTMLElement} ganttChart - Gantt chart container\n   * @property {HTMLElement} statusBar - Status bar element\n   * @property {HTMLElement} weekStartSelect - Week start day select\n   * @property {HTMLElement} weekEndSelect - Week end day select\n   *\n   * @example\n   * const domRefs = initializer.buildDomRefs(state);\n   * domRefs.saveButton.addEventListener('click', handleSave);\n   */\n  buildDomRefs(state, config = {}) {\n    const domRefs = Object.assign(\n      {\n        root: document.getElementById('tahapan-grid-app'),\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\n        refreshButton: document.getElementById('refresh-button'),\n        resetButton: document.getElementById('btn-reset-progress'),\n        tanstackGridContainer: document.getElementById('tanstack-grid-container'),\n        tanstackGridBody: document.getElementById('tanstack-grid-body'),\n        tanstackGridTopScroll: document.getElementById('tanstack-grid-scroll-top'),\n        tanstackGridTopScrollInner: document.getElementById('tanstack-grid-scroll-inner'),\n        scurveChart: document.getElementById('scurve-chart'),\n        ganttChart: document.getElementById('gantt-chart'),\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\n        statusBar: document.querySelector('.status-bar'),\n        statusMessageEl: document.getElementById('status-message'),\n        itemCountEl: document.getElementById('item-count'),\n        modifiedCountEl: document.getElementById('modified-count'),\n        totalProgressEl: document.getElementById('total-progress'),\n        weekStartSelect: document.getElementById('week-start-day-select'),\n        weekEndSelect: document.getElementById('week-end-day-select'),\n      },\n      config.domRefs || {}\n    );\n\n    state.domRefs = domRefs;\n    return domRefs;\n  }\n}\n","import {\n  KeyboardShortcuts,\n  Toast,\n  initializeUXEnhancements\n} from '@modules/shared/ux-enhancements.js';\n\n/**\n * EventBinder - Handles UI event wiring and UX helpers for Jadwal Kegiatan\n *\n * This class is responsible for:\n * - Attaching event listeners to toolbar buttons (save, refresh, reset)\n * - Setting up keyboard shortcuts (Ctrl+S, Ctrl+R, etc.)\n * - Wiring radio button groups (display mode, progress mode, time scale)\n * - Initializing UX enhancements (tooltips, loading states, etc.)\n *\n * @class EventBinder\n * @example\n * const binder = new EventBinder(app);\n * binder.attachAll(); // Wire all events\n */\nexport class EventBinder {\n  /**\n   * Create a new EventBinder instance\n   * @param {Object} app - JadwalKegiatanApp instance (acts as controller)\n   */\n  constructor(app) {\n    this.app = app;\n  }\n\n  /**\n   * Attach all event listeners (toolbar, shortcuts, UX enhancements)\n   *\n   * This is the main entry point called during app initialization.\n   * Delegates to specialized setup methods for different event categories.\n   *\n   * @returns {void}\n   */\n  attachAll() {\n    this._attachToolbarEvents();\n    this.app._initTanStackGridIfNeeded();\n  }\n\n  /**\n   * Attach toolbar button events and radio group handlers (private)\n   *\n   * Wires up:\n   * - Save/Refresh/Reset buttons\n   * - Display mode radios (percentage/volume/cost)\n   * - Progress mode radios (planned/actual)\n   * - Time scale radios (daily/weekly/monthly)\n   * - Week boundary controls\n   * - Export buttons\n   * - Cost view toggle\n   * - Keyboard shortcuts\n   * - UX enhancements\n   *\n   * @private\n   * @returns {void}\n   */\n  _attachToolbarEvents() {\n    const dom = this.app.state?.domRefs || {};\n    const saveButton = dom.saveButton;\n    const refreshButton = dom.refreshButton;\n    const resetButton = dom.resetButton;\n\n    if (saveButton) {\n      saveButton.addEventListener('click', () => this.app.saveChanges());\n    }\n\n    if (refreshButton) {\n      refreshButton.addEventListener('click', () => this.app.refresh());\n    }\n\n    if (resetButton) {\n      resetButton.addEventListener('click', () => this.app._handleResetProgress());\n    }\n\n    this.app._syncToolbarRadios();\n    this.app._attachRadioGroupHandler('displayMode', (value) => this.app._handleDisplayModeChange(value));\n    this.app._attachRadioGroupHandler('progressMode', (value) => this.app._handleProgressModeChange(value));\n    this.app._attachRadioGroupHandler('timeScale', (value) => this.app._handleTimeScaleChange(value));\n    this.app._setupWeekBoundaryControls();\n    this.app._setupExportButtons();\n    this.app._setupCostViewToggle();\n    this._setupKeyboardShortcuts();\n    this._setupUXEnhancements();\n  }\n\n  /**\n   * Setup keyboard shortcuts for common actions (private)\n   *\n   * Registered shortcuts:\n   * - Ctrl+S: Save changes\n   * - Ctrl+R: Refresh data\n   * - Ctrl+Alt+P: Switch to Perencanaan mode\n   * - Ctrl+Alt+A: Switch to Realisasi mode\n   * - Ctrl+Alt+1: Switch to Percentage display\n   * - Ctrl+Alt+2: Switch to Volume display\n   * - Ctrl+Alt+3: Switch to Cost display\n   * - Escape: Close open menus\n   * - Ctrl+Shift+/: Show shortcuts help\n   *\n   * @private\n   * @returns {void}\n   */\n  _setupKeyboardShortcuts() {\n    this.app.keyboardShortcuts = new KeyboardShortcuts();\n\n    this.app.keyboardShortcuts.register('ctrl+s', () => {\n      this.app.saveChanges();\n      Toast.info('Saving changes... (Ctrl+S)');\n    }, { description: 'Save all changes' });\n\n    this.app.keyboardShortcuts.register('ctrl+r', () => {\n      this.app.refresh();\n      Toast.info('Refreshing data... (Ctrl+R)');\n    }, { description: 'Refresh data from server' });\n\n    this.app.keyboardShortcuts.register('ctrl+alt+p', () => {\n      const plannedRadio = document.getElementById('mode-planned');\n      if (plannedRadio) {\n        plannedRadio.checked = true;\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\n      }\n    }, { description: 'Switch to Perencanaan mode' });\n\n    this.app.keyboardShortcuts.register('ctrl+alt+a', () => {\n      const actualRadio = document.getElementById('mode-actual');\n      if (actualRadio) {\n        actualRadio.checked = true;\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\n      }\n    }, { description: 'Switch to Realisasi mode' });\n\n    this.app.keyboardShortcuts.register('ctrl+alt+1', () => {\n      const percentageRadio = document.getElementById('mode-percentage');\n      if (percentageRadio && !percentageRadio.disabled) {\n        percentageRadio.checked = true;\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\n      }\n    }, { description: 'Switch to Percentage display' });\n\n    this.app.keyboardShortcuts.register('ctrl+alt+2', () => {\n      const volumeRadio = document.getElementById('mode-volume');\n      if (volumeRadio && !volumeRadio.disabled) {\n        volumeRadio.checked = true;\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\n      }\n    }, { description: 'Switch to Volume display' });\n\n    this.app.keyboardShortcuts.register('ctrl+alt+3', () => {\n      const costRadio = document.getElementById('mode-cost');\n      if (costRadio && !costRadio.disabled) {\n        costRadio.checked = true;\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\n      } else {\n        Toast.warning('Cost view only available in Realisasi mode');\n      }\n    }, { description: 'Switch to Cost display' });\n\n    this.app.keyboardShortcuts.register('escape', () => {\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\n      openDropdowns.forEach(dropdown => {\n        const toggle = dropdown.previousElementSibling;\n        if (toggle) {\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\n          if (bsDropdown) bsDropdown.hide();\n        }\n      });\n    }, { description: 'Close open menus', preventDefault: false });\n\n    this.app.keyboardShortcuts.register('ctrl+shift+/', () => {\n      this._showKeyboardShortcutsHelp();\n    }, { description: 'Show keyboard shortcuts help' });\n\n    if (this.app?.state?.debugUnifiedTable || window.DEBUG_UNIFIED_TABLE) {\n      console.log('[EventBinder] Keyboard shortcuts registered', this.app.keyboardShortcuts.getShortcuts?.());\n    }\n  }\n\n  /**\n   * Initialize UX enhancements (tooltips, keyboard hints, etc.) (private)\n   *\n   * Applies:\n   * - Bootstrap tooltips initialization\n   * - Keyboard hint badges on buttons\n   * - Loading state utilities\n   * - Focus management\n   *\n   * @private\n   * @returns {void}\n   */\n  _setupUXEnhancements() {\n    initializeUXEnhancements();\n    const saveButton = this.app.state?.domRefs?.saveButton;\n    if (saveButton) {\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\n    }\n    if (this.app?.state?.debugUnifiedTable || window.DEBUG_UNIFIED_TABLE) {\n      console.log('[EventBinder] UX enhancements applied');\n    }\n  }\n\n  /**\n   * Display keyboard shortcuts help modal (private)\n   *\n   * Shows a Bootstrap modal with all registered keyboard shortcuts\n   * and their descriptions in a formatted table.\n   *\n   * @private\n   * @returns {void}\n   */\n  _showKeyboardShortcutsHelp() {\n    const shortcuts = this.app.keyboardShortcuts?.getShortcuts?.() || [];\n    const shortcutList = shortcuts.map(s => `\n      <tr>\n        <td><kbd>${s.key.replace(/\\\\+/g, '</kbd> + <kbd>')}</kbd></td>\n        <td>${s.description}</td>\n      </tr>\n    `).join('');\n\n    const modalHtml = `\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\n        <div class=\"modal-dialog\">\n          <div class=\"modal-content\">\n            <div class=\"modal-header\">\n              <h5 class=\"modal-title\">\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\n              </h5>\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\n            </div>\n            <div class=\"modal-body\">\n              <table class=\"table table-sm\">\n                <thead>\n                  <tr>\n                    <th>Shortcut</th>\n                    <th>Deskripsi</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${shortcutList}\n                </tbody>\n              </table>\n            </div>\n            <div class=\"modal-footer\">\n              <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const existingModal = document.getElementById('keyboardShortcutsModal');\n    if (existingModal) {\n      existingModal.remove();\n    }\n    const container = document.createElement('div');\n    container.innerHTML = modalHtml;\n    document.body.appendChild(container.firstElementChild);\n\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\n      const el = document.getElementById('keyboardShortcutsModal');\n      if (el && el.parentNode) el.parentNode.removeChild(el);\n    });\n    modal.show();\n  }\n}\n","import { DataLoader } from '@modules/core/data-loader.js';\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\nimport { SaveHandler } from '@modules/core/save-handler.js';\n\n/**\n * DataOrchestrator - Manages data loading, timeline regeneration, and save operations\n *\n * This class is responsible for:\n * - Loading initial data (tahapan, pekerjaan, volumes, assignments)\n * - Coordinating DataLoader, TimeColumnGenerator, and SaveHandler\n * - Regenerating timeline when scale changes (weekly/monthly)\n * - Handling refresh and reload operations\n * - Managing loading states and error handling\n *\n * @class DataOrchestrator\n * @example\n * const orchestrator = new DataOrchestrator(app);\n * await orchestrator.loadInitialData();\n * await orchestrator.regenerateTimeline({ mode: 'weekly' });\n */\nexport class DataOrchestrator {\n  /**\n   * Create a new DataOrchestrator instance\n   * @param {Object} app - JadwalKegiatanApp instance\n   */\n  constructor(app) {\n    this.app = app;\n  }\n\n  /**\n   * Load initial data (tahapan, pekerjaan, volumes, assignments) and initialize charts\n   *\n   * Loading sequence:\n   * 1. Check if data already preloaded from template\n   * 2. Initialize DataLoader, TimeColumnGenerator, SaveHandler\n   * 3. Load base data (tahapan list, pekerjaan tree, volumes)\n   * 4. Generate time columns (enforce weekly if needed)\n   * 5. Load assignments and calculate progress totals\n   * 6. Load S-Curve cost data\n   * 7. Initialize and update charts\n   *\n   * @param {Object} options - Loading options\n   * @param {boolean} [options.forceReload=false] - Force reload even if data exists\n   * @returns {Promise<void>}\n   *\n   * @example\n   * await orchestrator.loadInitialData({ forceReload: true });\n   */\n  async loadInitialData(options = {}) {\n    const app = this.app;\n    const { forceReload = false } = options;\n\n    if (!forceReload && app.state.pekerjaanTree?.length > 0) {\n      console.log('[JadwalKegiatanApp] Using template dataset');\n      console.log('Preloaded pekerjaanTree items:', app.state.pekerjaanTree.length);\n      console.log('Preloaded tahapanList items:', app.state.tahapanList?.length || 0);\n      console.log('Preloaded timeColumns items:', app.state.timeColumns?.length || 0);\n      app._recalculateAllProgressTotals();\n      app._syncGridViews();\n      return;\n    }\n\n    app._showSkeleton('grid');\n\n    // Init modern modules\n    app.state.apiBase = app.state.apiEndpoints?.tahapan || `/detail_project/api/project/${app.state.projectId}/tahapan/`;\n    app.dataLoader = new DataLoader(app.state);\n    app.timeColumnGenerator = new TimeColumnGenerator(app.state);\n    app.saveHandler = new SaveHandler(app.state, {\n      apiUrl:\n        app.state.apiEndpoints?.save ||\n        `/detail_project/api/project/${app.state.projectId}/pekerjaan/assign_weekly/`,\n      onSuccess: (result) => app._onSaveSuccess(result),\n      onError: (error) => app._onSaveError(error),\n      showToast: (msg, type) => app.showToast(msg, type),\n      dataLoader: app.dataLoader\n    });\n\n    app.state.isLoading = true;\n\n    try {\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\n\n      // 1) Base data\n      await app.dataLoader.loadAllData({ skipIfLoaded: false, force: forceReload });\n\n      // 2) Generate time columns (enforce weekly jika perlu)\n      app.timeColumnGenerator.generate();\n      const normalizedDisplayScale = (app.state.displayScale || app.state.timeScale || 'weekly').toLowerCase();\n      if (!app._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\n        const weeklyCount = app._countWeeklyColumns();\n        const expectedWeeks = app._estimateExpectedWeeklyColumns();\n        const firstColumnMode =\n          (app.state.timeColumns?.[0]?.generationMode || app.state.timeColumns?.[0]?.type || '').toLowerCase();\n\n        const shouldForceWeekly =\n          weeklyCount === 0 ||\n          firstColumnMode === 'monthly' ||\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\n\n        if (shouldForceWeekly) {\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\n          app._isEnforcingWeekly = true;\n          await this.regenerateTimeline({\n            mode: 'weekly',\n            weekStartDay: app._getWeekStartDay(),\n            weekEndDay: app._getWeekEndDay(),\n          });\n          app._isEnforcingWeekly = false;\n          return;\n        }\n      }\n\n      // 3) Assignments + totals\n      await app.dataLoader.loadAssignments();\n      app._recalculateAllProgressTotals();\n\n      // 3.5) Kurva S harga\n      await app._loadKurvaSData();\n\n      // 3.6) Dependencies array untuk unified overlay\n      app.state.dependencies = app.state.dependencies || [];\n      app.state.timeColumnIndex = app._createTimeColumnIndex(app.state.timeColumns);\n\n      console.log(\n        '[JadwalKegiatanApp] o. Data loaded successfully:',\n        `${app.state.flatPekerjaan?.length || 0} pekerjaan,`,\n        `${app.state.tahapanList?.length || 0} tahapan,`,\n        `${app.state.timeColumns?.length || 0} columns`\n      );\n\n      // 4) Charts\n      app._initializeCharts();\n      app._updateCharts();\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] ?O Failed to load data:', error);\n      app.state.error = error;\n      app.showToast('Gagal memuat data: ' + error.message, 'danger');\n    } finally {\n      app.state.isLoading = false;\n      app._syncGridViews();\n      app._hideSkeleton('grid');\n    }\n  }\n\n  /**\n   * Regenerate timeline columns (weekly/monthly) and reload dataset\n   *\n   * This triggers a backend API call to regenerate tahapan with new time scale.\n   * Unsaved changes will be lost (user is prompted for confirmation).\n   *\n   * @param {Object} options - Regeneration options\n   * @param {string} [options.mode='weekly'] - Time scale mode ('weekly' or 'monthly')\n   * @param {number} [options.weekStartDay] - Week start day (0=Sunday, 1=Monday, etc.)\n   * @param {number} [options.weekEndDay] - Week end day (0=Sunday, 6=Saturday, etc.)\n   * @returns {Promise<void>}\n   *\n   * @example\n   * await orchestrator.regenerateTimeline({\n   *   mode: 'weekly',\n   *   weekStartDay: 1, // Monday\n   *   weekEndDay: 6    // Saturday\n   * });\n   */\n  async regenerateTimeline(options = {}) {\n    const app = this.app;\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\n    const endpoint = app.state.apiEndpoints?.regenerateTahapan;\n    if (!endpoint) return;\n\n    if (app._isRegeneratingTimeline) {\n      app._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\n      return;\n    }\n\n    if (app.state.isDirty && app.state.modifiedCells instanceof Map && app.state.modifiedCells.size > 0) {\n      const confirmed = window.confirm(\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\n      );\n      if (!confirmed) return;\n      app._resetEditedCellsState();\n      app.state.isDirty = false;\n    }\n\n    app._isRegeneratingTimeline = true;\n    app.state.isLoading = true;\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\n    app._updateStatusBar(statusLabel);\n    const toastLabel =\n      mode === 'monthly'\n        ? 'Mengatur ulang kolom monthly...'\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\n    app.showToast(toastLabel, 'info', 2400);\n\n    try {\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': app._getCsrfToken(),\n        },\n        body: JSON.stringify({\n          mode,\n          ...(mode === 'weekly'\n            ? {\n                week_start_day:\n                  typeof weekStartDay === 'number' ? weekStartDay : app._getWeekStartDay(),\n                week_end_day:\n                  typeof weekEndDay === 'number' ? weekEndDay : app._getWeekEndDay(),\n              }\n            : {}),\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      app._invalidateCachedDataset();\n      await this.loadInitialData({ forceReload: true });\n      const successMessage =\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\n      app.showToast(successMessage, 'success', 2200);\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\n      app.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\n    } finally {\n      app.state.isLoading = false;\n      app._updateStatusBar();\n      app._isRegeneratingTimeline = false;\n      if (app._queuedRegeneratePayload) {\n        const next = app._queuedRegeneratePayload;\n        app._queuedRegeneratePayload = null;\n        this.regenerateTimeline(next);\n      }\n    }\n  }\n}\n","/**\n * UXManager - Manages UI/UX elements and user interactions\n *\n * This class is responsible for:\n * - Syncing toolbar radio buttons with application state\n * - Managing skeleton loaders (show/hide)\n * - Setting up week boundary controls\n * - Configuring cost view toggle\n * - Handling loading states and transitions\n *\n * @class UXManager\n * @example\n * const uxManager = new UXManager(app);\n * uxManager.syncToolbarRadios();\n * uxManager.showSkeleton('grid');\n */\nexport class UXManager {\n  /**\n   * Create a new UXManager instance\n   * @param {Object} app - JadwalKegiatanApp instance\n   */\n  constructor(app) {\n    this.app = app;\n  }\n\n  /**\n   * Sync toolbar radio buttons with application state\n   *\n   * Updates checked state for:\n   * - Display mode (percentage/volume/cost)\n   * - Progress mode (planned/actual)\n   * - Time scale (daily/weekly/monthly)\n   *\n   * Called during initialization and when state changes.\n   *\n   * @returns {void}\n   */\n  syncToolbarRadios() {\n    const state = this.app?.state || {};\n    const displayMode = state.inputMode || 'percentage';\n    this._setRadioGroupChecked('displayMode', displayMode);\n\n    const progressMode = state.progressMode || 'planned';\n    this._setRadioGroupChecked('progressMode', progressMode, { ariaSelected: true });\n\n    const timeScale = state.displayScale || state.timeScale || 'weekly';\n    this._setRadioGroupChecked('timeScale', timeScale);\n\n    if (typeof this.app?._updateCostToggleAvailability === 'function') {\n      this.app._updateCostToggleAvailability();\n    }\n  }\n\n  /**\n   * Attach change handler to radio button group\n   *\n   * @param {string} groupName - Radio group name attribute\n   * @param {Function} handler - Handler function called with selected value\n   * @returns {void}\n   *\n   * @example\n   * uxManager.attachRadioGroupHandler('displayMode', (value) => {\n   *   console.log('Display mode changed to:', value);\n   * });\n   */\n  attachRadioGroupHandler(groupName, handler) {\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\n    if (!radios || radios.length === 0) return;\n    radios.forEach((radio) => {\n      radio.addEventListener('change', (event) => {\n        if (!event.target.checked) return;\n        handler(event.target.value);\n      });\n    });\n  }\n\n  /**\n   * Set checked state for radio group (private)\n   *\n   * @private\n   * @param {string} groupName - Radio group name\n   * @param {string} value - Value to check\n   * @param {Object} options - Additional options\n   * @param {boolean} [options.ariaSelected] - Set aria-selected on labels\n   * @returns {void}\n   */\n  _setRadioGroupChecked(groupName, value, options = {}) {\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\n    radios.forEach((radio) => {\n      const isChecked = radio.value === value;\n      if (radio.checked !== isChecked) {\n        radio.checked = isChecked;\n      }\n      if (options.ariaSelected) {\n        const label = radio.nextElementSibling;\n        if (label && label.matches('.btn')) {\n          label.setAttribute('aria-selected', String(isChecked));\n        }\n      }\n    });\n  }\n\n  /**\n   * Setup week boundary (start/end day) controls\n   *\n   * Wires up event listeners for week start/end select dropdowns.\n   * When changed, automatically regenerates timeline with new boundaries.\n   *\n   * @returns {void}\n   */\n  setupWeekBoundaryControls() {\n    const { weekStartSelect, weekEndSelect } = this.app.state.domRefs || {};\n    if (!weekStartSelect || !weekEndSelect) return;\n\n    this.app._syncWeekBoundaryControls();\n\n    weekStartSelect.addEventListener('change', (event) => {\n      const nextStart = this.app._normalizePythonWeekday(event.target.value, this.app._getWeekStartDay());\n      const derivedEnd = (nextStart + 6) % 7;\n      this.app._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\n    });\n\n    weekEndSelect.addEventListener('change', (event) => {\n      const nextEnd = this.app._normalizePythonWeekday(event.target.value, this.app._getWeekEndDay());\n      const derivedStart = (nextEnd + 1) % 7;\n      this.app._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\n    });\n  }\n\n  /**\n   * Setup cost view toggle button for S-Curve chart\n   *\n   * Configures the \"Biaya\" button that switches S-Curve between\n   * progress view and cost view (EVM metrics).\n   *\n   * @returns {void}\n   */\n  setupCostViewToggle() {\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\n\n    if (!toggleBtn) {\n      this.app._log?.('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\n      return;\n    }\n\n    if (!this.app.kurvaSChart) {\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\n      return;\n    }\n\n    if (this.app.kurvaSChart?.options?.enableCostView === false) {\n      toggleBtn.classList.add('d-none');\n      return;\n    }\n\n    this.app._costToggleBtn = toggleBtn;\n    this.app._costToggleBtnText = toggleBtnText;\n    this.app._costToggleSpinner = toggleBtnSpinner;\n    this.app._costToggleBtnIcon = toggleBtnIcon;\n\n    const enable = () => {\n      toggleBtn.disabled = false;\n      toggleBtn.classList.remove('disabled');\n      if (toggleBtnSpinner) toggleBtnSpinner.classList.add('d-none');\n      if (toggleBtnIcon) toggleBtnIcon.classList.remove('d-none');\n    };\n\n    const disable = () => {\n      toggleBtn.disabled = true;\n      toggleBtn.classList.add('disabled');\n      if (toggleBtnSpinner) toggleBtnSpinner.classList.remove('d-none');\n      if (toggleBtnIcon) toggleBtnIcon.classList.add('d-none');\n    };\n\n    const updateLabel = (label) => {\n      if (toggleBtnText) toggleBtnText.textContent = label;\n    };\n\n    const handleClick = async () => {\n      disable();\n      updateLabel('Memuat biaya...');\n      try {\n        if (typeof this.app._loadCostView === 'function') {\n          await this.app._loadCostView();\n        }\n      } catch (error) {\n        console.error('[JadwalKegiatanApp] Failed to toggle cost view', error);\n        if (typeof this.app.showToast === 'function') {\n          this.app.showToast('Gagal memuat view biaya', 'danger', 2600);\n        }\n      } finally {\n        enable();\n        updateLabel('Biaya');\n      }\n    };\n\n    toggleBtn.addEventListener('click', handleClick);\n  }\n\n  /**\n   * Show skeleton loader for a view type\n   *\n   * Displays animated skeleton loader while content is loading.\n   * Hides actual content to prevent layout shift.\n   *\n   * @param {string} type - View type ('grid', 'gantt', 'scurve')\n   * @returns {void}\n   *\n   * @example\n   * uxManager.showSkeleton('grid');\n   */\n  showSkeleton(type) {\n    const skeleton = document.getElementById(`skeleton-${type}`);\n    const view = document.getElementById(`${type}-view`);\n    if (skeleton) {\n      skeleton.classList.add('showing');\n      skeleton.classList.remove('fade-out');\n    }\n    if (view) {\n      view.classList.add('content-hidden');\n    }\n  }\n\n  /**\n   * Hide skeleton loader and show actual content\n   *\n   * Fades out skeleton with 300ms transition, then reveals content.\n   *\n   * @param {string} type - View type ('grid', 'gantt', 'scurve')\n   * @returns {void}\n   *\n   * @example\n   * uxManager.hideSkeleton('grid');\n   */\n  hideSkeleton(type) {\n    const skeleton = document.getElementById(`skeleton-${type}`);\n    const view = document.getElementById(`${type}-view`);\n    if (skeleton) {\n      skeleton.classList.add('fade-out');\n      setTimeout(() => {\n        skeleton.classList.remove('showing');\n        skeleton.classList.remove('fade-out');\n      }, 300);\n    }\n    if (view) {\n      view.classList.remove('content-hidden');\n    }\n  }\n}\n","import { Toast } from '@modules/shared/ux-enhancements.js';\n\n/**\n * ChartCoordinator - Handles chart initialization, updates, and lazy loading\n *\n * This class is responsible for:\n * - Lazy loading chart modules (Kurva-S, Gantt) when tabs are clicked\n * - Throttled chart updates to prevent performance issues\n * - Coordinating updates between multiple chart views\n * - Managing chart lifecycle (init, update, destroy)\n *\n * @class ChartCoordinator\n * @example\n * const coordinator = new ChartCoordinator(app);\n * coordinator.initializeCharts();\n * coordinator.updateChartsThrottled();\n */\nexport class ChartCoordinator {\n  /**\n   * Create a new ChartCoordinator instance\n   * @param {Object} app - JadwalKegiatanApp instance\n   */\n  constructor(app) {\n    this.app = app;\n  }\n\n  /**\n   * Initialize charts and setup lazy loading\n   *\n   * Sets up event listeners for tab switches to lazy load chart modules.\n   * Charts are not loaded until their respective tabs are clicked.\n   *\n   * @returns {void}\n   */\n  initializeCharts() {\n    this._setupLazyChartLoading();\n    this.app._bindUnifiedTabSync();\n  }\n\n  /**\n   * Setup lazy loading for chart modules (private)\n   *\n   * Attaches event listeners to S-Curve and Gantt tabs to load chart\n   * modules only when needed. Uses { once: true } to prevent duplicate listeners.\n   *\n   * @private\n   * @returns {void}\n   */\n  _setupLazyChartLoading() {\n    const app = this.app;\n    // Find chart tab buttons - match actual IDs from template\n    const scurveTab = document.querySelector('#scurve-tab') ||\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\n\n    const ganttTab = document.querySelector('#gantt-tab') ||\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\n\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\n\n    if (scurveTab) {\n      scurveTab.addEventListener('shown.bs.tab', async () => {\n        console.log('[LazyLoad] Kurva S tab shown');\n        if (app.state.useUnifiedTable && app.unifiedManager) {\n          app.unifiedManager.switchMode('kurva');\n        }\n        if (!app._chartModulesLoaded) {\n          await app._loadChartModules();\n        }\n      }, { once: true });\n\n      scurveTab.addEventListener('click', async () => {\n        console.log('[LazyLoad] Kurva S tab clicked');\n        if (app.state.useUnifiedTable && app.unifiedManager) {\n          app.unifiedManager.switchMode('kurva');\n        }\n        if (!app._chartModulesLoaded && !app._chartModulesLoading) {\n          await app._loadChartModules();\n        }\n      }, { once: true });\n    }\n\n    if (ganttTab) {\n      // When Gantt tab is shown, initialize NEW Gantt Chart\n      ganttTab.addEventListener('shown.bs.tab', async () => {\n        console.log('[LazyLoad] dYZ_ Gantt tab shown - initializing NEW Gantt Chart!');\n\n        if (!app._chartModulesLoaded) {\n          await app._loadChartModules();\n        }\n\n        // Initialize NEW Redesigned Gantt Chart\n        await this._initializeRedesignedGantt();\n      }, { once: true });\n\n      ganttTab.addEventListener('click', async () => {\n        console.log('[LazyLoad] dYZ_ Gantt tab clicked');\n        if (!app._chartModulesLoaded && !app._chartModulesLoading) {\n          await app._loadChartModules();\n        }\n      }, { once: true });\n    }\n\n    console.log('dY\\\"S Chart lazy loading configured (with NEW Gantt initialization)');\n  }\n\n  /**\n   * Update all charts with throttling (max 1 update per 200ms)\n   *\n   * Uses requestAnimationFrame + setTimeout to throttle chart updates.\n   * Prevents multiple rapid updates when user edits cells quickly.\n   *\n   * @returns {void}\n   *\n   * @example\n   * // Called on cell edit\n   * coordinator.updateChartsThrottled();\n   */\n  updateChartsThrottled() {\n    const app = this.app;\n    if (app._chartUpdatePending) {\n      return;\n    }\n    app._chartUpdatePending = true;\n    requestAnimationFrame(() => {\n      setTimeout(() => {\n        this.updateCharts();\n        app._chartUpdatePending = false;\n      }, app._chartUpdateDelay);\n    });\n  }\n\n  /**\n   * Update all charts immediately (no throttling)\n   *\n   * Calls update() on all active chart instances:\n   * - Kurva-S Chart (if initialized)\n   * - Gantt V2 Chart (if initialized)\n   *\n   * @returns {void}\n   *\n   * @example\n   * // Called on mode switch or data reload\n   * coordinator.updateCharts();\n   */\n  updateCharts() {\n    const app = this.app;\n    console.log('[JadwalKegiatanApp] Updating charts...');\n\n    // Update Kurva-S Chart\n    if (app.kurvaSChart) {\n      try {\n        app.kurvaSChart.update();\n        console.log('[JadwalKegiatanApp] o. Kurva-S chart updated');\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\n      }\n    }\n\n    // Update Gantt V2 with latest data\n    if (app.ganttFrozenGrid && typeof app.ganttFrozenGrid.update === 'function') {\n      try {\n        app.ganttFrozenGrid.update();\n        console.log('[JadwalKegiatanApp] o. Gantt V2 chart updated');\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\n      }\n    }\n  }\n\n  /**\n   * Initialize charts after data is loaded (legacy method)\n   *\n   * Called after initial data load completes. Handles:\n   * - Legacy Kurva-S chart initialization (if not using unified table)\n   * - Cost view toggle setup\n   * - Auto-activation of default cost view\n   *\n   * Note: New Redesigned Gantt Chart is initialized lazily on tab click.\n   *\n   * @returns {void}\n   */\n  initializeChartsAfterLoad() {\n    const app = this.app;\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\n\n    // Skip legacy Kurva-S chart if using unified table overlay\n    if (app.state.useUnifiedTable) {\n      console.log('[JadwalKegiatanApp] Skipping legacy Kurva-S chart (using unified overlay)');\n      return;\n    }\n\n    // Initialize Kurva-S Chart (LEGACY - only when NOT using unified table)\n    if (app.state.domRefs?.scurveChart && app.KurvaSChartClass) {\n      try {\n        app.kurvaSChart = new app.KurvaSChartClass(app.state, {\n          useIdealCurve: true,\n          steepnessFactor: 0.8,\n          smoothCurves: true,\n          showArea: true,\n          enableCostView: true,\n        });\n        const success = app.kurvaSChart.initialize(app.state.domRefs.scurveChart);\n        if (success) {\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\n          app._setupCostViewToggle();\n          const activatePromise = app._activateDefaultCostView();\n          if (activatePromise && typeof activatePromise.catch === 'function') {\n            activatePromise.catch((error) => {\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\n            });\n          }\n        }\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\n      }\n    }\n\n    console.log('[JadwalKegiatanApp] s,? OLD Gantt Chart initialization SKIPPED (replaced by new design)');\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\n  }\n\n  async _initializeRedesignedGantt(retryCount = 0) {\n    const app = this.app;\n    const MAX_RETRIES = 3;\n    const RETRY_DELAY = 200; // ms\n\n    console.log('[JadwalKegiatanApp] Rendering Gantt via unified table overlay');\n\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\n    if (retryCount === 0) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    const ganttContainer = document.getElementById('gantt-redesign-container');\n\n    if (!ganttContainer) {\n      console.warn(`[JadwalKegiatanApp] ?3 Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\n\n      // Retry if not max retries\n      if (retryCount < MAX_RETRIES) {\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\n        return this._initializeRedesignedGantt(retryCount + 1);\n      }\n\n      console.error('[JadwalKegiatanApp] ?O Gantt container not found after retries');\n      console.error('[JadwalKegiatanApp] DOM state:', {\n        ganttView: document.getElementById('gantt-view'),\n        ganttTab: document.getElementById('gantt-tab')\n      });\n      Toast.error('Failed to find Gantt container');\n      return;\n    }\n\n    try {\n      await this._initializeUnifiedGanttOverlay(ganttContainer);\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] ?O Failed to initialize Gantt:', error);\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\n      Toast.error('Failed to load Gantt Chart');\n      throw error;\n    }\n  }\n\n  async _initializeUnifiedGanttOverlay(ganttContainer) {\n    const app = this.app;\n    if (!app.unifiedManager) {\n      app._initTanStackGridIfNeeded();\n    }\n    if (!app.unifiedManager) {\n      console.warn('[JadwalKegiatanApp] Unified manager not available for Gantt overlay');\n      return;\n    }\n\n    const host = this._ensureGanttHost(ganttContainer);\n    if (!host) {\n      console.warn('[JadwalKegiatanApp] Unable to prepare Gantt host for unified overlay');\n      return;\n    }\n\n    const gridPayload = {\n      tree: app.state.pekerjaanTree || [],\n      timeColumns: app._getDisplayTimeColumns(),\n      inputMode: app.state.inputMode || 'percentage',\n      timeScale: app.state.displayScale || app.state.timeScale || 'weekly',\n      dependencies: app.state.dependencies || [],\n    };\n    if (app.state.debugUnifiedTable) {\n      console.log('[UnifiedGanttOverlay] Apply payload', {\n        rows: gridPayload.tree.length,\n        columns: gridPayload.timeColumns.length,\n        deps: gridPayload.dependencies.length,\n      });\n    }\n    app.unifiedManager.updateData(gridPayload);\n    app.unifiedManager.switchMode('gantt');\n    this._applyGanttOverlayStyles(host);\n  }\n\n  _applyGanttOverlayStyles(host) {\n    if (!host) return;\n    host.classList.add('gantt-overlay-mode');\n    const styleId = 'gantt-overlay-style';\n    if (!document.getElementById(styleId)) {\n      const style = document.createElement('style');\n      style.id = styleId;\n      style.textContent = `\n        /* Biarkan header/frozen columns tetap tampil untuk konteks */\n        .gantt-overlay-mode .tanstack-grid-header { display: block !important; }\n        /* Sembunyikan konten text pada sel time-column saja, jangan menggangu pinned kolom */\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { color: transparent; }\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell * { visibility: hidden; }\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { pointer-events: none; }\n        /* Izinkan scroll tetap berjalan */\n        .gantt-overlay-mode .tanstack-grid-body { overflow: auto; }\n      `;\n      document.head.appendChild(style);\n    }\n  }\n\n  _ensureGanttHost(ganttContainer) {\n    const app = this.app;\n    if (!ganttContainer) {\n      return null;\n    }\n    let host = ganttContainer.querySelector('.unified-gantt-host');\n    if (!host) {\n      host = document.createElement('div');\n      host.className = 'unified-gantt-host';\n      host.style.position = 'relative';\n      host.style.minHeight = '420px';\n      host.style.width = '100%';\n      ganttContainer.innerHTML = '';\n      ganttContainer.appendChild(host);\n    } else {\n      host.innerHTML = '';\n    }\n\n    this._moveGridContainerTo(host);\n    return host;\n  }\n\n  _moveGridContainerTo(target) {\n    const app = this.app;\n    const container = app.state?.domRefs?.tanstackGridContainer;\n    if (!container || !target || container.parentNode === target) {\n      return;\n    }\n    target.appendChild(container);\n  }\n\n  _restoreGridContainerPosition() {\n    const app = this.app;\n    const container = app.state?.domRefs?.tanstackGridContainer;\n    const parent = app._gridContainerParent;\n    if (!container || !parent) {\n      return;\n    }\n    if (container.parentNode === parent) {\n      return;\n    }\n    if (app._gridContainerNextSibling && app._gridContainerNextSibling.parentNode === parent) {\n      parent.insertBefore(container, app._gridContainerNextSibling);\n    } else {\n      parent.appendChild(container);\n    }\n  }\n\n  _prepareGanttData() {\n    const app = this.app;\n    const data = [];\n\n    if (app.state?.flatPekerjaan && Array.isArray(app.state.flatPekerjaan)) {\n      const pekerjaanNodes = app.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\n\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${app.state.flatPekerjaan.length} total nodes)`);\n\n      if (pekerjaanNodes.length > 0) {\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\n      }\n\n      pekerjaanNodes.forEach(node => {\n        data.push({\n          id: node.id,\n          name: node.nama || node.name || 'Pekerjaan',\n          start: node.tanggal_mulai || node.start_date || this._fallbackDate(node),\n          end: node.tanggal_selesai || node.end_date || this._fallbackDate(node, 7),\n          progress_rencana: node.progress_plan || 0,\n          progress_realisasi: node.progress_actual || 0,\n          volume: node.volume || 0,\n          satuan: node.satuan || ''\n        });\n      });\n    } else {\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\n    }\n\n    const projectMeta = {\n      project_id: app.state.projectId,\n      project_name: app.state.projectName || 'Project',\n      start_date: app.state.projectStart,\n      end_date: app.state.projectEnd\n    };\n\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\n\n    return {\n      data,\n      project: projectMeta,\n      milestones: []\n    };\n  }\n\n  _fallbackDate(node, offset = 0) {\n    const today = new Date();\n    if (!node?.created_at) {\n      const d = new Date(today);\n      d.setDate(d.getDate() + offset);\n      return d.toISOString().slice(0, 10);\n    }\n    const parsed = new Date(node.created_at);\n    if (Number.isNaN(parsed.getTime())) {\n      const d = new Date(today);\n      d.setDate(d.getDate() + offset);\n      return d.toISOString().slice(0, 10);\n    }\n    parsed.setDate(parsed.getDate() + offset);\n    return parsed.toISOString().slice(0, 10);\n  }\n}\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { TanStackGridManager } from '@modules/grid/tanstack-grid-manager.js';\r\nimport { UnifiedTableManager } from '@modules/unified/UnifiedTableManager.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport { AppInitializer } from '@modules/app/AppInitializer.js';\r\nimport { EventBinder } from '@modules/app/EventBinder.js';\r\nimport { DataOrchestrator } from '@modules/app/DataOrchestrator.js';\r\nimport { UXManager } from '@modules/app/UXManager.js';\r\nimport { ChartCoordinator } from '@modules/app/ChartCoordinator.js';\r\nimport {\r\n  ButtonStateManager,\r\n  Toast\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.initialized = false;\r\n    this.gridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.saveHandler = null;\r\n    this.unifiedManager = null;\r\n    this._gridContainerParent = null;\r\n    this._gridContainerNextSibling = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n    this._chartUpdatePending = false;\r\n    this._chartUpdateDelay = 200; // ms delay between chart refreshes\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n    this.eventBinder = null;\r\n    this.dataOrchestrator = null;\r\n    this.uxManager = new UXManager(this);\r\n    this.chartCoordinator = new ChartCoordinator(this);\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n    this._stateManagerListener = null;\r\n    this._suppressStateManagerEvent = false;\r\n    this._currencyFormatter = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state via AppInitializer\r\n      this.appInitializer = new AppInitializer(this.stateManager);\r\n      const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n      this.state = this.appInitializer.buildState(config, existingState, {\r\n        createTimeColumnIndex: this._createTimeColumnIndex.bind(this),\r\n      });\r\n      this._ensureStateCollections();\r\n      if (!this.state.displayScale) {\r\n        this.state.displayScale = this.state.timeScale || 'weekly';\r\n      }\r\n      this._setupStateDelegation();\r\n      this._bindStateManagerEvents();\r\n\r\n      // Setup DOM references\r\n      const domRefs = this.appInitializer.buildDomRefs(this.state, config);\r\n      this.state.domRefs = domRefs;\r\n      this._updateSaveButtonState();\r\n      if (!domRefs.root) {\r\n        throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n      }\r\n      this._applyDataset(domRefs.root);\r\n      if (!domRefs.tanstackGridContainer) {\r\n        throw new Error('TanStack grid container #tanstack-grid-container tidak ditemukan');\r\n      }\r\n\r\n      // Bind events via dedicated binder\r\n      if (!this.dataOrchestrator) {\r\n        this.dataOrchestrator = new DataOrchestrator(this);\r\n      }\r\n      this.eventBinder = new EventBinder(this);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      set: (value) => {\r\n        const mode = this.state.progressMode;\r\n        this.stateManager.states[mode].modifiedCells =\r\n          value instanceof Map ? value : new Map(Object.entries(value || {}));\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      set: (value) => {\r\n        const mode = this.state.progressMode;\r\n        this.stateManager.states[mode].assignmentMap =\r\n          value instanceof Map ? value : new Map(Object.entries(value || {}));\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      set: (value) => {\r\n        const mode = this.state.progressMode;\r\n        this.stateManager.states[mode].costAssignmentMap =\r\n          value instanceof Map ? value : new Map(Object.entries(value || {}));\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      set: (value) => {\r\n        const mode = this.state.progressMode;\r\n        this.stateManager.states[mode].costModifiedCells =\r\n          value instanceof Map ? value : new Map(Object.entries(value || {}));\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  _bindStateManagerEvents() {\r\n    if (!this.stateManager || this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this._stateManagerListener = (event) => this._handleStateManagerEvent(event);\r\n    this.stateManager.addEventListener(this._stateManagerListener);\r\n    console.log('[JadwalKegiatanApp] StateManager listener attached');\r\n  }\r\n\r\n  _unbindStateManagerEvents() {\r\n    if (!this.stateManager || !this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this.stateManager.removeEventListener(this._stateManagerListener);\r\n    this._stateManagerListener = null;\r\n    console.log('[JadwalKegiatanApp] StateManager listener removed');\r\n  }\r\n\r\n  _showSkeleton(type) {\r\n    if (this.uxManager) {\r\n      this.uxManager.showSkeleton(type);\r\n    }\r\n  }\r\n\r\n  _hideSkeleton(type) {\r\n    if (this.uxManager) {\r\n      this.uxManager.hideSkeleton(type);\r\n    }\r\n  }\r\n\r\n  _handleStateManagerEvent(event = {}) {\r\n    if (!event || typeof event !== 'object') {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'mode-switch':\r\n        if (this._suppressStateManagerEvent) {\r\n          return;\r\n        }\r\n        this._applyProgressModeSwitch(event.newMode, { showToast: false });\r\n        break;\r\n      case 'commit':\r\n        this._handleStateCommitEvent(event);\r\n        break;\r\n      case 'reset':\r\n        this._handleStateResetEvent();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _handleStateCommitEvent(event = {}) {\r\n    if (this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n    this._updateStatusBar();\r\n    this._updateCharts();\r\n    const modeLabel = (event.mode || this.state.progressMode || 'planned') === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    console.log(`[StateManager] Commit event processed for mode: ${modeLabel}`);\r\n  }\r\n\r\n  _handleStateResetEvent() {\r\n    console.log('[StateManager] Reset event received, syncing UI components');\r\n    this.state.progressMode = this.stateManager?.currentMode || 'planned';\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._updateStatusBar('Ready');\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    if (typeof dataset.enableUplotKurva !== 'undefined') {\r\n      this.state.useUPlotKurva = dataset.enableUplotKurva !== 'false';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    if (this.eventBinder) {\r\n      this.eventBinder.attachAll();\r\n      return;\r\n    }\r\n    this._initTanStackGridIfNeeded();\r\n  }\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    if (this.uxManager?.attachRadioGroupHandler) {\r\n      this.uxManager.attachRadioGroupHandler(groupName, handler);\r\n    }\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    if (this.uxManager?.setupWeekBoundaryControls) {\r\n      this.uxManager.setupWeekBoundaryControls();\r\n    }\r\n  }\r\n\r\n  _setupCostViewToggle() {\r\n    if (this.uxManager?.setupCostViewToggle) {\r\n      this.uxManager.setupCostViewToggle();\r\n    }\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    if (this.kurvaSChart?.options?.enableCostView === false) {\r\n      toggleBtn.classList.add('d-none');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const chartOptions = this.kurvaSChart.options || {};\r\n    if (!chartOptions.enableCostView) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const success = await this.kurvaSChart.toggleView('cost');\r\n      if (success) {\r\n        this._costViewAutoActivated = true;\r\n        this._setCostToggleButtonState();\r\n        console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n      }\r\n    } catch (error) {\r\n      console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n    }\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    if (this.stateManager?.states?.planned?.assignmentMap instanceof Map) {\r\n      this.stateManager.states.planned.assignmentMap.clear();\r\n    }\r\n    if (this.stateManager?.states?.actual?.assignmentMap instanceof Map) {\r\n      this.stateManager.states.actual.assignmentMap.clear();\r\n    }\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    if (this.dataOrchestrator && typeof this.dataOrchestrator.regenerateTimeline === 'function') {\r\n      return this.dataOrchestrator.regenerateTimeline(options);\r\n    }\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    if (this.uxManager?.syncToolbarRadios) {\r\n      this.uxManager.syncToolbarRadios();\r\n    }\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this._suppressStateManagerEvent = true;\r\n    this.stateManager.switchMode(normalized);\r\n    this._suppressStateManagerEvent = false;\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    this._applyProgressModeSwitch(normalized, { showToast: true });\r\n  }\r\n\r\n  _applyProgressModeSwitch(nextMode, options = {}) {\r\n    const normalized = nextMode === 'actual' ? 'actual' : 'planned';\r\n    const previousInputMode = this.state.inputMode || 'percentage';\r\n    this.state.progressMode = normalized;\r\n\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n    }\r\n\r\n    if (this.gridManager && typeof this.gridManager.setInputMode === 'function') {\r\n      const currentMode = this.state.inputMode || 'percentage';\r\n      if (currentMode !== previousInputMode) {\r\n        this.gridManager.setInputMode(currentMode);\r\n      }\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._updateCostToggleAvailability();\r\n    this._updateProgressModeIndicator(normalized);\r\n    this._syncGridViews();\r\n    this._updateCharts();\r\n\r\n    if (options.showToast) {\r\n      const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n      this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n    }\r\n  }\r\n\r\n  _updateProgressModeIndicator(mode) {\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (!indicator) {\r\n      return;\r\n    }\r\n    const normalized = mode === 'actual' ? 'actual' : 'planned';\r\n    const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n    const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n    indicator.textContent = `Mode: ${label}`;\r\n    indicator.className = `badge ${bgClass} ms-2`;\r\n    indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize TanStack Table grid when enabled\r\n   */\r\n  _initTanStackGridIfNeeded() {\r\n    const container = this.state.domRefs.tanstackGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] TanStack grid container not available');\r\n      return;\r\n    }\r\n\r\n    if (!this._gridContainerParent) {\r\n      this._gridContainerParent = container.parentNode || null;\r\n      this._gridContainerNextSibling = container.nextSibling || null;\r\n    }\r\n\r\n    container.classList.remove('d-none');\r\n\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this.unifiedManager = new UnifiedTableManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n          debugUnifiedTable: this.state.debugUnifiedTable,\r\n        });\r\n        this.unifiedManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    } else {\r\n      if (!this.gridManager) {\r\n        this.gridManager = new TanStackGridManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n        });\r\n        this.gridManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    if (this.dataOrchestrator && typeof this.dataOrchestrator.loadInitialData === 'function') {\r\n      return this.dataOrchestrator.loadInitialData(options);\r\n    }\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    this._showSkeleton('grid');\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type),\r\n      dataLoader: this.dataLoader\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false, force: forceReload });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Step 3.6: Ensure dependencies array exists (for unified Gantt overlay)\r\n      this.state.dependencies = this.state.dependencies || [];\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n      this._hideSkeleton('grid');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.useUPlotKurva) {\r\n      console.warn('[JadwalKegiatanApp] uPlot dimatikan, melewati inisialisasi chart');\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const kurvaSModule = await import('@modules/kurva-s/uplot-chart.js');\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSUPlotChart || kurvaSModule.default;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator.initializeChartsAfterLoad();\r\n    }\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Skip legacy Kurva-S chart if using unified table overlay\r\n    if (this.state.useUnifiedTable) {\r\n      console.log('[JadwalKegiatanApp] Skipping legacy Kurva-S chart (using unified overlay)');\r\n      return;\r\n    }\r\n\r\n    // Initialize Kurva-S Chart (LEGACY - only when NOT using unified table)\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n          enableCostView: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          this._setupCostViewToggle();\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n  * Called ONLY when Gantt tab is clicked for the first time\r\n  * @private\r\n  */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._initializeRedesignedGantt(retryCount);\r\n    }\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    console.log('[JadwalKegiatanApp] Rendering Gantt via unified table overlay');\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this._initializeUnifiedGanttOverlay(ganttContainer);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async _initializeUnifiedGanttOverlay(ganttContainer) {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._initializeUnifiedGanttOverlay(ganttContainer);\r\n    }\r\n    if (!this.unifiedManager) {\r\n      this._initTanStackGridIfNeeded();\r\n    }\r\n    if (!this.unifiedManager) {\r\n      console.warn('[JadwalKegiatanApp] Unified manager not available for Gantt overlay');\r\n      return;\r\n    }\r\n\r\n    const host = this._ensureGanttHost(ganttContainer);\r\n    if (!host) {\r\n      console.warn('[JadwalKegiatanApp] Unable to prepare Gantt host for unified overlay');\r\n      return;\r\n    }\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: this._getDisplayTimeColumns(),\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n    if (this.state.debugUnifiedTable) {\r\n      console.log('[UnifiedGanttOverlay] Apply payload', {\r\n        rows: gridPayload.tree.length,\r\n        columns: gridPayload.timeColumns.length,\r\n        deps: gridPayload.dependencies.length,\r\n      });\r\n    }\r\n    this.unifiedManager.updateData(gridPayload);\r\n    this.unifiedManager.switchMode('gantt');\r\n    this._applyGanttOverlayStyles(host);\r\n  }\r\n\r\n  _applyGanttOverlayStyles(host) {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._applyGanttOverlayStyles(host);\r\n    }\r\n    if (!host) return;\r\n    host.classList.add('gantt-overlay-mode');\r\n    const styleId = 'gantt-overlay-style';\r\n    if (!document.getElementById(styleId)) {\r\n      const style = document.createElement('style');\r\n      style.id = styleId;\r\n      style.textContent = `\r\n        /* Biarkan header/frozen columns tetap tampil untuk konteks */\r\n        .gantt-overlay-mode .tanstack-grid-header { display: block !important; }\r\n        /* Sembunyikan konten text pada sel time-column saja, jangan menggangu pinned kolom */\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { color: transparent; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell * { visibility: hidden; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { pointer-events: none; }\r\n        /* Izinkan scroll tetap berjalan */\r\n        .gantt-overlay-mode .tanstack-grid-body { overflow: auto; }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n  }\r\n\r\n  _ensureGanttHost(ganttContainer) {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._ensureGanttHost(ganttContainer);\r\n    }\r\n    if (!ganttContainer) {\r\n      return null;\r\n    }\r\n    let host = ganttContainer.querySelector('.unified-gantt-host');\r\n    if (!host) {\r\n      host = document.createElement('div');\r\n      host.className = 'unified-gantt-host';\r\n      host.style.position = 'relative';\r\n      host.style.minHeight = '420px';\r\n      host.style.width = '100%';\r\n      ganttContainer.innerHTML = '';\r\n      ganttContainer.appendChild(host);\r\n    } else {\r\n      host.innerHTML = '';\r\n    }\r\n\r\n    this._moveGridContainerTo(host);\r\n    return host;\r\n  }\r\n\r\n  _moveGridContainerTo(target) {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._moveGridContainerTo(target);\r\n    }\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    if (!container || !target || container.parentNode === target) {\r\n      return;\r\n    }\r\n    target.appendChild(container);\r\n  }\r\n\r\n  _restoreGridContainerPosition() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._restoreGridContainerPosition();\r\n    }\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    const parent = this._gridContainerParent;\r\n    if (!container || !parent) {\r\n      return;\r\n    }\r\n    if (container.parentNode === parent) {\r\n      return;\r\n    }\r\n    if (this._gridContainerNextSibling && this._gridContainerNextSibling.parentNode === parent) {\r\n      parent.insertBefore(container, this._gridContainerNextSibling);\r\n    } else {\r\n      parent.appendChild(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._prepareGanttData();\r\n    }\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator.initializeCharts();\r\n    }\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n    this._bindUnifiedTabSync();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator._setupLazyChartLoading();\r\n    }\r\n    return;\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Throttle chart updates to avoid spamming during rapid cell edits\r\n   * @private\r\n   */\r\n  _updateChartsThrottled() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator.updateChartsThrottled();\r\n    }\r\n    return;\r\n    if (this._chartUpdatePending) {\r\n      return;\r\n    }\r\n    this._chartUpdatePending = true;\r\n    requestAnimationFrame(() => {\r\n      setTimeout(() => {\r\n        this._updateCharts();\r\n        this._chartUpdatePending = false;\r\n      }, this._chartUpdateDelay);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    if (this.chartCoordinator) {\r\n      return this.chartCoordinator.updateCharts();\r\n    }\r\n    return;\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update Gantt V2 with latest data\r\n    if (this.ganttFrozenGrid && typeof this.ganttFrozenGrid.update === 'function') {\r\n      try {\r\n        this.ganttFrozenGrid.update();\r\n        console.log('[JadwalKegiatanApp]  Gantt V2 chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n    this.state.dependencies = this.state.dependencies || [];\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: displayColumns,\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n\r\n    if (this.state.useUnifiedTable && this.unifiedManager) {\r\n      if (this.state.debugUnifiedTable) {\r\n        console.log('[UnifiedTab] Sync grid payload', {\r\n          rows: gridPayload.tree.length,\r\n          columns: gridPayload.timeColumns.length,\r\n          deps: gridPayload.dependencies.length,\r\n          mode: this.state.progressMode,\r\n          displayScale: this.state.displayScale || this.state.timeScale,\r\n        });\r\n      }\r\n      this.unifiedManager.updateData(gridPayload);\r\n    } else if (this.gridManager) {\r\n      this.gridManager.updateData(gridPayload);\r\n      if (typeof this.gridManager.updateTopScrollMetrics === 'function') {\r\n        this.gridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _renderGrid() {\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this._initTanStackGridIfNeeded();\r\n      }\r\n      if (this.unifiedManager) {\r\n        this._syncGridViews();\r\n        return;\r\n      }\r\n    }\r\n    if (this.gridManager) {\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n    if (typeof this._renderLegacyGrid === 'function') {\r\n      this._renderLegacyGrid();\r\n    }\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.gridManager) {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getRowCostCapacity(pekerjaanId) {\r\n    const hargaMap = this.state?.hargaMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (hargaMap instanceof Map && hargaMap.has(numericId)) {\r\n      return Number(hargaMap.get(numericId)) || 0;\r\n    }\r\n    if (hargaMap && typeof hargaMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(hargaMap, key)) {\r\n        return Number(hargaMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode) {\r\n      const costFields = [\r\n        'budgeted_cost',\r\n        'total_biaya',\r\n        'totalBiaya',\r\n        'total_cost',\r\n        'biaya',\r\n      ];\r\n      for (const field of costFields) {\r\n        if (typeof fallbackNode[field] !== 'undefined') {\r\n          const numeric = Number(fallbackNode[field]);\r\n          if (Number.isFinite(numeric)) {\r\n            return numeric;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getMergedCostCells(modeState) {\r\n    const merged = new Map();\r\n    if (modeState?.costAssignmentMap instanceof Map) {\r\n      modeState.costAssignmentMap.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    if (modeState?.costModifiedCells instanceof Map) {\r\n      modeState.costModifiedCells.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    return merged;\r\n  }\r\n\r\n  _calculateAllCostTotals() {\r\n    const totals = new Map();\r\n    const modeState = this._getCurrentModeState();\r\n    if (!modeState) {\r\n      return totals;\r\n    }\r\n    const merged = this._getMergedCostCells(modeState);\r\n    merged.forEach((value, cellKey) => {\r\n      const pekerjaanId = parseInt((cellKey || '').split('-')[0], 10);\r\n      if (!Number.isFinite(pekerjaanId)) {\r\n        return;\r\n      }\r\n      totals.set(pekerjaanId, (totals.get(pekerjaanId) || 0) + Number(value));\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  _formatCurrency(value) {\r\n    const numeric = Number(value) || 0;\r\n    if (!this._currencyFormatter && typeof Intl !== 'undefined') {\r\n      this._currencyFormatter = new Intl.NumberFormat('id-ID', {\r\n        style: 'currency',\r\n        currency: 'IDR',\r\n        maximumFractionDigits: 0,\r\n      });\r\n    }\r\n    if (this._currencyFormatter) {\r\n      return this._currencyFormatter.format(numeric);\r\n    }\r\n    return `Rp ${numeric.toLocaleString('id-ID')}`;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    const costViolations = [];\r\n    const normalizedMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    if (normalizedMode === 'actual') {\r\n      const costTotals = this._calculateAllCostTotals();\r\n      costTotals.forEach((totalCost, pekerjaanId) => {\r\n        if (!Number.isFinite(totalCost)) {\r\n          return;\r\n        }\r\n        const capacity = this._getRowCostCapacity(pekerjaanId);\r\n        const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 1) : 1;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (totalCost > capacity + tolerance) {\r\n            costViolations.push({\r\n              type: 'cost',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalCost,\r\n              capacity,\r\n            });\r\n          }\r\n        } else if (totalCost > tolerance) {\r\n          costViolations.push({\r\n            type: 'cost',\r\n            pekerjaan_id: pekerjaanId,\r\n            total: totalCost,\r\n            capacity: 0,\r\n            missingCapacity: true,\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0 && costViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations, costViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      if (item.type === 'cost') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: biaya aktual tidak dapat disimpan karena master biaya 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total biaya ${this._formatCurrency(item.total)} > batas ${this._formatCurrency(item.capacity)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n    return this._buildMonthlyColumns(sourceColumns);\r\n  }\r\n\r\n  _buildMonthlyColumns(sourceColumns) {\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n      const startDate = this._coerceDate(blockColumns[0]?.startDate || blockColumns[0]?.start_date);\r\n      const endDate = this._coerceDate(blockColumns[blockColumns.length - 1]?.endDate || blockColumns[blockColumns.length - 1]?.end_date);\r\n      const rangeText = this._formatShortRange(startDate, endDate);\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel: rangeText || rangeLabel,\r\n        rangeText,\r\n        startDate,\r\n        endDate,\r\n        tooltip: startLabel && endLabel ? `${startLabel} \\u2014 ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n        readOnly: true,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _coerceDate(value) {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Number.isNaN(value.getTime()) ? null : value;\r\n    }\r\n    const parsed = new Date(value);\r\n    return Number.isNaN(parsed.getTime()) ? null : parsed;\r\n  }\r\n\r\n  _formatShortRange(startDate, endDate) {\r\n    const format = (date) => {\r\n      if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\r\n        return '';\r\n      }\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      return `${day}/${month}`;\r\n    };\r\n    const start = format(startDate);\r\n    const end = format(endDate);\r\n    if (start && end) {\r\n      return `${start} - ${end}`;\r\n    }\r\n    return start || end || '';\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateChartsThrottled();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  _bindUnifiedTabSync() {\r\n    if (!this.state.useUnifiedTable) {\r\n      return;\r\n    }\r\n    const scurveTab =\r\n      document.querySelector('#scurve-tab') ||\r\n      document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n    const ganttTab =\r\n      document.querySelector('#gantt-tab') ||\r\n      document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n    const gridTab =\r\n      document.querySelector('#grid-tab') ||\r\n      document.querySelector('[data-bs-target=\"#grid-view\"]');\r\n\r\n    if (scurveTab) {\r\n      const handler = () => {\r\n        // Move grid container to Kurva-S view for overlay rendering\r\n        const kurvaSContainer = document.getElementById('scurve-chart') ||\r\n                               document.querySelector('#scurve-view .chart-container');\r\n        if (kurvaSContainer && this.state?.domRefs?.tanstackGridContainer) {\r\n          // Clear old content and move grid to Kurva-S container\r\n          kurvaSContainer.innerHTML = '';\r\n          kurvaSContainer.appendChild(this.state.domRefs.tanstackGridContainer);\r\n          kurvaSContainer.style.position = 'relative';\r\n          kurvaSContainer.style.minHeight = '420px';\r\n        }\r\n\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> kurva');\r\n          }\r\n        }\r\n      };\r\n      scurveTab.addEventListener('shown.bs.tab', handler);\r\n      scurveTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (ganttTab) {\r\n      const handler = () => {\r\n        const ganttContainer = document.getElementById('gantt-redesign-container');\r\n        if (ganttContainer) {\r\n          this._initializeUnifiedGanttOverlay(ganttContainer);\r\n        } else if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('gantt');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> gantt (no overlay host)');\r\n          }\r\n        }\r\n      };\r\n      ganttTab.addEventListener('shown.bs.tab', handler);\r\n      ganttTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (gridTab) {\r\n      const handler = () => {\r\n        this._restoreGridContainerPosition();\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('grid');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> grid');\r\n          }\r\n        }\r\n      };\r\n      gridTab.addEventListener('shown.bs.tab', handler);\r\n      gridTab.addEventListener('click', handler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    this._unbindStateManagerEvents();\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.destroy();\r\n      this.gridManager = null;\r\n    }\r\n    this.unifiedManager = null;\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n"],"file":"assets/js/jadwal-kegiatan-m1Rb7cwb.js"}