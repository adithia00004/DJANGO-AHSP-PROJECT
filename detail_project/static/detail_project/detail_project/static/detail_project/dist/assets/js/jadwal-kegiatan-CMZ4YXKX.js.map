{"version":3,"mappings":"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","names":["GanttCanvasOverlay","constructor","tableManager","this","debug","Boolean","_b","_a","options","debugUnifiedTable","_d","_c","state","window","DEBUG_UNIFIED_TABLE","canvas","document","createElement","className","style","cssText","ctx","getContext","visible","barData","dependencies","barRects","tooltip","scrollTarget","_e","bodyScroll","addEventListener","syncWithTable","passive","_bindPointerEvents","show","scrollArea","position","appendChild","_log","hide","parentNode","removeChild","_hideTooltip","width","scrollWidth","height","scrollHeight","cellRects","getCellBoundingRects","clearRect","cells","length","bars","deps","size","w","h","console","error","strokeStyle","forEach","rect","strokeRect","x","y","_drawBars","_drawDependencies","renderBars","Array","isArray","renderDependencies","dependencyData","rectIndex","Map","r","key","String","pekerjaanId","has","set","get","push","list","sort","a","b","barsByRow","bar","barsDrawn","barsSkipped","pkjId","rects","rectMap","map","columnId","maxWidth","paddingX","baseX","baseY","fullHeight","Math","max","paddingY","trackHeight","plannedValue","Number","isFinite","planned","min","actualValue","actual","value","plannedWidth","fillStyle","_getPlannedColor","fillRect","actualWidth","barColor","color","_resolveActualColor","variance","label","drawn","skipped","total","dep","fromRect","find","c","fromPekerjaanId","fromColumnId","toRect","toPekerjaanId","toColumnId","fromX","fromY","toX","toY","lineWidth","beginPath","moveTo","lineTo","stroke","angle","atan2","cos","PI","sin","closePath","fill","_resolveVarianceColor","cssVar","_getCssVar","name","root","documentElement","getComputedStyle","getPropertyValue","trim","e","getBoundingClientRect","clientX","left","clientY","top","hit","_hitTest","_showTooltip","_ensureTooltip","body","tip","innerHTML","display","event","payload","log","UnifiedTableManager","currentMode","tanstackGrid","overlays","gantt","kurva","mount","container","domTargets","TanStackGridManager","setCellRenderer","containerMounted","updateData","rows","tree","currentRows","cols","timeColumns","currentColumns","_refreshGanttOverlay","switchMode","newMode","oldMode","targetRenderer","grid","call","from","to","renderer","_buildBarData","columns","gridRows","gridColumns","flatRows","flatPekerjaan","row","id","pekerjaan_id","nama","raw","subRows","hasTimeMeta","some","meta","timeColumn","col","fieldId","columnMeta","stateManager","_f","stateManagerInstance","_g","mergedPlanned","getAllCellsForMode","_mergeModeState","_h","states","mergedActual","_i","activeMode","_j","progressMode","toLowerCase","plannedSize","actualSize","timeColumnsWithMeta","filter","sampleColumns","slice","sampleRows","rowsForBars","_flattenRows","rowIndex","columnIndex","_resolveColumnMeta","column_id","Set","_k","keys","_l","cellKey","pkjIdRaw","colIdRaw","split","rowInfo","colMeta","_resolveValue","warn","plannedKeys","actualKeys","columnIds","nodes","result","stack","node","shift","children","sub","__spreadProps","__spreadValues","mode","generationMode","type","rangeLabel","weekNumber","modeState","merged","assignmentMap","modifiedCells","fallback","val","JadwalKegiatanApp","initialized","gridManager","StateManager","getInstance","dataLoader","timeColumnGenerator","saveHandler","unifiedManager","_gridContainerParent","_gridContainerNextSibling","kurvaSChart","ganttChart","ganttFrozenGrid","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_stateManagerListener","_suppressStateManagerEvent","_currencyFormatter","_getProjectDateRange","start","end","projectStart","parsed","Date","isNaN","getTime","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","floor","ceil","_countWeeklyColumns","week_number","initialize","__async","arguments","config","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","volumeMap","isLoading","domRefs","apiEndpoints","projectId","projectName","useUPlotKurva","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","displayMode","useUnifiedTable","disableUnifiedTable","keepLegacyGantt","enableLegacyGantt","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","_bindStateManagerEvents","getCurrentState","defineProperty","configurable","costAssignmentMap","costModifiedCells","hasUnsavedChanges","_handleStateManagerEvent","_unbindStateManagerEvents","removeEventListener","_applyProgressModeSwitch","showToast","_handleStateCommitEvent","_handleStateResetEvent","refreshCells","_updateStatusBar","_updateCharts","modeLabel","_syncToolbarRadios","_syncGridViews","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","disabled","classList","toggle","setAttribute","removeAttribute","getElementById","refreshButton","resetButton","tanstackGridContainer","tanstackGridBody","tanstackGridTopScroll","tanstackGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","querySelector","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","dataset","allowedTimeScales","datasetScale","defaultTimeScale","toString","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","weekend","weekEnd","week_end_day","parsedWeekStartDay","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","reset","apiResetProgress","enableUplotKurva","_attachToolbarEvents","_initTanStackGridIfNeeded","saveChanges","refresh","_handleResetProgress","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","KeyboardShortcuts","register","Toast","info","description","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","warning","querySelectorAll","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","preventDefault","_showKeyboardShortcutsHelp","getShortcuts","initializeUXEnhancements","modalHtml","s","replace","join","existingModal","remove","insertAdjacentHTML","Modal","ExportManager","format","button","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","enableCostView","toggleView","_setCostToggleButtonState","viewMode","add","isCostMode","iconClass","textContent","_activateDefaultCostView","groupName","handler","radios","radio","target","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","confirm","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","text","catch","status","json","_resetEditedCellsState","clear","_clearFailedRows","message","forceReload","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_recalculateAllProgressTotals","_invalidateCachedDataset","clearTimeout","setTimeout","then","data","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","successMessage","next","pyDay","isChecked","nextElementSibling","matches","_updateCostToggleAvailability","setInputMode","oldStats","getStats","newStats","toUpperCase","modifiedCount","assignmentCount","nextMode","previousInputMode","_updateProgressModeIndicator","indicator","bgClass","isActual","nextScale","_renderGrid","nextSibling","bind","onCellChange","_handleGridCellChange","getCellValidationState","_getCellValidationState","topScroll","topScrollInner","DataLoader","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","loadAssignments","_loadKurvaSData","_initializeCharts","statusText","hargaMap","entries","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","_loadChartModules","kurvaSModule","import","n","u","__VITE_PRELOAD__","KurvaSChartClass","KurvaSUPlotChart","default","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","ganttContainer","_initializeUnifiedGanttOverlay","Promise","resolve","ganttView","ganttTab","_initializeFrozenGantt","GanttFrozenGrid","rowHeight","success","host","_ensureGanttHost","gridPayload","_getDisplayTimeColumns","_applyGanttOverlayStyles","styleId","head","minHeight","_moveGridContainerTo","_restoreGridContainerPosition","parent","insertBefore","_prepareGanttData","pekerjaanNodes","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","actualVal","round","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_rencana","progress_realisasi","satuan","projectMeta","project_id","project_name","start_date","end_date","project","milestones","_setupLazyChartLoading","_bindUnifiedTabSync","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","scrollTop","deltaY","_escapeHtml","char","_validateRowTotalsBeforeSave","ButtonStateManager","setLoading","setSuccess","setError","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","_buildTimeColumns","tahap","index","rawId","order","urutan","startDate","tanggal_mulai","endDate","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","_fetchJson","_0","url","errorText","displayColumns","activeTimeColumns","updateTopScrollMetrics","_renderLegacyGrid","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","_calculateRowTotalPercent","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","_getRowCostCapacity","costFields","field","_getMergedCostCells","_calculateAllCostTotals","totals","_formatCurrency","Intl","NumberFormat","currency","maximumFractionDigits","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","costViolations","totalCost","combined","concat","messages","pekerjaanCount","totalProgress","_calculateProjectProgress","aggregate","avg","pekerjaanTotals","numericValue","sum","_buildAssignmentsPayload","assignments","_parseCellKey","proportion","tahapan_id","_getSaveMode","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","_buildMonthlyColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","endLabel","_coerceDate","_m","_n","rangeText","_formatShortRange","childColumns","readOnly","date","getDate","padStart","getMonth","separatorIndex","indexOf","cookieValue","cookie","cookies","substring","decodeURIComponent","displayValue","isVolumeMode","validation","valueType","normalizedValue","resolvedPekerjaanId","gridTab","destroy","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/gantt/GanttCanvasOverlay.js","../../../../../../js/src/modules/unified/UnifiedTableManager.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["export class GanttCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.debug = Boolean(\n      this.tableManager?.options?.debugUnifiedTable ||\n      this.tableManager?.state?.debugUnifiedTable ||\n      window.DEBUG_UNIFIED_TABLE\n    );\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'gantt-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 10;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n    this.visible = false;\n    this.barData = [];\n    this.dependencies = [];\n    this.barRects = [];\n    this.tooltip = null;\n\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          this.syncWithTable();\n        }\n      }, { passive: true });\n    }\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n    scrollArea.appendChild(this.canvas);\n    this.visible = true;\n    this._log('show');\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n    this.visible = false;\n    this._log('hide');\n    this._hideTooltip();\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this.canvas.width = scrollArea.scrollWidth;\n    this.canvas.height = scrollArea.scrollHeight;\n\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\n      ? this.tableManager.getCellBoundingRects()\n      : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.barRects = [];\n    this._log('sync', {\n      cells: cellRects.length,\n      bars: this.barData.length,\n      deps: this.dependencies.length,\n      size: { w: this.canvas.width, h: this.canvas.height },\n    });\n\n    if (this.barData.length > 0 && cellRects.length === 0) {\n      console.error('[GanttOverlay] Have bar data but no cell rects. Overlay cannot draw bars.', {\n        bars: this.barData.length,\n      });\n    }\n\n    // Outline cells only when debugging alignment\n    if (this.debug) {\n      this.ctx.strokeStyle = '#e2e8f0';\n      cellRects.forEach((rect) => {\n        this.ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\n      });\n    }\n\n    this._drawBars(cellRects);\n    this._drawDependencies(cellRects);\n  }\n\n  renderBars(barData) {\n    this.barData = Array.isArray(barData) ? barData : [];\n    this._log('renderBars', { bars: this.barData.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  renderDependencies(dependencyData) {\n    this.dependencies = Array.isArray(dependencyData) ? dependencyData : [];\n    this._log('renderDependencies', { deps: this.dependencies.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _drawBars(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.barData.length === 0) {\n      return;\n    }\n    // Group cell rects by pekerjaan\n    const rectIndex = new Map();\n    cellRects.forEach((r) => {\n      const key = String(r.pekerjaanId);\n      if (!rectIndex.has(key)) rectIndex.set(key, []);\n      rectIndex.get(key).push(r);\n    });\n    rectIndex.forEach((list) => list.sort((a, b) => a.x - b.x));\n\n    const barsByRow = new Map();\n    this.barData.forEach((bar) => {\n      const key = String(bar.pekerjaanId);\n      if (!barsByRow.has(key)) barsByRow.set(key, []);\n      barsByRow.get(key).push(bar);\n    });\n\n    let barsDrawn = 0;\n    let barsSkipped = 0;\n\n    barsByRow.forEach((bars, pkjId) => {\n      const rects = rectIndex.get(pkjId) || [];\n      const rectMap = new Map(rects.map((r) => [String(r.columnId), r]));\n      // track heights for stacked view: planned bottom, actual top\n      bars.forEach((bar) => {\n        const rect = rectMap.get(String(bar.columnId));\n        if (!rect) {\n          barsSkipped += 1;\n          return;\n        }\n        const paddingX = 0; // no gap to keep continuity\n        const paddingY = 2;\n        const maxWidth = rect.width - paddingX * 2;\n        const baseX = rect.x + paddingX;\n        const baseY = rect.y + paddingY;\n        const fullHeight = Math.max(8, rect.height - paddingY * 2);\n        const trackHeight = fullHeight / 2; // split planned/actual vertically\n\n        const plannedValue = Number.isFinite(bar.planned) ? Math.max(0, Math.min(100, bar.planned)) : 0;\n        const actualValue = Number.isFinite(bar.actual) ? Math.max(0, Math.min(100, bar.actual)) : Math.max(0, Math.min(100, bar.value || 0));\n\n        // Planned track (bottom half) fills the cell if >0 to avoid segmented look\n        const plannedWidth = maxWidth > 0 && plannedValue > 0 ? maxWidth : 0;\n        this.ctx.fillStyle = this._getPlannedColor();\n        if (plannedWidth > 0) {\n          this.ctx.fillRect(baseX, baseY + trackHeight, plannedWidth, trackHeight - 1);\n        }\n\n        // Actual track (top half) fills the cell if >0 to avoid segmented look\n        const actualWidth = maxWidth > 0 && actualValue > 0 ? maxWidth : 0;\n        const barColor = bar.color || this._resolveActualColor(bar.variance);\n        this.ctx.fillStyle = barColor;\n        if (actualWidth > 0) {\n          this.ctx.fillRect(baseX, baseY, actualWidth, trackHeight - 1);\n        }\n\n        this.barRects.push({\n          x: baseX,\n          y: baseY,\n          width: Math.max(actualWidth, plannedWidth),\n          height: fullHeight,\n          pekerjaanId: bar.pekerjaanId,\n          columnId: bar.columnId,\n          value: actualValue,\n          planned: plannedValue,\n          variance: bar.variance,\n          label: bar.label,\n          color: barColor,\n        });\n        barsDrawn += 1;\n      });\n    });\n\n    this._log('bars:drawn', { drawn: barsDrawn, skipped: barsSkipped, total: this.barData.length });\n  }\n\n  _drawDependencies(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.dependencies.length === 0) {\n      return;\n    }\n\n    this.dependencies.forEach((dep) => {\n      const fromRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.fromPekerjaanId && c.columnId === dep.fromColumnId,\n      );\n      const toRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.toPekerjaanId && c.columnId === dep.toColumnId,\n      );\n      if (!fromRect || !toRect) return;\n\n      const fromX = fromRect.x + fromRect.width;\n      const fromY = fromRect.y + fromRect.height / 2;\n      const toX = toRect.x;\n      const toY = toRect.y + toRect.height / 2;\n\n      this.ctx.strokeStyle = dep.color || '#94a3b8';\n      this.ctx.lineWidth = 1.5;\n      this.ctx.beginPath();\n      this.ctx.moveTo(fromX, fromY);\n      this.ctx.lineTo(toX, toY);\n      this.ctx.stroke();\n\n      const arrowSize = 5;\n      const angle = Math.atan2(toY - fromY, toX - fromX);\n      this.ctx.beginPath();\n      this.ctx.moveTo(toX, toY);\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle - Math.PI / 6), toY - arrowSize * Math.sin(angle - Math.PI / 6));\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle + Math.PI / 6), toY - arrowSize * Math.sin(angle + Math.PI / 6));\n      this.ctx.closePath();\n      this.ctx.fillStyle = dep.color || '#94a3b8';\n      this.ctx.fill();\n    });\n  }\n\n  _resolveVarianceColor(variance) {\n    if (!Number.isFinite(variance)) return '#3b82f6';\n    if (variance < -0.1) return '#ef4444';\n    if (variance > 0.1) return '#22c55e';\n    return '#3b82f6';\n  }\n\n  _resolveActualColor(variance) {\n    const cssVar = this._getCssVar('--gantt-actual-fill');\n    if (cssVar) return cssVar;\n    return this._resolveVarianceColor(variance);\n  }\n\n  _getPlannedColor() {\n    return this._getCssVar('--gantt-bar-fill') || '#e2e8f0';\n  }\n\n  _getCssVar(name) {\n    try {\n      const root = document.documentElement;\n      const value = getComputedStyle(root).getPropertyValue(name);\n      return value && value.trim().length ? value.trim() : null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _bindPointerEvents() {\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible || !this.barRects.length) return;\n      const rect = this.canvas.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const hit = this._hitTest(x, y);\n      if (hit) {\n        this._showTooltip(e.clientX, e.clientY, hit);\n      } else {\n        this._hideTooltip();\n      }\n    });\n\n    this.canvas.addEventListener('mouseleave', () => {\n      this._hideTooltip();\n    });\n  }\n\n  _hitTest(x, y) {\n    return this.barRects.find(\n      (b) => x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height,\n    );\n  }\n\n  _ensureTooltip() {\n    if (this.tooltip) return this.tooltip;\n    this.tooltip = document.createElement('div');\n    this.tooltip.className = 'gantt-overlay-tooltip';\n    this.tooltip.style.cssText = `\n      position: fixed;\n      padding: 4px 8px;\n      background: rgba(17,24,39,0.85);\n      color: #f8fafc;\n      border-radius: 4px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: 20;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.25);\n    `;\n    document.body.appendChild(this.tooltip);\n    return this.tooltip;\n  }\n\n  _showTooltip(clientX, clientY, hit) {\n    const tip = this._ensureTooltip();\n    const name = hit.label || hit.pekerjaanId;\n    const planned = Number.isFinite(hit.planned) ? `${hit.planned}%` : '-';\n    const actual = Number.isFinite(hit.value) ? `${hit.value}%` : '-';\n    const variance = Number.isFinite(hit.variance) ? `${hit.variance}%` : '-';\n    tip.innerHTML = `Pekerjaan: ${name}<br/>Kolom: ${hit.columnId}<br/>Planned: ${planned}<br/>Actual: ${actual}<br/>Variance: ${variance}`;\n    tip.style.left = `${clientX + 10}px`;\n    tip.style.top = `${clientY + 10}px`;\n    tip.style.display = 'block';\n  }\n\n  _hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.style.display = 'none';\n    }\n  }\n\n  _log(event, payload) {\n    if (!this.debug) return;\n    console.log(`[GanttOverlay] ${event}`, payload || {});\n  }\n}\n","import { TanStackGridManager } from '../grid/tanstack-grid-manager.js';\nimport { GanttCanvasOverlay } from '../gantt/GanttCanvasOverlay.js';\n\nexport class UnifiedTableManager {\n  constructor(state, options = {}) {\n    this.state = state || {};\n    this.options = options;\n    this.currentMode = 'grid';\n    this.debug = Boolean(this.state?.debugUnifiedTable || this.options?.debugUnifiedTable);\n    this.tanstackGrid = null;\n    this.overlays = {\n      gantt: null,\n      kurva: null, // placeholder for future integration\n    };\n  }\n\n  mount(container, domTargets = {}) {\n    this.tanstackGrid = new TanStackGridManager(this.state, this.options);\n    this.tanstackGrid.mount(container, domTargets);\n    this.tanstackGrid.setCellRenderer('input');\n    this._log('mount', { containerMounted: Boolean(container), debug: this.debug });\n  }\n\n  updateData(payload) {\n    if (this.tanstackGrid) {\n      this._log('updateData', {\n        rows: payload?.tree?.length || this.tanstackGrid.currentRows?.length || 0,\n        cols: payload?.timeColumns?.length || this.tanstackGrid.currentColumns?.length || 0,\n        deps: payload?.dependencies?.length || 0,\n      });\n      this.tanstackGrid.updateData(payload);\n      this._refreshGanttOverlay(payload);\n    }\n  }\n\n  switchMode(newMode) {\n    if (!newMode || newMode === this.currentMode || !this.tanstackGrid) {\n      return;\n    }\n    const oldMode = this.currentMode;\n    const rendererMap = {\n      grid: 'input',\n      gantt: 'gantt',\n      kurva: 'readonly',\n    };\n    const targetRenderer = rendererMap[newMode] || 'input';\n\n    // hide existing overlays\n    if (this.currentMode === 'gantt' && this.overlays.gantt) {\n      this.overlays.gantt.hide();\n    }\n    if (this.currentMode === 'kurva' && this.overlays.kurva) {\n      this.overlays.kurva.hide?.();\n    }\n\n    this.currentMode = newMode;\n    this._log('switchMode', {\n      from: oldMode,\n      to: newMode,\n      renderer: targetRenderer,\n      rows: this.tanstackGrid.currentRows?.length || 0,\n      cols: this.tanstackGrid.currentColumns?.length || 0,\n    });\n    this.tanstackGrid.setCellRenderer(targetRenderer);\n\n    if (newMode === 'gantt') {\n      if (!this.overlays.gantt) {\n        this.overlays.gantt = new GanttCanvasOverlay(this.tanstackGrid);\n      }\n      this.overlays.gantt.show();\n      this._refreshGanttOverlay();\n    }\n\n    if (newMode === 'kurva') {\n      // Placeholder: kurva chart overlay can be initialized here later\n      if (this.overlays.kurva && typeof this.overlays.kurva.show === 'function') {\n        this.overlays.kurva.show();\n      }\n    }\n  }\n\n  _refreshGanttOverlay(payload = {}) {\n    if (!this.overlays.gantt || !this.tanstackGrid) {\n      return;\n    }\n    const barData = this._buildBarData(payload);\n    const dependencyData = payload.dependencies || [];\n    this._log('refreshGanttOverlay', {\n      bars: barData.length,\n      deps: dependencyData.length,\n    });\n    this.overlays.gantt.renderBars(barData);\n    this.overlays.gantt.renderDependencies(dependencyData);\n  }\n\n  _buildBarData(payload = {}) {\n    let tree = Array.isArray(payload.tree) ? payload.tree : [];\n    let columns = Array.isArray(payload.timeColumns) ? payload.timeColumns : [];\n    const gridRows = this.tanstackGrid?.currentRows || [];\n    const gridColumns = this.tanstackGrid?.currentColumns || [];\n    const flatRows = Array.isArray(this.state?.flatPekerjaan) ? this.state.flatPekerjaan : [];\n\n    if ((!tree.length || tree.length <= 1) && gridRows.length > tree.length) {\n      tree = gridRows;\n    }\n    if ((!tree.length || tree.length <= 1) && flatRows.length) {\n      tree = flatRows.map((row) => ({\n        pekerjaanId: row.id || row.pekerjaan_id,\n        name: row.nama || row.name,\n        raw: row,\n        subRows: [],\n      }));\n    }\n\n    const hasTimeMeta = columns.some((c) => c?.meta?.timeColumn);\n    if ((!columns.length || !hasTimeMeta) && gridColumns.length) {\n      columns = gridColumns;\n    }\n    if (!columns.length && Array.isArray(this.state?.timeColumns)) {\n      columns = this.state.timeColumns.map((col) => ({\n        id: col.id,\n        fieldId: col.fieldId,\n        meta: { timeColumn: true, columnMeta: col },\n      }));\n    }\n\n    const barData = [];\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n    const mergedPlanned = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('planned')\n      : this._mergeModeState(stateManager?.states?.planned);\n    const mergedActual = typeof stateManager?.getAllCellsForMode === 'function'\n      ? stateManager.getAllCellsForMode('actual')\n      : this._mergeModeState(stateManager?.states?.actual);\n    const activeMode = (this.state?.progressMode || stateManager?.currentMode || 'planned').toLowerCase();\n    this._log('buildBarData:start', {\n      rows: tree.length,\n      cols: columns.length,\n      plannedSize: mergedPlanned?.size || 0,\n      actualSize: mergedActual?.size || 0,\n      activeMode,\n      timeColumnsWithMeta: columns.filter((c) => c.meta?.timeColumn).length,\n      sampleColumns: columns.slice(0, 5).map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id),\n      sampleRows: tree.slice(0, 3).map((r) => r.pekerjaanId || r.id || r.raw?.pekerjaan_id),\n    });\n\n    const rowsForBars = this._flattenRows(tree);\n    const rowIndex = new Map();\n    rowsForBars.forEach((row) => {\n      const pekerjaanId = row.pekerjaanId || row.id || row.raw?.pekerjaan_id;\n      if (!pekerjaanId) return;\n      rowIndex.set(String(pekerjaanId), {\n        label: row.name || row.raw?.nama || pekerjaanId,\n      });\n    });\n\n    const columnIndex = new Map();\n    columns.forEach((col) => {\n      const meta = this._resolveColumnMeta(col);\n      if (!meta?.timeColumn) return;\n      const columnId = col.fieldId || col.id || meta.fieldId || meta.id || meta.columnId || meta.column_id;\n      if (!columnId) return;\n      columnIndex.set(String(columnId), meta);\n    });\n\n    const allKeys = new Set([\n      ...Array.from(mergedPlanned?.keys?.() || []),\n      ...Array.from(mergedActual?.keys?.() || []),\n    ]);\n\n    allKeys.forEach((cellKey) => {\n      const [pkjIdRaw, colIdRaw] = String(cellKey).split('-');\n      const pekerjaanId = String(pkjIdRaw || '').trim();\n      const columnId = String(colIdRaw || '').trim();\n      if (!pekerjaanId || !columnId) {\n        return;\n      }\n      const rowInfo = rowIndex.get(pekerjaanId);\n      const colMeta = columnIndex.get(columnId);\n      if (!rowInfo || !colMeta) {\n        return;\n      }\n      const plannedValue = this._resolveValue(mergedPlanned, cellKey, 0);\n      const actualValue = this._resolveValue(mergedActual, cellKey, plannedValue);\n      if (!Number.isFinite(plannedValue) && !Number.isFinite(actualValue)) {\n        return;\n      }\n      const variance = (Number(actualValue) || 0) - (Number(plannedValue) || 0);\n      barData.push({\n        pekerjaanId,\n        columnId,\n        value: Number(actualValue) || 0,\n        planned: Number(plannedValue) || 0,\n        actual: Number(actualValue) || 0,\n        variance,\n        label: rowInfo.label,\n        color: '#4dabf7',\n      });\n    });\n\n    if (barData.length === 0 && (mergedPlanned?.size > 0 || mergedActual?.size > 0)) {\n      console.warn('[UnifiedTable]  NO BAR DATA despite having cell values! Check:', {\n        'mergedPlanned.size': mergedPlanned?.size || 0,\n        'mergedActual.size': mergedActual?.size || 0,\n        'tree.length': tree.length,\n        'columns.length': columns.length,\n        'timeColumnsWithMeta': columns.filter((c) => c.meta?.timeColumn).length\n      });\n      this._log('buildBarData:debug', {\n        plannedKeys: mergedPlanned ? Array.from(mergedPlanned.keys()).slice(0, 5) : [],\n        actualKeys: mergedActual ? Array.from(mergedActual.keys()).slice(0, 5) : [],\n        columnIds: columns.map((c) => c.fieldId || c.id || c.meta?.columnMeta?.fieldId || c.meta?.columnMeta?.id || c.meta?.columnId || c.meta?.column_id || c.id).slice(0, 5),\n      });\n    }\n\n    this._log('buildBarData:done', { bars: barData.length });\n    return barData;\n  }\n\n  _flattenRows(nodes = []) {\n    const result = [];\n    const stack = Array.isArray(nodes) ? [...nodes] : [];\n    while (stack.length) {\n      const node = stack.shift();\n      if (!node) continue;\n      result.push(node);\n      if (Array.isArray(node.subRows) && node.subRows.length) {\n        stack.push(...node.subRows);\n      } else if (Array.isArray(node.children) && node.children.length) {\n        stack.push(...node.children);\n      } else if (Array.isArray(node.sub) && node.sub.length) {\n        stack.push(...node.sub);\n      }\n    }\n    return result;\n  }\n\n  _resolveColumnMeta(col) {\n    if (!col) return null;\n    if (col.meta?.columnMeta && col.meta?.timeColumn) {\n      return { ...col.meta.columnMeta, timeColumn: true };\n    }\n    if (col.meta?.timeColumn) {\n      return { ...(col.meta.columnMeta || col.meta), timeColumn: true };\n    }\n    const mode = (col.generationMode || col.type || '').toLowerCase();\n    const isTime = mode === 'weekly' || mode === 'monthly' || Boolean(col.rangeLabel || col.weekNumber);\n    if (isTime) {\n      return { ...col, timeColumn: true, columnMeta: col };\n    }\n    return null;\n  }\n\n  _mergeModeState(modeState) {\n    if (!modeState) {\n      return new Map();\n    }\n    const merged = new Map(modeState.assignmentMap || []);\n    (modeState.modifiedCells || new Map()).forEach((value, key) => {\n      merged.set(key, value);\n    });\n    return merged;\n  }\n\n  _resolveValue(map, key, fallback) {\n    if (map && map.has && map.has(key)) {\n      const val = map.get(key);\n      if (Number.isFinite(val)) {\n        return val;\n      }\n    }\n    return fallback;\n  }\n\n  _log(event, payload) {\n    const enabled = this.debug || Boolean(window.DEBUG_UNIFIED_TABLE);\n    if (!enabled) return;\n    console.log(`[UnifiedTable] ${event}`, payload);\n  }\n}\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { TanStackGridManager } from '@modules/grid/tanstack-grid-manager.js';\r\nimport { UnifiedTableManager } from '@modules/unified/UnifiedTableManager.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.initialized = false;\r\n    this.gridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.saveHandler = null;\r\n    this.unifiedManager = null;\r\n    this._gridContainerParent = null;\r\n    this._gridContainerNextSibling = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n    this._stateManagerListener = null;\r\n    this._suppressStateManagerEvent = false;\r\n    this._currencyFormatter = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useUPlotKurva: true, // uPlot Kurva-S aktif secara default\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n        useUnifiedTable: config.disableUnifiedTable ? false : true,\r\n        // Default: legacy Gantt V2 tetap aktif; bisa dimatikan dengan config.disableLegacyGantt\r\n        keepLegacyGantt: config.enableLegacyGantt ? true : false,\r\n        dependencies: [],\r\n        debugUnifiedTable: Boolean(config.debugUnifiedTable || window.DEBUG_UNIFIED_TABLE),\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n    this._bindStateManagerEvents();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  _bindStateManagerEvents() {\r\n    if (!this.stateManager || this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this._stateManagerListener = (event) => this._handleStateManagerEvent(event);\r\n    this.stateManager.addEventListener(this._stateManagerListener);\r\n    console.log('[JadwalKegiatanApp] StateManager listener attached');\r\n  }\r\n\r\n  _unbindStateManagerEvents() {\r\n    if (!this.stateManager || !this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this.stateManager.removeEventListener(this._stateManagerListener);\r\n    this._stateManagerListener = null;\r\n    console.log('[JadwalKegiatanApp] StateManager listener removed');\r\n  }\r\n\r\n  _handleStateManagerEvent(event = {}) {\r\n    if (!event || typeof event !== 'object') {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'mode-switch':\r\n        if (this._suppressStateManagerEvent) {\r\n          return;\r\n        }\r\n        this._applyProgressModeSwitch(event.newMode, { showToast: false });\r\n        break;\r\n      case 'commit':\r\n        this._handleStateCommitEvent(event);\r\n        break;\r\n      case 'reset':\r\n        this._handleStateResetEvent();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _handleStateCommitEvent(event = {}) {\r\n    if (this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n    this._updateStatusBar();\r\n    this._updateCharts();\r\n    const modeLabel = (event.mode || this.state.progressMode || 'planned') === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    console.log(`[StateManager] Commit event processed for mode: ${modeLabel}`);\r\n  }\r\n\r\n  _handleStateResetEvent() {\r\n    console.log('[StateManager] Reset event received, syncing UI components');\r\n    this.state.progressMode = this.stateManager?.currentMode || 'planned';\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._updateStatusBar('Ready');\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        tanstackGridContainer: document.getElementById('tanstack-grid-container'),\r\n        tanstackGridBody: document.getElementById('tanstack-grid-body'),\r\n        tanstackGridTopScroll: document.getElementById('tanstack-grid-scroll-top'),\r\n        tanstackGridTopScrollInner: document.getElementById('tanstack-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (!domRefs.tanstackGridContainer) {\r\n      throw new Error('TanStack grid container #tanstack-grid-container tidak ditemukan');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    if (typeof dataset.enableUplotKurva !== 'undefined') {\r\n      this.state.useUPlotKurva = dataset.enableUplotKurva !== 'false';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    this._initTanStackGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    if (this.kurvaSChart?.options?.enableCostView === false) {\r\n      toggleBtn.classList.add('d-none');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    document.querySelectorAll('input[name=\"progressMode\"]').forEach((radio) => {\r\n      const isChecked = radio.value === progressMode;\r\n      if (radio.checked !== isChecked) {\r\n        radio.checked = isChecked;\r\n      }\r\n      const label = radio.nextElementSibling;\r\n      if (label && label.matches('.btn')) {\r\n        label.setAttribute('aria-selected', String(isChecked));\r\n      }\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this._suppressStateManagerEvent = true;\r\n    this.stateManager.switchMode(normalized);\r\n    this._suppressStateManagerEvent = false;\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    this._applyProgressModeSwitch(normalized, { showToast: true });\r\n  }\r\n\r\n  _applyProgressModeSwitch(nextMode, options = {}) {\r\n    const normalized = nextMode === 'actual' ? 'actual' : 'planned';\r\n    const previousInputMode = this.state.inputMode || 'percentage';\r\n    this.state.progressMode = normalized;\r\n\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n    }\r\n\r\n    if (this.gridManager && typeof this.gridManager.setInputMode === 'function') {\r\n      const currentMode = this.state.inputMode || 'percentage';\r\n      if (currentMode !== previousInputMode) {\r\n        this.gridManager.setInputMode(currentMode);\r\n      }\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._updateCostToggleAvailability();\r\n    this._updateProgressModeIndicator(normalized);\r\n    this._syncGridViews();\r\n    this._updateCharts();\r\n\r\n    if (options.showToast) {\r\n      const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n      this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n    }\r\n  }\r\n\r\n  _updateProgressModeIndicator(mode) {\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (!indicator) {\r\n      return;\r\n    }\r\n    const normalized = mode === 'actual' ? 'actual' : 'planned';\r\n    const label = normalized === 'planned' ? 'Rencana' : 'Realisasi';\r\n    const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n    indicator.textContent = `Mode: ${label}`;\r\n    indicator.className = `badge ${bgClass} ms-2`;\r\n    indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize TanStack Table grid when enabled\r\n   */\r\n  _initTanStackGridIfNeeded() {\r\n    const container = this.state.domRefs.tanstackGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] TanStack grid container not available');\r\n      return;\r\n    }\r\n\r\n    if (!this._gridContainerParent) {\r\n      this._gridContainerParent = container.parentNode || null;\r\n      this._gridContainerNextSibling = container.nextSibling || null;\r\n    }\r\n\r\n    container.classList.remove('d-none');\r\n\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this.unifiedManager = new UnifiedTableManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n          debugUnifiedTable: this.state.debugUnifiedTable,\r\n        });\r\n        this.unifiedManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    } else {\r\n      if (!this.gridManager) {\r\n        this.gridManager = new TanStackGridManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n        });\r\n        this.gridManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Step 3.6: Ensure dependencies array exists (for unified Gantt overlay)\r\n      this.state.dependencies = this.state.dependencies || [];\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.useUPlotKurva) {\r\n      console.warn('[JadwalKegiatanApp] uPlot dimatikan, melewati inisialisasi chart');\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const kurvaSModule = await import('@modules/kurva-s/uplot-chart.js');\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSUPlotChart || kurvaSModule.default;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n          enableCostView: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    if (this.state.useUnifiedTable && this.state.keepLegacyGantt === false) {\r\n      console.log('[JadwalKegiatanApp] Unified mode active - rendering Gantt via unified table overlay');\r\n      const ganttContainer = document.getElementById('gantt-redesign-container');\r\n      if (!ganttContainer) {\r\n        console.warn('[JadwalKegiatanApp] Gantt container not found for unified overlay');\r\n        return;\r\n      }\r\n      await this._initializeUnifiedGanttOverlay(ganttContainer);\r\n      return;\r\n    }\r\n\r\n    // Check if already initialized\r\n    if (this.ganttFrozenGrid) {\r\n      console.log('[JadwalKegiatanApp] Gantt already initialized, skipping');\r\n      return;\r\n    }\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Initialize V2: Frozen Column Architecture (now default)\r\n      console.log(' Initializing Gantt V2 (Frozen Column)...');\r\n      await this._initializeFrozenGantt(ganttContainer);\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize V2: Frozen Column Gantt (Now Default)\r\n   * @private\r\n   */\r\n  async _initializeFrozenGantt(container) {\r\n    console.log('[JadwalKegiatanApp]  Container found:', container);\r\n\r\n    // Lazy load V2 module\r\n    const { GanttFrozenGrid } = await import('@modules/gantt-v2/gantt-frozen-grid.js');\r\n\r\n    // Create Gantt instance\r\n    this.ganttFrozenGrid = new GanttFrozenGrid(container, {\r\n      rowHeight: 40,\r\n      timeScale: 'week'\r\n    });\r\n\r\n    // Initialize with app context (provides StateManager, tahapanList, etc.)\r\n    await this.ganttFrozenGrid.initialize(this);\r\n\r\n    console.log('[JadwalKegiatanApp]  Gantt V2 (Frozen Column) initialized successfully!');\r\n    Toast.success(' Gantt Chart loaded', 2000);\r\n  }\r\n\r\n  async _initializeUnifiedGanttOverlay(ganttContainer) {\r\n    if (!this.unifiedManager) {\r\n      this._initTanStackGridIfNeeded();\r\n    }\r\n    if (!this.unifiedManager) {\r\n      console.warn('[JadwalKegiatanApp] Unified manager not available for Gantt overlay');\r\n      return;\r\n    }\r\n\r\n    const host = this._ensureGanttHost(ganttContainer);\r\n    if (!host) {\r\n      console.warn('[JadwalKegiatanApp] Unable to prepare Gantt host for unified overlay');\r\n      return;\r\n    }\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: this._getDisplayTimeColumns(),\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n    if (this.state.debugUnifiedTable) {\r\n      console.log('[UnifiedGanttOverlay] Apply payload', {\r\n        rows: gridPayload.tree.length,\r\n        columns: gridPayload.timeColumns.length,\r\n        deps: gridPayload.dependencies.length,\r\n      });\r\n    }\r\n    this.unifiedManager.updateData(gridPayload);\r\n    this.unifiedManager.switchMode('gantt');\r\n    this._applyGanttOverlayStyles(host);\r\n  }\r\n\r\n  _applyGanttOverlayStyles(host) {\r\n    if (!host) return;\r\n    host.classList.add('gantt-overlay-mode');\r\n    const styleId = 'gantt-overlay-style';\r\n    if (!document.getElementById(styleId)) {\r\n      const style = document.createElement('style');\r\n      style.id = styleId;\r\n      style.textContent = `\r\n        /* Biarkan header/frozen columns tetap tampil untuk konteks */\r\n        .gantt-overlay-mode .tanstack-grid-header { display: block !important; }\r\n        /* Sembunyikan konten text pada sel time-column saja, jangan menggangu pinned kolom */\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { color: transparent; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell * { visibility: hidden; }\r\n        .gantt-overlay-mode .tanstack-grid-cell.time-cell { pointer-events: none; }\r\n        /* Izinkan scroll tetap berjalan */\r\n        .gantt-overlay-mode .tanstack-grid-body { overflow: auto; }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n  }\r\n\r\n  _ensureGanttHost(ganttContainer) {\r\n    if (!ganttContainer) {\r\n      return null;\r\n    }\r\n    let host = ganttContainer.querySelector('.unified-gantt-host');\r\n    if (!host) {\r\n      host = document.createElement('div');\r\n      host.className = 'unified-gantt-host';\r\n      host.style.position = 'relative';\r\n      host.style.minHeight = '420px';\r\n      host.style.width = '100%';\r\n      ganttContainer.innerHTML = '';\r\n      ganttContainer.appendChild(host);\r\n    } else {\r\n      host.innerHTML = '';\r\n    }\r\n\r\n    this._moveGridContainerTo(host);\r\n    return host;\r\n  }\r\n\r\n  _moveGridContainerTo(target) {\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    if (!container || !target || container.parentNode === target) {\r\n      return;\r\n    }\r\n    target.appendChild(container);\r\n  }\r\n\r\n  _restoreGridContainerPosition() {\r\n    const container = this.state?.domRefs?.tanstackGridContainer;\r\n    const parent = this._gridContainerParent;\r\n    if (!container || !parent) {\r\n      return;\r\n    }\r\n    if (container.parentNode === parent) {\r\n      return;\r\n    }\r\n    if (this._gridContainerNextSibling && this._gridContainerNextSibling.parentNode === parent) {\r\n      parent.insertBefore(container, this._gridContainerNextSibling);\r\n    } else {\r\n      parent.appendChild(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n    this._bindUnifiedTabSync();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update Gantt V2 with latest data\r\n    if (this.ganttFrozenGrid && typeof this.ganttFrozenGrid.update === 'function') {\r\n      try {\r\n        this.ganttFrozenGrid.update();\r\n        console.log('[JadwalKegiatanApp]  Gantt V2 chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n    this.state.dependencies = this.state.dependencies || [];\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: displayColumns,\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n\r\n    if (this.state.useUnifiedTable && this.unifiedManager) {\r\n      if (this.state.debugUnifiedTable) {\r\n        console.log('[UnifiedTab] Sync grid payload', {\r\n          rows: gridPayload.tree.length,\r\n          columns: gridPayload.timeColumns.length,\r\n          deps: gridPayload.dependencies.length,\r\n          mode: this.state.progressMode,\r\n          displayScale: this.state.displayScale || this.state.timeScale,\r\n        });\r\n      }\r\n      this.unifiedManager.updateData(gridPayload);\r\n    } else if (this.gridManager) {\r\n      this.gridManager.updateData(gridPayload);\r\n      if (typeof this.gridManager.updateTopScrollMetrics === 'function') {\r\n        this.gridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _renderGrid() {\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this._initTanStackGridIfNeeded();\r\n      }\r\n      if (this.unifiedManager) {\r\n        this._syncGridViews();\r\n        return;\r\n      }\r\n    }\r\n    if (this.gridManager) {\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n    if (typeof this._renderLegacyGrid === 'function') {\r\n      this._renderLegacyGrid();\r\n    }\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.gridManager) {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getRowCostCapacity(pekerjaanId) {\r\n    const hargaMap = this.state?.hargaMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (hargaMap instanceof Map && hargaMap.has(numericId)) {\r\n      return Number(hargaMap.get(numericId)) || 0;\r\n    }\r\n    if (hargaMap && typeof hargaMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(hargaMap, key)) {\r\n        return Number(hargaMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode) {\r\n      const costFields = [\r\n        'budgeted_cost',\r\n        'total_biaya',\r\n        'totalBiaya',\r\n        'total_cost',\r\n        'biaya',\r\n      ];\r\n      for (const field of costFields) {\r\n        if (typeof fallbackNode[field] !== 'undefined') {\r\n          const numeric = Number(fallbackNode[field]);\r\n          if (Number.isFinite(numeric)) {\r\n            return numeric;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getMergedCostCells(modeState) {\r\n    const merged = new Map();\r\n    if (modeState?.costAssignmentMap instanceof Map) {\r\n      modeState.costAssignmentMap.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    if (modeState?.costModifiedCells instanceof Map) {\r\n      modeState.costModifiedCells.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    return merged;\r\n  }\r\n\r\n  _calculateAllCostTotals() {\r\n    const totals = new Map();\r\n    const modeState = this._getCurrentModeState();\r\n    if (!modeState) {\r\n      return totals;\r\n    }\r\n    const merged = this._getMergedCostCells(modeState);\r\n    merged.forEach((value, cellKey) => {\r\n      const pekerjaanId = parseInt((cellKey || '').split('-')[0], 10);\r\n      if (!Number.isFinite(pekerjaanId)) {\r\n        return;\r\n      }\r\n      totals.set(pekerjaanId, (totals.get(pekerjaanId) || 0) + Number(value));\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  _formatCurrency(value) {\r\n    const numeric = Number(value) || 0;\r\n    if (!this._currencyFormatter && typeof Intl !== 'undefined') {\r\n      this._currencyFormatter = new Intl.NumberFormat('id-ID', {\r\n        style: 'currency',\r\n        currency: 'IDR',\r\n        maximumFractionDigits: 0,\r\n      });\r\n    }\r\n    if (this._currencyFormatter) {\r\n      return this._currencyFormatter.format(numeric);\r\n    }\r\n    return `Rp ${numeric.toLocaleString('id-ID')}`;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    const costViolations = [];\r\n    const normalizedMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    if (normalizedMode === 'actual') {\r\n      const costTotals = this._calculateAllCostTotals();\r\n      costTotals.forEach((totalCost, pekerjaanId) => {\r\n        if (!Number.isFinite(totalCost)) {\r\n          return;\r\n        }\r\n        const capacity = this._getRowCostCapacity(pekerjaanId);\r\n        const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 1) : 1;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (totalCost > capacity + tolerance) {\r\n            costViolations.push({\r\n              type: 'cost',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalCost,\r\n              capacity,\r\n            });\r\n          }\r\n        } else if (totalCost > tolerance) {\r\n          costViolations.push({\r\n            type: 'cost',\r\n            pekerjaan_id: pekerjaanId,\r\n            total: totalCost,\r\n            capacity: 0,\r\n            missingCapacity: true,\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0 && costViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations, costViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      if (item.type === 'cost') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: biaya aktual tidak dapat disimpan karena master biaya 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total biaya ${this._formatCurrency(item.total)} > batas ${this._formatCurrency(item.capacity)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n    return this._buildMonthlyColumns(sourceColumns);\r\n  }\r\n\r\n  _buildMonthlyColumns(sourceColumns) {\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n      const startDate = this._coerceDate(blockColumns[0]?.startDate || blockColumns[0]?.start_date);\r\n      const endDate = this._coerceDate(blockColumns[blockColumns.length - 1]?.endDate || blockColumns[blockColumns.length - 1]?.end_date);\r\n      const rangeText = this._formatShortRange(startDate, endDate);\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel: rangeText || rangeLabel,\r\n        rangeText,\r\n        startDate,\r\n        endDate,\r\n        tooltip: startLabel && endLabel ? `${startLabel} \\u2014 ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n        readOnly: true,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _coerceDate(value) {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Number.isNaN(value.getTime()) ? null : value;\r\n    }\r\n    const parsed = new Date(value);\r\n    return Number.isNaN(parsed.getTime()) ? null : parsed;\r\n  }\r\n\r\n  _formatShortRange(startDate, endDate) {\r\n    const format = (date) => {\r\n      if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\r\n        return '';\r\n      }\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      return `${day}/${month}`;\r\n    };\r\n    const start = format(startDate);\r\n    const end = format(endDate);\r\n    if (start && end) {\r\n      return `${start} - ${end}`;\r\n    }\r\n    return start || end || '';\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  _bindUnifiedTabSync() {\r\n    if (!this.state.useUnifiedTable) {\r\n      return;\r\n    }\r\n    const scurveTab =\r\n      document.querySelector('#scurve-tab') ||\r\n      document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n    const ganttTab =\r\n      document.querySelector('#gantt-tab') ||\r\n      document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n    const gridTab =\r\n      document.querySelector('#grid-tab') ||\r\n      document.querySelector('[data-bs-target=\"#grid-view\"]');\r\n\r\n    if (scurveTab) {\r\n      const handler = () => {\r\n        this._restoreGridContainerPosition();\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> kurva');\r\n          }\r\n        }\r\n      };\r\n      scurveTab.addEventListener('shown.bs.tab', handler);\r\n      scurveTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (ganttTab) {\r\n      const handler = () => {\r\n        const ganttContainer = document.getElementById('gantt-redesign-container');\r\n        if (ganttContainer) {\r\n          this._initializeUnifiedGanttOverlay(ganttContainer);\r\n        } else if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('gantt');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> gantt (no overlay host)');\r\n          }\r\n        }\r\n      };\r\n      ganttTab.addEventListener('shown.bs.tab', handler);\r\n      ganttTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (gridTab) {\r\n      const handler = () => {\r\n        this._restoreGridContainerPosition();\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('grid');\r\n          if (this.state.debugUnifiedTable) {\r\n            console.log('[UnifiedTab] Switch -> grid');\r\n          }\r\n        }\r\n      };\r\n      gridTab.addEventListener('shown.bs.tab', handler);\r\n      gridTab.addEventListener('click', handler);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    this._unbindStateManagerEvents();\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.destroy();\r\n      this.gridManager = null;\r\n    }\r\n    this.unifiedManager = null;\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n\r\n"],"file":"assets/js/jadwal-kegiatan-CMZ4YXKX.js"}