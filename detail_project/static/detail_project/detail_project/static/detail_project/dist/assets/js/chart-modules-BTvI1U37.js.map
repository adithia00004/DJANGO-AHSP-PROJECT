{"version":3,"file":"chart-modules-BTvI1U37.js","sources":["../../../../../../js/src/modules/gantt/GanttCanvasOverlay.js","../../../../../../js/src/modules/shared/chart-utils.js","../../../../../../js/src/modules/kurva-s/week-zero-helpers.js","../../../../../../js/src/modules/kurva-s/dataset-builder.js","../../../../../../js/src/modules/shared/ux-enhancements.js","../../../../../../../../../node_modules/uplot/dist/uPlot.esm.js","../../../../../../js/src/modules/kurva-s/uplot-chart.js"],"sourcesContent":["export class GanttCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.debug = Boolean(\n      this.tableManager?.options?.debugUnifiedTable ||\n      this.tableManager?.state?.debugUnifiedTable ||\n      window.DEBUG_UNIFIED_TABLE\n    );\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'gantt-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 1;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n    this.mask = document.createElement('div');\n    this.mask.className = 'gantt-overlay-mask';\n    this.mask.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: none;\n      z-index: 10;\n      background: var(--grid-frozen-bg, var(--bs-body-bg));\n    `;\n    this.visible = false;\n    this.barData = [];\n    this.dependencies = [];\n    this.barRects = [];\n    this.tooltip = null;\n    this.pinnedWidth = 0;\n    this.scrollLeft = 0; // Track scroll position for coordinate adjustment\n    this._syncScheduled = false; // Track if sync is already scheduled\n    this.lastDrawMetrics = { barsDrawn: 0, barsSkipped: 0 };\n\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      // FIXED: Immediate transform update on scroll (no lag)\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          // Update transform IMMEDIATELY to prevent overlap on fast scroll\n          this._updateTransform();\n\n          // Full sync can be throttled for performance\n          if (!this._syncScheduled) {\n            this._syncScheduled = true;\n            requestAnimationFrame(() => {\n              this._syncScheduled = false;\n              this.syncWithTable();\n            });\n          }\n        }\n      }, { passive: true });\n    }\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n    scrollArea.style.overflow = 'auto'; // Ensure overflow is clipped\n\n    // Ensure parent clips overflow to avoid covering frozen columns\n    const parent = scrollArea.parentElement;\n    if (parent) {\n      parent.style.overflow = 'hidden';\n      parent.style.position = 'relative';\n    }\n\n    this._updatePinnedClip();\n\n    if (!this.mask.parentNode) {\n      scrollArea.appendChild(this.mask);\n    }\n    scrollArea.appendChild(this.canvas);\n    this.visible = true;\n    console.log('[GanttOverlay] âœ… OVERLAY SHOWN - Canvas clipping enabled to prevent overflow');\n    this._log('show');\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n    if (this.mask.parentNode) {\n      this.mask.parentNode.removeChild(this.mask);\n    }\n    this.visible = false;\n    this._log('hide');\n    this._hideTooltip();\n  }\n\n  _updateTransform() {\n    // FIXED: Immediate transform update without full canvas re-render\n    // This prevents overlap lag on fast scroll\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this.scrollLeft = scrollArea.scrollLeft || 0;\n    this.canvas.style.transform = `translateX(${this.scrollLeft}px)`;\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this._updatePinnedClip();\n\n    // FIXED: Canvas uses translate to stay aligned while keeping left boundary fixed\n    this.scrollLeft = scrollArea.scrollLeft || 0;\n\n    // CRITICAL FIX: Canvas width should be VIEWPORT width, not full scrollWidth\n    // Full scrollWidth can exceed browser limits (32,767px) causing blank canvas\n    // We only need to render what's visible in the viewport\n    const viewportWidth = scrollArea.clientWidth - this.pinnedWidth;\n    const MAX_CANVAS_WIDTH = 32000; // Browser safety limit\n\n    this.canvas.width = Math.min(viewportWidth, MAX_CANVAS_WIDTH);\n    this.canvas.height = Math.min(scrollArea.clientHeight, 16000); // Height limit too\n\n    // Use transform instead of left to avoid affecting layout\n    // Translate compensates for scroll to keep canvas fixed after frozen column\n    this.canvas.style.position = 'absolute';\n    this.canvas.style.left = `${this.pinnedWidth}px`; // Static: start after frozen\n    this.canvas.style.top = '0px';\n    this.canvas.style.transform = `translateX(${this.scrollLeft}px)`; // Dynamic: compensate scroll\n\n    // Mask no longer needed since canvas doesn't overlap frozen area\n    if (this.mask) {\n      this.mask.style.display = 'none';\n    }\n\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\n      ? this.tableManager.getCellBoundingRects()\n      : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    // Clear and clip to the canvas; mask element handles frozen cover.\n    this.ctx.save();\n    this.barRects = [];\n\n    console.log('[GanttOverlay] ðŸ” SYNC DEBUG:', {\n      canvasSize: { w: this.canvas.width, h: this.canvas.height },\n      scrollAreaSize: { w: scrollArea.scrollWidth, h: scrollArea.scrollHeight },\n      visibleSize: { w: scrollArea.clientWidth, h: scrollArea.clientHeight },\n      scroll: { left: scrollArea.scrollLeft, top: scrollArea.scrollTop },\n      cellRects: cellRects.length,\n      bars: this.barData.length,\n    });\n\n    this._log('sync', {\n      cells: cellRects.length,\n      bars: this.barData.length,\n      deps: this.dependencies.length,\n      size: { w: this.canvas.width, h: this.canvas.height },\n      scroll: { left: scrollArea.scrollLeft, top: scrollArea.scrollTop },\n    });\n\n    if (this.barData.length > 0 && cellRects.length === 0) {\n      console.error('[GanttOverlay] Have bar data but no cell rects. Overlay cannot draw bars.', {\n        bars: this.barData.length,\n      });\n    }\n\n    // Outline cells only when debugging alignment\n    if (this.debug) {\n      this.ctx.strokeStyle = '#e2e8f0';\n      cellRects.forEach((rect) => {\n        // FIXED: Convert to canvas-relative coordinates for debug grid\n        // Account for both pinnedWidth and scrollLeft\n        const canvasX = rect.x - this.pinnedWidth - this.scrollLeft;\n\n        // Viewport culling: skip cells outside canvas bounds\n        if (canvasX < -rect.width || canvasX > this.canvas.width) return;\n\n        this.ctx.strokeRect(canvasX, rect.y, rect.width, rect.height);\n      });\n    }\n\n    this._drawBars(cellRects);\n    this._publishMetrics(cellRects, scrollArea);\n    this._drawDependencies(cellRects);\n    this.ctx.restore();\n  }\n\n  renderBars(barData) {\n    this.barData = Array.isArray(barData) ? barData : [];\n    this._log('renderBars', { bars: this.barData.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  renderDependencies(dependencyData) {\n    this.dependencies = Array.isArray(dependencyData) ? dependencyData : [];\n    this._log('renderDependencies', { deps: this.dependencies.length });\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _updatePinnedClip() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    const pinnedWidth = typeof this.tableManager?.getPinnedColumnsWidth === 'function'\n      ? Number(this.tableManager.getPinnedColumnsWidth()) || 0\n      : 0;\n    this.pinnedWidth = Math.max(0, pinnedWidth);\n\n    // FIXED: No need for clip-path anymore since canvas starts after frozen columns\n    // Remove clip-path if exists\n    this.canvas.style.clipPath = '';\n    this.canvas.style.webkitClipPath = '';\n\n    if (scrollArea?.style) {\n      scrollArea.style.setProperty('--gantt-overlay-pinned-width', `${this.pinnedWidth}px`);\n    }\n    this._log('clip', { pinnedWidth: this.pinnedWidth });\n    return this.pinnedWidth;\n  }\n\n  _publishMetrics(cellRects, scrollArea) {\n    const viewportLeft = typeof scrollArea?.scrollLeft === 'number' ? scrollArea.scrollLeft : 0;\n    const viewportWidth = typeof scrollArea?.clientWidth === 'number' ? scrollArea.clientWidth : 0;\n    const viewportRight = viewportWidth ? viewportLeft + viewportWidth : null;\n    const metrics = {\n      timestamp: Date.now(),\n      pinnedWidth: this.pinnedWidth,\n      clipLeft: Math.max(this.pinnedWidth, viewportLeft),\n      viewportLeft,\n      viewportWidth,\n      viewportRight,\n      scrollWidth: scrollArea?.scrollWidth || 0,\n      scrollHeight: scrollArea?.scrollHeight || 0,\n      barsDrawn: this.lastDrawMetrics.barsDrawn || 0,\n      barsSkipped: this.lastDrawMetrics.barsSkipped || 0,\n      cellRects: Array.isArray(cellRects) ? cellRects.length : 0,\n    };\n    if (typeof window !== 'undefined') {\n      window.GanttOverlayMetrics = metrics;\n    }\n    this._log('metrics', metrics);\n    return metrics;\n  }\n\n  _drawBars(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.barData.length === 0) {\n      this.lastDrawMetrics = { barsDrawn: 0, barsSkipped: 0 };\n      return;\n    }\n    const scrollArea = this.tableManager?.bodyScroll;\n    const viewportLeft = typeof scrollArea?.scrollLeft === 'number' ? scrollArea.scrollLeft : 0;\n    const viewportWidth = typeof scrollArea?.clientWidth === 'number' ? scrollArea.clientWidth : 0;\n    const viewportRight = viewportWidth ? viewportLeft + viewportWidth : null;\n    const clipLeft = Math.max(this.pinnedWidth, viewportLeft);\n\n    // Group cell rects by pekerjaan\n    const rectIndex = new Map();\n    cellRects.forEach((r) => {\n      const key = String(r.pekerjaanId);\n      if (!rectIndex.has(key)) rectIndex.set(key, []);\n      rectIndex.get(key).push(r);\n    });\n    rectIndex.forEach((list) => list.sort((a, b) => a.x - b.x));\n\n    const barsByRow = new Map();\n    this.barData.forEach((bar) => {\n      const key = String(bar.pekerjaanId);\n      if (!barsByRow.has(key)) barsByRow.set(key, []);\n      barsByRow.get(key).push(bar);\n    });\n\n    let barsDrawn = 0;\n    let barsSkipped = 0;\n\n    barsByRow.forEach((bars, pkjId) => {\n      const rects = rectIndex.get(pkjId) || [];\n      const rectMap = new Map(rects.map((r) => [String(r.columnId), r]));\n      // track heights for stacked view: planned bottom, actual top\n      bars.forEach((bar) => {\n        const rect = rectMap.get(String(bar.columnId));\n        if (!rect) {\n          barsSkipped += 1;\n          return;\n        }\n        const rectRight = rect.x + rect.width;\n        if (rectRight <= clipLeft || (viewportRight !== null && rect.x >= viewportRight)) {\n          barsSkipped += 1;\n          return;\n        }\n\n        const paddingX = 0; // no gap to keep continuity\n        const paddingY = 2;\n        const maxWidth = rect.width - paddingX * 2;\n\n        // FIXED: Convert absolute coordinates to canvas-relative coordinates\n        // Canvas starts at pinnedWidth and is translated by scrollLeft\n        // Canvas is only viewport-width, so we render relative to current viewport\n        const baseX = (rect.x - this.pinnedWidth - this.scrollLeft) + paddingX;\n        const baseY = rect.y + paddingY;\n\n        // CRITICAL: Skip bars outside canvas bounds (viewport culling)\n        // Canvas width is limited to viewport, so skip bars outside\n        if (baseX < -rect.width || baseX > this.canvas.width) {\n          barsSkipped += 1;\n          return;\n        }\n\n        const fullHeight = Math.max(8, rect.height - paddingY * 2);\n        const trackHeight = fullHeight / 2; // split planned/actual vertically\n\n        const plannedValue = Number.isFinite(bar.planned) ? Math.max(0, Math.min(100, bar.planned)) : 0;\n        const actualValue = Number.isFinite(bar.actual) ? Math.max(0, Math.min(100, bar.actual)) : Math.max(0, Math.min(100, bar.value || 0));\n\n        // Planned track (bottom half): full width only if >0, otherwise gap\n        const plannedWidth = maxWidth > 0 && plannedValue > 0 ? maxWidth : 0;\n        this.ctx.fillStyle = this._getPlannedColor();\n        if (plannedWidth > 0) {\n          this.ctx.fillRect(baseX, baseY + trackHeight, plannedWidth, trackHeight - 1);\n        }\n\n        // Actual track (top half): full width only if >0, otherwise gap\n        const actualWidth = maxWidth > 0 && actualValue > 0 ? maxWidth : 0;\n        const barColor = bar.color || this._resolveActualColor(bar.variance);\n        this.ctx.fillStyle = barColor;\n        if (actualWidth > 0) {\n          this.ctx.fillRect(baseX, baseY, actualWidth, trackHeight - 1);\n        }\n\n        this.barRects.push({\n          x: baseX,\n          y: baseY,\n          width: Math.max(actualWidth, plannedWidth),\n          height: fullHeight,\n          pekerjaanId: bar.pekerjaanId,\n          columnId: bar.columnId,\n          value: actualValue,\n          planned: plannedValue,\n          variance: bar.variance,\n          label: bar.label,\n          color: barColor,\n        });\n        barsDrawn += 1;\n      });\n    });\n\n    this.lastDrawMetrics = { barsDrawn, barsSkipped };\n    this._log('bars:drawn', { drawn: barsDrawn, skipped: barsSkipped, total: this.barData.length });\n  }\n\n  _drawDependencies(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.dependencies.length === 0) {\n      return;\n    }\n\n    this.dependencies.forEach((dep) => {\n      const fromRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.fromPekerjaanId && c.columnId === dep.fromColumnId,\n      );\n      const toRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.toPekerjaanId && c.columnId === dep.toColumnId,\n      );\n      if (!fromRect || !toRect) return;\n\n      // FIXED: Convert to canvas-relative coordinates\n      // Account for both pinnedWidth and scrollLeft\n      const fromX = (fromRect.x - this.pinnedWidth - this.scrollLeft) + fromRect.width;\n      const fromY = fromRect.y + fromRect.height / 2;\n      const toX = toRect.x - this.pinnedWidth - this.scrollLeft;\n      const toY = toRect.y + toRect.height / 2;\n\n      this.ctx.strokeStyle = dep.color || '#94a3b8';\n      this.ctx.lineWidth = 1.5;\n      this.ctx.beginPath();\n      this.ctx.moveTo(fromX, fromY);\n      this.ctx.lineTo(toX, toY);\n      this.ctx.stroke();\n\n      const arrowSize = 5;\n      const angle = Math.atan2(toY - fromY, toX - fromX);\n      this.ctx.beginPath();\n      this.ctx.moveTo(toX, toY);\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle - Math.PI / 6), toY - arrowSize * Math.sin(angle - Math.PI / 6));\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle + Math.PI / 6), toY - arrowSize * Math.sin(angle + Math.PI / 6));\n      this.ctx.closePath();\n      this.ctx.fillStyle = dep.color || '#94a3b8';\n      this.ctx.fill();\n    });\n  }\n\n  _resolveVarianceColor(variance) {\n    if (!Number.isFinite(variance)) return '#3b82f6';\n    if (variance < -0.1) return '#ef4444';\n    if (variance > 0.1) return '#22c55e';\n    return '#3b82f6';\n  }\n\n  _resolveActualColor(variance) {\n    const cssVar =\n      this._getCssVar('--gantt-actual-fill') ||\n      this._getCssVar('--bs-warning') ||\n      this._getBtnColor('.progress-mode-tabs .btn-outline-warning') ||\n      this._getBtnColor('.progress-mode-tabs .btn-warning');\n    if (cssVar) return cssVar;\n    return this._resolveVarianceColor(variance);\n  }\n\n  _getPlannedColor() {\n    return (\n      this._getCssVar('--gantt-bar-fill') ||\n      this._getCssVar('--bs-info') ||\n      this._getBtnColor('.progress-mode-tabs .btn-outline-info') ||\n      this._getBtnColor('.progress-mode-tabs .btn-info') ||\n      '#e2e8f0'\n    );\n  }\n\n  _getCssVar(name) {\n    try {\n      const root = document.documentElement;\n      const value = getComputedStyle(root).getPropertyValue(name);\n      return value && value.trim().length ? value.trim() : null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _getBtnColor(selector) {\n    try {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      const style = getComputedStyle(el);\n      return style.getPropertyValue('background-color')?.trim() ||\n        style.getPropertyValue('border-color')?.trim() ||\n        style.getPropertyValue('color')?.trim() ||\n        null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  _bindPointerEvents() {\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible || !this.barRects.length) return;\n      const rect = this.canvas.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const hit = this._hitTest(x, y);\n      if (hit) {\n        this._showTooltip(e.clientX, e.clientY, hit);\n      } else {\n        this._hideTooltip();\n      }\n    });\n\n    this.canvas.addEventListener('mouseleave', () => {\n      this._hideTooltip();\n    });\n  }\n\n  _hitTest(x, y) {\n    return this.barRects.find(\n      (b) => x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height,\n    );\n  }\n\n  _ensureTooltip() {\n    if (this.tooltip) return this.tooltip;\n    this.tooltip = document.createElement('div');\n    this.tooltip.className = 'gantt-overlay-tooltip';\n    this.tooltip.style.cssText = `\n      position: fixed;\n      padding: 4px 8px;\n      background: rgba(17,24,39,0.85);\n      color: #f8fafc;\n      border-radius: 4px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: 20;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.25);\n    `;\n    document.body.appendChild(this.tooltip);\n    return this.tooltip;\n  }\n\n  _showTooltip(clientX, clientY, hit) {\n    const tip = this._ensureTooltip();\n    const name = hit.label || hit.pekerjaanId;\n    const planned = Number.isFinite(hit.planned) ? `${hit.planned}%` : '-';\n    const actual = Number.isFinite(hit.value) ? `${hit.value}%` : '-';\n    const variance = Number.isFinite(hit.variance) ? `${hit.variance}%` : '-';\n    tip.innerHTML = `Pekerjaan: ${name}<br/>Kolom: ${hit.columnId}<br/>Planned: ${planned}<br/>Actual: ${actual}<br/>Variance: ${variance}`;\n    tip.style.left = `${clientX + 10}px`;\n    tip.style.top = `${clientY + 10}px`;\n    tip.style.display = 'block';\n  }\n\n  _hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.style.display = 'none';\n    }\n  }\n\n  _log(event, payload) {\n    if (!this.debug) return;\n    console.log(`[GanttOverlay] ${event}`, payload || {});\n  }\n}\n","/**\n * Chart Utilities Module\n * Shared utilities for Kurva-S and Gantt charts\n *\n * Migrated from legacy chart modules\n * Date: 2025-11-20\n */\n\n// =========================================================================\n// CONSTANTS\n// =========================================================================\n\nexport const ONE_DAY_MS = 24 * 60 * 60 * 1000;\n\n// =========================================================================\n// THEME UTILITIES\n// =========================================================================\n\n/**\n * Get theme-specific colors for charts\n * Supports Bootstrap dark/light theme\n *\n * @returns {Object} Theme colors\n */\nexport function getThemeColors() {\n  const theme = document.documentElement.getAttribute('data-bs-theme') || 'light';\n\n  if (theme === 'dark') {\n    return {\n      text: '#f8fafc',\n      axis: '#cbd5e1',\n      plannedLine: '#60a5fa',\n      plannedArea: 'rgba(96, 165, 250, 0.15)',\n      actualLine: '#34d399',\n      actualArea: 'rgba(52, 211, 153, 0.18)',\n      costActualLine: '#f87171',\n      costActualArea: 'rgba(248, 113, 113, 0.18)',\n      gridLine: '#334155',\n      background: '#1e293b',\n    };\n  }\n\n  return {\n    text: '#1f2937',\n    axis: '#374151',\n    plannedLine: '#0d6efd',\n    plannedArea: 'rgba(13, 110, 253, 0.12)',\n    actualLine: '#198754',\n    actualArea: 'rgba(25, 135, 84, 0.12)',\n    costActualLine: '#dc3545',\n    costActualArea: 'rgba(220, 53, 69, 0.12)',\n    gridLine: '#e5e7eb',\n    background: '#ffffff',\n  };\n}\n\n/**\n * Setup theme observer for chart updates\n * Watches for data-bs-theme attribute changes\n *\n * @param {Function} callback - Called when theme changes\n * @returns {MutationObserver} Observer instance\n */\nexport function setupThemeObserver(callback) {\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {\n        const theme = document.documentElement.getAttribute('data-bs-theme');\n        console.log('[ChartUtils] Theme changed to:', theme);\n        callback(theme);\n      }\n    });\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['data-bs-theme']\n  });\n\n  return observer;\n}\n\n// =========================================================================\n// DATE UTILITIES\n// =========================================================================\n\n/**\n * Normalize date to Date object\n * Handles multiple input formats: Date, ISO string, timestamp\n *\n * @param {Date|string|number} input - Date input\n * @returns {Date|null} Normalized date or null if invalid\n */\nexport function normalizeDate(input) {\n  if (!input) return null;\n\n  // Already a Date object\n  if (input instanceof Date) {\n    return Number.isNaN(input.getTime()) ? null : input;\n  }\n\n  // ISO string or other string format\n  if (typeof input === 'string') {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  // Timestamp\n  if (typeof input === 'number' && Number.isFinite(input)) {\n    const date = new Date(input);\n    return Number.isNaN(date.getTime()) ? null : date;\n  }\n\n  return null;\n}\n\n/**\n * Format date to YYYY-MM-DD string\n *\n * @param {Date} date - Date to format\n * @returns {string} Formatted date string\n */\nexport function formatDate(date) {\n  if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n    return '';\n  }\n\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * Calculate date range from time columns\n *\n * @param {Array} columns - Array of time column objects\n * @returns {Object} {startDate, endDate}\n */\nexport function calculateDateRange(columns) {\n  if (!Array.isArray(columns) || columns.length === 0) {\n    return { startDate: null, endDate: null };\n  }\n\n  let minDate = null;\n  let maxDate = null;\n\n  columns.forEach(col => {\n    const start = normalizeDate(col.startDate);\n    const end = normalizeDate(col.endDate);\n\n    if (start && (!minDate || start < minDate)) {\n      minDate = start;\n    }\n\n    if (end && (!maxDate || end > maxDate)) {\n      maxDate = end;\n    }\n  });\n\n  return { startDate: minDate, endDate: maxDate };\n}\n\n/**\n * Get sorted time columns\n * Sorts by startDate, then by index\n *\n * @param {Array} columns - Time columns\n * @returns {Array} Sorted columns\n */\nexport function getSortedColumns(columns) {\n  if (!Array.isArray(columns)) return [];\n\n  return columns.slice().sort((a, b) => {\n    const aStart = normalizeDate(a.startDate);\n    const bStart = normalizeDate(b.startDate);\n\n    if (aStart && bStart) {\n      return aStart.getTime() - bStart.getTime();\n    }\n\n    return (a.index || 0) - (b.index || 0);\n  });\n}\n\n// =========================================================================\n// VOLUME UTILITIES\n// =========================================================================\n\n/**\n * Build volume lookup map from state\n * Handles both Map and Object formats\n *\n * @param {Object} state - Application state\n * @returns {Map} Volume lookup (pekerjaanId â†’ volume)\n */\nexport function buildVolumeLookup(state) {\n  const lookup = new Map();\n\n  const setVolume = (key, value) => {\n    const numericKey = Number(key);\n    const volume = Number.isFinite(value) && value > 0 ? value : null;\n\n    if (volume === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), volume);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), volume);\n    }\n  };\n\n  // Handle Map format\n  if (state.volumeMap instanceof Map) {\n    state.volumeMap.forEach((value, key) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n  // Handle Object format\n  else if (state.volumeMap && typeof state.volumeMap === 'object') {\n    Object.entries(state.volumeMap).forEach(([key, value]) => {\n      const vol = parseFloat(value);\n      setVolume(key, vol);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get volume for a specific pekerjaan\n *\n * @param {Map} volumeLookup - Volume lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found\n * @returns {number} Volume value\n */\nexport function getVolumeForPekerjaan(volumeLookup, pekerjaanId, fallback = 1) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (volumeLookup.has(variant)) {\n      return volumeLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n/**\n * Build harga (cost) lookup map from state\n * Phase 2F.0: Kurva S should use HARGA (Rupiah) instead of volume\n *\n * @param {Object} state - Application state\n * @returns {Map} Harga lookup map (pekerjaanId â†’ total harga in Rp)\n */\nexport function buildHargaLookup(state) {\n  const lookup = new Map();\n\n  const setHarga = (key, value) => {\n    const numericKey = Number(key);\n    const harga = Number.isFinite(value) && value >= 0 ? value : null;\n\n    if (harga === null) return;\n\n    // Store both string and numeric keys for flexible lookup\n    lookup.set(String(key), harga);\n    if (!Number.isNaN(numericKey)) {\n      lookup.set(String(numericKey), harga);\n    }\n  };\n\n  // Handle Map format\n  if (state.hargaMap instanceof Map) {\n    state.hargaMap.forEach((value, key) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n  // Handle Object format\n  else if (state.hargaMap && typeof state.hargaMap === 'object') {\n    Object.entries(state.hargaMap).forEach(([key, value]) => {\n      const harga = parseFloat(value);\n      setHarga(key, harga);\n    });\n  }\n\n  return lookup;\n}\n\n/**\n * Get harga for a specific pekerjaan\n * Phase 2F.0: Used for harga-weighted Kurva S calculation\n *\n * @param {Map} hargaLookup - Harga lookup map\n * @param {string|number} pekerjaanId - Pekerjaan ID\n * @param {number} fallback - Fallback value if not found (default: 0)\n * @returns {number} Total harga (Rp) for the pekerjaan\n */\nexport function getHargaForPekerjaan(hargaLookup, pekerjaanId, fallback = 0) {\n  const idVariants = [\n    String(pekerjaanId),\n    String(Number(pekerjaanId)),\n  ];\n\n  for (const variant of idVariants) {\n    if (hargaLookup.has(variant)) {\n      return hargaLookup.get(variant);\n    }\n  }\n\n  return fallback;\n}\n\n// =========================================================================\n// DATA UTILITIES\n// =========================================================================\n\n/**\n * Build cell value map from assignmentMap and modifiedCells\n * Modified cells override assignment values\n *\n * @deprecated Phase 0.5: Use StateManager.getAllCellsForMode() instead\n * This function is redundant with StateManager's built-in merge logic.\n *\n * Migration guide:\n * BEFORE: const cellValues = buildCellValueMap(state);\n * AFTER:  const cellValues = stateManager.getAllCellsForMode('planned');\n *\n * @param {Object} state - Application state\n * @returns {Map} Cell value map (cellKey â†’ percentage)\n */\nexport function buildCellValueMap(state) {\n  console.warn('[chart-utils] buildCellValueMap() is deprecated. Use StateManager.getAllCellsForMode() instead.');\n\n  const map = new Map();\n\n  const assignValue = (key, value) => {\n    const numeric = parseFloat(value);\n    map.set(String(key), Number.isFinite(numeric) ? numeric : 0);\n  };\n\n  // First, load saved assignment values\n  if (state.assignmentMap instanceof Map) {\n    state.assignmentMap.forEach((value, key) => assignValue(key, value));\n  } else if (state.assignmentMap && typeof state.assignmentMap === 'object') {\n    Object.entries(state.assignmentMap).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  // Then, override with modified cells (unsaved changes)\n  if (state.modifiedCells instanceof Map) {\n    state.modifiedCells.forEach((value, key) => assignValue(key, value));\n  } else if (state.modifiedCells && typeof state.modifiedCells === 'object') {\n    Object.entries(state.modifiedCells).forEach(([key, value]) => assignValue(key, value));\n  }\n\n  return map;\n}\n\n/**\n * Collect all pekerjaan IDs from state and cell values\n *\n * @param {Object} state - Application state\n * @param {Map} cellValues - Cell value map\n * @returns {Set} Set of pekerjaan IDs\n */\nexport function collectPekerjaanIds(state, cellValues) {\n  const ids = new Set();\n\n  // From flatPekerjaan array\n  if (Array.isArray(state.flatPekerjaan)) {\n    state.flatPekerjaan.forEach((node) => {\n      if (node && (node.type === 'pekerjaan' || typeof node.type === 'undefined')) {\n        ids.add(String(node.id));\n      }\n    });\n  }\n\n  // From cell keys (format: \"pekerjaanId-tahapanId\")\n  cellValues.forEach((_, key) => {\n    const [pekerjaanId] = String(key).split('-');\n    if (pekerjaanId) {\n      ids.add(pekerjaanId);\n    }\n  });\n\n  return ids;\n}\n\n// =========================================================================\n// NUMBER UTILITIES\n// =========================================================================\n\n/**\n * Format percentage for display\n *\n * @param {number} value - Percentage value (0-100)\n * @param {number} decimals - Number of decimal places\n * @returns {string} Formatted percentage\n */\nexport function formatPercentage(value, decimals = 1) {\n  if (!Number.isFinite(value)) return '0%';\n\n  const rounded = decimals === 0\n    ? Math.round(value)\n    : parseFloat(value.toFixed(decimals));\n\n  return `${rounded}%`;\n}\n\n/**\n * Format number as Indonesian Rupiah\n * Phase 2F.0: Display currency in Kurva S tooltips\n *\n * @param {number} amount - Amount in Rupiah\n * @returns {string} Formatted currency string (e.g., \"Rp 1.234.567\")\n */\nexport function formatRupiah(amount) {\n  if (!Number.isFinite(amount)) return 'Rp 0';\n\n  // Format with thousand separators (Indonesian style)\n  const formatted = Math.round(amount).toLocaleString('id-ID');\n  return `Rp ${formatted}`;\n}\n\n/**\n * Clamp number between min and max\n *\n * @param {number} value - Value to clamp\n * @param {number} min - Minimum value\n * @param {number} max - Maximum value\n * @returns {number} Clamped value\n */\nexport function clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n// =========================================================================\n// RESIZE UTILITIES\n// =========================================================================\n\n/**\n * Create debounced resize handler\n *\n * @param {Function} callback - Function to call on resize\n * @param {number} delay - Debounce delay in ms\n * @returns {Function} Debounced handler\n */\nexport function createResizeHandler(callback, delay = 150) {\n  let timeoutId = null;\n\n  return function debouncedResize() {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n\n    timeoutId = setTimeout(() => {\n      callback();\n      timeoutId = null;\n    }, delay);\n  };\n}\n\n/**\n * Setup resize observer for chart container\n *\n * @param {HTMLElement} container - Container element\n * @param {Function} callback - Called when container resizes\n * @returns {ResizeObserver} Observer instance\n */\nexport function setupResizeObserver(container, callback) {\n  if (!container || typeof ResizeObserver === 'undefined') {\n    return null;\n  }\n\n  const observer = new ResizeObserver((entries) => {\n    for (const entry of entries) {\n      if (entry.target === container) {\n        callback(entry.contentRect);\n      }\n    }\n  });\n\n  observer.observe(container);\n\n  return observer;\n}\n\n// =========================================================================\n// VALIDATION UTILITIES\n// =========================================================================\n\n/**\n * Validate chart data\n *\n * @param {Object} data - Chart data\n * @returns {Object} {isValid, errors}\n */\nexport function validateChartData(data) {\n  const errors = [];\n\n  if (!data || typeof data !== 'object') {\n    errors.push('Chart data must be an object');\n    return { isValid: false, errors };\n  }\n\n  if (!Array.isArray(data.xAxis)) {\n    errors.push('xAxis must be an array');\n  }\n\n  if (!Array.isArray(data.series)) {\n    errors.push('series must be an array');\n  }\n\n  if (data.xAxis && data.series) {\n    data.series.forEach((serie, index) => {\n      if (!Array.isArray(serie.data)) {\n        errors.push(`Series ${index} data must be an array`);\n      } else if (serie.data.length !== data.xAxis.length) {\n        errors.push(`Series ${index} length (${serie.data.length}) doesn't match xAxis (${data.xAxis.length})`);\n      }\n    });\n  }\n\n  return {\n    isValid: errors.length === 0,\n    errors\n  };\n}\n\n// =========================================================================\n// EXPORT ALL\n// =========================================================================\n\nexport default {\n  // Constants\n  ONE_DAY_MS,\n\n  // Theme\n  getThemeColors,\n  setupThemeObserver,\n\n  // Date\n  normalizeDate,\n  formatDate,\n  calculateDateRange,\n  getSortedColumns,\n\n  // Volume\n  buildVolumeLookup,\n  getVolumeForPekerjaan,\n\n  // Harga (Phase 2F.0)\n  buildHargaLookup,\n  getHargaForPekerjaan,\n\n  // Data\n  buildCellValueMap,\n  collectPekerjaanIds,\n\n  // Number\n  formatPercentage,\n  formatRupiah,\n  clamp,\n\n  // Resize\n  createResizeHandler,\n  setupResizeObserver,\n\n  // Validation\n  validateChartData,\n};\n","/**\n * Helpers to ensure Kurva S datasets always start from Week 0 (0% progress).\n */\n\n/**\n * Create zero-week metadata entry for cost datasets.\n * @returns {Object}\n */\nexport function createZeroWeekEntry() {\n  return {\n    week_number: 0,\n    week_start: null,\n    week_end: null,\n    cost: 0,\n    cumulative_cost: 0,\n    cumulative_percent: 0,\n    pekerjaan_breakdown: {},\n  };\n}\n\n/**\n * Prepend zero-week detail information for tooltips / metadata.\n * @param {Array|Object} details\n * @param {string} zeroLabel\n * @param {boolean} isCostView\n * @returns {Array|Object}\n */\nexport function prependZeroDetails(details, zeroLabel, isCostView) {\n  if (Array.isArray(details)) {\n    return [\n      {\n        label: zeroLabel,\n        planned: 0,\n        actual: 0,\n        variance: 0,\n        start: null,\n        end: null,\n        tooltip: zeroLabel,\n        // AUDIT FIX: Include weekNumber for correct tooltip display\n        weekNumber: 0,\n      },\n      ...details,\n    ];\n  }\n\n  if (isCostView && details && typeof details === 'object') {\n    const zeroWeek = createZeroWeekEntry();\n    return {\n      ...details,\n      weeks: Array.isArray(details.weeks) ? [zeroWeek, ...details.weeks] : details.weeks,\n      actualWeeks: Array.isArray(details.actualWeeks) ? [zeroWeek, ...details.actualWeeks] : details.actualWeeks,\n    };\n  }\n\n  return details;\n}\n\n/**\n * Ensure dataset starts with Week 0.\n * @param {Object} dataset\n * @returns {Object}\n */\nexport function ensureWeekZeroDataset(dataset) {\n  if (!dataset || !Array.isArray(dataset.labels) || dataset.labels.length === 0) {\n    return dataset;\n  }\n\n  const firstLabel = String(dataset.labels[0] || '').toLowerCase();\n  if (firstLabel.includes('week 0') || firstLabel === 'w0') {\n    return dataset;\n  }\n\n  const zeroLabel = dataset.viewMode === 'cost' ? 'W0' : 'Week 0';\n  const plannedSeries = Array.isArray(dataset.planned) ? dataset.planned : [];\n  const actualSeries = Array.isArray(dataset.actual) ? dataset.actual : [];\n\n  const updated = {\n    ...dataset,\n    labels: [zeroLabel, ...dataset.labels],\n    planned: [0, ...plannedSeries],\n    actual: [0, ...actualSeries],\n  };\n\n  if (Array.isArray(dataset.acSeries)) {\n    updated.acSeries = [0, ...dataset.acSeries];\n  }\n\n  updated.details = prependZeroDetails(dataset.details, zeroLabel, dataset.viewMode === 'cost');\n\n  return updated;\n}\n\nexport default {\n  ensureWeekZeroDataset,\n  prependZeroDetails,\n  createZeroWeekEntry,\n};\n","import {\n  getSortedColumns,\n  buildVolumeLookup,\n  buildHargaLookup,\n  collectPekerjaanIds,\n  getHargaForPekerjaan,\n  getVolumeForPekerjaan,\n  buildCellValueMap,\n  formatRupiah,\n  normalizeDate,\n} from '../shared/chart-utils.js';\nimport { ensureWeekZeroDataset } from './week-zero-helpers.js';\n\nconst LOG_PREFIX = '[KurvaSDataset]';\n\nexport function buildProgressDataset(state) {\n  const columns = getSortedColumns(state?.timeColumns);\n  if (!columns || columns.length === 0) {\n    console.warn(LOG_PREFIX, 'No time columns available');\n    return null;\n  }\n\n  const volumeLookup = buildVolumeLookup(state);\n  const hargaLookup = buildHargaLookup(state);\n  const stateManager = state?.stateManager;\n\n  let plannedCellValues;\n  let actualCellValues;\n  if (stateManager) {\n    plannedCellValues = stateManager.getAllCellsForMode('planned') || new Map();\n    actualCellValues = stateManager.getAllCellsForMode('actual') || new Map();\n  } else {\n    const plannedState = state?.plannedState || state;\n    const actualState = state?.actualState || state;\n    plannedCellValues = buildCellValueMap(plannedState);\n    actualCellValues = buildCellValueMap(actualState);\n  }\n\n  if (!plannedCellValues || !(plannedCellValues instanceof Map)) {\n    plannedCellValues = new Map();\n  }\n  if (!actualCellValues || !(actualCellValues instanceof Map)) {\n    actualCellValues = new Map();\n  }\n\n  const pekerjaanIds = new Set([\n    ...collectPekerjaanIds(state, plannedCellValues),\n    ...collectPekerjaanIds(state, actualCellValues),\n  ]);\n\n  let totalBiaya = parseFloat(state?.totalBiayaProject || 0);\n  if (!totalBiaya || totalBiaya <= 0) {\n    pekerjaanIds.forEach((id) => {\n      totalBiaya += getHargaForPekerjaan(hargaLookup, id, 0);\n    });\n  }\n  const useHargaCalculation = totalBiaya > 0 && hargaLookup.size > 0;\n\n  let totalVolume = 0;\n  if (!useHargaCalculation) {\n    pekerjaanIds.forEach((id) => {\n      totalVolume += getVolumeForPekerjaan(volumeLookup, id, 1);\n    });\n    if (!Number.isFinite(totalVolume) || totalVolume <= 0) {\n      totalVolume = pekerjaanIds.size || 1;\n    }\n  }\n\n  const columnIndexById = new Map();\n  columns.forEach((col, index) => {\n    columnIndexById.set(String(col.id), index);\n  });\n\n  const labels = generateLabels(columns);\n  const plannedSeries = calculatePlannedCurve(\n    columns,\n    volumeLookup,\n    hargaLookup,\n    plannedCellValues,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualColumnTotals = calculateColumnTotals(\n    columns,\n    actualCellValues,\n    volumeLookup,\n    hargaLookup,\n    columnIndexById,\n    useHargaCalculation\n  );\n\n  const actualSeries = calculateActualCurve(\n    columns,\n    actualColumnTotals,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  const details = buildDetailData(\n    columns,\n    labels,\n    plannedSeries,\n    actualSeries,\n    useHargaCalculation ? totalBiaya : totalVolume,\n    useHargaCalculation\n  );\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    details,\n    totalVolume,\n    totalBiaya,\n    columnTotals: actualColumnTotals,\n    useHargaCalculation,\n    viewMode: 'progress',\n  });\n}\n\nexport function buildCostDataset(costData) {\n  if (!costData) {\n    console.error(LOG_PREFIX, 'No cost data available');\n    return null;\n  }\n\n  const weeklyData = costData.weeklyData || {};\n  const summary = costData.summary || {};\n  const evm = costData.evm;\n\n  if (evm && Array.isArray(evm.labels) && evm.labels.length > 0) {\n    const totalCost = evm.summary?.bac || summary?.total_project_cost || 0;\n    const weeklySummary = buildCostWeeklySummary(\n      weeklyData?.planned || [],\n      weeklyData?.actual || [],\n      totalCost,\n      evm.labels\n    );\n    const plannedSeries = evm.pv_percent || [];\n    const actualSeries = evm.ev_percent || [];\n    const acSeries = evm.ac_percent || actualSeries;\n    const varianceSeries = plannedSeries.map((value, index) =>\n      Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n    );\n    const varianceCostSeries = weeklySummary.map((entry) => entry.varianceCostValue || 0);\n    return ensureWeekZeroDataset({\n      labels: evm.labels,\n      planned: plannedSeries,\n      actual: actualSeries,\n      acSeries,\n      varianceSeries,\n      varianceCostSeries,\n      details: {\n        totalCost,\n        weeks: weeklyData?.planned || [],\n        actualWeeks: weeklyData?.actual || [],\n        weeklySummary,\n        evmSummary: evm.summary,\n        evm,\n      },\n      evm,\n      totalBiaya: totalCost,\n      useHargaCalculation: true,\n      viewMode: 'cost',\n    });\n  }\n\n  const labels = (weeklyData.planned || []).map((w) => `W${w.week_number}`);\n  const plannedSeries = (weeklyData.planned || []).map((w) => w.cumulative_percent);\n  const actualSeries = (weeklyData.actual || []).map((w) => w.cumulative_percent);\n  const acSeries = actualSeries.length\n    ? actualSeries\n    : (weeklyData.earned || []).map((w) => w.cumulative_percent);\n  const varianceSeries = plannedSeries.map((value, index) =>\n    Number(((acSeries[index] || actualSeries[index] || 0) - (value || 0)).toFixed(2))\n  );\n\n  const details = {\n    totalCost: summary?.total_project_cost || 0,\n    plannedCost: summary?.planned_cost || 0,\n    actualCost: summary?.actual_cost || 0,\n    weeks: weeklyData.planned || [],\n    actualWeeks: weeklyData.actual || [],\n    viewMode: 'cost',\n  };\n  const weeklySummary = buildCostWeeklySummary(\n    weeklyData.planned || [],\n    weeklyData.actual || [],\n    details.totalCost,\n    labels\n  );\n\n  console.log(LOG_PREFIX, 'Cost dataset built:', {\n    labels: labels.length,\n    plannedPoints: plannedSeries.length,\n    actualPoints: actualSeries.length,\n    totalCost: formatRupiah(details.totalCost),\n  });\n\n  return ensureWeekZeroDataset({\n    labels,\n    planned: plannedSeries,\n    actual: actualSeries,\n    acSeries,\n    varianceSeries,\n    varianceCostSeries: weeklySummary.map((entry) => entry.varianceCostValue || 0),\n    details: {\n      ...details,\n      weeklySummary,\n    },\n    totalBiaya: details.totalCost,\n    useHargaCalculation: true,\n    viewMode: 'cost',\n  });\n}\n\nfunction generateLabels(columns) {\n  return columns.map((col, index) => {\n    const label =\n      col?.label ||\n      col?.displayLabel ||\n      col?.display_name ||\n      col?.name ||\n      `Week ${index + 1}`;\n\n    if (col?.start_date && col?.end_date) {\n      return `${label} (${col.start_date} - ${col.end_date})`;\n    }\n\n    return label;\n  });\n}\n\nfunction calculatePlannedCurve(\n  columns,\n  volumeLookup,\n  hargaLookup,\n  cellValues,\n  totalValue,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const plannedTotals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    if (!columnIndexById.has(columnId)) {\n      return;\n    }\n\n    const columnIndex = columnIndexById.get(columnId);\n    if (columnIndex === undefined) {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      plannedTotals[columnIndex] += kontribusi;\n    }\n  });\n\n  let cumulative = 0;\n  return plannedTotals.map((value) => {\n    cumulative += value;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction calculateColumnTotals(\n  columns,\n  cellValues,\n  volumeLookup,\n  hargaLookup,\n  columnIndexById,\n  useHargaCalculation\n) {\n  const totals = Array(columns.length).fill(0);\n\n  cellValues.forEach((value, cellKey) => {\n    const [pekerjaanId, columnId] = cellKey.split('-');\n    const columnIndex = columnIndexById.get(columnId);\n    if (typeof columnIndex === 'undefined') {\n      return;\n    }\n\n    const numericValue = Number(value) || 0;\n\n    if (useHargaCalculation) {\n      const biaya = getHargaForPekerjaan(hargaLookup, pekerjaanId, 0);\n      const kontribusi = (biaya * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    } else {\n      const volume = getVolumeForPekerjaan(volumeLookup, pekerjaanId, 1);\n      const kontribusi = (volume * numericValue) / 100;\n      totals[columnIndex] += kontribusi;\n    }\n  });\n\n  return totals;\n}\n\nfunction calculateActualCurve(columns, columnTotals, totalValue, useHargaCalculation) {\n  let cumulative = 0;\n  return columns.map((_, index) => {\n    cumulative += columnTotals[index] || 0;\n    if (!Number.isFinite(totalValue) || totalValue <= 0) {\n      return 0;\n    }\n    return Number(((cumulative / totalValue) * 100).toFixed(2));\n  });\n}\n\nfunction buildDetailData(\n  columns,\n  labels,\n  plannedSeries,\n  actualSeries,\n  totalValue = 0,\n  useHargaCalculation = false\n) {\n  return columns.map((column, index) => {\n    const label = labels[index] || `Week ${index + 1}`;\n\n    // Cumulative values\n    const plannedCumulative = plannedSeries[index] || 0;\n    const actualCumulative = actualSeries[index] || 0;\n\n    // AUDIT FIX: Calculate WEEK progress (this week only, not cumulative)\n    // Week progress = cumulative[i] - cumulative[i-1]\n    const prevPlannedCumulative = index > 0 ? (plannedSeries[index - 1] || 0) : 0;\n    const prevActualCumulative = index > 0 ? (actualSeries[index - 1] || 0) : 0;\n    const plannedWeekProgress = Number((plannedCumulative - prevPlannedCumulative).toFixed(2));\n    const actualWeekProgress = Number((actualCumulative - prevActualCumulative).toFixed(2));\n\n    const variance = Number((actualCumulative - plannedCumulative).toFixed(2));\n    let plannedCostValue = null;\n    let actualCostValue = null;\n    let varianceCostValue = null;\n    if (useHargaCalculation) {\n      plannedCostValue = Number(((plannedCumulative / 100) * (totalValue || 0)).toFixed(2));\n      actualCostValue = Number(((actualCumulative / 100) * (totalValue || 0)).toFixed(2));\n      varianceCostValue = Number(((actualCostValue - plannedCostValue)).toFixed(2));\n    }\n\n    return {\n      label,\n      // Cumulative progress (for chart Y position)\n      planned: plannedCumulative,\n      actual: actualCumulative,\n      // AUDIT FIX: Week-only progress (for tooltip display)\n      plannedWeekProgress,\n      actualWeekProgress,\n      variance,\n      start: normalizeDate(column?.startDate || column?.start_date || column?.start),\n      end: normalizeDate(column?.endDate || column?.end_date || column?.end),\n      metadata: column,\n      plannedCostValue,\n      actualCostValue,\n      varianceCostValue,\n      // AUDIT FIX: Include weekNumber for correct tooltip display\n      weekNumber: column?.weekNumber || column?.week_number || index + 1,\n    };\n  });\n}\n\nfunction buildCostWeeklySummary(plannedWeeks = [], actualWeeks = [], totalCost = 0, labels = []) {\n  const maxLength = Math.max(plannedWeeks.length, actualWeeks.length, labels.length);\n  const summary = [];\n  for (let index = 0; index < maxLength; index += 1) {\n    const plannedEntry = plannedWeeks[index] || {};\n    const actualEntry = actualWeeks[index] || {};\n    const label =\n      labels[index] ||\n      plannedEntry.label ||\n      actualEntry.label ||\n      `W${plannedEntry.week_number || actualEntry.week_number || index + 1}`;\n    const plannedPercent = Number(\n      plannedEntry.cumulative_percent ??\n      plannedEntry.percent ??\n      plannedEntry.value ??\n      plannedEntry.cumulative ??\n      0\n    );\n    const actualPercent = Number(\n      actualEntry.cumulative_percent ??\n      actualEntry.percent ??\n      actualEntry.value ??\n      actualEntry.cumulative ??\n      0\n    );\n    const plannedCostValue = resolveCostValue(plannedEntry, plannedPercent, totalCost);\n    const actualCostValue = resolveCostValue(actualEntry, actualPercent, totalCost);\n    const variancePercent = Number(((actualPercent - plannedPercent)).toFixed(2));\n    const varianceCostValue = Number((actualCostValue - plannedCostValue).toFixed(2));\n\n    summary.push({\n      label,\n      weekNumber: plannedEntry.week_number ?? actualEntry.week_number ?? index + 1,\n      plannedPercent: Number.isFinite(plannedPercent) ? plannedPercent : 0,\n      actualPercent: Number.isFinite(actualPercent) ? actualPercent : 0,\n      plannedCostValue,\n      actualCostValue,\n      variancePercent,\n      varianceCostValue,\n      range: {\n        start: normalizeDate(\n          plannedEntry.week_start ||\n          plannedEntry.start_date ||\n          actualEntry.week_start ||\n          actualEntry.start_date\n        ),\n        end: normalizeDate(\n          plannedEntry.week_end || plannedEntry.end_date || actualEntry.week_end || actualEntry.end_date\n        ),\n      },\n    });\n  }\n  return summary;\n}\n\nfunction resolveCostValue(weekEntry, percent, totalCost) {\n  const numericPercent = Number(\n    percent ??\n    weekEntry?.cumulative_percent ??\n    weekEntry?.percent ??\n    weekEntry?.value ??\n    0\n  );\n  const cumulative = toNumber(\n    weekEntry?.cumulative_cost ??\n    weekEntry?.cumulative ??\n    weekEntry?.accumulated_cost ??\n    weekEntry?.acc_cost\n  );\n  if (Number.isFinite(cumulative) && cumulative > 0) {\n    return cumulative;\n  }\n  const singleCost = toNumber(weekEntry?.cost);\n  if (Number.isFinite(singleCost) && singleCost > 0 && !weekEntry?.cumulative_cost) {\n    return singleCost;\n  }\n  if (!Number.isFinite(totalCost) || totalCost <= 0) {\n    return 0;\n  }\n  return Number((((numericPercent || 0) / 100) * totalCost).toFixed(2));\n}\n\nfunction toNumber(value) {\n  if (typeof value === 'number') {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const parsed = Number(value);\n    return Number.isFinite(parsed) ? parsed : NaN;\n  }\n  return NaN;\n}\n","/**\r\n * UX Enhancements Module\r\n * Provides keyboard shortcuts, ripple effects, and other UX improvements\r\n * @module ux-enhancements\r\n */\r\n\r\n/**\r\n * Keyboard Shortcuts Manager\r\n */\r\nexport class KeyboardShortcuts {\r\n  constructor() {\r\n    this.shortcuts = new Map();\r\n    this.enabled = true;\r\n    this._boundHandler = this._handleKeyDown.bind(this);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    document.addEventListener('keydown', this._boundHandler);\r\n    console.log('âŒ¨ï¸ Keyboard shortcuts initialized');\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * @param {string} key - Key combination (e.g., 'ctrl+s', 'alt+p')\r\n   * @param {Function} callback - Function to call when shortcut triggered\r\n   * @param {Object} options - Additional options\r\n   */\r\n  register(key, callback, options = {}) {\r\n    const { description = '', preventDefault = true } = options;\r\n\r\n    this.shortcuts.set(key.toLowerCase(), {\r\n      callback,\r\n      description,\r\n      preventDefault\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unregister a keyboard shortcut\r\n   */\r\n  unregister(key) {\r\n    this.shortcuts.delete(key.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  _handleKeyDown(event) {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input/textarea\r\n    const activeElement = document.activeElement;\r\n    const isInput = activeElement.tagName === 'INPUT' ||\r\n                   activeElement.tagName === 'TEXTAREA' ||\r\n                   activeElement.isContentEditable;\r\n\r\n    // Build key combination string\r\n    const parts = [];\r\n    if (event.ctrlKey) parts.push('ctrl');\r\n    if (event.altKey) parts.push('alt');\r\n    if (event.shiftKey) parts.push('shift');\r\n    if (event.metaKey) parts.push('meta');\r\n\r\n    const key = event.key.toLowerCase();\r\n    if (!['control', 'alt', 'shift', 'meta'].includes(key)) {\r\n      parts.push(key);\r\n    }\r\n\r\n    const combo = parts.join('+');\r\n    const shortcut = this.shortcuts.get(combo);\r\n\r\n    if (shortcut) {\r\n      // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X in inputs\r\n      const allowedInInput = ['ctrl+a', 'ctrl+c', 'ctrl+v', 'ctrl+x', 'ctrl+z'];\r\n      if (isInput && !allowedInInput.includes(combo)) {\r\n        return;\r\n      }\r\n\r\n      if (shortcut.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      shortcut.callback(event);\r\n      console.log(`âŒ¨ï¸ Shortcut triggered: ${combo}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable shortcuts\r\n   */\r\n  enable() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * Disable shortcuts\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getShortcuts() {\r\n    return Array.from(this.shortcuts.entries()).map(([key, data]) => ({\r\n      key,\r\n      description: data.description\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    document.removeEventListener('keydown', this._boundHandler);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n/**\r\n * Ripple Effect Manager\r\n */\r\nexport class RippleEffect {\r\n  /**\r\n   * Add ripple effect to element\r\n   * @param {HTMLElement} element - Target element\r\n   */\r\n  static add(element) {\r\n    if (!element) return;\r\n\r\n    element.classList.add('btn-ripple');\r\n\r\n    // Optional: Add click listener for more control\r\n    element.addEventListener('click', function(e) {\r\n      const ripple = document.createElement('span');\r\n      ripple.classList.add('ripple-circle');\r\n\r\n      const rect = this.getBoundingClientRect();\r\n      const size = Math.max(rect.width, rect.height);\r\n      const x = e.clientX - rect.left - size / 2;\r\n      const y = e.clientY - rect.top - size / 2;\r\n\r\n      ripple.style.width = ripple.style.height = size + 'px';\r\n      ripple.style.left = x + 'px';\r\n      ripple.style.top = y + 'px';\r\n\r\n      this.appendChild(ripple);\r\n\r\n      setTimeout(() => ripple.remove(), 600);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add ripple to multiple elements\r\n   * @param {string} selector - CSS selector\r\n   */\r\n  static addToAll(selector) {\r\n    document.querySelectorAll(selector).forEach(el => {\r\n      RippleEffect.add(el);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Button State Manager\r\n */\r\nexport class ButtonStateManager {\r\n  /**\r\n   * Set button to loading state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {string} loadingText - Optional loading text\r\n   */\r\n  static setLoading(button, loadingText = 'Loading...') {\r\n    if (!button) return;\r\n\r\n    button.dataset.originalText = button.innerHTML;\r\n    button.disabled = true;\r\n    button.classList.add('loading');\r\n\r\n    const spinner = '<span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>';\r\n    button.innerHTML = spinner + loadingText;\r\n  }\r\n\r\n  /**\r\n   * Set button to success state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show success state (ms)\r\n   */\r\n  static setSuccess(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('success');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('success');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Set button to error state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show error state (ms)\r\n   */\r\n  static setError(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('error');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Reset button to normal state\r\n   * @param {HTMLElement} button - Button element\r\n   */\r\n  static reset(button) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading', 'success', 'error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark button with \"has changes\" indicator\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} hasChanges - Whether there are unsaved changes\r\n   */\r\n  static markChanges(button, hasChanges) {\r\n    if (!button) return;\r\n\r\n    if (hasChanges) {\r\n      button.classList.add('has-changes');\r\n      button.setAttribute('data-tooltip', 'You have unsaved changes');\r\n    } else {\r\n      button.classList.remove('has-changes');\r\n      button.removeAttribute('data-tooltip');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toast Notifications (wrapper untuk DP.core.toast)\r\n */\r\nexport class Toast {\r\n  /**\r\n   * Show success toast\r\n   */\r\n  static success(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'success', duration);\r\n    } else {\r\n      console.log(`âœ… ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error toast\r\n   */\r\n  static error(message, duration = 3000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'danger', duration);\r\n    } else {\r\n      console.error(`âŒ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show warning toast\r\n   */\r\n  static warning(message, duration = 2000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'warning', duration);\r\n    } else {\r\n      console.warn(`âš ï¸ ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show info toast\r\n   */\r\n  static info(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'info', duration);\r\n    } else {\r\n      console.info(`â„¹ï¸ ${message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Smooth Scroll Helper\r\n */\r\nexport class SmoothScroll {\r\n  /**\r\n   * Scroll to element smoothly\r\n   * @param {HTMLElement|string} target - Element or selector\r\n   * @param {Object} options - Scroll options\r\n   */\r\n  static to(target, options = {}) {\r\n    const element = typeof target === 'string'\r\n      ? document.querySelector(target)\r\n      : target;\r\n\r\n    if (!element) return;\r\n\r\n    const {\r\n      offset = 0,\r\n      behavior = 'smooth',\r\n      block = 'start'\r\n    } = options;\r\n\r\n    const elementPosition = element.getBoundingClientRect().top;\r\n    const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n    window.scrollTo({\r\n      top: offsetPosition,\r\n      behavior\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Scroll to top\r\n   */\r\n  static toTop() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      behavior: 'smooth'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce utility\r\n */\r\nexport function debounce(func, wait = 300) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle utility\r\n */\r\nexport function throttle(func, limit = 100) {\r\n  let inThrottle;\r\n  return function executedFunction(...args) {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize all UX enhancements\r\n */\r\nexport function initializeUXEnhancements() {\r\n  console.log('ðŸŽ¨ Initializing UX enhancements...');\r\n\r\n  // Add ripple effects to all primary buttons\r\n  RippleEffect.addToAll('.btn-primary, .btn-save, .btn-danger');\r\n\r\n  // Add tooltips to buttons with title attribute\r\n  document.querySelectorAll('button[title]').forEach(btn => {\r\n    if (!btn.hasAttribute('data-tooltip')) {\r\n      btn.setAttribute('data-tooltip', btn.getAttribute('title'));\r\n    }\r\n  });\r\n\r\n  console.log('âœ… UX enhancements initialized');\r\n}\r\n\r\n/**\r\n * Default export\r\n */\r\nexport default {\r\n  KeyboardShortcuts,\r\n  RippleEffect,\r\n  ButtonStateManager,\r\n  Toast,\r\n  SmoothScroll,\r\n  debounce,\r\n  throttle,\r\n  initializeUXEnhancements\r\n};\r\n","/**\n* Copyright (c) 2025, Leon Sorokin\n* All rights reserved. (MIT Licensed)\n*\n* uPlot.js (Î¼Plot)\n* A small, fast chart for time series, lines, areas, ohlc & bars\n* https://github.com/leeoniya/uPlot (v1.6.32)\n*/\n\nconst FEAT_TIME          = true;\n\nconst pre = \"u-\";\n\nconst UPLOT          =       \"uplot\";\nconst ORI_HZ         = pre + \"hz\";\nconst ORI_VT         = pre + \"vt\";\nconst TITLE          = pre + \"title\";\nconst WRAP           = pre + \"wrap\";\nconst UNDER          = pre + \"under\";\nconst OVER           = pre + \"over\";\nconst AXIS           = pre + \"axis\";\nconst OFF            = pre + \"off\";\nconst SELECT         = pre + \"select\";\nconst CURSOR_X       = pre + \"cursor-x\";\nconst CURSOR_Y       = pre + \"cursor-y\";\nconst CURSOR_PT      = pre + \"cursor-pt\";\nconst LEGEND         = pre + \"legend\";\nconst LEGEND_LIVE    = pre + \"live\";\nconst LEGEND_INLINE  = pre + \"inline\";\nconst LEGEND_SERIES  = pre + \"series\";\nconst LEGEND_MARKER  = pre + \"marker\";\nconst LEGEND_LABEL   = pre + \"label\";\nconst LEGEND_VALUE   = pre + \"value\";\n\nconst WIDTH       = \"width\";\nconst HEIGHT      = \"height\";\nconst TOP         = \"top\";\nconst BOTTOM      = \"bottom\";\nconst LEFT        = \"left\";\nconst RIGHT       = \"right\";\nconst hexBlack    = \"#000\";\nconst transparent = hexBlack + \"0\";\n\nconst mousemove   = \"mousemove\";\nconst mousedown   = \"mousedown\";\nconst mouseup     = \"mouseup\";\nconst mouseenter  = \"mouseenter\";\nconst mouseleave  = \"mouseleave\";\nconst dblclick    = \"dblclick\";\nconst resize      = \"resize\";\nconst scroll      = \"scroll\";\n\nconst change      = \"change\";\nconst dppxchange  = \"dppxchange\";\n\nconst LEGEND_DISP = \"--\";\n\nconst domEnv = typeof window != 'undefined';\n\nconst doc = domEnv ? document  : null;\nconst win = domEnv ? window    : null;\nconst nav = domEnv ? navigator : null;\n\nlet pxRatio;\n\n//export const canHover = domEnv && !win.matchMedia('(hover: none)').matches;\n\nlet query;\n\nfunction setPxRatio() {\n\tlet _pxRatio = devicePixelRatio;\n\n\t// during print preview, Chrome fires off these dppx queries even without changes\n\tif (pxRatio != _pxRatio) {\n\t\tpxRatio = _pxRatio;\n\n\t\tquery && off(change, query, setPxRatio);\n\t\tquery = matchMedia(`(min-resolution: ${pxRatio - 0.001}dppx) and (max-resolution: ${pxRatio + 0.001}dppx)`);\n\t\ton(change, query, setPxRatio);\n\n\t\twin.dispatchEvent(new CustomEvent(dppxchange));\n\t}\n}\n\nfunction addClass(el, c) {\n\tif (c != null) {\n\t\tlet cl = el.classList;\n\t\t!cl.contains(c) && cl.add(c);\n\t}\n}\n\nfunction remClass(el, c) {\n\tlet cl = el.classList;\n\tcl.contains(c) && cl.remove(c);\n}\n\nfunction setStylePx(el, name, value) {\n\tel.style[name] = value + \"px\";\n}\n\nfunction placeTag(tag, cls, targ, refEl) {\n\tlet el = doc.createElement(tag);\n\n\tif (cls != null)\n\t\taddClass(el, cls);\n\n\tif (targ != null)\n\t\ttarg.insertBefore(el, refEl);\n\n\treturn el;\n}\n\nfunction placeDiv(cls, targ) {\n\treturn placeTag(\"div\", cls, targ);\n}\n\nconst xformCache = new WeakMap();\n\nfunction elTrans(el, xPos, yPos, xMax, yMax) {\n\tlet xform = \"translate(\" + xPos + \"px,\" + yPos + \"px)\";\n\tlet xformOld = xformCache.get(el);\n\n\tif (xform != xformOld) {\n\t\tel.style.transform = xform;\n\t\txformCache.set(el, xform);\n\n\t\tif (xPos < 0 || yPos < 0 || xPos > xMax || yPos > yMax)\n\t\t\taddClass(el, OFF);\n\t\telse\n\t\t\tremClass(el, OFF);\n\t}\n}\n\nconst colorCache = new WeakMap();\n\nfunction elColor(el, background, borderColor) {\n\tlet newColor = background + borderColor;\n\tlet oldColor = colorCache.get(el);\n\n\tif (newColor != oldColor) {\n\t\tcolorCache.set(el, newColor);\n\t\tel.style.background = background;\n\t\tel.style.borderColor = borderColor;\n\t}\n}\n\nconst sizeCache = new WeakMap();\n\nfunction elSize(el, newWid, newHgt, centered) {\n\tlet newSize = newWid + \"\" + newHgt;\n\tlet oldSize = sizeCache.get(el);\n\n\tif (newSize != oldSize) {\n\t\tsizeCache.set(el, newSize);\n\t\tel.style.height = newHgt + \"px\";\n\t\tel.style.width = newWid + \"px\";\n\t\tel.style.marginLeft = centered ? -newWid/2 + \"px\" : 0;\n\t\tel.style.marginTop = centered ? -newHgt/2 + \"px\" : 0;\n\t}\n}\n\nconst evOpts = {passive: true};\nconst evOpts2 = {...evOpts, capture: true};\n\nfunction on(ev, el, cb, capt) {\n\tel.addEventListener(ev, cb, capt ? evOpts2 : evOpts);\n}\n\nfunction off(ev, el, cb, capt) {\n\tel.removeEventListener(ev, cb, evOpts);\n}\n\ndomEnv && setPxRatio();\n\n// binary search for index of closest value\nfunction closestIdx(num, arr, lo, hi) {\n\tlet mid;\n\tlo = lo || 0;\n\thi = hi || arr.length - 1;\n\tlet bitwise = hi <= 2147483647;\n\n\twhile (hi - lo > 1) {\n\t\tmid = bitwise ? (lo + hi) >> 1 : floor((lo + hi) / 2);\n\n\t\tif (arr[mid] < num)\n\t\t\tlo = mid;\n\t\telse\n\t\t\thi = mid;\n\t}\n\n\tif (num - arr[lo] <= arr[hi] - num)\n\t\treturn lo;\n\n\treturn hi;\n}\n\nfunction makeIndexOfs(predicate) {\n\t let indexOfs = (data, _i0, _i1) => {\n\t\tlet i0 = -1;\n\t\tlet i1 = -1;\n\n\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti0 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = _i1; i >= _i0; i--) {\n\t\t\tif (predicate(data[i])) {\n\t\t\t\ti1 = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn [i0, i1];\n\t };\n\n\t return indexOfs;\n}\n\nconst notNullish = v => v != null;\nconst isPositive = v => v != null && v > 0;\n\nconst nonNullIdxs = makeIndexOfs(notNullish);\nconst positiveIdxs = makeIndexOfs(isPositive);\n\nfunction getMinMax(data, _i0, _i1, sorted = 0, log = false) {\n//\tconsole.log(\"getMinMax()\");\n\n\tlet getEdgeIdxs = log ? positiveIdxs : nonNullIdxs;\n\tlet predicate = log ? isPositive : notNullish;\n\n\t[_i0, _i1] = getEdgeIdxs(data, _i0, _i1);\n\n\tlet _min = data[_i0];\n\tlet _max = data[_i0];\n\n\tif (_i0 > -1) {\n\t\tif (sorted == 1) {\n\t\t\t_min = data[_i0];\n\t\t\t_max = data[_i1];\n\t\t}\n\t\telse if (sorted == -1) {\n\t\t\t_min = data[_i1];\n\t\t\t_max = data[_i0];\n\t\t}\n\t\telse {\n\t\t\tfor (let i = _i0; i <= _i1; i++) {\n\t\t\t\tlet v = data[i];\n\n\t\t\t\tif (predicate(v)) {\n\t\t\t\t\tif (v < _min)\n\t\t\t\t\t\t_min = v;\n\t\t\t\t\telse if (v > _max)\n\t\t\t\t\t\t_max = v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [_min ?? inf, _max ?? -inf]; // todo: fix to return nulls\n}\n\nfunction rangeLog(min, max, base, fullMags) {\n\tlet minSign = sign(min);\n\tlet maxSign = sign(max);\n\n\tif (min == max) {\n\t\tif (minSign == -1) {\n\t\t\tmin *= base;\n\t\t\tmax /= base;\n\t\t}\n\t\telse {\n\t\t\tmin /= base;\n\t\t\tmax *= base;\n\t\t}\n\t}\n\n\tlet logFn = base == 10 ? log10 : log2;\n\n\tlet growMinAbs = minSign == 1 ? floor : ceil;\n\tlet growMaxAbs = maxSign == 1 ? ceil : floor;\n\n\tlet minExp = growMinAbs(logFn(abs(min)));\n\tlet maxExp = growMaxAbs(logFn(abs(max)));\n\n\tlet minIncr = pow(base, minExp);\n\tlet maxIncr = pow(base, maxExp);\n\n\t// fix values like Math.pow(10, -5) === 0.000009999999999999999\n\tif (base == 10) {\n\t\tif (minExp < 0)\n\t\t\tminIncr = roundDec(minIncr, -minExp);\n\t\tif (maxExp < 0)\n\t\t\tmaxIncr = roundDec(maxIncr, -maxExp);\n\t}\n\n\tif (fullMags || base == 2) {\n\t\tmin = minIncr * minSign;\n\t\tmax = maxIncr * maxSign;\n\t}\n\telse {\n\t\tmin = incrRoundDn(min, minIncr);\n\t\tmax = incrRoundUp(max, maxIncr);\n\t}\n\n\treturn [min, max];\n}\n\nfunction rangeAsinh(min, max, base, fullMags) {\n\tlet minMax = rangeLog(min, max, base, fullMags);\n\n\tif (min == 0)\n\t\tminMax[0] = 0;\n\n\tif (max == 0)\n\t\tminMax[1] = 0;\n\n\treturn minMax;\n}\n\nconst rangePad = 0.1;\n\nconst autoRangePart = {\n\tmode: 3,\n\tpad: rangePad,\n};\n\nconst _eqRangePart = {\n\tpad:  0,\n\tsoft: null,\n\tmode: 0,\n};\n\nconst _eqRange = {\n\tmin: _eqRangePart,\n\tmax: _eqRangePart,\n};\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction rangeNum(_min, _max, mult, extra) {\n\tif (isObj(mult))\n\t\treturn _rangeNum(_min, _max, mult);\n\n\t_eqRangePart.pad  = mult;\n\t_eqRangePart.soft = extra ? 0 : null;\n\t_eqRangePart.mode = extra ? 3 : 0;\n\n\treturn _rangeNum(_min, _max, _eqRange);\n}\n\n// nullish coalesce\nfunction ifNull(lh, rh) {\n\treturn lh == null ? rh : lh;\n}\n\n// checks if given index range in an array contains a non-null value\n// aka a range-bounded Array.some()\nfunction hasData(data, idx0, idx1) {\n\tidx0 = ifNull(idx0, 0);\n\tidx1 = ifNull(idx1, data.length - 1);\n\n\twhile (idx0 <= idx1) {\n\t\tif (data[idx0] != null)\n\t\t\treturn true;\n\t\tidx0++;\n\t}\n\n\treturn false;\n}\n\nfunction _rangeNum(_min, _max, cfg) {\n\tlet cmin = cfg.min;\n\tlet cmax = cfg.max;\n\n\tlet padMin = ifNull(cmin.pad, 0);\n\tlet padMax = ifNull(cmax.pad, 0);\n\n\tlet hardMin = ifNull(cmin.hard, -inf);\n\tlet hardMax = ifNull(cmax.hard,  inf);\n\n\tlet softMin = ifNull(cmin.soft,  inf);\n\tlet softMax = ifNull(cmax.soft, -inf);\n\n\tlet softMinMode = ifNull(cmin.mode, 0);\n\tlet softMaxMode = ifNull(cmax.mode, 0);\n\n\tlet delta = _max - _min;\n\tlet deltaMag = log10(delta);\n\n\tlet scalarMax = max(abs(_min), abs(_max));\n\tlet scalarMag = log10(scalarMax);\n\n\tlet scalarMagDelta = abs(scalarMag - deltaMag);\n\n\t// this handles situations like 89.7, 89.69999999999999\n\t// by assuming 0.001x deltas are precision errors\n//\tif (delta > 0 && delta < abs(_max) / 1e3)\n//\t\tdelta = 0;\n\n\t// treat data as flat if delta is less than 1e-24\n\t// or range is 11+ orders of magnitude below raw values, e.g. 99999999.99999996 - 100000000.00000004\n\tif (delta < 1e-24 || scalarMagDelta > 10) {\n\t\tdelta = 0;\n\n\t\t// if soft mode is 2 and all vals are flat at 0, avoid the 0.1 * 1e3 fallback\n\t\t// this prevents 0,0,0 from ranging to -100,100 when softMin/softMax are -1,1\n\t\tif (_min == 0 || _max == 0) {\n\t\t\tdelta = 1e-24;\n\n\t\t\tif (softMinMode == 2 && softMin != inf)\n\t\t\t\tpadMin = 0;\n\n\t\t\tif (softMaxMode == 2 && softMax != -inf)\n\t\t\t\tpadMax = 0;\n\t\t}\n\t}\n\n\tlet nonZeroDelta = delta || scalarMax || 1e3;\n\tlet mag          = log10(nonZeroDelta);\n\tlet base         = pow(10, floor(mag));\n\n\tlet _padMin  = nonZeroDelta * (delta == 0 ? (_min == 0 ? .1 : 1) : padMin);\n\tlet _newMin  = roundDec(incrRoundDn(_min - _padMin, base/10), 24);\n\tlet _softMin = _min >= softMin && (softMinMode == 1 || softMinMode == 3 && _newMin <= softMin || softMinMode == 2 && _newMin >= softMin) ? softMin : inf;\n\tlet minLim   = max(hardMin, _newMin < _softMin && _min >= _softMin ? _softMin : min(_softMin, _newMin));\n\n\tlet _padMax  = nonZeroDelta * (delta == 0 ? (_max == 0 ? .1 : 1) : padMax);\n\tlet _newMax  = roundDec(incrRoundUp(_max + _padMax, base/10), 24);\n\tlet _softMax = _max <= softMax && (softMaxMode == 1 || softMaxMode == 3 && _newMax >= softMax || softMaxMode == 2 && _newMax <= softMax) ? softMax : -inf;\n\tlet maxLim   = min(hardMax, _newMax > _softMax && _max <= _softMax ? _softMax : max(_softMax, _newMax));\n\n\tif (minLim == maxLim && minLim == 0)\n\t\tmaxLim = 100;\n\n\treturn [minLim, maxLim];\n}\n\n// alternative: https://stackoverflow.com/a/2254896\nconst numFormatter = new Intl.NumberFormat(domEnv ? nav.language : 'en-US');\nconst fmtNum = val => numFormatter.format(val);\n\nconst M = Math;\n\nconst PI = M.PI;\nconst abs = M.abs;\nconst floor = M.floor;\nconst round = M.round;\nconst ceil = M.ceil;\nconst min = M.min;\nconst max = M.max;\nconst pow = M.pow;\nconst sign = M.sign;\nconst log10 = M.log10;\nconst log2 = M.log2;\n// TODO: seems like this needs to match asinh impl if the passed v is tweaked?\nconst sinh =  (v, linthresh = 1) => M.sinh(v) * linthresh;\nconst asinh = (v, linthresh = 1) => M.asinh(v / linthresh);\n\nconst inf = Infinity;\n\nfunction numIntDigits(x) {\n\treturn (log10((x ^ (x >> 31)) - (x >> 31)) | 0) + 1;\n}\n\nfunction clamp(num, _min, _max) {\n\treturn min(max(num, _min), _max);\n}\n\nfunction isFn(v) {\n\treturn typeof v == \"function\";\n}\n\nfunction fnOrSelf(v) {\n\treturn isFn(v) ? v : () => v;\n}\n\nconst noop = () => {};\n\n// note: these identity fns may get deoptimized if reused for different arg types\n// a TS version would enforce they stay monotyped and require making variants\nconst retArg0 = _0 => _0;\n\nconst retArg1 = (_0, _1) => _1;\n\nconst retNull = _ => null;\n\nconst retTrue = _ => true;\n\nconst retEq = (a, b) => a == b;\n\nconst regex6 = /\\.\\d*?(?=9{6,}|0{6,})/gm;\n\n// e.g. 17999.204999999998 -> 17999.205\nconst fixFloat = val => {\n\tif (isInt(val) || fixedDec.has(val))\n\t\treturn val;\n\n\tconst str = `${val}`;\n\n\tconst match = str.match(regex6);\n\n\tif (match == null)\n\t\treturn val;\n\n\tlet len = match[0].length - 1;\n\n\t// e.g. 1.0000000000000001e-24\n\tif (str.indexOf('e-') != -1) {\n\t\tlet [num, exp] = str.split('e');\n\t\treturn +`${fixFloat(num)}e${exp}`;\n\t}\n\n\treturn roundDec(val, len);\n};\n\nfunction incrRound(num, incr) {\n\treturn fixFloat(roundDec(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundUp(num, incr) {\n\treturn fixFloat(ceil(fixFloat(num/incr))*incr);\n}\n\nfunction incrRoundDn(num, incr) {\n\treturn fixFloat(floor(fixFloat(num/incr))*incr);\n}\n\n// https://stackoverflow.com/a/48764436\n// rounds half away from zero\nfunction roundDec(val, dec = 0) {\n\tif (isInt(val))\n\t\treturn val;\n//\telse if (dec == 0)\n//\t\treturn round(val);\n\n\tlet p = 10 ** dec;\n\tlet n = (val * p) * (1 + Number.EPSILON);\n\treturn round(n) / p;\n}\n\nconst fixedDec = new Map();\n\nfunction guessDec(num) {\n\treturn ((\"\"+num).split(\".\")[1] || \"\").length;\n}\n\nfunction genIncrs(base, minExp, maxExp, mults) {\n\tlet incrs = [];\n\n\tlet multDec = mults.map(guessDec);\n\n\tfor (let exp = minExp; exp < maxExp; exp++) {\n\t\tlet expa = abs(exp);\n\t\tlet mag = roundDec(pow(base, exp), expa);\n\n\t\tfor (let i = 0; i < mults.length; i++) {\n\t\t\tlet _incr = base == 10 ? +`${mults[i]}e${exp}` : mults[i] * mag;\n\t\t\tlet dec = (exp >= 0 ? 0 : expa) + (exp >= multDec[i] ? 0 : multDec[i]);\n\t\t\tlet incr = base == 10 ? _incr : roundDec(_incr, dec);\n\t\t\tincrs.push(incr);\n\t\t\tfixedDec.set(incr, dec);\n\t\t}\n\t}\n\n\treturn incrs;\n}\n\n//export const assign = Object.assign;\n\nconst EMPTY_OBJ = {};\nconst EMPTY_ARR = [];\n\nconst nullNullTuple = [null, null];\n\nconst isArr = Array.isArray;\nconst isInt = Number.isInteger;\nconst isUndef = v => v === void 0;\n\nfunction isStr(v) {\n\treturn typeof v == 'string';\n}\n\nfunction isObj(v) {\n\tlet is = false;\n\n\tif (v != null) {\n\t\tlet c = v.constructor;\n\t\tis = c == null || c == Object;\n\t}\n\n\treturn is;\n}\n\nfunction fastIsObj(v) {\n\treturn v != null && typeof v == 'object';\n}\n\nconst TypedArray = Object.getPrototypeOf(Uint8Array);\n\nconst __proto__ = \"__proto__\";\n\nfunction copy(o, _isObj = isObj) {\n\tlet out;\n\n\tif (isArr(o)) {\n\t\tlet val = o.find(v => v != null);\n\n\t\tif (isArr(val) || _isObj(val)) {\n\t\t\tout = Array(o.length);\n\t\t\tfor (let i = 0; i < o.length; i++)\n\t\t\t\tout[i] = copy(o[i], _isObj);\n\t\t}\n\t\telse\n\t\t\tout = o.slice();\n\t}\n\telse if (o instanceof TypedArray) // also (ArrayBuffer.isView(o) && !(o instanceof DataView))\n\t\tout = o.slice();\n\telse if (_isObj(o)) {\n\t\tout = {};\n\t\tfor (let k in o) {\n\t\t\tif (k != __proto__)\n\t\t\t\tout[k] = copy(o[k], _isObj);\n\t\t}\n\t}\n\telse\n\t\tout = o;\n\n\treturn out;\n}\n\nfunction assign(targ) {\n\tlet args = arguments;\n\n\tfor (let i = 1; i < args.length; i++) {\n\t\tlet src = args[i];\n\n\t\tfor (let key in src) {\n\t\t\tif (key != __proto__) {\n\t\t\t\tif (isObj(targ[key]))\n\t\t\t\t\tassign(targ[key], copy(src[key]));\n\t\t\t\telse\n\t\t\t\t\ttarg[key] = copy(src[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn targ;\n}\n\n// nullModes\nconst NULL_REMOVE = 0;  // nulls are converted to undefined (e.g. for spanGaps: true)\nconst NULL_RETAIN = 1;  // nulls are retained, with alignment artifacts set to undefined (default)\nconst NULL_EXPAND = 2;  // nulls are expanded to include any adjacent alignment artifacts\n\n// sets undefined values to nulls when adjacent to existing nulls (minesweeper)\nfunction nullExpand(yVals, nullIdxs, alignedLen) {\n\tfor (let i = 0, xi, lastNullIdx = -1; i < nullIdxs.length; i++) {\n\t\tlet nullIdx = nullIdxs[i];\n\n\t\tif (nullIdx > lastNullIdx) {\n\t\t\txi = nullIdx - 1;\n\t\t\twhile (xi >= 0 && yVals[xi] == null)\n\t\t\t\tyVals[xi--] = null;\n\n\t\t\txi = nullIdx + 1;\n\t\t\twhile (xi < alignedLen && yVals[xi] == null)\n\t\t\t\tyVals[lastNullIdx = xi++] = null;\n\t\t}\n\t}\n}\n\n// nullModes is a tables-matched array indicating how to treat nulls in each series\n// output is sorted ASC on the joined field (table[0]) and duplicate join values are collapsed\nfunction join(tables, nullModes) {\n\tif (allHeadersSame(tables)) {\n\t//\tconsole.log('cheap join!');\n\n\t\tlet table = tables[0].slice();\n\n\t\tfor (let i = 1; i < tables.length; i++)\n\t\t\ttable.push(...tables[i].slice(1));\n\n\t\tif (!isAsc(table[0]))\n\t\t\ttable = sortCols(table);\n\n\t\treturn table;\n\t}\n\n\tlet xVals = new Set();\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\t\tlet len = xs.length;\n\n\t\tfor (let i = 0; i < len; i++)\n\t\t\txVals.add(xs[i]);\n\t}\n\n\tlet data = [Array.from(xVals).sort((a, b) => a - b)];\n\n\tlet alignedLen = data[0].length;\n\n\tlet xIdxs = new Map();\n\n\tfor (let i = 0; i < alignedLen; i++)\n\t\txIdxs.set(data[0][i], i);\n\n\tfor (let ti = 0; ti < tables.length; ti++) {\n\t\tlet t = tables[ti];\n\t\tlet xs = t[0];\n\n\t\tfor (let si = 1; si < t.length; si++) {\n\t\t\tlet ys = t[si];\n\n\t\t\tlet yVals = Array(alignedLen).fill(undefined);\n\n\t\t\tlet nullMode = nullModes ? nullModes[ti][si] : NULL_RETAIN;\n\n\t\t\tlet nullIdxs = [];\n\n\t\t\tfor (let i = 0; i < ys.length; i++) {\n\t\t\t\tlet yVal = ys[i];\n\t\t\t\tlet alignedIdx = xIdxs.get(xs[i]);\n\n\t\t\t\tif (yVal === null) {\n\t\t\t\t\tif (nullMode != NULL_REMOVE) {\n\t\t\t\t\t\tyVals[alignedIdx] = yVal;\n\n\t\t\t\t\t\tif (nullMode == NULL_EXPAND)\n\t\t\t\t\t\t\tnullIdxs.push(alignedIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tyVals[alignedIdx] = yVal;\n\t\t\t}\n\n\t\t\tnullExpand(yVals, nullIdxs, alignedLen);\n\n\t\t\tdata.push(yVals);\n\t\t}\n\t}\n\n\treturn data;\n}\n\nconst microTask = typeof queueMicrotask == \"undefined\" ? fn => Promise.resolve().then(fn) : queueMicrotask;\n\n// TODO: https://github.com/dy/sort-ids (~2x faster for 1e5+ arrays)\nfunction sortCols(table) {\n\tlet head = table[0];\n\tlet rlen = head.length;\n\n\tlet idxs = Array(rlen);\n\tfor (let i = 0; i < idxs.length; i++)\n\t\tidxs[i] = i;\n\n\tidxs.sort((i0, i1) => head[i0] - head[i1]);\n\n\tlet table2 = [];\n\tfor (let i = 0; i < table.length; i++) {\n\t\tlet row = table[i];\n\t\tlet row2 = Array(rlen);\n\n\t\tfor (let j = 0; j < rlen; j++)\n\t\t\trow2[j] = row[idxs[j]];\n\n\t\ttable2.push(row2);\n\t}\n\n\treturn table2;\n}\n\n// test if we can do cheap join (all join fields same)\nfunction allHeadersSame(tables) {\n\tlet vals0 = tables[0][0];\n\tlet len0 = vals0.length;\n\n\tfor (let i = 1; i < tables.length; i++) {\n\t\tlet vals1 = tables[i][0];\n\n\t\tif (vals1.length != len0)\n\t\t\treturn false;\n\n\t\tif (vals1 != vals0) {\n\t\t\tfor (let j = 0; j < len0; j++) {\n\t\t\t\tif (vals1[j] != vals0[j])\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction isAsc(vals, samples = 100) {\n\tconst len = vals.length;\n\n\t// empty or single value\n\tif (len <= 1)\n\t\treturn true;\n\n\t// skip leading & trailing nullish\n\tlet firstIdx = 0;\n\tlet lastIdx = len - 1;\n\n\twhile (firstIdx <= lastIdx && vals[firstIdx] == null)\n\t\tfirstIdx++;\n\n\twhile (lastIdx >= firstIdx && vals[lastIdx] == null)\n\t\tlastIdx--;\n\n\t// all nullish or one value surrounded by nullish\n\tif (lastIdx <= firstIdx)\n\t\treturn true;\n\n\tconst stride = max(1, floor((lastIdx - firstIdx + 1) / samples));\n\n\tfor (let prevVal = vals[firstIdx], i = firstIdx + stride; i <= lastIdx; i += stride) {\n\t\tconst v = vals[i];\n\n\t\tif (v != null) {\n\t\t\tif (v <= prevVal)\n\t\t\t\treturn false;\n\n\t\t\tprevVal = v;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nconst months = [\n\t\"January\",\n\t\"February\",\n\t\"March\",\n\t\"April\",\n\t\"May\",\n\t\"June\",\n\t\"July\",\n\t\"August\",\n\t\"September\",\n\t\"October\",\n\t\"November\",\n\t\"December\",\n];\n\nconst days = [\n\t\"Sunday\",\n\t\"Monday\",\n\t\"Tuesday\",\n\t\"Wednesday\",\n\t\"Thursday\",\n\t\"Friday\",\n\t\"Saturday\",\n];\n\nfunction slice3(str) {\n\treturn str.slice(0, 3);\n}\n\nconst days3 = days.map(slice3);\n\nconst months3 = months.map(slice3);\n\nconst engNames = {\n\tMMMM: months,\n\tMMM:  months3,\n\tWWWW: days,\n\tWWW:  days3,\n};\n\nfunction zeroPad2(int) {\n\treturn (int < 10 ? '0' : '') + int;\n}\n\nfunction zeroPad3(int) {\n\treturn (int < 10 ? '00' : int < 100 ? '0' : '') + int;\n}\n\n/*\nfunction suffix(int) {\n\tlet mod10 = int % 10;\n\n\treturn int + (\n\t\tmod10 == 1 && int != 11 ? \"st\" :\n\t\tmod10 == 2 && int != 12 ? \"nd\" :\n\t\tmod10 == 3 && int != 13 ? \"rd\" : \"th\"\n\t);\n}\n*/\n\nconst subs = {\n\t// 2019\n\tYYYY:\td => d.getFullYear(),\n\t// 19\n\tYY:\t\td => (d.getFullYear()+'').slice(2),\n\t// July\n\tMMMM:\t(d, names) => names.MMMM[d.getMonth()],\n\t// Jul\n\tMMM:\t(d, names) => names.MMM[d.getMonth()],\n\t// 07\n\tMM:\t\td => zeroPad2(d.getMonth()+1),\n\t// 7\n\tM:\t\td => d.getMonth()+1,\n\t// 09\n\tDD:\t\td => zeroPad2(d.getDate()),\n\t// 9\n\tD:\t\td => d.getDate(),\n\t// Monday\n\tWWWW:\t(d, names) => names.WWWW[d.getDay()],\n\t// Mon\n\tWWW:\t(d, names) => names.WWW[d.getDay()],\n\t// 03\n\tHH:\t\td => zeroPad2(d.getHours()),\n\t// 3\n\tH:\t\td => d.getHours(),\n\t// 9 (12hr, unpadded)\n\th:\t\td => {let h = d.getHours(); return h == 0 ? 12 : h > 12 ? h - 12 : h;},\n\t// AM\n\tAA:\t\td => d.getHours() >= 12 ? 'PM' : 'AM',\n\t// am\n\taa:\t\td => d.getHours() >= 12 ? 'pm' : 'am',\n\t// a\n\ta:\t\td => d.getHours() >= 12 ? 'p' : 'a',\n\t// 09\n\tmm:\t\td => zeroPad2(d.getMinutes()),\n\t// 9\n\tm:\t\td => d.getMinutes(),\n\t// 09\n\tss:\t\td => zeroPad2(d.getSeconds()),\n\t// 9\n\ts:\t\td => d.getSeconds(),\n\t// 374\n\tfff:\td => zeroPad3(d.getMilliseconds()),\n};\n\nfunction fmtDate(tpl, names) {\n\tnames = names || engNames;\n\tlet parts = [];\n\n\tlet R = /\\{([a-z]+)\\}|[^{]+/gi, m;\n\n\twhile (m = R.exec(tpl))\n\t\tparts.push(m[0][0] == '{' ? subs[m[1]] : m[0]);\n\n\treturn d => {\n\t\tlet out = '';\n\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t\tout += typeof parts[i] == \"string\" ? parts[i] : parts[i](d, names);\n\n\t\treturn out;\n\t}\n}\n\nconst localTz = new Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n// https://stackoverflow.com/questions/15141762/how-to-initialize-a-javascript-date-to-a-particular-time-zone/53652131#53652131\nfunction tzDate(date, tz) {\n\tlet date2;\n\n\t// perf optimization\n\tif (tz == 'UTC' || tz == 'Etc/UTC')\n\t\tdate2 = new Date(+date + date.getTimezoneOffset() * 6e4);\n\telse if (tz == localTz)\n\t\tdate2 = date;\n\telse {\n\t\tdate2 = new Date(date.toLocaleString('en-US', {timeZone: tz}));\n\t\tdate2.setMilliseconds(date.getMilliseconds());\n\t}\n\n\treturn date2;\n}\n\n//export const series = [];\n\n// default formatters:\n\nconst onlyWhole = v => v % 1 == 0;\n\nconst allMults = [1,2,2.5,5];\n\n// ...0.01, 0.02, 0.025, 0.05, 0.1, 0.2, 0.25, 0.5\nconst decIncrs = genIncrs(10, -32, 0, allMults);\n\n// 1, 2, 2.5, 5, 10, 20, 25, 50...\nconst oneIncrs = genIncrs(10, 0, 32, allMults);\n\n// 1, 2,      5, 10, 20, 25, 50...\nconst wholeIncrs = oneIncrs.filter(onlyWhole);\n\nconst numIncrs = decIncrs.concat(oneIncrs);\n\nconst NL = \"\\n\";\n\nconst yyyy    = \"{YYYY}\";\nconst NLyyyy  = NL + yyyy;\nconst md      = \"{M}/{D}\";\nconst NLmd    = NL + md;\nconst NLmdyy  = NLmd + \"/{YY}\";\n\nconst aa      = \"{aa}\";\nconst hmm     = \"{h}:{mm}\";\nconst hmmaa   = hmm + aa;\nconst NLhmmaa = NL + hmmaa;\nconst ss      = \":{ss}\";\n\nconst _ = null;\n\nfunction genTimeStuffs(ms) {\n\tlet\ts  = ms * 1e3,\n\t\tm  = s  * 60,\n\t\th  = m  * 60,\n\t\td  = h  * 24,\n\t\tmo = d  * 30,\n\t\ty  = d  * 365;\n\n\t// min of 1e-3 prevents setting a temporal x ticks too small since Date objects cannot advance ticks smaller than 1ms\n\tlet subSecIncrs = ms == 1 ? genIncrs(10, 0, 3, allMults).filter(onlyWhole) : genIncrs(10, -3, 0, allMults);\n\n\tlet timeIncrs = subSecIncrs.concat([\n\t\t// minute divisors (# of secs)\n\t\ts,\n\t\ts * 5,\n\t\ts * 10,\n\t\ts * 15,\n\t\ts * 30,\n\t\t// hour divisors (# of mins)\n\t\tm,\n\t\tm * 5,\n\t\tm * 10,\n\t\tm * 15,\n\t\tm * 30,\n\t\t// day divisors (# of hrs)\n\t\th,\n\t\th * 2,\n\t\th * 3,\n\t\th * 4,\n\t\th * 6,\n\t\th * 8,\n\t\th * 12,\n\t\t// month divisors TODO: need more?\n\t\td,\n\t\td * 2,\n\t\td * 3,\n\t\td * 4,\n\t\td * 5,\n\t\td * 6,\n\t\td * 7,\n\t\td * 8,\n\t\td * 9,\n\t\td * 10,\n\t\td * 15,\n\t\t// year divisors (# months, approx)\n\t\tmo,\n\t\tmo * 2,\n\t\tmo * 3,\n\t\tmo * 4,\n\t\tmo * 6,\n\t\t// century divisors\n\t\ty,\n\t\ty * 2,\n\t\ty * 5,\n\t\ty * 10,\n\t\ty * 25,\n\t\ty * 50,\n\t\ty * 100,\n\t]);\n\n\t// [0]:   minimum num secs in the tick incr\n\t// [1]:   default tick format\n\t// [2-7]: rollover tick formats\n\t// [8]:   mode: 0: replace [1] -> [2-7], 1: concat [1] + [2-7]\n\tconst _timeAxisStamps = [\n\t//   tick incr    default          year                    month   day                   hour    min       sec   mode\n\t\t[y,           yyyy,            _,                      _,      _,                    _,      _,        _,       1],\n\t\t[d * 28,      \"{MMM}\",         NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[d,           md,              NLyyyy,                 _,      _,                    _,      _,        _,       1],\n\t\t[h,           \"{h}\" + aa,      NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[m,           hmmaa,           NLmdyy,                 _,      NLmd,                 _,      _,        _,       1],\n\t\t[s,           ss,              NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t\t[ms,          ss + \".{fff}\",   NLmdyy + \" \" + hmmaa,   _,      NLmd + \" \" + hmmaa,   _,      NLhmmaa,  _,       1],\n\t];\n\n\t// the ensures that axis ticks, values & grid are aligned to logical temporal breakpoints and not an arbitrary timestamp\n\t// https://www.timeanddate.com/time/dst/\n\t// https://www.timeanddate.com/time/dst/2019.html\n\t// https://www.epochconverter.com/timezones\n\tfunction timeAxisSplits(tzDate) {\n\t\treturn (self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace) => {\n\t\t\tlet splits = [];\n\t\t\tlet isYr = foundIncr >= y;\n\t\t\tlet isMo = foundIncr >= mo && foundIncr < y;\n\n\t\t\t// get the timezone-adjusted date\n\t\t\tlet minDate = tzDate(scaleMin);\n\t\t\tlet minDateTs = roundDec(minDate * ms, 3);\n\n\t\t\t// get ts of 12am (this lands us at or before the original scaleMin)\n\t\t\tlet minMin = mkDate(minDate.getFullYear(), isYr ? 0 : minDate.getMonth(), isMo || isYr ? 1 : minDate.getDate());\n\t\t\tlet minMinTs = roundDec(minMin * ms, 3);\n\n\t\t\tif (isMo || isYr) {\n\t\t\t\tlet moIncr = isMo ? foundIncr / mo : 0;\n\t\t\t\tlet yrIncr = isYr ? foundIncr / y  : 0;\n\t\t\t//\tlet tzOffset = scaleMin - minDateTs;\t\t// needed?\n\t\t\t\tlet split = minDateTs == minMinTs ? minDateTs : roundDec(mkDate(minMin.getFullYear() + yrIncr, minMin.getMonth() + moIncr, 1) * ms, 3);\n\t\t\t\tlet splitDate = new Date(round(split / ms));\n\t\t\t\tlet baseYear = splitDate.getFullYear();\n\t\t\t\tlet baseMonth = splitDate.getMonth();\n\n\t\t\t\tfor (let i = 0; split <= scaleMax; i++) {\n\t\t\t\t\tlet next = mkDate(baseYear + yrIncr * i, baseMonth + moIncr * i, 1);\n\t\t\t\t\tlet offs = next - tzDate(roundDec(next * ms, 3));\n\n\t\t\t\t\tsplit = roundDec((+next + offs) * ms, 3);\n\n\t\t\t\t\tif (split <= scaleMax)\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet incr0 = foundIncr >= d ? d : foundIncr;\n\t\t\t\tlet tzOffset = floor(scaleMin) - floor(minDateTs);\n\t\t\t\tlet split = minMinTs + tzOffset + incrRoundUp(minDateTs - minMinTs, incr0);\n\t\t\t\tsplits.push(split);\n\n\t\t\t\tlet date0 = tzDate(split);\n\n\t\t\t\tlet prevHour = date0.getHours() + (date0.getMinutes() / m) + (date0.getSeconds() / h);\n\t\t\t\tlet incrHours = foundIncr / h;\n\n\t\t\t\tlet minSpace = self.axes[axisIdx]._space;\n\t\t\t\tlet pctSpace = foundSpace / minSpace;\n\n\t\t\t\twhile (1) {\n\t\t\t\t\tsplit = roundDec(split + foundIncr, ms == 1 ? 0 : 3);\n\n\t\t\t\t\tif (split > scaleMax)\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tif (incrHours > 1) {\n\t\t\t\t\t\tlet expectedHour = floor(roundDec(prevHour + incrHours, 6)) % 24;\n\t\t\t\t\t\tlet splitDate = tzDate(split);\n\t\t\t\t\t\tlet actualHour = splitDate.getHours();\n\n\t\t\t\t\t\tlet dstShift = actualHour - expectedHour;\n\n\t\t\t\t\t\tif (dstShift > 1)\n\t\t\t\t\t\t\tdstShift = -1;\n\n\t\t\t\t\t\tsplit -= dstShift * h;\n\n\t\t\t\t\t\tprevHour = (prevHour + incrHours) % 24;\n\n\t\t\t\t\t\t// add a tick only if it's further than 70% of the min allowed label spacing\n\t\t\t\t\t\tlet prevSplit = splits[splits.length - 1];\n\t\t\t\t\t\tlet pctIncr = roundDec((split - prevSplit) / foundIncr, 3);\n\n\t\t\t\t\t\tif (pctIncr * pctSpace >= .7)\n\t\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsplits.push(split);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn splits;\n\t\t}\n\t}\n\n\treturn [\n\t\ttimeIncrs,\n\t\t_timeAxisStamps,\n\t\ttimeAxisSplits,\n\t];\n}\n\nconst [ timeIncrsMs, _timeAxisStampsMs, timeAxisSplitsMs ] = genTimeStuffs(1);\nconst [ timeIncrsS,  _timeAxisStampsS,  timeAxisSplitsS  ] = genTimeStuffs(1e-3);\n\n// base 2\ngenIncrs(2, -53, 53, [1]);\n\n/*\nconsole.log({\n\tdecIncrs,\n\toneIncrs,\n\twholeIncrs,\n\tnumIncrs,\n\ttimeIncrs,\n\tfixedDec,\n});\n*/\n\nfunction timeAxisStamps(stampCfg, fmtDate) {\n\treturn stampCfg.map(s => s.map((v, i) =>\n\t\ti == 0 || i == 8 || v == null ? v : fmtDate(i == 1 || s[8] == 0 ? v : s[1] + v)\n\t));\n}\n\n// TODO: will need to accept spaces[] and pull incr into the loop when grid will be non-uniform, eg for log scales.\n// currently we ignore this for months since they're *nearly* uniform and the added complexity is not worth it\nfunction timeAxisVals(tzDate, stamps) {\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => {\n\t\tlet s = stamps.find(s => foundIncr >= s[0]) || stamps[stamps.length - 1];\n\n\t\t// these track boundaries when a full label is needed again\n\t\tlet prevYear;\n\t\tlet prevMnth;\n\t\tlet prevDate;\n\t\tlet prevHour;\n\t\tlet prevMins;\n\t\tlet prevSecs;\n\n\t\treturn splits.map(split => {\n\t\t\tlet date = tzDate(split);\n\n\t\t\tlet newYear = date.getFullYear();\n\t\t\tlet newMnth = date.getMonth();\n\t\t\tlet newDate = date.getDate();\n\t\t\tlet newHour = date.getHours();\n\t\t\tlet newMins = date.getMinutes();\n\t\t\tlet newSecs = date.getSeconds();\n\n\t\t\tlet stamp = (\n\t\t\t\tnewYear != prevYear && s[2] ||\n\t\t\t\tnewMnth != prevMnth && s[3] ||\n\t\t\t\tnewDate != prevDate && s[4] ||\n\t\t\t\tnewHour != prevHour && s[5] ||\n\t\t\t\tnewMins != prevMins && s[6] ||\n\t\t\t\tnewSecs != prevSecs && s[7] ||\n\t\t\t\t                       s[1]\n\t\t\t);\n\n\t\t\tprevYear = newYear;\n\t\t\tprevMnth = newMnth;\n\t\t\tprevDate = newDate;\n\t\t\tprevHour = newHour;\n\t\t\tprevMins = newMins;\n\t\t\tprevSecs = newSecs;\n\n\t\t\treturn stamp(date);\n\t\t});\n\t}\n}\n\n// for when axis.values is defined as a static fmtDate template string\nfunction timeAxisVal(tzDate, dateTpl) {\n\tlet stamp = fmtDate(dateTpl);\n\treturn (self, splits, axisIdx, foundSpace, foundIncr) => splits.map(split => stamp(tzDate(split)));\n}\n\nfunction mkDate(y, m, d) {\n\treturn new Date(y, m, d);\n}\n\nfunction timeSeriesStamp(stampCfg, fmtDate) {\n\treturn fmtDate(stampCfg);\n}\nconst _timeSeriesStamp = '{YYYY}-{MM}-{DD} {h}:{mm}{aa}';\n\nfunction timeSeriesVal(tzDate, stamp) {\n\treturn (self, val, seriesIdx, dataIdx) => dataIdx == null ? LEGEND_DISP : stamp(tzDate(val));\n}\n\nfunction legendStroke(self, seriesIdx) {\n\tlet s = self.series[seriesIdx];\n\treturn s.width ? s.stroke(self, seriesIdx) : s.points.width ? s.points.stroke(self, seriesIdx) : null;\n}\n\nfunction legendFill(self, seriesIdx) {\n\treturn self.series[seriesIdx].fill(self, seriesIdx);\n}\n\nconst legendOpts = {\n\tshow: true,\n\tlive: true,\n\tisolate: false,\n\tmount: noop,\n\tmarkers: {\n\t\tshow: true,\n\t\twidth: 2,\n\t\tstroke: legendStroke,\n\t\tfill: legendFill,\n\t\tdash: \"solid\",\n\t},\n\tidx: null,\n\tidxs: null,\n\tvalues: [],\n};\n\nfunction cursorPointShow(self, si) {\n\tlet o = self.cursor.points;\n\n\tlet pt = placeDiv();\n\n\tlet size = o.size(self, si);\n\tsetStylePx(pt, WIDTH, size);\n\tsetStylePx(pt, HEIGHT, size);\n\n\tlet mar = size / -2;\n\tsetStylePx(pt, \"marginLeft\", mar);\n\tsetStylePx(pt, \"marginTop\", mar);\n\n\tlet width = o.width(self, si, size);\n\twidth && setStylePx(pt, \"borderWidth\", width);\n\n\treturn pt;\n}\n\nfunction cursorPointFill(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._fill || sp._stroke;\n}\n\nfunction cursorPointStroke(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp._stroke || sp._fill;\n}\n\nfunction cursorPointSize(self, si) {\n\tlet sp = self.series[si].points;\n\treturn sp.size;\n}\n\nconst moveTuple = [0,0];\n\nfunction cursorMove(self, mouseLeft1, mouseTop1) {\n\tmoveTuple[0] = mouseLeft1;\n\tmoveTuple[1] = mouseTop1;\n\treturn moveTuple;\n}\n\nfunction filtBtn0(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\te.button == 0 && (!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nfunction filtTarg(self, targ, handle, onlyTarg = true) {\n\treturn e => {\n\t\t(!onlyTarg || e.target == targ) && handle(e);\n\t};\n}\n\nconst cursorOpts = {\n\tshow: true,\n\tx: true,\n\ty: true,\n\tlock: false,\n\tmove: cursorMove,\n\tpoints: {\n\t\tone:    false,\n\t\tshow:   cursorPointShow,\n\t\tsize:   cursorPointSize,\n\t\twidth:  0,\n\t\tstroke: cursorPointStroke,\n\t\tfill:   cursorPointFill,\n\t},\n\n\tbind: {\n\t\tmousedown:   filtBtn0,\n\t\tmouseup:     filtBtn0,\n\t\tclick:       filtBtn0, // legend clicks, not .u-over clicks\n\t\tdblclick:    filtBtn0,\n\n\t\tmousemove:   filtTarg,\n\t\tmouseleave:  filtTarg,\n\t\tmouseenter:  filtTarg,\n\t},\n\n\tdrag: {\n\t\tsetScale: true,\n\t\tx: true,\n\t\ty: false,\n\t\tdist: 0,\n\t\tuni: null,\n\t\tclick: (self, e) => {\n\t\t//\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t},\n\t\t_x: false,\n\t\t_y: false,\n\t},\n\n\tfocus: {\n\t\tdist: (self, seriesIdx, dataIdx, valPos, curPos) => valPos - curPos,\n\t\tprox: -1,\n\t\tbias: 0,\n\t},\n\n\thover: {\n\t\tskip: [void 0],\n\t\tprox: null,\n\t\tbias: 0,\n\t},\n\n\tleft: -10,\n\ttop: -10,\n\tidx: null,\n\tdataIdx: null,\n\tidxs: null,\n\n\tevent: null,\n};\n\nconst axisLines = {\n\tshow: true,\n\tstroke: \"rgba(0,0,0,0.07)\",\n\twidth: 2,\n//\tdash: [],\n};\n\nconst grid = assign({}, axisLines, {\n\tfilter: retArg1,\n});\n\nconst ticks = assign({}, grid, {\n\tsize: 10,\n});\n\nconst border = assign({}, axisLines, {\n\tshow: false,\n});\n\nconst font      = '12px system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, \"Noto Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\"';\nconst labelFont = \"bold \" + font;\nconst lineGap = 1.5;\t// font-size multiplier\n\nconst xAxisOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tstroke: hexBlack,\n\tspace: 50,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 2,\n//\tclass: \"x-vals\",\n//\tincrs: timeIncrs,\n//\tvalues: timeVals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\nconst numSeriesLabel = \"Value\";\nconst timeSeriesLabel = \"Time\";\n\nconst xSeriesOpts = {\n\tshow: true,\n\tscale: \"x\",\n\tauto: false,\n\tsorted: 1,\n//\tlabel: \"Time\",\n//\tvalue: v => stamp(new Date(v * 1e3)),\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n};\n\nfunction numAxisVals(self, splits, axisIdx, foundSpace, foundIncr) {\n\treturn splits.map(v => v == null ? \"\" : fmtNum(v));\n}\n\nfunction numAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet splits = [];\n\n\tlet numDec = fixedDec.get(foundIncr) || 0;\n\n\tscaleMin = forceMin ? scaleMin : roundDec(incrRoundUp(scaleMin, foundIncr), numDec);\n\n\tfor (let val = scaleMin; val <= scaleMax; val = roundDec(val + foundIncr, numDec))\n\t\tsplits.push(Object.is(val, -0) ? 0 : val);\t\t// coalesces -0\n\n\treturn splits;\n}\n\n// this doesnt work for sin, which needs to come off from 0 independently in pos and neg dirs\nfunction logAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tconst splits = [];\n\n\tconst logBase = self.scales[self.axes[axisIdx].scale].log;\n\n\tconst logFn = logBase == 10 ? log10 : log2;\n\n\tconst exp = floor(logFn(scaleMin));\n\n\tfoundIncr = pow(logBase, exp);\n\n\t// boo: 10 ** -24 === 1.0000000000000001e-24\n\t// this grabs the proper 1e-24 one\n\tif (logBase == 10)\n\t\tfoundIncr = numIncrs[closestIdx(foundIncr, numIncrs)];\n\n\tlet split = scaleMin;\n\tlet nextMagIncr = foundIncr * logBase;\n\n\tif (logBase == 10)\n\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\n\tdo {\n\t\tsplits.push(split);\n\t\tsplit = split + foundIncr;\n\n\t\tif (logBase == 10 && !fixedDec.has(split))\n\t\t\tsplit = roundDec(split, fixedDec.get(foundIncr));\n\n\t\tif (split >= nextMagIncr) {\n\t\t\tfoundIncr = split;\n\t\t\tnextMagIncr = foundIncr * logBase;\n\n\t\t\tif (logBase == 10)\n\t\t\t\tnextMagIncr = numIncrs[closestIdx(nextMagIncr, numIncrs)];\n\t\t}\n\t} while (split <= scaleMax);\n\n\treturn splits;\n}\n\nfunction asinhAxisSplits(self, axisIdx, scaleMin, scaleMax, foundIncr, foundSpace, forceMin) {\n\tlet sc = self.scales[self.axes[axisIdx].scale];\n\n\tlet linthresh = sc.asinh;\n\n\tlet posSplits = scaleMax > linthresh ? logAxisSplits(self, axisIdx, max(linthresh, scaleMin), scaleMax, foundIncr) : [linthresh];\n\tlet zero = scaleMax >= 0 && scaleMin <= 0 ? [0] : [];\n\tlet negSplits = scaleMin < -linthresh ? logAxisSplits(self, axisIdx, max(linthresh, -scaleMax), -scaleMin, foundIncr): [linthresh];\n\n\treturn negSplits.reverse().map(v => -v).concat(zero, posSplits);\n}\n\nconst RE_ALL   = /./;\nconst RE_12357 = /[12357]/;\nconst RE_125   = /[125]/;\nconst RE_1     = /1/;\n\nconst _filt = (splits, distr, re, keepMod) => splits.map((v, i) => ((distr == 4 && v == 0) || i % keepMod == 0 && re.test(v.toExponential()[v < 0 ? 1 : 0])) ? v : null);\n\nfunction log10AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet sc = self.scales[scaleKey];\n\n//\tif (sc.distr == 3 && sc.log == 2)\n//\t\treturn splits;\n\n\tlet valToPos = self.valToPos;\n\n\tlet minSpace = axis._space;\n\n\tlet _10 = valToPos(10, scaleKey);\n\n\tlet re = (\n\t\tvalToPos(9, scaleKey) - _10 >= minSpace ? RE_ALL :\n\t\tvalToPos(7, scaleKey) - _10 >= minSpace ? RE_12357 :\n\t\tvalToPos(5, scaleKey) - _10 >= minSpace ? RE_125 :\n\t\tRE_1\n\t);\n\n\tif (re == RE_1) {\n\t\tlet magSpace = abs(valToPos(1, scaleKey) - _10);\n\n\t\tif (magSpace < minSpace)\n\t\t\treturn _filt(splits.slice().reverse(), sc.distr, re, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\t}\n\n\treturn _filt(splits, sc.distr, re, 1);\n}\n\nfunction log2AxisValsFilt(self, splits, axisIdx, foundSpace, foundIncr) {\n\tlet axis = self.axes[axisIdx];\n\tlet scaleKey = axis.scale;\n\tlet minSpace = axis._space;\n\tlet valToPos = self.valToPos;\n\n\tlet magSpace = abs(valToPos(1, scaleKey) - valToPos(2, scaleKey));\n\n\tif (magSpace < minSpace)\n\t\treturn _filt(splits.slice().reverse(), 3, RE_ALL, ceil(minSpace / magSpace)).reverse(); // max->min skip\n\n\treturn splits;\n}\n\nfunction numSeriesVal(self, val, seriesIdx, dataIdx) {\n\treturn dataIdx == null ? LEGEND_DISP : val == null ? \"\" : fmtNum(val);\n}\n\nconst yAxisOpts = {\n\tshow: true,\n\tscale: \"y\",\n\tstroke: hexBlack,\n\tspace: 30,\n\tgap: 5,\n\talignTo: 1,\n\tsize: 50,\n\tlabelGap: 0,\n\tlabelSize: 30,\n\tlabelFont,\n\tside: 3,\n//\tclass: \"y-vals\",\n//\tincrs: numIncrs,\n//\tvalues: (vals, space) => vals,\n//\tfilter: retArg1,\n\tgrid,\n\tticks,\n\tborder,\n\tfont,\n\tlineGap,\n\trotate: 0,\n};\n\n// takes stroke width\nfunction ptDia(width, mult) {\n\tlet dia = 3 + (width || 1) * 2;\n\treturn roundDec(dia * mult, 3);\n}\n\nfunction seriesPointsShow(self, si) {\n\tlet { scale, idxs } = self.series[0];\n\tlet xData = self._data[0];\n\tlet p0 = self.valToPos(xData[idxs[0]], scale, true);\n\tlet p1 = self.valToPos(xData[idxs[1]], scale, true);\n\tlet dim = abs(p1 - p0);\n\n\tlet s = self.series[si];\n//\tconst dia = ptDia(s.width, pxRatio);\n\tlet maxPts = dim / (s.points.space * pxRatio);\n\treturn idxs[1] - idxs[0] <= maxPts;\n}\n\nconst facet = {\n\tscale: null,\n\tauto: true,\n\tsorted: 0,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n};\n\nconst gaps = (self, seriesIdx, idx0, idx1, nullGaps) => nullGaps;\n\nconst xySeriesOpts = {\n\tshow: true,\n\tauto: true,\n\tsorted: 0,\n\tgaps,\n\talpha: 1,\n\tfacets: [\n\t\tassign({}, facet, {scale: 'x'}),\n\t\tassign({}, facet, {scale: 'y'}),\n\t],\n};\n\nconst ySeriesOpts = {\n\tscale: \"y\",\n\tauto: true,\n\tsorted: 0,\n\tshow: true,\n\tspanGaps: false,\n\tgaps,\n\talpha: 1,\n\tpoints: {\n\t\tshow: seriesPointsShow,\n\t\tfilter: null,\n\t//  paths:\n\t//\tstroke: \"#000\",\n\t//\tfill: \"#fff\",\n\t//\twidth: 1,\n\t//\tsize: 10,\n\t},\n//\tlabel: \"Value\",\n//\tvalue: v => v,\n\tvalues: null,\n\n\t// internal caches\n\tmin: inf,\n\tmax: -inf,\n\tidxs: [],\n\n\tpath: null,\n\tclip: null,\n};\n\nfunction clampScale(self, val, scaleMin, scaleMax, scaleKey) {\n/*\n\tif (val < 0) {\n\t\tlet cssHgt = self.bbox.height / pxRatio;\n\t\tlet absPos = self.valToPos(abs(val), scaleKey);\n\t\tlet fromBtm = cssHgt - absPos;\n\t\treturn self.posToVal(cssHgt + fromBtm, scaleKey);\n\t}\n*/\n\treturn scaleMin / 10;\n}\n\nconst xScaleOpts = {\n\ttime: FEAT_TIME,\n\tauto: true,\n\tdistr: 1,\n\tlog: 10,\n\tasinh: 1,\n\tmin: null,\n\tmax: null,\n\tdir: 1,\n\tori: 0,\n};\n\nconst yScaleOpts = assign({}, xScaleOpts, {\n\ttime: false,\n\tori: 1,\n});\n\nconst syncs = {};\n\nfunction _sync(key, opts) {\n\tlet s = syncs[key];\n\n\tif (!s) {\n\t\ts = {\n\t\t\tkey,\n\t\t\tplots: [],\n\t\t\tsub(plot) {\n\t\t\t\ts.plots.push(plot);\n\t\t\t},\n\t\t\tunsub(plot) {\n\t\t\t\ts.plots = s.plots.filter(c => c != plot);\n\t\t\t},\n\t\t\tpub(type, self, x, y, w, h, i) {\n\t\t\t\tfor (let j = 0; j < s.plots.length; j++)\n\t\t\t\t\ts.plots[j] != self && s.plots[j].pub(type, self, x, y, w, h, i);\n\t\t\t},\n\t\t};\n\n\t\tif (key != null)\n\t\t\tsyncs[key] = s;\n\t}\n\n\treturn s;\n}\n\nconst BAND_CLIP_FILL   = 1 << 0;\nconst BAND_CLIP_STROKE = 1 << 1;\n\nfunction orient(u, seriesIdx, cb) {\n\tconst mode = u.mode;\n\tconst series = u.series[seriesIdx];\n\tconst data = mode == 2 ? u._data[seriesIdx] : u._data;\n\tconst scales = u.scales;\n\tconst bbox   = u.bbox;\n\n\tlet dx = data[0],\n\t\tdy = mode == 2 ? data[1] : data[seriesIdx],\n\t\tsx = mode == 2 ? scales[series.facets[0].scale] : scales[u.series[0].scale],\n\t\tsy = mode == 2 ? scales[series.facets[1].scale] : scales[series.scale],\n\t\tl = bbox.left,\n\t\tt = bbox.top,\n\t\tw = bbox.width,\n\t\th = bbox.height,\n\t\tH = u.valToPosH,\n\t\tV = u.valToPosV;\n\n\treturn (sx.ori == 0\n\t\t? cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tH,\n\t\t\tV,\n\t\t\tl,\n\t\t\tt,\n\t\t\tw,\n\t\t\th,\n\t\t\tmoveToH,\n\t\t\tlineToH,\n\t\t\trectH,\n\t\t\tarcH,\n\t\t\tbezierCurveToH,\n\t\t)\n\t\t: cb(\n\t\t\tseries,\n\t\t\tdx,\n\t\t\tdy,\n\t\t\tsx,\n\t\t\tsy,\n\t\t\tV,\n\t\t\tH,\n\t\t\tt,\n\t\t\tl,\n\t\t\th,\n\t\t\tw,\n\t\t\tmoveToV,\n\t\t\tlineToV,\n\t\t\trectV,\n\t\t\tarcV,\n\t\t\tbezierCurveToV,\n\t\t)\n\t);\n}\n\nfunction bandFillClipDirs(self, seriesIdx) {\n\tlet fillDir = 0;\n\n\t// 2 bits, -1 | 1\n\tlet clipDirs = 0;\n\n\tlet bands = ifNull(self.bands, EMPTY_ARR);\n\n\tfor (let i = 0; i < bands.length; i++) {\n\t\tlet b = bands[i];\n\n\t\t// is a \"from\" band edge\n\t\tif (b.series[0] == seriesIdx)\n\t\t\tfillDir = b.dir;\n\t\t// is a \"to\" band edge\n\t\telse if (b.series[1] == seriesIdx) {\n\t\t\tif (b.dir == 1)\n\t\t\t\tclipDirs |= 1;\n\t\t\telse\n\t\t\t\tclipDirs |= 2;\n\t\t}\n\t}\n\n\treturn [\n\t\tfillDir,\n\t\t(\n\t\t\tclipDirs == 1 ? -1 : // neg only\n\t\t\tclipDirs == 2 ?  1 : // pos only\n\t\t\tclipDirs == 3 ?  2 : // both\n\t\t\t                 0   // neither\n\t\t)\n\t];\n}\n\nfunction seriesFillTo(self, seriesIdx, dataMin, dataMax, bandFillDir) {\n\tlet mode = self.mode;\n\tlet series = self.series[seriesIdx];\n\tlet scaleKey = mode == 2 ? series.facets[1].scale : series.scale;\n\tlet scale = self.scales[scaleKey];\n\n\treturn (\n\t\tbandFillDir == -1 ? scale.min :\n\t\tbandFillDir ==  1 ? scale.max :\n\t\tscale.distr ==  3 ? (\n\t\t\tscale.dir == 1 ? scale.min :\n\t\t\tscale.max\n\t\t) : 0\n\t);\n}\n\n// creates inverted band clip path (from stroke path -> yMax || yMin)\n// clipDir is always inverse of fillDir\n// default clip dir is upwards (1), since default band fill is downwards/fillBelowTo (-1) (highIdx -> lowIdx)\nfunction clipBandLine(self, seriesIdx, idx0, idx1, strokePath, clipDir) {\n\treturn orient(self, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\tlet pxRound = series.pxRound;\n\n\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\tconst lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\tlet frIdx, toIdx;\n\n\t\tif (dir == 1) {\n\t\t\tfrIdx = idx0;\n\t\t\ttoIdx = idx1;\n\t\t}\n\t\telse {\n\t\t\tfrIdx = idx1;\n\t\t\ttoIdx = idx0;\n\t\t}\n\n\t\t// path start\n\t\tlet x0 = pxRound(valToPosX(dataX[frIdx], scaleX, xDim, xOff));\n\t\tlet y0 = pxRound(valToPosY(dataY[frIdx], scaleY, yDim, yOff));\n\t\t// path end x\n\t\tlet x1 = pxRound(valToPosX(dataX[toIdx], scaleX, xDim, xOff));\n\t\t// upper or lower y limit\n\t\tlet yLimit = pxRound(valToPosY(clipDir == 1 ? scaleY.max : scaleY.min, scaleY, yDim, yOff));\n\n\t\tlet clip = new Path2D(strokePath);\n\n\t\tlineTo(clip, x1, yLimit);\n\t\tlineTo(clip, x0, yLimit);\n\t\tlineTo(clip, x0, y0);\n\n\t\treturn clip;\n\t});\n}\n\nfunction clipGaps(gaps, ori, plotLft, plotTop, plotWid, plotHgt) {\n\tlet clip = null;\n\n\t// create clip path (invert gaps and non-gaps)\n\tif (gaps.length > 0) {\n\t\tclip = new Path2D();\n\n\t\tconst rect = ori == 0 ? rectH : rectV;\n\n\t\tlet prevGapEnd = plotLft;\n\n\t\tfor (let i = 0; i < gaps.length; i++) {\n\t\t\tlet g = gaps[i];\n\n\t\t\tif (g[1] > g[0]) {\n\t\t\t\tlet w = g[0] - prevGapEnd;\n\n\t\t\t\tw > 0 && rect(clip, prevGapEnd, plotTop, w, plotTop + plotHgt);\n\n\t\t\t\tprevGapEnd = g[1];\n\t\t\t}\n\t\t}\n\n\t\tlet w = plotLft + plotWid - prevGapEnd;\n\n\t\t// hack to ensure we expand the clip enough to avoid cutting off strokes at edges\n\t\tlet maxStrokeWidth = 10;\n\n\t\tw > 0 && rect(clip, prevGapEnd, plotTop - maxStrokeWidth / 2, w, plotTop + plotHgt + maxStrokeWidth);\n\t}\n\n\treturn clip;\n}\n\nfunction addGap(gaps, fromX, toX) {\n\tlet prevGap = gaps[gaps.length - 1];\n\n\tif (prevGap && prevGap[0] == fromX)\t\t\t// TODO: gaps must be encoded at stroke widths?\n\t\tprevGap[1] = toX;\n\telse\n\t\tgaps.push([fromX, toX]);\n}\n\nfunction findGaps(xs, ys, idx0, idx1, dir, pixelForX, align) {\n\tlet gaps = [];\n\tlet len = xs.length;\n\n\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\tlet yVal = ys[i];\n\n\t\tif (yVal === null) {\n\t\t\tlet fr = i, to = i;\n\n\t\t\tif (dir == 1) {\n\t\t\t\twhile (++i <= idx1 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\twhile (--i >= idx0 && ys[i] === null)\n\t\t\t\t\tto = i;\n\t\t\t}\n\n\t\t\tlet frPx = pixelForX(xs[fr]);\n\t\t\tlet toPx = to == fr ? frPx : pixelForX(xs[to]);\n\n\t\t\t// if value adjacent to edge null is same pixel, then it's partially\n\t\t\t// filled and gap should start at next pixel\n\t\t\tlet fri2 = fr - dir;\n\t\t\tlet frPx2 = align <= 0 && fri2 >= 0 && fri2 < len ? pixelForX(xs[fri2]) : frPx;\n\t\t//\tif (frPx2 == frPx)\n\t\t//\t\tfrPx++;\n\t\t//\telse\n\t\t\t\tfrPx = frPx2;\n\n\t\t\tlet toi2 = to + dir;\n\t\t\tlet toPx2 = align >= 0 && toi2 >= 0 && toi2 < len ? pixelForX(xs[toi2]) : toPx;\n\t\t//\tif (toPx2 == toPx)\n\t\t//\t\ttoPx--;\n\t\t//\telse\n\t\t\t\ttoPx = toPx2;\n\n\t\t\tif (toPx >= frPx)\n\t\t\t\tgaps.push([frPx, toPx]); // addGap\n\t\t}\n\t}\n\n\treturn gaps;\n}\n\nfunction pxRoundGen(pxAlign) {\n\treturn pxAlign == 0 ? retArg0 : pxAlign == 1 ? round : v => incrRound(v, pxAlign);\n}\n\n/*\n// inefficient linear interpolation that does bi-directinal scans on each call\nexport function costlyLerp(i, idx0, idx1, _dirX, dataY) {\n\tlet prevNonNull = nonNullIdx(dataY, _dirX == 1 ? idx0 : idx1, i, -_dirX);\n\tlet nextNonNull = nonNullIdx(dataY, i, _dirX == 1 ? idx1 : idx0,  _dirX);\n\n\tlet prevVal = dataY[prevNonNull];\n\tlet nextVal = dataY[nextNonNull];\n\n\treturn prevVal + (i - prevNonNull) / (nextNonNull - prevNonNull) * (nextVal - prevVal);\n}\n*/\n\nfunction rect(ori) {\n\tlet moveTo = ori == 0 ?\n\t\tmoveToH :\n\t\tmoveToV;\n\n\tlet arcTo = ori == 0 ?\n\t\t(p, x1, y1, x2, y2, r) => { p.arcTo(x1, y1, x2, y2, r); } :\n\t\t(p, y1, x1, y2, x2, r) => { p.arcTo(x1, y1, x2, y2, r); };\n\n\tlet rect = ori == 0 ?\n\t\t(p, x, y, w, h) => { p.rect(x, y, w, h); } :\n\t\t(p, y, x, h, w) => { p.rect(x, y, w, h); };\n\n\t// TODO (pending better browser support): https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/roundRect\n\treturn (p, x, y, w, h, endRad = 0, baseRad = 0) => {\n\t\tif (endRad == 0 && baseRad == 0)\n\t\t\trect(p, x, y, w, h);\n\t\telse {\n\t\t\tendRad  = min(endRad,  w / 2, h / 2);\n\t\t\tbaseRad = min(baseRad, w / 2, h / 2);\n\n\t\t\t// adapted from https://stackoverflow.com/questions/1255512/how-to-draw-a-rounded-rectangle-using-html-canvas/7838871#7838871\n\t\t\tmoveTo(p, x + endRad, y);\n\t\t\tarcTo(p, x + w, y, x + w, y + h, endRad);\n\t\t\tarcTo(p, x + w, y + h, x, y + h, baseRad);\n\t\t\tarcTo(p, x, y + h, x, y, baseRad);\n\t\t\tarcTo(p, x, y, x + w, y, endRad);\n\t\t\tp.closePath();\n\t\t}\n\t};\n}\n\n// orientation-inverting canvas functions\nconst moveToH = (p, x, y) => { p.moveTo(x, y); };\nconst moveToV = (p, y, x) => { p.moveTo(x, y); };\nconst lineToH = (p, x, y) => { p.lineTo(x, y); };\nconst lineToV = (p, y, x) => { p.lineTo(x, y); };\nconst rectH = rect(0);\nconst rectV = rect(1);\nconst arcH = (p, x, y, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst arcV = (p, y, x, r, startAngle, endAngle) => { p.arc(x, y, r, startAngle, endAngle); };\nconst bezierCurveToH = (p, bp1x, bp1y, bp2x, bp2y, p2x, p2y) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\nconst bezierCurveToV = (p, bp1y, bp1x, bp2y, bp2x, p2y, p2x) => { p.bezierCurveTo(bp1x, bp1y, bp2x, bp2y, p2x, p2y); };\n\n// TODO: drawWrap(seriesIdx, drawPoints) (save, restore, translate, clip)\nfunction points(opts) {\n\treturn (u, seriesIdx, idx0, idx1, filtIdxs) => {\n\t//\tlog(\"drawPoints()\", arguments);\n\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet { pxRound, points } = series;\n\n\t\t\tlet moveTo, arc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tarc = arcH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tarc = arcV;\n\t\t\t}\n\n\t\t\tconst width = roundDec(points.width * pxRatio, 3);\n\n\t\t\tlet rad = (points.size - points.width) / 2 * pxRatio;\n\t\t\tlet dia = roundDec(rad * 2, 3);\n\n\t\t\tlet fill = new Path2D();\n\t\t\tlet clip = new Path2D();\n\n\t\t\tlet { left: lft, top: top, width: wid, height: hgt } = u.bbox;\n\n\t\t\trectH(clip,\n\t\t\t\tlft - dia,\n\t\t\t\ttop - dia,\n\t\t\t\twid + dia * 2,\n\t\t\t\thgt + dia * 2,\n\t\t\t);\n\n\t\t\tconst drawPoint = pi => {\n\t\t\t\tif (dataY[pi] != null) {\n\t\t\t\t\tlet x = pxRound(valToPosX(dataX[pi], scaleX, xDim, xOff));\n\t\t\t\t\tlet y = pxRound(valToPosY(dataY[pi], scaleY, yDim, yOff));\n\n\t\t\t\t\tmoveTo(fill, x + rad, y);\n\t\t\t\t\tarc(fill, x, y, rad, 0, PI * 2);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (filtIdxs)\n\t\t\t\tfiltIdxs.forEach(drawPoint);\n\t\t\telse {\n\t\t\t\tfor (let pi = idx0; pi <= idx1; pi++)\n\t\t\t\t\tdrawPoint(pi);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstroke: width > 0 ? fill : null,\n\t\t\t\tfill,\n\t\t\t\tclip,\n\t\t\t\tflags: BAND_CLIP_FILL | BAND_CLIP_STROKE,\n\t\t\t};\n\t\t});\n\t};\n}\n\nfunction _drawAcc(lineTo) {\n\treturn (stroke, accX, minY, maxY, inY, outY) => {\n\t\tif (minY != maxY) {\n\t\t\tif (inY != minY && outY != minY)\n\t\t\t\tlineTo(stroke, accX, minY);\n\t\t\tif (inY != maxY && outY != maxY)\n\t\t\t\tlineTo(stroke, accX, maxY);\n\n\t\t\tlineTo(stroke, accX, outY);\n\t\t}\n\t};\n}\n\nconst drawAccH = _drawAcc(lineToH);\nconst drawAccV = _drawAcc(lineToV);\n\nfunction linear(opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo, drawAcc;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tdrawAcc = drawAccH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tdrawAcc = drawAccV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet hasGap = false;\n\n\t\t\t// decimate when number of points >= 4x available pixels\n\t\t\tconst decimate = idx1 - idx0 >= xDim * 4;\n\n\t\t\tif (decimate) {\n\t\t\t\tlet xForPixel = pos => u.posToVal(pos, scaleX.key, true);\n\n\t\t\t\tlet minY = null,\n\t\t\t\t\tmaxY = null,\n\t\t\t\t\tinY, outY, drawnAtX;\n\n\t\t\t\tlet accX = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\n\t\t\t\tlet idx0px = pixelForX(dataX[idx0]);\n\t\t\t\tlet idx1px = pixelForX(dataX[idx1]);\n\n\t\t\t\t// tracks limit of current x bucket to avoid having to get x pixel for every x value\n\t\t\t\tlet nextAccXVal = xForPixel(dir == 1 ? idx0px + 1 : idx1px - 1);\n\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet reuseAccX = dir == 1 ? (xVal < nextAccXVal) : (xVal > nextAccXVal);\n\t\t\t\t\tlet x = reuseAccX ? accX :  pixelForX(xVal);\n\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (x == accX) {\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\n\t\t\t\t\t\t\tif (minY == null) {\n\t\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\t\tinY = minY = maxY = outY;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (outY < minY)\n\t\t\t\t\t\t\t\t\tminY = outY;\n\t\t\t\t\t\t\t\telse if (outY > maxY)\n\t\t\t\t\t\t\t\t\tmaxY = outY;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (minY != null)\n\t\t\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\n\t\t\t\t\t\tif (yVal != null) {\n\t\t\t\t\t\t\toutY = yVal;\n\t\t\t\t\t\t\tlineTo(stroke, x, pixelForY(outY));\n\t\t\t\t\t\t\tminY = maxY = inY = outY;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tminY = maxY = null;\n\n\t\t\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\t\t\thasGap = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taccX = x;\n\t\t\t\t\t\tnextAccXVal = xForPixel(accX + dir);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (minY != null && minY != maxY && drawnAtX != accX)\n\t\t\t\t\tdrawAcc(stroke, accX, pixelForY(minY), pixelForY(maxY), pixelForY(inY), pixelForY(outY));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\t\tif (yVal === null)\n\t\t\t\t\t\thasGap = true;\n\t\t\t\t\telse if (yVal != null)\n\t\t\t\t\t\tlineTo(stroke, pixelForX(dataX[i]), pixelForY(yVal));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillToVal = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillToVal);\n\n\t\t\t\tlet frX = pixelForX(dataX[idx0]);\n\t\t\t\tlet toX = pixelForX(dataX[idx1]);\n\n\t\t\t\tif (dir == -1)\n\t\t\t\t\t[toX, frX] = [frX, toX];\n\n\t\t\t\tlineTo(fill, toX, fillToY);\n\t\t\t\tlineTo(fill, frX, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) { // skip in mode: 2?\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\thasGap && gaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\n// BUG: align: -1 behaves like align: 1 when scale.dir: -1\nfunction stepped(opts) {\n\tconst align = ifNull(opts.align, 1);\n\t// whether to draw ascenders/descenders at null/gap bondaries\n\tconst ascDesc = ifNull(opts.ascDesc, false);\n\tconst alignGaps = ifNull(opts.alignGaps, 0);\n\tconst extend = ifNull(opts.extend, false);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet { left, width } = u.bbox;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet lineTo = scaleX.ori == 0 ? lineToH : lineToV;\n\n\t\t\tconst _paths = {stroke: new Path2D(), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet prevYPos  = pixelForY(dataY[dir == 1 ? idx0 : idx1]);\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet firstXPosExt = firstXPos;\n\n\t\t\tif (extend && align == -1) {\n\t\t\t\tfirstXPosExt = left;\n\t\t\t\tlineTo(stroke, firstXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlineTo(stroke, firstXPos, prevYPos);\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal1 = dataY[i];\n\n\t\t\t\tif (yVal1 == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet x1 = pixelForX(dataX[i]);\n\t\t\t\tlet y1 = pixelForY(yVal1);\n\n\t\t\t\tif (align == 1)\n\t\t\t\t\tlineTo(stroke, x1, prevYPos);\n\t\t\t\telse\n\t\t\t\t\tlineTo(stroke, prevXPos, y1);\n\n\t\t\t\tlineTo(stroke, x1, y1);\n\n\t\t\t\tprevYPos = y1;\n\t\t\t\tprevXPos = x1;\n\t\t\t}\n\n\t\t\tlet prevXPosExt = prevXPos;\n\n\t\t\tif (extend && align == 1) {\n\t\t\t\tprevXPosExt = left + width;\n\t\t\t\tlineTo(stroke, prevXPosExt, prevYPos);\n\t\t\t}\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPosExt, fillToY);\n\t\t\t\tlineTo(fill, firstXPosExt, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t// expand/contract clips for ascenders/descenders\n\t\t\t\tlet halfStroke = (series.width * pxRatio) / 2;\n\t\t\t\tlet startsOffset = (ascDesc || align ==  1) ?  halfStroke : -halfStroke;\n\t\t\t\tlet endsOffset   = (ascDesc || align == -1) ? -halfStroke :  halfStroke;\n\n\t\t\t\tgaps.forEach(g => {\n\t\t\t\t\tg[0] += startsOffset;\n\t\t\t\t\tg[1] += endsOffset;\n\t\t\t\t});\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid = inf) {\n\tif (dataX.length > 1) {\n\t\t// prior index with non-undefined y data\n\t\tlet prevIdx = null;\n\n\t\t// scan full dataset for smallest adjacent delta\n\t\t// will not work properly for non-linear x scales, since does not do expensive valToPosX calcs till end\n\t\tfor (let i = 0, minDelta = Infinity; i < dataX.length; i++) {\n\t\t\tif (dataY[i] !== undefined) {\n\t\t\t\tif (prevIdx != null) {\n\t\t\t\t\tlet delta = abs(dataX[i] - dataX[prevIdx]);\n\n\t\t\t\t\tif (delta < minDelta) {\n\t\t\t\t\t\tminDelta = delta;\n\t\t\t\t\t\tcolWid = abs(valToPosX(dataX[i], scaleX, xDim, xOff) - valToPosX(dataX[prevIdx], scaleX, xDim, xOff));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprevIdx = i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn colWid;\n}\n\nfunction bars(opts) {\n\topts = opts || EMPTY_OBJ;\n\tconst size = ifNull(opts.size, [0.6, inf, 1]);\n\tconst align = opts.align || 0;\n\tconst _extraGap = (opts.gap || 0);\n\n\tlet ro = opts.radius;\n\n\tro =\n\t\t// [valueRadius, baselineRadius]\n\t\tro == null ? [0, 0] :\n\t\ttypeof ro == 'number' ? [ro, 0] : ro;\n\n\tconst radiusFn = fnOrSelf(ro);\n\n\tconst gapFactor = 1 - size[0];\n\tconst _maxWidth  = ifNull(size[1], inf);\n\tconst _minWidth  = ifNull(size[2], 1);\n\n\tconst disp = ifNull(opts.disp, EMPTY_OBJ);\n\tconst _each = ifNull(opts.each, _ => {});\n\n\tconst { fill: dispFills, stroke: dispStrokes } = disp;\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\tlet pxRound = series.pxRound;\n\t\t\tlet _align = align;\n\n\t\t\tlet extraGap = _extraGap * pxRatio;\n\t\t\tlet maxWidth = _maxWidth * pxRatio;\n\t\t\tlet minWidth = _minWidth * pxRatio;\n\n\t\t\tlet valRadius, baseRadius;\n\n\t\t\tif (scaleX.ori == 0)\n\t\t\t\t[valRadius, baseRadius] = radiusFn(u, seriesIdx);\n\t\t\telse\n\t\t\t\t[baseRadius, valRadius] = radiusFn(u, seriesIdx);\n\n\t\t\tconst _dirX = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\t\t//\tconst _dirY = scaleY.dir * (scaleY.ori == 1 ? 1 : -1);\n\n\t\t\tlet rect = scaleX.ori == 0 ? rectH : rectV;\n\n\t\t\tlet each = scaleX.ori == 0 ? _each : (u, seriesIdx, i, top, lft, hgt, wid) => {\n\t\t\t\t_each(u, seriesIdx, i, lft, top, wid, hgt);\n\t\t\t};\n\n\t\t\t// band where this series is the \"from\" edge\n\t\t\tlet band = ifNull(u.bands, EMPTY_ARR).find(b => b.series[0] == seriesIdx);\n\n\t\t\tlet fillDir = band != null ? band.dir : 0;\n\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, fillDir);\n\t\t\tlet fillToY = pxRound(valToPosY(fillTo, scaleY, yDim, yOff));\n\n\t\t\t// barWid is to center of stroke\n\t\t\tlet xShift, barWid, fullGap, colWid = xDim;\n\n\t\t\tlet strokeWidth = pxRound(series.width * pxRatio);\n\n\t\t\tlet multiPath = false;\n\n\t\t\tlet fillColors = null;\n\t\t\tlet fillPaths = null;\n\t\t\tlet strokeColors = null;\n\t\t\tlet strokePaths = null;\n\n\t\t\tif (dispFills != null && (strokeWidth == 0 || dispStrokes != null)) {\n\t\t\t\tmultiPath = true;\n\n\t\t\t\tfillColors = dispFills.values(u, seriesIdx, idx0, idx1);\n\t\t\t\tfillPaths = new Map();\n\t\t\t\t(new Set(fillColors)).forEach(color => {\n\t\t\t\t\tif (color != null)\n\t\t\t\t\t\tfillPaths.set(color, new Path2D());\n\t\t\t\t});\n\n\t\t\t\tif (strokeWidth > 0) {\n\t\t\t\t\tstrokeColors = dispStrokes.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tstrokePaths = new Map();\n\t\t\t\t\t(new Set(strokeColors)).forEach(color => {\n\t\t\t\t\t\tif (color != null)\n\t\t\t\t\t\t\tstrokePaths.set(color, new Path2D());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet { x0, size } = disp;\n\n\t\t\tif (x0 != null && size != null) {\n\t\t\t\t_align = 1;\n\t\t\t\tdataX = x0.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (x0.unit == 2)\n\t\t\t\t\tdataX = dataX.map(pct => u.posToVal(xOff + pct * xDim, scaleX.key, true));\n\n\t\t\t\t// assumes uniform sizes, for now\n\t\t\t\tlet sizes = size.values(u, seriesIdx, idx0, idx1);\n\n\t\t\t\tif (size.unit == 2)\n\t\t\t\t\tbarWid = sizes[0] * xDim;\n\t\t\t\telse\n\t\t\t\t\tbarWid = valToPosX(sizes[0], scaleX, xDim, xOff) - valToPosX(0, scaleX, xDim, xOff); // assumes linear scale (delta from 0)\n\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid - barWid;\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcolWid = findColWidth(dataX, dataY, valToPosX, scaleX, xDim, xOff, colWid);\n\n\t\t\t\tlet gapWid = colWid * gapFactor;\n\n\t\t\t\tfullGap = gapWid + extraGap;\n\t\t\t\tbarWid = colWid - fullGap;\n\t\t\t}\n\n\t\t\tif (fullGap < 1)\n\t\t\t\tfullGap = 0;\n\n\t\t\tif (strokeWidth >= barWid / 2)\n\t\t\t\tstrokeWidth = 0;\n\n\t\t\t// for small gaps, disable pixel snapping since gap inconsistencies become noticible and annoying\n\t\t\tif (fullGap < 5)\n\t\t\t\tpxRound = retArg0;\n\n\t\t\tlet insetStroke = fullGap > 0;\n\n\t\t\tlet rawBarWid = colWid - fullGap - (insetStroke ? strokeWidth : 0);\n\n\t\t\tbarWid = pxRound(clamp(rawBarWid, minWidth, maxWidth));\n\n\t\t\txShift = (_align == 0 ? barWid / 2 : _align == _dirX ? 0 : barWid) - _align * _dirX * ((_align == 0 ? extraGap / 2 : 0) + (insetStroke ? strokeWidth / 2 : 0));\n\n\n\t\t\tconst _paths = {stroke: null, fill: null, clip: null, band: null, gaps: null, flags: 0};  // disp, geom\n\n\t\t\tconst stroke = multiPath ? null : new Path2D();\n\n\t\t\tlet dataY0 = null;\n\n\t\t\tif (band != null)\n\t\t\t\tdataY0 = u.data[band.series[1]];\n\t\t\telse {\n\t\t\t\tlet { y0, y1 } = disp;\n\n\t\t\t\tif (y0 != null && y1 != null) {\n\t\t\t\t\tdataY = y1.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t\tdataY0 = y0.values(u, seriesIdx, idx0, idx1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet radVal = valRadius * barWid;\n\t\t\tlet radBase = baseRadius * barWid;\n\n\t\t\tfor (let i = _dirX == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += _dirX) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal == null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (dataY0 != null) {\n\t\t\t\t\tlet yVal0 = dataY0[i] ?? 0;\n\n\t\t\t\t\tif (yVal - yVal0 == 0)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tfillToY = valToPosY(yVal0, scaleY, yDim, yOff);\n\t\t\t\t}\n\n\t\t\t\tlet xVal = scaleX.distr != 2 || disp != null ? dataX[i] : i;\n\n\t\t\t\t// TODO: all xPos can be pre-computed once for all series in aligned set\n\t\t\t\tlet xPos = valToPosX(xVal, scaleX, xDim, xOff);\n\t\t\t\tlet yPos = valToPosY(ifNull(yVal, fillTo), scaleY, yDim, yOff);\n\n\t\t\t\tlet lft = pxRound(xPos - xShift);\n\t\t\t\tlet btm = pxRound(max(yPos, fillToY));\n\t\t\t\tlet top = pxRound(min(yPos, fillToY));\n\t\t\t\t// this includes the stroke\n\t\t\t\tlet barHgt = btm - top;\n\n\t\t\t\tif (yVal != null) {  // && yVal != fillTo (0 height bar)\n\t\t\t\t\tlet rv = yVal < 0 ? radBase : radVal;\n\t\t\t\t\tlet rb = yVal < 0 ? radVal : radBase;\n\n\t\t\t\t\tif (multiPath) {\n\t\t\t\t\t\tif (strokeWidth > 0 && strokeColors[i] != null)\n\t\t\t\t\t\t\trect(strokePaths.get(strokeColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\t\tif (fillColors[i] != null)\n\t\t\t\t\t\t\trect(fillPaths.get(fillColors[i]), lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\trect(stroke, lft, top + floor(strokeWidth / 2), barWid, max(0, barHgt - strokeWidth), rv, rb);\n\n\t\t\t\t\teach(u, seriesIdx, i,\n\t\t\t\t\t\tlft    - strokeWidth / 2,\n\t\t\t\t\t\ttop,\n\t\t\t\t\t\tbarWid + strokeWidth,\n\t\t\t\t\t\tbarHgt,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (strokeWidth > 0)\n\t\t\t\t_paths.stroke = multiPath ? strokePaths : stroke;\n\t\t\telse if (!multiPath) {\n\t\t\t\t_paths._fill = series.width == 0 ? series._fill : series._stroke ?? series._fill;\n\t\t\t\t_paths.width = 0;\n\t\t\t}\n\n\t\t\t_paths.fill = multiPath ? fillPaths : stroke;\n\n\t\t\treturn _paths;\n\t\t});\n\t};\n}\n\nfunction splineInterp(interp, opts) {\n\tconst alignGaps = ifNull(opts?.alignGaps, 0);\n\n\treturn (u, seriesIdx, idx0, idx1) => {\n\t\treturn orient(u, seriesIdx, (series, dataX, dataY, scaleX, scaleY, valToPosX, valToPosY, xOff, yOff, xDim, yDim) => {\n\t\t\t[idx0, idx1] = nonNullIdxs(dataY, idx0, idx1);\n\n\t\t\tlet pxRound = series.pxRound;\n\n\t\t\tlet pixelForX = val => pxRound(valToPosX(val, scaleX, xDim, xOff));\n\t\t\tlet pixelForY = val => pxRound(valToPosY(val, scaleY, yDim, yOff));\n\n\t\t\tlet moveTo, bezierCurveTo, lineTo;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tmoveTo = moveToH;\n\t\t\t\tlineTo = lineToH;\n\t\t\t\tbezierCurveTo = bezierCurveToH;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmoveTo = moveToV;\n\t\t\t\tlineTo = lineToV;\n\t\t\t\tbezierCurveTo = bezierCurveToV;\n\t\t\t}\n\n\t\t\tconst dir = scaleX.dir * (scaleX.ori == 0 ? 1 : -1);\n\n\t\t\tlet firstXPos = pixelForX(dataX[dir == 1 ? idx0 : idx1]);\n\t\t\tlet prevXPos = firstXPos;\n\n\t\t\tlet xCoords = [];\n\t\t\tlet yCoords = [];\n\n\t\t\tfor (let i = dir == 1 ? idx0 : idx1; i >= idx0 && i <= idx1; i += dir) {\n\t\t\t\tlet yVal = dataY[i];\n\n\t\t\t\tif (yVal != null) {\n\t\t\t\t\tlet xVal = dataX[i];\n\t\t\t\t\tlet xPos = pixelForX(xVal);\n\n\t\t\t\t\txCoords.push(prevXPos = xPos);\n\t\t\t\t\tyCoords.push(pixelForY(dataY[i]));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst _paths = {stroke: interp(xCoords, yCoords, moveTo, lineTo, bezierCurveTo, pxRound), fill: null, clip: null, band: null, gaps: null, flags: BAND_CLIP_FILL};\n\t\t\tconst stroke = _paths.stroke;\n\n\t\t\tlet [ bandFillDir, bandClipDir ] = bandFillClipDirs(u, seriesIdx);\n\n\t\t\tif (series.fill != null || bandFillDir != 0) {\n\t\t\t\tlet fill = _paths.fill = new Path2D(stroke);\n\n\t\t\t\tlet fillTo = series.fillTo(u, seriesIdx, series.min, series.max, bandFillDir);\n\t\t\t\tlet fillToY = pixelForY(fillTo);\n\n\t\t\t\tlineTo(fill, prevXPos, fillToY);\n\t\t\t\tlineTo(fill, firstXPos, fillToY);\n\t\t\t}\n\n\t\t\tif (!series.spanGaps) {\n\t\t\t//\tconsole.time('gaps');\n\t\t\t\tlet gaps = [];\n\n\t\t\t\tgaps.push(...findGaps(dataX, dataY, idx0, idx1, dir, pixelForX, alignGaps));\n\n\t\t\t//\tconsole.timeEnd('gaps');\n\n\t\t\t//\tconsole.log('gaps', JSON.stringify(gaps));\n\n\t\t\t\t_paths.gaps = gaps = series.gaps(u, seriesIdx, idx0, idx1, gaps);\n\n\t\t\t\t_paths.clip = clipGaps(gaps, scaleX.ori, xOff, yOff, xDim, yDim);\n\t\t\t}\n\n\t\t\tif (bandClipDir != 0) {\n\t\t\t\t_paths.band = bandClipDir == 2 ? [\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke, -1),\n\t\t\t\t\tclipBandLine(u, seriesIdx, idx0, idx1, stroke,  1),\n\t\t\t\t] : clipBandLine(u, seriesIdx, idx0, idx1, stroke, bandClipDir);\n\t\t\t}\n\n\t\t\treturn _paths;\n\n\t\t\t//  if FEAT_PATHS: false in rollup.config.js\n\t\t\t//\tu.ctx.save();\n\t\t\t//\tu.ctx.beginPath();\n\t\t\t//\tu.ctx.rect(u.bbox.left, u.bbox.top, u.bbox.width, u.bbox.height);\n\t\t\t//\tu.ctx.clip();\n\t\t\t//\tu.ctx.strokeStyle = u.series[sidx].stroke;\n\t\t\t//\tu.ctx.stroke(stroke);\n\t\t\t//\tu.ctx.fillStyle = u.series[sidx].fill;\n\t\t\t//\tu.ctx.fill(fill);\n\t\t\t//\tu.ctx.restore();\n\t\t\t//\treturn null;\n\t\t});\n\t};\n}\n\nfunction monotoneCubic(opts) {\n\treturn splineInterp(_monotoneCubic, opts);\n}\n\n// Monotone Cubic Spline interpolation, adapted from the Chartist.js implementation:\n// https://github.com/gionkunz/chartist-js/blob/e7e78201bffe9609915e5e53cfafa29a5d6c49f9/src/scripts/interpolation.js#L240-L369\nfunction _monotoneCubic(xs, ys, moveTo, lineTo, bezierCurveTo, pxRound) {\n\tconst n = xs.length;\n\n\tif (n < 2)\n\t\treturn null;\n\n\tconst path = new Path2D();\n\n\tmoveTo(path, xs[0], ys[0]);\n\n\tif (n == 2)\n\t\tlineTo(path, xs[1], ys[1]);\n\telse {\n\t\tlet ms  = Array(n),\n\t\t\tds  = Array(n - 1),\n\t\t\tdys = Array(n - 1),\n\t\t\tdxs = Array(n - 1);\n\n\t\t// calc deltas and derivative\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tdys[i] = ys[i + 1] - ys[i];\n\t\t\tdxs[i] = xs[i + 1] - xs[i];\n\t\t\tds[i]  = dys[i] / dxs[i];\n\t\t}\n\n\t\t// determine desired slope (m) at each point using Fritsch-Carlson method\n\t\t// http://math.stackexchange.com/questions/45218/implementation-of-monotone-cubic-interpolation\n\t\tms[0] = ds[0];\n\n\t\tfor (let i = 1; i < n - 1; i++) {\n\t\t\tif (ds[i] === 0 || ds[i - 1] === 0 || (ds[i - 1] > 0) !== (ds[i] > 0))\n\t\t\t\tms[i] = 0;\n\t\t\telse {\n\t\t\t\tms[i] = 3 * (dxs[i - 1] + dxs[i]) / (\n\t\t\t\t\t(2 * dxs[i] + dxs[i - 1]) / ds[i - 1] +\n\t\t\t\t\t(dxs[i] + 2 * dxs[i - 1]) / ds[i]\n\t\t\t\t);\n\n\t\t\t\tif (!isFinite(ms[i]))\n\t\t\t\t\tms[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\tms[n - 1] = ds[n - 2];\n\n\t\tfor (let i = 0; i < n - 1; i++) {\n\t\t\tbezierCurveTo(\n\t\t\t\tpath,\n\t\t\t\txs[i] + dxs[i] / 3,\n\t\t\t\tys[i] + ms[i] * dxs[i] / 3,\n\t\t\t\txs[i + 1] - dxs[i] / 3,\n\t\t\t\tys[i + 1] - ms[i + 1] * dxs[i] / 3,\n\t\t\t\txs[i + 1],\n\t\t\t\tys[i + 1],\n\t\t\t);\n\t\t}\n\t}\n\n\treturn path;\n}\n\nconst cursorPlots = new Set();\n\nfunction invalidateRects() {\n\tfor (let u of cursorPlots)\n\t\tu.syncRect(true);\n}\n\nif (domEnv) {\n\ton(resize, win, invalidateRects);\n\ton(scroll, win, invalidateRects, true);\n\ton(dppxchange, win, () => { uPlot.pxRatio = pxRatio; });\n}\n\nconst linearPath = linear() ;\nconst pointsPath = points() ;\n\nfunction setDefaults(d, xo, yo, initY) {\n\tlet d2 = initY ? [d[0], d[1]].concat(d.slice(2)) : [d[0]].concat(d.slice(1));\n\treturn d2.map((o, i) => setDefault(o, i, xo, yo));\n}\n\nfunction setDefaults2(d, xyo) {\n\treturn d.map((o, i) => i == 0 ? {} : assign({}, xyo, o));  // todo: assign() will not merge facet arrays\n}\n\nfunction setDefault(o, i, xo, yo) {\n\treturn assign({}, (i == 0 ? xo : yo), o);\n}\n\nfunction snapNumX(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : [dataMin, dataMax];\n}\n\nconst snapTimeX = snapNumX;\n\n// this ensures that non-temporal/numeric y-axes get multiple-snapped padding added above/below\n// TODO: also account for incrs when snapping to ensure top of axis gets a tick & value\nfunction snapNumY(self, dataMin, dataMax) {\n\treturn dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, rangePad, true);\n}\n\nfunction snapLogY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeLog(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapLogX = snapLogY;\n\nfunction snapAsinhY(self, dataMin, dataMax, scale) {\n\treturn dataMin == null ? nullNullTuple : rangeAsinh(dataMin, dataMax, self.scales[scale].log, false);\n}\n\nconst snapAsinhX = snapAsinhY;\n\n// dim is logical (getClientBoundingRect) pixels, not canvas pixels\nfunction findIncr(minVal, maxVal, incrs, dim, minSpace) {\n\tlet intDigits = max(numIntDigits(minVal), numIntDigits(maxVal));\n\n\tlet delta = maxVal - minVal;\n\n\tlet incrIdx = closestIdx((minSpace / dim) * delta, incrs);\n\n\tdo {\n\t\tlet foundIncr = incrs[incrIdx];\n\t\tlet foundSpace = dim * foundIncr / delta;\n\n\t\tif (foundSpace >= minSpace && intDigits + (foundIncr < 5 ? fixedDec.get(foundIncr) : 0) <= 17)\n\t\t\treturn [foundIncr, foundSpace];\n\t} while (++incrIdx < incrs.length);\n\n\treturn [0, 0];\n}\n\nfunction pxRatioFont(font) {\n\tlet fontSize, fontSizeCss;\n\tfont = font.replace(/(\\d+)px/, (m, p1) => (fontSize = round((fontSizeCss = +p1) * pxRatio)) + 'px');\n\treturn [font, fontSize, fontSizeCss];\n}\n\nfunction syncFontSize(axis) {\n\tif (axis.show) {\n\t\t[axis.font, axis.labelFont].forEach(f => {\n\t\t\tlet size = roundDec(f[2] * pxRatio, 1);\n\t\t\tf[0] = f[0].replace(/[0-9.]+px/, size + 'px');\n\t\t\tf[1] = size;\n\t\t});\n\t}\n}\n\nfunction uPlot(opts, data, then) {\n\tconst self = {\n\t\tmode: ifNull(opts.mode, 1),\n\t};\n\n\tconst mode = self.mode;\n\n\tfunction getHPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? (1 - pct) : pct);\n\t}\n\n\tfunction getVPos(val, scale, dim, off) {\n\t\tlet pct = scale.valToPct(val);\n\t\treturn off + dim * (scale.dir == -1 ? pct : (1 - pct));\n\t}\n\n\tfunction getPos(val, scale, dim, off) {\n\t\treturn scale.ori == 0 ? getHPos(val, scale, dim, off) : getVPos(val, scale, dim, off);\n\t}\n\n\tself.valToPosH = getHPos;\n\tself.valToPosV = getVPos;\n\n\tlet ready = false;\n\tself.status = 0;\n\n\tconst root = self.root = placeDiv(UPLOT);\n\n\tif (opts.id != null)\n\t\troot.id = opts.id;\n\n\taddClass(root, opts.class);\n\n\tif (opts.title) {\n\t\tlet title = placeDiv(TITLE, root);\n\t\ttitle.textContent = opts.title;\n\t}\n\n\tconst can = placeTag(\"canvas\");\n\tconst ctx = self.ctx = can.getContext(\"2d\");\n\n\tconst wrap = placeDiv(WRAP, root);\n\n\ton(\"click\", wrap, e => {\n\t\tif (e.target === over) {\n\t\t\tlet didDrag = mouseLeft1 != mouseLeft0 || mouseTop1 != mouseTop0;\n\t\t\tdidDrag && drag.click(self, e);\n\t\t}\n\t}, true);\n\n\tconst under = self.under = placeDiv(UNDER, wrap);\n\twrap.appendChild(can);\n\tconst over = self.over = placeDiv(OVER, wrap);\n\n\topts = copy(opts);\n\n\tconst pxAlign = +ifNull(opts.pxAlign, 1);\n\n\tconst pxRound = pxRoundGen(pxAlign);\n\n\t(opts.plugins || []).forEach(p => {\n\t\tif (p.opts)\n\t\t\topts = p.opts(self, opts) || opts;\n\t});\n\n\tconst ms = opts.ms || 1e-3;\n\n\tconst series  = self.series = mode == 1 ?\n\t\tsetDefaults(opts.series || [], xSeriesOpts, ySeriesOpts, false) :\n\t\tsetDefaults2(opts.series || [null], xySeriesOpts);\n\tconst axes    = self.axes   = setDefaults(opts.axes   || [], xAxisOpts,   yAxisOpts,    true);\n\tconst scales  = self.scales = {};\n\tconst bands   = self.bands  = opts.bands || [];\n\n\tbands.forEach(b => {\n\t\tb.fill = fnOrSelf(b.fill || null);\n\t\tb.dir = ifNull(b.dir, -1);\n\t});\n\n\tconst xScaleKey = mode == 2 ? series[1].facets[0].scale : series[0].scale;\n\n\tconst drawOrderMap = {\n\t\taxes: drawAxesGrid,\n\t\tseries: drawSeries,\n\t};\n\n\tconst drawOrder = (opts.drawOrder || [\"axes\", \"series\"]).map(key => drawOrderMap[key]);\n\n\tfunction initValToPct(sc) {\n\t\tconst getVal = (\n\t\t\tsc.distr == 3   ? val => log10(val > 0 ? val : sc.clamp(self, val, sc.min, sc.max, sc.key)) :\n\t\t\tsc.distr == 4   ? val => asinh(val, sc.asinh) :\n\t\t\tsc.distr == 100 ? val => sc.fwd(val) :\n\t\t\tval => val\n\t\t);\n\n\t\treturn val => {\n\t\t\tlet _val = getVal(val);\n\t\t\tlet { _min, _max } = sc;\n\t\t\tlet delta = _max - _min;\n\t\t\treturn (_val - _min) / delta;\n\t\t};\n\t}\n\n\tfunction initScale(scaleKey) {\n\t\tlet sc = scales[scaleKey];\n\n\t\tif (sc == null) {\n\t\t\tlet scaleOpts = (opts.scales || EMPTY_OBJ)[scaleKey] || EMPTY_OBJ;\n\n\t\t\tif (scaleOpts.from != null) {\n\t\t\t\t// ensure parent is initialized\n\t\t\t\tinitScale(scaleOpts.from);\n\t\t\t\t// dependent scales inherit\n\t\t\t\tlet sc = assign({}, scales[scaleOpts.from], scaleOpts, {key: scaleKey});\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t\tscales[scaleKey] = sc;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsc = scales[scaleKey] = assign({}, (scaleKey == xScaleKey ? xScaleOpts : yScaleOpts), scaleOpts);\n\n\t\t\t\tsc.key = scaleKey;\n\n\t\t\t\tlet isTime = sc.time;\n\n\t\t\t\tlet rn = sc.range;\n\n\t\t\t\tlet rangeIsArr = isArr(rn);\n\n\t\t\t\tif (scaleKey != xScaleKey || (mode == 2 && !isTime)) {\n\t\t\t\t\t// if range array has null limits, it should be auto\n\t\t\t\t\tif (rangeIsArr && (rn[0] == null || rn[1] == null)) {\n\t\t\t\t\t\trn = {\n\t\t\t\t\t\t\tmin: rn[0] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[0],\n\t\t\t\t\t\t\t\tsoft: rn[0],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmax: rn[1] == null ? autoRangePart : {\n\t\t\t\t\t\t\t\tmode: 1,\n\t\t\t\t\t\t\t\thard: rn[1],\n\t\t\t\t\t\t\t\tsoft: rn[1],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t\trangeIsArr = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!rangeIsArr && isObj(rn)) {\n\t\t\t\t\t\tlet cfg = rn;\n\t\t\t\t\t\t// this is similar to snapNumY\n\t\t\t\t\t\trn = (self, dataMin, dataMax) => dataMin == null ? nullNullTuple : rangeNum(dataMin, dataMax, cfg);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsc.range = fnOrSelf(rn || (isTime ? snapTimeX : scaleKey == xScaleKey ?\n\t\t\t\t\t(sc.distr == 3 ? snapLogX : sc.distr == 4 ? snapAsinhX : snapNumX) :\n\t\t\t\t\t(sc.distr == 3 ? snapLogY : sc.distr == 4 ? snapAsinhY : snapNumY)\n\t\t\t\t));\n\n\t\t\t\tsc.auto = fnOrSelf(rangeIsArr ? false : sc.auto);\n\n\t\t\t\tsc.clamp = fnOrSelf(sc.clamp || clampScale);\n\n\t\t\t\t// caches for expensive ops like asinh() & log()\n\t\t\t\tsc._min = sc._max = null;\n\n\t\t\t\tsc.valToPct = initValToPct(sc);\n\t\t\t}\n\t\t}\n\t}\n\n\tinitScale(\"x\");\n\tinitScale(\"y\");\n\n\t// TODO: init scales from facets in mode: 2\n\tif (mode == 1) {\n\t\tseries.forEach(s => {\n\t\t\tinitScale(s.scale);\n\t\t});\n\t}\n\n\taxes.forEach(a => {\n\t\tinitScale(a.scale);\n\t});\n\n\tfor (let k in opts.scales)\n\t\tinitScale(k);\n\n\tconst scaleX = scales[xScaleKey];\n\n\tconst xScaleDistr = scaleX.distr;\n\n\tlet valToPosX, valToPosY;\n\n\tif (scaleX.ori == 0) {\n\t\taddClass(root, ORI_HZ);\n\t\tvalToPosX = getHPos;\n\t\tvalToPosY = getVPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotWid;\n\t\t\txOffCan = plotLft;\n\t\t\tyDimCan = plotHgt;\n\t\t\tyOffCan = plotTop;\n\n\t\t\txDimCss = plotWidCss;\n\t\t\txOffCss = plotLftCss;\n\t\t\tyDimCss = plotHgtCss;\n\t\t\tyOffCss = plotTopCss;\n\t\t};\n\t\t*/\n\t}\n\telse {\n\t\taddClass(root, ORI_VT);\n\t\tvalToPosX = getVPos;\n\t\tvalToPosY = getHPos;\n\t\t/*\n\t\tupdOriDims = () => {\n\t\t\txDimCan = plotHgt;\n\t\t\txOffCan = plotTop;\n\t\t\tyDimCan = plotWid;\n\t\t\tyOffCan = plotLft;\n\n\t\t\txDimCss = plotHgtCss;\n\t\t\txOffCss = plotTopCss;\n\t\t\tyDimCss = plotWidCss;\n\t\t\tyOffCss = plotLftCss;\n\t\t};\n\t\t*/\n\t}\n\n\tconst pendScales = {};\n\n\t// explicitly-set initial scales\n\tfor (let k in scales) {\n\t\tlet sc = scales[k];\n\n\t\tif (sc.min != null || sc.max != null) {\n\t\t\tpendScales[k] = {min: sc.min, max: sc.max};\n\t\t\tsc.min = sc.max = null;\n\t\t}\n\t}\n\n//\tself.tz = opts.tz || Intl.DateTimeFormat().resolvedOptions().timeZone;\n\tconst _tzDate  = (opts.tzDate || (ts => new Date(round(ts / ms))));\n\tconst _fmtDate = (opts.fmtDate || fmtDate);\n\n\tconst _timeAxisSplits = (ms == 1 ? timeAxisSplitsMs(_tzDate) : timeAxisSplitsS(_tzDate));\n\tconst _timeAxisVals   = timeAxisVals(_tzDate, timeAxisStamps((ms == 1 ? _timeAxisStampsMs : _timeAxisStampsS), _fmtDate));\n\tconst _timeSeriesVal  = timeSeriesVal(_tzDate, timeSeriesStamp(_timeSeriesStamp, _fmtDate));\n\n\tconst activeIdxs = [];\n\n\tconst legend     = (self.legend = assign({}, legendOpts, opts.legend));\n\tconst cursor     =                (self.cursor = assign({}, cursorOpts, {drag: {y: mode == 2}}, opts.cursor));\n\tconst showLegend = legend.show;\n\tconst showCursor =                cursor.show;\n\tconst markers    = legend.markers;\n\n\t{\n\t\tlegend.idxs = activeIdxs;\n\n\t\tmarkers.width  = fnOrSelf(markers.width);\n\t\tmarkers.dash   = fnOrSelf(markers.dash);\n\t\tmarkers.stroke = fnOrSelf(markers.stroke);\n\t\tmarkers.fill   = fnOrSelf(markers.fill);\n\t}\n\n\tlet legendTable;\n\tlet legendHead;\n\tlet legendBody;\n\tlet legendRows = [];\n\tlet legendCells = [];\n\tlet legendCols;\n\tlet multiValLegend = false;\n\tlet NULL_LEGEND_VALUES = {};\n\n\tif (legend.live) {\n\t\tconst getMultiVals = series[1] ? series[1].values : null;\n\t\tmultiValLegend = getMultiVals != null;\n\t\tlegendCols = multiValLegend ? getMultiVals(self, 1, 0) : {_: 0};\n\n\t\tfor (let k in legendCols)\n\t\t\tNULL_LEGEND_VALUES[k] = LEGEND_DISP;\n\t}\n\n\tif (showLegend) {\n\t\tlegendTable = placeTag(\"table\", LEGEND, root);\n\t\tlegendBody = placeTag(\"tbody\", null, legendTable);\n\n\t\t// allows legend to be moved out of root\n\t\tlegend.mount(self, legendTable);\n\n\t\tif (multiValLegend) {\n\t\t\tlegendHead = placeTag(\"thead\", null, legendTable, legendBody);\n\n\t\t\tlet head = placeTag(\"tr\", null, legendHead);\n\t\t\tplaceTag(\"th\", null, head);\n\n\t\t\tfor (var key in legendCols)\n\t\t\t\tplaceTag(\"th\", LEGEND_LABEL, head).textContent = key;\n\t\t}\n\t\telse {\n\t\t\taddClass(legendTable, LEGEND_INLINE);\n\t\t\tlegend.live && addClass(legendTable, LEGEND_LIVE);\n\t\t}\n\t}\n\n\tconst son  = {show: true};\n\tconst soff = {show: false};\n\n\tfunction initLegendRow(s, i) {\n\t\tif (i == 0 && (multiValLegend || !legend.live || mode == 2))\n\t\t\treturn nullNullTuple;\n\n\t\tlet cells = [];\n\n\t\tlet row = placeTag(\"tr\", LEGEND_SERIES, legendBody, legendBody.childNodes[i]);\n\n\t\taddClass(row, s.class);\n\n\t\tif (!s.show)\n\t\t\taddClass(row, OFF);\n\n\t\tlet label = placeTag(\"th\", null, row);\n\n\t\tif (markers.show) {\n\t\t\tlet indic = placeDiv(LEGEND_MARKER, label);\n\n\t\t\tif (i > 0) {\n\t\t\t\tlet width  = markers.width(self, i);\n\n\t\t\t\tif (width)\n\t\t\t\t\tindic.style.border = width + \"px \" + markers.dash(self, i) + \" \" + markers.stroke(self, i);\n\n\t\t\t\tindic.style.background = markers.fill(self, i);\n\t\t\t}\n\t\t}\n\n\t\tlet text = placeDiv(LEGEND_LABEL, label);\n\n\t\tif (s.label instanceof HTMLElement)\n\t\t\ttext.appendChild(s.label);\n\t\telse\n\t\t\ttext.textContent = s.label;\n\n\t\tif (i > 0) {\n\t\t\tif (!markers.show)\n\t\t\t\ttext.style.color = s.width > 0 ? markers.stroke(self, i) : markers.fill(self, i);\n\n\t\t\tonMouse(\"click\", label, e => {\n\t\t\t\tif (cursor._lock)\n\t\t\t\t\treturn;\n\n\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\tlet seriesIdx = series.indexOf(s);\n\n\t\t\t\tif ((e.ctrlKey || e.metaKey) != legend.isolate) {\n\t\t\t\t\t// if any other series is shown, isolate this one. else show all\n\t\t\t\t\tlet isolate = series.some((s, i) => i > 0 && i != seriesIdx && s.show);\n\n\t\t\t\t\tseries.forEach((s, i) => {\n\t\t\t\t\t\ti > 0 && setSeries(i, isolate ? (i == seriesIdx ? son : soff) : son, true, syncOpts.setSeries);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tsetSeries(seriesIdx, {show: !s.show}, true, syncOpts.setSeries);\n\t\t\t}, false);\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tonMouse(mouseenter, label, e => {\n\t\t\t\t\tif (cursor._lock)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tsetCursorEvent(e);\n\n\t\t\t\t\tsetSeries(series.indexOf(s), FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t\t\t}, false);\n\t\t\t}\n\t\t}\n\n\t\tfor (var key in legendCols) {\n\t\t\tlet v = placeTag(\"td\", LEGEND_VALUE, row);\n\t\t\tv.textContent = \"--\";\n\t\t\tcells.push(v);\n\t\t}\n\n\t\treturn [row, cells];\n\t}\n\n\tconst mouseListeners = new Map();\n\n\tfunction onMouse(ev, targ, fn, onlyTarg = true) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\t\tconst listener = cursor.bind[ev](self, targ, fn, onlyTarg);\n\n\t\tif (listener) {\n\t\t\ton(ev, targ, targListeners[ev] = listener);\n\t\t\tmouseListeners.set(targ, targListeners);\n\t\t}\n\t}\n\n\tfunction offMouse(ev, targ, fn) {\n\t\tconst targListeners = mouseListeners.get(targ) || {};\n\n\t\tfor (let k in targListeners) {\n\t\t\tif (ev == null || k == ev) {\n\t\t\t\toff(k, targ, targListeners[k]);\n\t\t\t\tdelete targListeners[k];\n\t\t\t}\n\t\t}\n\n\t\tif (ev == null)\n\t\t\tmouseListeners.delete(targ);\n\t}\n\n\tlet fullWidCss = 0;\n\tlet fullHgtCss = 0;\n\n\tlet plotWidCss = 0;\n\tlet plotHgtCss = 0;\n\n\t// plot margins to account for axes\n\tlet plotLftCss = 0;\n\tlet plotTopCss = 0;\n\n\t// previous values for diffing\n\tlet _plotLftCss = plotLftCss;\n\tlet _plotTopCss = plotTopCss;\n\tlet _plotWidCss = plotWidCss;\n\tlet _plotHgtCss = plotHgtCss;\n\n\n\tlet plotLft = 0;\n\tlet plotTop = 0;\n\tlet plotWid = 0;\n\tlet plotHgt = 0;\n\n\tself.bbox = {};\n\n\tlet shouldSetScales = false;\n\tlet shouldSetSize = false;\n\tlet shouldConvergeSize = false;\n\tlet shouldSetCursor = false;\n\tlet shouldSetSelect = false;\n\tlet shouldSetLegend = false;\n\n\tfunction _setSize(width, height, force) {\n\t\tif (force || (width != self.width || height != self.height))\n\t\t\tcalcSize(width, height);\n\n\t\tresetYSeries(false);\n\n\t\tshouldConvergeSize = true;\n\t\tshouldSetSize = true;\n\n\t\tcommit();\n\t}\n\n\tfunction calcSize(width, height) {\n\t//\tlog(\"calcSize()\", arguments);\n\n\t\tself.width  = fullWidCss = plotWidCss = width;\n\t\tself.height = fullHgtCss = plotHgtCss = height;\n\t\tplotLftCss  = plotTopCss = 0;\n\n\t\tcalcPlotRect();\n\t\tcalcAxesRects();\n\n\t\tlet bb = self.bbox;\n\n\t\tplotLft = bb.left   = incrRound(plotLftCss * pxRatio, 0.5);\n\t\tplotTop = bb.top    = incrRound(plotTopCss * pxRatio, 0.5);\n\t\tplotWid = bb.width  = incrRound(plotWidCss * pxRatio, 0.5);\n\t\tplotHgt = bb.height = incrRound(plotHgtCss * pxRatio, 0.5);\n\n\t//\tupdOriDims();\n\t}\n\n\t// ensures size calc convergence\n\tconst CYCLE_LIMIT = 3;\n\n\tfunction convergeSize() {\n\t\tlet converged = false;\n\n\t\tlet cycleNum = 0;\n\n\t\twhile (!converged) {\n\t\t\tcycleNum++;\n\n\t\t\tlet axesConverged = axesCalc(cycleNum);\n\t\t\tlet paddingConverged = paddingCalc(cycleNum);\n\n\t\t\tconverged = cycleNum == CYCLE_LIMIT || (axesConverged && paddingConverged);\n\n\t\t\tif (!converged) {\n\t\t\t\tcalcSize(self.width, self.height);\n\t\t\t\tshouldSetSize = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setSize({width, height}) {\n\t\t_setSize(width, height);\n\t}\n\n\tself.setSize = setSize;\n\n\t// accumulate axis offsets, reduce canvas width\n\tfunction calcPlotRect() {\n\t\t// easements for edge labels\n\t\tlet hasTopAxis = false;\n\t\tlet hasBtmAxis = false;\n\t\tlet hasRgtAxis = false;\n\t\tlet hasLftAxis = false;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet {side, _size} = axis;\n\t\t\t\tlet isVt = side % 2;\n\t\t\t\tlet labelSize = axis.label != null ? axis.labelSize : 0;\n\n\t\t\t\tlet fullSize = _size + labelSize;\n\n\t\t\t\tif (fullSize > 0) {\n\t\t\t\t\tif (isVt) {\n\t\t\t\t\t\tplotWidCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 3) {\n\t\t\t\t\t\t\tplotLftCss += fullSize;\n\t\t\t\t\t\t\thasLftAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasRgtAxis = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tplotHgtCss -= fullSize;\n\n\t\t\t\t\t\tif (side == 0) {\n\t\t\t\t\t\t\tplotTopCss += fullSize;\n\t\t\t\t\t\t\thasTopAxis = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\thasBtmAxis = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tsidesWithAxes[0] = hasTopAxis;\n\t\tsidesWithAxes[1] = hasRgtAxis;\n\t\tsidesWithAxes[2] = hasBtmAxis;\n\t\tsidesWithAxes[3] = hasLftAxis;\n\n\t\t// hz padding\n\t\tplotWidCss -= _padding[1] + _padding[3];\n\t\tplotLftCss += _padding[3];\n\n\t\t// vt padding\n\t\tplotHgtCss -= _padding[2] + _padding[0];\n\t\tplotTopCss += _padding[0];\n\t}\n\n\tfunction calcAxesRects() {\n\t\t// will accum +\n\t\tlet off1 = plotLftCss + plotWidCss;\n\t\tlet off2 = plotTopCss + plotHgtCss;\n\t\t// will accum -\n\t\tlet off3 = plotLftCss;\n\t\tlet off0 = plotTopCss;\n\n\t\tfunction incrOffset(side, size) {\n\t\t\tswitch (side) {\n\t\t\t\tcase 1: off1 += size; return off1 - size;\n\t\t\t\tcase 2: off2 += size; return off2 - size;\n\t\t\t\tcase 3: off3 -= size; return off3 + size;\n\t\t\t\tcase 0: off0 -= size; return off0 + size;\n\t\t\t}\n\t\t}\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (axis.show && axis._show) {\n\t\t\t\tlet side = axis.side;\n\n\t\t\t\taxis._pos = incrOffset(side, axis._size);\n\n\t\t\t\tif (axis.label != null)\n\t\t\t\t\taxis._lpos = incrOffset(side, axis.labelSize);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (cursor.dataIdx == null) {\n\t\tlet hov = cursor.hover;\n\n\t\tlet skip = hov.skip = new Set(hov.skip ?? []);\n\t\tskip.add(void 0); // alignment artifacts\n\t\tlet prox = hov.prox = fnOrSelf(hov.prox);\n\t\tlet bias = hov.bias ??= 0;\n\n\t\t// TODO: only scan between in-view idxs (i0, i1)\n\t\tcursor.dataIdx = (self, seriesIdx, cursorIdx, valAtPosX) => {\n\t\t\tif (seriesIdx == 0)\n\t\t\t\treturn cursorIdx;\n\n\t\t\tlet idx2 = cursorIdx;\n\n\t\t\tlet _prox = prox(self, seriesIdx, cursorIdx, valAtPosX) ?? inf;\n\t\t\tlet withProx = _prox >= 0 && _prox < inf;\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\t\tlet cursorLft = cursor.left;\n\n\t\t\tlet xValues = data[0];\n\t\t\tlet yValues = data[seriesIdx];\n\n\t\t\tif (skip.has(yValues[cursorIdx])) {\n\t\t\t\tidx2 = null;\n\n\t\t\t\tlet nonNullLft = null,\n\t\t\t\t\tnonNullRgt = null,\n\t\t\t\t\tj;\n\n\t\t\t\tif (bias == 0 || bias == -1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullLft == null && j-- > 0) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullLft = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (bias == 0 || bias == 1) {\n\t\t\t\t\tj = cursorIdx;\n\t\t\t\t\twhile (nonNullRgt == null && j++ < yValues.length) {\n\t\t\t\t\t\tif (!skip.has(yValues[j]))\n\t\t\t\t\t\t\tnonNullRgt = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (nonNullLft != null || nonNullRgt != null) {\n\t\t\t\t\tif (withProx) {\n\t\t\t\t\t\tlet lftPos = nonNullLft == null ? -Infinity : valToPosX(xValues[nonNullLft], scaleX, xDim, 0);\n\t\t\t\t\t\tlet rgtPos = nonNullRgt == null ?  Infinity : valToPosX(xValues[nonNullRgt], scaleX, xDim, 0);\n\n\t\t\t\t\t\tlet lftDelta = cursorLft - lftPos;\n\t\t\t\t\t\tlet rgtDelta = rgtPos - cursorLft;\n\n\t\t\t\t\t\tif (lftDelta <= rgtDelta) {\n\t\t\t\t\t\t\tif (lftDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullLft;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (rgtDelta <= _prox)\n\t\t\t\t\t\t\t\tidx2 = nonNullRgt;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tidx2 =\n\t\t\t\t\t\t\tnonNullRgt == null ? nonNullLft :\n\t\t\t\t\t\t\tnonNullLft == null ? nonNullRgt :\n\t\t\t\t\t\t\tcursorIdx - nonNullLft <= nonNullRgt - cursorIdx ? nonNullLft : nonNullRgt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (withProx) {\n\t\t\t\tlet dist = abs(cursorLft - valToPosX(xValues[cursorIdx], scaleX, xDim, 0));\n\n\t\t\t\tif (dist > _prox)\n\t\t\t\t\tidx2 = null;\n\t\t\t}\n\n\t\t\treturn idx2;\n\t\t};\n\t}\n\n\tconst setCursorEvent = e => { cursor.event = e; };\n\n\tcursor.idxs = activeIdxs;\n\n\tcursor._lock = false;\n\n\tlet points = cursor.points;\n\n\tpoints.show   = fnOrSelf(points.show);\n\tpoints.size   = fnOrSelf(points.size);\n\tpoints.stroke = fnOrSelf(points.stroke);\n\tpoints.width  = fnOrSelf(points.width);\n\tpoints.fill   = fnOrSelf(points.fill);\n\n\tconst focus = self.focus = assign({}, opts.focus || {alpha: 0.3}, cursor.focus);\n\n\tconst cursorFocus = focus.prox >= 0;\n\tconst cursorOnePt = cursorFocus && points.one;\n\n\t// series-intersection markers\n\tlet cursorPts = [];\n\t// position caches in CSS pixels\n\tlet cursorPtsLft = [];\n\tlet cursorPtsTop = [];\n\n\tfunction initCursorPt(s, si) {\n\t\tlet pt = points.show(self, si);\n\n\t\tif (pt instanceof HTMLElement) {\n\t\t\taddClass(pt, CURSOR_PT);\n\t\t\taddClass(pt, s.class);\n\t\t\telTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\tover.insertBefore(pt, cursorPts[si]);\n\n\t\t\treturn pt;\n\t\t}\n\t}\n\n\tfunction initSeries(s, i) {\n\t\tif (mode == 1 || i > 0) {\n\t\t\tlet isTime = mode == 1 && scales[s.scale].time;\n\n\t\t\tlet sv = s.value;\n\t\t\ts.value = isTime ? (isStr(sv) ? timeSeriesVal(_tzDate, timeSeriesStamp(sv, _fmtDate)) : sv || _timeSeriesVal) : sv || numSeriesVal;\n\t\t\ts.label = s.label || (isTime ? timeSeriesLabel : numSeriesLabel);\n\t\t}\n\n\t\tif (cursorOnePt || i > 0) {\n\t\t\ts.width  = s.width == null ? 1 : s.width;\n\t\t\ts.paths  = s.paths || linearPath || retNull;\n\t\t\ts.fillTo = fnOrSelf(s.fillTo || seriesFillTo);\n\t\t\ts.pxAlign = +ifNull(s.pxAlign, pxAlign);\n\t\t\ts.pxRound = pxRoundGen(s.pxAlign);\n\n\t\t\ts.stroke = fnOrSelf(s.stroke || null);\n\t\t\ts.fill   = fnOrSelf(s.fill || null);\n\t\t\ts._stroke = s._fill = s._paths = s._focus = null;\n\n\t\t\tlet _ptDia = ptDia(max(1, s.width), 1);\n\t\t\tlet points = s.points = assign({}, {\n\t\t\t\tsize: _ptDia,\n\t\t\t\twidth: max(1, _ptDia * .2),\n\t\t\t\tstroke: s.stroke,\n\t\t\t\tspace: _ptDia * 2,\n\t\t\t\tpaths: pointsPath,\n\t\t\t\t_stroke: null,\n\t\t\t\t_fill: null,\n\t\t\t}, s.points);\n\t\t\tpoints.show   = fnOrSelf(points.show);\n\t\t\tpoints.filter = fnOrSelf(points.filter);\n\t\t\tpoints.fill   = fnOrSelf(points.fill);\n\t\t\tpoints.stroke = fnOrSelf(points.stroke);\n\t\t\tpoints.paths  = fnOrSelf(points.paths);\n\t\t\tpoints.pxAlign = s.pxAlign;\n\t\t}\n\n\t\tif (showLegend) {\n\t\t\tlet rowCells = initLegendRow(s, i);\n\t\t\tlegendRows.splice(i, 0, rowCells[0]);\n\t\t\tlegendCells.splice(i, 0, rowCells[1]);\n\t\t\tlegend.values.push(null);\t// NULL_LEGEND_VALS not yet avil here :(\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 0, null);\n\n\t\t\tlet pt = null;\n\n\t\t\tif (cursorOnePt) {\n\t\t\t\tif (i == 0)\n\t\t\t\t\tpt = initCursorPt(s, i);\n\t\t\t}\n\t\t\telse if (i > 0)\n\t\t\t\tpt = initCursorPt(s, i);\n\n\t\t\tcursorPts.splice(i, 0, pt);\n\t\t\tcursorPtsLft.splice(i, 0, 0);\n\t\t\tcursorPtsTop.splice(i, 0, 0);\n\t\t}\n\n\t\tfire(\"addSeries\", i);\n\t}\n\n\tfunction addSeries(opts, si) {\n\t\tsi = si == null ? series.length : si;\n\n\t\topts = mode == 1 ? setDefault(opts, si, xSeriesOpts, ySeriesOpts) : setDefault(opts, si, {}, xySeriesOpts);\n\n\t\tseries.splice(si, 0, opts);\n\t\tinitSeries(series[si], si);\n\t}\n\n\tself.addSeries = addSeries;\n\n\tfunction delSeries(i) {\n\t\tseries.splice(i, 1);\n\n\t\tif (showLegend) {\n\t\t\tlegend.values.splice(i, 1);\n\n\t\t\tlegendCells.splice(i, 1);\n\t\t\tlet tr = legendRows.splice(i, 1)[0];\n\t\t\toffMouse(null, tr.firstChild);\n\t\t\ttr.remove();\n\t\t}\n\n\t\tif (showCursor) {\n\t\t\tactiveIdxs.splice(i, 1);\n\t\t\tcursorPts.splice(i, 1)[0].remove();\n\t\t\tcursorPtsLft.splice(i, 1);\n\t\t\tcursorPtsTop.splice(i, 1);\n\t\t}\n\n\t\t// TODO: de-init no-longer-needed scales?\n\n\t\tfire(\"delSeries\", i);\n\t}\n\n\tself.delSeries = delSeries;\n\n\tconst sidesWithAxes = [false, false, false, false];\n\n\tfunction initAxis(axis, i) {\n\t\taxis._show = axis.show;\n\n\t\tif (axis.show) {\n\t\t\tlet isVt = axis.side % 2;\n\n\t\t\tlet sc = scales[axis.scale];\n\n\t\t\t// this can occur if all series specify non-default scales\n\t\t\tif (sc == null) {\n\t\t\t\taxis.scale = isVt ? series[1].scale : xScaleKey;\n\t\t\t\tsc = scales[axis.scale];\n\t\t\t}\n\n\t\t\t// also set defaults for incrs & values based on axis distr\n\t\t\tlet isTime = sc.time;\n\n\t\t\taxis.size   = fnOrSelf(axis.size);\n\t\t\taxis.space  = fnOrSelf(axis.space);\n\t\t\taxis.rotate = fnOrSelf(axis.rotate);\n\n\t\t\tif (isArr(axis.incrs)) {\n\t\t\t\taxis.incrs.forEach(incr => {\n\t\t\t\t\t!fixedDec.has(incr) && fixedDec.set(incr, guessDec(incr));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\taxis.incrs  = fnOrSelf(axis.incrs  || (          sc.distr == 2 ? wholeIncrs : (isTime ? (ms == 1 ? timeIncrsMs : timeIncrsS) : numIncrs)));\n\t\t\taxis.splits = fnOrSelf(axis.splits || (isTime && sc.distr == 1 ? _timeAxisSplits : sc.distr == 3 ? logAxisSplits : sc.distr == 4 ? asinhAxisSplits : numAxisSplits));\n\n\t\t\taxis.stroke        = fnOrSelf(axis.stroke);\n\t\t\taxis.grid.stroke   = fnOrSelf(axis.grid.stroke);\n\t\t\taxis.ticks.stroke  = fnOrSelf(axis.ticks.stroke);\n\t\t\taxis.border.stroke = fnOrSelf(axis.border.stroke);\n\n\t\t\tlet av = axis.values;\n\n\t\t\taxis.values = (\n\t\t\t\t// static array of tick values\n\t\t\t\tisArr(av) && !isArr(av[0]) ? fnOrSelf(av) :\n\t\t\t\t// temporal\n\t\t\t\tisTime ? (\n\t\t\t\t\t// config array of fmtDate string tpls\n\t\t\t\t\tisArr(av) ?\n\t\t\t\t\t\ttimeAxisVals(_tzDate, timeAxisStamps(av, _fmtDate)) :\n\t\t\t\t\t// fmtDate string tpl\n\t\t\t\t\tisStr(av) ?\n\t\t\t\t\t\ttimeAxisVal(_tzDate, av) :\n\t\t\t\t\tav || _timeAxisVals\n\t\t\t\t) : av || numAxisVals\n\t\t\t);\n\n\t\t\taxis.filter = fnOrSelf(axis.filter || (          sc.distr >= 3 && sc.log == 10 ? log10AxisValsFilt : sc.distr == 3 && sc.log == 2 ? log2AxisValsFilt : retArg1));\n\n\t\t\taxis.font      = pxRatioFont(axis.font);\n\t\t\taxis.labelFont = pxRatioFont(axis.labelFont);\n\n\t\t\taxis._size   = axis.size(self, null, i, 0);\n\n\t\t\taxis._space  =\n\t\t\taxis._rotate =\n\t\t\taxis._incrs  =\n\t\t\taxis._found  =\t// foundIncrSpace\n\t\t\taxis._splits =\n\t\t\taxis._values = null;\n\n\t\t\tif (axis._size > 0) {\n\t\t\t\tsidesWithAxes[i] = true;\n\t\t\t\taxis._el = placeDiv(AXIS, wrap);\n\t\t\t}\n\n\t\t\t// debug\n\t\t//\taxis._el.style.background = \"#\"  + Math.floor(Math.random()*16777215).toString(16) + '80';\n\t\t}\n\t}\n\n\tfunction autoPadSide(self, side, sidesWithAxes, cycleNum) {\n\t\tlet [hasTopAxis, hasRgtAxis, hasBtmAxis, hasLftAxis] = sidesWithAxes;\n\n\t\tlet ori = side % 2;\n\t\tlet size = 0;\n\n\t\tif (ori == 0 && (hasLftAxis || hasRgtAxis))\n\t\t\tsize = (side == 0 && !hasTopAxis || side == 2 && !hasBtmAxis ? round(xAxisOpts.size / 3) : 0);\n\t\tif (ori == 1 && (hasTopAxis || hasBtmAxis))\n\t\t\tsize = (side == 1 && !hasRgtAxis || side == 3 && !hasLftAxis ? round(yAxisOpts.size / 2) : 0);\n\n\t\treturn size;\n\t}\n\n\tconst padding = self.padding = (opts.padding || [autoPadSide,autoPadSide,autoPadSide,autoPadSide]).map(p => fnOrSelf(ifNull(p, autoPadSide)));\n\tconst _padding = self._padding = padding.map((p, i) => p(self, i, sidesWithAxes, 0));\n\n\tlet dataLen;\n\n\t// rendered data window\n\tlet i0 = null;\n\tlet i1 = null;\n\tconst idxs = mode == 1 ? series[0].idxs : null;\n\n\tlet data0 = null;\n\n\tlet viaAutoScaleX = false;\n\n\tfunction setData(_data, _resetScales) {\n\t\tdata = _data == null ? [] : _data;\n\n\t\tself.data = self._data = data;\n\n\t\tif (mode == 2) {\n\t\t\tdataLen = 0;\n\t\t\tfor (let i = 1; i < series.length; i++)\n\t\t\t\tdataLen += data[i][0].length;\n\t\t}\n\t\telse {\n\t\t\tif (data.length == 0)\n\t\t\t\tself.data = self._data = data = [[]];\n\n\t\t\tdata0 = data[0];\n\t\t\tdataLen = data0.length;\n\n\t\t\tlet scaleData = data;\n\n\t\t\tif (xScaleDistr == 2) {\n\t\t\t\tscaleData = data.slice();\n\n\t\t\t\tlet _data0 = scaleData[0] = Array(dataLen);\n\t\t\t\tfor (let i = 0; i < dataLen; i++)\n\t\t\t\t\t_data0[i] = i;\n\t\t\t}\n\n\t\t\tself._data = data = scaleData;\n\t\t}\n\n\t\tresetYSeries(true);\n\n\t\tfire(\"setData\");\n\n\t\t// forces x axis tick values to re-generate when neither x scale nor y scale changes\n\t\t// in ordinal mode, scale range is by index, so will not change if new data has same length, but tick values are from data\n\t\tif (xScaleDistr == 2) {\n\t\t\tshouldConvergeSize = true;\n\n\t\t\t/* or somewhat cheaper, and uglier:\n\t\t\tif (ready) {\n\t\t\t\t// logic extracted from axesCalc()\n\t\t\t\tlet i = 0;\n\t\t\t\tlet axis = axes[i];\n\t\t\t\tlet _splits = axis._splits.map(i => data0[i]);\n\t\t\t\tlet [_incr, _space] = axis._found;\n\t\t\t\tlet incr = data0[_splits[1]] - data0[_splits[0]];\n\t\t\t\taxis._values = axis.values(self, axis.filter(self, _splits, i, _space, incr), i, _space, incr);\n\t\t\t}\n\t\t\t*/\n\t\t}\n\n\t\tif (_resetScales !== false) {\n\t\t\tlet xsc = scaleX;\n\n\t\t\tif (xsc.auto(self, viaAutoScaleX))\n\t\t\t\tautoScaleX();\n\t\t\telse\n\t\t\t\t_setScale(xScaleKey, xsc.min, xsc.max);\n\n\t\t\tshouldSetCursor = shouldSetCursor || cursor.left >= 0;\n\t\t\tshouldSetLegend = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setData = setData;\n\n\tfunction autoScaleX() {\n\t\tviaAutoScaleX = true;\n\n\t\tlet _min, _max;\n\n\t\tif (mode == 1) {\n\t\t\tif (dataLen > 0) {\n\t\t\t\ti0 = idxs[0] = 0;\n\t\t\t\ti1 = idxs[1] = dataLen - 1;\n\n\t\t\t\t_min = data[0][i0];\n\t\t\t\t_max = data[0][i1];\n\n\t\t\t\tif (xScaleDistr == 2) {\n\t\t\t\t\t_min = i0;\n\t\t\t\t\t_max = i1;\n\t\t\t\t}\n\t\t\t\telse if (_min == _max) {\n\t\t\t\t\tif (xScaleDistr == 3)\n\t\t\t\t\t\t[_min, _max] = rangeLog(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (xScaleDistr == 4)\n\t\t\t\t\t\t[_min, _max] = rangeAsinh(_min, _min, scaleX.log, false);\n\t\t\t\t\telse if (scaleX.time)\n\t\t\t\t\t\t_max = _min + round(86400 / ms);\n\t\t\t\t\telse\n\t\t\t\t\t\t[_min, _max] = rangeNum(_min, _max, rangePad, true);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ti0 = idxs[0] = _min = null;\n\t\t\t\ti1 = idxs[1] = _max = null;\n\t\t\t}\n\t\t}\n\n\t\t_setScale(xScaleKey, _min, _max);\n\t}\n\n\tlet ctxStroke, ctxFill, ctxWidth, ctxDash, ctxJoin, ctxCap, ctxFont, ctxAlign, ctxBaseline;\n\tlet ctxAlpha;\n\n\tfunction setCtxStyle(stroke, width, dash, cap, fill, join) {\n\t\tstroke ??= transparent;\n\t\tdash   ??= EMPTY_ARR;\n\t\tcap    ??= \"butt\"; // (â€¿|â€¿)\n\t\tfill   ??= transparent;\n\t\tjoin   ??= \"round\";\n\n\t\tif (stroke != ctxStroke)\n\t\t\tctx.strokeStyle = ctxStroke = stroke;\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (width != ctxWidth)\n\t\t\tctx.lineWidth = ctxWidth = width;\n\t\tif (join != ctxJoin)\n\t\t\tctx.lineJoin = ctxJoin = join;\n\t\tif (cap != ctxCap)\n\t\t\tctx.lineCap = ctxCap = cap;\n\t\tif (dash != ctxDash)\n\t\t\tctx.setLineDash(ctxDash = dash);\n\t}\n\n\tfunction setFontStyle(font, fill, align, baseline) {\n\t\tif (fill != ctxFill)\n\t\t\tctx.fillStyle = ctxFill = fill;\n\t\tif (font != ctxFont)\n\t\t\tctx.font = ctxFont = font;\n\t\tif (align != ctxAlign)\n\t\t\tctx.textAlign = ctxAlign = align;\n\t\tif (baseline != ctxBaseline)\n\t\t\tctx.textBaseline = ctxBaseline = baseline;\n\t}\n\n\tfunction accScale(wsc, psc, facet, data, sorted = 0) {\n\t\tif (data.length > 0 && wsc.auto(self, viaAutoScaleX) && (psc == null || psc.min == null)) {\n\t\t\tlet _i0 = ifNull(i0, 0);\n\t\t\tlet _i1 = ifNull(i1, data.length - 1);\n\n\t\t\t// only run getMinMax() for invalidated series data, else reuse\n\t\t\tlet minMax = facet.min == null ? getMinMax(data, _i0, _i1, sorted, wsc.distr == 3) : [facet.min, facet.max];\n\n\t\t\t// initial min/max\n\t\t\twsc.min = min(wsc.min, facet.min = minMax[0]);\n\t\t\twsc.max = max(wsc.max, facet.max = minMax[1]);\n\t\t}\n\t}\n\n\tconst AUTOSCALE = {min: null, max: null};\n\n\tfunction setScales() {\n\t//\tlog(\"setScales()\", arguments);\n\n\t\t// implicitly add auto scales, and unranged scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null &&\n\t\t\t\t(\n\t\t\t\t\t// scales that have never been set (on init)\n\t\t\t\t\tsc.min == null ||\n\t\t\t\t\t// or auto scales when the x scale was explicitly set\n\t\t\t\t\tpendScales[xScaleKey] != null && sc.auto(self, viaAutoScaleX)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t\t}\n\t\t}\n\n\t\t// implicitly add dependent scales\n\t\tfor (let k in scales) {\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (pendScales[k] == null && sc.from != null && pendScales[sc.from] != null)\n\t\t\t\tpendScales[k] = AUTOSCALE;\n\t\t}\n\n\t\t// explicitly setting the x-scale invalidates everything (acts as redraw)\n\t\tif (pendScales[xScaleKey] != null)\n\t\t\tresetYSeries(true); // TODO: only reset series on auto scales?\n\n\t\tlet wipScales = {};\n\n\t\tfor (let k in pendScales) {\n\t\t\tlet psc = pendScales[k];\n\n\t\t\tif (psc != null) {\n\t\t\t\tlet wsc = wipScales[k] = copy(scales[k], fastIsObj);\n\n\t\t\t\tif (psc.min != null)\n\t\t\t\t\tassign(wsc, psc);\n\t\t\t\telse if (k != xScaleKey || mode == 2) {\n\t\t\t\t\tif (dataLen == 0 && wsc.from == null) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, null, null, k);\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\twsc.min = inf;\n\t\t\t\t\t\twsc.max = -inf;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (dataLen > 0) {\n\t\t\t// pre-range y-scales from y series' data values\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 1) {\n\t\t\t\t\tlet k = s.scale;\n\t\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\t\tif (psc == null)\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tlet wsc = wipScales[k];\n\n\t\t\t\t\tif (i == 0) {\n\t\t\t\t\t\tlet minMax = wsc.range(self, wsc.min, wsc.max, k);\n\n\t\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\t\twsc.max = minMax[1];\n\n\t\t\t\t\t\ti0 = closestIdx(wsc.min, data[0]);\n\t\t\t\t\t\ti1 = closestIdx(wsc.max, data[0]);\n\n\t\t\t\t\t\t// don't try to contract same or adjacent idxs\n\t\t\t\t\t\tif (i1 - i0 > 1) {\n\t\t\t\t\t\t\t// closest indices can be outside of view\n\t\t\t\t\t\t\tif (data[0][i0] < wsc.min)\n\t\t\t\t\t\t\t\ti0++;\n\t\t\t\t\t\t\tif (data[0][i1] > wsc.max)\n\t\t\t\t\t\t\t\ti1--;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ts.min = data0[i0];\n\t\t\t\t\t\ts.max = data0[i1];\n\t\t\t\t\t}\n\t\t\t\t\telse if (s.show && s.auto)\n\t\t\t\t\t\taccScale(wsc, psc, s, data[i], s.sorted);\n\n\t\t\t\t\ts.idxs[0] = i0;\n\t\t\t\t\ts.idxs[1] = i1;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tif (s.show && s.auto) {\n\t\t\t\t\t\t\t// TODO: only handles, assumes and requires facets[0] / 'x' scale, and facets[1] / 'y' scale\n\t\t\t\t\t\t\tlet [ xFacet, yFacet ] = s.facets;\n\t\t\t\t\t\t\tlet xScaleKey = xFacet.scale;\n\t\t\t\t\t\t\tlet yScaleKey = yFacet.scale;\n\t\t\t\t\t\t\tlet [ xData, yData ] = data[i];\n\n\t\t\t\t\t\t\tlet wscx = wipScales[xScaleKey];\n\t\t\t\t\t\t\tlet wscy = wipScales[yScaleKey];\n\n\t\t\t\t\t\t\t// null can happen when only x is zoomed, but y has static range and doesnt get auto-added to pending\n\t\t\t\t\t\t\twscx != null && accScale(wscx, pendScales[xScaleKey], xFacet, xData, xFacet.sorted);\n\t\t\t\t\t\t\twscy != null && accScale(wscy, pendScales[yScaleKey], yFacet, yData, yFacet.sorted);\n\n\t\t\t\t\t\t\t// temp\n\t\t\t\t\t\t\ts.min = yFacet.min;\n\t\t\t\t\t\t\ts.max = yFacet.max;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// range independent scales\n\t\t\tfor (let k in wipScales) {\n\t\t\t\tlet wsc = wipScales[k];\n\t\t\t\tlet psc = pendScales[k];\n\n\t\t\t\tif (wsc.from == null && (psc == null || psc.min == null)) {\n\t\t\t\t\tlet minMax = wsc.range(\n\t\t\t\t\t\tself,\n\t\t\t\t\t\twsc.min ==  inf ? null : wsc.min,\n\t\t\t\t\t\twsc.max == -inf ? null : wsc.max,\n\t\t\t\t\t\tk\n\t\t\t\t\t);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// range dependent scales\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\n\t\t\tif (wsc.from != null) {\n\t\t\t\tlet base = wipScales[wsc.from];\n\n\t\t\t\tif (base.min == null)\n\t\t\t\t\twsc.min = wsc.max = null;\n\t\t\t\telse {\n\t\t\t\t\tlet minMax = wsc.range(self, base.min, base.max, k);\n\t\t\t\t\twsc.min = minMax[0];\n\t\t\t\t\twsc.max = minMax[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet changed = {};\n\t\tlet anyChanged = false;\n\n\t\tfor (let k in wipScales) {\n\t\t\tlet wsc = wipScales[k];\n\t\t\tlet sc = scales[k];\n\n\t\t\tif (sc.min != wsc.min || sc.max != wsc.max) {\n\t\t\t\tsc.min = wsc.min;\n\t\t\t\tsc.max = wsc.max;\n\n\t\t\t\tlet distr = sc.distr;\n\n\t\t\t\tsc._min = distr == 3 ? log10(sc.min) : distr == 4 ? asinh(sc.min, sc.asinh) : distr == 100 ? sc.fwd(sc.min) : sc.min;\n\t\t\t\tsc._max = distr == 3 ? log10(sc.max) : distr == 4 ? asinh(sc.max, sc.asinh) : distr == 100 ? sc.fwd(sc.max) : sc.max;\n\n\t\t\t\tchanged[k] = anyChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (anyChanged) {\n\t\t\t// invalidate paths of all series on changed scales\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (mode == 2) {\n\t\t\t\t\tif (i > 0 && changed.y)\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (changed[s.scale])\n\t\t\t\t\t\ts._paths = null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (let k in changed) {\n\t\t\t\tshouldConvergeSize = true;\n\t\t\t\tfire(\"setScale\", k);\n\t\t\t}\n\n\t\t\tif (showCursor && cursor.left >= 0)\n\t\t\t\tshouldSetCursor = shouldSetLegend = true;\n\t\t}\n\n\t\tfor (let k in pendScales)\n\t\t\tpendScales[k] = null;\n\t}\n\n\t// grabs the nearest indices with y data outside of x-scale limits\n\tfunction getOuterIdxs(ydata) {\n\t\tlet _i0 = clamp(i0 - 1, 0, dataLen - 1);\n\t\tlet _i1 = clamp(i1 + 1, 0, dataLen - 1);\n\n\t\twhile (ydata[_i0] == null && _i0 > 0)\n\t\t\t_i0--;\n\n\t\twhile (ydata[_i1] == null && _i1 < dataLen - 1)\n\t\t\t_i1++;\n\n\t\treturn [_i0, _i1];\n\t}\n\n\tfunction drawSeries() {\n\t\tif (dataLen > 0) {\n\t\t\tlet shouldAlpha = series.some(s => s._focus) && ctxAlpha != focus.alpha;\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = focus.alpha;\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tcacheStrokeFill(i, false);\n\t\t\t\t\tcacheStrokeFill(i, true);\n\n\t\t\t\t\tif (s._paths == null) {\n\t\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\t\tlet _idxs = mode == 2 ? [0, data[i][0].length - 1] : getOuterIdxs(data[i]);\n\t\t\t\t\t\ts._paths = s.paths(self, i, _idxs[0], _idxs[1]);\n\n\t\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tseries.forEach((s, i) => {\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet _ctxAlpha = ctxAlpha;\n\n\t\t\t\t\tif (ctxAlpha != s.alpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = s.alpha;\n\n\t\t\t\t\ts._paths != null && drawPath(i, false);\n\n\t\t\t\t\t{\n\t\t\t\t\t\tlet _gaps = s._paths != null ? s._paths.gaps : null;\n\n\t\t\t\t\t\tlet show = s.points.show(self, i, i0, i1, _gaps);\n\t\t\t\t\t\tlet idxs = s.points.filter(self, i, show, _gaps);\n\n\t\t\t\t\t\tif (show || idxs) {\n\t\t\t\t\t\t\ts.points._paths = s.points.paths(self, i, i0, i1, idxs);\n\t\t\t\t\t\t\tdrawPath(i, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ctxAlpha != _ctxAlpha)\n\t\t\t\t\t\tctx.globalAlpha = ctxAlpha = _ctxAlpha;\n\n\t\t\t\t\tfire(\"drawSeries\", i);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (shouldAlpha)\n\t\t\t\tctx.globalAlpha = ctxAlpha = 1;\n\t\t}\n\t}\n\n\tfunction cacheStrokeFill(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\ts._stroke = s.stroke(self, si);\n\t\ts._fill   = s.fill(self, si);\n\t}\n\n\tfunction drawPath(si, _points) {\n\t\tlet s = _points ? series[si].points : series[si];\n\n\t\tlet {\n\t\t\tstroke,\n\t\t\tfill,\n\t\t\tclip: gapsClip,\n\t\t\tflags,\n\n\t\t\t_stroke: strokeStyle = s._stroke,\n\t\t\t_fill:   fillStyle   = s._fill,\n\t\t\t_width:  width       = s.width,\n\t\t} = s._paths;\n\n\t\twidth = roundDec(width * pxRatio, 3);\n\n\t\tlet boundsClip = null;\n\t\tlet offset = (width % 2) / 2;\n\n\t\tif (_points && fillStyle == null)\n\t\t\tfillStyle = width > 0 ? \"#fff\" : strokeStyle;\n\n\t\tlet _pxAlign = s.pxAlign == 1 && offset > 0;\n\n\t\t_pxAlign && ctx.translate(offset, offset);\n\n\t\tif (!_points) {\n\t\t\tlet lft = plotLft - width / 2,\n\t\t\t\ttop = plotTop - width / 2,\n\t\t\t\twid = plotWid + width,\n\t\t\t\thgt = plotHgt + width;\n\n\t\t\tboundsClip = new Path2D();\n\t\t\tboundsClip.rect(lft, top, wid, hgt);\n\t\t}\n\n\t\t// the points pathbuilder's gapsClip is its boundsClip, since points dont need gaps clipping, and bounds depend on point size\n\t\tif (_points)\n\t\t\tstrokeFill(strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, gapsClip);\n\t\telse\n\t\t\tfillStroke(si, strokeStyle, width, s.dash, s.cap, fillStyle, stroke, fill, flags, boundsClip, gapsClip);\n\n\t\t_pxAlign && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction fillStroke(si, strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip) {\n\t\tlet didStrokeFill = false;\n\n\t\t// for all bands where this series is the top edge, create upwards clips using the bottom edges\n\t\t// and apply clips + fill with band fill or dfltFill\n\t\tflags != 0 && bands.forEach((b, bi) => {\n\t\t\t// isUpperEdge?\n\t\t\tif (b.series[0] == si) {\n\t\t\t\tlet lowerEdge = series[b.series[1]];\n\t\t\t\tlet lowerData = data[b.series[1]];\n\n\t\t\t\tlet bandClip = (lowerEdge._paths || EMPTY_OBJ).band;\n\n\t\t\t\tif (isArr(bandClip))\n\t\t\t\t\tbandClip = b.dir == 1 ? bandClip[0] : bandClip[1];\n\n\t\t\t\tlet gapsClip2;\n\n\t\t\t\tlet _fillStyle = null;\n\n\t\t\t\t// hasLowerEdge?\n\t\t\t\tif (lowerEdge.show && bandClip && hasData(lowerData, i0, i1)) {\n\t\t\t\t\t_fillStyle = b.fill(self, bi) || fillStyle;\n\t\t\t\t\tgapsClip2 = lowerEdge._paths.clip;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbandClip = null;\n\n\t\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, _fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip);\n\n\t\t\t\tdidStrokeFill = true;\n\t\t\t}\n\t\t});\n\n\t\tif (!didStrokeFill)\n\t\t\tstrokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip);\n\t}\n\n\tconst CLIP_FILL_STROKE = BAND_CLIP_FILL | BAND_CLIP_STROKE;\n\n\tfunction strokeFill(strokeStyle, lineWidth, lineDash, lineCap, fillStyle, strokePath, fillPath, flags, boundsClip, gapsClip, gapsClip2, bandClip) {\n\t\tsetCtxStyle(strokeStyle, lineWidth, lineDash, lineCap, fillStyle);\n\n\t\tif (boundsClip || gapsClip || bandClip) {\n\t\t\tctx.save();\n\t\t\tboundsClip && ctx.clip(boundsClip);\n\t\t\tgapsClip && ctx.clip(gapsClip);\n\t\t}\n\n\t\tif (bandClip) {\n\t\t\tif ((flags & CLIP_FILL_STROKE) == CLIP_FILL_STROKE) {\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_STROKE) {\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t\telse if (flags & BAND_CLIP_FILL) {\n\t\t\t\tctx.save();\n\t\t\t\tctx.clip(bandClip);\n\t\t\t\tgapsClip2 && ctx.clip(gapsClip2);\n\t\t\t\tdoFill(fillStyle, fillPath);\n\t\t\t\tctx.restore();\n\t\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdoFill(fillStyle, fillPath);\n\t\t\tdoStroke(strokeStyle, strokePath, lineWidth);\n\t\t}\n\n\t\tif (boundsClip || gapsClip || bandClip)\n\t\t\tctx.restore();\n\t}\n\n\tfunction doStroke(strokeStyle, strokePath, lineWidth) {\n\t\tif (lineWidth > 0) {\n\t\t\tif (strokePath instanceof Map) {\n\t\t\t\tstrokePath.forEach((strokePath, strokeStyle) => {\n\t\t\t\t\tctx.strokeStyle = ctxStroke = strokeStyle;\n\t\t\t\t\tctx.stroke(strokePath);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tstrokePath != null && strokeStyle && ctx.stroke(strokePath);\n\t\t}\n\t}\n\n\tfunction doFill(fillStyle, fillPath) {\n\t\tif (fillPath instanceof Map) {\n\t\t\tfillPath.forEach((fillPath, fillStyle) => {\n\t\t\t\tctx.fillStyle = ctxFill = fillStyle;\n\t\t\t\tctx.fill(fillPath);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\tfillPath != null && fillStyle && ctx.fill(fillPath);\n\t}\n\n\tfunction getIncrSpace(axisIdx, min, max, fullDim) {\n\t\tlet axis = axes[axisIdx];\n\n\t\tlet incrSpace;\n\n\t\tif (fullDim <= 0)\n\t\t\tincrSpace = [0, 0];\n\t\telse {\n\t\t\tlet minSpace = axis._space = axis.space(self, axisIdx, min, max, fullDim);\n\t\t\tlet incrs    = axis._incrs = axis.incrs(self, axisIdx, min, max, fullDim, minSpace);\n\t\t\tincrSpace    = findIncr(min, max, incrs, fullDim, minSpace);\n\t\t}\n\n\t\treturn (axis._found = incrSpace);\n\t}\n\n\tfunction drawOrthoLines(offs, filts, ori, side, pos0, len, width, stroke, dash, cap) {\n\t\tlet offset = (width % 2) / 2;\n\n\t\tpxAlign == 1 && ctx.translate(offset, offset);\n\n\t\tsetCtxStyle(stroke, width, dash, cap, stroke);\n\n\t\tctx.beginPath();\n\n\t\tlet x0, y0, x1, y1, pos1 = pos0 + (side == 0 || side == 3 ? -len : len);\n\n\t\tif (ori == 0) {\n\t\t\ty0 = pos0;\n\t\t\ty1 = pos1;\n\t\t}\n\t\telse {\n\t\t\tx0 = pos0;\n\t\t\tx1 = pos1;\n\t\t}\n\n\t\tfor (let i = 0; i < offs.length; i++) {\n\t\t\tif (filts[i] != null) {\n\t\t\t\tif (ori == 0)\n\t\t\t\t\tx0 = x1 = offs[i];\n\t\t\t\telse\n\t\t\t\t\ty0 = y1 = offs[i];\n\n\t\t\t\tctx.moveTo(x0, y0);\n\t\t\t\tctx.lineTo(x1, y1);\n\t\t\t}\n\t\t}\n\n\t\tctx.stroke();\n\n\t\tpxAlign == 1 && ctx.translate(-offset, -offset);\n\t}\n\n\tfunction axesCalc(cycleNum) {\n\t//\tlog(\"axesCalc()\", arguments);\n\n\t\tlet converged = true;\n\n\t\taxes.forEach((axis, i) => {\n\t\t\tif (!axis.show)\n\t\t\t\treturn;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tif (scale.min == null) {\n\t\t\t\tif (axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = false;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!axis._show) {\n\t\t\t\t\tconverged = false;\n\t\t\t\t\taxis._show = true;\n\t\t\t\t\tresetYSeries(false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet {min, max} = scale;\t\t// \t\t// should this toggle them ._show = false\n\n\t\t\tlet [_incr, _space] = getIncrSpace(i, min, max, ori == 0 ? plotWidCss : plotHgtCss);\n\n\t\t\tif (_space == 0)\n\t\t\t\treturn;\n\n\t\t\t// if we're using index positions, force first tick to match passed index\n\t\t\tlet forceMin = scale.distr == 2;\n\n\t\t\tlet _splits = axis._splits = axis.splits(self, i, min, max, _incr, _space, forceMin);\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet values = axis._values = axis.values(self, axis.filter(self, splits, i, _space, incr), i, _space, incr);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\taxis._rotate = side == 2 ? axis.rotate(self, values, i, _space) : 0;\n\n\t\t\tlet oldSize = axis._size;\n\n\t\t\taxis._size = ceil(axis.size(self, values, i, cycleNum));\n\n\t\t\tif (oldSize != null && axis._size != oldSize)\t\t\t// ready && ?\n\t\t\t\tconverged = false;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction paddingCalc(cycleNum) {\n\t\tlet converged = true;\n\n\t\tpadding.forEach((p, i) => {\n\t\t\tlet _p = p(self, i, sidesWithAxes, cycleNum);\n\n\t\t\tif (_p != _padding[i])\n\t\t\t\tconverged = false;\n\n\t\t\t_padding[i] = _p;\n\t\t});\n\n\t\treturn converged;\n\t}\n\n\tfunction drawAxesGrid() {\n\t\tfor (let i = 0; i < axes.length; i++) {\n\t\t\tlet axis = axes[i];\n\n\t\t\tif (!axis.show || !axis._show)\n\t\t\t\tcontinue;\n\n\t\t\tlet side = axis.side;\n\t\t\tlet ori = side % 2;\n\n\t\t\tlet x, y;\n\n\t\t\tlet fillStyle = axis.stroke(self, i);\n\n\t\t\tlet shiftDir = side == 0 || side == 3 ? -1 : 1;\n\n\t\t\tlet [_incr, _space] = axis._found;\n\n\t\t\t// axis label\n\t\t\tif (axis.label != null) {\n\t\t\t\tlet shiftAmt = axis.labelGap * shiftDir;\n\t\t\t\tlet baseLpos = round((axis._lpos + shiftAmt) * pxRatio);\n\n\t\t\t\tsetFontStyle(axis.labelFont[0], fillStyle, \"center\", side == 2 ? TOP : BOTTOM);\n\n\t\t\t\tctx.save();\n\n\t\t\t\tif (ori == 1) {\n\t\t\t\t\tx = y = 0;\n\n\t\t\t\t\tctx.translate(\n\t\t\t\t\t\tbaseLpos,\n\t\t\t\t\t\tround(plotTop + plotHgt / 2),\n\t\t\t\t\t);\n\t\t\t\t\tctx.rotate((side == 3 ? -PI : PI) / 2);\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tx = round(plotLft + plotWid / 2);\n\t\t\t\t\ty = baseLpos;\n\t\t\t\t}\n\n\t\t\t\tlet _label = isFn(axis.label) ? axis.label(self, i, _incr, _space) : axis.label;\n\n\t\t\t\tctx.fillText(_label, x, y);\n\n\t\t\t\tctx.restore();\n\t\t\t}\n\n\t\t\tif (_space == 0)\n\t\t\t\tcontinue;\n\n\t\t\tlet scale = scales[axis.scale];\n\n\t\t\tlet plotDim = ori == 0 ? plotWid : plotHgt;\n\t\t\tlet plotOff = ori == 0 ? plotLft : plotTop;\n\n\t\t\tlet _splits = axis._splits;\n\n\t\t\t// tick labels\n\t\t\t// BOO this assumes a specific data/series\n\t\t\tlet splits = scale.distr == 2 ? _splits.map(i => data0[i]) : _splits;\n\t\t\tlet incr   = scale.distr == 2 ? data0[_splits[1]] - data0[_splits[0]] : _incr;\n\n\t\t\tlet ticks = axis.ticks;\n\t\t\tlet border = axis.border;\n\t\t\tlet _tickSize = ticks.show ? ticks.size : 0;\n\t\t\tlet tickSize = round(_tickSize * pxRatio);\n\t\t\tlet axisGap = round((axis.alignTo == 2 ? axis._size - _tickSize - axis.gap : axis.gap) * pxRatio);\n\n\t\t\t// rotating of labels only supported on bottom x axis\n\t\t\tlet angle = axis._rotate * -PI/180;\n\n\t\t\tlet basePos  = pxRound(axis._pos * pxRatio);\n\t\t\tlet shiftAmt = (tickSize + axisGap) * shiftDir;\n\t\t\tlet finalPos = basePos + shiftAmt;\n\t\t\t    y        = ori == 0 ? finalPos : 0;\n\t\t\t    x        = ori == 1 ? finalPos : 0;\n\n\t\t\tlet font         = axis.font[0];\n\t\t\tlet textAlign    = axis.align == 1 ? LEFT :\n\t\t\t                   axis.align == 2 ? RIGHT :\n\t\t\t                   angle > 0 ? LEFT :\n\t\t\t                   angle < 0 ? RIGHT :\n\t\t\t                   ori == 0 ? \"center\" : side == 3 ? RIGHT : LEFT;\n\t\t\tlet textBaseline = angle ||\n\t\t\t                   ori == 1 ? \"middle\" : side == 2 ? TOP   : BOTTOM;\n\n\t\t\tsetFontStyle(font, fillStyle, textAlign, textBaseline);\n\n\t\t\tlet lineHeight = axis.font[1] * axis.lineGap;\n\n\t\t\tlet canOffs = _splits.map(val => pxRound(getPos(val, scale, plotDim, plotOff)));\n\n\t\t\tlet _values = axis._values;\n\n\t\t\tfor (let i = 0; i < _values.length; i++) {\n\t\t\t\tlet val = _values[i];\n\n\t\t\t\tif (val != null) {\n\t\t\t\t\tif (ori == 0)\n\t\t\t\t\t\tx = canOffs[i];\n\t\t\t\t\telse\n\t\t\t\t\t\ty = canOffs[i];\n\n\t\t\t\t\tval = \"\" + val;\n\n\t\t\t\t\tlet _parts = val.indexOf(\"\\n\") == -1 ? [val] : val.split(/\\n/gm);\n\n\t\t\t\t\tfor (let j = 0; j < _parts.length; j++) {\n\t\t\t\t\t\tlet text = _parts[j];\n\n\t\t\t\t\t\tif (angle) {\n\t\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\t\tctx.translate(x, y + j * lineHeight); // can this be replaced with position math?\n\t\t\t\t\t\t\tctx.rotate(angle); // can this be done once?\n\t\t\t\t\t\t\tctx.fillText(text, 0, 0);\n\t\t\t\t\t\t\tctx.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tctx.fillText(text, x, y + j * lineHeight);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// ticks\n\t\t\tif (ticks.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tticks.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tside,\n\t\t\t\t\tbasePos,\n\t\t\t\t\ttickSize,\n\t\t\t\t\troundDec(ticks.width * pxRatio, 3),\n\t\t\t\t\tticks.stroke(self, i),\n\t\t\t\t\tticks.dash,\n\t\t\t\t\tticks.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// grid\n\t\t\tlet grid = axis.grid;\n\n\t\t\tif (grid.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\tcanOffs,\n\t\t\t\t\tgrid.filter(self, splits, i, _space, incr),\n\t\t\t\t\tori,\n\t\t\t\t\tori == 0 ? 2 : 1,\n\t\t\t\t\tori == 0 ? plotTop : plotLft,\n\t\t\t\t\tori == 0 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(grid.width * pxRatio, 3),\n\t\t\t\t\tgrid.stroke(self, i),\n\t\t\t\t\tgrid.dash,\n\t\t\t\t\tgrid.cap,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (border.show) {\n\t\t\t\tdrawOrthoLines(\n\t\t\t\t\t[basePos],\n\t\t\t\t\t[1],\n\t\t\t\t\tori == 0 ? 1 : 0,\n\t\t\t\t\tori == 0 ? 1 : 2,\n\t\t\t\t\tori == 1 ? plotTop : plotLft,\n\t\t\t\t\tori == 1 ? plotHgt : plotWid,\n\t\t\t\t\troundDec(border.width * pxRatio, 3),\n\t\t\t\t\tborder.stroke(self, i),\n\t\t\t\t\tborder.dash,\n\t\t\t\t\tborder.cap,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfire(\"drawAxes\");\n\t}\n\n\tfunction resetYSeries(minMax) {\n\t//\tlog(\"resetYSeries()\", arguments);\n\n\t\tseries.forEach((s, i) => {\n\t\t\tif (i > 0) {\n\t\t\t\ts._paths = null;\n\n\t\t\t\tif (minMax) {\n\t\t\t\t\tif (mode == 1) {\n\t\t\t\t\t\ts.min = null;\n\t\t\t\t\t\ts.max = null;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ts.facets.forEach(f => {\n\t\t\t\t\t\t\tf.min = null;\n\t\t\t\t\t\t\tf.max = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tlet queuedCommit = false;\n\tlet deferHooks = false;\n\tlet hooksQueue = [];\n\n\tfunction flushHooks() {\n\t\tdeferHooks = false;\n\n\t\tfor (let i = 0; i < hooksQueue.length; i++)\n\t\t\tfire(...hooksQueue[i]);\n\n\t\thooksQueue.length = 0;\n\t}\n\n\tfunction commit() {\n\t\tif (!queuedCommit) {\n\t\t\tmicroTask(_commit);\n\t\t\tqueuedCommit = true;\n\t\t}\n\t}\n\n\t// manual batching (aka immediate mode), skips microtask queue\n\tfunction batch(fn, _deferHooks = false) {\n\t\tqueuedCommit = true;\n\t\tdeferHooks = _deferHooks;\n\n\t\tfn(self);\n\t\t_commit();\n\n\t\tif (_deferHooks && hooksQueue.length > 0)\n\t\t\tqueueMicrotask(flushHooks);\n\t}\n\n\tself.batch = batch;\n\n\tfunction _commit() {\n\t//\tlog(\"_commit()\", arguments);\n\n\t\tif (shouldSetScales) {\n\t\t\tsetScales();\n\t\t\tshouldSetScales = false;\n\t\t}\n\n\t\tif (shouldConvergeSize) {\n\t\t\tconvergeSize();\n\t\t\tshouldConvergeSize = false;\n\t\t}\n\n\t\tif (shouldSetSize) {\n\t\t\tsetStylePx(under, LEFT,   plotLftCss);\n\t\t\tsetStylePx(under, TOP,    plotTopCss);\n\t\t\tsetStylePx(under, WIDTH,  plotWidCss);\n\t\t\tsetStylePx(under, HEIGHT, plotHgtCss);\n\n\t\t\tsetStylePx(over, LEFT,    plotLftCss);\n\t\t\tsetStylePx(over, TOP,     plotTopCss);\n\t\t\tsetStylePx(over, WIDTH,   plotWidCss);\n\t\t\tsetStylePx(over, HEIGHT,  plotHgtCss);\n\n\t\t\tsetStylePx(wrap, WIDTH,   fullWidCss);\n\t\t\tsetStylePx(wrap, HEIGHT,  fullHgtCss);\n\n\t\t\t// NOTE: mutating this during print preview in Chrome forces transparent\n\t\t\t// canvas pixels to white, even when followed up with clearRect() below\n\t\t\tcan.width  = round(fullWidCss * pxRatio);\n\t\t\tcan.height = round(fullHgtCss * pxRatio);\n\n\t\t\taxes.forEach(({ _el, _show, _size, _pos, side }) => {\n\t\t\t\tif (_el != null) {\n\t\t\t\t\tif (_show) {\n\t\t\t\t\t\tlet posOffset = (side === 3 || side === 0 ? _size : 0);\n\t\t\t\t\t\tlet isVt = side % 2 == 1;\n\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"left\"   : \"top\",    _pos - posOffset);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"width\"  : \"height\", _size);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"top\"    : \"left\",   isVt ? plotTopCss : plotLftCss);\n\t\t\t\t\t\tsetStylePx(_el, isVt ? \"height\" : \"width\",  isVt ? plotHgtCss : plotWidCss);\n\n\t\t\t\t\t\tremClass(_el, OFF);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\taddClass(_el, OFF);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// invalidate ctx style cache\n\t\t\tctxStroke = ctxFill = ctxWidth = ctxJoin = ctxCap = ctxFont = ctxAlign = ctxBaseline = ctxDash = null;\n\t\t\tctxAlpha = 1;\n\n\t\t\tsyncRect(true);\n\n\t\t\tif (\n\t\t\t\tplotLftCss != _plotLftCss ||\n\t\t\t\tplotTopCss != _plotTopCss ||\n\t\t\t\tplotWidCss != _plotWidCss ||\n\t\t\t\tplotHgtCss != _plotHgtCss\n\t\t\t) {\n\t\t\t\tresetYSeries(false);\n\n\t\t\t\tlet pctWid = plotWidCss / _plotWidCss;\n\t\t\t\tlet pctHgt = plotHgtCss / _plotHgtCss;\n\n\t\t\t\tif (showCursor && !shouldSetCursor && cursor.left >= 0) {\n\t\t\t\t\tcursor.left *= pctWid;\n\t\t\t\t\tcursor.top  *= pctHgt;\n\n\t\t\t\t\tvCursor && elTrans(vCursor, round(cursor.left), 0, plotWidCss, plotHgtCss);\n\t\t\t\t\thCursor && elTrans(hCursor, 0, round(cursor.top), plotWidCss, plotHgtCss);\n\n\t\t\t\t\tfor (let i = 0; i < cursorPts.length; i++) {\n\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\tcursorPtsLft[i] *= pctWid;\n\t\t\t\t\t\t\tcursorPtsTop[i] *= pctHgt;\n\t\t\t\t\t\t\telTrans(pt, ceil(cursorPtsLft[i]), ceil(cursorPtsTop[i]), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (select.show && !shouldSetSelect && select.left >= 0 && select.width > 0) {\n\t\t\t\t\tselect.left   *= pctWid;\n\t\t\t\t\tselect.width  *= pctWid;\n\t\t\t\t\tselect.top    *= pctHgt;\n\t\t\t\t\tselect.height *= pctHgt;\n\n\t\t\t\t\tfor (let prop in _hideProps)\n\t\t\t\t\t\tsetStylePx(selectDiv, prop, select[prop]);\n\t\t\t\t}\n\n\t\t\t\t_plotLftCss = plotLftCss;\n\t\t\t\t_plotTopCss = plotTopCss;\n\t\t\t\t_plotWidCss = plotWidCss;\n\t\t\t\t_plotHgtCss = plotHgtCss;\n\t\t\t}\n\n\t\t\tfire(\"setSize\");\n\n\t\t\tshouldSetSize = false;\n\t\t}\n\n\t\tif (fullWidCss > 0 && fullHgtCss > 0) {\n\t\t\tctx.clearRect(0, 0, can.width, can.height);\n\t\t\tfire(\"drawClear\");\n\t\t\tdrawOrder.forEach(fn => fn());\n\t\t\tfire(\"draw\");\n\t\t}\n\n\t\tif (select.show && shouldSetSelect) {\n\t\t\tsetSelect(select);\n\t\t\tshouldSetSelect = false;\n\t\t}\n\n\t\tif (showCursor && shouldSetCursor) {\n\t\t\tupdateCursor(null, true, false);\n\t\t\tshouldSetCursor = false;\n\t\t}\n\n\t\tif (legend.show && legend.live && shouldSetLegend) {\n\t\t\tsetLegend();\n\t\t\tshouldSetLegend = false; // redundant currently\n\t\t}\n\n\t\tif (!ready) {\n\t\t\tready = true;\n\t\t\tself.status = 1;\n\n\t\t\tfire(\"ready\");\n\t\t}\n\n\t\tviaAutoScaleX = false;\n\n\t\tqueuedCommit = false;\n\t}\n\n\tself.redraw = (rebuildPaths, recalcAxes) => {\n\t\tshouldConvergeSize = recalcAxes || false;\n\n\t\tif (rebuildPaths !== false)\n\t\t\t_setScale(xScaleKey, scaleX.min, scaleX.max);\n\t\telse\n\t\t\tcommit();\n\t};\n\n\t// redraw() => setScale('x', scales.x.min, scales.x.max);\n\n\t// explicit, never re-ranged (is this actually true? for x and y)\n\tfunction setScale(key, opts) {\n\t\tlet sc = scales[key];\n\n\t\tif (sc.from == null) {\n\t\t\tif (dataLen == 0) {\n\t\t\t\tlet minMax = sc.range(self, opts.min, opts.max, key);\n\t\t\t\topts.min = minMax[0];\n\t\t\t\topts.max = minMax[1];\n\t\t\t}\n\n\t\t\tif (opts.min > opts.max) {\n\t\t\t\tlet _min = opts.min;\n\t\t\t\topts.min = opts.max;\n\t\t\t\topts.max = _min;\n\t\t\t}\n\n\t\t\tif (dataLen > 1 && opts.min != null && opts.max != null && opts.max - opts.min < 1e-16)\n\t\t\t\treturn;\n\n\t\t\tif (key == xScaleKey) {\n\t\t\t\tif (sc.distr == 2 && dataLen > 0) {\n\t\t\t\t\topts.min = closestIdx(opts.min, data[0]);\n\t\t\t\t\topts.max = closestIdx(opts.max, data[0]);\n\n\t\t\t\t\tif (opts.min == opts.max)\n\t\t\t\t\t\topts.max++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t//\tlog(\"setScale()\", arguments);\n\n\t\t\tpendScales[key] = opts;\n\n\t\t\tshouldSetScales = true;\n\t\t\tcommit();\n\t\t}\n\t}\n\n\tself.setScale = setScale;\n\n//\tINTERACTION\n\n\tlet xCursor;\n\tlet yCursor;\n\tlet vCursor;\n\tlet hCursor;\n\n\t// starting position before cursor.move\n\tlet rawMouseLeft0;\n\tlet rawMouseTop0;\n\n\t// starting position\n\tlet mouseLeft0;\n\tlet mouseTop0;\n\n\t// current position before cursor.move\n\tlet rawMouseLeft1;\n\tlet rawMouseTop1;\n\n\t// current position\n\tlet mouseLeft1;\n\tlet mouseTop1;\n\n\tlet dragging = false;\n\n\tconst drag = cursor.drag;\n\n\tlet dragX = drag.x;\n\tlet dragY = drag.y;\n\n\tif (showCursor) {\n\t\tif (cursor.x)\n\t\t\txCursor = placeDiv(CURSOR_X, over);\n\t\tif (cursor.y)\n\t\t\tyCursor = placeDiv(CURSOR_Y, over);\n\n\t\tif (scaleX.ori == 0) {\n\t\t\tvCursor = xCursor;\n\t\t\thCursor = yCursor;\n\t\t}\n\t\telse {\n\t\t\tvCursor = yCursor;\n\t\t\thCursor = xCursor;\n\t\t}\n\n\t\tmouseLeft1 = cursor.left;\n\t\tmouseTop1 = cursor.top;\n\t}\n\n\tconst select = self.select = assign({\n\t\tshow:   true,\n\t\tover:   true,\n\t\tleft:   0,\n\t\twidth:  0,\n\t\ttop:    0,\n\t\theight: 0,\n\t}, opts.select);\n\n\tconst selectDiv = select.show ? placeDiv(SELECT, select.over ? over : under) : null;\n\n\tfunction setSelect(opts, _fire) {\n\t\tif (select.show) {\n\t\t\tfor (let prop in opts) {\n\t\t\t\tselect[prop] = opts[prop];\n\n\t\t\t\tif (prop in _hideProps)\n\t\t\t\t\tsetStylePx(selectDiv, prop, opts[prop]);\n\t\t\t}\n\n\t\t\t_fire !== false && fire(\"setSelect\");\n\t\t}\n\t}\n\n\tself.setSelect = setSelect;\n\n\tfunction toggleDOM(i) {\n\t\tlet s = series[i];\n\n\t\tif (s.show)\n\t\t\tshowLegend && remClass(legendRows[i], OFF);\n\t\telse {\n\t\t\tshowLegend && addClass(legendRows[i], OFF);\n\n\t\t\tif (showCursor) {\n\t\t\t\tlet pt = cursorOnePt ? cursorPts[0] : cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _setScale(key, min, max) {\n\t\tsetScale(key, {min, max});\n\t}\n\n\tfunction setSeries(i, opts, _fire, _pub) {\n\t//\tlog(\"setSeries()\", arguments);\n\n\t\tif (opts.focus != null)\n\t\t\tsetFocus(i);\n\n\t\tif (opts.show != null) {\n\t\t\tseries.forEach((s, si) => {\n\t\t\t\tif (si > 0 && (i == si || i == null)) {\n\t\t\t\t\ts.show = opts.show;\n\t\t\t\t\ttoggleDOM(si);\n\n\t\t\t\t\tif (mode == 2) {\n\t\t\t\t\t\t_setScale(s.facets[0].scale, null, null);\n\t\t\t\t\t\t_setScale(s.facets[1].scale, null, null);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\t_setScale(s.scale, null, null);\n\n\t\t\t\t\tcommit();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t_fire !== false && fire(\"setSeries\", i, opts);\n\n\t\t_pub && pubSync(\"setSeries\", self, i, opts);\n\t}\n\n\tself.setSeries = setSeries;\n\n\tfunction setBand(bi, opts) {\n\t\tassign(bands[bi], opts);\n\t}\n\n\tfunction addBand(opts, bi) {\n\t\topts.fill = fnOrSelf(opts.fill || null);\n\t\topts.dir = ifNull(opts.dir, -1);\n\t\tbi = bi == null ? bands.length : bi;\n\t\tbands.splice(bi, 0, opts);\n\t}\n\n\tfunction delBand(bi) {\n\t\tif (bi == null)\n\t\t\tbands.length = 0;\n\t\telse\n\t\t\tbands.splice(bi, 1);\n\t}\n\n\tself.addBand = addBand;\n\tself.setBand = setBand;\n\tself.delBand = delBand;\n\n\tfunction setAlpha(i, value) {\n\t\tseries[i].alpha = value;\n\n\t\tif (showCursor && cursorPts[i] != null)\n\t\t\tcursorPts[i].style.opacity = value;\n\n\t\tif (showLegend && legendRows[i])\n\t\t\tlegendRows[i].style.opacity = value;\n\t}\n\n\t// y-distance\n\tlet closestDist;\n\tlet closestSeries;\n\tlet focusedSeries;\n\tconst FOCUS_TRUE  = {focus: true};\n\n\tfunction setFocus(i) {\n\t\tif (i != focusedSeries) {\n\t\t//\tlog(\"setFocus()\", arguments);\n\n\t\t\tlet allFocused = i == null;\n\n\t\t\tlet _setAlpha = focus.alpha != 1;\n\n\t\t\tseries.forEach((s, i2) => {\n\t\t\t\tif (mode == 1 || i2 > 0) {\n\t\t\t\t\tlet isFocused = allFocused || i2 == 0 || i2 == i;\n\t\t\t\t\ts._focus = allFocused ? null : isFocused;\n\t\t\t\t\t_setAlpha && setAlpha(i2, isFocused ? 1 : focus.alpha);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfocusedSeries = i;\n\t\t\t_setAlpha && commit();\n\t\t}\n\t}\n\n\tif (showLegend && cursorFocus) {\n\t\tonMouse(mouseleave, legendTable, e => {\n\t\t\tif (cursor._lock)\n\t\t\t\treturn;\n\n\t\t\tsetCursorEvent(e);\n\n\t\t\tif (focusedSeries != null)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, syncOpts.setSeries);\n\t\t});\n\t}\n\n\tfunction posToVal(pos, scale, can) {\n\t\tlet sc = scales[scale];\n\n\t\tif (can)\n\t\t\tpos = pos / pxRatio - (sc.ori == 1 ? plotTopCss : plotLftCss);\n\n\t\tlet dim = plotWidCss;\n\n\t\tif (sc.ori == 1) {\n\t\t\tdim = plotHgtCss;\n\t\t\tpos = dim - pos;\n\t\t}\n\n\t\tif (sc.dir == -1)\n\t\t\tpos = dim - pos;\n\n\t\tlet _min = sc._min,\n\t\t\t_max = sc._max,\n\t\t\tpct = pos / dim;\n\n\t\tlet sv = _min + (_max - _min) * pct;\n\n\t\tlet distr = sc.distr;\n\n\t\treturn (\n\t\t\tdistr == 3 ? pow(10, sv) :\n\t\t\tdistr == 4 ? sinh(sv, sc.asinh) :\n\t\t\tdistr == 100 ? sc.bwd(sv) :\n\t\t\tsv\n\t\t);\n\t}\n\n\tfunction closestIdxFromXpos(pos, can) {\n\t\tlet v = posToVal(pos, xScaleKey, can);\n\t\treturn closestIdx(v, data[0], i0, i1);\n\t}\n\n\tself.valToIdx = val => closestIdx(val, data[0]);\n\tself.posToIdx = closestIdxFromXpos;\n\tself.posToVal = posToVal;\n\tself.valToPos = (val, scale, can) => (\n\t\tscales[scale].ori == 0 ?\n\t\tgetHPos(val, scales[scale],\n\t\t\tcan ? plotWid : plotWidCss,\n\t\t\tcan ? plotLft : 0,\n\t\t) :\n\t\tgetVPos(val, scales[scale],\n\t\t\tcan ? plotHgt : plotHgtCss,\n\t\t\tcan ? plotTop : 0,\n\t\t)\n\t);\n\n\tself.setCursor = (opts, _fire, _pub) => {\n\t\tmouseLeft1 = opts.left;\n\t\tmouseTop1 = opts.top;\n\t//\tassign(cursor, opts);\n\t\tupdateCursor(null, _fire, _pub);\n\t};\n\n\tfunction setSelH(off, dim) {\n\t\tsetStylePx(selectDiv, LEFT,  select.left = off);\n\t\tsetStylePx(selectDiv, WIDTH, select.width = dim);\n\t}\n\n\tfunction setSelV(off, dim) {\n\t\tsetStylePx(selectDiv, TOP,    select.top = off);\n\t\tsetStylePx(selectDiv, HEIGHT, select.height = dim);\n\t}\n\n\tlet setSelX = scaleX.ori == 0 ? setSelH : setSelV;\n\tlet setSelY = scaleX.ori == 1 ? setSelH : setSelV;\n\n\tfunction syncLegend() {\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tif (i == 0 && multiValLegend)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tlet vals = legend.values[i];\n\n\t\t\t\tlet j = 0;\n\n\t\t\t\tfor (let k in vals)\n\t\t\t\t\tlegendCells[i][j++].firstChild.nodeValue = vals[k];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setLegend(opts, _fire) {\n\t\tif (opts != null) {\n\t\t\tif (opts.idxs) {\n\t\t\t\topts.idxs.forEach((didx, sidx) => {\n\t\t\t\t\tactiveIdxs[sidx] = didx;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!isUndef(opts.idx))\n\t\t\t\tactiveIdxs.fill(opts.idx);\n\n\t\t\tlegend.idx = activeIdxs[0];\n\t\t}\n\n\t\tif (showLegend && legend.live) {\n\t\t\tfor (let sidx = 0; sidx < series.length; sidx++) {\n\t\t\t\tif (sidx > 0 || mode == 1 && !multiValLegend)\n\t\t\t\t\tsetLegendValues(sidx, activeIdxs[sidx]);\n\t\t\t}\n\n\t\t\tsyncLegend();\n\t\t}\n\n\t\tshouldSetLegend = false;\n\n\t\t_fire !== false && fire(\"setLegend\");\n\t}\n\n\tself.setLegend = setLegend;\n\n\tfunction setLegendValues(sidx, idx) {\n\t\tlet s = series[sidx];\n\t\tlet src = sidx == 0 && xScaleDistr == 2 ? data0 : data[sidx];\n\t\tlet val;\n\n\t\tif (multiValLegend)\n\t\t\tval = s.values(self, sidx, idx) ?? NULL_LEGEND_VALUES;\n\t\telse {\n\t\t\tval = s.value(self, idx == null ? null : src[idx], sidx, idx);\n\t\t\tval = val == null ? NULL_LEGEND_VALUES : {_: val};\n\t\t}\n\n\t\tlegend.values[sidx] = val;\n\t}\n\n\tfunction updateCursor(src, _fire, _pub) {\n\t//\tts == null && log(\"updateCursor()\", arguments);\n\n\t\trawMouseLeft1 = mouseLeft1;\n\t\trawMouseTop1 = mouseTop1;\n\n\t\t[mouseLeft1, mouseTop1] = cursor.move(self, mouseLeft1, mouseTop1);\n\n\t\tcursor.left = mouseLeft1;\n\t\tcursor.top = mouseTop1;\n\n\t\tif (showCursor) {\n\t\t\tvCursor && elTrans(vCursor, round(mouseLeft1), 0, plotWidCss, plotHgtCss);\n\t\t\thCursor && elTrans(hCursor, 0, round(mouseTop1), plotWidCss, plotHgtCss);\n\t\t}\n\n\t\tlet idx;\n\n\t\t// when zooming to an x scale range between datapoints the binary search\n\t\t// for nearest min/max indices results in this condition. cheap hack :D\n\t\tlet noDataInRange = i0 > i1; // works for mode 1 only\n\n\t\tclosestDist = inf;\n\t\tclosestSeries = null;\n\n\t\t// TODO: extract\n\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss;\n\t\tlet yDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss;\n\n\t\t// if cursor hidden, hide points & clear legend vals\n\t\tif (mouseLeft1 < 0 || dataLen == 0 || noDataInRange) {\n\t\t\tidx = cursor.idx = null;\n\n\t\t\tfor (let i = 0; i < series.length; i++) {\n\t\t\t\tlet pt = cursorPts[i];\n\t\t\t\tpt != null && elTrans(pt, -10, -10, plotWidCss, plotHgtCss);\n\t\t\t}\n\n\t\t\tif (cursorFocus)\n\t\t\t\tsetSeries(null, FOCUS_TRUE, true, src == null && syncOpts.setSeries);\n\n\t\t\tif (legend.live) {\n\t\t\t\tactiveIdxs.fill(idx);\n\t\t\t\tshouldSetLegend = true;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t//\tlet pctY = 1 - (y / rect.height);\n\n\t\t\tlet mouseXPos, valAtPosX, xPos;\n\n\t\t\tif (mode == 1) {\n\t\t\t\tmouseXPos = scaleX.ori == 0 ? mouseLeft1 : mouseTop1;\n\t\t\t\tvalAtPosX = posToVal(mouseXPos, xScaleKey);\n\t\t\t\tidx = cursor.idx = closestIdx(valAtPosX, data[0], i0, i1);\n\t\t\t\txPos = valToPosX(data[0][idx], scaleX, xDim, 0);\n\t\t\t}\n\n\t\t\t// closest pt values\n\t\t\tlet _ptLft = -10;\n\t\t\tlet _ptTop = -10;\n\t\t\tlet _ptWid = 0;\n\t\t\tlet _ptHgt = 0;\n\t\t\tlet _centered = true;\n\t\t\tlet _ptFill = '';\n\t\t\tlet _ptStroke = '';\n\n\t\t\tfor (let i = mode == 2 ? 1 : 0; i < series.length; i++) {\n\t\t\t\tlet s = series[i];\n\n\t\t\t\tlet idx1  = activeIdxs[i];\n\t\t\t\tlet yVal1 = idx1 == null ? null : (mode == 1 ? data[i][idx1] : data[i][1][idx1]);\n\n\t\t\t\tlet idx2  = cursor.dataIdx(self, i, idx, valAtPosX);\n\t\t\t\tlet yVal2 = idx2 == null ? null : (mode == 1 ? data[i][idx2] : data[i][1][idx2]);\n\n\t\t\t\tshouldSetLegend = shouldSetLegend || yVal2 != yVal1 || idx2 != idx1;\n\n\t\t\t\tactiveIdxs[i] = idx2;\n\n\t\t\t\tif (i > 0 && s.show) {\n\t\t\t\t\tlet xPos2 = idx2 == null ? -10 : idx2 == idx ? xPos : valToPosX(mode == 1 ? data[0][idx2] : data[i][0][idx2], scaleX, xDim, 0);\n\n\t\t\t\t\t// this doesnt really work for state timeline, heatmap, status history (where the value maps to color, not y coords)\n\t\t\t\t\tlet yPos = yVal2 == null ? -10 : valToPosY(yVal2, mode == 1 ? scales[s.scale] : scales[s.facets[1].scale], yDim, 0);\n\n\t\t\t\t\tif (cursorFocus && yVal2 != null) {\n\t\t\t\t\t\tlet mouseYPos = scaleX.ori == 1 ? mouseLeft1 : mouseTop1;\n\t\t\t\t\t\tlet dist = abs(focus.dist(self, i, idx2, yPos, mouseYPos));\n\n\t\t\t\t\t\tif (dist < closestDist) {\n\t\t\t\t\t\t\tlet bias = focus.bias;\n\n\t\t\t\t\t\t\tif (bias != 0) {\n\t\t\t\t\t\t\t\tlet mouseYVal = posToVal(mouseYPos, s.scale);\n\n\t\t\t\t\t\t\t\tlet seriesYValSign = yVal2     >= 0 ? 1 : -1;\n\t\t\t\t\t\t\t\tlet mouseYValSign  = mouseYVal >= 0 ? 1 : -1;\n\n\t\t\t\t\t\t\t\t// with a focus bias, we will never cross zero when prox testing\n\t\t\t\t\t\t\t\t// it's either closest towards zero, or closest away from zero\n\t\t\t\t\t\t\t\tif (mouseYValSign == seriesYValSign && (\n\t\t\t\t\t\t\t\t\tmouseYValSign == 1 ?\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 >= mouseYVal : yVal2 <= mouseYVal) :  // >= 0\n\t\t\t\t\t\t\t\t\t\t(bias == 1 ? yVal2 <= mouseYVal : yVal2 >= mouseYVal)    //  < 0\n\t\t\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tclosestDist = dist;\n\t\t\t\t\t\t\t\tclosestSeries = i;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldSetLegend || cursorOnePt) {\n\t\t\t\t\t\tlet hPos, vPos;\n\n\t\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\t\thPos = xPos2;\n\t\t\t\t\t\t\tvPos = yPos;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\thPos = yPos;\n\t\t\t\t\t\t\tvPos = xPos2;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet ptWid, ptHgt, ptLft, ptTop,\n\t\t\t\t\t\t\tptStroke, ptFill,\n\t\t\t\t\t\t\tcentered = true,\n\t\t\t\t\t\t\tgetBBox = points.bbox;\n\n\t\t\t\t\t\tif (getBBox != null) {\n\t\t\t\t\t\t\tcentered = false;\n\n\t\t\t\t\t\t\tlet bbox = getBBox(self, i);\n\n\t\t\t\t\t\t\tptLft = bbox.left;\n\t\t\t\t\t\t\tptTop = bbox.top;\n\t\t\t\t\t\t\tptWid = bbox.width;\n\t\t\t\t\t\t\tptHgt = bbox.height;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tptLft = hPos;\n\t\t\t\t\t\t\tptTop = vPos;\n\t\t\t\t\t\t\tptWid = ptHgt = points.size(self, i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tptFill = points.fill(self, i);\n\t\t\t\t\t\tptStroke = points.stroke(self, i);\n\n\t\t\t\t\t\tif (cursorOnePt) {\n\t\t\t\t\t\t\tif (i == closestSeries && closestDist <= focus.prox) {\n\t\t\t\t\t\t\t\t_ptLft = ptLft;\n\t\t\t\t\t\t\t\t_ptTop = ptTop;\n\t\t\t\t\t\t\t\t_ptWid = ptWid;\n\t\t\t\t\t\t\t\t_ptHgt = ptHgt;\n\t\t\t\t\t\t\t\t_centered = centered;\n\t\t\t\t\t\t\t\t_ptFill = ptFill;\n\t\t\t\t\t\t\t\t_ptStroke = ptStroke;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tlet pt = cursorPts[i];\n\n\t\t\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\t\t\tcursorPtsLft[i] = ptLft;\n\t\t\t\t\t\t\t\tcursorPtsTop[i] = ptTop;\n\n\t\t\t\t\t\t\t\telSize(pt, ptWid, ptHgt, centered);\n\t\t\t\t\t\t\t\telColor(pt, ptFill, ptStroke);\n\t\t\t\t\t\t\t\telTrans(pt, ceil(ptLft), ceil(ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if only using single hover point (at cursorPts[0])\n\t\t\t// we have trigger styling at last visible series (once closestSeries is settled)\n\t\t\tif (cursorOnePt) {\n\t\t\t\t// some of this logic is similar to series focus below, since it matches the behavior by design\n\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tlet focusChanged = focusedSeries == null ? closestDist <= p : (closestDist > p || closestSeries != focusedSeries);\n\n\t\t\t\tif (shouldSetLegend || focusChanged) {\n\t\t\t\t\tlet pt = cursorPts[0];\n\n\t\t\t\t\tif (pt != null) {\n\t\t\t\t\t\tcursorPtsLft[0] = _ptLft;\n\t\t\t\t\t\tcursorPtsTop[0] = _ptTop;\n\n\t\t\t\t\t\telSize(pt, _ptWid, _ptHgt, _centered);\n\t\t\t\t\t\telColor(pt, _ptFill, _ptStroke);\n\t\t\t\t\t\telTrans(pt, ceil(_ptLft), ceil(_ptTop), plotWidCss, plotHgtCss);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// nit: cursor.drag.setSelect is assumed always true\n\t\tif (select.show && dragging) {\n\t\t\tif (src != null) {\n\t\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\t\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\t\t\t\tlet [xKeySrc, yKeySrc] = src.cursor.sync.scales;\n\n\t\t\t\t// match the dragX/dragY implicitness/explicitness of src\n\t\t\t\tlet sdrag = src.cursor.drag;\n\t\t\t\tdragX = sdrag._x;\n\t\t\t\tdragY = sdrag._y;\n\n\t\t\t\tif (dragX || dragY) {\n\t\t\t\t\tlet { left, top, width, height } = src.select;\n\n\t\t\t\t\tlet sori = src.scales[xKeySrc].ori;\n\t\t\t\t\tlet sPosToVal = src.posToVal;\n\n\t\t\t\t\tlet sOff, sDim, sc, a, b;\n\n\t\t\t\t\tlet matchingX = xKey != null && matchXKeys(xKey, xKeySrc);\n\t\t\t\t\tlet matchingY = yKey != null && matchYKeys(yKey, yKeySrc);\n\n\t\t\t\t\tif (matchingX && dragX) {\n\t\t\t\t\t\tif (sori == 0) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[xKey];\n\n\t\t\t\t\t\ta = valToPosX(sPosToVal(sOff, xKeySrc),        sc, xDim, 0);\n\t\t\t\t\t\tb = valToPosX(sPosToVal(sOff + sDim, xKeySrc), sc, xDim, 0);\n\n\t\t\t\t\t\tsetSelX(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelX(0, xDim);\n\n\t\t\t\t\tif (matchingY && dragY) {\n\t\t\t\t\t\tif (sori == 1) {\n\t\t\t\t\t\t\tsOff = left;\n\t\t\t\t\t\t\tsDim = width;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tsOff = top;\n\t\t\t\t\t\t\tsDim = height;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsc = scales[yKey];\n\n\t\t\t\t\t\ta = valToPosY(sPosToVal(sOff, yKeySrc),        sc, yDim, 0);\n\t\t\t\t\t\tb = valToPosY(sPosToVal(sOff + sDim, yKeySrc), sc, yDim, 0);\n\n\t\t\t\t\t\tsetSelY(min(a,b), abs(b-a));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\thideSelect();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet rawDX = abs(rawMouseLeft1 - rawMouseLeft0);\n\t\t\t\tlet rawDY = abs(rawMouseTop1 - rawMouseTop0);\n\n\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\tlet _rawDX = rawDX;\n\t\t\t\t\trawDX = rawDY;\n\t\t\t\t\trawDY = _rawDX;\n\t\t\t\t}\n\n\t\t\t\tdragX = drag.x && rawDX >= drag.dist;\n\t\t\t\tdragY = drag.y && rawDY >= drag.dist;\n\n\t\t\t\tlet uni = drag.uni;\n\n\t\t\t\tif (uni != null) {\n\t\t\t\t\t// only calc drag status if they pass the dist thresh\n\t\t\t\t\tif (dragX && dragY) {\n\t\t\t\t\t\tdragX = rawDX >= uni;\n\t\t\t\t\t\tdragY = rawDY >= uni;\n\n\t\t\t\t\t\t// force unidirectionality when both are under uni limit\n\t\t\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\t\t\tif (rawDY > rawDX)\n\t\t\t\t\t\t\t\tdragY = true;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdragX = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (drag.x && drag.y && (dragX || dragY))\n\t\t\t\t\t// if omni with no uni then both dragX / dragY should be true if either is true\n\t\t\t\t\tdragX = dragY = true;\n\n\t\t\t\tlet p0, p1;\n\n\t\t\t\tif (dragX) {\n\t\t\t\t\tif (scaleX.ori == 0) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelX(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragY)\n\t\t\t\t\t\tsetSelY(0, yDim);\n\t\t\t\t}\n\n\t\t\t\tif (dragY) {\n\t\t\t\t\tif (scaleX.ori == 1) {\n\t\t\t\t\t\tp0 = mouseLeft0;\n\t\t\t\t\t\tp1 = mouseLeft1;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp0 = mouseTop0;\n\t\t\t\t\t\tp1 = mouseTop1;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetSelY(min(p0, p1), abs(p1 - p0));\n\n\t\t\t\t\tif (!dragX)\n\t\t\t\t\t\tsetSelX(0, xDim);\n\t\t\t\t}\n\n\t\t\t\t// the drag didn't pass the dist requirement\n\t\t\t\tif (!dragX && !dragY) {\n\t\t\t\t\tsetSelX(0, 0);\n\t\t\t\t\tsetSelY(0, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdrag._x = dragX;\n\t\tdrag._y = dragY;\n\n\t\tif (src == null) {\n\t\t\tif (_pub) {\n\t\t\t\tif (syncKey != null) {\n\t\t\t\t\tlet [xSyncKey, ySyncKey] = syncOpts.scales;\n\n\t\t\t\t\tsyncOpts.values[0] = xSyncKey != null ? posToVal(scaleX.ori == 0 ? mouseLeft1 : mouseTop1, xSyncKey) : null;\n\t\t\t\t\tsyncOpts.values[1] = ySyncKey != null ? posToVal(scaleX.ori == 1 ? mouseLeft1 : mouseTop1, ySyncKey) : null;\n\t\t\t\t}\n\n\t\t\t\tpubSync(mousemove, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, idx);\n\t\t\t}\n\n\t\t\tif (cursorFocus) {\n\t\t\t\tlet shouldPub = _pub && syncOpts.setSeries;\n\t\t\t\tlet p = focus.prox;\n\n\t\t\t\tif (focusedSeries == null) {\n\t\t\t\t\tif (closestDist <= p)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (closestDist > p)\n\t\t\t\t\t\tsetSeries(null, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t\telse if (closestSeries != focusedSeries)\n\t\t\t\t\t\tsetSeries(closestSeries, FOCUS_TRUE, true, shouldPub);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (shouldSetLegend) {\n\t\t\tlegend.idx = idx;\n\t\t\tsetLegend();\n\t\t}\n\n\t\t_fire !== false && fire(\"setCursor\");\n\t}\n\n\tlet rect = null;\n\n\tObject.defineProperty(self, 'rect', {\n\t\tget() {\n\t\t\tif (rect == null)\n\t\t\t\tsyncRect(false);\n\n\t\t\treturn rect;\n\t\t},\n\t});\n\n\tfunction syncRect(defer = false) {\n\t\tif (defer)\n\t\t\trect = null;\n\t\telse {\n\t\t\trect = over.getBoundingClientRect();\n\t\t\tfire(\"syncRect\", rect);\n\t\t}\n\t}\n\n\tfunction mouseMove(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\t// Chrome on Windows has a bug which triggers a stray mousemove event after an initial mousedown event\n\t\t// when clicking into a plot as part of re-focusing the browser window.\n\t\t// we gotta ignore it to avoid triggering a phantom drag / setSelect\n\t\t// However, on touch-only devices Chrome-based browsers trigger a 0-distance mousemove before mousedown\n\t\t// so we don't ignore it when mousedown has set the dragging flag\n\t\tif (dragging && e != null && e.movementX == 0 && e.movementY == 0)\n\t\t\treturn;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, e != null);\n\n\t\tif (e != null)\n\t\t\tupdateCursor(null, true, true);\n\t\telse\n\t\t\tupdateCursor(src, true, false);\n\t}\n\n\tfunction cacheMouse(e, src, _l, _t, _w, _h, _i, initial, snap) {\n\t\tif (rect == null)\n\t\t\tsyncRect(false);\n\n\t\tsetCursorEvent(e);\n\n\t\tif (e != null) {\n\t\t\t_l = e.clientX - rect.left;\n\t\t\t_t = e.clientY - rect.top;\n\t\t}\n\t\telse {\n\t\t\tif (_l < 0 || _t < 0) {\n\t\t\t\tmouseLeft1 = -10;\n\t\t\t\tmouseTop1 = -10;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet [xKey, yKey] = syncOpts.scales;\n\n\t\t\tlet syncOptsSrc = src.cursor.sync;\n\t\t\tlet [xValSrc, yValSrc] = syncOptsSrc.values;\n\t\t\tlet [xKeySrc, yKeySrc] = syncOptsSrc.scales;\n\t\t\tlet [matchXKeys, matchYKeys] = syncOpts.match;\n\n\t\t\tlet rotSrc = src.axes[0].side % 2 == 1;\n\n\t\t\tlet xDim = scaleX.ori == 0 ? plotWidCss : plotHgtCss,\n\t\t\t\tyDim = scaleX.ori == 1 ? plotWidCss : plotHgtCss,\n\t\t\t\t_xDim = rotSrc ? _h : _w,\n\t\t\t\t_yDim = rotSrc ? _w : _h,\n\t\t\t\t_xPos = rotSrc ? _t : _l,\n\t\t\t\t_yPos = rotSrc ? _l : _t;\n\n\t\t\tif (xKeySrc != null)\n\t\t\t\t_l = matchXKeys(xKey, xKeySrc) ? getPos(xValSrc, scales[xKey], xDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_l = xDim * (_xPos/_xDim);\n\n\t\t\tif (yKeySrc != null)\n\t\t\t\t_t = matchYKeys(yKey, yKeySrc) ? getPos(yValSrc, scales[yKey], yDim, 0) : -10;\n\t\t\telse\n\t\t\t\t_t = yDim * (_yPos/_yDim);\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\tlet __l = _l;\n\t\t\t\t_l = _t;\n\t\t\t\t_t = __l;\n\t\t\t}\n\t\t}\n\n\t\tif (snap && (src == null || src.cursor.event.type == mousemove)) {\n\t\t\tif (_l <= 1 || _l >= plotWidCss - 1)\n\t\t\t\t_l = incrRound(_l, plotWidCss);\n\n\t\t\tif (_t <= 1 || _t >= plotHgtCss - 1)\n\t\t\t\t_t = incrRound(_t, plotHgtCss);\n\t\t}\n\n\t\tif (initial) {\n\t\t\trawMouseLeft0 = _l;\n\t\t\trawMouseTop0 = _t;\n\n\t\t\t[mouseLeft0, mouseTop0] = cursor.move(self, _l, _t);\n\t\t}\n\t\telse {\n\t\t\tmouseLeft1 = _l;\n\t\t\tmouseTop1 = _t;\n\t\t}\n\t}\n\n\tconst _hideProps = {\n\t\twidth: 0,\n\t\theight: 0,\n\t\tleft: 0,\n\t\ttop: 0,\n\t};\n\n\tfunction hideSelect() {\n\t\tsetSelect(_hideProps, false);\n\t}\n\n\tlet downSelectLeft;\n\tlet downSelectTop;\n\tlet downSelectWidth;\n\tlet downSelectHeight;\n\n\tfunction mouseDown(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = true;\n\t\tdragX = dragY = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, true, false);\n\n\t\tif (e != null) {\n\t\t\tonMouse(mouseup, doc, mouseUp, false);\n\t\t\tpubSync(mousedown, self, mouseLeft0, mouseTop0, plotWidCss, plotHgtCss, null);\n\t\t}\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tdownSelectLeft   = left;\n\t\tdownSelectTop    = top;\n\t\tdownSelectWidth  = width;\n\t\tdownSelectHeight = height;\n\n\t//\thideSelect();\n\t}\n\n\tfunction mouseUp(e, src, _l, _t, _w, _h, _i) {\n\t\tdragging = drag._x = drag._y = false;\n\n\t\tcacheMouse(e, src, _l, _t, _w, _h, _i, false, true);\n\n\t\tlet { left, top, width, height } = select;\n\n\t\tlet hasSelect = width > 0 || height > 0;\n\t\tlet chgSelect = (\n\t\t\tdownSelectLeft   != left   ||\n\t\t\tdownSelectTop    != top    ||\n\t\t\tdownSelectWidth  != width  ||\n\t\t\tdownSelectHeight != height\n\t\t);\n\n\t\thasSelect && chgSelect && setSelect(select);\n\n\t\tif (drag.setScale && hasSelect && chgSelect) {\n\t\t//\tif (syncKey != null) {\n\t\t//\t\tdragX = drag.x;\n\t\t//\t\tdragY = drag.y;\n\t\t//\t}\n\n\t\t\tlet xOff = left,\n\t\t\t\txDim = width,\n\t\t\t\tyOff = top,\n\t\t\t\tyDim = height;\n\n\t\t\tif (scaleX.ori == 1) {\n\t\t\t\txOff = top,\n\t\t\t\txDim = height,\n\t\t\t\tyOff = left,\n\t\t\t\tyDim = width;\n\t\t\t}\n\n\t\t\tif (dragX) {\n\t\t\t\t_setScale(xScaleKey,\n\t\t\t\t\tposToVal(xOff, xScaleKey),\n\t\t\t\t\tposToVal(xOff + xDim, xScaleKey)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (dragY) {\n\t\t\t\tfor (let k in scales) {\n\t\t\t\t\tlet sc = scales[k];\n\n\t\t\t\t\tif (k != xScaleKey && sc.from == null && sc.min != inf) {\n\t\t\t\t\t\t_setScale(k,\n\t\t\t\t\t\t\tposToVal(yOff + yDim, k),\n\t\t\t\t\t\t\tposToVal(yOff, k)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thideSelect();\n\t\t}\n\t\telse if (cursor.lock) {\n\t\t\tcursor._lock = !cursor._lock;\n\t\t\tupdateCursor(src, true, e != null);\n\t\t}\n\n\t\tif (e != null) {\n\t\t\toffMouse(mouseup, doc);\n\t\t\tpubSync(mouseup, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t\t}\n\t}\n\n\tfunction mouseLeave(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tlet _dragging = dragging;\n\n\t\tif (dragging) {\n\t\t\t// handle case when mousemove aren't fired all the way to edges by browser\n\t\t\tlet snapH = true;\n\t\t\tlet snapV = true;\n\t\t\tlet snapProx = 10;\n\n\t\t\tlet dragH, dragV;\n\n\t\t\tif (scaleX.ori == 0) {\n\t\t\t\tdragH = dragX;\n\t\t\t\tdragV = dragY;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdragH = dragY;\n\t\t\t\tdragV = dragX;\n\t\t\t}\n\n\t\t\tif (dragH && dragV) {\n\t\t\t\t// maybe omni corner snap\n\t\t\t\tsnapH = mouseLeft1 <= snapProx || mouseLeft1 >= plotWidCss - snapProx;\n\t\t\t\tsnapV = mouseTop1  <= snapProx || mouseTop1  >= plotHgtCss - snapProx;\n\t\t\t}\n\n\t\t\tif (dragH && snapH)\n\t\t\t\tmouseLeft1 = mouseLeft1 < mouseLeft0 ? 0 : plotWidCss;\n\n\t\t\tif (dragV && snapV)\n\t\t\t\tmouseTop1 = mouseTop1 < mouseTop0 ? 0 : plotHgtCss;\n\n\t\t\tupdateCursor(null, true, true);\n\n\t\t\tdragging = false;\n\t\t}\n\n\t\tmouseLeft1 = -10;\n\t\tmouseTop1 = -10;\n\n\t\tactiveIdxs.fill(null);\n\n\t\t// passing a non-null timestamp to force sync/mousemove event\n\t\tupdateCursor(null, true, true);\n\n\t\tif (_dragging)\n\t\t\tdragging = _dragging;\n\t}\n\n\tfunction dblClick(e, src, _l, _t, _w, _h, _i) {\n\t\tif (cursor._lock)\n\t\t\treturn;\n\n\t\tsetCursorEvent(e);\n\n\t\tautoScaleX();\n\n\t\thideSelect();\n\n\t\tif (e != null)\n\t\t\tpubSync(dblclick, self, mouseLeft1, mouseTop1, plotWidCss, plotHgtCss, null);\n\t}\n\n\tfunction syncPxRatio() {\n\t\taxes.forEach(syncFontSize);\n\t\t_setSize(self.width, self.height, true);\n\t}\n\n\ton(dppxchange, win, syncPxRatio);\n\n\t// internal pub/sub\n\tconst events = {};\n\n\tevents.mousedown = mouseDown;\n\tevents.mousemove = mouseMove;\n\tevents.mouseup = mouseUp;\n\tevents.dblclick = dblClick;\n\tevents[\"setSeries\"] = (e, src, idx, opts) => {\n\t\tlet seriesIdxMatcher = syncOpts.match[2];\n\t\tidx = seriesIdxMatcher(self, src, idx);\n\t\tidx != -1 && setSeries(idx, opts, true, false);\n\t};\n\n\tif (showCursor) {\n\t\tonMouse(mousedown,  over, mouseDown);\n\t\tonMouse(mousemove,  over, mouseMove);\n\t\tonMouse(mouseenter, over, e => {\n\t\t\tsetCursorEvent(e);\n\t\t\tsyncRect(false);\n\t\t});\n\t\tonMouse(mouseleave, over, mouseLeave);\n\n\t\tonMouse(dblclick, over, dblClick);\n\n\t\tcursorPlots.add(self);\n\n\t\tself.syncRect = syncRect;\n\t}\n\n\t// external on/off\n\tconst hooks = self.hooks = opts.hooks || {};\n\n\tfunction fire(evName, a1, a2) {\n\t\tif (deferHooks)\n\t\t\thooksQueue.push([evName, a1, a2]);\n\t\telse {\n\t\t\tif (evName in hooks) {\n\t\t\t\thooks[evName].forEach(fn => {\n\t\t\t\t\tfn.call(null, self, a1, a2);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t(opts.plugins || []).forEach(p => {\n\t\tfor (let evName in p.hooks)\n\t\t\thooks[evName] = (hooks[evName] || []).concat(p.hooks[evName]);\n\t});\n\n\tconst seriesIdxMatcher = (self, src, srcSeriesIdx) => srcSeriesIdx;\n\n\tconst syncOpts = assign({\n\t\tkey: null,\n\t\tsetSeries: false,\n\t\tfilters: {\n\t\t\tpub: retTrue,\n\t\t\tsub: retTrue,\n\t\t},\n\t\tscales: [xScaleKey, series[1] ? series[1].scale : null],\n\t\tmatch: [retEq, retEq, seriesIdxMatcher],\n\t\tvalues: [null, null],\n\t}, cursor.sync);\n\n\tif (syncOpts.match.length == 2)\n\t\tsyncOpts.match.push(seriesIdxMatcher);\n\n\tcursor.sync = syncOpts;\n\n\tconst syncKey = syncOpts.key;\n\n\tconst sync = _sync(syncKey);\n\n\tfunction pubSync(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.pub(type, src, x, y, w, h, i))\n\t\t\tsync.pub(type, src, x, y, w, h, i);\n\t}\n\n\tsync.sub(self);\n\n\tfunction pub(type, src, x, y, w, h, i) {\n\t\tif (syncOpts.filters.sub(type, src, x, y, w, h, i))\n\t\t\tevents[type](null, src, x, y, w, h, i);\n\t}\n\n\tself.pub = pub;\n\n\tfunction destroy() {\n\t\tsync.unsub(self);\n\t\tcursorPlots.delete(self);\n\t\tmouseListeners.clear();\n\t\toff(dppxchange, win, syncPxRatio);\n\t\troot.remove();\n\t\tlegendTable?.remove(); // in case mounted outside of root\n\t\tfire(\"destroy\");\n\t}\n\n\tself.destroy = destroy;\n\n\tfunction _init() {\n\t\tfire(\"init\", opts, data);\n\n\t\tsetData(data || opts.data, false);\n\n\t\tif (pendScales[xScaleKey])\n\t\t\tsetScale(xScaleKey, pendScales[xScaleKey]);\n\t\telse\n\t\t\tautoScaleX();\n\n\t\tshouldSetSelect = select.show && (select.width > 0 || select.height > 0);\n\t\tshouldSetCursor = shouldSetLegend = true;\n\n\t\t_setSize(opts.width, opts.height);\n\t}\n\n\tseries.forEach(initSeries);\n\n\taxes.forEach(initAxis);\n\n\tif (then) {\n\t\tif (then instanceof HTMLElement) {\n\t\t\tthen.appendChild(root);\n\t\t\t_init();\n\t\t}\n\t\telse\n\t\t\tthen(self, _init);\n\t}\n\telse\n\t\t_init();\n\n\treturn self;\n}\n\nuPlot.assign = assign;\nuPlot.fmtNum = fmtNum;\nuPlot.rangeNum = rangeNum;\nuPlot.rangeLog = rangeLog;\nuPlot.rangeAsinh = rangeAsinh;\nuPlot.orient   = orient;\nuPlot.pxRatio = pxRatio;\n\n{\n\tuPlot.join = join;\n}\n\n{\n\tuPlot.fmtDate = fmtDate;\n\tuPlot.tzDate  = tzDate;\n}\n\nuPlot.sync = _sync;\n\n{\n\tuPlot.addGap = addGap;\n\tuPlot.clipGaps = clipGaps;\n\n\tlet paths = uPlot.paths = {\n\t\tpoints,\n\t};\n\n\t(paths.linear  = linear);\n\t(paths.stepped = stepped);\n\t(paths.bars    = bars);\n\t(paths.spline  = monotoneCubic);\n}\n\nexport { uPlot as default };\n","import uPlot from 'uplot';\nimport 'uplot/dist/uPlot.min.css';\n\nimport {\n  getThemeColors,\n  setupThemeObserver,\n  createResizeHandler,\n  setupResizeObserver,\n  formatPercentage,\n  formatRupiah,\n} from '../shared/chart-utils.js';\nimport { buildProgressDataset, buildCostDataset } from './dataset-builder.js';\n\nconst LOG_PREFIX = '[KurvaSUPlot]';\nconst DEFAULT_OPTIONS = {\n  height: 520,\n  enableCostView: true,\n};\n\nexport class KurvaSUPlotChart {\n  constructor(state, options = {}) {\n    this.state = state;\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n    this.viewMode = 'progress';\n    this.chartInstance = null;\n    this.container = null;\n    this.tooltipEl = null;\n    this.resizeHandler = null;\n    this.resizeObserver = null;\n    this.themeObserver = null;\n    this.currentDataset = null;\n    this.costData = null;\n    this.isLoadingCostData = false;\n\n    // Interaction helpers\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n    this._scaleBounds = null;\n    this._dateFormatter = null;\n  }\n\n  initialize(container) {\n    if (!container) {\n      console.error(LOG_PREFIX, 'Container element is required');\n      return false;\n    }\n\n    this.container = container;\n    if (getComputedStyle(container).position === 'static') {\n      this.container.style.position = 'relative';\n    }\n\n    this._createTooltip();\n\n    this.themeObserver = setupThemeObserver(() => this._rebuild());\n    this.resizeHandler = createResizeHandler(() => this.resize());\n    window.addEventListener('resize', this.resizeHandler);\n    this.resizeObserver = setupResizeObserver(container, () => this.resize());\n\n    const success = this.update();\n    if (!success) {\n      console.warn(LOG_PREFIX, 'Unable to render Kurva-S chart (no dataset)');\n    }\n    return true;\n  }\n\n  update(dataset) {\n    const resolvedDataset = dataset || buildProgressDataset(this.state);\n    if (!resolvedDataset) {\n      return false;\n    }\n    this.currentDataset = resolvedDataset;\n    this.viewMode = resolvedDataset.viewMode || this.viewMode || 'progress';\n\n    const transformedData = this._transformDataset(resolvedDataset);\n    const colors = getThemeColors();\n\n    if (!this.chartInstance) {\n      const options = this._buildChartOptions(resolvedDataset, colors);\n      this.chartInstance = new uPlot(options, transformedData, this.container);\n      this._updateScaleBounds();\n      this._attachInteractions();\n    } else {\n      this.chartInstance.setData(transformedData);\n      this._updateScaleBounds();\n    }\n\n    this._updateTooltipPosition();\n    return true;\n  }\n\n  resize() {\n    if (!this.chartInstance || !this.container) {\n      return;\n    }\n    this.chartInstance.setSize({\n      width: this.container.clientWidth || 800,\n      height: this.options.height,\n    });\n  }\n\n  async toggleView(mode) {\n    const nextMode = (mode || (this.viewMode === 'progress' ? 'cost' : 'progress')).toLowerCase();\n    if (nextMode === this.viewMode) {\n      return true;\n    }\n\n    if (nextMode === 'cost') {\n      if (!this.options.enableCostView) {\n        console.warn(LOG_PREFIX, 'Cost view disabled on uPlot chart');\n        return false;\n      }\n      if (!this.costData) {\n        const data = await this.fetchCostData();\n        if (!data) {\n          return false;\n        }\n      }\n      const costDataset = buildCostDataset(this.costData);\n      if (!costDataset) {\n        console.warn(LOG_PREFIX, 'Cost dataset not available');\n        return false;\n      }\n      this.viewMode = 'cost';\n      this.update(costDataset);\n      return true;\n    }\n\n    this.viewMode = 'progress';\n    this.update();\n    return true;\n  }\n\n  /**\n   * Render chart with monthly granularity\n   *\n   * Transforms weekly data to monthly for export purposes.\n   * Labels are displayed as M1, M2, M3... instead of W1, W2, W3...\n   *\n   * @param {Array} monthlyData - Monthly cumulative data\n   *   [{month: 1, label: 'M1', planned: 50, actual: 45}, ...]\n   * @returns {boolean} Success status\n   */\n  renderMonthlyMode(monthlyData) {\n    if (!Array.isArray(monthlyData) || monthlyData.length === 0) {\n      console.warn(LOG_PREFIX, 'Invalid monthly data');\n      return false;\n    }\n\n    console.log(LOG_PREFIX, `Rendering monthly mode with ${monthlyData.length} months`);\n\n    // Build dataset in uPlot format\n    const monthlyDataset = {\n      labels: monthlyData.map(m => m.label || `M${m.month}`),\n      planned: monthlyData.map(m => m.planned || 0),\n      actual: monthlyData.map(m => m.actual || 0),\n      viewMode: 'progress',\n      granularity: 'monthly'  // Mark as monthly for axis formatting\n    };\n\n    // Update chart with monthly data\n    return this.update(monthlyDataset);\n  }\n\n  /**\n   * Restore chart to weekly mode\n   *\n   * Re-renders chart with original weekly data.\n   *\n   * @param {Array} weeklyData - Weekly cumulative data (optional, uses state if not provided)\n   * @returns {boolean} Success status\n   */\n  renderWeeklyMode(weeklyData = null) {\n    console.log(LOG_PREFIX, 'Restoring weekly mode');\n\n    if (weeklyData) {\n      // Build dataset from provided weekly data\n      const weeklyDataset = {\n        labels: weeklyData.map((w, i) => `W${i + 1}`),\n        planned: weeklyData.map(w => w.planned || 0),\n        actual: weeklyData.map(w => w.actual || 0),\n        viewMode: 'progress',\n        granularity: 'weekly'\n      };\n      return this.update(weeklyDataset);\n    } else {\n      // Use original state data\n      return this.update();\n    }\n  }\n\n  dispose() {\n    this._detachInteractions();\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    if (this.resizeHandler) {\n      window.removeEventListener('resize', this.resizeHandler);\n      this.resizeHandler = null;\n    }\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n    if (this.themeObserver) {\n      this.themeObserver.disconnect();\n      this.themeObserver = null;\n    }\n    if (this.tooltipEl) {\n      this.tooltipEl.remove();\n      this.tooltipEl = null;\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n  // Internal helpers\n  // ---------------------------------------------------------------------------\n\n  _rebuild() {\n    if (!this.container) {\n      return;\n    }\n    if (this.chartInstance) {\n      this.chartInstance.destroy();\n      this.chartInstance = null;\n    }\n    this.update(this.currentDataset);\n  }\n\n  async fetchCostData() {\n    if (!this.options.enableCostView) {\n      console.log(LOG_PREFIX, 'Cost view disabled');\n      return null;\n    }\n\n    const projectId = this.state?.projectId;\n    if (!projectId) {\n      console.warn(LOG_PREFIX, 'Cannot load cost data without project ID');\n      return null;\n    }\n\n    if (this.isLoadingCostData) {\n      return null;\n    }\n\n    try {\n      this.isLoadingCostData = true;\n      const url = `/detail_project/api/v2/project/${projectId}/kurva-s-harga/`;\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      const data = await response.json();\n      if (data?.error) {\n        throw new Error(data.error);\n      }\n      this.costData = data;\n      console.log(LOG_PREFIX, 'Cost data loaded for uPlot chart');\n      return data;\n    } catch (error) {\n      console.error(LOG_PREFIX, 'Failed to load cost data:', error);\n      return null;\n    } finally {\n      this.isLoadingCostData = false;\n    }\n  }\n\n  _transformDataset(dataset) {\n    const xValues = dataset.labels.map((_, idx) => idx);\n    const planned = dataset.planned.map((value) => Number(value) || 0);\n\n    if (dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries)) {\n      const actualCost = dataset.acSeries.map((value) => Number(value) || 0);\n      return [xValues, planned, actualCost];\n    }\n\n    const actual = dataset.actual.map((value) => Number(value) || 0);\n    return [xValues, planned, actual];\n  }\n\n  _buildChartOptions(dataset, colors) {\n    const isCostView = dataset.viewMode === 'cost' && Array.isArray(dataset.acSeries);\n    return {\n      width: this.container?.clientWidth || 800,\n      height: this.options.height,\n      scales: {\n        x: { time: false },\n        y: { auto: true },\n      },\n      axes: [\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          values: (u, vals) =>\n            vals.map((v) => {\n              if (!Number.isFinite(v)) {\n                return '';\n              }\n              const nearestIndex = Math.round(v);\n              if (Math.abs(v - nearestIndex) > 0.01) {\n                return '';\n              }\n              if (nearestIndex < 0 || nearestIndex >= dataset.labels.length) {\n                return '';\n              }\n              return dataset.labels[nearestIndex] || `Week ${nearestIndex + 1}`;\n            }),\n        },\n        {\n          stroke: colors.axis,\n          grid: { stroke: colors.gridLine },\n          label: isCostView ? '% of Total Cost' : 'Progress %',\n          values: (u, vals) => vals.map((v) => `${Math.round(v)}%`),\n        },\n      ],\n      legend: {\n        show: true,\n      },\n      series: [\n        {},\n        {\n          label: isCostView ? 'Rencana (PV)' : 'Rencana',\n          stroke: colors.plannedLine,\n          width: 2,\n          fill: colors.plannedArea,\n        },\n        isCostView\n          ? {\n              label: 'Realisasi (AC)',\n              stroke: colors.costActualLine || colors.actualLine,\n              width: 3,\n              fill: colors.costActualArea || colors.actualArea,\n            }\n          : {\n              label: 'Realisasi',\n              stroke: colors.actualLine,\n              width: 2,\n              fill: colors.actualArea,\n            },\n      ],\n      cursor: {\n        drag: { x: true, y: false },\n        focus: { prox: 32 },\n      },\n      select: {\n        show: true,\n      },\n      hooks: {\n        ready: [\n          () => {\n            this._updateScaleBounds();\n            this._attachInteractions();\n          },\n        ],\n        setCursor: [\n          (u) => this._updateTooltip(u),\n        ],\n        setScale: [\n          () => this._updateTooltipPosition(),\n        ],\n        dblclick: [\n          (u) => {\n            const first = u.data[0][0];\n            const last = u.data[0][u.data[0].length - 1];\n            u.setScale('x', { min: first, max: last });\n          },\n        ],\n      },\n    };\n  }\n\n  _attachInteractions() {\n    if (this._interactionAttached || !this.chartInstance) {\n      return;\n    }\n    const target = this.chartInstance.over || this.container;\n    if (!target) {\n      return;\n    }\n    this._interactionTarget = target;\n    this._wheelHandler = (event) => this._handleWheelInteraction(event);\n    target.addEventListener('wheel', this._wheelHandler, { passive: false });\n    this._interactionAttached = true;\n  }\n\n  _detachInteractions() {\n    if (this._interactionAttached && this._interactionTarget && this._wheelHandler) {\n      this._interactionTarget.removeEventListener('wheel', this._wheelHandler);\n    }\n    this._interactionAttached = false;\n    this._wheelHandler = null;\n    this._interactionTarget = null;\n  }\n\n  _handleWheelInteraction(event) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const isZoomGesture = event.ctrlKey || event.metaKey;\n    const isPanGesture = !isZoomGesture && event.shiftKey;\n    if (!isZoomGesture && !isPanGesture) {\n      return;\n    }\n\n    event.preventDefault();\n\n    const bounds = this._scaleBounds;\n    const scale = this.chartInstance.scales?.x || {};\n    const currentMin = Number.isFinite(scale.min) ? scale.min : bounds.min;\n    const currentMax = Number.isFinite(scale.max) ? scale.max : bounds.max;\n\n    if (isZoomGesture) {\n      const zoomIntensity = 0.12;\n      const direction = event.deltaY > 0 ? 1 : -1;\n      const factor = Math.max(0.2, 1 + zoomIntensity * direction);\n\n      const overRect = (this.chartInstance.over || this.container).getBoundingClientRect();\n      const cursorX = event.clientX - overRect.left;\n      const cursorVal = this.chartInstance.posToVal(cursorX, 'x');\n      const resolvedCursor = Number.isFinite(cursorVal) ? cursorVal : (currentMin + currentMax) / 2;\n\n      const newMin = resolvedCursor - (resolvedCursor - currentMin) * factor;\n      const newMax = resolvedCursor + (currentMax - resolvedCursor) * factor;\n      this._setScaleBounded(newMin, newMax);\n      return;\n    }\n\n    const range = currentMax - currentMin;\n    const panStep = Math.max(1, range * 0.15);\n    const delta = event.deltaY > 0 ? panStep : -panStep;\n    this._setScaleBounded(currentMin + delta, currentMax + delta);\n  }\n\n  _setScaleBounded(targetMin, targetMax) {\n    if (!this.chartInstance || !this._scaleBounds) {\n      return;\n    }\n\n    const bounds = this._scaleBounds;\n    const boundsSpan = bounds.max - bounds.min;\n    if (boundsSpan <= 0) {\n      return;\n    }\n\n    const minWindow = 1;\n    let minVal = Math.min(targetMin, targetMax);\n    let maxVal = Math.max(targetMin, targetMax);\n    let windowSize = Math.max(minWindow, maxVal - minVal);\n\n    if (windowSize > boundsSpan) {\n      windowSize = boundsSpan;\n    }\n\n    minVal = Math.max(bounds.min, Math.min(minVal, bounds.max - windowSize));\n    maxVal = minVal + windowSize;\n    if (maxVal > bounds.max) {\n      maxVal = bounds.max;\n      minVal = maxVal - windowSize;\n    }\n\n    this.chartInstance.setScale('x', { min: minVal, max: maxVal });\n  }\n\n  _updateScaleBounds() {\n    if (!this.chartInstance || !Array.isArray(this.chartInstance.data?.[0])) {\n      return;\n    }\n    const xValues = this.chartInstance.data[0];\n    if (!xValues.length) {\n      return;\n    }\n    this._scaleBounds = {\n      min: xValues[0],\n      max: xValues[xValues.length - 1],\n    };\n  }\n\n  _createTooltip() {\n    const tooltip = document.createElement('div');\n    tooltip.className = 'kurva-s-tooltip';\n    tooltip.style.position = 'absolute';\n    tooltip.style.pointerEvents = 'none';\n    tooltip.style.padding = '8px 10px';\n    tooltip.style.borderRadius = '6px';\n    tooltip.style.background = 'rgba(15, 23, 42, 0.85)';\n    tooltip.style.color = '#fff';\n    tooltip.style.fontSize = '12px';\n    tooltip.style.transform = 'translate(-50%, -100%)';\n    tooltip.style.opacity = '0';\n    tooltip.style.transition = 'opacity 0.15s ease';\n\n    this.tooltipEl = tooltip;\n    this.container.appendChild(tooltip);\n  }\n\n  _updateTooltip(u) {\n    if (!this.tooltipEl || !this.currentDataset) {\n      return;\n    }\n\n    const idx = u.cursor.idx;\n    if (idx == null || idx < 0 || idx >= this.currentDataset.labels.length) {\n      this.tooltipEl.style.opacity = '0';\n      return;\n    }\n\n    const labels = this.currentDataset.labels || [];\n    const label = labels[idx] || `Week ${idx + 1}`;\n    const planned = this.currentDataset.planned[idx] ?? 0;\n    const detailArray = Array.isArray(this.currentDataset.details) ? this.currentDataset.details : null;\n    const detailObject = !detailArray && this.currentDataset.details ? this.currentDataset.details : {};\n    const totalCost = Number(detailObject.totalCost || this.currentDataset.totalBiaya || 0) || 0;\n    const weeklyCostSummary = Array.isArray(detailObject.weeklySummary) ? detailObject.weeklySummary : null;\n    const summaryEntry = weeklyCostSummary ? weeklyCostSummary[idx] : null;\n    const isCostView = (this.viewMode || this.currentDataset.viewMode) === 'cost';\n\n    const htmlParts = [\n      `<div style=\"font-weight:600;margin-bottom:4px;\">${label}</div>`,\n    ];\n\n    if (isCostView) {\n      const acSeries = Array.isArray(this.currentDataset.acSeries)\n        ? this.currentDataset.acSeries\n        : this.currentDataset.actual || [];\n      const actual = acSeries[idx] ?? 0;\n      const variance = summaryEntry?.variancePercent ?? Number((actual - planned).toFixed(2));\n      const plannedWeek = Array.isArray(detailObject.weeks) ? detailObject.weeks[idx] : null;\n      const actualWeek = Array.isArray(detailObject.actualWeeks) ? detailObject.actualWeeks[idx] : null;\n      const rangeText = this._formatWeekRange(plannedWeek, actualWeek);\n      const plannedAmount =\n        typeof summaryEntry?.plannedCostValue === 'number'\n          ? formatRupiah(summaryEntry.plannedCostValue)\n          : this._resolveCostAmount(plannedWeek, planned, totalCost);\n      const actualAmount =\n        typeof summaryEntry?.actualCostValue === 'number'\n          ? formatRupiah(summaryEntry.actualCostValue)\n          : this._resolveCostAmount(actualWeek, actual, totalCost);\n      const varianceAmount =\n        typeof summaryEntry?.varianceCostValue === 'number'\n          ? formatRupiah(summaryEntry.varianceCostValue)\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n      htmlParts.push(\n        `<div>Rencana (PV): <strong>${formatPercentage(planned)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span></div>`,\n        `<div>Realisasi (AC): <strong>${formatPercentage(actual)}</strong> <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span></div>`,\n        `<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${varianceAmount ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`,\n      );\n    } else {\n      const actual = this.currentDataset.actual[idx] ?? 0;\n      const variance = Number((actual - planned).toFixed(2));\n      const detail = detailArray ? detailArray[idx] : null;\n      const startLabel = detail?.start ? this._formatDateLabel(detail.start) : '';\n      const endLabel = detail?.end ? this._formatDateLabel(detail.end) : '';\n      const rangeText = this._composeRangeText(startLabel, endLabel);\n      const useHarga = Boolean(this.currentDataset.useHargaCalculation && totalCost > 0);\n      const plannedAmountValue =\n        typeof detail?.plannedCostValue === 'number' ? detail.plannedCostValue : (totalCost * planned) / 100;\n      const actualAmountValue =\n        typeof detail?.actualCostValue === 'number' ? detail.actualCostValue : (totalCost * actual) / 100;\n      const plannedAmount = useHarga ? formatRupiah(plannedAmountValue || 0) : '';\n      const actualAmount = useHarga ? formatRupiah(actualAmountValue || 0) : '';\n      const varianceAmount =\n        useHarga && typeof detail?.varianceCostValue === 'number'\n          ? formatRupiah(detail.varianceCostValue)\n          : useHarga\n          ? formatRupiah((actualAmountValue || 0) - (plannedAmountValue || 0))\n          : '';\n      const varianceColor = this._getVarianceColor(variance);\n\n      if (rangeText) {\n        htmlParts.push(`<div style=\"font-size:0.85em;color:#cbd5e1;margin-bottom:4px;\">Periode: ${rangeText}</div>`);\n      }\n\n      htmlParts.push(`<div>Rencana: <strong>${formatPercentage(planned)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${plannedAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Realisasi: <strong>${formatPercentage(actual)}</strong>${useHarga ? ` <span style=\"color:#cbd5e1;font-size:0.85em;\">(${actualAmount})</span>` : ''}</div>`);\n      htmlParts.push(`<div>Variance: <strong style=\"color:${varianceColor};\">${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%</strong>${useHarga ? ` <span style=\"color:${varianceColor};font-size:0.85em;\">(${varianceAmount})</span>` : ''}</div>`);\n    }\n\n    this.tooltipEl.innerHTML = htmlParts.join('');\n\n    const xValue = u.data[0][idx];\n    const left = u.valToPos(xValue, 'x');\n    const seriesIndex = Math.min(2, u.data.length - 1);\n    let seriesValue = u.data[seriesIndex]?.[idx];\n    if (!Number.isFinite(seriesValue)) {\n      seriesValue = u.data[1]?.[idx] ?? 0;\n    }\n    const top = u.valToPos(seriesValue, 'y');\n    this.tooltipEl.style.left = `${left}px`;\n    this.tooltipEl.style.top = `${top}px`;\n    this.tooltipEl.style.opacity = '1';\n  }\n\n  _updateTooltipPosition() {\n    if (!this.chartInstance || !this.tooltipEl) {\n      return;\n    }\n    const { idx } = this.chartInstance.cursor;\n    if (idx != null) {\n      this._updateTooltip(this.chartInstance);\n    }\n  }\n\n  _formatDateLabel(input) {\n    if (!input) {\n      return '';\n    }\n    let date = input;\n    if (!(input instanceof Date)) {\n      date = new Date(input);\n    }\n    if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\n      return '';\n    }\n    if (!this._dateFormatter && typeof Intl !== 'undefined' && typeof Intl.DateTimeFormat === 'function') {\n      try {\n        this._dateFormatter = new Intl.DateTimeFormat('id-ID', {\n          day: '2-digit',\n          month: 'short',\n          year: 'numeric',\n        });\n      } catch (error) {\n        console.warn(LOG_PREFIX, 'Intl.DateTimeFormat unavailable, falling back to basic formatter:', error);\n        this._dateFormatter = null;\n      }\n    }\n    if (this._dateFormatter) {\n      return this._dateFormatter.format(date);\n    }\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n    return `${day}/${month}/${year}`;\n  }\n\n  _formatWeekRange(plannedWeek, actualWeek) {\n    const startRaw = plannedWeek?.week_start || actualWeek?.week_start;\n    const endRaw = plannedWeek?.week_end || actualWeek?.week_end;\n    const startLabel = startRaw ? this._formatDateLabel(new Date(startRaw)) : '';\n    const endLabel = endRaw ? this._formatDateLabel(new Date(endRaw)) : '';\n    return this._composeRangeText(startLabel, endLabel);\n  }\n\n  _composeRangeText(startLabel, endLabel) {\n    if (startLabel && endLabel) {\n      return `${startLabel} - ${endLabel}`;\n    }\n    return startLabel || endLabel || '';\n  }\n\n  _getVarianceColor(value) {\n    if (value > 0.1) {\n      return '#f87171';\n    }\n    if (value < -0.1) {\n      return '#22c55e';\n    }\n    return '#cbd5e1';\n  }\n\n  _resolveCostAmount(weekEntry, percent, totalCost) {\n    if (weekEntry) {\n      const cumulative = this._parseNumber(weekEntry.cumulative_cost);\n      if (Number.isFinite(cumulative) && cumulative > 0) {\n        return formatRupiah(cumulative);\n      }\n      const singleCost = this._parseNumber(weekEntry.cost);\n      if (Number.isFinite(singleCost) && singleCost > 0) {\n        return formatRupiah(singleCost);\n      }\n    }\n\n    if (!Number.isFinite(totalCost) || totalCost <= 0) {\n      return formatRupiah(0);\n    }\n    return formatRupiah((totalCost * percent) / 100);\n  }\n\n  _parseNumber(value) {\n    if (typeof value === 'number') {\n      return value;\n    }\n    if (typeof value === 'string') {\n      const parsed = Number(value);\n      return Number.isFinite(parsed) ? parsed : NaN;\n    }\n    return NaN;\n  }\n}\n\nexport default KurvaSUPlotChart;\n"],"names":["GanttCanvasOverlay","constructor","tableManager","this","debug","Boolean","_b","_a","options","debugUnifiedTable","_d","_c","state","window","DEBUG_UNIFIED_TABLE","canvas","document","createElement","className","style","cssText","ctx","getContext","mask","visible","barData","dependencies","barRects","tooltip","pinnedWidth","scrollLeft","_syncScheduled","lastDrawMetrics","barsDrawn","barsSkipped","scrollTarget","_e","bodyScroll","addEventListener","_updateTransform","requestAnimationFrame","syncWithTable","passive","_bindPointerEvents","show","scrollArea","position","overflow","parent","parentElement","_updatePinnedClip","parentNode","appendChild","console","log","_log","hide","removeChild","_hideTooltip","transform","viewportWidth","clientWidth","width","Math","min","height","clientHeight","left","top","display","cellRects","getCellBoundingRects","clearRect","save","canvasSize","w","h","scrollAreaSize","scrollWidth","scrollHeight","visibleSize","scroll","scrollTop","length","bars","cells","deps","size","error","strokeStyle","forEach","rect","canvasX","x","strokeRect","y","_drawBars","_publishMetrics","_drawDependencies","restore","renderBars","Array","isArray","renderDependencies","dependencyData","getPinnedColumnsWidth","Number","max","clipPath","webkitClipPath","setProperty","viewportLeft","viewportRight","metrics","timestamp","Date","now","clipLeft","GanttOverlayMetrics","rectIndex","Map","r","key","String","pekerjaanId","has","set","get","push","list","sort","a","b","barsByRow","bar","pkjId","rects","rectMap","map","columnId","maxWidth","paddingX","baseX","baseY","fullHeight","paddingY","trackHeight","plannedValue","isFinite","planned","actualValue","actual","value","plannedWidth","fillStyle","_getPlannedColor","fillRect","actualWidth","barColor","color","_resolveActualColor","variance","label","drawn","skipped","total","dep","fromRect","find","c","fromPekerjaanId","fromColumnId","toRect","toPekerjaanId","toColumnId","fromX","fromY","toX","toY","lineWidth","beginPath","moveTo","lineTo","stroke","angle","atan2","cos","PI","sin","closePath","fill","_resolveVarianceColor","cssVar","_getCssVar","_getBtnColor","name","root","documentElement","getComputedStyle","getPropertyValue","trim","e","selector","el","querySelector","getBoundingClientRect","clientX","clientY","hit","_hitTest","_showTooltip","_ensureTooltip","body","tip","innerHTML","event","payload","normalizeDate","input","isNaN","getTime","date","getVolumeForPekerjaan","volumeLookup","fallback","idVariants","variant","getHargaForPekerjaan","hargaLookup","buildCellValueMap","warn","assignValue","numeric","parseFloat","assignmentMap","Object","entries","modifiedCells","collectPekerjaanIds","cellValues","ids","Set","flatPekerjaan","node","type","add","id","_","split","formatPercentage","decimals","round","toFixed","formatRupiah","amount","toLocaleString","ensureWeekZeroDataset","dataset","labels","firstLabel","toLowerCase","includes","zeroLabel","viewMode","plannedSeries","actualSeries","updated","__spreadProps","acSeries","details","isCostView","start","end","weekNumber","zeroWeek","week_number","week_start","week_end","cost","cumulative_cost","cumulative_percent","pekerjaan_breakdown","weeks","actualWeeks","prependZeroDetails","LOG_PREFIX","buildProgressDataset","columns","slice","aStart","startDate","bStart","index","getSortedColumns","timeColumns","lookup","setVolume","numericKey","volume","volumeMap","vol","buildVolumeLookup","setHarga","harga","hargaMap","buildHargaLookup","stateManager","plannedCellValues","actualCellValues","getAllCellsForMode","plannedState","actualState","pekerjaanIds","totalBiaya","totalBiayaProject","useHargaCalculation","totalVolume","columnIndexById","col","displayLabel","display_name","start_date","end_date","generateLabels","totalValue","plannedTotals","cellKey","columnIndex","numericValue","kontribusi","cumulative","calculatePlannedCurve","actualColumnTotals","totals","calculateColumnTotals","columnTotals","calculateActualCurve","column","plannedCumulative","actualCumulative","prevPlannedCumulative","prevActualCumulative","plannedWeekProgress","actualWeekProgress","plannedCostValue","actualCostValue","varianceCostValue","endDate","metadata","buildDetailData","buildCostDataset","costData","weeklyData","summary","evm","totalCost","bac","total_project_cost","weeklySummary","buildCostWeeklySummary","pv_percent","ev_percent","ac_percent","varianceSeries","varianceCostSeries","entry","evmSummary","earned","plannedCost","planned_cost","actualCost","actual_cost","plannedPoints","actualPoints","plannedWeeks","maxLength","plannedEntry","actualEntry","plannedPercent","percent","actualPercent","_h","_g","_f","resolveCostValue","variancePercent","_j","_i","range","weekEntry","numericPercent","toNumber","accumulated_cost","acc_cost","singleCost","parsed","NaN","KeyboardShortcuts","shortcuts","enabled","_boundHandler","_handleKeyDown","bind","init","register","callback","description","preventDefault","unregister","delete","activeElement","isInput","tagName","isContentEditable","parts","ctrlKey","altKey","shiftKey","metaKey","combo","join","shortcut","enable","disable","getShortcuts","from","data","destroy","removeEventListener","clear","RippleEffect","element","classList","ripple","setTimeout","remove","addToAll","querySelectorAll","ButtonStateManager","setLoading","button","loadingText","originalText","disabled","setSuccess","duration","setError","reset","markChanges","hasChanges","setAttribute","removeAttribute","Toast","success","message","DP","core","toast","warning","info","initializeUXEnhancements","btn","hasAttribute","getAttribute","OFF","pre","LEGEND_LABEL","WIDTH","HEIGHT","TOP","BOTTOM","LEFT","RIGHT","hexBlack","transparent","mousemove","mousedown","mouseup","mouseenter","mouseleave","dblclick","change","dppxchange","LEGEND_DISP","domEnv","doc","win","nav","navigator","pxRatio","query","addClass","cl","contains","remClass","setStylePx","placeTag","tag","cls","targ","refEl","insertBefore","placeDiv","xformCache","WeakMap","elTrans","xPos","yPos","xMax","yMax","xform","colorCache","elColor","background","borderColor","newColor","sizeCache","elSize","newWid","newHgt","centered","newSize","marginLeft","marginTop","evOpts","evOpts2","__spreadValues","capture","on","ev","cb","capt","off","closestIdx","num","arr","lo","hi","mid","bitwise","floor","makeIndexOfs","predicate","_i0","_i1","i0","i1","i","setPxRatio","_pxRatio","devicePixelRatio","matchMedia","dispatchEvent","CustomEvent","notNullish","v","isPositive","nonNullIdxs","positiveIdxs","rangeLog","base","fullMags","minSign","sign","maxSign","logFn","log10","log2","growMaxAbs","ceil","minExp","abs","maxExp","minIncr","pow","maxIncr","roundDec","incrRoundDn","incrRoundUp","rangeAsinh","minMax","autoRangePart","mode","pad","_eqRangePart","soft","_eqRange","rangeNum","_min","_max","mult","extra","isObj","_rangeNum","ifNull","lh","rh","cfg","cmin","cmax","padMin","padMax","hardMin","hard","inf","hardMax","softMin","softMax","softMinMode","softMaxMode","delta","deltaMag","scalarMax","scalarMag","scalarMagDelta","nonZeroDelta","mag","_newMin","_softMin","minLim","_newMax","_softMax","maxLim","numFormatter","Intl","NumberFormat","language","fmtNum","val","format","M","asinh","linthresh","Infinity","numIntDigits","clamp","isFn","fnOrSelf","retArg0","_0","retArg1","_1","retNull","retTrue","retEq","regex6","fixFloat","isInt","fixedDec","str","match","len","indexOf","exp","incrRound","incr","dec","p","__pow","n","EPSILON","guessDec","genIncrs","mults","incrs","multDec","expa","_incr","EMPTY_OBJ","EMPTY_ARR","nullNullTuple","isArr","isInteger","isStr","is","fastIsObj","TypedArray","getPrototypeOf","Uint8Array","__proto__","copy","o","_isObj","out","k","assign","args","arguments","src","nullExpand","yVals","nullIdxs","alignedLen","xi","lastNullIdx","nullIdx","microTask","queueMicrotask","fn","Promise","resolve","then","months","days","slice3","days3","months3","engNames","MMMM","MMM","WWWW","WWW","zeroPad2","int","subs","YYYY","d","getFullYear","YY","names","getMonth","MM","DD","getDate","D","getDay","HH","getHours","H","AA","aa","mm","getMinutes","m","ss","getSeconds","s","fff","zeroPad3","getMilliseconds","fmtDate","tpl","R","exec","localTz","DateTimeFormat","resolvedOptions","timeZone","onlyWhole","allMults","decIncrs","oneIncrs","wholeIncrs","filter","numIncrs","concat","yyyy","NLyyyy","md","NLmd","NLmdyy","hmmaa","NLhmmaa","genTimeStuffs","ms","mo","tzDate","self","axisIdx","scaleMin","scaleMax","foundIncr","foundSpace","splits","isYr","isMo","minDate","minDateTs","minMin","mkDate","minMinTs","moIncr","yrIncr","splitDate","baseYear","baseMonth","next","offs","incr0","date0","prevHour","incrHours","pctSpace","axes","_space","expectedHour","dstShift","timeIncrsMs","_timeAxisStampsMs","timeAxisSplitsMs","timeIncrsS","_timeAxisStampsS","timeAxisSplitsS","timeAxisStamps","stampCfg","timeAxisVals","stamps","prevYear","prevMnth","prevDate","prevMins","prevSecs","newYear","newMnth","newDate","newHour","newMins","newSecs","stamp","timeSeriesStamp","timeSeriesVal","seriesIdx","dataIdx","legendOpts","live","isolate","mount","markers","series","points","dash","idx","idxs","values","moveTuple","filtBtn0","handle","onlyTarg","target","filtTarg","cursorOpts","lock","move","mouseLeft1","mouseTop1","one","si","cursor","pt","mar","sp","_stroke","_fill","click","drag","setScale","dist","uni","stopPropagation","stopImmediatePropagation","_x","_y","focus","valPos","curPos","prox","bias","hover","skip","axisLines","grid","ticks","border","font","labelFont","xAxisOpts","scale","space","gap","alignTo","labelGap","labelSize","side","lineGap","rotate","xSeriesOpts","auto","sorted","numAxisVals","numAxisSplits","forceMin","numDec","logAxisSplits","logBase","scales","nextMagIncr","asinhAxisSplits","posSplits","zero","reverse","RE_ALL","RE_12357","RE_125","RE_1","_filt","distr","re","keepMod","test","toExponential","log10AxisValsFilt","axis","scaleKey","sc","valToPos","minSpace","_10","magSpace","log2AxisValsFilt","numSeriesVal","yAxisOpts","facet","gaps","idx0","idx1","nullGaps","xySeriesOpts","alpha","facets","ySeriesOpts","spanGaps","xData","_data","p0","p1","maxPts","path","clip","clampScale","xScaleOpts","time","dir","ori","yScaleOpts","syncs","_sync","opts","plots","sub","plot","unsub","pub","j","orient","u","bbox","dx","dy","sx","sy","l","t","valToPosH","V","valToPosV","moveToH","lineToH","rectH","arcH","bezierCurveToH","moveToV","lineToV","rectV","arcV","bezierCurveToV","bandFillClipDirs","fillDir","clipDirs","bands","seriesFillTo","dataMin","dataMax","bandFillDir","clipBandLine","strokePath","clipDir","dataX","dataY","scaleX","scaleY","valToPosX","valToPosY","xOff","yOff","xDim","yDim","pxRound","frIdx","toIdx","x0","y0","x1","yLimit","Path2D","clipGaps","plotLft","plotTop","plotWid","plotHgt","prevGapEnd","g","maxStrokeWidth","findGaps","xs","ys","pixelForX","align","fr","to","frPx","toPx","fri2","toi2","pxRoundGen","pxAlign","arcTo","y1","x2","y2","endRad","baseRad","startAngle","endAngle","arc","bp1x","bp1y","bp2x","bp2y","p2x","p2y","bezierCurveTo","filtIdxs","rad","dia","lft","wid","hgt","drawPoint","pi","flags","BAND_CLIP_FILL","_drawAcc","accX","minY","maxY","inY","outY","drawAccH","drawAccV","linear","alignGaps","drawAcc","pixelForY","_paths","band","hasGap","drawnAtX","xForPixel","pos","posToVal","idx0px","idx1px","nextAccXVal","xVal","yVal","bandClipDir","fillToY","fillTo","frX","findColWidth","colWid","prevIdx","minDelta","_monotoneCubic","ds","dys","dxs","cursorPlots","invalidateRects","syncRect","uPlot","linearPath","pointsPath","setDefaults","xo","yo","initY","setDefault","snapNumX","snapTimeX","snapNumY","snapLogY","snapLogX","snapAsinhY","snapAsinhX","pxRatioFont","fontSize","fontSizeCss","replace","syncFontSize","f","getHPos","dim","pct","valToPct","getVPos","getPos","ready","status","class","title","textContent","can","wrap","over","mouseLeft0","mouseTop0","under","plugins","xyo","xScaleKey","drawOrderMap","_show","shiftDir","_found","shiftAmt","baseLpos","_lpos","setFontStyle","translate","_label","fillText","plotDim","plotOff","_splits","data0","_tickSize","tickSize","axisGap","_size","_rotate","basePos","_pos","finalPos","lineHeight","canOffs","_values","_parts","text","drawOrthoLines","cap","fire","dataLen","shouldAlpha","some","_focus","ctxAlpha","globalAlpha","cacheStrokeFill","_ctxAlpha","_idxs","ydata","getOuterIdxs","paths","drawPath","_gaps","drawOrder","initValToPct","getVal","fwd","_val","initScale","scaleOpts","isTime","rn","rangeIsArr","xScaleDistr","pendScales","_tzDate","ts","_fmtDate","_timeAxisSplits","_timeAxisVals","_timeSeriesVal","activeIdxs","legend","showLegend","showCursor","legendTable","legendHead","legendBody","legendCols","legendRows","legendCells","multiValLegend","NULL_LEGEND_VALUES","getMultiVals","head","son","soff","mouseListeners","onMouse","targListeners","listener","offMouse","fullWidCss","fullHgtCss","plotWidCss","plotHgtCss","plotLftCss","plotTopCss","_plotLftCss","_plotTopCss","_plotWidCss","_plotHgtCss","shouldSetScales","shouldSetSize","shouldConvergeSize","shouldSetCursor","shouldSetSelect","shouldSetLegend","_setSize","force","calcSize","resetYSeries","commit","hasTopAxis","hasBtmAxis","hasRgtAxis","hasLftAxis","isVt","fullSize","sidesWithAxes","_padding","calcPlotRect","off1","off2","off3","off0","incrOffset","calcAxesRects","bb","CYCLE_LIMIT","setSize","hov","cursorIdx","valAtPosX","idx2","_prox","withProx","cursorLft","xValues","yValues","nonNullLft","nonNullRgt","lftDelta","rgtDelta","setCursorEvent","_lock","cursorFocus","cursorOnePt","cursorPts","cursorPtsLft","cursorPtsTop","initCursorPt","HTMLElement","initSeries","sv","_ptDia","rowCells","row","childNodes","indic","setSeries","syncOpts","FOCUS_TRUE","initLegendRow","splice","addSeries","delSeries","tr","firstChild","autoPadSide","cycleNum","padding","ctxStroke","ctxFill","ctxWidth","ctxDash","ctxJoin","ctxCap","ctxFont","ctxAlign","ctxBaseline","viaAutoScaleX","setData","_resetScales","scaleData","_data0","xsc","autoScaleX","_setScale","setCtxStyle","lineJoin","lineCap","setLineDash","baseline","textAlign","textBaseline","accScale","wsc","psc","getEdgeIdxs","getMinMax","AUTOSCALE","_points","gapsClip","_width","boundsClip","offset","_pxAlign","strokeFill","lineDash","fillPath","didStrokeFill","bi","gapsClip2","lowerEdge","lowerData","bandClip","_fillStyle","hasData","fillStroke","CLIP_FILL_STROKE","doFill","doStroke","getIncrSpace","fullDim","incrSpace","minVal","maxVal","intDigits","incrIdx","findIncr","_incrs","filts","pos0","pos1","axesCalc","converged","oldSize","paddingCalc","_p","xCursor","yCursor","vCursor","hCursor","rawMouseLeft0","rawMouseTop0","rawMouseLeft1","rawMouseTop1","queuedCommit","deferHooks","hooksQueue","flushHooks","_commit","wipScales","xFacet","yFacet","yScaleKey","yData","wscx","wscy","changed","anyChanged","setScales","axesConverged","paddingConverged","convergeSize","_el","pctWid","pctHgt","select","prop","_hideProps","selectDiv","setSelect","updateCursor","setLegend","batch","_deferHooks","redraw","rebuildPaths","recalcAxes","dragging","dragX","dragY","_fire","_pub","focusedSeries","allFocused","_setAlpha","i2","isFocused","opacity","setAlpha","setFocus","toggleDOM","pubSync","closestDist","closestSeries","addBand","setBand","delBand","sinh","bwd","setSelH","setSelV","valToIdx","posToIdx","setCursor","setSelX","setSelY","didx","sidx","setLegendValues","vals","nodeValue","syncLegend","noDataInRange","mouseXPos","_ptLft","_ptTop","_ptWid","_ptHgt","_centered","_ptFill","_ptStroke","yVal1","yVal2","xPos2","mouseYPos","mouseYVal","mouseYValSign","hPos","vPos","ptWid","ptHgt","ptLft","ptTop","ptStroke","ptFill","getBBox","xKey","yKey","matchXKeys","matchYKeys","xKeySrc","yKeySrc","sync","sdrag","sOff","sDim","sori","sPosToVal","matchingX","matchingY","hideSelect","rawDX","rawDY","_rawDX","syncKey","xSyncKey","ySyncKey","shouldPub","defer","mouseMove","_l","_t","_w","movementX","movementY","cacheMouse","initial","snap","syncOptsSrc","xValSrc","yValSrc","rotSrc","_xDim","_yDim","_xPos","_yPos","__l","defineProperty","downSelectLeft","downSelectTop","downSelectWidth","downSelectHeight","mouseDown","mouseUp","hasSelect","chgSelect","dblClick","syncPxRatio","events","seriesIdxMatcher","_dragging","dragH","dragV","snapH","snapV","snapProx","hooks","evName","a1","a2","call","srcSeriesIdx","filters","_init","av","dateTpl","timeAxisVal","tables","nullModes","vals0","len0","vals1","allHeadersSame","table","samples","firstIdx","lastIdx","stride","prevVal","isAsc","rlen","table2","row2","sortCols","xVals","ti","xIdxs","nullMode","alignedIdx","tz","date2","getTimezoneOffset","setMilliseconds","addGap","prevGap","stepped","ascDesc","extend","prevYPos","firstXPos","prevXPos","firstXPosExt","prevXPosExt","halfStroke","startsOffset","endsOffset","_extraGap","ro","radius","radiusFn","gapFactor","_maxWidth","_minWidth","disp","_each","each","dispFills","dispStrokes","valRadius","baseRadius","_align","extraGap","minWidth","_dirX","xShift","barWid","fullGap","strokeWidth","multiPath","fillColors","fillPaths","strokeColors","strokePaths","unit","sizes","insetStroke","dataY0","radVal","radBase","yVal0","btm","barHgt","rv","rb","spline","interp","xCoords","yCoords","splineInterp","DEFAULT_OPTIONS","enableCostView","KurvaSUPlotChart","chartInstance","container","tooltipEl","resizeHandler","resizeObserver","themeObserver","currentDataset","isLoadingCostData","_interactionAttached","_wheelHandler","_interactionTarget","_scaleBounds","_dateFormatter","initialize","_createTooltip","observer","MutationObserver","mutations","mutation","attributeName","theme","observe","attributes","attributeFilter","setupThemeObserver","_rebuild","delay","timeoutId","clearTimeout","createResizeHandler","resize","ResizeObserver","contentRect","setupResizeObserver","update","resolvedDataset","transformedData","_transformDataset","colors","plannedLine","plannedArea","actualLine","actualArea","costActualLine","costActualArea","gridLine","_updateScaleBounds","_buildChartOptions","_attachInteractions","_updateTooltipPosition","toggleView","__async","nextMode","fetchCostData","costDataset","renderMonthlyMode","monthlyData","monthlyDataset","month","granularity","renderWeeklyMode","weeklyDataset","dispose","_detachInteractions","disconnect","projectId","url","response","fetch","method","headers","ok","Error","statusText","json","nearestIndex","_updateTooltip","first","last","_handleWheelInteraction","isZoomGesture","isPanGesture","bounds","currentMin","currentMax","zoomIntensity","direction","deltaY","factor","overRect","cursorX","cursorVal","resolvedCursor","newMin","newMax","_setScaleBounded","panStep","targetMin","targetMax","boundsSpan","windowSize","pointerEvents","borderRadius","transition","detailArray","detailObject","weeklyCostSummary","summaryEntry","htmlParts","plannedWeek","actualWeek","rangeText","_formatWeekRange","plannedAmount","_resolveCostAmount","actualAmount","varianceAmount","varianceColor","_getVarianceColor","detail","startLabel","_formatDateLabel","endLabel","_composeRangeText","useHarga","plannedAmountValue","actualAmountValue","xValue","seriesIndex","seriesValue","day","year","padStart","startRaw","endRaw","_parseNumber"],"mappings":"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","x_google_ignoreList":[5]}