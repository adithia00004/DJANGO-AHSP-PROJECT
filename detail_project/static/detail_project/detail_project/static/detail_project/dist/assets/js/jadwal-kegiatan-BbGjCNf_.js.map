{"version":3,"mappings":"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","names":["KeyboardShortcuts","constructor","this","shortcuts","Map","enabled","_boundHandler","_handleKeyDown","bind","init","document","addEventListener","console","log","register","key","callback","options","description","preventDefault","set","toLowerCase","unregister","delete","event","activeElement","isInput","tagName","isContentEditable","parts","ctrlKey","push","altKey","shiftKey","metaKey","includes","combo","join","shortcut","get","enable","disable","getShortcuts","Array","from","entries","map","data","destroy","removeEventListener","clear","RippleEffect","add","element","classList","e","ripple","createElement","rect","getBoundingClientRect","size","Math","max","width","height","x","clientX","left","y","clientY","top","style","appendChild","setTimeout","remove","addToAll","selector","querySelectorAll","forEach","el","ButtonStateManager","setLoading","button","loadingText","dataset","originalText","innerHTML","disabled","setSuccess","duration","setError","reset","markChanges","hasChanges","setAttribute","removeAttribute","Toast","success","message","_b","_a","window","DP","core","toast","show","error","warning","warn","info","JadwalKegiatanApp","state","eventManager","initialized","agGridManager","stateManager","StateManager","getInstance","dataLoader","timeColumnGenerator","gridRenderer","saveHandler","kurvaSChart","ganttChart","ganttFrozenGrid","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_getProjectDateRange","start","end","projectStart","parsed","Date","Number","isNaN","getTime","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","floor","ceil","_countWeeklyColumns","isArray","timeColumns","filter","col","mode","generationMode","type","isFinite","weekNumber","week_number","length","initialize","__async","arguments","config","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","Set","volumeMap","isLoading","domRefs","apiEndpoints","projectId","projectName","useAgGrid","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","progressMode","displayMode","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","getCurrentState","defineProperty","states","modifiedCells","configurable","assignmentMap","costAssignmentMap","costModifiedCells","hasUnsavedChanges","value","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","_c","toggle","Boolean","root","getElementById","leftThead","rightThead","leftTbody","rightTbody","leftPanelScroll","querySelector","rightPanelScroll","rightTable","horizontalScrollTop","horizontalScrollInner","timeHeaderRow","refreshButton","resetButton","agGridContainer","agGridTopScroll","agGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","allowedTimeScales","datasetScale","defaultTimeScale","toString","has","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","_d","weekend","weekEnd","week_end_day","parsedWeekStartDay","_f","_e","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","apiResetProgress","enableAgGrid","helpers","updateProgressIndicator","pekerjaanId","total","showToast","cleanup","attachGridEvents","_attachToolbarEvents","_initAgGridIfNeeded","saveChanges","refresh","_handleResetProgress","_syncToolbarRadios","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","hide","_showKeyboardShortcutsHelp","btn","hasAttribute","getAttribute","modalHtml","s","replace","existingModal","body","insertAdjacentHTML","Modal","ExportManager","format","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","toggleView","_setCostToggleButtonState","viewMode","isCostMode","label","iconClass","textContent","className","_activateDefaultCostView","enableCostView","groupName","handler","radios","radio","target","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","modeLabel","confirm","_updateStatusBar","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","text","catch","status","result","json","_resetEditedCellsState","_clearFailedRows","forceReload","String","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_syncGridViews","_recalculateAllProgressTotals","_invalidateCachedDataset","flatPekerjaan","clearTimeout","payload","then","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","__spreadValues","successMessage","next","pyDay","_updateCostToggleAvailability","setInputMode","oldMode","oldStats","getStats","switchMode","newStats","toUpperCase","modifiedCount","assignmentCount","indicator","bgClass","cssText","isActual","nextScale","_renderGrid","_updateCharts","container","AGGridManager","onCellChange","_handleAgGridCellChange","getCellValidationState","cellKey","_getCellValidationState","mount","DataLoader","GridRenderer","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","_g","_i","_h","loadAssignments","_loadKurvaSData","_j","_k","_l","_initializeCharts","statusText","hargaMap","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","keys","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","activeTimeColumns","_getDisplayTimeColumns","rendered","renderTables","leftHTML","rightHTML","renderTimeHeader","syncRowHeights","_updateLegacyHorizontalScroll","_loadChartModules","kurvaSModule","ganttModule","Promise","all","__vitePreload","import","n","__VITE_PRELOAD__","f","KurvaSChartClass","KurvaSChart","GanttChartClass","GanttChart","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","resolve","ganttContainer","ganttView","ganttTab","_initializeFrozenGantt","stack","GanttFrozenGrid","rowHeight","_prepareGanttData","pekerjaanNodes","node","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","id","column_id","actualVal","round","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_id","pekerjaan_name","nama","name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_rencana","progress_realisasi","satuan","projectMeta","project_id","project_name","start_date","end_date","project","milestones","_setupLazyChartLoading","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","scrollTop","deltaY","passive","_escapeHtml","char","_validateRowTotalsBeforeSave","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","_buildTimeColumns","tahap","index","rawId","fieldId","order","urutan","startDate","tanggal_mulai","endDate","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","columns","_fetchJson","_0","url","errorText","displayColumns","updateData","tree","updateTopScrollMetrics","scrollInner","requestAnimationFrame","scrollWidth","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","call","_calculateRowTotalPercent","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","refreshCells","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","find","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","combined","concat","messages","slice","pekerjaanCount","totalProgress","_calculateProjectProgress","maximumFractionDigits","aggregate","avg","pekerjaanTotals","split","numericValue","sum","_buildAssignmentsPayload","assignments","columnIndex","_parseCellKey","columnMeta","proportion","tahapan_id","_getSaveMode","fallback","fallbackSafe","baseColumns","weeklyColumns","isWeeklyColumn","sourceColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","rangeLabel","endLabel","tooltip","childColumns","separatorIndex","indexOf","cookieValue","cookie","cookies","trim","substring","decodeURIComponent","displayValue","isVolumeMode","validation","columnId","valueType","normalizedValue","modeState","resolvedPekerjaanId","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/shared/ux-enhancements.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["/**\r\n * UX Enhancements Module\r\n * Provides keyboard shortcuts, ripple effects, and other UX improvements\r\n * @module ux-enhancements\r\n */\r\n\r\n/**\r\n * Keyboard Shortcuts Manager\r\n */\r\nexport class KeyboardShortcuts {\r\n  constructor() {\r\n    this.shortcuts = new Map();\r\n    this.enabled = true;\r\n    this._boundHandler = this._handleKeyDown.bind(this);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    document.addEventListener('keydown', this._boundHandler);\r\n    console.log(' Keyboard shortcuts initialized');\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * @param {string} key - Key combination (e.g., 'ctrl+s', 'alt+p')\r\n   * @param {Function} callback - Function to call when shortcut triggered\r\n   * @param {Object} options - Additional options\r\n   */\r\n  register(key, callback, options = {}) {\r\n    const { description = '', preventDefault = true } = options;\r\n\r\n    this.shortcuts.set(key.toLowerCase(), {\r\n      callback,\r\n      description,\r\n      preventDefault\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unregister a keyboard shortcut\r\n   */\r\n  unregister(key) {\r\n    this.shortcuts.delete(key.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  _handleKeyDown(event) {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input/textarea\r\n    const activeElement = document.activeElement;\r\n    const isInput = activeElement.tagName === 'INPUT' ||\r\n                   activeElement.tagName === 'TEXTAREA' ||\r\n                   activeElement.isContentEditable;\r\n\r\n    // Build key combination string\r\n    const parts = [];\r\n    if (event.ctrlKey) parts.push('ctrl');\r\n    if (event.altKey) parts.push('alt');\r\n    if (event.shiftKey) parts.push('shift');\r\n    if (event.metaKey) parts.push('meta');\r\n\r\n    const key = event.key.toLowerCase();\r\n    if (!['control', 'alt', 'shift', 'meta'].includes(key)) {\r\n      parts.push(key);\r\n    }\r\n\r\n    const combo = parts.join('+');\r\n    const shortcut = this.shortcuts.get(combo);\r\n\r\n    if (shortcut) {\r\n      // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X in inputs\r\n      const allowedInInput = ['ctrl+a', 'ctrl+c', 'ctrl+v', 'ctrl+x', 'ctrl+z'];\r\n      if (isInput && !allowedInInput.includes(combo)) {\r\n        return;\r\n      }\r\n\r\n      if (shortcut.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      shortcut.callback(event);\r\n      console.log(` Shortcut triggered: ${combo}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable shortcuts\r\n   */\r\n  enable() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * Disable shortcuts\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getShortcuts() {\r\n    return Array.from(this.shortcuts.entries()).map(([key, data]) => ({\r\n      key,\r\n      description: data.description\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    document.removeEventListener('keydown', this._boundHandler);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n/**\r\n * Ripple Effect Manager\r\n */\r\nexport class RippleEffect {\r\n  /**\r\n   * Add ripple effect to element\r\n   * @param {HTMLElement} element - Target element\r\n   */\r\n  static add(element) {\r\n    if (!element) return;\r\n\r\n    element.classList.add('btn-ripple');\r\n\r\n    // Optional: Add click listener for more control\r\n    element.addEventListener('click', function(e) {\r\n      const ripple = document.createElement('span');\r\n      ripple.classList.add('ripple-circle');\r\n\r\n      const rect = this.getBoundingClientRect();\r\n      const size = Math.max(rect.width, rect.height);\r\n      const x = e.clientX - rect.left - size / 2;\r\n      const y = e.clientY - rect.top - size / 2;\r\n\r\n      ripple.style.width = ripple.style.height = size + 'px';\r\n      ripple.style.left = x + 'px';\r\n      ripple.style.top = y + 'px';\r\n\r\n      this.appendChild(ripple);\r\n\r\n      setTimeout(() => ripple.remove(), 600);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add ripple to multiple elements\r\n   * @param {string} selector - CSS selector\r\n   */\r\n  static addToAll(selector) {\r\n    document.querySelectorAll(selector).forEach(el => {\r\n      RippleEffect.add(el);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Button State Manager\r\n */\r\nexport class ButtonStateManager {\r\n  /**\r\n   * Set button to loading state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {string} loadingText - Optional loading text\r\n   */\r\n  static setLoading(button, loadingText = 'Loading...') {\r\n    if (!button) return;\r\n\r\n    button.dataset.originalText = button.innerHTML;\r\n    button.disabled = true;\r\n    button.classList.add('loading');\r\n\r\n    const spinner = '<span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>';\r\n    button.innerHTML = spinner + loadingText;\r\n  }\r\n\r\n  /**\r\n   * Set button to success state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show success state (ms)\r\n   */\r\n  static setSuccess(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('success');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('success');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Set button to error state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show error state (ms)\r\n   */\r\n  static setError(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('error');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Reset button to normal state\r\n   * @param {HTMLElement} button - Button element\r\n   */\r\n  static reset(button) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading', 'success', 'error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark button with \"has changes\" indicator\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} hasChanges - Whether there are unsaved changes\r\n   */\r\n  static markChanges(button, hasChanges) {\r\n    if (!button) return;\r\n\r\n    if (hasChanges) {\r\n      button.classList.add('has-changes');\r\n      button.setAttribute('data-tooltip', 'You have unsaved changes');\r\n    } else {\r\n      button.classList.remove('has-changes');\r\n      button.removeAttribute('data-tooltip');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toast Notifications (wrapper untuk DP.core.toast)\r\n */\r\nexport class Toast {\r\n  /**\r\n   * Show success toast\r\n   */\r\n  static success(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'success', duration);\r\n    } else {\r\n      console.log(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error toast\r\n   */\r\n  static error(message, duration = 3000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'danger', duration);\r\n    } else {\r\n      console.error(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show warning toast\r\n   */\r\n  static warning(message, duration = 2000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'warning', duration);\r\n    } else {\r\n      console.warn(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show info toast\r\n   */\r\n  static info(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'info', duration);\r\n    } else {\r\n      console.info(` ${message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Smooth Scroll Helper\r\n */\r\nexport class SmoothScroll {\r\n  /**\r\n   * Scroll to element smoothly\r\n   * @param {HTMLElement|string} target - Element or selector\r\n   * @param {Object} options - Scroll options\r\n   */\r\n  static to(target, options = {}) {\r\n    const element = typeof target === 'string'\r\n      ? document.querySelector(target)\r\n      : target;\r\n\r\n    if (!element) return;\r\n\r\n    const {\r\n      offset = 0,\r\n      behavior = 'smooth',\r\n      block = 'start'\r\n    } = options;\r\n\r\n    const elementPosition = element.getBoundingClientRect().top;\r\n    const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n    window.scrollTo({\r\n      top: offsetPosition,\r\n      behavior\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Scroll to top\r\n   */\r\n  static toTop() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      behavior: 'smooth'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce utility\r\n */\r\nexport function debounce(func, wait = 300) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle utility\r\n */\r\nexport function throttle(func, limit = 100) {\r\n  let inThrottle;\r\n  return function executedFunction(...args) {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize all UX enhancements\r\n */\r\nexport function initializeUXEnhancements() {\r\n  console.log(' Initializing UX enhancements...');\r\n\r\n  // Add ripple effects to all primary buttons\r\n  RippleEffect.addToAll('.btn-primary, .btn-save, .btn-danger');\r\n\r\n  // Add tooltips to buttons with title attribute\r\n  document.querySelectorAll('button[title]').forEach(btn => {\r\n    if (!btn.hasAttribute('data-tooltip')) {\r\n      btn.setAttribute('data-tooltip', btn.getAttribute('title'));\r\n    }\r\n  });\r\n\r\n  console.log(' UX enhancements initialized');\r\n}\r\n\r\n/**\r\n * Default export\r\n */\r\nexport default {\r\n  KeyboardShortcuts,\r\n  RippleEffect,\r\n  ButtonStateManager,\r\n  Toast,\r\n  SmoothScroll,\r\n  debounce,\r\n  throttle,\r\n  initializeUXEnhancements\r\n};\r\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { attachGridEvents } from '@modules/grid/grid-event-handlers.js';\r\nimport { AGGridManager } from '@modules/grid/ag-grid-setup.js';\r\nimport { updateProgressIndicator } from '@modules/shared/validation-utils.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { GridRenderer } from '@modules/grid/grid-renderer.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.eventManager = null;\r\n    this.initialized = false;\r\n    this.agGridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.gridRenderer = null;\r\n    this.saveHandler = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useAgGrid: true, // Performance: AG Grid default enabled for large datasets\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        leftThead: document.getElementById('left-thead'),\r\n        rightThead: document.getElementById('right-thead'),\r\n        leftTbody: document.getElementById('left-tbody'),\r\n        rightTbody: document.getElementById('right-tbody'),\r\n        leftPanelScroll: document.querySelector('.left-panel-scroll'),\r\n        rightPanelScroll:\r\n          document.getElementById('right-panel-scroll-bottom') ||\r\n          document.querySelector('.right-panel-scroll'),\r\n        rightTable: document.getElementById('right-table'),\r\n        horizontalScrollTop: document.getElementById('right-panel-scroll-top'),\r\n        horizontalScrollInner: document.getElementById('right-panel-scroll-inner'),\r\n        timeHeaderRow: document.getElementById('time-header-row'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        agGridContainer: document.getElementById('ag-grid-container'),\r\n        agGridTopScroll: document.getElementById('ag-grid-scroll-top'),\r\n        agGridTopScrollInner: document.getElementById('ag-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (this.state.useAgGrid) {\r\n      if (!domRefs.agGridContainer) {\r\n        throw new Error('AG Grid container #ag-grid-container tidak ditemukan');\r\n      }\r\n    } else {\r\n      if (!domRefs.leftTbody || !domRefs.rightTbody) {\r\n        throw new Error('Critical DOM elements not found (leftTbody, rightTbody)');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    this.state.useAgGrid = dataset.enableAgGrid === 'true' || this.state.useAgGrid;\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    const helpers = {\r\n      updateProgressIndicator: (pekerjaanId, total) => {\r\n        updateProgressIndicator(pekerjaanId, total, this.state);\r\n      },\r\n      showToast: this.showToast.bind(this),\r\n    };\r\n\r\n    if (!this.state.useAgGrid) {\r\n      this.eventManager = attachGridEvents(this.state, helpers);\r\n    } else if (this.eventManager) {\r\n      this.eventManager.cleanup();\r\n      this.eventManager = null;\r\n    }\r\n\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    // Initialize AG Grid when enabled\r\n    this._initAgGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this.stateManager.switchMode(normalized);\r\n\r\n    // Switch mode in local state (for other non-cell properties)\r\n    this.state.progressMode = normalized;\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n      this._syncToolbarRadios();\r\n    }\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    // Update mode indicator badge\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (indicator) {\r\n      const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n      const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n      indicator.textContent = `Mode: ${label}`;\r\n      indicator.className = `badge ${bgClass} ms-2`;\r\n      indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n    }\r\n\r\n    // Reload data with the new progress mode (will load from new mode's state)\r\n    this._syncGridViews();\r\n\r\n    const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n    this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize AG Grid when enabled\r\n   */\r\n  _initAgGridIfNeeded() {\r\n    if (!this.state.useAgGrid) {\r\n      return;\r\n    }\r\n\r\n    const container = this.state.domRefs.agGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] AG Grid container not available');\r\n      return;\r\n    }\r\n\r\n    if (!this.agGridManager) {\r\n      this.agGridManager = new AGGridManager(this.state, {\r\n        showToast: this.showToast.bind(this),\r\n        onCellChange: (payload) => this._handleAgGridCellChange(payload),\r\n        getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n      });\r\n      this.agGridManager.mount(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.gridRenderer = new GridRenderer(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Render grid\r\n      this._renderGrid();\r\n\r\n      // Step 5: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render grid using GridRenderer\r\n   * @private\r\n   */\r\n  _renderGrid() {\r\n    if (!this.gridRenderer) {\r\n      console.warn('[JadwalKegiatanApp] GridRenderer not initialized');\r\n      return;\r\n    }\r\n\r\n    this.state.activeTimeColumns = this._getDisplayTimeColumns();\r\n\r\n    console.log('[JadwalKegiatanApp] Rendering grid...');\r\n\r\n    // Render tables\r\n    const rendered = this.gridRenderer.renderTables();\r\n    if (!rendered) {\r\n      console.warn('[JadwalKegiatanApp] Grid rendering returned null');\r\n      return;\r\n    }\r\n\r\n    const { leftHTML, rightHTML } = rendered;\r\n\r\n    // Update DOM\r\n    const leftTbody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\r\n    const rightTbody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\r\n\r\n    if (leftTbody) {\r\n      leftTbody.innerHTML = leftHTML;\r\n    }\r\n\r\n    if (rightTbody) {\r\n      rightTbody.innerHTML = rightHTML;\r\n    }\r\n\r\n    // Render time headers\r\n    const timeHeaderRow = this.state.domRefs?.timeHeaderRow || document.getElementById('time-header-row');\r\n    if (timeHeaderRow) {\r\n      this.gridRenderer.renderTimeHeader(timeHeaderRow);\r\n    }\r\n\r\n    // Sync row heights\r\n    this.gridRenderer.syncRowHeights(this.state.domRefs || {});\r\n    this._updateLegacyHorizontalScroll();\r\n\r\n    console.log('[JadwalKegiatanApp]  Grid rendered');\r\n\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const [kurvaSModule, ganttModule] = await Promise.all([\r\n        import('@modules/kurva-s/echarts-setup.js'),\r\n        import('@modules/gantt/frappe-gantt-setup.js')\r\n      ]);\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSChart;\r\n      this.GanttChartClass = ganttModule.GanttChart;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    // Check if already initialized\r\n    if (this.ganttFrozenGrid) {\r\n      console.log('[JadwalKegiatanApp] Gantt already initialized, skipping');\r\n      return;\r\n    }\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Initialize V2: Frozen Column Architecture (now default)\r\n      console.log(' Initializing Gantt V2 (Frozen Column)...');\r\n      await this._initializeFrozenGantt(ganttContainer);\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize V2: Frozen Column Gantt (Now Default)\r\n   * @private\r\n   */\r\n  async _initializeFrozenGantt(container) {\r\n    console.log('[JadwalKegiatanApp]  Container found:', container);\r\n\r\n    // Lazy load V2 module\r\n    const { GanttFrozenGrid } = await import('@modules/gantt-v2/gantt-frozen-grid.js');\r\n\r\n    // Create Gantt instance\r\n    this.ganttFrozenGrid = new GanttFrozenGrid(container, {\r\n      rowHeight: 40,\r\n      timeScale: 'week'\r\n    });\r\n\r\n    // Initialize with app context (provides StateManager, tahapanList, etc.)\r\n    await this.ganttFrozenGrid.initialize(this);\r\n\r\n    console.log('[JadwalKegiatanApp]  Gantt V2 (Frozen Column) initialized successfully!');\r\n    Toast.success(' Gantt Chart loaded', 2000);\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Gantt V2 uses demo data (POC) - no update needed yet\r\n    // TODO Phase 2: Implement real-time data updates for Gantt V2\r\n    if (this.ganttFrozenGrid) {\r\n      console.log('[JadwalKegiatanApp]  Gantt V2 update skipped (POC uses static demo data)');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.updateData({\r\n        tree: this.state.pekerjaanTree || [],\r\n        timeColumns: displayColumns,\r\n        inputMode: this.state.inputMode || 'percentage',\r\n        timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      });\r\n      if (typeof this.agGridManager.updateTopScrollMetrics === 'function') {\r\n        this.agGridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateLegacyHorizontalScroll();\r\n  }\r\n\r\n  _updateLegacyHorizontalScroll() {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const scrollTop = domRefs.horizontalScrollTop;\r\n    const scrollInner = domRefs.horizontalScrollInner;\r\n    const rightTable = domRefs.rightTable;\r\n    if (!scrollTop || !scrollInner || !rightTable) {\r\n      return;\r\n    }\r\n    window.requestAnimationFrame(() => {\r\n      scrollInner.style.width = `${rightTable.scrollWidth}px`;\r\n    });\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n        this.agGridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.agGridManager && typeof this.agGridManager.refreshCells === 'function') {\r\n      this.agGridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.agGridManager) {\r\n        this.agGridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel,\r\n        tooltip: startLabel && endLabel ? `${startLabel}  ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleAgGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    if (this.eventManager) {\r\n      this.eventManager.cleanup();\r\n      this.eventManager = null;\r\n    }\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.destroy();\r\n      this.agGridManager = null;\r\n    }\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n"],"file":"assets/js/jadwal-kegiatan-BbGjCNf_.js"}