{"version":3,"mappings":"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","names":["JadwalKegiatanApp","constructor","this","state","initialized","gridManager","stateManager","StateManager","getInstance","dataLoader","timeColumnGenerator","saveHandler","kurvaSChart","ganttChart","ganttFrozenGrid","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_stateManagerListener","_suppressStateManagerEvent","_currencyFormatter","_getProjectDateRange","start","end","_a","projectStart","parsed","Date","Number","isNaN","getTime","_b","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","Math","max","floor","ceil","_countWeeklyColumns","Array","isArray","timeColumns","filter","col","mode","generationMode","type","toLowerCase","isFinite","weekNumber","week_number","length","initialize","__async","arguments","config","console","warn","log","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","window","error","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","Set","volumeMap","Map","isLoading","domRefs","apiEndpoints","projectId","projectName","useUPlotKurva","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","progressMode","displayMode","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","_bindStateManagerEvents","getCurrentState","defineProperty","get","states","modifiedCells","configurable","assignmentMap","costAssignmentMap","costModifiedCells","hasUnsavedChanges","set","value","event","_handleStateManagerEvent","addEventListener","_unbindStateManagerEvents","removeEventListener","_applyProgressModeSwitch","newMode","showToast","_handleStateCommitEvent","_handleStateResetEvent","refreshCells","_updateStatusBar","_updateCharts","modeLabel","currentMode","_syncToolbarRadios","_syncGridViews","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","_c","size","disabled","classList","toggle","Boolean","setAttribute","removeAttribute","root","document","getElementById","refreshButton","resetButton","tanstackGridContainer","tanstackGridBody","tanstackGridTopScroll","tanstackGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","querySelector","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","dataset","allowedTimeScales","datasetScale","defaultTimeScale","toString","has","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","_d","weekend","weekEnd","week_end_day","parsedWeekStartDay","_f","_e","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","reset","apiResetProgress","enableUplotKurva","_attachToolbarEvents","_initTanStackGridIfNeeded","saveChanges","refresh","_handleResetProgress","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","KeyboardShortcuts","register","Toast","info","description","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","warning","querySelectorAll","forEach","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","hide","preventDefault","_showKeyboardShortcutsHelp","getShortcuts","initializeUXEnhancements","modalHtml","map","s","key","replace","join","existingModal","remove","body","insertAdjacentHTML","Modal","show","ExportManager","format","button","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","options","enableCostView","toggleView","_setCostToggleButtonState","viewMode","add","isCostMode","label","iconClass","textContent","className","_activateDefaultCostView","groupName","handler","radios","radio","target","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","confirm","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","text","catch","status","result","json","_resetEditedCellsState","clear","_clearFailedRows","message","forceReload","String","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_recalculateAllProgressTotals","_invalidateCachedDataset","flatPekerjaan","clearTimeout","setTimeout","payload","then","data","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","__spreadValues","successMessage","next","pyDay","isChecked","nextElementSibling","matches","_updateCostToggleAvailability","setInputMode","oldMode","oldStats","getStats","switchMode","newStats","toUpperCase","modifiedCount","assignmentCount","nextMode","previousInputMode","_updateProgressModeIndicator","indicator","bgClass","style","cssText","isActual","nextScale","_renderGrid","container","TanStackGridManager","bind","onCellChange","_handleGridCellChange","getCellValidationState","cellKey","_getCellValidationState","mount","topScroll","topScrollInner","DataLoader","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","_g","_i","_h","loadAssignments","_loadKurvaSData","_j","_k","_l","_initializeCharts","statusText","hargaMap","entries","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","keys","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","_loadChartModules","kurvaSModule","import","n","u","__VITE_PRELOAD__","KurvaSChartClass","KurvaSUPlotChart","default","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","Promise","resolve","ganttContainer","ganttView","ganttTab","_initializeFrozenGantt","stack","GanttFrozenGrid","rowHeight","success","_prepareGanttData","pekerjaanNodes","node","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","id","column_id","actualVal","round","push","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_id","pekerjaan_name","nama","name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_rencana","progress_realisasi","satuan","projectMeta","project_id","project_name","start_date","end_date","project","milestones","_setupLazyChartLoading","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","scrollTop","deltaY","passive","_escapeHtml","char","_validateRowTotalsBeforeSave","ButtonStateManager","setLoading","setSuccess","setError","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","createElement","appendChild","_buildTimeColumns","tahap","index","rawId","fieldId","order","urutan","startDate","tanggal_mulai","endDate","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","columns","_fetchJson","_0","url","errorText","displayColumns","_getDisplayTimeColumns","activeTimeColumns","updateData","tree","updateTopScrollMetrics","_renderLegacyGrid","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","from","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","pekerjaanId","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","call","_calculateRowTotalPercent","total","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","find","_getRowCostCapacity","costFields","field","_getMergedCostCells","modeState","merged","_calculateAllCostTotals","totals","split","_formatCurrency","Intl","NumberFormat","currency","maximumFractionDigits","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","costViolations","totalCost","combined","concat","messages","slice","pekerjaanCount","totalProgress","_calculateProjectProgress","aggregate","avg","pekerjaanTotals","numericValue","sum","_buildAssignmentsPayload","assignments","columnIndex","_parseCellKey","columnMeta","proportion","tahapan_id","_getSaveMode","fallback","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","_buildMonthlyColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","rangeLabel","endLabel","_coerceDate","_m","_n","rangeText","_formatShortRange","tooltip","childColumns","readOnly","date","getDate","padStart","getMonth","separatorIndex","indexOf","cookieValue","cookie","cookies","trim","substring","decodeURIComponent","displayValue","isVolumeMode","validation","columnId","valueType","normalizedValue","resolvedPekerjaanId","destroy","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { TanStackGridManager } from '@modules/grid/tanstack-grid-manager.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.initialized = false;\r\n    this.gridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.saveHandler = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\n    this._costViewAutoActivated = false;\n    this._ganttScrollSyncHandlers = null;\n    this._stateManagerListener = null;\n    this._suppressStateManagerEvent = false;\n    this._currencyFormatter = null;\n\n  }\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useUPlotKurva: true, // uPlot Kurva-S aktif secara default\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n    this._bindStateManagerEvents();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  _bindStateManagerEvents() {\r\n    if (!this.stateManager || this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this._stateManagerListener = (event) => this._handleStateManagerEvent(event);\r\n    this.stateManager.addEventListener(this._stateManagerListener);\r\n    console.log('[JadwalKegiatanApp] StateManager listener attached');\r\n  }\r\n\r\n  _unbindStateManagerEvents() {\r\n    if (!this.stateManager || !this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this.stateManager.removeEventListener(this._stateManagerListener);\r\n    this._stateManagerListener = null;\r\n    console.log('[JadwalKegiatanApp] StateManager listener removed');\r\n  }\r\n\r\n  _handleStateManagerEvent(event = {}) {\r\n    if (!event || typeof event !== 'object') {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'mode-switch':\r\n        if (this._suppressStateManagerEvent) {\r\n          return;\r\n        }\r\n        this._applyProgressModeSwitch(event.newMode, { showToast: false });\r\n        break;\r\n      case 'commit':\r\n        this._handleStateCommitEvent(event);\r\n        break;\r\n      case 'reset':\r\n        this._handleStateResetEvent();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _handleStateCommitEvent(event = {}) {\r\n    if (this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n    this._updateStatusBar();\r\n    this._updateCharts();\r\n    const modeLabel = (event.mode || this.state.progressMode || 'planned') === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    console.log(`[StateManager] Commit event processed for mode: ${modeLabel}`);\r\n  }\r\n\r\n  _handleStateResetEvent() {\r\n    console.log('[StateManager] Reset event received, syncing UI components');\r\n    this.state.progressMode = this.stateManager?.currentMode || 'planned';\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._updateStatusBar('Ready');\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        tanstackGridContainer: document.getElementById('tanstack-grid-container'),\r\n        tanstackGridBody: document.getElementById('tanstack-grid-body'),\r\n        tanstackGridTopScroll: document.getElementById('tanstack-grid-scroll-top'),\r\n        tanstackGridTopScrollInner: document.getElementById('tanstack-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (!domRefs.tanstackGridContainer) {\r\n      throw new Error('TanStack grid container #tanstack-grid-container tidak ditemukan');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    if (typeof dataset.enableUplotKurva !== 'undefined') {\r\n      this.state.useUPlotKurva = dataset.enableUplotKurva !== 'false';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    this._initTanStackGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    if (this.kurvaSChart?.options?.enableCostView === false) {\r\n      toggleBtn.classList.add('d-none');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    document.querySelectorAll('input[name=\"progressMode\"]').forEach((radio) => {\r\n      const isChecked = radio.value === progressMode;\r\n      if (radio.checked !== isChecked) {\r\n        radio.checked = isChecked;\r\n      }\r\n      const label = radio.nextElementSibling;\r\n      if (label && label.matches('.btn')) {\r\n        label.setAttribute('aria-selected', String(isChecked));\r\n      }\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this._suppressStateManagerEvent = true;\r\n    this.stateManager.switchMode(normalized);\r\n    this._suppressStateManagerEvent = false;\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    this._applyProgressModeSwitch(normalized, { showToast: true });\r\n  }\r\n\r\n  _applyProgressModeSwitch(nextMode, options = {}) {\r\n    const normalized = nextMode === 'actual' ? 'actual' : 'planned';\r\n    const previousInputMode = this.state.inputMode || 'percentage';\r\n    this.state.progressMode = normalized;\r\n\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n    }\r\n\r\n    if (this.gridManager && typeof this.gridManager.setInputMode === 'function') {\r\n      const currentMode = this.state.inputMode || 'percentage';\r\n      if (currentMode !== previousInputMode) {\r\n        this.gridManager.setInputMode(currentMode);\r\n      }\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._updateCostToggleAvailability();\r\n    this._updateProgressModeIndicator(normalized);\r\n    this._syncGridViews();\r\n    this._updateCharts();\r\n\r\n    if (options.showToast) {\r\n      const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n      this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n    }\r\n  }\r\n\r\n  _updateProgressModeIndicator(mode) {\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (!indicator) {\r\n      return;\r\n    }\r\n    const normalized = mode === 'actual' ? 'actual' : 'planned';\r\n    const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n    const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n    indicator.textContent = `Mode: ${label}`;\r\n    indicator.className = `badge ${bgClass} ms-2`;\r\n    indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize TanStack Table grid when enabled\r\n   */\r\n  _initTanStackGridIfNeeded() {\r\n    const container = this.state.domRefs.tanstackGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] TanStack grid container not available');\r\n      return;\r\n    }\r\n\r\n    container.classList.remove('d-none');\r\n\r\n    if (!this.gridManager) {\r\n      this.gridManager = new TanStackGridManager(this.state, {\r\n        showToast: this.showToast.bind(this),\r\n        onCellChange: (payload) => this._handleGridCellChange(payload),\r\n        getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n      });\r\n      this.gridManager.mount(container, {\r\n        topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n        topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n        body: this.state.domRefs.tanstackGridBody,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.useUPlotKurva) {\r\n      console.warn('[JadwalKegiatanApp] uPlot dimatikan, melewati inisialisasi chart');\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const kurvaSModule = await import('@modules/kurva-s/uplot-chart.js');\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSUPlotChart || kurvaSModule.default;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n          enableCostView: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    // Check if already initialized\r\n    if (this.ganttFrozenGrid) {\r\n      console.log('[JadwalKegiatanApp] Gantt already initialized, skipping');\r\n      return;\r\n    }\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Initialize V2: Frozen Column Architecture (now default)\r\n      console.log(' Initializing Gantt V2 (Frozen Column)...');\r\n      await this._initializeFrozenGantt(ganttContainer);\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize V2: Frozen Column Gantt (Now Default)\r\n   * @private\r\n   */\r\n  async _initializeFrozenGantt(container) {\r\n    console.log('[JadwalKegiatanApp]  Container found:', container);\r\n\r\n    // Lazy load V2 module\r\n    const { GanttFrozenGrid } = await import('@modules/gantt-v2/gantt-frozen-grid.js');\r\n\r\n    // Create Gantt instance\r\n    this.ganttFrozenGrid = new GanttFrozenGrid(container, {\r\n      rowHeight: 40,\r\n      timeScale: 'week'\r\n    });\r\n\r\n    // Initialize with app context (provides StateManager, tahapanList, etc.)\r\n    await this.ganttFrozenGrid.initialize(this);\r\n\r\n    console.log('[JadwalKegiatanApp]  Gantt V2 (Frozen Column) initialized successfully!');\r\n    Toast.success(' Gantt Chart loaded', 2000);\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update Gantt V2 with latest data\r\n    if (this.ganttFrozenGrid && typeof this.ganttFrozenGrid.update === 'function') {\r\n      try {\r\n        this.ganttFrozenGrid.update();\r\n        console.log('[JadwalKegiatanApp]  Gantt V2 chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\n    const displayColumns = this._getDisplayTimeColumns();\n    this.state.activeTimeColumns = displayColumns;\n\r\n    if (this.gridManager) {\r\n      this.gridManager.updateData({\r\n        tree: this.state.pekerjaanTree || [],\r\n        timeColumns: displayColumns,\r\n        inputMode: this.state.inputMode || 'percentage',\r\n        timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      });\r\n      if (typeof this.gridManager.updateTopScrollMetrics === 'function') {\r\n        this.gridManager.updateTopScrollMetrics();\r\n      }\r\n    }\n    this._updateStatusBar();\n  }\n\n  _renderGrid() {\n    if (this.gridManager) {\n      this._syncGridViews();\n      return;\n    }\n    if (typeof this._renderLegacyGrid === 'function') {\n      this._renderLegacyGrid();\n    }\n  }\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.gridManager) {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\n    return 0;\n  }\n\n  _getRowCostCapacity(pekerjaanId) {\n    const hargaMap = this.state?.hargaMap;\n    const numericId = Number(pekerjaanId);\n    if (hargaMap instanceof Map && hargaMap.has(numericId)) {\n      return Number(hargaMap.get(numericId)) || 0;\n    }\n    if (hargaMap && typeof hargaMap === 'object') {\n      const key = String(numericId);\n      if (Object.prototype.hasOwnProperty.call(hargaMap, key)) {\n        return Number(hargaMap[key]) || 0;\n      }\n    }\n    const fallbackNode =\n      Array.isArray(this.state.flatPekerjaan) &&\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\n    if (fallbackNode) {\n      const costFields = [\n        'budgeted_cost',\n        'total_biaya',\n        'totalBiaya',\n        'total_cost',\n        'biaya',\n      ];\n      for (const field of costFields) {\n        if (typeof fallbackNode[field] !== 'undefined') {\n          const numeric = Number(fallbackNode[field]);\n          if (Number.isFinite(numeric)) {\n            return numeric;\n          }\n        }\n      }\n    }\n    return 0;\n  }\n\n  _getMergedCostCells(modeState) {\n    const merged = new Map();\n    if (modeState?.costAssignmentMap instanceof Map) {\n      modeState.costAssignmentMap.forEach((value, key) => {\n        const numeric = Number(value);\n        if (Number.isFinite(numeric)) {\n          merged.set(key, numeric);\n        }\n      });\n    }\n    if (modeState?.costModifiedCells instanceof Map) {\n      modeState.costModifiedCells.forEach((value, key) => {\n        const numeric = Number(value);\n        if (Number.isFinite(numeric)) {\n          merged.set(key, numeric);\n        }\n      });\n    }\n    return merged;\n  }\n\n  _calculateAllCostTotals() {\n    const totals = new Map();\n    const modeState = this._getCurrentModeState();\n    if (!modeState) {\n      return totals;\n    }\n    const merged = this._getMergedCostCells(modeState);\n    merged.forEach((value, cellKey) => {\n      const pekerjaanId = parseInt((cellKey || '').split('-')[0], 10);\n      if (!Number.isFinite(pekerjaanId)) {\n        return;\n      }\n      totals.set(pekerjaanId, (totals.get(pekerjaanId) || 0) + Number(value));\n    });\n    return totals;\n  }\n\n  _formatCurrency(value) {\n    const numeric = Number(value) || 0;\n    if (!this._currencyFormatter && typeof Intl !== 'undefined') {\n      this._currencyFormatter = new Intl.NumberFormat('id-ID', {\n        style: 'currency',\n        currency: 'IDR',\n        maximumFractionDigits: 0,\n      });\n    }\n    if (this._currencyFormatter) {\n      return this._currencyFormatter.format(numeric);\n    }\n    return `Rp ${numeric.toLocaleString('id-ID')}`;\n  }\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\n    if (this.state.volumeTotals instanceof Map) {\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\n        const capacity = this._getRowVolume(pekerjaanId);\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\n        const percentTotal =\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\n      });\n    }\n\n    const costViolations = [];\n    const normalizedMode = (this.state.progressMode || 'planned').toLowerCase();\n    if (normalizedMode === 'actual') {\n      const costTotals = this._calculateAllCostTotals();\n      costTotals.forEach((totalCost, pekerjaanId) => {\n        if (!Number.isFinite(totalCost)) {\n          return;\n        }\n        const capacity = this._getRowCostCapacity(pekerjaanId);\n        const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 1) : 1;\n        if (Number.isFinite(capacity) && capacity > 0) {\n          if (totalCost > capacity + tolerance) {\n            costViolations.push({\n              type: 'cost',\n              pekerjaan_id: pekerjaanId,\n              total: totalCost,\n              capacity,\n            });\n          }\n        } else if (totalCost > tolerance) {\n          costViolations.push({\n            type: 'cost',\n            pekerjaan_id: pekerjaanId,\n            total: totalCost,\n            capacity: 0,\n            missingCapacity: true,\n          });\n        }\n      });\n    }\n\n    if (percentViolations.length === 0 && volumeViolations.length === 0 && costViolations.length === 0) {\n      this._clearFailedRows();\n      this._clearSaveErrorRows();\n      return true;\n    }\n\n    const ids = new Set();\n    const combined = percentViolations.concat(volumeViolations, costViolations);\n    const messages = combined.slice(0, 3).map((item) => {\n      ids.add(Number(item.pekerjaan_id));\n      if (item.type === 'volume') {\n        if (item.missingCapacity) {\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\n        }\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\n      }\n      if (item.type === 'cost') {\n        if (item.missingCapacity) {\n          return `- Pekerjaan ${item.pekerjaan_id}: biaya aktual tidak dapat disimpan karena master biaya 0`;\n        }\n        return `- Pekerjaan ${item.pekerjaan_id}: total biaya ${this._formatCurrency(item.total)} > batas ${this._formatCurrency(item.capacity)}`;\n      }\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\n    });\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n    return this._buildMonthlyColumns(sourceColumns);\r\n  }\r\n\r\n  _buildMonthlyColumns(sourceColumns) {\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n      const startDate = this._coerceDate(blockColumns[0]?.startDate || blockColumns[0]?.start_date);\r\n      const endDate = this._coerceDate(blockColumns[blockColumns.length - 1]?.endDate || blockColumns[blockColumns.length - 1]?.end_date);\r\n      const rangeText = this._formatShortRange(startDate, endDate);\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel: rangeText || rangeLabel,\r\n        rangeText,\r\n        startDate,\r\n        endDate,\r\n        tooltip: startLabel && endLabel ? `${startLabel} \\u2014 ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n        readOnly: true,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _coerceDate(value) {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Number.isNaN(value.getTime()) ? null : value;\r\n    }\r\n    const parsed = new Date(value);\r\n    return Number.isNaN(parsed.getTime()) ? null : parsed;\r\n  }\r\n\r\n  _formatShortRange(startDate, endDate) {\r\n    const format = (date) => {\r\n      if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\r\n        return '';\r\n      }\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      return `${day}/${month}`;\r\n    };\r\n    const start = format(startDate);\r\n    const end = format(endDate);\r\n    if (start && end) {\r\n      return `${start} - ${end}`;\r\n    }\r\n    return start || end || '';\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    this._unbindStateManagerEvents();\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.destroy();\r\n      this.gridManager = null;\r\n    }\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n"],"file":"assets/js/jadwal-kegiatan-Bcfu9WNy.js"}