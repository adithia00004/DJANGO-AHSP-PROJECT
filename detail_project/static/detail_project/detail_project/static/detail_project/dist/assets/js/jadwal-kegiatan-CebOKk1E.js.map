{"version":3,"file":"jadwal-kegiatan-CebOKk1E.js","sources":["../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["/**\n * Jadwal Kegiatan Main Entry Point\n * Modern modular implementation with Vite bundling\n * License: MIT\n */\n/* global ExportManager */\n\nimport { attachGridEvents } from '@modules/grid/grid-event-handlers.js';\nimport { AGGridManager } from '@modules/grid/ag-grid-setup.js';\nimport { updateProgressIndicator } from '@modules/shared/validation-utils.js';\nimport { DataLoader } from '@modules/core/data-loader.js';\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\nimport { GridRenderer } from '@modules/grid/grid-renderer.js';\nimport { SaveHandler } from '@modules/core/save-handler.js';\nimport { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\nimport { GanttChart } from '@modules/gantt/frappe-gantt-setup.js';\n\n/**\n * Initialize Jadwal Kegiatan Grid Application\n */\nclass JadwalKegiatanApp {\n  constructor() {\n    this.state = null;\n    this.eventManager = null;\n    this.initialized = false;\n    this.agGridManager = null;\n\n    // Modern modules\n    this.dataLoader = null;\n    this.timeColumnGenerator = null;\n    this.gridRenderer = null;\n    this.saveHandler = null;\n\n    // Chart modules\n    this.kurvaSChart = null;\n    this.ganttChart = null;\n\n    this._weekBoundarySaveTimer = null;\n    this._pendingWeekBoundary = null;\n    this._isRegeneratingTimeline = false;\n    this._queuedRegeneratePayload = null;\n    this._isEnforcingWeekly = false;\n    this._exportManagerInstance = null;\n    this._exportBindingsAttached = false;\n  }\n\n  _getProjectDateRange() {\n    let start = null;\n    let end = null;\n    if (this.state?.projectStart) {\n      const parsed = new Date(this.state.projectStart);\n      if (!Number.isNaN(parsed.getTime())) {\n        start = parsed;\n      }\n    }\n    if (this.state?.projectEnd) {\n      const parsedEnd = new Date(this.state.projectEnd);\n      if (!Number.isNaN(parsedEnd.getTime())) {\n        end = parsedEnd;\n      }\n    }\n    if (start && (!end || Number.isNaN(end.getTime()))) {\n      end = new Date(start.getFullYear(), 11, 31);\n    }\n    return { start, end };\n  }\n\n  _estimateExpectedWeeklyColumns() {\n    const { start, end } = this._getProjectDateRange();\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\n      return 0;\n    }\n    const msPerDay = 1000 * 60 * 60 * 24;\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\n    return Math.max(1, Math.ceil(diffDays / 7));\n  }\n\n  _countWeeklyColumns() {\n    if (!Array.isArray(this.state.timeColumns)) {\n      return 0;\n    }\n    return this.state.timeColumns.filter((col) => {\n      const mode = (col.generationMode || col.type || '').toLowerCase();\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\n        return true;\n      }\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\n    }).length;\n  }\n\n  /**\n   * Initialize the application\n   *\n   * @param {Object} config - Configuration options\n   * @param {Object} config.initialState - Initial application state\n   * @param {Object} config.domRefs - DOM element references\n   */\n  async initialize(config = {}) {\n    if (this.initialized) {\n      console.warn('JadwalKegiatanApp already initialized');\n      return;\n    }\n\n    console.log('ðŸš€ Initializing Jadwal Kegiatan App (Vite Build)');\n\n    try {\n      // Setup state\n      this._setupState(config);\n\n      // Setup DOM references\n      this._setupDomRefs(config);\n\n      // Attach event handlers\n      this._attachEvents();\n\n      // Load initial data\n      await this._loadInitialData();\n\n      this.initialized = true;\n      console.log('âœ… Jadwal Kegiatan App initialized successfully');\n\n      // Expose to window for backwards compatibility\n      window.JadwalKegiatanApp = this;\n    } catch (error) {\n      console.error('âŒ Failed to initialize Jadwal Kegiatan App:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Setup application state\n   */\n  _setupState(config) {\n    // Check if there's existing global state (backwards compatibility)\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\n\n    this.state = Object.assign(\n      {\n        // Shared state (mode-independent)\n        pekerjaanTree: [],\n        timeColumns: [],\n        tahapanList: [],\n        timeColumnIndex: {},\n        expandedNodes: new Set(),\n        volumeMap: new Map(),\n        isLoading: false,\n        error: null,\n        domRefs: {},\n        apiEndpoints: {},\n        projectId: null,\n        projectName: '',\n        projectStart: null,\n        projectEnd: null,\n        useAgGrid: false,\n        timeScale: 'weekly',\n        inputMode: 'percentage',\n        saveMode: 'weekly',\n        weekStartDay: 0,\n        weekEndDay: 6,\n        displayScale: null,\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\n\n        // Phase 2E.1: Dual state structure - separate state per progress mode\n        plannedState: {\n          modifiedCells: new Map(),\n          assignmentMap: new Map(),\n          progressTotals: new Map(),\n          volumeTotals: new Map(),\n          cellVolumeOverrides: new Map(),\n          cellValidationMap: new Map(),\n          failedRows: new Set(),\n          autoWarningRows: new Set(),\n          volumeWarningRows: new Set(),\n          validationWarningRows: new Set(),\n          saveErrorRows: new Set(),\n          apiFailedRows: new Set(),\n          showCompletionWarnings: false,\n          isDirty: false,\n        },\n        actualState: {\n          modifiedCells: new Map(),\n          assignmentMap: new Map(),\n          progressTotals: new Map(),\n          volumeTotals: new Map(),\n          cellVolumeOverrides: new Map(),\n          cellValidationMap: new Map(),\n          failedRows: new Set(),\n          autoWarningRows: new Set(),\n          volumeWarningRows: new Set(),\n          validationWarningRows: new Set(),\n          saveErrorRows: new Set(),\n          apiFailedRows: new Set(),\n          showCompletionWarnings: false,\n          isDirty: false,\n        },\n\n        // Backward compatibility: Legacy properties point to current mode\n        // These will be dynamically updated via getters\n        modifiedCells: null,  // Will be replaced by getter\n        progressTotals: null,\n        volumeTotals: null,\n        cellVolumeOverrides: null,\n        cellValidationMap: null,\n        failedRows: null,\n        autoWarningRows: null,\n        volumeWarningRows: null,\n        validationWarningRows: null,\n        saveErrorRows: null,\n        apiFailedRows: null,\n        showCompletionWarnings: false,\n        isDirty: false,\n      },\n      existingState || {},\n      config.initialState || {}\n    );\n\n    // Expose to window for backwards compatibility\n    window.kelolaTahapanPageState = this.state;\n\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\n    this._ensureStateCollections();\n    if (!this.state.displayScale) {\n      this.state.displayScale = this.state.timeScale || 'weekly';\n    }\n\n    // Phase 2E.1: Setup property delegation for backward compatibility\n    this._setupStateDelegation();\n  }\n\n  /**\n   * Setup property delegation for backward compatibility.\n   * Maps legacy state properties to current mode's state.\n   */\n  _setupStateDelegation() {\n    const getCurrentState = () => {\n      return this.state.progressMode === 'actual'\n        ? this.state.actualState\n        : this.state.plannedState;\n    };\n\n    // Define getters/setters for backward compatibility\n    // These delegate to the current mode's state\n    Object.defineProperty(this.state, 'modifiedCells', {\n      get: () => getCurrentState().modifiedCells,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'assignmentMap', {\n      get: () => getCurrentState().assignmentMap,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'progressTotals', {\n      get: () => getCurrentState().progressTotals,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'volumeTotals', {\n      get: () => getCurrentState().volumeTotals,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\n      get: () => getCurrentState().cellVolumeOverrides,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'cellValidationMap', {\n      get: () => getCurrentState().cellValidationMap,\n      configurable: true\n    });\n\n    Object.defineProperty(this.state, 'isDirty', {\n      get: () => getCurrentState().isDirty,\n      set: (value) => { getCurrentState().isDirty = value; },\n      configurable: true\n    });\n\n    console.log('[JadwalKegiatanApp] State delegation setup complete');\n  }\n\n  /**\n   * Get the current mode's state object.\n   * @returns {Object} Current mode state (plannedState or actualState)\n   */\n  _getCurrentModeState() {\n    return this.state.progressMode === 'actual'\n      ? this.state.actualState\n      : this.state.plannedState;\n  }\n\n  _updateSaveButtonState() {\n    const saveButton = this.state?.domRefs?.saveButton;\n    if (!saveButton) {\n      return;\n    }\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\n    saveButton.disabled = false;\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\n    saveButton.classList.toggle('btn-success', !hasFailures);\n    if (hasFailures) {\n      saveButton.setAttribute(\n        'title',\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\n      );\n    } else {\n      saveButton.removeAttribute('title');\n    }\n  }\n\n  _ensureStateCollections() {\n    if (!(this.state.failedRows instanceof Set)) {\n      this.state.failedRows = new Set();\n    }\n    if (!(this.state.autoWarningRows instanceof Set)) {\n      this.state.autoWarningRows = new Set();\n    }\n    if (!(this.state.volumeWarningRows instanceof Set)) {\n      this.state.volumeWarningRows = new Set();\n    }\n    if (!(this.state.validationWarningRows instanceof Set)) {\n      this.state.validationWarningRows = new Set();\n    }\n    if (!(this.state.saveErrorRows instanceof Set)) {\n      this.state.saveErrorRows = new Set();\n    }\n    if (!(this.state.apiFailedRows instanceof Set)) {\n      this.state.apiFailedRows = new Set();\n    }\n    if (!(this.state.progressTotals instanceof Map)) {\n      this.state.progressTotals = new Map();\n    }\n    if (!(this.state.volumeTotals instanceof Map)) {\n      this.state.volumeTotals = new Map();\n    }\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\n      this.state.cellVolumeOverrides = new Map();\n    }\n    if (!(this.state.cellValidationMap instanceof Map)) {\n      this.state.cellValidationMap = new Map();\n    }\n  }\n\n  /**\n   * Setup DOM references\n   */\n  _setupDomRefs(config) {\n    const domRefs = Object.assign(\n      {\n        root: document.getElementById('tahapan-grid-app'),\n        leftThead: document.getElementById('left-thead'),\n        rightThead: document.getElementById('right-thead'),\n        leftTbody: document.getElementById('left-tbody'),\n        rightTbody: document.getElementById('right-tbody'),\n        leftPanelScroll: document.querySelector('.left-panel-scroll'),\n        rightPanelScroll:\n          document.getElementById('right-panel-scroll-bottom') ||\n          document.querySelector('.right-panel-scroll'),\n        rightTable: document.getElementById('right-table'),\n        horizontalScrollTop: document.getElementById('right-panel-scroll-top'),\n        horizontalScrollInner: document.getElementById('right-panel-scroll-inner'),\n        timeHeaderRow: document.getElementById('time-header-row'),\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\n        refreshButton: document.getElementById('refresh-button'),\n        resetButton: document.getElementById('btn-reset-progress'),\n        agGridContainer: document.getElementById('ag-grid-container'),\n        agGridTopScroll: document.getElementById('ag-grid-scroll-top'),\n        agGridTopScrollInner: document.getElementById('ag-grid-scroll-inner'),\n        scurveChart: document.getElementById('scurve-chart'),\n        ganttChart: document.getElementById('gantt-chart'),\n        statusBar: document.querySelector('.status-bar'),\n        statusMessageEl: document.getElementById('status-message'),\n        itemCountEl: document.getElementById('item-count'),\n        modifiedCountEl: document.getElementById('modified-count'),\n        totalProgressEl: document.getElementById('total-progress'),\n        weekStartSelect: document.getElementById('week-start-day-select'),\n        weekEndSelect: document.getElementById('week-end-day-select'),\n      },\n      config.domRefs || {}\n    );\n\n    this.state.domRefs = domRefs;\n    this._updateSaveButtonState();\n\n    if (!domRefs.root) {\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\n    }\n\n    this._applyDataset(domRefs.root);\n\n    if (this.state.useAgGrid) {\n      if (!domRefs.agGridContainer) {\n        throw new Error('AG Grid container #ag-grid-container tidak ditemukan');\n      }\n    } else {\n      if (!domRefs.leftTbody || !domRefs.rightTbody) {\n        throw new Error('Critical DOM elements not found (leftTbody, rightTbody)');\n      }\n    }\n  }\n\n  /**\n   * Apply dataset attributes from root container into state\n   */\n  _applyDataset(rootElement) {\n    if (!rootElement || !rootElement.dataset) {\n      return;\n    }\n\n    const { dataset } = rootElement;\n\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\n    this.state.projectName = dataset.projectName || this.state.projectName;\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\n\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\n    const datasetScale =\n      (dataset.defaultTimeScale ||\n        dataset.timeScale ||\n        dataset.saveMode ||\n        this.state.timeScale ||\n        this.state.saveMode ||\n        '')\n        .toString()\n        .toLowerCase();\n    if (allowedTimeScales.has(datasetScale)) {\n      this.state.timeScale = datasetScale;\n      this.state.saveMode = datasetScale;\n    } else if (!this.state.timeScale) {\n      this.state.timeScale = this.state.saveMode || 'weekly';\n    }\n    this.state.displayScale = this.state.timeScale || 'weekly';\n\n    const datasetInputMode =\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\n        .toString()\n        .toLowerCase();\n    const allowedInputModes = new Set(['percentage', 'volume']);\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\n\n    const parsedWeekEndDay = Number.parseInt(\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\n      10\n    );\n    if (!Number.isNaN(parsedWeekEndDay)) {\n      this.state.weekEndDay = parsedWeekEndDay;\n    }\n\n    const parsedWeekStartDay = Number.parseInt(\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\n      10\n    );\n    if (!Number.isNaN(parsedWeekStartDay)) {\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\n      this.state.weekStartDay = normalized;\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\n    }\n\n    const endpoints = Object.assign(\n      {\n        base: dataset.apiBase || '',\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\n        listPekerjaan: dataset.apiListPekerjaan || '',\n        volume: dataset.apiVolume || '',\n        assignmentsBase: dataset.apiAssignmentsBase || '',\n        save:\n          dataset.apiSave ||\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\n          this._getDefaultSaveEndpoint(),\n        weekBoundary: dataset.apiWeekBoundary || '',\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\n      },\n      this.state.apiEndpoints || {}\n    );\n\n    this.state.apiEndpoints = endpoints;\n    this.state.useAgGrid = dataset.enableAgGrid === 'true' || this.state.useAgGrid;\n  }\n\n  /**\n   * Attach event handlers using modern delegation pattern\n   */\n  _attachEvents() {\n    const helpers = {\n      updateProgressIndicator: (pekerjaanId, total) => {\n        updateProgressIndicator(pekerjaanId, total, this.state);\n      },\n      showToast: this.showToast.bind(this),\n    };\n\n    if (!this.state.useAgGrid) {\n      this.eventManager = attachGridEvents(this.state, helpers);\n    } else if (this.eventManager) {\n      this.eventManager.cleanup();\n      this.eventManager = null;\n    }\n\n    // Attach toolbar events\n    this._attachToolbarEvents();\n\n    // Initialize AG Grid when enabled\n    this._initAgGridIfNeeded();\n  }\n\n  /**\n   * Attach toolbar button events\n   */\n  _attachToolbarEvents() {\n    const saveButton = this.state.domRefs.saveButton;\n    const refreshButton = this.state.domRefs.refreshButton;\n    const resetButton = this.state.domRefs.resetButton;\n\n    if (saveButton) {\n      saveButton.addEventListener('click', () => this.saveChanges());\n    }\n\n    if (refreshButton) {\n      refreshButton.addEventListener('click', () => this.refresh());\n    }\n\n    if (resetButton) {\n      resetButton.addEventListener('click', () => this._handleResetProgress());\n    }\n\n    this._syncToolbarRadios();\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\n    this._setupWeekBoundaryControls();\n    this._setupExportButtons();\n  }\n\n  _setupExportButtons() {\n    if (this._exportBindingsAttached) {\n      return;\n    }\n    if (typeof ExportManager === 'undefined') {\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\n      return;\n    }\n    if (!this.state?.projectId) {\n      return;\n    }\n\n    try {\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\n      formats.forEach((format) => {\n        const button = document.getElementById(`btn-export-${format}`);\n        if (!button) {\n          return;\n        }\n        button.addEventListener('click', () => {\n          this._exportManagerInstance.exportAs(format);\n        });\n      });\n      this._exportBindingsAttached = true;\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\n    }\n  }\n\n  _attachRadioGroupHandler(groupName, handler) {\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\n    if (!radios || radios.length === 0) {\n      return;\n    }\n\n    radios.forEach((radio) => {\n      radio.addEventListener('change', (event) => {\n        if (!event.target.checked) {\n          return;\n        }\n        handler(event.target.value);\n      });\n    });\n  }\n\n  _setupWeekBoundaryControls() {\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\n    if (!weekStartSelect || !weekEndSelect) {\n      return;\n    }\n\n    this._syncWeekBoundaryControls();\n\n    weekStartSelect.addEventListener('change', (event) => {\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\n      const derivedEnd = (nextStart + 6) % 7;\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\n    });\n\n    weekEndSelect.addEventListener('change', (event) => {\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\n      const derivedStart = (nextEnd + 1) % 7;\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\n    });\n  }\n\n  async _handleResetProgress() {\n    const endpoint = this.state.apiEndpoints?.reset;\n    if (!endpoint) {\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\n      return;\n    }\n\n    // Phase 2E.1: Mode-aware reset\n    const progressMode = this.state.progressMode || 'planned';\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\n\n    const confirmed = window.confirm(\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\n    );\n    if (!confirmed) {\n      return;\n    }\n\n    try {\n      this.state.isLoading = true;\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\n\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this._getCsrfToken(),\n        },\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\n      });\n\n      if (!response.ok) {\n        const text = await response.text().catch(() => '');\n        throw new Error(text || `HTTP ${response.status}`);\n      }\n\n      const result = await response.json().catch(() => ({}));\n      this._resetEditedCellsState();\n      if (this.state.assignmentMap instanceof Map) {\n        this.state.assignmentMap.clear();\n      } else {\n        this.state.assignmentMap = new Map();\n      }\n      this._clearFailedRows();\n      this.state.isDirty = false;\n\n      const message =\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\n      this.showToast(message, 'success', 3400);\n\n      await this._loadInitialData({ forceReload: true });\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\n    } finally {\n      this.state.isLoading = false;\n      this._updateStatusBar();\n    }\n  }\n\n  _syncWeekBoundaryControls() {\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\n    if (weekStartSelect) {\n      weekStartSelect.value = String(this._getWeekStartDay());\n    }\n    if (weekEndSelect) {\n      weekEndSelect.value = String(this._getWeekEndDay());\n    }\n  }\n\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\n      this._syncWeekBoundaryControls();\n      return;\n    }\n\n    this.state.weekStartDay = normalizedStart;\n    this.state.weekEndDay = normalizedEnd;\n    this._syncWeekBoundaryControls();\n\n    const label = `${this._formatWeekdayLabel(normalizedStart)} â†’ ${this._formatWeekdayLabel(normalizedEnd)}`;\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\n\n    this._regenerateColumnsForWeekBoundary();\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\n  }\n\n  _regenerateColumnsForWeekBoundary() {\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\n      return;\n    }\n\n    if (!this.timeColumnGenerator) {\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\n    }\n\n    try {\n      this.timeColumnGenerator.generate();\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\n      this._syncGridViews();\n      this._recalculateAllProgressTotals();\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\n    }\n  }\n\n  _invalidateCachedDataset() {\n    this.state.pekerjaanTree = [];\n    this.state.tahapanList = [];\n    this.state.timeColumns = [];\n    this.state.flatPekerjaan = [];\n    this.state.timeColumnIndex = {};\n    this.state.assignmentMap = new Map();\n    this._resetEditedCellsState();\n  }\n\n  _resetEditedCellsState() {\n    if (this.state.modifiedCells instanceof Map) {\n      this.state.modifiedCells.clear();\n    } else {\n      this.state.modifiedCells = new Map();\n    }\n    if (this.state.cellVolumeOverrides instanceof Map) {\n      this.state.cellVolumeOverrides.clear();\n    } else {\n      this.state.cellVolumeOverrides = new Map();\n    }\n    if (this.state.cellValidationMap instanceof Map) {\n      this.state.cellValidationMap.clear();\n    } else {\n      this.state.cellValidationMap = new Map();\n    }\n    if (this.state.validationWarningRows instanceof Set) {\n      this.state.validationWarningRows.clear();\n    } else {\n      this.state.validationWarningRows = new Set();\n    }\n    if (this.state.saveErrorRows instanceof Set) {\n      this.state.saveErrorRows.clear();\n    } else {\n      this.state.saveErrorRows = new Set();\n    }\n    this.state.showCompletionWarnings = false;\n  }\n\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\n    if (!endpoint) {\n      return;\n    }\n\n    if (this._weekBoundarySaveTimer) {\n      clearTimeout(this._weekBoundarySaveTimer);\n    }\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\n\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\n      this._weekBoundarySaveTimer = null;\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\n      this._pendingWeekBoundary = null;\n      const body = JSON.stringify({\n        week_start_day: payload.weekStartDay,\n        week_end_day: payload.weekEndDay,\n      });\n\n      fetch(endpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this._getCsrfToken(),\n        },\n        body,\n      })\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n          }\n          return response.json();\n        })\n        .then((data) => {\n          const resolvedStart =\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\n          const resolvedEnd =\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\n          this.state.weekStartDay = resolvedStart;\n          this.state.weekEndDay = resolvedEnd;\n          this._regenerateTimeline({\n            mode: 'weekly',\n            weekStartDay: resolvedStart,\n            weekEndDay: resolvedEnd,\n          });\n        })\n        .catch((error) => {\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\n        });\n    }, 500);\n  }\n\n  async _regenerateTimeline(options = {}) {\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\n    if (!endpoint) {\n      return;\n    }\n\n    if (this._isRegeneratingTimeline) {\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\n      return;\n    }\n\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\n      const confirmed = window.confirm(\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\n      );\n      if (!confirmed) {\n        return;\n      }\n      this._resetEditedCellsState();\n      this.state.isDirty = false;\n    }\n\n    this._isRegeneratingTimeline = true;\n    this.state.isLoading = true;\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\n    this._updateStatusBar(statusLabel);\n    const toastLabel =\n      mode === 'monthly'\n        ? 'Mengatur ulang kolom monthly...'\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\n    this.showToast(toastLabel, 'info', 2400);\n\n    try {\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this._getCsrfToken(),\n        },\n        body: JSON.stringify({\n          mode,\n          ...(mode === 'weekly'\n            ? {\n                week_start_day:\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\n                week_end_day:\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\n              }\n            : {}),\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      this._invalidateCachedDataset();\n      await this._loadInitialData({ forceReload: true });\n      const successMessage =\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\n      this.showToast(successMessage, 'success', 2200);\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\n    } finally {\n      this.state.isLoading = false;\n      this._updateStatusBar();\n      this._isRegeneratingTimeline = false;\n      if (this._queuedRegeneratePayload) {\n        const next = this._queuedRegeneratePayload;\n        this._queuedRegeneratePayload = null;\n        this._regenerateTimeline(next);\n      }\n    }\n  }\n\n  _formatWeekdayLabel(pyDay) {\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\n    return names[normalized] || `Day ${normalized}`;\n  }\n\n  _syncToolbarRadios() {\n    const displayMode = this.state.inputMode || 'percentage';\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\n      radio.checked = radio.value === displayMode;\n    });\n\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\n      radio.checked = radio.value === timeScale;\n    });\n  }\n\n  _handleDisplayModeChange(mode) {\n    const normalized = (mode || '').toLowerCase();\n    const allowed = new Set(['percentage', 'volume']);\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\n      return;\n    }\n\n    this.state.inputMode = normalized;\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\n\n    if (this.agGridManager) {\n      this.agGridManager.setInputMode(normalized);\n    }\n\n    this._syncGridViews();\n\n    const label = normalized === 'percentage' ? 'Persentase' : 'Volume';\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\n  }\n\n  /**\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\n   * @param {string} mode - 'planned' or 'actual'\n   */\n  _handleProgressModeChange(mode) {\n    const normalized = (mode || '').toLowerCase();\n    const allowed = new Set(['planned', 'actual']);\n\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\n      return;\n    }\n\n    const oldMode = this.state.progressMode;\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\n\n    // Phase 2E.1: Save state sizes before switch for debugging\n    const oldState = this._getCurrentModeState();\n    const oldModifiedSize = oldState.modifiedCells.size;\n    const oldAssignmentSize = oldState.assignmentMap.size;\n\n    // Switch mode - property delegation will now point to new mode's state\n    this.state.progressMode = normalized;\n\n    // Log new state after switch\n    const newState = this._getCurrentModeState();\n    console.log(`[ModeChange] State switch complete:`);\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldModifiedSize} modified, ${oldAssignmentSize} assignments`);\n    console.log(`  - New ${normalized.toUpperCase()}: ${newState.modifiedCells.size} modified, ${newState.assignmentMap.size} assignments`);\n\n    // Update mode indicator badge\n    const indicator = document.getElementById('progress-mode-indicator');\n    if (indicator) {\n      const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\n      const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\n      indicator.textContent = `Mode: ${label}`;\n      indicator.className = `badge ${bgClass} ms-2`;\n      indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\n    }\n\n    // Reload data with the new progress mode (will load from new mode's state)\n    this._syncGridViews();\n\n    const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\n    this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\n  }\n\n  _handleTimeScaleChange(nextScale) {\n    const normalized = (nextScale || '').toLowerCase();\n    const allowed = new Set(['weekly', 'monthly']);\n    if (!allowed.has(normalized)) {\n      this._syncToolbarRadios();\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\n      return;\n    }\n\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\n      this._syncToolbarRadios();\n      return;\n    }\n\n    this.state.displayScale = normalized;\n    this._syncToolbarRadios();\n    this._syncGridViews();\n    this._renderGrid();\n    this._updateCharts();\n\n    if (normalized === 'weekly') {\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\n    } else {\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\n    }\n  }\n\n  /**\n   * Initialize AG Grid when enabled\n   */\n  _initAgGridIfNeeded() {\n    if (!this.state.useAgGrid) {\n      return;\n    }\n\n    const container = this.state.domRefs.agGridContainer;\n    if (!container) {\n      console.warn('[JadwalKegiatanApp] AG Grid container not available');\n      return;\n    }\n\n    if (!this.agGridManager) {\n      this.agGridManager = new AGGridManager(this.state, {\n        showToast: this.showToast.bind(this),\n        onCellChange: (payload) => this._handleAgGridCellChange(payload),\n        getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\n      });\n      this.agGridManager.mount(container);\n    }\n  }\n\n  /**\n   * Load initial data from server\n   */\n  async _loadInitialData(options = {}) {\n    const { forceReload = false } = options;\n    // Check if data is already loaded (from Django template)\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\n      console.log('[JadwalKegiatanApp] Using template dataset');\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\n      this._recalculateAllProgressTotals();\n      this._syncGridViews();\n      return;\n    }\n\n    // Initialize modern modules\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\n    this.dataLoader = new DataLoader(this.state);\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\n    this.gridRenderer = new GridRenderer(this.state);\n    this.saveHandler = new SaveHandler(this.state, {\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\n      onSuccess: (result) => this._onSaveSuccess(result),\n      onError: (error) => this._onSaveError(error),\n      showToast: (msg, type) => this.showToast(msg, type)\n    });\n\n    this.state.isLoading = true;\n\n    try {\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\n\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\n\n      // Step 2: Generate time columns from loaded tahapan\n      this.timeColumnGenerator.generate();\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\n        const weeklyCount = this._countWeeklyColumns();\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\n        const firstColumnMode =\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\n\n        const shouldForceWeekly =\n          weeklyCount === 0 ||\n          firstColumnMode === 'monthly' ||\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\n\n        if (shouldForceWeekly) {\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\n          this._isEnforcingWeekly = true;\n          await this._regenerateTimeline({\n            mode: 'weekly',\n            weekStartDay: this._getWeekStartDay(),\n            weekEndDay: this._getWeekEndDay(),\n          });\n          this._isEnforcingWeekly = false;\n          return;\n        }\n      }\n\n      // Step 3: Load assignments (depends on time columns)\n      await this.dataLoader.loadAssignments();\n      this._recalculateAllProgressTotals();\n\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\n      await this._loadKurvaSData();\n\n      // Build time column index for quick lookup\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\n\n      console.log(\n        `[JadwalKegiatanApp] âœ… Data loaded successfully:`,\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\n        `${this.state.tahapanList?.length || 0} tahapan,`,\n        `${this.state.timeColumns?.length || 0} columns`\n      );\n\n      // Step 4: Render grid\n      this._renderGrid();\n\n      // Step 5: Initialize and update charts\n      this._initializeCharts();\n      this._updateCharts();\n\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] âŒ Failed to load data:', error);\n      this.state.error = error;\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\n    } finally {\n      this.state.isLoading = false;\n      this._syncGridViews();\n    }\n  }\n\n  /**\n   * Load Kurva S harga data from API (Phase 2F.0)\n   *\n   * Loads harga-based data for Kurva S chart instead of volume-based.\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\n   *\n   * @private\n   */\n  async _loadKurvaSData() {\n    try {\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\n\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\n\n      const response = await fetch(apiUrl, {\n        credentials: 'same-origin',\n        headers: {\n          'X-Requested-With': 'XMLHttpRequest',\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n\n      // Store harga data in state\n      this.state.hargaMap = new Map(\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\n      );\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\n\n      // Update volumeMap if needed (backward compatibility)\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\n        const existingSize = this.state.volumeMap?.size || 0;\n        if (existingSize === 0) {\n          this.state.volumeMap = new Map(\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\n          );\n        }\n      }\n\n      console.log('[JadwalKegiatanApp] âœ… Kurva S data loaded:', {\n        hargaCount: this.state.hargaMap.size,\n        totalBiaya: this.state.totalBiayaProject,\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\n      });\n\n    } catch (error) {\n      console.error('[JadwalKegiatanApp] âš ï¸ Failed to load Kurva S data:', error);\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\n      this.state.hargaMap = this.state.hargaMap || new Map();\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\n\n      // Don't show error toast - this is non-critical, Kurva S has fallback\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\n    }\n  }\n\n  /**\n   * Render grid using GridRenderer\n   * @private\n   */\n  _renderGrid() {\n    if (!this.gridRenderer) {\n      console.warn('[JadwalKegiatanApp] GridRenderer not initialized');\n      return;\n    }\n\n    this.state.activeTimeColumns = this._getDisplayTimeColumns();\n\n    console.log('[JadwalKegiatanApp] Rendering grid...');\n\n    // Render tables\n    const rendered = this.gridRenderer.renderTables();\n    if (!rendered) {\n      console.warn('[JadwalKegiatanApp] Grid rendering returned null');\n      return;\n    }\n\n    const { leftHTML, rightHTML } = rendered;\n\n    // Update DOM\n    const leftTbody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\n    const rightTbody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\n\n    if (leftTbody) {\n      leftTbody.innerHTML = leftHTML;\n    }\n\n    if (rightTbody) {\n      rightTbody.innerHTML = rightHTML;\n    }\n\n    // Render time headers\n    const timeHeaderRow = this.state.domRefs?.timeHeaderRow || document.getElementById('time-header-row');\n    if (timeHeaderRow) {\n      this.gridRenderer.renderTimeHeader(timeHeaderRow);\n    }\n\n    // Sync row heights\n    this.gridRenderer.syncRowHeights(this.state.domRefs || {});\n    this._updateLegacyHorizontalScroll();\n\n    console.log('[JadwalKegiatanApp] âœ… Grid rendered');\n\n    this._updateStatusBar();\n  }\n\n  /**\n   * Initialize chart modules\n   * @private\n   */\n  _initializeCharts() {\n    console.log('[JadwalKegiatanApp] Initializing charts...');\n\n    // Initialize Kurva-S Chart\n    if (this.state.domRefs?.scurveChart) {\n      try {\n        this.kurvaSChart = new KurvaSChart(this.state, {\n          useIdealCurve: true,\n          steepnessFactor: 0.8,\n          smoothCurves: true,\n          showArea: true,\n        });\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\n        if (success) {\n          console.log('[JadwalKegiatanApp] âœ… Kurva-S chart initialized');\n        }\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\n      }\n    }\n\n    // Initialize Gantt Chart\n    if (this.state.domRefs?.ganttChart) {\n      try {\n        this.ganttChart = new GanttChart(this.state, {\n          viewMode: 'Week',\n          enableThemeObserver: true,\n        });\n        const success = this.ganttChart.initialize(this.state.domRefs.ganttChart);\n        if (success) {\n          console.log('[JadwalKegiatanApp] âœ… Gantt chart initialized');\n        }\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to initialize Gantt chart:', error);\n      }\n    }\n  }\n\n  /**\n   * Update charts with current data\n   * @private\n   */\n  _updateCharts() {\n    console.log('[JadwalKegiatanApp] Updating charts...');\n\n    // Update Kurva-S Chart\n    if (this.kurvaSChart) {\n      try {\n        this.kurvaSChart.update();\n        console.log('[JadwalKegiatanApp] âœ… Kurva-S chart updated');\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\n      }\n    }\n\n    // Update Gantt Chart\n    if (this.ganttChart) {\n      try {\n        this.ganttChart.update();\n        console.log('[JadwalKegiatanApp] âœ… Gantt chart updated');\n      } catch (error) {\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt chart:', error);\n      }\n    }\n  }\n\n  /**\n   * Save changes to server (using modern SaveHandler)\n   */\n  async saveChanges() {\n    if (!this.saveHandler) {\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\n      return;\n    }\n\n    if (!this._validateRowTotalsBeforeSave()) {\n      return;\n    }\n\n    // Delegate to SaveHandler\n    const result = await this.saveHandler.save();\n\n    // Re-render grid after save\n    if (result.success) {\n      this._renderGrid();\n      this._recalculateAllProgressTotals();\n    }\n  }\n\n  /**\n   * Handle successful save\n   * @param {Object} result - Save result\n   * @private\n   */\n  _onSaveSuccess(result) {\n    console.log('[JadwalKegiatanApp] Save completed successfully');\n    this.state.isDirty = false;\n    this._clearSaveErrorRows();\n\n    // Update status bar if exists\n    this._updateStatusBar('Perubahan tersimpan');\n    this._clearApiFailedRows();\n\n    // Re-render grid to update UI\n    this._renderGrid();\n    this._recalculateAllProgressTotals();\n\n    // Update charts with new data\n    this._updateCharts();\n  }\n\n  /**\n   * Handle save error\n   * @param {Error} error - Error object\n   * @private\n   */\n  _onSaveError(error) {\n    console.error('[JadwalKegiatanApp] Save failed:', error);\n    // Error toast already shown by SaveHandler\n    this._markFailedRowsFromError(error);\n  }\n\n  /**\n   * Refresh data from server\n   */\n  async refresh() {\n    if (this.state.isDirty) {\n      const confirmed = confirm(\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\n      );\n      if (!confirmed) return;\n    }\n\n    console.log('Refreshing data...');\n    this._resetEditedCellsState();\n    this.state.isDirty = false;\n\n    await this._loadInitialData({ forceReload: true });\n    this.showToast('Data berhasil di-refresh', 'success');\n  }\n\n  /**\n   * Show toast notification\n   */\n  showToast(message, type = 'info', duration = 3000) {\n    // Use existing toast system if available\n    if (typeof window.showToast === 'function') {\n      window.showToast(message, type, duration);\n      return;\n    }\n\n    // Fallback toast implementation\n    console.log(`[${type.toUpperCase()}] ${message}`);\n\n    const toast = document.createElement('div');\n    toast.className = `toast toast-${type}`;\n    toast.textContent = message;\n\n    document.body.appendChild(toast);\n\n    setTimeout(() => {\n      toast.classList.add('show');\n    }, 10);\n\n    setTimeout(() => {\n      toast.classList.remove('show');\n      setTimeout(() => toast.remove(), 300);\n    }, duration);\n  }\n\n  /**\n   * Build normalized time columns from tahapan list\n   */\n  _buildTimeColumns(tahapanList = []) {\n    if (!Array.isArray(tahapanList)) {\n      return [];\n    }\n\n    return tahapanList.map((tahap, index) => {\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\n      const fieldId = `col_${safeId}`;\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\n      const order =\n        typeof tahap?.urutan === 'number'\n          ? tahap.urutan\n          : Number.parseInt(tahap?.urutan, 10) || index;\n      const weekNumber = order + 1;\n      return {\n        id: rawId,\n        fieldId,\n        label,\n        order,\n        weekNumber,\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\n        generationMode: tahap?.generation_mode || null,\n      };\n    });\n  }\n\n  _createTimeColumnIndex(columns = []) {\n    const index = {};\n    (columns || []).forEach((col) => {\n      const key = col.fieldId || col.id;\n      if (key) {\n        index[key] = col;\n      }\n    });\n    return index;\n  }\n\n  _getDefaultSaveEndpoint() {\n    const projectId = this.state?.projectId;\n    if (!projectId) {\n      return '';\n    }\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\n  }\n\n  /**\n   * Fetch JSON helper with sane defaults\n   */\n  async _fetchJson(url, options = {}) {\n    if (!url) {\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\n    }\n\n    const response = await fetch(url, {\n      credentials: 'same-origin',\n      ...options,\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text().catch(() => '');\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Sync rendered grids (AG Grid + future legacy bridging)\n   */\n  _syncGridViews() {\n    const displayColumns = this._getDisplayTimeColumns();\n    this.state.activeTimeColumns = displayColumns;\n\n    if (this.agGridManager) {\n      this.agGridManager.updateData({\n        tree: this.state.pekerjaanTree || [],\n        timeColumns: displayColumns,\n        inputMode: this.state.inputMode || 'percentage',\n        timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\n      });\n      if (typeof this.agGridManager.updateTopScrollMetrics === 'function') {\n        this.agGridManager.updateTopScrollMetrics();\n      }\n    }\n    this._updateLegacyHorizontalScroll();\n  }\n\n  _updateLegacyHorizontalScroll() {\n    const domRefs = this.state?.domRefs || {};\n    const scrollTop = domRefs.horizontalScrollTop;\n    const scrollInner = domRefs.horizontalScrollInner;\n    const rightTable = domRefs.rightTable;\n    if (!scrollTop || !scrollInner || !rightTable) {\n      return;\n    }\n    window.requestAnimationFrame(() => {\n      scrollInner.style.width = `${rightTable.scrollWidth}px`;\n    });\n  }\n\n  _clearApiFailedRows() {\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\n      this.state.apiFailedRows.clear();\n      this._refreshFailedRowsUnion();\n    }\n  }\n\n  _markFailedRowsFromIds(idSet) {\n    if (!(idSet instanceof Set) || idSet.size === 0) {\n      this._clearApiFailedRows();\n      return;\n    }\n    this.state.apiFailedRows = new Set(Array.from(idSet));\n    this._refreshFailedRowsUnion();\n  }\n\n  _setSaveErrorRows(idSet) {\n    if (!(this.state.saveErrorRows instanceof Set)) {\n      this.state.saveErrorRows = new Set();\n    }\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\n      this.agGridManager.refreshRowStyles();\n    }\n  }\n\n  _clearSaveErrorRows() {\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\n      this.state.saveErrorRows.clear();\n      if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\n        this.agGridManager.refreshRowStyles();\n      }\n    }\n  }\n\n  _clearSaveErrorForRow(pekerjaanId) {\n    if (\n      !pekerjaanId ||\n      !(this.state.saveErrorRows instanceof Set) ||\n      this.state.saveErrorRows.size === 0\n    ) {\n      return;\n    }\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\n    if (removed && this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\n      this.agGridManager.refreshRowStyles();\n    }\n  }\n\n  _markFailedRowsFromError(error) {\n    const ids = this._extractPekerjaanIdsFromError(error);\n    this._markFailedRowsFromIds(ids);\n  }\n\n  _extractPekerjaanIdsFromError(error) {\n    const idSet = new Set();\n    const collect = (items = []) => {\n      items.forEach((item) => {\n        const pekerjaanId =\n          item?.pekerjaan_id ||\n          item?.pekerjaanId ||\n          item?.item?.pekerjaan_id ||\n          item?.item?.pekerjaanId ||\n          null;\n        if (pekerjaanId) {\n          idSet.add(Number(pekerjaanId));\n        }\n      });\n    };\n\n    if (Array.isArray(error?.validationErrors)) {\n      collect(error.validationErrors);\n    }\n    if (Array.isArray(error?.details)) {\n      collect(error.details);\n    }\n\n    return idSet;\n  }\n\n  _getContainerValue(container, key) {\n    if (!container || !key) {\n      return null;\n    }\n    if (container instanceof Map) {\n      return container.has(key) ? container.get(key) : null;\n    }\n    if (typeof container === 'object') {\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\n    }\n    return null;\n  }\n\n  _calculateRowTotalPercent(pekerjaanId) {\n    if (!pekerjaanId) {\n      return 0;\n    }\n    const columns = this.state.timeColumns || [];\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\n    const assignmentMap = this.state.assignmentMap;\n    let total = 0;\n\n    columns.forEach((col) => {\n      const fieldKey = col.fieldId || col.id;\n      if (!fieldKey) {\n        return;\n      }\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\n      let value = null;\n      if (modifiedCells && modifiedCells.has(cellKey)) {\n        value = modifiedCells.get(cellKey);\n      } else {\n        value = this._getContainerValue(assignmentMap, cellKey);\n      }\n      const numeric = Number(value);\n      if (Number.isFinite(numeric)) {\n        total += numeric;\n      }\n    });\n\n    return Number(total.toFixed(2));\n  }\n\n  _calculateRowTotalVolume(pekerjaanId) {\n    if (!pekerjaanId) {\n      return 0;\n    }\n    const kapasitas = this._getRowVolume(pekerjaanId);\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\n    const assignmentMap = this.state.assignmentMap;\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\n\n    let totalVolume = 0;\n    columns.forEach((col) => {\n      const fieldKey = col.fieldId || col.id;\n      if (!fieldKey) {\n        return;\n      }\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\n      let volumeValue = null;\n\n      if (overrides && overrides.has(cellKey)) {\n        const overrideValue = Number(overrides.get(cellKey));\n        if (Number.isFinite(overrideValue)) {\n          volumeValue = overrideValue;\n        }\n      }\n\n      if (volumeValue === null) {\n        let percentValue = null;\n        if (modifiedCells && modifiedCells.has(cellKey)) {\n          percentValue = Number(modifiedCells.get(cellKey));\n        } else if (assignmentMap) {\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\n        }\n\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\n          volumeValue = (percentValue / 100) * kapasitas;\n        }\n      }\n\n      if (Number.isFinite(volumeValue)) {\n        totalVolume += volumeValue;\n      }\n    });\n\n    return Number(totalVolume.toFixed(3));\n  }\n\n  _setCellVolumeOverride(cellKey, volumeValue) {\n    if (!cellKey) {\n      return;\n    }\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\n      this.state.cellVolumeOverrides = new Map();\n    }\n    const numeric = Number(volumeValue);\n    if (Number.isFinite(numeric)) {\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\n      this.state.cellVolumeOverrides.delete(cellKey);\n    }\n  }\n\n  _clearCellVolumeOverride(cellKey) {\n    if (\n      !cellKey ||\n      !(this.state.cellVolumeOverrides instanceof Map) ||\n      this.state.cellVolumeOverrides.size === 0\n    ) {\n      return;\n    }\n    this.state.cellVolumeOverrides.delete(cellKey);\n  }\n\n  _updateCellValidationState(cellKey, validationResult) {\n    if (!cellKey) {\n      return;\n    }\n    if (!(this.state.cellValidationMap instanceof Map)) {\n      this.state.cellValidationMap = new Map();\n    }\n    const current = this.state.cellValidationMap.get(cellKey) || null;\n    const nextState =\n      validationResult && validationResult.isValid === false\n        ? validationResult.level === 'warning'\n          ? 'warning'\n          : 'error'\n        : null;\n    let changed = false;\n    if (nextState) {\n      if (current !== nextState) {\n        this.state.cellValidationMap.set(cellKey, nextState);\n        changed = true;\n      }\n    } else if (current) {\n      this.state.cellValidationMap.delete(cellKey);\n      changed = true;\n    }\n    if (changed && this.agGridManager && typeof this.agGridManager.refreshCells === 'function') {\n      this.agGridManager.refreshCells();\n    }\n  }\n\n  _getCellValidationState(cellKey) {\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\n      return null;\n    }\n    return this.state.cellValidationMap.get(cellKey) || null;\n  }\n\n  _updateProgressTotals(pekerjaanId) {\n    if (!pekerjaanId) {\n      return 0;\n    }\n    if (!(this.state.progressTotals instanceof Map)) {\n      this.state.progressTotals = new Map();\n    }\n    const total = this._calculateRowTotalPercent(pekerjaanId);\n    this.state.progressTotals.set(Number(pekerjaanId), total);\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\n    this._updateStatusBar();\n    return total;\n  }\n\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\n    if (!pekerjaanId) {\n      return;\n    }\n    if (!(this.state.volumeTotals instanceof Map)) {\n      this.state.volumeTotals = new Map();\n    }\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\n\n    const percentTotal =\n      Number.isFinite(percentOverride) && percentOverride !== null\n        ? Number(percentOverride)\n        : this.state.progressTotals instanceof Map\n          ? this.state.progressTotals.get(Number(pekerjaanId))\n          : null;\n\n    const kapasitas = this._getRowVolume(pekerjaanId);\n    const derivedPercent =\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\n        ? (totalVolume / kapasitas) * 100\n        : percentTotal;\n\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\n      percentTotal: derivedPercent,\n      deferRefresh: options.deferRefresh,\n    });\n  }\n\n  _recalculateAllProgressTotals() {\n    if (!(this.state.progressTotals instanceof Map)) {\n      this.state.progressTotals = new Map();\n    } else {\n      this.state.progressTotals.clear();\n    }\n    if (!(this.state.volumeTotals instanceof Map)) {\n      this.state.volumeTotals = new Map();\n    } else {\n      this.state.volumeTotals.clear();\n    }\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\n      this.state.cellVolumeOverrides = new Map();\n    } else {\n      this.state.cellVolumeOverrides.clear();\n    }\n    this.state.autoWarningRows = new Set();\n    this.state.volumeWarningRows = new Set();\n    this.state.validationWarningRows = new Set();\n    this.state.saveErrorRows = new Set();\n\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\n      : [];\n\n    pekerjaanNodes.forEach((node) => {\n      const total = this._calculateRowTotalPercent(node.id);\n      this.state.progressTotals.set(Number(node.id), total);\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\n    });\n\n    this._refreshFailedRowsUnion();\n    if (this.state.showCompletionWarnings && this.agGridManager) {\n      this.agGridManager.refreshRowStyles();\n    }\n    this._updateStatusBar();\n  }\n\n  _refreshFailedRowsUnion() {\n    const union = new Set();\n    if (this.state.autoWarningRows instanceof Set) {\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\n    }\n    if (this.state.volumeWarningRows instanceof Set) {\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\n    }\n    if (this.state.apiFailedRows instanceof Set) {\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\n    }\n    if (this.state.saveErrorRows instanceof Set) {\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\n    }\n    this.state.failedRows = union;\n    this._updateSaveButtonState();\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\n      this.agGridManager.refreshRowStyles();\n    }\n  }\n\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\n    if (!pekerjaanId) {\n      return;\n    }\n    if (!(this.state.autoWarningRows instanceof Set)) {\n      this.state.autoWarningRows = new Set();\n    }\n    const tolerance = 0.01;\n    let changed = false;\n    if (totalPercent > 100 + tolerance) {\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\n        this.state.autoWarningRows.add(pekerjaanId);\n        changed = true;\n      }\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\n      this.state.autoWarningRows.delete(pekerjaanId);\n      changed = true;\n    }\n\n    if (changed && !options.deferRefresh) {\n      this._refreshFailedRowsUnion();\n    }\n  }\n\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\n    if (!pekerjaanId) {\n      return;\n    }\n    if (!(this.state.validationWarningRows instanceof Set)) {\n      this.state.validationWarningRows = new Set();\n    }\n    const tolerance = 0.01;\n    const upperBound = 100 - tolerance;\n    const shouldWarn =\n      this.state.showCompletionWarnings &&\n      Number.isFinite(totalPercent) &&\n      totalPercent > tolerance &&\n      totalPercent < upperBound;\n\n    let changed = false;\n    if (shouldWarn) {\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\n        this.state.validationWarningRows.add(pekerjaanId);\n        changed = true;\n      }\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\n      this.state.validationWarningRows.delete(pekerjaanId);\n      changed = true;\n    }\n\n    if (changed && !options.deferRefresh && this.agGridManager) {\n      this.agGridManager.refreshRowStyles();\n    }\n  }\n\n  _recomputeCompletionWarnings() {\n    if (!(this.state.validationWarningRows instanceof Set)) {\n      this.state.validationWarningRows = new Set();\n    } else {\n      this.state.validationWarningRows.clear();\n    }\n    if (!(this.state.progressTotals instanceof Map)) {\n      if (this.agGridManager) {\n        this.agGridManager.refreshRowStyles();\n      }\n      return;\n    }\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\n    });\n    if (this.agGridManager) {\n      this.agGridManager.refreshRowStyles();\n    }\n  }\n\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\n    if (!pekerjaanId) {\n      return;\n    }\n    if (!(this.state.volumeWarningRows instanceof Set)) {\n      this.state.volumeWarningRows = new Set();\n    }\n\n    const capacity = this._getRowVolume(pekerjaanId);\n    const percentReference =\n      options && Number.isFinite(options.percentTotal)\n        ? Number(options.percentTotal)\n        : this.state.progressTotals instanceof Map\n          ? this.state.progressTotals.get(Number(pekerjaanId))\n          : null;\n\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\n    let shouldWarn = false;\n    if (Number.isFinite(capacity) && capacity > 0) {\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\n    } else if (Number.isFinite(percentReference)) {\n      shouldWarn = percentReference > tolerance;\n    }\n\n    let changed = false;\n    if (shouldWarn) {\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\n        this.state.volumeWarningRows.add(pekerjaanId);\n        changed = true;\n      }\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\n      this.state.volumeWarningRows.delete(pekerjaanId);\n      changed = true;\n    }\n\n    if (changed && !options.deferRefresh) {\n      this._refreshFailedRowsUnion();\n    }\n  }\n\n  _clearFailedRows() {\n    if (this.state.autoWarningRows instanceof Set) {\n      this.state.autoWarningRows.clear();\n    }\n    if (this.state.volumeWarningRows instanceof Set) {\n      this.state.volumeWarningRows.clear();\n    }\n    if (this.state.failedRows instanceof Set) {\n      this.state.failedRows.clear();\n    }\n    if (this.state.saveErrorRows instanceof Set) {\n      this.state.saveErrorRows.clear();\n    }\n    this._refreshFailedRowsUnion();\n  }\n\n  _getRowVolume(pekerjaanId) {\n    const volumeMap = this.state?.volumeMap;\n    const numericId = Number(pekerjaanId);\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\n      return Number(volumeMap.get(numericId)) || 0;\n    }\n    if (volumeMap && typeof volumeMap === 'object') {\n      const key = String(numericId);\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\n        return Number(volumeMap[key]) || 0;\n      }\n    }\n    const fallbackNode =\n      Array.isArray(this.state.flatPekerjaan) &&\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\n      return Number(fallbackNode.volume) || 0;\n    }\n    return 0;\n  }\n\n  _validateRowTotalsBeforeSave() {\n    if (!(this.state.progressTotals instanceof Map)) {\n      return true;\n    }\n    if (!this.state.showCompletionWarnings) {\n      this.state.showCompletionWarnings = true;\n    }\n    this._recomputeCompletionWarnings();\n    const percentTolerance = 0.01;\n    const percentViolations = [];\n\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\n      if (!Number.isFinite(totalPercent)) {\n        return;\n      }\n      if (totalPercent > 100 + percentTolerance) {\n        percentViolations.push({\n          type: 'percent',\n          pekerjaan_id: pekerjaanId,\n          total: totalPercent,\n        });\n      }\n    });\n\n    const volumeViolations = [];\n    if (this.state.volumeTotals instanceof Map) {\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\n        const capacity = this._getRowVolume(pekerjaanId);\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\n        const percentTotal =\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\n            ? this.state.progressTotals.get(pekerjaanId)\n            : null;\n        const effectivePercent =\n          Number.isFinite(percentTotal) && percentTotal !== null\n            ? Number(percentTotal)\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\n              ? (Number(totalVolume) / Number(capacity)) * 100\n              : null;\n        if (Number.isFinite(capacity) && capacity > 0) {\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\n            volumeViolations.push({\n              type: 'volume',\n              pekerjaan_id: pekerjaanId,\n              total: totalVolume,\n              capacity,\n            });\n          }\n        } else {\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\n            volumeViolations.push({\n              type: 'volume',\n              pekerjaan_id: pekerjaanId,\n              total: totalVolume,\n              capacity: capacity || 0,\n              missingCapacity: true,\n            });\n          }\n        }\n      });\n    }\n\n    if (percentViolations.length === 0 && volumeViolations.length === 0) {\n      this._clearFailedRows();\n      this._clearSaveErrorRows();\n      return true;\n    }\n\n    const ids = new Set();\n    const combined = percentViolations.concat(volumeViolations);\n    const messages = combined.slice(0, 3).map((item) => {\n      ids.add(Number(item.pekerjaan_id));\n      if (item.type === 'volume') {\n        if (item.missingCapacity) {\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\n        }\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\n      }\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\n    });\n\n    if (combined.length > 3) {\n      messages.push(`(+${combined.length - 3} lagi)`);\n    }\n\n    this._markFailedRowsFromIds(ids);\n    this._setSaveErrorRows(ids);\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\n    return false;\n  }\n\n  _updateStatusBar(message = 'Ready') {\n    const domRefs = this.state?.domRefs || {};\n    const hasElements =\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\n    if (!hasElements) {\n      return;\n    }\n\n    if (domRefs.statusMessageEl && typeof message === 'string') {\n      domRefs.statusMessageEl.textContent = message;\n    }\n\n    if (domRefs.itemCountEl) {\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\n        : 0;\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\n    }\n\n    if (domRefs.modifiedCountEl) {\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\n    }\n\n    if (domRefs.totalProgressEl) {\n      const totalProgress = this._calculateProjectProgress();\n      domRefs.totalProgressEl.textContent =\n        totalProgress === null\n          ? '-'\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\n    }\n  }\n\n  _calculateProjectProgress() {\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\n      let aggregate = 0;\n      this.state.progressTotals.forEach((value) => {\n        aggregate += Number(value) || 0;\n      });\n      const avg = aggregate / this.state.progressTotals.size;\n      return Math.round(avg * 10) / 10;\n    }\n\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\n      const pekerjaanTotals = new Map();\n      this.state.assignmentMap.forEach((value, cellKey) => {\n        const [pekerjaanId] = `${cellKey}`.split('-');\n        const numericValue = Number(value) || 0;\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\n      });\n\n      if (pekerjaanTotals.size > 0) {\n        let sum = 0;\n        pekerjaanTotals.forEach((value) => {\n          sum += value;\n        });\n        const avg = sum / pekerjaanTotals.size;\n        return Math.round(avg * 10) / 10;\n      }\n    }\n\n    return null;\n  }\n\n  _buildAssignmentsPayload() {\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\n      return [];\n    }\n\n    const assignments = [];\n    const columnIndex = this.state.timeColumnIndex || {};\n\n    this.state.modifiedCells.forEach((value, cellKey) => {\n      const parsed = this._parseCellKey(cellKey);\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\n        return;\n      }\n\n      const columnMeta = columnIndex[parsed.fieldId];\n      if (!columnMeta) {\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\n        return;\n      }\n\n      const proportion = parseFloat(value);\n      if (Number.isNaN(proportion)) {\n        return;\n      }\n\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\n\n      assignments.push({\n        pekerjaan_id: Number(parsed.pekerjaanId),\n        week_number: weekNumber,\n        proportion: Number(proportion.toFixed(2)),\n        tahapan_id: columnMeta.id || null,\n      });\n    });\n\n    return assignments;\n  }\n\n  _getSaveMode() {\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\n    return allowed.has(normalized) ? normalized : 'weekly';\n  }\n\n  _normalizePythonWeekday(value, fallback = 0) {\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\n    const parsed = Number(value);\n    if (!Number.isFinite(parsed)) {\n      return fallbackSafe;\n    }\n    const normalized = parsed % 7;\n    return normalized < 0 ? normalized + 7 : normalized;\n  }\n\n  _getWeekStartDay() {\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\n    }\n    return (this._getWeekEndDay() + 1) % 7;\n  }\n\n  _getWeekEndDay() {\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\n  }\n\n  _getDisplayTimeColumns() {\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\n    if (scale !== 'monthly') {\n      return baseColumns;\n    }\n\n    const isWeeklyColumn = (col) => {\n      const mode = (col.generationMode || col.type || '').toLowerCase();\n      if (mode === 'monthly') {\n        return false;\n      }\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\n        return true;\n      }\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\n        return true;\n      }\n      const label = (col.label || '').toLowerCase();\n      return label.includes('week') || label.includes('minggu');\n    };\n\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\n\n    const blockSize = 4;\n    const aggregated = [];\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\n      if (!blockColumns.length) {\n        continue;\n      }\n      const blockIndex = aggregated.length;\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\n      const label = `Month ${blockIndex + 1}`;\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\n\n      aggregated.push({\n        id: `month-${blockIndex + 1}`,\n        fieldId: `month_${blockIndex + 1}`,\n        label,\n        rangeLabel,\n        tooltip: startLabel && endLabel ? `${startLabel} â†’ ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\n        generationMode: 'monthly',\n        type: 'monthly',\n        index: blockIndex,\n        childColumns: blockColumns,\n      });\n    }\n\n    return aggregated;\n  }\n\n  _parseCellKey(cellKey) {\n    if (!cellKey || typeof cellKey !== 'string') {\n      return null;\n    }\n    const separatorIndex = cellKey.indexOf('-');\n    if (separatorIndex === -1) {\n      return { pekerjaanId: cellKey, fieldId: null };\n    }\n\n    return {\n      pekerjaanId: cellKey.slice(0, separatorIndex),\n      fieldId: cellKey.slice(separatorIndex + 1),\n    };\n  }\n\n  /**\n   * Get CSRF token from cookie\n   */\n  _getCsrfToken() {\n    const name = 'csrftoken';\n    let cookieValue = null;\n\n    if (document.cookie && document.cookie !== '') {\n      const cookies = document.cookie.split(';');\n      for (let i = 0; i < cookies.length; i++) {\n        const cookie = cookies[i].trim();\n        if (cookie.substring(0, name.length + 1) === name + '=') {\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n          break;\n        }\n      }\n    }\n\n    return cookieValue;\n  }\n\n  /**\n   * Handle AG Grid cell change\n   */\n  _handleAgGridCellChange({\n    cellKey,\n    value,\n    columnMeta,\n    displayValue,\n    isVolumeMode,\n    validation,\n    pekerjaanId,\n    columnId,\n  }) {\n    if (!cellKey) {\n      return;\n    }\n\n    if (validation) {\n      this._updateCellValidationState(cellKey, validation);\n    }\n\n    let normalizedValue = value;\n    if (typeof normalizedValue === 'string') {\n      normalizedValue = parseFloat(normalizedValue);\n    }\n    if (Number.isNaN(normalizedValue)) {\n      normalizedValue = 0;\n    }\n\n    // Phase 2E.1: Get current mode's state for isolated data tracking\n    const modeState = this._getCurrentModeState();\n    const progressMode = this.state.progressMode || 'planned';\n\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\n\n    // Write to mode-specific state (isolated from other mode)\n    modeState.modifiedCells.set(cellKey, normalizedValue);\n    modeState.isDirty = true;\n\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\n      this.state.timeColumnIndex[columnMeta.fieldId] =\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\n    }\n\n    if (isVolumeMode) {\n      this._setCellVolumeOverride(cellKey, displayValue);\n    } else {\n      this._clearCellVolumeOverride(cellKey);\n    }\n\n    const parsed = this._parseCellKey(cellKey);\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\n    if (resolvedPekerjaanId) {\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\n    }\n\n    console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\n  }\n\n  /**\n   * Cleanup and destroy the application\n   */\n  destroy() {\n    if (this.eventManager) {\n      this.eventManager.cleanup();\n      this.eventManager = null;\n    }\n\n    if (this.agGridManager) {\n      this.agGridManager.destroy();\n      this.agGridManager = null;\n    }\n\n    this.state = null;\n    this.initialized = false;\n\n    console.log('JadwalKegiatanApp destroyed');\n  }\n}\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    const app = new JadwalKegiatanApp();\n    app.initialize();\n  });\n} else {\n  // DOM already loaded\n  const app = new JadwalKegiatanApp();\n  app.initialize();\n}\n\n// Export for manual initialization\nexport default JadwalKegiatanApp;\n"],"names":["JadwalKegiatanApp","constructor","this","state","eventManager","initialized","agGridManager","dataLoader","timeColumnGenerator","gridRenderer","saveHandler","kurvaSChart","ganttChart","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_getProjectDateRange","start","end","_a","projectStart","parsed","Date","Number","isNaN","getTime","_b","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","Math","max","floor","ceil","_countWeeklyColumns","Array","isArray","timeColumns","filter","col","mode","generationMode","type","toLowerCase","isFinite","weekNumber","week_number","length","initialize","__async","arguments","config","console","warn","log","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","window","error","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","Set","volumeMap","Map","isLoading","domRefs","apiEndpoints","projectId","projectName","useAgGrid","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","progressMode","displayMode","plannedState","modifiedCells","assignmentMap","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","getCurrentState","defineProperty","get","configurable","set","value","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","_c","size","disabled","classList","toggle","Boolean","setAttribute","removeAttribute","root","document","getElementById","leftThead","rightThead","leftTbody","rightTbody","leftPanelScroll","querySelector","rightPanelScroll","rightTable","horizontalScrollTop","horizontalScrollInner","timeHeaderRow","refreshButton","resetButton","agGridContainer","agGridTopScroll","agGridTopScrollInner","scurveChart","statusBar","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","dataset","allowedTimeScales","datasetScale","defaultTimeScale","toString","has","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","_d","weekend","weekEnd","week_end_day","parsedWeekStartDay","_f","_e","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","reset","apiResetProgress","enableAgGrid","helpers","updateProgressIndicator","pekerjaanId","total","showToast","bind","cleanup","attachGridEvents","_attachToolbarEvents","_initAgGridIfNeeded","addEventListener","saveChanges","refresh","_handleResetProgress","_syncToolbarRadios","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","ExportManager","forEach","format","button","exportAs","groupName","handler","radios","querySelectorAll","radio","event","target","checked","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","modeLabel","confirm","_updateStatusBar","response","fetch","method","credentials","headers","_getCsrfToken","body","JSON","stringify","ok","text","catch","status","result","json","_resetEditedCellsState","clear","_clearFailedRows","message","forceReload","String","normalizedEnd","normalizedStart","label","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_syncGridViews","_recalculateAllProgressTotals","_invalidateCachedDataset","flatPekerjaan","clearTimeout","setTimeout","payload","then","data","resolvedStart","resolvedEnd","_regenerateTimeline","options","statusLabel","toastLabel","__spreadValues","successMessage","next","pyDay","setInputMode","oldMode","oldState","oldModifiedSize","oldAssignmentSize","newState","toUpperCase","indicator","bgClass","textContent","className","style","cssText","nextScale","_renderGrid","_updateCharts","container","AGGridManager","onCellChange","_handleAgGridCellChange","getCellValidationState","cellKey","_getCellValidationState","mount","DataLoader","GridRenderer","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","_g","_i","_h","loadAssignments","_loadKurvaSData","_j","_k","_l","_initializeCharts","statusText","hargaMap","entries","map","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","keys","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","activeTimeColumns","_getDisplayTimeColumns","rendered","renderTables","leftHTML","rightHTML","innerHTML","renderTimeHeader","syncRowHeights","_updateLegacyHorizontalScroll","KurvaSChart","useIdealCurve","steepnessFactor","smoothCurves","showArea","GanttChart","viewMode","enableThemeObserver","update","_validateRowTotalsBeforeSave","success","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","createElement","appendChild","add","remove","_buildTimeColumns","tahap","index","rawId","id","fieldId","replace","nama","name","order","urutan","startDate","tanggal_mulai","start_date","endDate","tanggal_selesai","end_date","isAutoGenerated","is_auto_generated","generation_mode","columns","key","_fetchJson","_0","url","errorText","displayColumns","updateData","tree","updateTopScrollMetrics","scrollTop","scrollInner","requestAnimationFrame","width","scrollWidth","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","from","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","pekerjaan_id","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","call","_calculateRowTotalPercent","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","refreshCells","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","node","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","find","percentViolations","push","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","combined","concat","messages","slice","join","pekerjaanCount","modifiedCount","totalProgress","_calculateProjectProgress","maximumFractionDigits","aggregate","avg","round","pekerjaanTotals","split","numericValue","sum","_buildAssignmentsPayload","assignments","columnIndex","_parseCellKey","columnMeta","proportion","tahapan_id","_getSaveMode","fallback","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","rangeLabel","endLabel","tooltip","childColumns","separatorIndex","indexOf","cookieValue","cookie","cookies","trim","substring","decodeURIComponent","displayValue","isVolumeMode","validation","columnId","normalizedValue","modeState","resolvedPekerjaanId","destroy","readyState"],"mappings":"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"}