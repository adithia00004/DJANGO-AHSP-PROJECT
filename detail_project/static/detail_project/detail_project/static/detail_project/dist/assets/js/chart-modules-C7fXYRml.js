var t=Object.defineProperty,e=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=Math.pow,o=(e,l,n)=>l in e?t(e,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[l]=n,r=(t,e)=>{for(var l in e||(e={}))i.call(e,l)&&o(t,l,e[l]);if(n)for(var l of n(e))s.call(e,l)&&o(t,l,e[l]);return t},u=(t,n)=>e(t,l(n)),c=(t,e,l)=>new Promise((n,i)=>{var s=t=>{try{o(l.next(t))}catch(e){i(e)}},a=t=>{try{o(l.throw(t))}catch(e){i(e)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(s,a);o((l=l.apply(t,e)).next())});import"./core-modules-BVA9karD.js";class h{constructor(t){var e,l,n,i,s;this.tableManager=t,this.debug=Boolean((null==(l=null==(e=this.tableManager)?void 0:e.options)?void 0:l.debugUnifiedTable)||(null==(i=null==(n=this.tableManager)?void 0:n.state)?void 0:i.debugUnifiedTable)||window.DEBUG_UNIFIED_TABLE),this.canvas=document.createElement("canvas"),this.canvas.className="gantt-canvas-overlay",this.canvas.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 1;\n    ",this.ctx=this.canvas.getContext("2d"),this.mask=document.createElement("div"),this.mask.className="gantt-overlay-mask",this.mask.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: none;\n      z-index: 10;\n      background: var(--grid-frozen-bg, var(--bs-body-bg));\n    ",this.visible=!1,this.barData=[],this.dependencies=[],this.barRects=[],this.tooltip=null,this.pinnedWidth=0,this.scrollLeft=0,this._syncScheduled=!1,this.lastDrawMetrics={barsDrawn:0,barsSkipped:0};const a=null==(s=this.tableManager)?void 0:s.bodyScroll;a&&a.addEventListener("scroll",()=>{this.visible&&(this._updateTransform(),this._syncScheduled||(this._syncScheduled=!0,requestAnimationFrame(()=>{this._syncScheduled=!1,this.syncWithTable()})))},{passive:!0}),this._bindPointerEvents()}show(){var t;if(this.visible)return;const e=null==(t=this.tableManager)?void 0:t.bodyScroll;if(!e)return;e.style.position=e.style.position||"relative",e.style.overflow="auto";const l=e.parentElement;l&&(l.style.overflow="hidden",l.style.position="relative"),this._updatePinnedClip(),this.mask.parentNode||e.appendChild(this.mask),e.appendChild(this.canvas),this.visible=!0,console.log("[GanttOverlay] âœ… OVERLAY SHOWN - Canvas clipping enabled to prevent overflow"),this._log("show"),this.syncWithTable()}hide(){this.visible&&(this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.mask.parentNode&&this.mask.parentNode.removeChild(this.mask),this.visible=!1,this._log("hide"),this._hideTooltip())}_updateTransform(){var t;const e=null==(t=this.tableManager)?void 0:t.bodyScroll;e&&(this.scrollLeft=e.scrollLeft||0,this.canvas.style.transform=`translateX(${this.scrollLeft}px)`)}syncWithTable(){var t;const e=null==(t=this.tableManager)?void 0:t.bodyScroll;if(!e)return;this._updatePinnedClip(),this.scrollLeft=e.scrollLeft||0;const l=e.clientWidth-this.pinnedWidth;this.canvas.width=Math.min(l,32e3),this.canvas.height=Math.min(e.clientHeight,16e3),this.canvas.style.position="absolute",this.canvas.style.left=`${this.pinnedWidth}px`,this.canvas.style.top="0px",this.canvas.style.transform=`translateX(${this.scrollLeft}px)`,this.mask&&(this.mask.style.display="none");const n="function"==typeof this.tableManager.getCellBoundingRects?this.tableManager.getCellBoundingRects():[];this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.barRects=[],console.log("[GanttOverlay] ðŸ” SYNC DEBUG:",{canvasSize:{w:this.canvas.width,h:this.canvas.height},scrollAreaSize:{w:e.scrollWidth,h:e.scrollHeight},visibleSize:{w:e.clientWidth,h:e.clientHeight},scroll:{left:e.scrollLeft,top:e.scrollTop},cellRects:n.length,bars:this.barData.length}),this._log("sync",{cells:n.length,bars:this.barData.length,deps:this.dependencies.length,size:{w:this.canvas.width,h:this.canvas.height},scroll:{left:e.scrollLeft,top:e.scrollTop}}),this.barData.length>0&&0===n.length&&console.error("[GanttOverlay] Have bar data but no cell rects. Overlay cannot draw bars.",{bars:this.barData.length}),this.debug&&(this.ctx.strokeStyle="#e2e8f0",n.forEach(t=>{const e=t.x-this.pinnedWidth-this.scrollLeft;e<-t.width||e>this.canvas.width||this.ctx.strokeRect(e,t.y,t.width,t.height)})),this._drawBars(n),this._publishMetrics(n,e),this._drawDependencies(n),this.ctx.restore()}renderBars(t){this.barData=Array.isArray(t)?t:[],this._log("renderBars",{bars:this.barData.length}),this.visible&&this.syncWithTable()}renderDependencies(t){this.dependencies=Array.isArray(t)?t:[],this._log("renderDependencies",{deps:this.dependencies.length}),this.visible&&this.syncWithTable()}_updatePinnedClip(){var t,e;const l=null==(t=this.tableManager)?void 0:t.bodyScroll,n="function"==typeof(null==(e=this.tableManager)?void 0:e.getPinnedColumnsWidth)&&Number(this.tableManager.getPinnedColumnsWidth())||0;return this.pinnedWidth=Math.max(0,n),this.canvas.style.clipPath="",this.canvas.style.webkitClipPath="",(null==l?void 0:l.style)&&l.style.setProperty("--gantt-overlay-pinned-width",`${this.pinnedWidth}px`),this._log("clip",{pinnedWidth:this.pinnedWidth}),this.pinnedWidth}_publishMetrics(t,e){const l="number"==typeof(null==e?void 0:e.scrollLeft)?e.scrollLeft:0,n="number"==typeof(null==e?void 0:e.clientWidth)?e.clientWidth:0,i=n?l+n:null,s={timestamp:Date.now(),pinnedWidth:this.pinnedWidth,clipLeft:Math.max(this.pinnedWidth,l),viewportLeft:l,viewportWidth:n,viewportRight:i,scrollWidth:(null==e?void 0:e.scrollWidth)||0,scrollHeight:(null==e?void 0:e.scrollHeight)||0,barsDrawn:this.lastDrawMetrics.barsDrawn||0,barsSkipped:this.lastDrawMetrics.barsSkipped||0,cellRects:Array.isArray(t)?t.length:0};return"undefined"!=typeof window&&(window.GanttOverlayMetrics=s),this._log("metrics",s),s}_drawBars(t){var e;if(!Array.isArray(t)||0===t.length||0===this.barData.length)return void(this.lastDrawMetrics={barsDrawn:0,barsSkipped:0});const l=null==(e=this.tableManager)?void 0:e.bodyScroll,n="number"==typeof(null==l?void 0:l.scrollLeft)?l.scrollLeft:0,i="number"==typeof(null==l?void 0:l.clientWidth)?l.clientWidth:0,s=i?n+i:null,a=Math.max(this.pinnedWidth,n),o=new Map;t.forEach(t=>{const e=String(t.pekerjaanId);o.has(e)||o.set(e,[]),o.get(e).push(t)}),o.forEach(t=>t.sort((t,e)=>t.x-e.x));const r=new Map;this.barData.forEach(t=>{const e=String(t.pekerjaanId);r.has(e)||r.set(e,[]),r.get(e).push(t)});let u=0,c=0;r.forEach((t,e)=>{const l=o.get(e)||[],n=new Map(l.map(t=>[String(t.columnId),t]));t.forEach(t=>{const e=n.get(String(t.columnId));if(!e)return void(c+=1);if(e.x+e.width<=a||null!==s&&e.x>=s)return void(c+=1);const l=e.width-0,i=e.x-this.pinnedWidth-this.scrollLeft+0,o=e.y+2;if(i<-e.width||i>this.canvas.width)return void(c+=1);const r=Math.max(8,e.height-4),h=r/2,d=Number.isFinite(t.planned)?Math.max(0,Math.min(100,t.planned)):0,f=Number.isFinite(t.actual)?Math.max(0,Math.min(100,t.actual)):Math.max(0,Math.min(100,t.value||0)),p=l>0&&d>0?l:0;this.ctx.fillStyle=this._getPlannedColor(),p>0&&this.ctx.fillRect(i,o+h,p,h-1);const m=l>0&&f>0?l:0,g=t.color||this._resolveActualColor(t.variance);this.ctx.fillStyle=g,m>0&&this.ctx.fillRect(i,o,m,h-1),this.barRects.push({x:i,y:o,width:Math.max(m,p),height:r,pekerjaanId:t.pekerjaanId,columnId:t.columnId,value:f,planned:d,variance:t.variance,label:t.label,color:g}),u+=1})}),this.lastDrawMetrics={barsDrawn:u,barsSkipped:c},this._log("bars:drawn",{drawn:u,skipped:c,total:this.barData.length})}_drawDependencies(t){Array.isArray(t)&&0!==t.length&&0!==this.dependencies.length&&this.dependencies.forEach(e=>{const l=t.find(t=>t.pekerjaanId===e.fromPekerjaanId&&t.columnId===e.fromColumnId),n=t.find(t=>t.pekerjaanId===e.toPekerjaanId&&t.columnId===e.toColumnId);if(!l||!n)return;const i=l.x-this.pinnedWidth-this.scrollLeft+l.width,s=l.y+l.height/2,a=n.x-this.pinnedWidth-this.scrollLeft,o=n.y+n.height/2;this.ctx.strokeStyle=e.color||"#94a3b8",this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.moveTo(i,s),this.ctx.lineTo(a,o),this.ctx.stroke();const r=Math.atan2(o-s,a-i);this.ctx.beginPath(),this.ctx.moveTo(a,o),this.ctx.lineTo(a-5*Math.cos(r-Math.PI/6),o-5*Math.sin(r-Math.PI/6)),this.ctx.lineTo(a-5*Math.cos(r+Math.PI/6),o-5*Math.sin(r+Math.PI/6)),this.ctx.closePath(),this.ctx.fillStyle=e.color||"#94a3b8",this.ctx.fill()})}_resolveVarianceColor(t){return Number.isFinite(t)?t<-.1?"#ef4444":t>.1?"#22c55e":"#3b82f6":"#3b82f6"}_resolveActualColor(t){const e=this._getCssVar("--gantt-actual-fill")||this._getCssVar("--bs-warning")||this._getBtnColor(".progress-mode-tabs .btn-outline-warning")||this._getBtnColor(".progress-mode-tabs .btn-warning");return e||this._resolveVarianceColor(t)}_getPlannedColor(){return this._getCssVar("--gantt-bar-fill")||this._getCssVar("--bs-info")||this._getBtnColor(".progress-mode-tabs .btn-outline-info")||this._getBtnColor(".progress-mode-tabs .btn-info")||"#e2e8f0"}_getCssVar(t){try{const e=document.documentElement,l=getComputedStyle(e).getPropertyValue(t);return l&&l.trim().length?l.trim():null}catch(e){return null}}_getBtnColor(t){var e,l,n;try{const i=document.querySelector(t);if(!i)return null;const s=getComputedStyle(i);return(null==(e=s.getPropertyValue("background-color"))?void 0:e.trim())||(null==(l=s.getPropertyValue("border-color"))?void 0:l.trim())||(null==(n=s.getPropertyValue("color"))?void 0:n.trim())||null}catch(i){return null}}_bindPointerEvents(){this.canvas.addEventListener("mousemove",t=>{if(!this.visible||!this.barRects.length)return;const e=this.canvas.getBoundingClientRect(),l=t.clientX-e.left,n=t.clientY-e.top,i=this._hitTest(l,n);i?this._showTooltip(t.clientX,t.clientY,i):this._hideTooltip()}),this.canvas.addEventListener("mouseleave",()=>{this._hideTooltip()})}_hitTest(t,e){return this.barRects.find(l=>t>=l.x&&t<=l.x+l.width&&e>=l.y&&e<=l.y+l.height)}_ensureTooltip(){return this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="gantt-overlay-tooltip",this.tooltip.style.cssText="\n      position: fixed;\n      padding: 4px 8px;\n      background: rgba(17,24,39,0.85);\n      color: #f8fafc;\n      border-radius: 4px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: 20;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.25);\n    ",document.body.appendChild(this.tooltip)),this.tooltip}_showTooltip(t,e,l){const n=this._ensureTooltip(),i=l.label||l.pekerjaanId,s=Number.isFinite(l.planned)?`${l.planned}%`:"-",a=Number.isFinite(l.value)?`${l.value}%`:"-",o=Number.isFinite(l.variance)?`${l.variance}%`:"-";n.innerHTML=`Pekerjaan: ${i}<br/>Kolom: ${l.columnId}<br/>Planned: ${s}<br/>Actual: ${a}<br/>Variance: ${o}`,n.style.left=`${t+10}px`,n.style.top=`${e+10}px`,n.style.display="block"}_hideTooltip(){this.tooltip&&(this.tooltip.style.display="none")}_log(t,e){this.debug&&console.log(`[GanttOverlay] ${t}`,e||{})}}function d(t){if(!t)return null;if(t instanceof Date)return Number.isNaN(t.getTime())?null:t;if("string"==typeof t){const e=new Date(t);return Number.isNaN(e.getTime())?null:e}if("number"==typeof t&&Number.isFinite(t)){const e=new Date(t);return Number.isNaN(e.getTime())?null:e}return null}function f(t,e,l=1){const n=[String(e),String(Number(e))];for(const i of n)if(t.has(i))return t.get(i);return l}function p(t,e,l=0){const n=[String(e),String(Number(e))];for(const i of n)if(t.has(i))return t.get(i);return l}function m(t){console.warn("[chart-utils] buildCellValueMap() is deprecated. Use StateManager.getAllCellsForMode() instead.");const e=new Map,l=(t,l)=>{const n=parseFloat(l);e.set(String(t),Number.isFinite(n)?n:0)};return t.assignmentMap instanceof Map?t.assignmentMap.forEach((t,e)=>l(e,t)):t.assignmentMap&&"object"==typeof t.assignmentMap&&Object.entries(t.assignmentMap).forEach(([t,e])=>l(t,e)),t.modifiedCells instanceof Map?t.modifiedCells.forEach((t,e)=>l(e,t)):t.modifiedCells&&"object"==typeof t.modifiedCells&&Object.entries(t.modifiedCells).forEach(([t,e])=>l(t,e)),e}function g(t,e){const l=new Set;return Array.isArray(t.flatPekerjaan)&&t.flatPekerjaan.forEach(t=>{!t||"pekerjaan"!==t.type&&void 0!==t.type||l.add(String(t.id))}),e.forEach((t,e)=>{const[n]=String(e).split("-");n&&l.add(n)}),l}function b(t,e=1){if(!Number.isFinite(t))return"0%";return`${0===e?Math.round(t):parseFloat(t.toFixed(e))}%`}function v(t){if(!Number.isFinite(t))return"Rp 0";return`Rp ${Math.round(t).toLocaleString("id-ID")}`}function w(t){if(!t||!Array.isArray(t.labels)||0===t.labels.length)return t;const e=String(t.labels[0]||"").toLowerCase();if(e.includes("week 0")||"w0"===e)return t;const l="cost"===t.viewMode?"W0":"Week 0",n=Array.isArray(t.planned)?t.planned:[],i=Array.isArray(t.actual)?t.actual:[],s=u(r({},t),{labels:[l,...t.labels],planned:[0,...n],actual:[0,...i]});return Array.isArray(t.acSeries)&&(s.acSeries=[0,...t.acSeries]),s.details=function(t,e,l){if(Array.isArray(t))return[{label:e,planned:0,actual:0,variance:0,start:null,end:null,tooltip:e},...t];if(l&&t&&"object"==typeof t){const e={week_number:0,week_start:null,week_end:null,cost:0,cumulative_cost:0,cumulative_percent:0,pekerjaan_breakdown:{}};return u(r({},t),{weeks:Array.isArray(t.weeks)?[e,...t.weeks]:t.weeks,actualWeeks:Array.isArray(t.actualWeeks)?[e,...t.actualWeeks]:t.actualWeeks})}return t}(t.details,l,"cost"===t.viewMode),s}const y="[KurvaSDataset]";function x(t){const e=function(t){return Array.isArray(t)?t.slice().sort((t,e)=>{const l=d(t.startDate),n=d(e.startDate);return l&&n?l.getTime()-n.getTime():(t.index||0)-(e.index||0)}):[]}(null==t?void 0:t.timeColumns);if(!e||0===e.length)return console.warn(y,"No time columns available"),null;const l=function(t){const e=new Map,l=(t,l)=>{const n=Number(t),i=Number.isFinite(l)&&l>0?l:null;null!==i&&(e.set(String(t),i),Number.isNaN(n)||e.set(String(n),i))};return t.volumeMap instanceof Map?t.volumeMap.forEach((t,e)=>{const n=parseFloat(t);l(e,n)}):t.volumeMap&&"object"==typeof t.volumeMap&&Object.entries(t.volumeMap).forEach(([t,e])=>{const n=parseFloat(e);l(t,n)}),e}(t),n=function(t){const e=new Map,l=(t,l)=>{const n=Number(t),i=Number.isFinite(l)&&l>=0?l:null;null!==i&&(e.set(String(t),i),Number.isNaN(n)||e.set(String(n),i))};return t.hargaMap instanceof Map?t.hargaMap.forEach((t,e)=>{const n=parseFloat(t);l(e,n)}):t.hargaMap&&"object"==typeof t.hargaMap&&Object.entries(t.hargaMap).forEach(([t,e])=>{const n=parseFloat(e);l(t,n)}),e}(t),i=null==t?void 0:t.stateManager;let s,a;if(i)s=i.getAllCellsForMode("planned")||new Map,a=i.getAllCellsForMode("actual")||new Map;else{const e=(null==t?void 0:t.plannedState)||t,l=(null==t?void 0:t.actualState)||t;s=m(e),a=m(l)}s&&s instanceof Map||(s=new Map),a&&a instanceof Map||(a=new Map);const o=new Set([...g(t,s),...g(t,a)]);let r=parseFloat((null==t?void 0:t.totalBiayaProject)||0);(!r||r<=0)&&o.forEach(t=>{r+=p(n,t,0)});const u=r>0&&n.size>0;let c=0;u||(o.forEach(t=>{c+=f(l,t,1)}),(!Number.isFinite(c)||c<=0)&&(c=o.size||1));const h=new Map;e.forEach((t,e)=>{h.set(String(t.id),e)});const b=function(t){return t.map((t,e)=>{const l=(null==t?void 0:t.label)||(null==t?void 0:t.displayLabel)||(null==t?void 0:t.display_name)||(null==t?void 0:t.name)||`Week ${e+1}`;return(null==t?void 0:t.start_date)&&(null==t?void 0:t.end_date)?`${l} (${t.start_date} - ${t.end_date})`:l})}(e),v=function(t,e,l,n,i,s,a){const o=Array(t.length).fill(0);n.forEach((t,n)=>{const[i,r]=n.split("-");if(!s.has(r))return;const u=s.get(r);if(void 0===u)return;const c=Number(t)||0;if(a){const t=p(l,i,0)*c/100;o[u]+=t}else{const t=f(e,i,1)*c/100;o[u]+=t}});let r=0;return o.map(t=>(r+=t,!Number.isFinite(i)||i<=0?0:Number((r/i*100).toFixed(2))))}(e,l,n,s,u?r:c,h,u),x=function(t,e,l,n,i,s){const a=Array(t.length).fill(0);return e.forEach((t,e)=>{const[o,r]=e.split("-"),u=i.get(r);if(void 0===u)return;const c=Number(t)||0;if(s){const t=p(n,o,0)*c/100;a[u]+=t}else{const t=f(l,o,1)*c/100;a[u]+=t}}),a}(e,a,l,n,h,u),_=function(t,e,l){let n=0;return t.map((t,i)=>(n+=e[i]||0,!Number.isFinite(l)||l<=0?0:Number((n/l*100).toFixed(2))))}(e,x,u?r:c),k=function(t,e,l,n,i=0,s=!1){return t.map((t,a)=>{const o=e[a]||`Week ${a+1}`,r=l[a]||0,u=n[a]||0,c=Number((u-r).toFixed(2));let h=null,f=null,p=null;return s&&(h=Number((r/100*(i||0)).toFixed(2)),f=Number((u/100*(i||0)).toFixed(2)),p=Number((f-h).toFixed(2))),{label:o,planned:r,actual:u,variance:c,start:d((null==t?void 0:t.startDate)||(null==t?void 0:t.start_date)||(null==t?void 0:t.start)),end:d((null==t?void 0:t.endDate)||(null==t?void 0:t.end_date)||(null==t?void 0:t.end)),metadata:t,plannedCostValue:h,actualCostValue:f,varianceCostValue:p}})}(e,b,v,_,u?r:c,u);return w({labels:b,planned:v,actual:_,details:k,totalVolume:c,totalBiaya:r,columnTotals:x,useHargaCalculation:u,viewMode:"progress"})}function _(t){var e;if(!t)return console.error(y,"No cost data available"),null;const l=t.weeklyData||{},n=t.summary||{},i=t.evm;if(i&&Array.isArray(i.labels)&&i.labels.length>0){const t=(null==(e=i.summary)?void 0:e.bac)||(null==n?void 0:n.total_project_cost)||0,s=k((null==l?void 0:l.planned)||[],(null==l?void 0:l.actual)||[],t,i.labels),a=i.pv_percent||[],o=i.ev_percent||[],r=i.ac_percent||o,u=a.map((t,e)=>Number(((r[e]||o[e]||0)-(t||0)).toFixed(2))),c=s.map(t=>t.varianceCostValue||0);return w({labels:i.labels,planned:a,actual:o,acSeries:r,varianceSeries:u,varianceCostSeries:c,details:{totalCost:t,weeks:(null==l?void 0:l.planned)||[],actualWeeks:(null==l?void 0:l.actual)||[],weeklySummary:s,evmSummary:i.summary,evm:i},evm:i,totalBiaya:t,useHargaCalculation:!0,viewMode:"cost"})}const s=(l.planned||[]).map(t=>`W${t.week_number}`),a=(l.planned||[]).map(t=>t.cumulative_percent),o=(l.actual||[]).map(t=>t.cumulative_percent),c=o.length?o:(l.earned||[]).map(t=>t.cumulative_percent),h=a.map((t,e)=>Number(((c[e]||o[e]||0)-(t||0)).toFixed(2))),d={totalCost:(null==n?void 0:n.total_project_cost)||0,plannedCost:(null==n?void 0:n.planned_cost)||0,actualCost:(null==n?void 0:n.actual_cost)||0,weeks:l.planned||[],actualWeeks:l.actual||[],viewMode:"cost"},f=k(l.planned||[],l.actual||[],d.totalCost,s);return console.log(y,"Cost dataset built:",{labels:s.length,plannedPoints:a.length,actualPoints:o.length,totalCost:v(d.totalCost)}),w({labels:s,planned:a,actual:o,acSeries:c,varianceSeries:h,varianceCostSeries:f.map(t=>t.varianceCostValue||0),details:u(r({},d),{weeklySummary:f}),totalBiaya:d.totalCost,useHargaCalculation:!0,viewMode:"cost"})}function k(t=[],e=[],l=0,n=[]){var i,s,a,o,r,u,c,h,f,p;const m=Math.max(t.length,e.length,n.length),g=[];for(let b=0;b<m;b+=1){const m=t[b]||{},v=e[b]||{},w=n[b]||m.label||v.label||`W${m.week_number||v.week_number||b+1}`,y=Number(null!=(o=null!=(a=null!=(s=null!=(i=m.cumulative_percent)?i:m.percent)?s:m.value)?a:m.cumulative)?o:0),x=Number(null!=(h=null!=(c=null!=(u=null!=(r=v.cumulative_percent)?r:v.percent)?u:v.value)?c:v.cumulative)?h:0),_=M(m,y,l),k=M(v,x,l),S=Number((x-y).toFixed(2)),C=Number((k-_).toFixed(2));g.push({label:w,weekNumber:null!=(p=null!=(f=m.week_number)?f:v.week_number)?p:b+1,plannedPercent:Number.isFinite(y)?y:0,actualPercent:Number.isFinite(x)?x:0,plannedCostValue:_,actualCostValue:k,variancePercent:S,varianceCostValue:C,range:{start:d(m.week_start||m.start_date||v.week_start||v.start_date),end:d(m.week_end||m.end_date||v.week_end||v.end_date)}})}return g}function M(t,e,l){var n,i,s,a,o,r;const u=Number(null!=(s=null!=(i=null!=(n=null!=e?e:null==t?void 0:t.cumulative_percent)?n:null==t?void 0:t.percent)?i:null==t?void 0:t.value)?s:0),c=S(null!=(r=null!=(o=null!=(a=null==t?void 0:t.cumulative_cost)?a:null==t?void 0:t.cumulative)?o:null==t?void 0:t.accumulated_cost)?r:null==t?void 0:t.acc_cost);if(Number.isFinite(c)&&c>0)return c;const h=S(null==t?void 0:t.cost);return Number.isFinite(h)&&h>0&&!(null==t?void 0:t.cumulative_cost)?h:!Number.isFinite(l)||l<=0?0:Number(((u||0)/100*l).toFixed(2))}function S(t){if("number"==typeof t)return t;if("string"==typeof t){const e=Number(t);return Number.isFinite(e)?e:NaN}return NaN}const C=Object.freeze(Object.defineProperty({__proto__:null,buildCostDataset:_,buildProgressDataset:x},Symbol.toStringTag,{value:"Module"}));class T{constructor(){this.shortcuts=new Map,this.enabled=!0,this._boundHandler=this._handleKeyDown.bind(this),this.init()}init(){document.addEventListener("keydown",this._boundHandler),console.log("âŒ¨ï¸ Keyboard shortcuts initialized")}register(t,e,l={}){const{description:n="",preventDefault:i=!0}=l;this.shortcuts.set(t.toLowerCase(),{callback:e,description:n,preventDefault:i})}unregister(t){this.shortcuts.delete(t.toLowerCase())}_handleKeyDown(t){if(!this.enabled)return;const e=document.activeElement,l="INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable,n=[];t.ctrlKey&&n.push("ctrl"),t.altKey&&n.push("alt"),t.shiftKey&&n.push("shift"),t.metaKey&&n.push("meta");const i=t.key.toLowerCase();["control","alt","shift","meta"].includes(i)||n.push(i);const s=n.join("+"),a=this.shortcuts.get(s);if(a){if(l&&!["ctrl+a","ctrl+c","ctrl+v","ctrl+x","ctrl+z"].includes(s))return;a.preventDefault&&t.preventDefault(),a.callback(t),console.log(`âŒ¨ï¸ Shortcut triggered: ${s}`)}}enable(){this.enabled=!0}disable(){this.enabled=!1}getShortcuts(){return Array.from(this.shortcuts.entries()).map(([t,e])=>({key:t,description:e.description}))}destroy(){document.removeEventListener("keydown",this._boundHandler),this.shortcuts.clear()}}class D{static add(t){t&&(t.classList.add("btn-ripple"),t.addEventListener("click",function(t){const e=document.createElement("span");e.classList.add("ripple-circle");const l=this.getBoundingClientRect(),n=Math.max(l.width,l.height),i=t.clientX-l.left-n/2,s=t.clientY-l.top-n/2;e.style.width=e.style.height=n+"px",e.style.left=i+"px",e.style.top=s+"px",this.appendChild(e),setTimeout(()=>e.remove(),600)}))}static addToAll(t){document.querySelectorAll(t).forEach(t=>{D.add(t)})}}class A{static setLoading(t,e="Loading..."){if(!t)return;t.dataset.originalText=t.innerHTML,t.disabled=!0,t.classList.add("loading");t.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+e}static setSuccess(t,e=2e3){t&&(t.disabled=!1,t.classList.remove("loading"),t.classList.add("success"),t.dataset.originalText&&(t.innerHTML=t.dataset.originalText),setTimeout(()=>{t.classList.remove("success")},e))}static setError(t,e=2e3){t&&(t.disabled=!1,t.classList.remove("loading"),t.classList.add("error"),t.dataset.originalText&&(t.innerHTML=t.dataset.originalText),setTimeout(()=>{t.classList.remove("error")},e))}static reset(t){t&&(t.disabled=!1,t.classList.remove("loading","success","error"),t.dataset.originalText&&(t.innerHTML=t.dataset.originalText))}static markChanges(t,e){t&&(e?(t.classList.add("has-changes"),t.setAttribute("data-tooltip","You have unsaved changes")):(t.classList.remove("has-changes"),t.removeAttribute("data-tooltip")))}}class E{static success(t,e=1600){var l,n;(null==(n=null==(l=window.DP)?void 0:l.core)?void 0:n.toast)?window.DP.core.toast.show(t,"success",e):console.log(`âœ… ${t}`)}static error(t,e=3e3){var l,n;(null==(n=null==(l=window.DP)?void 0:l.core)?void 0:n.toast)?window.DP.core.toast.show(t,"danger",e):console.error(`âŒ ${t}`)}static warning(t,e=2e3){var l,n;(null==(n=null==(l=window.DP)?void 0:l.core)?void 0:n.toast)?window.DP.core.toast.show(t,"warning",e):console.warn(`âš ï¸ ${t}`)}static info(t,e=1600){var l,n;(null==(n=null==(l=window.DP)?void 0:l.core)?void 0:n.toast)?window.DP.core.toast.show(t,"info",e):console.info(`â„¹ï¸ ${t}`)}}function N(){console.log("ðŸŽ¨ Initializing UX enhancements..."),D.addToAll(".btn-primary, .btn-save, .btn-danger"),document.querySelectorAll("button[title]").forEach(t=>{t.hasAttribute("data-tooltip")||t.setAttribute("data-tooltip",t.getAttribute("title"))}),console.log("âœ… UX enhancements initialized")}const P="u-off",L="u-label",z="width",F="height",W="top",I="bottom",$="left",V="right",j="#000",O=j+"0",R="mousemove",H="mousedown",B="mouseup",Y="mouseenter",G="mouseleave",U="dblclick",K="change",X="dppxchange",q="--",J="undefined"!=typeof window,Z=J?document:null,Q=J?window:null,tt=J?navigator:null;let et,lt;function nt(t,e){if(null!=e){let l=t.classList;!l.contains(e)&&l.add(e)}}function it(t,e){let l=t.classList;l.contains(e)&&l.remove(e)}function st(t,e,l){t.style[e]=l+"px"}function at(t,e,l,n){let i=Z.createElement(t);return null!=e&&nt(i,e),null!=l&&l.insertBefore(i,n),i}function ot(t,e){return at("div",t,e)}const rt=new WeakMap;function ut(t,e,l,n,i){let s="translate("+e+"px,"+l+"px)";s!=rt.get(t)&&(t.style.transform=s,rt.set(t,s),e<0||l<0||e>n||l>i?nt(t,P):it(t,P))}const ct=new WeakMap;function ht(t,e,l){let n=e+l;n!=ct.get(t)&&(ct.set(t,n),t.style.background=e,t.style.borderColor=l)}const dt=new WeakMap;function ft(t,e,l,n){let i=e+""+l;i!=dt.get(t)&&(dt.set(t,i),t.style.height=l+"px",t.style.width=e+"px",t.style.marginLeft=n?-e/2+"px":0,t.style.marginTop=n?-l/2+"px":0)}const pt={passive:!0},mt=u(r({},pt),{capture:!0});function gt(t,e,l,n){e.addEventListener(t,l,n?mt:pt)}function bt(t,e,l,n){e.removeEventListener(t,l,pt)}function vt(t,e,l,n){let i;l=l||0;let s=(n=n||e.length-1)<=2147483647;for(;n-l>1;)i=s?l+n>>1:It((l+n)/2),e[i]<t?l=i:n=i;return t-e[l]<=e[n]-t?l:n}function wt(t){return(e,l,n)=>{let i=-1,s=-1;for(let a=l;a<=n;a++)if(t(e[a])){i=a;break}for(let a=n;a>=l;a--)if(t(e[a])){s=a;break}return[i,s]}}J&&function t(){let e=devicePixelRatio;et!=e&&(et=e,lt&&bt(K,lt,t),lt=matchMedia(`(min-resolution: ${et-.001}dppx) and (max-resolution: ${et+.001}dppx)`),gt(K,lt,t),Q.dispatchEvent(new CustomEvent(X)))}();const yt=t=>null!=t,xt=t=>null!=t&&t>0,_t=wt(yt),kt=wt(xt);function Mt(t,e,l,n){let i=Ht(t),s=Ht(e);t==e&&(-1==i?(t*=l,e/=l):(t/=l,e*=l));let a=10==l?Bt:Yt,o=1==s?Vt:It,r=(1==i?It:Vt)(a(Wt(t))),u=o(a(Wt(e))),c=Rt(l,r),h=Rt(l,u);return 10==l&&(r<0&&(c=re(c,-r)),u<0&&(h=re(h,-u))),n||2==l?(t=c*i,e=h*s):(t=oe(t,c),e=ae(e,h)),[t,e]}function St(t,e,l,n){let i=Mt(t,e,l,n);return 0==t&&(i[0]=0),0==e&&(i[1]=0),i}const Ct={mode:3,pad:.1},Tt={pad:0,soft:null,mode:0},Dt={min:Tt,max:Tt};function At(t,e,l,n){return ve(l)?Nt(t,e,l):(Tt.pad=l,Tt.soft=n?0:null,Tt.mode=n?3:0,Nt(t,e,Dt))}function Et(t,e){return null==t?e:t}function Nt(t,e,l){let n=l.min,i=l.max,s=Et(n.pad,0),a=Et(i.pad,0),o=Et(n.hard,-Ut),r=Et(i.hard,Ut),u=Et(n.soft,Ut),c=Et(i.soft,-Ut),h=Et(n.mode,0),d=Et(i.mode,0),f=e-t,p=Bt(f),m=Ot(Wt(t),Wt(e)),g=Bt(m),b=Wt(g-p);(f<1e-24||b>10)&&(f=0,0!=t&&0!=e||(f=1e-24,2==h&&u!=Ut&&(s=0),2==d&&c!=-Ut&&(a=0)));let v=f||m||1e3,w=Bt(v),y=Rt(10,It(w)),x=re(oe(t-v*(0==f?0==t?.1:1:s),y/10),24),_=t>=u&&(1==h||3==h&&x<=u||2==h&&x>=u)?u:Ut,k=Ot(o,x<_&&t>=_?_:jt(_,x)),M=re(ae(e+v*(0==f?0==e?.1:1:a),y/10),24),S=e<=c&&(1==d||3==d&&M>=c||2==d&&M<=c)?c:-Ut,C=jt(r,M>S&&e<=S?S:Ot(S,M));return k==C&&0==k&&(C=100),[k,C]}const Pt=new Intl.NumberFormat(J?tt.language:"en-US"),Lt=t=>Pt.format(t),zt=Math,Ft=zt.PI,Wt=zt.abs,It=zt.floor,$t=zt.round,Vt=zt.ceil,jt=zt.min,Ot=zt.max,Rt=zt.pow,Ht=zt.sign,Bt=zt.log10,Yt=zt.log2,Gt=(t,e=1)=>zt.asinh(t/e),Ut=1/0;function Kt(t){return 1+(0|Bt((t^t>>31)-(t>>31)))}function Xt(t,e,l){return jt(Ot(t,e),l)}function qt(t){return"function"==typeof t}function Jt(t){return qt(t)?t:()=>t}const Zt=t=>t,Qt=(t,e)=>e,te=t=>null,ee=t=>!0,le=(t,e)=>t==e,ne=/\.\d*?(?=9{6,}|0{6,})/gm,ie=t=>{if(ge(t)||ue.has(t))return t;const e=`${t}`,l=e.match(ne);if(null==l)return t;let n=l[0].length-1;if(-1!=e.indexOf("e-")){let[t,l]=e.split("e");return+`${ie(t)}e${l}`}return re(t,n)};function se(t,e){return ie(re(ie(t/e))*e)}function ae(t,e){return ie(Vt(ie(t/e))*e)}function oe(t,e){return ie(It(ie(t/e))*e)}function re(t,e=0){if(ge(t))return t;let l=a(10,e),n=t*l*(1+Number.EPSILON);return $t(n)/l}const ue=new Map;function ce(t){return((""+t).split(".")[1]||"").length}function he(t,e,l,n){let i=[],s=n.map(ce);for(let a=e;a<l;a++){let e=Wt(a),l=re(Rt(t,a),e);for(let o=0;o<n.length;o++){let r=10==t?+`${n[o]}e${a}`:n[o]*l,u=(a>=0?0:e)+(a>=s[o]?0:s[o]),c=10==t?r:re(r,u);i.push(c),ue.set(c,u)}}return i}const de={},fe=[],pe=[null,null],me=Array.isArray,ge=Number.isInteger;function be(t){return"string"==typeof t}function ve(t){let e=!1;if(null!=t){let l=t.constructor;e=null==l||l==Object}return e}function we(t){return null!=t&&"object"==typeof t}const ye=Object.getPrototypeOf(Uint8Array),xe="__proto__";function _e(t,e=ve){let l;if(me(t)){let n=t.find(t=>null!=t);if(me(n)||e(n)){l=Array(t.length);for(let n=0;n<t.length;n++)l[n]=_e(t[n],e)}else l=t.slice()}else if(t instanceof ye)l=t.slice();else if(e(t)){l={};for(let n in t)n!=xe&&(l[n]=_e(t[n],e))}else l=t;return l}function ke(t){let e=arguments;for(let l=1;l<e.length;l++){let n=e[l];for(let e in n)e!=xe&&(ve(t[e])?ke(t[e],_e(n[e])):t[e]=_e(n[e]))}return t}function Me(t,e,l){for(let n,i=0,s=-1;i<e.length;i++){let a=e[i];if(a>s){for(n=a-1;n>=0&&null==t[n];)t[n--]=null;for(n=a+1;n<l&&null==t[n];)t[s=n++]=null}}}const Se="undefined"==typeof queueMicrotask?t=>Promise.resolve().then(t):queueMicrotask;const Ce=["January","February","March","April","May","June","July","August","September","October","November","December"],Te=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function De(t){return t.slice(0,3)}const Ae=Te.map(De),Ee=Ce.map(De),Ne={MMMM:Ce,MMM:Ee,WWWW:Te,WWW:Ae};function Pe(t){return(t<10?"0":"")+t}const Le={YYYY:t=>t.getFullYear(),YY:t=>(t.getFullYear()+"").slice(2),MMMM:(t,e)=>e.MMMM[t.getMonth()],MMM:(t,e)=>e.MMM[t.getMonth()],MM:t=>Pe(t.getMonth()+1),M:t=>t.getMonth()+1,DD:t=>Pe(t.getDate()),D:t=>t.getDate(),WWWW:(t,e)=>e.WWWW[t.getDay()],WWW:(t,e)=>e.WWW[t.getDay()],HH:t=>Pe(t.getHours()),H:t=>t.getHours(),h:t=>{let e=t.getHours();return 0==e?12:e>12?e-12:e},AA:t=>t.getHours()>=12?"PM":"AM",aa:t=>t.getHours()>=12?"pm":"am",a:t=>t.getHours()>=12?"p":"a",mm:t=>Pe(t.getMinutes()),m:t=>t.getMinutes(),ss:t=>Pe(t.getSeconds()),s:t=>t.getSeconds(),fff:t=>{return((e=t.getMilliseconds())<10?"00":e<100?"0":"")+e;var e}};function ze(t,e){e=e||Ne;let l,n=[],i=/\{([a-z]+)\}|[^{]+/gi;for(;l=i.exec(t);)n.push("{"==l[0][0]?Le[l[1]]:l[0]);return t=>{let l="";for(let i=0;i<n.length;i++)l+="string"==typeof n[i]?n[i]:n[i](t,e);return l}}const Fe=(new Intl.DateTimeFormat).resolvedOptions().timeZone;const We=t=>t%1==0,Ie=[1,2,2.5,5],$e=he(10,-32,0,Ie),Ve=he(10,0,32,Ie),je=Ve.filter(We),Oe=$e.concat(Ve),Re="{YYYY}",He="\n"+Re,Be="{M}/{D}",Ye="\n"+Be,Ge=Ye+"/{YY}",Ue="{aa}",Ke="{h}:{mm}"+Ue,Xe="\n"+Ke,qe=":{ss}",Je=null;function Ze(t){let e=1e3*t,l=60*e,n=60*l,i=24*n,s=30*i,a=365*i;return[(1==t?he(10,0,3,Ie).filter(We):he(10,-3,0,Ie)).concat([e,5*e,10*e,15*e,30*e,l,5*l,10*l,15*l,30*l,n,2*n,3*n,4*n,6*n,8*n,12*n,i,2*i,3*i,4*i,5*i,6*i,7*i,8*i,9*i,10*i,15*i,s,2*s,3*s,4*s,6*s,a,2*a,5*a,10*a,25*a,50*a,100*a]),[[a,Re,Je,Je,Je,Je,Je,Je,1],[28*i,"{MMM}",He,Je,Je,Je,Je,Je,1],[i,Be,He,Je,Je,Je,Je,Je,1],[n,"{h}"+Ue,Ge,Je,Ye,Je,Je,Je,1],[l,Ke,Ge,Je,Ye,Je,Je,Je,1],[e,qe,Ge+" "+Ke,Je,Ye+" "+Ke,Je,Xe,Je,1],[t,qe+".{fff}",Ge+" "+Ke,Je,Ye+" "+Ke,Je,Xe,Je,1]],function(e){return(o,r,u,c,h,d)=>{let f=[],p=h>=a,m=h>=s&&h<a,g=e(u),b=re(g*t,3),v=ol(g.getFullYear(),p?0:g.getMonth(),m||p?1:g.getDate()),w=re(v*t,3);if(m||p){let l=m?h/s:0,n=p?h/a:0,i=b==w?b:re(ol(v.getFullYear()+n,v.getMonth()+l,1)*t,3),o=new Date($t(i/t)),r=o.getFullYear(),u=o.getMonth();for(let s=0;i<=c;s++){let a=ol(r+n*s,u+l*s,1),o=a-e(re(a*t,3));i=re((+a+o)*t,3),i<=c&&f.push(i)}}else{let s=h>=i?i:h,a=w+(It(u)-It(b))+ae(b-w,s);f.push(a);let p=e(a),m=p.getHours()+p.getMinutes()/l+p.getSeconds()/n,g=h/n,v=d/o.axes[r]._space;for(;a=re(a+h,1==t?0:3),!(a>c);)if(g>1){let t=It(re(m+g,6))%24,l=e(a).getHours()-t;l>1&&(l=-1),a-=l*n,m=(m+g)%24,re((a-f[f.length-1])/h,3)*v>=.7&&f.push(a)}else f.push(a)}return f}}]}const[Qe,tl,el]=Ze(1),[ll,nl,il]=Ze(.001);function sl(t,e){return t.map(t=>t.map((l,n)=>0==n||8==n||null==l?l:e(1==n||0==t[8]?l:t[1]+l)))}function al(t,e){return(l,n,i,s,a)=>{let o,r,u,c,h,d,f=e.find(t=>a>=t[0])||e[e.length-1];return n.map(e=>{let l=t(e),n=l.getFullYear(),i=l.getMonth(),s=l.getDate(),a=l.getHours(),p=l.getMinutes(),m=l.getSeconds(),g=n!=o&&f[2]||i!=r&&f[3]||s!=u&&f[4]||a!=c&&f[5]||p!=h&&f[6]||m!=d&&f[7]||f[1];return o=n,r=i,u=s,c=a,h=p,d=m,g(l)})}}function ol(t,e,l){return new Date(t,e,l)}function rl(t,e){return e(t)}he(2,-53,53,[1]);function ul(t,e){return(l,n,i,s)=>null==s?q:e(t(n))}const cl={show:!0,live:!0,isolate:!1,mount:()=>{},markers:{show:!0,width:2,stroke:function(t,e){let l=t.series[e];return l.width?l.stroke(t,e):l.points.width?l.points.stroke(t,e):null},fill:function(t,e){return t.series[e].fill(t,e)},dash:"solid"},idx:null,idxs:null,values:[]};const hl=[0,0];function dl(t,e,l,n=!0){return t=>{0==t.button&&(!n||t.target==e)&&l(t)}}function fl(t,e,l,n=!0){return t=>{(!n||t.target==e)&&l(t)}}const pl={show:!0,x:!0,y:!0,lock:!1,move:function(t,e,l){return hl[0]=e,hl[1]=l,hl},points:{one:!1,show:function(t,e){let l=t.cursor.points,n=ot(),i=l.size(t,e);st(n,z,i),st(n,F,i);let s=i/-2;st(n,"marginLeft",s),st(n,"marginTop",s);let a=l.width(t,e,i);return a&&st(n,"borderWidth",a),n},size:function(t,e){return t.series[e].points.size},width:0,stroke:function(t,e){let l=t.series[e].points;return l._stroke||l._fill},fill:function(t,e){let l=t.series[e].points;return l._fill||l._stroke}},bind:{mousedown:dl,mouseup:dl,click:dl,dblclick:dl,mousemove:fl,mouseleave:fl,mouseenter:fl},drag:{setScale:!0,x:!0,y:!1,dist:0,uni:null,click:(t,e)=>{e.stopPropagation(),e.stopImmediatePropagation()},_x:!1,_y:!1},focus:{dist:(t,e,l,n,i)=>n-i,prox:-1,bias:0},hover:{skip:[void 0],prox:null,bias:0},left:-10,top:-10,idx:null,dataIdx:null,idxs:null,event:null},ml={show:!0,stroke:"rgba(0,0,0,0.07)",width:2},gl=ke({},ml,{filter:Qt}),bl=ke({},gl,{size:10}),vl=ke({},ml,{show:!1}),wl='12px system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',yl="bold "+wl,xl={show:!0,scale:"x",stroke:j,space:50,gap:5,alignTo:1,size:50,labelGap:0,labelSize:30,labelFont:yl,side:2,grid:gl,ticks:bl,border:vl,font:wl,lineGap:1.5,rotate:0},_l={show:!0,scale:"x",auto:!1,sorted:1,min:Ut,max:-Ut,idxs:[]};function kl(t,e,l,n,i){return e.map(t=>null==t?"":Lt(t))}function Ml(t,e,l,n,i,s,a){let o=[],r=ue.get(i)||0;for(let u=l=a?l:re(ae(l,i),r);u<=n;u=re(u+i,r))o.push(Object.is(u,-0)?0:u);return o}function Sl(t,e,l,n,i,s,a){const o=[],r=t.scales[t.axes[e].scale].log,u=It((10==r?Bt:Yt)(l));i=Rt(r,u),10==r&&(i=Oe[vt(i,Oe)]);let c=l,h=i*r;10==r&&(h=Oe[vt(h,Oe)]);do{o.push(c),c+=i,10!=r||ue.has(c)||(c=re(c,ue.get(i))),c>=h&&(h=(i=c)*r,10==r&&(h=Oe[vt(h,Oe)]))}while(c<=n);return o}function Cl(t,e,l,n,i,s,a){let o=t.scales[t.axes[e].scale].asinh,r=n>o?Sl(t,e,Ot(o,l),n,i):[o],u=n>=0&&l<=0?[0]:[];return(l<-o?Sl(t,e,Ot(o,-n),-l,i):[o]).reverse().map(t=>-t).concat(u,r)}const Tl=/./,Dl=/[12357]/,Al=/[125]/,El=/1/,Nl=(t,e,l,n)=>t.map((t,i)=>4==e&&0==t||i%n==0&&l.test(t.toExponential()[t<0?1:0])?t:null);function Pl(t,e,l,n,i){let s=t.axes[l],a=s.scale,o=t.scales[a],r=t.valToPos,u=s._space,c=r(10,a),h=r(9,a)-c>=u?Tl:r(7,a)-c>=u?Dl:r(5,a)-c>=u?Al:El;if(h==El){let t=Wt(r(1,a)-c);if(t<u)return Nl(e.slice().reverse(),o.distr,h,Vt(u/t)).reverse()}return Nl(e,o.distr,h,1)}function Ll(t,e,l,n,i){let s=t.axes[l],a=s.scale,o=s._space,r=t.valToPos,u=Wt(r(1,a)-r(2,a));return u<o?Nl(e.slice().reverse(),3,Tl,Vt(o/u)).reverse():e}function zl(t,e,l,n){return null==n?q:null==e?"":Lt(e)}const Fl={show:!0,scale:"y",stroke:j,space:30,gap:5,alignTo:1,size:50,labelGap:0,labelSize:30,labelFont:yl,side:3,grid:gl,ticks:bl,border:vl,font:wl,lineGap:1.5,rotate:0};const Wl={scale:null,auto:!0,sorted:0,min:Ut,max:-Ut},Il=(t,e,l,n,i)=>i,$l={show:!0,auto:!0,sorted:0,gaps:Il,alpha:1,facets:[ke({},Wl,{scale:"x"}),ke({},Wl,{scale:"y"})]},Vl={scale:"y",auto:!0,sorted:0,show:!0,spanGaps:!1,gaps:Il,alpha:1,points:{show:function(t,e){let{scale:l,idxs:n}=t.series[0],i=t._data[0],s=t.valToPos(i[n[0]],l,!0),a=t.valToPos(i[n[1]],l,!0),o=Wt(a-s)/(t.series[e].points.space*et);return n[1]-n[0]<=o},filter:null},values:null,min:Ut,max:-Ut,idxs:[],path:null,clip:null};function jl(t,e,l,n,i){return l/10}const Ol={time:!0,auto:!0,distr:1,log:10,asinh:1,min:null,max:null,dir:1,ori:0},Rl=ke({},Ol,{time:!1,ori:1}),Hl={};function Bl(t,e){let l=Hl[t];return l||(l={key:t,plots:[],sub(t){l.plots.push(t)},unsub(t){l.plots=l.plots.filter(e=>e!=t)},pub(t,e,n,i,s,a,o){for(let r=0;r<l.plots.length;r++)l.plots[r]!=e&&l.plots[r].pub(t,e,n,i,s,a,o)}},null!=t&&(Hl[t]=l)),l}function Yl(t,e,l){const n=t.mode,i=t.series[e],s=2==n?t._data[e]:t._data,a=t.scales,o=t.bbox;let r=s[0],u=2==n?s[1]:s[e],c=2==n?a[i.facets[0].scale]:a[t.series[0].scale],h=2==n?a[i.facets[1].scale]:a[i.scale],d=o.left,f=o.top,p=o.width,m=o.height,g=t.valToPosH,b=t.valToPosV;return 0==c.ori?l(i,r,u,c,h,g,b,d,f,p,m,Ql,en,nn,an,rn):l(i,r,u,c,h,b,g,f,d,m,p,tn,ln,sn,on,un)}function Gl(t,e){let l=0,n=0,i=Et(t.bands,fe);for(let s=0;s<i.length;s++){let t=i[s];t.series[0]==e?l=t.dir:t.series[1]==e&&(1==t.dir?n|=1:n|=2)}return[l,1==n?-1:2==n?1:3==n?2:0]}function Ul(t,e,l,n,i){let s=t.mode,a=t.series[e],o=2==s?a.facets[1].scale:a.scale,r=t.scales[o];return-1==i?r.min:1==i?r.max:3==r.distr?1==r.dir?r.min:r.max:0}function Kl(t,e,l,n,i,s){return Yl(t,e,(t,e,a,o,r,u,c,h,d,f,p)=>{let m=t.pxRound;const g=o.dir*(0==o.ori?1:-1),b=0==o.ori?en:ln;let v,w;1==g?(v=l,w=n):(v=n,w=l);let y=m(u(e[v],o,f,h)),x=m(c(a[v],r,p,d)),_=m(u(e[w],o,f,h)),k=m(c(1==s?r.max:r.min,r,p,d)),M=new Path2D(i);return b(M,_,k),b(M,y,k),b(M,y,x),M})}function Xl(t,e,l,n,i,s){let a=null;if(t.length>0){a=new Path2D;const o=0==e?nn:sn;let r=l;for(let e=0;e<t.length;e++){let l=t[e];if(l[1]>l[0]){let t=l[0]-r;t>0&&o(a,r,n,t,n+s),r=l[1]}}let u=l+i-r,c=10;u>0&&o(a,r,n-c/2,u,n+s+c)}return a}function ql(t,e,l,n,i,s,a){let o=[],r=t.length;for(let u=1==i?l:n;u>=l&&u<=n;u+=i){if(null===e[u]){let c=u,h=u;if(1==i)for(;++u<=n&&null===e[u];)h=u;else for(;--u>=l&&null===e[u];)h=u;let d=s(t[c]),f=h==c?d:s(t[h]),p=c-i;d=a<=0&&p>=0&&p<r?s(t[p]):d;let m=h+i;f=a>=0&&m>=0&&m<r?s(t[m]):f,f>=d&&o.push([d,f])}}return o}function Jl(t){return 0==t?Zt:1==t?$t:e=>se(e,t)}function Zl(t){let e=0==t?Ql:tn,l=0==t?(t,e,l,n,i,s)=>{t.arcTo(e,l,n,i,s)}:(t,e,l,n,i,s)=>{t.arcTo(l,e,i,n,s)},n=0==t?(t,e,l,n,i)=>{t.rect(e,l,n,i)}:(t,e,l,n,i)=>{t.rect(l,e,i,n)};return(t,i,s,a,o,r=0,u=0)=>{0==r&&0==u?n(t,i,s,a,o):(r=jt(r,a/2,o/2),u=jt(u,a/2,o/2),e(t,i+r,s),l(t,i+a,s,i+a,s+o,r),l(t,i+a,s+o,i,s+o,u),l(t,i,s+o,i,s,u),l(t,i,s,i+a,s,r),t.closePath())}}const Ql=(t,e,l)=>{t.moveTo(e,l)},tn=(t,e,l)=>{t.moveTo(l,e)},en=(t,e,l)=>{t.lineTo(e,l)},ln=(t,e,l)=>{t.lineTo(l,e)},nn=Zl(0),sn=Zl(1),an=(t,e,l,n,i,s)=>{t.arc(e,l,n,i,s)},on=(t,e,l,n,i,s)=>{t.arc(l,e,n,i,s)},rn=(t,e,l,n,i,s,a)=>{t.bezierCurveTo(e,l,n,i,s,a)},un=(t,e,l,n,i,s,a)=>{t.bezierCurveTo(l,e,i,n,a,s)};function cn(t){return(t,e,l,n,i)=>Yl(t,e,(e,s,a,o,r,u,c,h,d,f,p)=>{let m,g,{pxRound:b,points:v}=e;0==o.ori?(m=Ql,g=an):(m=tn,g=on);const w=re(v.width*et,3);let y=(v.size-v.width)/2*et,x=re(2*y,3),_=new Path2D,k=new Path2D,{left:M,top:S,width:C,height:T}=t.bbox;nn(k,M-x,S-x,C+2*x,T+2*x);const D=t=>{if(null!=a[t]){let e=b(u(s[t],o,f,h)),l=b(c(a[t],r,p,d));m(_,e+y,l),g(_,e,l,y,0,2*Ft)}};if(i)i.forEach(D);else for(let t=l;t<=n;t++)D(t);return{stroke:w>0?_:null,fill:_,clip:k,flags:3}})}function hn(t){return(e,l,n,i,s,a)=>{n!=i&&(s!=n&&a!=n&&t(e,l,n),s!=i&&a!=i&&t(e,l,i),t(e,l,a))}}const dn=hn(en),fn=hn(ln);function pn(t){const e=Et(null==t?void 0:t.alignGaps,0);return(t,l,n,i)=>Yl(t,l,(s,a,o,r,u,c,h,d,f,p,m)=>{[n,i]=_t(o,n,i);let g,b,v=s.pxRound,w=t=>v(c(t,r,p,d)),y=t=>v(h(t,u,m,f));0==r.ori?(g=en,b=dn):(g=ln,b=fn);const x=r.dir*(0==r.ori?1:-1),_={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:1},k=_.stroke;let M=!1;if(i-n>=4*p){let e,l,s,u=e=>t.posToVal(e,r.key,!0),c=null,h=null,d=w(a[1==x?n:i]),f=w(a[n]),p=w(a[i]),m=u(1==x?f+1:p-1);for(let t=1==x?n:i;t>=n&&t<=i;t+=x){let n=a[t],i=(1==x?n<m:n>m)?d:w(n),s=o[t];i==d?null!=s?(l=s,null==c?(g(k,i,y(l)),e=c=h=l):l<c?c=l:l>h&&(h=l)):null===s&&(M=!0):(null!=c&&b(k,d,y(c),y(h),y(e),y(l)),null!=s?(l=s,g(k,i,y(l)),c=h=e=l):(c=h=null,null===s&&(M=!0)),d=i,m=u(d+x))}null!=c&&c!=h&&s!=d&&b(k,d,y(c),y(h),y(e),y(l))}else for(let t=1==x?n:i;t>=n&&t<=i;t+=x){let e=o[t];null===e?M=!0:null!=e&&g(k,w(a[t]),y(e))}let[S,C]=Gl(t,l);if(null!=s.fill||0!=S){let e=_.fill=new Path2D(k),o=y(s.fillTo(t,l,s.min,s.max,S)),r=w(a[n]),u=w(a[i]);-1==x&&([u,r]=[r,u]),g(e,u,o),g(e,r,o)}if(!s.spanGaps){let u=[];M&&u.push(...ql(a,o,n,i,x,w,e)),_.gaps=u=s.gaps(t,l,n,i,u),_.clip=Xl(u,r.ori,d,f,p,m)}return 0!=C&&(_.band=2==C?[Kl(t,l,n,i,k,-1),Kl(t,l,n,i,k,1)]:Kl(t,l,n,i,k,C)),_})}function mn(t,e,l,n,i,s,a=Ut){if(t.length>1){let o=null;for(let r=0,u=1/0;r<t.length;r++)if(void 0!==e[r]){if(null!=o){let e=Wt(t[r]-t[o]);e<u&&(u=e,a=Wt(l(t[r],n,i,s)-l(t[o],n,i,s)))}o=r}}return a}function gn(t,e,l,n,i,s){const a=t.length;if(a<2)return null;const o=new Path2D;if(l(o,t[0],e[0]),2==a)n(o,t[1],e[1]);else{let l=Array(a),n=Array(a-1),s=Array(a-1),r=Array(a-1);for(let i=0;i<a-1;i++)s[i]=e[i+1]-e[i],r[i]=t[i+1]-t[i],n[i]=s[i]/r[i];l[0]=n[0];for(let t=1;t<a-1;t++)0===n[t]||0===n[t-1]||n[t-1]>0!=n[t]>0?l[t]=0:(l[t]=3*(r[t-1]+r[t])/((2*r[t]+r[t-1])/n[t-1]+(r[t]+2*r[t-1])/n[t]),isFinite(l[t])||(l[t]=0));l[a-1]=n[a-2];for(let u=0;u<a-1;u++)i(o,t[u]+r[u]/3,e[u]+l[u]*r[u]/3,t[u+1]-r[u]/3,e[u+1]-l[u+1]*r[u]/3,t[u+1],e[u+1])}return o}const bn=new Set;function vn(){for(let t of bn)t.syncRect(!0)}J&&(gt("resize",Q,vn),gt("scroll",Q,vn,!0),gt(X,Q,()=>{Pn.pxRatio=et}));const wn=pn(),yn=cn();function xn(t,e,l,n){return(n?[t[0],t[1]].concat(t.slice(2)):[t[0]].concat(t.slice(1))).map((t,n)=>_n(t,n,e,l))}function _n(t,e,l,n){return ke({},0==e?l:n,t)}function kn(t,e,l){return null==e?pe:[e,l]}const Mn=kn;function Sn(t,e,l){return null==e?pe:At(e,l,.1,!0)}function Cn(t,e,l,n){return null==e?pe:Mt(e,l,t.scales[n].log,!1)}const Tn=Cn;function Dn(t,e,l,n){return null==e?pe:St(e,l,t.scales[n].log,!1)}const An=Dn;function En(t){let e,l;return[t=t.replace(/(\d+)px/,(t,n)=>(e=$t((l=+n)*et))+"px"),e,l]}function Nn(t){t.show&&[t.font,t.labelFont].forEach(t=>{let e=re(t[2]*et,1);t[0]=t[0].replace(/[0-9.]+px/,e+"px"),t[1]=e})}function Pn(t,e,l){var n,i;const s={mode:Et(t.mode,1)},a=s.mode;function o(t,e,l,n){let i=e.valToPct(t);return n+l*(-1==e.dir?1-i:i)}function r(t,e,l,n){let i=e.valToPct(t);return n+l*(-1==e.dir?i:1-i)}function u(t,e,l,n){return 0==e.ori?o(t,e,l,n):r(t,e,l,n)}s.valToPosH=o,s.valToPosV=r;let c=!1;s.status=0;const h=s.root=ot("uplot");if(null!=t.id&&(h.id=t.id),nt(h,t.class),t.title){ot("u-title",h).textContent=t.title}const d=at("canvas"),f=s.ctx=d.getContext("2d"),p=ot("u-wrap",h);gt("click",p,t=>{if(t.target===g){(Gn!=Rn||Un!=Hn)&&li.click(s,t)}},!0);const m=s.under=ot("u-under",p);p.appendChild(d);const g=s.over=ot("u-over",p),b=+Et((t=_e(t)).pxAlign,1),v=Jl(b);(t.plugins||[]).forEach(e=>{e.opts&&(t=e.opts(s,t)||t)});const w=t.ms||.001,y=s.series=1==a?xn(t.series||[],_l,Vl,!1):(x=t.series||[null],_=$l,x.map((t,e)=>0==e?{}:ke({},_,t)));var x,_;const k=s.axes=xn(t.axes||[],xl,Fl,!0),M=s.scales={},S=s.bands=t.bands||[];S.forEach(t=>{t.fill=Jt(t.fill||null),t.dir=Et(t.dir,-1)});const C=2==a?y[1].facets[0].scale:y[0].scale,T={axes:function(){for(let t=0;t<k.length;t++){let e=k[t];if(!e.show||!e._show)continue;let l,n,i=e.side,a=i%2,o=e.stroke(s,t),r=0==i||3==i?-1:1,[c,h]=e._found;if(null!=e.label){let u=e.labelGap*r,d=$t((e._lpos+u)*et);rn(e.labelFont[0],o,"center",2==i?W:I),f.save(),1==a?(l=n=0,f.translate(d,$t($e+Re/2)),f.rotate((3==i?-Ft:Ft)/2)):(l=$t(Ie+Ve/2),n=d);let p=qt(e.label)?e.label(s,t,c,h):e.label;f.fillText(p,l,n),f.restore()}if(0==h)continue;let d=M[e.scale],p=0==a?Ve:Re,m=0==a?Ie:$e,g=e._splits,b=2==d.distr?g.map(t=>ln[t]):g,w=2==d.distr?ln[g[1]]-ln[g[0]]:c,y=e.ticks,x=e.border,_=y.show?y.size:0,S=$t(_*et),C=$t((2==e.alignTo?e._size-_-e.gap:e.gap)*et),T=e._rotate*-Ft/180,D=v(e._pos*et),A=D+(S+C)*r;n=0==a?A:0,l=1==a?A:0,rn(e.font[0],o,1==e.align?$:2==e.align?V:T>0?$:T<0?V:0==a?"center":3==i?V:$,T||1==a?"middle":2==i?W:I);let E=e.font[1]*e.lineGap,N=g.map(t=>v(u(t,d,p,m))),P=e._values;for(let t=0;t<P.length;t++){let e=P[t];if(null!=e){0==a?l=N[t]:n=N[t],e=""+e;let i=-1==e.indexOf("\n")?[e]:e.split(/\n/gm);for(let t=0;t<i.length;t++){let e=i[t];T?(f.save(),f.translate(l,n+t*E),f.rotate(T),f.fillText(e,0,0),f.restore()):f.fillText(e,l,n+t*E)}}}y.show&&Pn(N,y.filter(s,b,t,h,w),a,i,D,S,re(y.width*et,3),y.stroke(s,t),y.dash,y.cap);let L=e.grid;L.show&&Pn(N,L.filter(s,b,t,h,w),a,0==a?2:1,0==a?$e:Ie,0==a?Re:Ve,re(L.width*et,3),L.stroke(s,t),L.dash,L.cap),x.show&&Pn([D],[1],0==a?1:0,0==a?1:2,1==a?$e:Ie,1==a?Re:Ve,re(x.width*et,3),x.stroke(s,t),x.dash,x.cap)}$i("drawAxes")},series:function(){if(El>0){let t=y.some(t=>t._focus)&&en!=hl.alpha;t&&(f.globalAlpha=en=hl.alpha),y.forEach((t,l)=>{if(l>0&&t.show&&(hn(l,!1),hn(l,!0),null==t._paths)){let n=en;en!=t.alpha&&(f.globalAlpha=en=t.alpha);let i=2==a?[0,e[l][0].length-1]:function(t){let e=Xt(Nl-1,0,El-1),l=Xt(Wl+1,0,El-1);for(;null==t[e]&&e>0;)e--;for(;null==t[l]&&l<El-1;)l++;return[e,l]}(e[l]);t._paths=t.paths(s,l,i[0],i[1]),en!=n&&(f.globalAlpha=en=n)}}),y.forEach((t,e)=>{if(e>0&&t.show){let l=en;en!=t.alpha&&(f.globalAlpha=en=t.alpha),null!=t._paths&&dn(e,!1);{let l=null!=t._paths?t._paths.gaps:null,n=t.points.show(s,e,Nl,Wl,l),i=t.points.filter(s,e,n,l);(n||i)&&(t.points._paths=t.points.paths(s,e,Nl,Wl,i),dn(e,!0))}en!=l&&(f.globalAlpha=en=l),$i("drawSeries",e)}}),t&&(f.globalAlpha=en=1)}}},D=(t.drawOrder||["axes","series"]).map(t=>T[t]);function A(t){const e=3==t.distr?e=>Bt(e>0?e:t.clamp(s,e,t.min,t.max,t.key)):4==t.distr?e=>Gt(e,t.asinh):100==t.distr?e=>t.fwd(e):t=>t;return l=>{let n=e(l),{_min:i,_max:s}=t;return(n-i)/(s-i)}}function E(e){let l=M[e];if(null==l){let n=(t.scales||de)[e]||de;if(null!=n.from){E(n.from);let t=ke({},M[n.from],n,{key:e});t.valToPct=A(t),M[e]=t}else{l=M[e]=ke({},e==C?Ol:Rl,n),l.key=e;let t=l.time,i=l.range,s=me(i);if((e!=C||2==a&&!t)&&(!s||null!=i[0]&&null!=i[1]||(i={min:null==i[0]?Ct:{mode:1,hard:i[0],soft:i[0]},max:null==i[1]?Ct:{mode:1,hard:i[1],soft:i[1]}},s=!1),!s&&ve(i))){let t=i;i=(e,l,n)=>null==l?pe:At(l,n,t)}l.range=Jt(i||(t?Mn:e==C?3==l.distr?Tn:4==l.distr?An:kn:3==l.distr?Cn:4==l.distr?Dn:Sn)),l.auto=Jt(!s&&l.auto),l.clamp=Jt(l.clamp||jl),l._min=l._max=null,l.valToPct=A(l)}}}E("x"),E("y"),1==a&&y.forEach(t=>{E(t.scale)}),k.forEach(t=>{E(t.scale)});for(let P in t.scales)E(P);const N=M[C],j=N.distr;let K,J;0==N.ori?(nt(h,"u-hz"),K=o,J=r):(nt(h,"u-vt"),K=r,J=o);const tt={};for(let P in M){let t=M[P];null==t.min&&null==t.max||(tt[P]={min:t.min,max:t.max},t.min=t.max=null)}const lt=t.tzDate||(t=>new Date($t(t/w))),rt=t.fmtDate||ze,ct=1==w?el(lt):il(lt),dt=al(lt,sl(1==w?tl:nl,rt)),pt=ul(lt,rl("{YYYY}-{MM}-{DD} {h}:{mm}{aa}",rt)),mt=[],wt=s.legend=ke({},cl,t.legend),Tt=s.cursor=ke({},pl,{drag:{y:2==a}},t.cursor),Dt=wt.show,Nt=Tt.show,Pt=wt.markers;let Lt,It,Ht;wt.idxs=mt,Pt.width=Jt(Pt.width),Pt.dash=Jt(Pt.dash),Pt.stroke=Jt(Pt.stroke),Pt.fill=Jt(Pt.fill);let Yt,Zt=[],ne=[],ie=!1,ae={};if(wt.live){const t=y[1]?y[1].values:null;ie=null!=t,Yt=ie?t(s,1,0):{_:0};for(let e in Yt)ae[e]=q}if(Dt)if(Lt=at("table","u-legend",h),Ht=at("tbody",null,Lt),wt.mount(s,Lt),ie){It=at("thead",null,Lt,Ht);let t=at("tr",null,It);for(var oe in at("th",null,t),Yt)at("th",L,t).textContent=oe}else nt(Lt,"u-inline"),wt.live&&nt(Lt,"u-live");const he={show:!0},ge={show:!1};const ye=new Map;function xe(t,e,l,n=!0){const i=ye.get(e)||{},a=Tt.bind[t](s,e,l,n);a&&(gt(t,e,i[t]=a),ye.set(e,i))}function Me(t,e,l){const n=ye.get(e)||{};for(let i in n)null!=t&&i!=t||(bt(i,e,n[i]),delete n[i]);null==t&&ye.delete(e)}let Ce=0,Te=0,De=0,Ae=0,Ee=0,Ne=0,Pe=Ee,Le=Ne,Fe=De,We=Ae,Ie=0,$e=0,Ve=0,Re=0;s.bbox={};let He=!1,Be=!1,Ye=!1,Ge=!1,Ue=!1,Ke=!1;function Xe(t,e,l){(l||t!=s.width||e!=s.height)&&qe(t,e),Fn(!1),Ye=!0,Be=!0,Zn()}function qe(t,e){s.width=Ce=De=t,s.height=Te=Ae=e,Ee=Ne=0,function(){let t=!1,e=!1,l=!1,n=!1;k.forEach((i,s)=>{if(i.show&&i._show){let{side:s,_size:a}=i,o=s%2,r=a+(null!=i.label?i.labelSize:0);r>0&&(o?(De-=r,3==s?(Ee+=r,n=!0):l=!0):(Ae-=r,0==s?(Ne+=r,t=!0):e=!0))}}),yl[0]=t,yl[1]=l,yl[2]=e,yl[3]=n,De-=Al[1]+Al[3],Ee+=Al[3],Ae-=Al[2]+Al[0],Ne+=Al[0]}(),function(){let t=Ee+De,e=Ne+Ae,l=Ee,n=Ne;function i(i,s){switch(i){case 1:return t+=s,t-s;case 2:return e+=s,e-s;case 3:return l-=s,l+s;case 0:return n-=s,n+s}}k.forEach((t,e)=>{if(t.show&&t._show){let e=t.side;t._pos=i(e,t._size),null!=t.label&&(t._lpos=i(e,t.labelSize))}})}();let l=s.bbox;Ie=l.left=se(Ee*et,.5),$e=l.top=se(Ne*et,.5),Ve=l.width=se(De*et,.5),Re=l.height=se(Ae*et,.5)}const Je=3;if(s.setSize=function({width:t,height:e}){Xe(t,e)},null==Tt.dataIdx){let t=Tt.hover,l=t.skip=new Set(null!=(n=t.skip)?n:[]);l.add(void 0);let s=t.prox=Jt(t.prox),a=null!=(i=t.bias)?i:t.bias=0;Tt.dataIdx=(t,n,i,o)=>{var r;if(0==n)return i;let u=i,c=null!=(r=s(t,n,i,o))?r:Ut,h=c>=0&&c<Ut,d=0==N.ori?De:Ae,f=Tt.left,p=e[0],m=e[n];if(l.has(m[i])){u=null;let t,e=null,n=null;if(0==a||-1==a)for(t=i;null==e&&t-- >0;)l.has(m[t])||(e=t);if(0==a||1==a)for(t=i;null==n&&t++<m.length;)l.has(m[t])||(n=t);if(null!=e||null!=n)if(h){let t=f-(null==e?-1/0:K(p[e],N,d,0)),l=(null==n?1/0:K(p[n],N,d,0))-f;t<=l?t<=c&&(u=e):l<=c&&(u=n)}else u=null==n?e:null==e?n:i-e<=n-i?e:n}else if(h){Wt(f-K(p[i],N,d,0))>c&&(u=null)}return u}}const Ze=t=>{Tt.event=t};Tt.idxs=mt,Tt._lock=!1;let ol=Tt.points;ol.show=Jt(ol.show),ol.size=Jt(ol.size),ol.stroke=Jt(ol.stroke),ol.width=Jt(ol.width),ol.fill=Jt(ol.fill);const hl=s.focus=ke({},t.focus||{alpha:.3},Tt.focus),dl=hl.prox>=0,fl=dl&&ol.one;let ml=[],gl=[],bl=[];function vl(t,e){let l=ol.show(s,e);if(l instanceof HTMLElement)return nt(l,"u-cursor-pt"),nt(l,t.class),ut(l,-10,-10,De,Ae),g.insertBefore(l,ml[e]),l}function wl(t,e){if(1==a||e>0){let e=1==a&&M[t.scale].time,l=t.value;t.value=e?be(l)?ul(lt,rl(l,rt)):l||pt:l||zl,t.label=t.label||(e?"Time":"Value")}if(fl||e>0){t.width=null==t.width?1:t.width,t.paths=t.paths||wn||te,t.fillTo=Jt(t.fillTo||Ul),t.pxAlign=+Et(t.pxAlign,b),t.pxRound=Jl(t.pxAlign),t.stroke=Jt(t.stroke||null),t.fill=Jt(t.fill||null),t._stroke=t._fill=t._paths=t._focus=null;let e=re((3+2*(Ot(1,t.width)||1))*1,3),l=t.points=ke({},{size:e,width:Ot(1,.2*e),stroke:t.stroke,space:2*e,paths:yn,_stroke:null,_fill:null},t.points);l.show=Jt(l.show),l.filter=Jt(l.filter),l.fill=Jt(l.fill),l.stroke=Jt(l.stroke),l.paths=Jt(l.paths),l.pxAlign=t.pxAlign}if(Dt){let l=function(t,e){if(0==e&&(ie||!wt.live||2==a))return pe;let l=[],n=at("tr","u-series",Ht,Ht.childNodes[e]);nt(n,t.class),t.show||nt(n,P);let i=at("th",null,n);if(Pt.show){let t=ot("u-marker",i);if(e>0){let l=Pt.width(s,e);l&&(t.style.border=l+"px "+Pt.dash(s,e)+" "+Pt.stroke(s,e)),t.style.background=Pt.fill(s,e)}}let o=ot(L,i);for(var r in t.label instanceof HTMLElement?o.appendChild(t.label):o.textContent=t.label,e>0&&(Pt.show||(o.style.color=t.width>0?Pt.stroke(s,e):Pt.fill(s,e)),xe("click",i,e=>{if(Tt._lock)return;Ze(e);let l=y.indexOf(t);if((e.ctrlKey||e.metaKey)!=wt.isolate){let t=y.some((t,e)=>e>0&&e!=l&&t.show);y.forEach((e,n)=>{n>0&&ui(n,t?n==l?he:ge:he,!0,ji.setSeries)})}else ui(l,{show:!t.show},!0,ji.setSeries)},!1),dl&&xe(Y,i,e=>{Tt._lock||(Ze(e),ui(y.indexOf(t),fi,!0,ji.setSeries))},!1)),Yt){let t=at("td","u-value",n);t.textContent="--",l.push(t)}return[n,l]}(t,e);Zt.splice(e,0,l[0]),ne.splice(e,0,l[1]),wt.values.push(null)}if(Nt){mt.splice(e,0,null);let l=null;fl?0==e&&(l=vl(t,e)):e>0&&(l=vl(t,e)),ml.splice(e,0,l),gl.splice(e,0,0),bl.splice(e,0,0)}$i("addSeries",e)}s.addSeries=function(t,e){e=null==e?y.length:e,t=1==a?_n(t,e,_l,Vl):_n(t,e,{},$l),y.splice(e,0,t),wl(y[e],e)},s.delSeries=function(t){if(y.splice(t,1),Dt){wt.values.splice(t,1),ne.splice(t,1);let e=Zt.splice(t,1)[0];Me(null,e.firstChild),e.remove()}Nt&&(mt.splice(t,1),ml.splice(t,1)[0].remove(),gl.splice(t,1),bl.splice(t,1)),$i("delSeries",t)};const yl=[!1,!1,!1,!1];function Tl(t,e,l,n){let[i,s,a,o]=l,r=e%2,u=0;return 0==r&&(o||s)&&(u=0==e&&!i||2==e&&!a?$t(xl.size/3):0),1==r&&(i||a)&&(u=1==e&&!s||3==e&&!o?$t(Fl.size/2):0),u}const Dl=s.padding=(t.padding||[Tl,Tl,Tl,Tl]).map(t=>Jt(Et(t,Tl))),Al=s._padding=Dl.map((t,e)=>t(s,e,yl,0));let El,Nl=null,Wl=null;const Il=1==a?y[0].idxs:null;let Hl,Yl,Gl,Kl,Xl,ql,Zl,Ql,tn,en,ln=null,nn=!1;function sn(t,l){if(e=null==t?[]:t,s.data=s._data=e,2==a){El=0;for(let t=1;t<y.length;t++)El+=e[t][0].length}else{0==e.length&&(s.data=s._data=e=[[]]),ln=e[0],El=ln.length;let t=e;if(2==j){t=e.slice();let l=t[0]=Array(El);for(let t=0;t<El;t++)l[t]=t}s._data=e=t}if(Fn(!0),$i("setData"),2==j&&(Ye=!0),!1!==l){let t=N;t.auto(s,nn)?an():ri(C,t.min,t.max),Ge=Ge||Tt.left>=0,Ke=!0,Zn()}}function an(){let t,l;nn=!0,1==a&&(El>0?(Nl=Il[0]=0,Wl=Il[1]=El-1,t=e[0][Nl],l=e[0][Wl],2==j?(t=Nl,l=Wl):t==l&&(3==j?[t,l]=Mt(t,t,N.log,!1):4==j?[t,l]=St(t,t,N.log,!1):N.time?l=t+$t(86400/w):[t,l]=At(t,l,.1,!0))):(Nl=Il[0]=t=null,Wl=Il[1]=l=null)),ri(C,t,l)}function on(t,e,l,n,i,s){null!=t||(t=O),null!=l||(l=fe),null!=n||(n="butt"),null!=i||(i=O),null!=s||(s="round"),t!=Hl&&(f.strokeStyle=Hl=t),i!=Yl&&(f.fillStyle=Yl=i),e!=Gl&&(f.lineWidth=Gl=e),s!=Xl&&(f.lineJoin=Xl=s),n!=ql&&(f.lineCap=ql=n),l!=Kl&&f.setLineDash(Kl=l)}function rn(t,e,l,n){e!=Yl&&(f.fillStyle=Yl=e),t!=Zl&&(f.font=Zl=t),l!=Ql&&(f.textAlign=Ql=l),n!=tn&&(f.textBaseline=tn=n)}function un(t,e,l,n,i=0){if(n.length>0&&t.auto(s,nn)&&(null==e||null==e.min)){let e=Et(Nl,0),s=Et(Wl,n.length-1),a=null==l.min?function(t,e,l,n=0,i=!1){let s=i?kt:_t,a=i?xt:yt;[e,l]=s(t,e,l);let o=t[e],r=t[e];if(e>-1)if(1==n)o=t[e],r=t[l];else if(-1==n)o=t[l],r=t[e];else for(let u=e;u<=l;u++){let e=t[u];a(e)&&(e<o?o=e:e>r&&(r=e))}return[null!=o?o:Ut,null!=r?r:-Ut]}(n,e,s,i,3==t.distr):[l.min,l.max];t.min=jt(t.min,l.min=a[0]),t.max=Ot(t.max,l.max=a[1])}}s.setData=sn;const cn={min:null,max:null};function hn(t,e){let l=e?y[t].points:y[t];l._stroke=l.stroke(s,t),l._fill=l.fill(s,t)}function dn(t,l){let n=l?y[t].points:y[t],{stroke:i,fill:a,clip:o,flags:r,_stroke:u=n._stroke,_fill:c=n._fill,_width:h=n.width}=n._paths;h=re(h*et,3);let d=null,p=h%2/2;l&&null==c&&(c=h>0?"#fff":u);let m=1==n.pxAlign&&p>0;if(m&&f.translate(p,p),!l){let t=Ie-h/2,e=$e-h/2,l=Ve+h,n=Re+h;d=new Path2D,d.rect(t,e,l,n)}l?pn(u,h,n.dash,n.cap,c,i,a,r,o):function(t,l,n,i,a,o,r,u,c,h,d){let f=!1;0!=c&&S.forEach((p,m)=>{if(p.series[0]==t){let t,g=y[p.series[1]],b=e[p.series[1]],v=(g._paths||de).band;me(v)&&(v=1==p.dir?v[0]:v[1]);let w=null;g.show&&v&&function(t,e,l){for(e=Et(e,0),l=Et(l,t.length-1);e<=l;){if(null!=t[e])return!0;e++}return!1}(b,Nl,Wl)?(w=p.fill(s,m)||o,t=g._paths.clip):v=null,pn(l,n,i,a,w,r,u,c,h,d,t,v),f=!0}}),f||pn(l,n,i,a,o,r,u,c,h,d)}(t,u,h,n.dash,n.cap,c,i,a,r,d,o),m&&f.translate(-p,-p)}const fn=3;function pn(t,e,l,n,i,s,a,o,r,u,c,h){on(t,e,l,n,i),(r||u||h)&&(f.save(),r&&f.clip(r),u&&f.clip(u)),h?(o&fn)==fn?(f.clip(h),c&&f.clip(c),gn(i,a),mn(t,s,e)):2&o?(gn(i,a),f.clip(h),mn(t,s,e)):1&o&&(f.save(),f.clip(h),c&&f.clip(c),gn(i,a),f.restore(),mn(t,s,e)):(gn(i,a),mn(t,s,e)),(r||u||h)&&f.restore()}function mn(t,e,l){l>0&&(e instanceof Map?e.forEach((t,e)=>{f.strokeStyle=Hl=e,f.stroke(t)}):null!=e&&t&&f.stroke(e))}function gn(t,e){e instanceof Map?e.forEach((t,e)=>{f.fillStyle=Yl=e,f.fill(t)}):null!=e&&t&&f.fill(e)}function vn(t,e,l,n){let i,a=k[t];if(n<=0)i=[0,0];else{let o=a._space=a.space(s,t,e,l,n);i=function(t,e,l,n,i){let s=Ot(Kt(t),Kt(e)),a=e-t,o=vt(i/n*a,l);do{let t=l[o],e=n*t/a;if(e>=i&&s+(t<5?ue.get(t):0)<=17)return[t,e]}while(++o<l.length);return[0,0]}(e,l,a._incrs=a.incrs(s,t,e,l,n,o),n,o)}return a._found=i}function Pn(t,e,l,n,i,s,a,o,r,u){let c=a%2/2;1==b&&f.translate(c,c),on(o,a,r,u,o),f.beginPath();let h,d,p,m,g=i+(0==n||3==n?-s:s);0==l?(d=i,m=g):(h=i,p=g);for(let b=0;b<t.length;b++)null!=e[b]&&(0==l?h=p=t[b]:d=m=t[b],f.moveTo(h,d),f.lineTo(p,m));f.stroke(),1==b&&f.translate(-c,-c)}function Ln(t){let e=!0;return k.forEach((l,n)=>{if(!l.show)return;let i=M[l.scale];if(null==i.min)return void(l._show&&(e=!1,l._show=!1,Fn(!1)));l._show||(e=!1,l._show=!0,Fn(!1));let a=l.side,o=a%2,{min:r,max:u}=i,[c,h]=vn(n,r,u,0==o?De:Ae);if(0==h)return;let d=2==i.distr,f=l._splits=l.splits(s,n,r,u,c,h,d),p=2==i.distr?f.map(t=>ln[t]):f,m=2==i.distr?ln[f[1]]-ln[f[0]]:c,g=l._values=l.values(s,l.filter(s,p,n,h,m),n,h,m);l._rotate=2==a?l.rotate(s,g,n,h):0;let b=l._size;l._size=Vt(l.size(s,g,n,t)),null!=b&&l._size!=b&&(e=!1)}),e}function zn(t){let e=!0;return Dl.forEach((l,n)=>{let i=l(s,n,yl,t);i!=Al[n]&&(e=!1),Al[n]=i}),e}function Fn(t){y.forEach((e,l)=>{l>0&&(e._paths=null,t&&(1==a?(e.min=null,e.max=null):e.facets.forEach(t=>{t.min=null,t.max=null})))})}let Wn,In,$n,Vn,jn,On,Rn,Hn,Bn,Yn,Gn,Un,Kn=!1,Xn=!1,qn=[];function Jn(){Xn=!1;for(let t=0;t<qn.length;t++)$i(...qn[t]);qn.length=0}function Zn(){Kn||(Se(Qn),Kn=!0)}function Qn(){if(He&&(!function(){for(let e in M){let t=M[e];null==tt[e]&&(null==t.min||null!=tt[C]&&t.auto(s,nn))&&(tt[e]=cn)}for(let e in M){let t=M[e];null==tt[e]&&null!=t.from&&null!=tt[t.from]&&(tt[e]=cn)}null!=tt[C]&&Fn(!0);let t={};for(let e in tt){let l=tt[e];if(null!=l){let n=t[e]=_e(M[e],we);if(null!=l.min)ke(n,l);else if(e!=C||2==a)if(0==El&&null==n.from){let t=n.range(s,null,null,e);n.min=t[0],n.max=t[1]}else n.min=Ut,n.max=-Ut}}if(El>0){y.forEach((l,n)=>{if(1==a){let i=l.scale,a=tt[i];if(null==a)return;let o=t[i];if(0==n){let t=o.range(s,o.min,o.max,i);o.min=t[0],o.max=t[1],Nl=vt(o.min,e[0]),Wl=vt(o.max,e[0]),Wl-Nl>1&&(e[0][Nl]<o.min&&Nl++,e[0][Wl]>o.max&&Wl--),l.min=ln[Nl],l.max=ln[Wl]}else l.show&&l.auto&&un(o,a,l,e[n],l.sorted);l.idxs[0]=Nl,l.idxs[1]=Wl}else if(n>0&&l.show&&l.auto){let[i,s]=l.facets,a=i.scale,o=s.scale,[r,u]=e[n],c=t[a],h=t[o];null!=c&&un(c,tt[a],i,r,i.sorted),null!=h&&un(h,tt[o],s,u,s.sorted),l.min=s.min,l.max=s.max}});for(let e in t){let l=t[e],n=tt[e];if(null==l.from&&(null==n||null==n.min)){let t=l.range(s,l.min==Ut?null:l.min,l.max==-Ut?null:l.max,e);l.min=t[0],l.max=t[1]}}}for(let e in t){let l=t[e];if(null!=l.from){let n=t[l.from];if(null==n.min)l.min=l.max=null;else{let t=l.range(s,n.min,n.max,e);l.min=t[0],l.max=t[1]}}}let l={},n=!1;for(let e in t){let i=t[e],s=M[e];if(s.min!=i.min||s.max!=i.max){s.min=i.min,s.max=i.max;let t=s.distr;s._min=3==t?Bt(s.min):4==t?Gt(s.min,s.asinh):100==t?s.fwd(s.min):s.min,s._max=3==t?Bt(s.max):4==t?Gt(s.max,s.asinh):100==t?s.fwd(s.max):s.max,l[e]=n=!0}}if(n){y.forEach((t,e)=>{2==a?e>0&&l.y&&(t._paths=null):l[t.scale]&&(t._paths=null)});for(let t in l)Ye=!0,$i("setScale",t);Nt&&Tt.left>=0&&(Ge=Ke=!0)}for(let e in tt)tt[e]=null}(),He=!1),Ye&&(!function(){let t=!1,e=0;for(;!t;){e++;let l=Ln(e),n=zn(e);t=e==Je||l&&n,t||(qe(s.width,s.height),Be=!0)}}(),Ye=!1),Be){if(st(m,$,Ee),st(m,W,Ne),st(m,z,De),st(m,F,Ae),st(g,$,Ee),st(g,W,Ne),st(g,z,De),st(g,F,Ae),st(p,z,Ce),st(p,F,Te),d.width=$t(Ce*et),d.height=$t(Te*et),k.forEach(({_el:t,_show:e,_size:l,_pos:n,side:i})=>{if(null!=t)if(e){let e=i%2==1;st(t,e?"left":"top",n-(3===i||0===i?l:0)),st(t,e?"width":"height",l),st(t,e?"top":"left",e?Ne:Ee),st(t,e?"height":"width",e?Ae:De),it(t,P)}else nt(t,P)}),Hl=Yl=Gl=Xl=ql=Zl=Ql=tn=Kl=null,en=1,ki(!0),Ee!=Pe||Ne!=Le||De!=Fe||Ae!=We){Fn(!1);let t=De/Fe,e=Ae/We;if(Nt&&!Ge&&Tt.left>=0){Tt.left*=t,Tt.top*=e,$n&&ut($n,$t(Tt.left),0,De,Ae),Vn&&ut(Vn,0,$t(Tt.top),De,Ae);for(let l=0;l<ml.length;l++){let n=ml[l];null!=n&&(gl[l]*=t,bl[l]*=e,ut(n,Vt(gl[l]),Vt(bl[l]),De,Ae))}}if(si.show&&!Ue&&si.left>=0&&si.width>0){si.left*=t,si.width*=t,si.top*=e,si.height*=e;for(let t in Ci)st(ai,t,si[t])}Pe=Ee,Le=Ne,Fe=De,We=Ae}$i("setSize"),Be=!1}Ce>0&&Te>0&&(f.clearRect(0,0,d.width,d.height),$i("drawClear"),D.forEach(t=>t()),$i("draw")),si.show&&Ue&&(oi(si),Ue=!1),Nt&&Ge&&(xi(null,!0,!1),Ge=!1),wt.show&&wt.live&&Ke&&(wi(),Ke=!1),c||(c=!0,s.status=1,$i("ready")),nn=!1,Kn=!1}function ti(t,l){let n=M[t];if(null==n.from){if(0==El){let e=n.range(s,l.min,l.max,t);l.min=e[0],l.max=e[1]}if(l.min>l.max){let t=l.min;l.min=l.max,l.max=t}if(El>1&&null!=l.min&&null!=l.max&&l.max-l.min<1e-16)return;t==C&&2==n.distr&&El>0&&(l.min=vt(l.min,e[0]),l.max=vt(l.max,e[0]),l.min==l.max&&l.max++),tt[t]=l,He=!0,Zn()}}s.batch=function(t,e=!1){Kn=!0,Xn=e,t(s),Qn(),e&&qn.length>0&&queueMicrotask(Jn)},s.redraw=(t,e)=>{Ye=e||!1,!1!==t?ri(C,N.min,N.max):Zn()},s.setScale=ti;let ei=!1;const li=Tt.drag;let ni=li.x,ii=li.y;Nt&&(Tt.x&&(Wn=ot("u-cursor-x",g)),Tt.y&&(In=ot("u-cursor-y",g)),0==N.ori?($n=Wn,Vn=In):($n=In,Vn=Wn),Gn=Tt.left,Un=Tt.top);const si=s.select=ke({show:!0,over:!0,left:0,width:0,top:0,height:0},t.select),ai=si.show?ot("u-select",si.over?g:m):null;function oi(t,e){if(si.show){for(let e in t)si[e]=t[e],e in Ci&&st(ai,e,t[e]);!1!==e&&$i("setSelect")}}function ri(t,e,l){ti(t,{min:e,max:l})}function ui(t,e,l,n){null!=e.focus&&function(t){if(t!=di){let e=null==t,l=1!=hl.alpha;y.forEach((n,i)=>{if(1==a||i>0){let s=e||0==i||i==t;n._focus=e?null:s,l&&function(t,e){y[t].alpha=e,Nt&&null!=ml[t]&&(ml[t].style.opacity=e);Dt&&Zt[t]&&(Zt[t].style.opacity=e)}(i,s?1:hl.alpha)}}),di=t,l&&Zn()}}(t),null!=e.show&&y.forEach((l,n)=>{n>0&&(t==n||null==t)&&(l.show=e.show,function(t){if(y[t].show)Dt&&it(Zt[t],P);else if(Dt&&nt(Zt[t],P),Nt){let e=fl?ml[0]:ml[t];null!=e&&ut(e,-10,-10,De,Ae)}}(n),2==a?(ri(l.facets[0].scale,null,null),ri(l.facets[1].scale,null,null)):ri(l.scale,null,null),Zn())}),!1!==l&&$i("setSeries",t,e),n&&Hi("setSeries",s,t,e)}let ci,hi,di;s.setSelect=oi,s.setSeries=ui,s.addBand=function(t,e){t.fill=Jt(t.fill||null),t.dir=Et(t.dir,-1),e=null==e?S.length:e,S.splice(e,0,t)},s.setBand=function(t,e){ke(S[t],e)},s.delBand=function(t){null==t?S.length=0:S.splice(t,1)};const fi={focus:!0};function pi(t,e,l){let n=M[e];l&&(t=t/et-(1==n.ori?Ne:Ee));let i=De;1==n.ori&&(i=Ae,t=i-t),-1==n.dir&&(t=i-t);let s=n._min,a=s+(n._max-s)*(t/i),o=n.distr;return 3==o?Rt(10,a):4==o?((t,e=1)=>zt.sinh(t)*e)(a,n.asinh):100==o?n.bwd(a):a}function mi(t,e){st(ai,$,si.left=t),st(ai,z,si.width=e)}function gi(t,e){st(ai,W,si.top=t),st(ai,F,si.height=e)}Dt&&dl&&xe(G,Lt,t=>{Tt._lock||(Ze(t),null!=di&&ui(null,fi,!0,ji.setSeries))}),s.valToIdx=t=>vt(t,e[0]),s.posToIdx=function(t,l){return vt(pi(t,C,l),e[0],Nl,Wl)},s.posToVal=pi,s.valToPos=(t,e,l)=>0==M[e].ori?o(t,M[e],l?Ve:De,l?Ie:0):r(t,M[e],l?Re:Ae,l?$e:0),s.setCursor=(t,e,l)=>{Gn=t.left,Un=t.top,xi(null,e,l)};let bi=0==N.ori?mi:gi,vi=1==N.ori?mi:gi;function wi(t,e){if(null!=t&&(t.idxs?t.idxs.forEach((t,e)=>{mt[e]=t}):void 0!==t.idx&&mt.fill(t.idx),wt.idx=mt[0]),Dt&&wt.live){for(let t=0;t<y.length;t++)(t>0||1==a&&!ie)&&yi(t,mt[t]);!function(){if(Dt&&wt.live)for(let t=2==a?1:0;t<y.length;t++){if(0==t&&ie)continue;let e=wt.values[t],l=0;for(let n in e)ne[t][l++].firstChild.nodeValue=e[n]}}()}Ke=!1,!1!==e&&$i("setLegend")}function yi(t,l){var n;let i,a=y[t],o=0==t&&2==j?ln:e[t];ie?i=null!=(n=a.values(s,t,l))?n:ae:(i=a.value(s,null==l?null:o[l],t,l),i=null==i?ae:{_:i}),wt.values[t]=i}function xi(t,l,n){let i;Bn=Gn,Yn=Un,[Gn,Un]=Tt.move(s,Gn,Un),Tt.left=Gn,Tt.top=Un,Nt&&($n&&ut($n,$t(Gn),0,De,Ae),Vn&&ut(Vn,0,$t(Un),De,Ae));let o=Nl>Wl;ci=Ut,hi=null;let r=0==N.ori?De:Ae,u=1==N.ori?De:Ae;if(Gn<0||0==El||o){i=Tt.idx=null;for(let t=0;t<y.length;t++){let e=ml[t];null!=e&&ut(e,-10,-10,De,Ae)}dl&&ui(null,fi,!0,null==t&&ji.setSeries),wt.live&&(mt.fill(i),Ke=!0)}else{let t,l,n;1==a&&(t=0==N.ori?Gn:Un,l=pi(t,C),i=Tt.idx=vt(l,e[0],Nl,Wl),n=K(e[0][i],N,r,0));let o=-10,c=-10,h=0,d=0,f=!0,p="",m="";for(let g=2==a?1:0;g<y.length;g++){let t=y[g],b=mt[g],v=null==b?null:1==a?e[g][b]:e[g][1][b],w=Tt.dataIdx(s,g,i,l),x=null==w?null:1==a?e[g][w]:e[g][1][w];if(Ke=Ke||x!=v||w!=b,mt[g]=w,g>0&&t.show){let l=null==w?-10:w==i?n:K(1==a?e[0][w]:e[g][0][w],N,r,0),b=null==x?-10:J(x,1==a?M[t.scale]:M[t.facets[1].scale],u,0);if(dl&&null!=x){let e=1==N.ori?Gn:Un,l=Wt(hl.dist(s,g,w,b,e));if(l<ci){let n=hl.bias;if(0!=n){let i=pi(e,t.scale),s=i>=0?1:-1;s==(x>=0?1:-1)&&(1==s?1==n?x>=i:x<=i:1==n?x<=i:x>=i)&&(ci=l,hi=g)}else ci=l,hi=g}}if(Ke||fl){let t,e;0==N.ori?(t=l,e=b):(t=b,e=l);let n,i,a,r,u,v,w=!0,y=ol.bbox;if(null!=y){w=!1;let t=y(s,g);a=t.left,r=t.top,n=t.width,i=t.height}else a=t,r=e,n=i=ol.size(s,g);if(v=ol.fill(s,g),u=ol.stroke(s,g),fl)g==hi&&ci<=hl.prox&&(o=a,c=r,h=n,d=i,f=w,p=v,m=u);else{let t=ml[g];null!=t&&(gl[g]=a,bl[g]=r,ft(t,n,i,w),ht(t,v,u),ut(t,Vt(a),Vt(r),De,Ae))}}}}if(fl){let t=hl.prox;if(Ke||(null==di?ci<=t:ci>t||hi!=di)){let t=ml[0];null!=t&&(gl[0]=o,bl[0]=c,ft(t,h,d,f),ht(t,p,m),ut(t,Vt(o),Vt(c),De,Ae))}}}if(si.show&&ei)if(null!=t){let[e,l]=ji.scales,[n,i]=ji.match,[s,a]=t.cursor.sync.scales,o=t.cursor.drag;if(ni=o._x,ii=o._y,ni||ii){let o,c,h,d,f,{left:p,top:m,width:g,height:b}=t.select,v=t.scales[s].ori,w=t.posToVal,y=null!=e&&n(e,s),x=null!=l&&i(l,a);y&&ni?(0==v?(o=p,c=g):(o=m,c=b),h=M[e],d=K(w(o,s),h,r,0),f=K(w(o+c,s),h,r,0),bi(jt(d,f),Wt(f-d))):bi(0,r),x&&ii?(1==v?(o=p,c=g):(o=m,c=b),h=M[l],d=J(w(o,a),h,u,0),f=J(w(o+c,a),h,u,0),vi(jt(d,f),Wt(f-d))):vi(0,u)}else Ti()}else{let t=Wt(Bn-jn),e=Wt(Yn-On);if(1==N.ori){let l=t;t=e,e=l}ni=li.x&&t>=li.dist,ii=li.y&&e>=li.dist;let l,n,i=li.uni;null!=i?ni&&ii&&(ni=t>=i,ii=e>=i,ni||ii||(e>t?ii=!0:ni=!0)):li.x&&li.y&&(ni||ii)&&(ni=ii=!0),ni&&(0==N.ori?(l=Rn,n=Gn):(l=Hn,n=Un),bi(jt(l,n),Wt(n-l)),ii||vi(0,u)),ii&&(1==N.ori?(l=Rn,n=Gn):(l=Hn,n=Un),vi(jt(l,n),Wt(n-l)),ni||bi(0,r)),ni||ii||(bi(0,0),vi(0,0))}if(li._x=ni,li._y=ii,null==t){if(n){if(null!=Oi){let[t,e]=ji.scales;ji.values[0]=null!=t?pi(0==N.ori?Gn:Un,t):null,ji.values[1]=null!=e?pi(1==N.ori?Gn:Un,e):null}Hi(R,s,Gn,Un,De,Ae,i)}if(dl){let t=n&&ji.setSeries,e=hl.prox;null==di?ci<=e&&ui(hi,fi,!0,t):ci>e?ui(null,fi,!0,t):hi!=di&&ui(hi,fi,!0,t)}}Ke&&(wt.idx=i,wi()),!1!==l&&$i("setCursor")}s.setLegend=wi;let _i=null;function ki(t=!1){t?_i=null:(_i=g.getBoundingClientRect(),$i("syncRect",_i))}function Mi(t,e,l,n,i,s,a){Tt._lock||ei&&null!=t&&0==t.movementX&&0==t.movementY||(Si(t,e,l,n,i,s,a,!1,null!=t),null!=t?xi(null,!0,!0):xi(e,!0,!1))}function Si(t,e,l,n,i,a,o,r,c){if(null==_i&&ki(!1),Ze(t),null!=t)l=t.clientX-_i.left,n=t.clientY-_i.top;else{if(l<0||n<0)return Gn=-10,void(Un=-10);let[t,s]=ji.scales,o=e.cursor.sync,[r,c]=o.values,[h,d]=o.scales,[f,p]=ji.match,m=e.axes[0].side%2==1,g=0==N.ori?De:Ae,b=1==N.ori?De:Ae,v=m?a:i,w=m?i:a,y=m?n:l,x=m?l:n;if(l=null!=h?f(t,h)?u(r,M[t],g,0):-10:g*(y/v),n=null!=d?p(s,d)?u(c,M[s],b,0):-10:b*(x/w),1==N.ori){let t=l;l=n,n=t}}!c||null!=e&&e.cursor.event.type!=R||((l<=1||l>=De-1)&&(l=se(l,De)),(n<=1||n>=Ae-1)&&(n=se(n,Ae))),r?(jn=l,On=n,[Rn,Hn]=Tt.move(s,l,n)):(Gn=l,Un=n)}Object.defineProperty(s,"rect",{get:()=>(null==_i&&ki(!1),_i)});const Ci={width:0,height:0,left:0,top:0};function Ti(){oi(Ci,!1)}let Di,Ai,Ei,Ni;function Pi(t,e,l,n,i,a,o){ei=!0,ni=ii=li._x=li._y=!1,Si(t,e,l,n,i,a,0,!0,!1),null!=t&&(xe(B,Z,Li,!1),Hi(H,s,Rn,Hn,De,Ae,null));let{left:r,top:u,width:c,height:h}=si;Di=r,Ai=u,Ei=c,Ni=h}function Li(t,e,l,n,i,a,o){ei=li._x=li._y=!1,Si(t,e,l,n,i,a,0,!1,!0);let{left:r,top:u,width:c,height:h}=si,d=c>0||h>0,f=Di!=r||Ai!=u||Ei!=c||Ni!=h;if(d&&f&&oi(si),li.setScale&&d&&f){let t=r,e=c,l=u,n=h;if(1==N.ori&&(t=u,e=h,l=r,n=c),ni&&ri(C,pi(t,C),pi(t+e,C)),ii)for(let i in M){let t=M[i];i!=C&&null==t.from&&t.min!=Ut&&ri(i,pi(l+n,i),pi(l,i))}Ti()}else Tt.lock&&(Tt._lock=!Tt._lock,xi(e,!0,null!=t));null!=t&&(Me(B,Z),Hi(B,s,Gn,Un,De,Ae,null))}function zi(t,e,l,n,i,a,o){Tt._lock||(Ze(t),an(),Ti(),null!=t&&Hi(U,s,Gn,Un,De,Ae,null))}function Fi(){k.forEach(Nn),Xe(s.width,s.height,!0)}gt(X,Q,Fi);const Wi={};Wi.mousedown=Pi,Wi.mousemove=Mi,Wi.mouseup=Li,Wi.dblclick=zi,Wi.setSeries=(t,e,l,n)=>{-1!=(l=(0,ji.match[2])(s,e,l))&&ui(l,n,!0,!1)},Nt&&(xe(H,g,Pi),xe(R,g,Mi),xe(Y,g,t=>{Ze(t),ki(!1)}),xe(G,g,function(t,e,l,n,i,s,a){if(Tt._lock)return;Ze(t);let o=ei;if(ei){let t,e,l=!0,n=!0,i=10;0==N.ori?(t=ni,e=ii):(t=ii,e=ni),t&&e&&(l=Gn<=i||Gn>=De-i,n=Un<=i||Un>=Ae-i),t&&l&&(Gn=Gn<Rn?0:De),e&&n&&(Un=Un<Hn?0:Ae),xi(null,!0,!0),ei=!1}Gn=-10,Un=-10,mt.fill(null),xi(null,!0,!0),o&&(ei=o)}),xe(U,g,zi),bn.add(s),s.syncRect=ki);const Ii=s.hooks=t.hooks||{};function $i(t,e,l){Xn?qn.push([t,e,l]):t in Ii&&Ii[t].forEach(t=>{t.call(null,s,e,l)})}(t.plugins||[]).forEach(t=>{for(let e in t.hooks)Ii[e]=(Ii[e]||[]).concat(t.hooks[e])});const Vi=(t,e,l)=>l,ji=ke({key:null,setSeries:!1,filters:{pub:ee,sub:ee},scales:[C,y[1]?y[1].scale:null],match:[le,le,Vi],values:[null,null]},Tt.sync);2==ji.match.length&&ji.match.push(Vi),Tt.sync=ji;const Oi=ji.key,Ri=Bl(Oi);function Hi(t,e,l,n,i,s,a){ji.filters.pub(t,e,l,n,i,s,a)&&Ri.pub(t,e,l,n,i,s,a)}function Bi(){$i("init",t,e),sn(e||t.data,!1),tt[C]?ti(C,tt[C]):an(),Ue=si.show&&(si.width>0||si.height>0),Ge=Ke=!0,Xe(t.width,t.height)}return Ri.sub(s),s.pub=function(t,e,l,n,i,s,a){ji.filters.sub(t,e,l,n,i,s,a)&&Wi[t](null,e,l,n,i,s,a)},s.destroy=function(){Ri.unsub(s),bn.delete(s),ye.clear(),bt(X,Q,Fi),h.remove(),null==Lt||Lt.remove(),$i("destroy")},y.forEach(wl),k.forEach(function(t,e){if(t._show=t.show,t.show){let l=t.side%2,n=M[t.scale];null==n&&(t.scale=l?y[1].scale:C,n=M[t.scale]);let i=n.time;t.size=Jt(t.size),t.space=Jt(t.space),t.rotate=Jt(t.rotate),me(t.incrs)&&t.incrs.forEach(t=>{!ue.has(t)&&ue.set(t,ce(t))}),t.incrs=Jt(t.incrs||(2==n.distr?je:i?1==w?Qe:ll:Oe)),t.splits=Jt(t.splits||(i&&1==n.distr?ct:3==n.distr?Sl:4==n.distr?Cl:Ml)),t.stroke=Jt(t.stroke),t.grid.stroke=Jt(t.grid.stroke),t.ticks.stroke=Jt(t.ticks.stroke),t.border.stroke=Jt(t.border.stroke);let a=t.values;t.values=me(a)&&!me(a[0])?Jt(a):i?me(a)?al(lt,sl(a,rt)):be(a)?function(t,e){let l=ze(e);return(e,n,i,s,a)=>n.map(e=>l(t(e)))}(lt,a):a||dt:a||kl,t.filter=Jt(t.filter||(n.distr>=3&&10==n.log?Pl:3==n.distr&&2==n.log?Ll:Qt)),t.font=En(t.font),t.labelFont=En(t.labelFont),t._size=t.size(s,null,e,0),t._space=t._rotate=t._incrs=t._found=t._splits=t._values=null,t._size>0&&(yl[e]=!0,t._el=ot("u-axis",p))}}),l?l instanceof HTMLElement?(l.appendChild(h),Bi()):l(s,Bi):Bi(),s}Pn.assign=ke,Pn.fmtNum=Lt,Pn.rangeNum=At,Pn.rangeLog=Mt,Pn.rangeAsinh=St,Pn.orient=Yl,Pn.pxRatio=et,Pn.join=function(t,e){if(function(t){let e=t[0][0],l=e.length;for(let n=1;n<t.length;n++){let i=t[n][0];if(i.length!=l)return!1;if(i!=e)for(let t=0;t<l;t++)if(i[t]!=e[t])return!1}return!0}(t)){let e=t[0].slice();for(let l=1;l<t.length;l++)e.push(...t[l].slice(1));return function(t,e=100){const l=t.length;if(l<=1)return!0;let n=0,i=l-1;for(;n<=i&&null==t[n];)n++;for(;i>=n&&null==t[i];)i--;if(i<=n)return!0;const s=Ot(1,It((i-n+1)/e));for(let a=t[n],o=n+s;o<=i;o+=s){const e=t[o];if(null!=e){if(e<=a)return!1;a=e}}return!0}(e[0])||(e=function(t){let e=t[0],l=e.length,n=Array(l);for(let s=0;s<n.length;s++)n[s]=s;n.sort((t,l)=>e[t]-e[l]);let i=[];for(let s=0;s<t.length;s++){let e=t[s],a=Array(l);for(let t=0;t<l;t++)a[t]=e[n[t]];i.push(a)}return i}(e)),e}let l=new Set;for(let a=0;a<t.length;a++){let e=t[a][0],n=e.length;for(let t=0;t<n;t++)l.add(e[t])}let n=[Array.from(l).sort((t,e)=>t-e)],i=n[0].length,s=new Map;for(let a=0;a<i;a++)s.set(n[0][a],a);for(let a=0;a<t.length;a++){let l=t[a],o=l[0];for(let t=1;t<l.length;t++){let r=l[t],u=Array(i).fill(void 0),c=e?e[a][t]:1,h=[];for(let t=0;t<r.length;t++){let e=r[t],l=s.get(o[t]);null===e?0!=c&&(u[l]=e,2==c&&h.push(l)):u[l]=e}Me(u,h,i),n.push(u)}}return n},Pn.fmtDate=ze,Pn.tzDate=function(t,e){let l;return"UTC"==e||"Etc/UTC"==e?l=new Date(+t+6e4*t.getTimezoneOffset()):e==Fe?l=t:(l=new Date(t.toLocaleString("en-US",{timeZone:e})),l.setMilliseconds(t.getMilliseconds())),l},Pn.sync=Bl;{Pn.addGap=function(t,e,l){let n=t[t.length-1];n&&n[0]==e?n[1]=l:t.push([e,l])},Pn.clipGaps=Xl;let t=Pn.paths={points:cn};t.linear=pn,t.stepped=function(t){const e=Et(t.align,1),l=Et(t.ascDesc,!1),n=Et(t.alignGaps,0),i=Et(t.extend,!1);return(t,s,a,o)=>Yl(t,s,(r,u,c,h,d,f,p,m,g,b,v)=>{[a,o]=_t(c,a,o);let w=r.pxRound,{left:y,width:x}=t.bbox,_=t=>w(f(t,h,b,m)),k=t=>w(p(t,d,v,g)),M=0==h.ori?en:ln;const S={stroke:new Path2D,fill:null,clip:null,band:null,gaps:null,flags:1},C=S.stroke,T=h.dir*(0==h.ori?1:-1);let D=k(c[1==T?a:o]),A=_(u[1==T?a:o]),E=A,N=A;i&&-1==e&&(N=y,M(C,N,D)),M(C,A,D);for(let t=1==T?a:o;t>=a&&t<=o;t+=T){let l=c[t];if(null==l)continue;let n=_(u[t]),i=k(l);1==e?M(C,n,D):M(C,E,i),M(C,n,i),D=i,E=n}let P=E;i&&1==e&&(P=y+x,M(C,P,D));let[L,z]=Gl(t,s);if(null!=r.fill||0!=L){let e=S.fill=new Path2D(C),l=k(r.fillTo(t,s,r.min,r.max,L));M(e,P,l),M(e,N,l)}if(!r.spanGaps){let i=[];i.push(...ql(u,c,a,o,T,_,n));let d=r.width*et/2,f=l||1==e?d:-d,p=l||-1==e?-d:d;i.forEach(t=>{t[0]+=f,t[1]+=p}),S.gaps=i=r.gaps(t,s,a,o,i),S.clip=Xl(i,h.ori,m,g,b,v)}return 0!=z&&(S.band=2==z?[Kl(t,s,a,o,C,-1),Kl(t,s,a,o,C,1)]:Kl(t,s,a,o,C,z)),S})},t.bars=function(t){const e=Et((t=t||de).size,[.6,Ut,1]),l=t.align||0,n=t.gap||0;let i=t.radius;i=null==i?[0,0]:"number"==typeof i?[i,0]:i;const s=Jt(i),a=1-e[0],o=Et(e[1],Ut),r=Et(e[2],1),u=Et(t.disp,de),c=Et(t.each,t=>{}),{fill:h,stroke:d}=u;return(t,e,i,f)=>Yl(t,e,(p,m,g,b,v,w,y,x,_,k,M)=>{var S,C;let T,D,A=p.pxRound,E=l,N=n*et,P=o*et,L=r*et;0==b.ori?[T,D]=s(t,e):[D,T]=s(t,e);const z=b.dir*(0==b.ori?1:-1);let F,W,I,$=0==b.ori?nn:sn,V=0==b.ori?c:(t,e,l,n,i,s,a)=>{c(t,e,l,i,n,a,s)},j=Et(t.bands,fe).find(t=>t.series[0]==e),O=null!=j?j.dir:0,R=p.fillTo(t,e,p.min,p.max,O),H=A(y(R,v,M,_)),B=k,Y=A(p.width*et),G=!1,U=null,K=null,X=null,q=null;null==h||0!=Y&&null==d||(G=!0,U=h.values(t,e,i,f),K=new Map,new Set(U).forEach(t=>{null!=t&&K.set(t,new Path2D)}),Y>0&&(X=d.values(t,e,i,f),q=new Map,new Set(X).forEach(t=>{null!=t&&q.set(t,new Path2D)})));let{x0:J,size:Z}=u;if(null!=J&&null!=Z){E=1,m=J.values(t,e,i,f),2==J.unit&&(m=m.map(e=>t.posToVal(x+e*k,b.key,!0)));let l=Z.values(t,e,i,f);W=2==Z.unit?l[0]*k:w(l[0],b,k,x)-w(0,b,k,x),B=mn(m,g,w,b,k,x,B),I=B-W+N}else B=mn(m,g,w,b,k,x,B),I=B*a+N,W=B-I;I<1&&(I=0),Y>=W/2&&(Y=0),I<5&&(A=Zt);let Q=I>0;W=A(Xt(B-I-(Q?Y:0),L,P)),F=(0==E?W/2:E==z?0:W)-E*z*((0==E?N/2:0)+(Q?Y/2:0));const tt={stroke:null,fill:null,clip:null,band:null,gaps:null,flags:0},lt=G?null:new Path2D;let nt=null;if(null!=j)nt=t.data[j.series[1]];else{let{y0:l,y1:n}=u;null!=l&&null!=n&&(g=n.values(t,e,i,f),nt=l.values(t,e,i,f))}let it=T*W,st=D*W;for(let l=1==z?i:f;l>=i&&l<=f;l+=z){let n=g[l];if(null==n)continue;if(null!=nt){let t=null!=(S=nt[l])?S:0;if(n-t==0)continue;H=y(t,v,M,_)}let i=w(2!=b.distr||null!=u?m[l]:l,b,k,x),s=y(Et(n,R),v,M,_),a=A(i-F),o=A(Ot(s,H)),r=A(jt(s,H)),c=o-r;if(null!=n){let i=n<0?st:it,s=n<0?it:st;G?(Y>0&&null!=X[l]&&$(q.get(X[l]),a,r+It(Y/2),W,Ot(0,c-Y),i,s),null!=U[l]&&$(K.get(U[l]),a,r+It(Y/2),W,Ot(0,c-Y),i,s)):$(lt,a,r+It(Y/2),W,Ot(0,c-Y),i,s),V(t,e,l,a-Y/2,r,W+Y,c)}}return Y>0?tt.stroke=G?q:lt:G||(tt._fill=0==p.width?p._fill:null!=(C=p._stroke)?C:p._fill,tt.width=0),tt.fill=G?K:lt,tt})},t.spline=function(t){return function(t,e){const l=Et(null==e?void 0:e.alignGaps,0);return(e,n,i,s)=>Yl(e,n,(a,o,r,u,c,h,d,f,p,m,g)=>{[i,s]=_t(r,i,s);let b,v,w,y=a.pxRound,x=t=>y(h(t,u,m,f)),_=t=>y(d(t,c,g,p));0==u.ori?(b=Ql,w=en,v=rn):(b=tn,w=ln,v=un);const k=u.dir*(0==u.ori?1:-1);let M=x(o[1==k?i:s]),S=M,C=[],T=[];for(let t=1==k?i:s;t>=i&&t<=s;t+=k)if(null!=r[t]){let e=x(o[t]);C.push(S=e),T.push(_(r[t]))}const D={stroke:t(C,T,b,w,v,y),fill:null,clip:null,band:null,gaps:null,flags:1},A=D.stroke;let[E,N]=Gl(e,n);if(null!=a.fill||0!=E){let t=D.fill=new Path2D(A),l=_(a.fillTo(e,n,a.min,a.max,E));w(t,S,l),w(t,M,l)}if(!a.spanGaps){let t=[];t.push(...ql(o,r,i,s,k,x,l)),D.gaps=t=a.gaps(e,n,i,s,t),D.clip=Xl(t,u.ori,f,p,m,g)}return 0!=N&&(D.band=2==N?[Kl(e,n,i,s,A,-1),Kl(e,n,i,s,A,1)]:Kl(e,n,i,s,A,N)),D})}(gn,t)}}const Ln="[KurvaSUPlot]",zn={height:520,enableCostView:!0};class Fn{constructor(t,e={}){this.state=t,this.options=r(r({},zn),e),this.viewMode="progress",this.chartInstance=null,this.container=null,this.tooltipEl=null,this.resizeHandler=null,this.resizeObserver=null,this.themeObserver=null,this.currentDataset=null,this.costData=null,this.isLoadingCostData=!1,this._interactionAttached=!1,this._wheelHandler=null,this._interactionTarget=null,this._scaleBounds=null,this._dateFormatter=null}initialize(t){if(!t)return console.error(Ln,"Container element is required"),!1;this.container=t,"static"===getComputedStyle(t).position&&(this.container.style.position="relative"),this._createTooltip(),this.themeObserver=function(t){const e=new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"data-bs-theme"===e.attributeName){const e=document.documentElement.getAttribute("data-bs-theme");console.log("[ChartUtils] Theme changed to:",e),t(e)}})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),e}(()=>this._rebuild()),this.resizeHandler=function(t,e=150){let l=null;return function(){l&&clearTimeout(l),l=setTimeout(()=>{t(),l=null},e)}}(()=>this.resize()),window.addEventListener("resize",this.resizeHandler),this.resizeObserver=function(t,e){if(!t||"undefined"==typeof ResizeObserver)return null;const l=new ResizeObserver(l=>{for(const n of l)n.target===t&&e(n.contentRect)});return l.observe(t),l}(t,()=>this.resize());return this.update()||console.warn(Ln,"Unable to render Kurva-S chart (no dataset)"),!0}update(t){const e=t||x(this.state);if(!e)return!1;this.currentDataset=e,this.viewMode=e.viewMode||this.viewMode||"progress";const l=this._transformDataset(e),n="dark"===(document.documentElement.getAttribute("data-bs-theme")||"light")?{text:"#f8fafc",axis:"#cbd5e1",plannedLine:"#60a5fa",plannedArea:"rgba(96, 165, 250, 0.15)",actualLine:"#34d399",actualArea:"rgba(52, 211, 153, 0.18)",costActualLine:"#f87171",costActualArea:"rgba(248, 113, 113, 0.18)",gridLine:"#334155",background:"#1e293b"}:{text:"#1f2937",axis:"#374151",plannedLine:"#0d6efd",plannedArea:"rgba(13, 110, 253, 0.12)",actualLine:"#198754",actualArea:"rgba(25, 135, 84, 0.12)",costActualLine:"#dc3545",costActualArea:"rgba(220, 53, 69, 0.12)",gridLine:"#e5e7eb",background:"#ffffff"};if(this.chartInstance)this.chartInstance.setData(l),this._updateScaleBounds();else{const t=this._buildChartOptions(e,n);this.chartInstance=new Pn(t,l,this.container),this._updateScaleBounds(),this._attachInteractions()}return this._updateTooltipPosition(),!0}resize(){this.chartInstance&&this.container&&this.chartInstance.setSize({width:this.container.clientWidth||800,height:this.options.height})}toggleView(t){return c(this,null,function*(){const e=(t||("progress"===this.viewMode?"cost":"progress")).toLowerCase();if(e===this.viewMode)return!0;if("cost"===e){if(!this.options.enableCostView)return console.warn(Ln,"Cost view disabled on uPlot chart"),!1;if(!this.costData){if(!(yield this.fetchCostData()))return!1}const t=_(this.costData);return t?(this.viewMode="cost",this.update(t),!0):(console.warn(Ln,"Cost dataset not available"),!1)}return this.viewMode="progress",this.update(),!0})}dispose(){this._detachInteractions(),this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.themeObserver&&(this.themeObserver.disconnect(),this.themeObserver=null),this.tooltipEl&&(this.tooltipEl.remove(),this.tooltipEl=null)}_rebuild(){this.container&&(this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null),this.update(this.currentDataset))}fetchCostData(){return c(this,null,function*(){var t;if(!this.options.enableCostView)return console.log(Ln,"Cost view disabled"),null;const e=null==(t=this.state)?void 0:t.projectId;if(!e)return console.warn(Ln,"Cannot load cost data without project ID"),null;if(this.isLoadingCostData)return null;try{this.isLoadingCostData=!0;const t=`/detail_project/api/v2/project/${e}/kurva-s-harga/`,l=yield fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const n=yield l.json();if(null==n?void 0:n.error)throw new Error(n.error);return this.costData=n,console.log(Ln,"Cost data loaded for uPlot chart"),n}catch(l){return console.error(Ln,"Failed to load cost data:",l),null}finally{this.isLoadingCostData=!1}})}_transformDataset(t){const e=t.labels.map((t,e)=>e),l=t.planned.map(t=>Number(t)||0);if("cost"===t.viewMode&&Array.isArray(t.acSeries)){return[e,l,t.acSeries.map(t=>Number(t)||0)]}return[e,l,t.actual.map(t=>Number(t)||0)]}_buildChartOptions(t,e){var l;const n="cost"===t.viewMode&&Array.isArray(t.acSeries);return{width:(null==(l=this.container)?void 0:l.clientWidth)||800,height:this.options.height,scales:{x:{time:!1},y:{auto:!0}},axes:[{stroke:e.axis,grid:{stroke:e.gridLine},values:(e,l)=>l.map(e=>{if(!Number.isFinite(e))return"";const l=Math.round(e);return Math.abs(e-l)>.01||l<0||l>=t.labels.length?"":t.labels[l]||`Week ${l+1}`})},{stroke:e.axis,grid:{stroke:e.gridLine},label:n?"% of Total Cost":"Progress %",values:(t,e)=>e.map(t=>`${Math.round(t)}%`)}],legend:{show:!0},series:[{},{label:n?"Rencana (PV)":"Rencana",stroke:e.plannedLine,width:2,fill:e.plannedArea},n?{label:"Realisasi (AC)",stroke:e.costActualLine||e.actualLine,width:3,fill:e.costActualArea||e.actualArea}:{label:"Realisasi",stroke:e.actualLine,width:2,fill:e.actualArea}],cursor:{drag:{x:!0,y:!1},focus:{prox:32}},select:{show:!0},hooks:{ready:[()=>{this._updateScaleBounds(),this._attachInteractions()}],setCursor:[t=>this._updateTooltip(t)],setScale:[()=>this._updateTooltipPosition()],dblclick:[t=>{const e=t.data[0][0],l=t.data[0][t.data[0].length-1];t.setScale("x",{min:e,max:l})}]}}}_attachInteractions(){if(this._interactionAttached||!this.chartInstance)return;const t=this.chartInstance.over||this.container;t&&(this._interactionTarget=t,this._wheelHandler=t=>this._handleWheelInteraction(t),t.addEventListener("wheel",this._wheelHandler,{passive:!1}),this._interactionAttached=!0)}_detachInteractions(){this._interactionAttached&&this._interactionTarget&&this._wheelHandler&&this._interactionTarget.removeEventListener("wheel",this._wheelHandler),this._interactionAttached=!1,this._wheelHandler=null,this._interactionTarget=null}_handleWheelInteraction(t){var e;if(!this.chartInstance||!this._scaleBounds)return;const l=t.ctrlKey||t.metaKey,n=!l&&t.shiftKey;if(!l&&!n)return;t.preventDefault();const i=this._scaleBounds,s=(null==(e=this.chartInstance.scales)?void 0:e.x)||{},a=Number.isFinite(s.min)?s.min:i.min,o=Number.isFinite(s.max)?s.max:i.max;if(l){const e=.12,l=t.deltaY>0?1:-1,n=Math.max(.2,1+e*l),i=(this.chartInstance.over||this.container).getBoundingClientRect(),s=t.clientX-i.left,r=this.chartInstance.posToVal(s,"x"),u=Number.isFinite(r)?r:(a+o)/2,c=u-(u-a)*n,h=u+(o-u)*n;return void this._setScaleBounded(c,h)}const r=o-a,u=Math.max(1,.15*r),c=t.deltaY>0?u:-u;this._setScaleBounded(a+c,o+c)}_setScaleBounded(t,e){if(!this.chartInstance||!this._scaleBounds)return;const l=this._scaleBounds,n=l.max-l.min;if(n<=0)return;let i=Math.min(t,e),s=Math.max(t,e),a=Math.max(1,s-i);a>n&&(a=n),i=Math.max(l.min,Math.min(i,l.max-a)),s=i+a,s>l.max&&(s=l.max,i=s-a),this.chartInstance.setScale("x",{min:i,max:s})}_updateScaleBounds(){var t;if(!this.chartInstance||!Array.isArray(null==(t=this.chartInstance.data)?void 0:t[0]))return;const e=this.chartInstance.data[0];e.length&&(this._scaleBounds={min:e[0],max:e[e.length-1]})}_createTooltip(){const t=document.createElement("div");t.className="kurva-s-tooltip",t.style.position="absolute",t.style.pointerEvents="none",t.style.padding="8px 10px",t.style.borderRadius="6px",t.style.background="rgba(15, 23, 42, 0.85)",t.style.color="#fff",t.style.fontSize="12px",t.style.transform="translate(-50%, -100%)",t.style.opacity="0",t.style.transition="opacity 0.15s ease",this.tooltipEl=t,this.container.appendChild(t)}_updateTooltip(t){var e,l,n,i,s,a,o;if(!this.tooltipEl||!this.currentDataset)return;const r=t.cursor.idx;if(null==r||r<0||r>=this.currentDataset.labels.length)return void(this.tooltipEl.style.opacity="0");const u=(this.currentDataset.labels||[])[r]||`Week ${r+1}`,c=null!=(e=this.currentDataset.planned[r])?e:0,h=Array.isArray(this.currentDataset.details)?this.currentDataset.details:null,d=!h&&this.currentDataset.details?this.currentDataset.details:{},f=Number(d.totalCost||this.currentDataset.totalBiaya||0)||0,p=Array.isArray(d.weeklySummary)?d.weeklySummary:null,m=p?p[r]:null,g=[`<div style="font-weight:600;margin-bottom:4px;">${u}</div>`];if("cost"===(this.viewMode||this.currentDataset.viewMode)){const t=null!=(l=(Array.isArray(this.currentDataset.acSeries)?this.currentDataset.acSeries:this.currentDataset.actual||[])[r])?l:0,e=null!=(n=null==m?void 0:m.variancePercent)?n:Number((t-c).toFixed(2)),i=Array.isArray(d.weeks)?d.weeks[r]:null,s=Array.isArray(d.actualWeeks)?d.actualWeeks[r]:null,a=this._formatWeekRange(i,s),o="number"==typeof(null==m?void 0:m.plannedCostValue)?v(m.plannedCostValue):this._resolveCostAmount(i,c,f),u="number"==typeof(null==m?void 0:m.actualCostValue)?v(m.actualCostValue):this._resolveCostAmount(s,t,f),h="number"==typeof(null==m?void 0:m.varianceCostValue)?v(m.varianceCostValue):"",p=this._getVarianceColor(e);a&&g.push(`<div style="font-size:0.85em;color:#cbd5e1;margin-bottom:4px;">Periode: ${a}</div>`),g.push(`<div>Rencana (PV): <strong>${b(c)}</strong> <span style="color:#cbd5e1;font-size:0.85em;">(${o})</span></div>`,`<div>Realisasi (AC): <strong>${b(t)}</strong> <span style="color:#cbd5e1;font-size:0.85em;">(${u})</span></div>`,`<div>Variance: <strong style="color:${p};">${e>=0?"+":""}${e.toFixed(1)}%</strong>${h?` <span style="color:${p};font-size:0.85em;">(${h})</span>`:""}</div>`)}else{const t=null!=(i=this.currentDataset.actual[r])?i:0,e=Number((t-c).toFixed(2)),l=h?h[r]:null,n=(null==l?void 0:l.start)?this._formatDateLabel(l.start):"",s=(null==l?void 0:l.end)?this._formatDateLabel(l.end):"",a=this._composeRangeText(n,s),o=Boolean(this.currentDataset.useHargaCalculation&&f>0),u="number"==typeof(null==l?void 0:l.plannedCostValue)?l.plannedCostValue:f*c/100,d="number"==typeof(null==l?void 0:l.actualCostValue)?l.actualCostValue:f*t/100,p=o?v(u||0):"",m=o?v(d||0):"",w=o&&"number"==typeof(null==l?void 0:l.varianceCostValue)?v(l.varianceCostValue):o?v((d||0)-(u||0)):"",y=this._getVarianceColor(e);a&&g.push(`<div style="font-size:0.85em;color:#cbd5e1;margin-bottom:4px;">Periode: ${a}</div>`),g.push(`<div>Rencana: <strong>${b(c)}</strong>${o?` <span style="color:#cbd5e1;font-size:0.85em;">(${p})</span>`:""}</div>`),g.push(`<div>Realisasi: <strong>${b(t)}</strong>${o?` <span style="color:#cbd5e1;font-size:0.85em;">(${m})</span>`:""}</div>`),g.push(`<div>Variance: <strong style="color:${y};">${e>=0?"+":""}${e.toFixed(1)}%</strong>${o?` <span style="color:${y};font-size:0.85em;">(${w})</span>`:""}</div>`)}this.tooltipEl.innerHTML=g.join("");const w=t.data[0][r],y=t.valToPos(w,"x"),x=Math.min(2,t.data.length-1);let _=null==(s=t.data[x])?void 0:s[r];Number.isFinite(_)||(_=null!=(o=null==(a=t.data[1])?void 0:a[r])?o:0);const k=t.valToPos(_,"y");this.tooltipEl.style.left=`${y}px`,this.tooltipEl.style.top=`${k}px`,this.tooltipEl.style.opacity="1"}_updateTooltipPosition(){if(!this.chartInstance||!this.tooltipEl)return;const{idx:t}=this.chartInstance.cursor;null!=t&&this._updateTooltip(this.chartInstance)}_formatDateLabel(t){if(!t)return"";let e=t;if(t instanceof Date||(e=new Date(t)),!(e instanceof Date)||Number.isNaN(e.getTime()))return"";if(!this._dateFormatter&&"undefined"!=typeof Intl&&"function"==typeof Intl.DateTimeFormat)try{this._dateFormatter=new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"short",year:"numeric"})}catch(l){console.warn(Ln,"Intl.DateTimeFormat unavailable, falling back to basic formatter:",l),this._dateFormatter=null}if(this._dateFormatter)return this._dateFormatter.format(e);return`${String(e.getDate()).padStart(2,"0")}/${String(e.getMonth()+1).padStart(2,"0")}/${e.getFullYear()}`}_formatWeekRange(t,e){const l=(null==t?void 0:t.week_start)||(null==e?void 0:e.week_start),n=(null==t?void 0:t.week_end)||(null==e?void 0:e.week_end),i=l?this._formatDateLabel(new Date(l)):"",s=n?this._formatDateLabel(new Date(n)):"";return this._composeRangeText(i,s)}_composeRangeText(t,e){return t&&e?`${t} - ${e}`:t||e||""}_getVarianceColor(t){return t>.1?"#f87171":t<-.1?"#22c55e":"#cbd5e1"}_resolveCostAmount(t,e,l){if(t){const e=this._parseNumber(t.cumulative_cost);if(Number.isFinite(e)&&e>0)return v(e);const l=this._parseNumber(t.cost);if(Number.isFinite(l)&&l>0)return v(l)}return!Number.isFinite(l)||l<=0?v(0):v(l*e/100)}_parseNumber(t){if("number"==typeof t)return t;if("string"==typeof t){const e=Number(t);return Number.isFinite(e)?e:NaN}return NaN}}const Wn=Object.freeze(Object.defineProperty({__proto__:null,KurvaSUPlotChart:Fn,default:Fn},Symbol.toStringTag,{value:"Module"}));export{A as B,h as G,T as K,E as T,x as b,C as d,N as i,Wn as u};
//# sourceMappingURL=chart-modules-C7fXYRml.js.map
