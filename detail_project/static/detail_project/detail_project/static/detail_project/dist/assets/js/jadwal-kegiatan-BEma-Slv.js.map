{"version":3,"mappings":"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","names":["GanttCanvasOverlay","constructor","tableManager","this","canvas","document","createElement","className","style","cssText","ctx","getContext","visible","barData","dependencies","barRects","tooltip","scrollTarget","_a","bodyScroll","addEventListener","syncWithTable","passive","_bindPointerEvents","show","scrollArea","position","appendChild","hide","parentNode","removeChild","_hideTooltip","width","scrollWidth","height","scrollHeight","cellRects","getCellBoundingRects","clearRect","strokeStyle","forEach","rect","strokeRect","x","y","_drawBars","_drawDependencies","renderBars","Array","isArray","renderDependencies","dependencyData","length","bar","find","c","pekerjaanId","columnId","maxWidth","paddingX","Math","max","paddingY","plannedValue","Number","isFinite","planned","min","actualValue","actual","value","plannedWidth","fillStyle","fillRect","actualWidth","barColor","color","_resolveVarianceColor","variance","push","label","dep","fromRect","fromPekerjaanId","fromColumnId","toRect","toPekerjaanId","toColumnId","fromX","fromY","toX","toY","lineWidth","beginPath","moveTo","lineTo","stroke","angle","atan2","cos","PI","sin","closePath","fill","e","getBoundingClientRect","clientX","left","clientY","top","hit","_hitTest","_showTooltip","b","_ensureTooltip","body","tip","name","innerHTML","display","UnifiedTableManager","state","options","currentMode","tanstackGrid","overlays","gantt","kurva","mount","container","domTargets","TanStackGridManager","setCellRenderer","updateData","payload","_refreshGanttOverlay","switchMode","newMode","targetRenderer","grid","_b","call","_buildBarData","tree","currentRows","columns","timeColumns","currentColumns","stateManager","stateManagerInstance","_c","plannedMap","_e","states","_d","assignmentMap","Map","actualMap","_g","_f","row","id","raw","pekerjaan_id","nama","col","meta","columnMeta","timeColumn","fieldId","cellKey","get","getTimeCellValue","JadwalKegiatanApp","initialized","gridManager","StateManager","getInstance","dataLoader","timeColumnGenerator","saveHandler","unifiedManager","unifiedGanttManager","kurvaSChart","ganttChart","ganttFrozenGrid","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_stateManagerListener","_suppressStateManagerEvent","_currencyFormatter","_getProjectDateRange","start","end","projectStart","parsed","Date","isNaN","getTime","projectEnd","parsedEnd","getFullYear","_estimateExpectedWeeklyColumns","diffDays","floor","ceil","_countWeeklyColumns","filter","mode","generationMode","type","toLowerCase","weekNumber","week_number","initialize","__async","arguments","config","console","warn","log","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","window","error","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","Set","volumeMap","isLoading","domRefs","apiEndpoints","projectId","projectName","useUPlotKurva","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","progressMode","displayMode","useUnifiedTable","disableUnifiedTable","keepLegacyGantt","enableLegacyGantt","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","_bindStateManagerEvents","getCurrentState","defineProperty","modifiedCells","configurable","costAssignmentMap","costModifiedCells","hasUnsavedChanges","set","event","_handleStateManagerEvent","_unbindStateManagerEvents","removeEventListener","_applyProgressModeSwitch","showToast","_handleStateCommitEvent","_handleStateResetEvent","refreshCells","_updateStatusBar","_updateCharts","modeLabel","_syncToolbarRadios","_syncGridViews","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","size","disabled","classList","toggle","Boolean","setAttribute","removeAttribute","root","getElementById","refreshButton","resetButton","tanstackGridContainer","tanstackGridBody","tanstackGridTopScroll","tanstackGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","querySelector","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","Error","_applyDataset","rootElement","dataset","allowedTimeScales","datasetScale","defaultTimeScale","toString","has","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","weekend","weekEnd","week_end_day","parsedWeekStartDay","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","volume","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","reset","apiResetProgress","enableUplotKurva","_attachToolbarEvents","_initTanStackGridIfNeeded","saveChanges","refresh","_handleResetProgress","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","KeyboardShortcuts","register","Toast","info","description","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","warning","querySelectorAll","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","preventDefault","_showKeyboardShortcutsHelp","getShortcuts","initializeUXEnhancements","modalHtml","map","s","key","replace","join","existingModal","remove","insertAdjacentHTML","Modal","ExportManager","format","button","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","enableCostView","toggleView","_setCostToggleButtonState","viewMode","add","isCostMode","iconClass","textContent","_activateDefaultCostView","groupName","handler","radios","radio","target","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","confirm","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","text","catch","status","result","json","_resetEditedCellsState","clear","_clearFailedRows","message","forceReload","String","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_recalculateAllProgressTotals","_invalidateCachedDataset","flatPekerjaan","clearTimeout","setTimeout","then","data","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","__spreadValues","successMessage","next","pyDay","isChecked","nextElementSibling","matches","_updateCostToggleAvailability","setInputMode","oldMode","oldStats","getStats","newStats","toUpperCase","modifiedCount","assignmentCount","nextMode","previousInputMode","_updateProgressModeIndicator","indicator","bgClass","isActual","nextScale","_renderGrid","bind","onCellChange","_handleGridCellChange","getCellValidationState","_getCellValidationState","topScroll","topScrollInner","DataLoader","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","_i","_h","loadAssignments","_loadKurvaSData","_j","_k","_l","_initializeCharts","statusText","hargaMap","entries","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","keys","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","_loadChartModules","kurvaSModule","import","n","u","__VITE_PRELOAD__","KurvaSChartClass","KurvaSUPlotChart","default","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","ganttContainer","_initializeUnifiedGanttOverlay","Promise","resolve","ganttView","ganttTab","_initializeFrozenGantt","stack","GanttFrozenGrid","rowHeight","success","host","minHeight","gridPayload","_getDisplayTimeColumns","_prepareGanttData","pekerjaanNodes","node","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","column_id","actualVal","round","klasifikasi_id","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_id","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_name","pekerjaan_kode","kode","tgl_mulai_rencana","tgl_selesai_rencana","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_rencana","progress_realisasi","satuan","projectMeta","project_id","project_name","start_date","end_date","project","milestones","_setupLazyChartLoading","_bindUnifiedTabSync","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","scrollTop","deltaY","_escapeHtml","char","_validateRowTotalsBeforeSave","ButtonStateManager","setLoading","setSuccess","setError","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","duration","toast","_buildTimeColumns","tahap","index","rawId","order","urutan","startDate","tanggal_mulai","endDate","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","_fetchJson","_0","url","errorText","displayColumns","activeTimeColumns","updateTopScrollMetrics","_renderLegacyGrid","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","from","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","delete","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","_calculateRowTotalPercent","total","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","isValid","level","changed","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","_getRowCostCapacity","costFields","field","_getMergedCostCells","modeState","merged","_calculateAllCostTotals","totals","split","_formatCurrency","Intl","NumberFormat","currency","maximumFractionDigits","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","costViolations","totalCost","combined","concat","messages","slice","pekerjaanCount","totalProgress","_calculateProjectProgress","aggregate","avg","pekerjaanTotals","numericValue","sum","_buildAssignmentsPayload","assignments","columnIndex","_parseCellKey","proportion","tahapan_id","_getSaveMode","fallback","fallbackSafe","baseColumns","weeklyColumns","includes","isWeeklyColumn","sourceColumns","_buildMonthlyColumns","aggregated","i","blockColumns","blockIndex","startWeek","endWeek","startLabel","rangeLabel","endLabel","_coerceDate","_m","_n","rangeText","_formatShortRange","childColumns","readOnly","date","getDate","padStart","getMonth","separatorIndex","indexOf","cookieValue","cookie","cookies","trim","substring","decodeURIComponent","displayValue","isVolumeMode","validation","valueType","normalizedValue","resolvedPekerjaanId","handlerUnifiedGantt","destroy","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/gantt/GanttCanvasOverlay.js","../../../../../../js/src/modules/unified/UnifiedTableManager.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["export class GanttCanvasOverlay {\n  constructor(tableManager) {\n    this.tableManager = tableManager;\n    this.canvas = document.createElement('canvas');\n    this.canvas.className = 'gantt-canvas-overlay';\n    this.canvas.style.cssText = `\n      position: absolute;\n      top: 0;\n      left: 0;\n      pointer-events: auto;\n      z-index: 10;\n    `;\n    this.ctx = this.canvas.getContext('2d');\n    this.visible = false;\n    this.barData = [];\n    this.dependencies = [];\n    this.barRects = [];\n    this.tooltip = null;\n\n    const scrollTarget = this.tableManager?.bodyScroll;\n    if (scrollTarget) {\n      scrollTarget.addEventListener('scroll', () => {\n        if (this.visible) {\n          this.syncWithTable();\n        }\n      }, { passive: true });\n    }\n\n    this._bindPointerEvents();\n  }\n\n  show() {\n    if (this.visible) return;\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n    scrollArea.style.position = scrollArea.style.position || 'relative';\n    scrollArea.appendChild(this.canvas);\n    this.visible = true;\n    this.syncWithTable();\n  }\n\n  hide() {\n    if (!this.visible) return;\n    if (this.canvas.parentNode) {\n      this.canvas.parentNode.removeChild(this.canvas);\n    }\n    this.visible = false;\n    this._hideTooltip();\n  }\n\n  syncWithTable() {\n    const scrollArea = this.tableManager?.bodyScroll;\n    if (!scrollArea) return;\n\n    this.canvas.width = scrollArea.scrollWidth;\n    this.canvas.height = scrollArea.scrollHeight;\n\n    const cellRects = typeof this.tableManager.getCellBoundingRects === 'function'\n      ? this.tableManager.getCellBoundingRects()\n      : [];\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.barRects = [];\n\n    // Skeleton visual aid: outline cells for alignment verification\n    this.ctx.strokeStyle = '#e2e8f0';\n    cellRects.forEach((rect) => {\n      this.ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);\n    });\n\n    this._drawBars(cellRects);\n    this._drawDependencies(cellRects);\n  }\n\n  renderBars(barData) {\n    this.barData = Array.isArray(barData) ? barData : [];\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  renderDependencies(dependencyData) {\n    this.dependencies = Array.isArray(dependencyData) ? dependencyData : [];\n    if (this.visible) {\n      this.syncWithTable();\n    }\n  }\n\n  _drawBars(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.barData.length === 0) {\n      return;\n    }\n    this.barData.forEach((bar) => {\n      const rect = cellRects.find(\n        (c) => c.pekerjaanId === bar.pekerjaanId && c.columnId === bar.columnId,\n      );\n      if (!rect) return;\n\n      const paddingX = 4;\n      const paddingY = 6;\n      const maxWidth = rect.width - paddingX * 2;\n      const x = rect.x + paddingX;\n      const y = rect.y + paddingY;\n      const height = Math.max(6, rect.height - paddingY * 2);\n\n      const plannedValue = Number.isFinite(bar.planned) ? Math.max(0, Math.min(100, bar.planned)) : null;\n      const actualValue = Number.isFinite(bar.actual) ? Math.max(0, Math.min(100, bar.actual)) : Math.max(0, Math.min(100, bar.value || 0));\n\n      if (plannedValue !== null) {\n        const plannedWidth = (plannedValue / 100) * maxWidth;\n        this.ctx.fillStyle = '#e2e8f0';\n        this.ctx.fillRect(x, y, plannedWidth, height);\n      }\n\n      const actualWidth = (actualValue / 100) * maxWidth;\n      const barColor = bar.color || this._resolveVarianceColor(bar.variance);\n      this.ctx.fillStyle = barColor;\n      this.ctx.fillRect(x, y, actualWidth, height);\n\n      this.barRects.push({\n        x,\n        y,\n        width: actualWidth,\n        height,\n        pekerjaanId: bar.pekerjaanId,\n        columnId: bar.columnId,\n        value: actualValue,\n        planned: plannedValue,\n        variance: bar.variance,\n        label: bar.label,\n        color: barColor,\n      });\n    });\n  }\n\n  _drawDependencies(cellRects) {\n    if (!Array.isArray(cellRects) || cellRects.length === 0 || this.dependencies.length === 0) {\n      return;\n    }\n\n    this.dependencies.forEach((dep) => {\n      const fromRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.fromPekerjaanId && c.columnId === dep.fromColumnId,\n      );\n      const toRect = cellRects.find(\n        (c) => c.pekerjaanId === dep.toPekerjaanId && c.columnId === dep.toColumnId,\n      );\n      if (!fromRect || !toRect) return;\n\n      const fromX = fromRect.x + fromRect.width;\n      const fromY = fromRect.y + fromRect.height / 2;\n      const toX = toRect.x;\n      const toY = toRect.y + toRect.height / 2;\n\n      this.ctx.strokeStyle = dep.color || '#94a3b8';\n      this.ctx.lineWidth = 1.5;\n      this.ctx.beginPath();\n      this.ctx.moveTo(fromX, fromY);\n      this.ctx.lineTo(toX, toY);\n      this.ctx.stroke();\n\n      const arrowSize = 5;\n      const angle = Math.atan2(toY - fromY, toX - fromX);\n      this.ctx.beginPath();\n      this.ctx.moveTo(toX, toY);\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle - Math.PI / 6), toY - arrowSize * Math.sin(angle - Math.PI / 6));\n      this.ctx.lineTo(toX - arrowSize * Math.cos(angle + Math.PI / 6), toY - arrowSize * Math.sin(angle + Math.PI / 6));\n      this.ctx.closePath();\n      this.ctx.fillStyle = dep.color || '#94a3b8';\n      this.ctx.fill();\n    });\n  }\n\n  _resolveVarianceColor(variance) {\n    if (!Number.isFinite(variance)) return '#3b82f6';\n    if (variance < -0.1) return '#ef4444';\n    if (variance > 0.1) return '#22c55e';\n    return '#3b82f6';\n  }\n\n  _bindPointerEvents() {\n    this.canvas.addEventListener('mousemove', (e) => {\n      if (!this.visible || !this.barRects.length) return;\n      const rect = this.canvas.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const hit = this._hitTest(x, y);\n      if (hit) {\n        this._showTooltip(e.clientX, e.clientY, hit);\n      } else {\n        this._hideTooltip();\n      }\n    });\n\n    this.canvas.addEventListener('mouseleave', () => {\n      this._hideTooltip();\n    });\n  }\n\n  _hitTest(x, y) {\n    return this.barRects.find(\n      (b) => x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height,\n    );\n  }\n\n  _ensureTooltip() {\n    if (this.tooltip) return this.tooltip;\n    this.tooltip = document.createElement('div');\n    this.tooltip.className = 'gantt-overlay-tooltip';\n    this.tooltip.style.cssText = `\n      position: fixed;\n      padding: 4px 8px;\n      background: rgba(17,24,39,0.85);\n      color: #f8fafc;\n      border-radius: 4px;\n      font-size: 12px;\n      pointer-events: none;\n      z-index: 20;\n      display: none;\n      box-shadow: 0 2px 8px rgba(0,0,0,0.25);\n    `;\n    document.body.appendChild(this.tooltip);\n    return this.tooltip;\n  }\n\n  _showTooltip(clientX, clientY, hit) {\n    const tip = this._ensureTooltip();\n    const name = hit.label || hit.pekerjaanId;\n    const planned = Number.isFinite(hit.planned) ? `${hit.planned}%` : '-';\n    const actual = Number.isFinite(hit.value) ? `${hit.value}%` : '-';\n    const variance = Number.isFinite(hit.variance) ? `${hit.variance}%` : '-';\n    tip.innerHTML = `Pekerjaan: ${name}<br/>Kolom: ${hit.columnId}<br/>Planned: ${planned}<br/>Actual: ${actual}<br/>Variance: ${variance}`;\n    tip.style.left = `${clientX + 10}px`;\n    tip.style.top = `${clientY + 10}px`;\n    tip.style.display = 'block';\n  }\n\n  _hideTooltip() {\n    if (this.tooltip) {\n      this.tooltip.style.display = 'none';\n    }\n  }\n}\n","import { TanStackGridManager } from '../grid/tanstack-grid-manager.js';\nimport { GanttCanvasOverlay } from '../gantt/GanttCanvasOverlay.js';\n\nexport class UnifiedTableManager {\n  constructor(state, options = {}) {\n    this.state = state || {};\n    this.options = options;\n    this.currentMode = 'grid';\n    this.tanstackGrid = null;\n    this.overlays = {\n      gantt: null,\n      kurva: null, // placeholder for future integration\n    };\n  }\n\n  mount(container, domTargets = {}) {\n    this.tanstackGrid = new TanStackGridManager(this.state, this.options);\n    this.tanstackGrid.mount(container, domTargets);\n    this.tanstackGrid.setCellRenderer('input');\n  }\n\n  updateData(payload) {\n    if (this.tanstackGrid) {\n      this.tanstackGrid.updateData(payload);\n      this._refreshGanttOverlay(payload);\n    }\n  }\n\n  switchMode(newMode) {\n    if (!newMode || newMode === this.currentMode || !this.tanstackGrid) {\n      return;\n    }\n    const rendererMap = {\n      grid: 'input',\n      gantt: 'gantt',\n      kurva: 'readonly',\n    };\n    const targetRenderer = rendererMap[newMode] || 'input';\n\n    // hide existing overlays\n    if (this.currentMode === 'gantt' && this.overlays.gantt) {\n      this.overlays.gantt.hide();\n    }\n    if (this.currentMode === 'kurva' && this.overlays.kurva) {\n      this.overlays.kurva.hide?.();\n    }\n\n    this.currentMode = newMode;\n    this.tanstackGrid.setCellRenderer(targetRenderer);\n\n    if (newMode === 'gantt') {\n      if (!this.overlays.gantt) {\n        this.overlays.gantt = new GanttCanvasOverlay(this.tanstackGrid);\n      }\n      this.overlays.gantt.show();\n      this._refreshGanttOverlay();\n    }\n\n    if (newMode === 'kurva') {\n      // Placeholder: kurva chart overlay can be initialized here later\n      if (this.overlays.kurva && typeof this.overlays.kurva.show === 'function') {\n        this.overlays.kurva.show();\n      }\n    }\n  }\n\n  _refreshGanttOverlay(payload = {}) {\n    if (!this.overlays.gantt || !this.tanstackGrid) {\n      return;\n    }\n    const barData = this._buildBarData(payload);\n    const dependencyData = payload.dependencies || [];\n    this.overlays.gantt.renderBars(barData);\n    this.overlays.gantt.renderDependencies(dependencyData);\n  }\n\n  _buildBarData(payload = {}) {\n    const tree = payload.tree || this.tanstackGrid.currentRows || [];\n    const columns = payload.timeColumns || this.tanstackGrid.currentColumns || [];\n    const barData = [];\n    const stateManager = this.state?.stateManager || this.state?.stateManagerInstance || this.options?.stateManager;\n    const plannedMap = stateManager?.states?.planned?.assignmentMap || new Map();\n    const actualMap = stateManager?.states?.actual?.assignmentMap || new Map();\n\n    tree.forEach((row) => {\n      const pekerjaanId = row.pekerjaanId || row.id || row.raw?.pekerjaan_id;\n      const label = row.name || row.raw?.nama || pekerjaanId;\n      if (!pekerjaanId) {\n        return;\n      }\n      columns.forEach((col) => {\n        const meta = col.meta?.columnMeta;\n        if (!col.meta?.timeColumn || !meta) {\n          return;\n        }\n        const columnId = col.fieldId || col.id;\n        const cellKey = `${pekerjaanId}-${columnId}`;\n        const plannedValue = plannedMap.get(cellKey) ?? this.tanstackGrid.getTimeCellValue(pekerjaanId, columnId, meta);\n        const actualValue = actualMap.get(cellKey) ?? plannedValue;\n        if ((!Number.isFinite(plannedValue) || plannedValue <= 0) && (!Number.isFinite(actualValue) || actualValue <= 0)) {\n          return;\n        }\n        const variance = (Number(actualValue) || 0) - (Number(plannedValue) || 0);\n        barData.push({\n          pekerjaanId,\n          columnId,\n          value: Number(actualValue) || 0,\n          planned: Number(plannedValue) || 0,\n          actual: Number(actualValue) || 0,\n          variance,\n          label,\n          color: '#4dabf7',\n        });\n      });\n    });\n\n    return barData;\n  }\n}\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { TanStackGridManager } from '@modules/grid/tanstack-grid-manager.js';\r\nimport { UnifiedTableManager } from '@modules/unified/UnifiedTableManager.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt (deprecated)\r\n// Gantt V2 (Frozen Column) now loaded lazily via dynamic import() - see _initializeFrozenGantt()\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.initialized = false;\r\n    this.gridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.saveHandler = null;\r\n    this.unifiedManager = null;\r\n    this.unifiedGanttManager = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated, not used)\r\n    this.ganttFrozenGrid = null; // Gantt V2: Frozen column architecture (default)\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n    this._stateManagerListener = null;\r\n    this._suppressStateManagerEvent = false;\r\n    this._currencyFormatter = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useUPlotKurva: true, // uPlot Kurva-S aktif secara default\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n        useUnifiedTable: config.disableUnifiedTable ? false : true,\r\n        // Default: legacy Gantt V2 tetap aktif; bisa dimatikan dengan config.disableLegacyGantt\r\n        keepLegacyGantt: config.enableLegacyGantt ? true : false,\n        dependencies: [],\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n    this._bindStateManagerEvents();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  _bindStateManagerEvents() {\r\n    if (!this.stateManager || this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this._stateManagerListener = (event) => this._handleStateManagerEvent(event);\r\n    this.stateManager.addEventListener(this._stateManagerListener);\r\n    console.log('[JadwalKegiatanApp] StateManager listener attached');\r\n  }\r\n\r\n  _unbindStateManagerEvents() {\r\n    if (!this.stateManager || !this._stateManagerListener) {\r\n      return;\r\n    }\r\n    this.stateManager.removeEventListener(this._stateManagerListener);\r\n    this._stateManagerListener = null;\r\n    console.log('[JadwalKegiatanApp] StateManager listener removed');\r\n  }\r\n\r\n  _handleStateManagerEvent(event = {}) {\r\n    if (!event || typeof event !== 'object') {\r\n      return;\r\n    }\r\n    switch (event.type) {\r\n      case 'mode-switch':\r\n        if (this._suppressStateManagerEvent) {\r\n          return;\r\n        }\r\n        this._applyProgressModeSwitch(event.newMode, { showToast: false });\r\n        break;\r\n      case 'commit':\r\n        this._handleStateCommitEvent(event);\r\n        break;\r\n      case 'reset':\r\n        this._handleStateResetEvent();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  _handleStateCommitEvent(event = {}) {\r\n    if (this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n    this._updateStatusBar();\r\n    this._updateCharts();\r\n    const modeLabel = (event.mode || this.state.progressMode || 'planned') === 'actual' ? 'Realisasi' : 'Perencanaan';\r\n    console.log(`[StateManager] Commit event processed for mode: ${modeLabel}`);\r\n  }\r\n\r\n  _handleStateResetEvent() {\r\n    console.log('[StateManager] Reset event received, syncing UI components');\r\n    this.state.progressMode = this.stateManager?.currentMode || 'planned';\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._updateStatusBar('Ready');\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        tanstackGridContainer: document.getElementById('tanstack-grid-container'),\r\n        tanstackGridBody: document.getElementById('tanstack-grid-body'),\r\n        tanstackGridTopScroll: document.getElementById('tanstack-grid-scroll-top'),\r\n        tanstackGridTopScrollInner: document.getElementById('tanstack-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (!domRefs.tanstackGridContainer) {\r\n      throw new Error('TanStack grid container #tanstack-grid-container tidak ditemukan');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    if (typeof dataset.enableUplotKurva !== 'undefined') {\r\n      this.state.useUPlotKurva = dataset.enableUplotKurva !== 'false';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    this._initTanStackGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    if (this.kurvaSChart?.options?.enableCostView === false) {\r\n      toggleBtn.classList.add('d-none');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    document.querySelectorAll('input[name=\"progressMode\"]').forEach((radio) => {\r\n      const isChecked = radio.value === progressMode;\r\n      if (radio.checked !== isChecked) {\r\n        radio.checked = isChecked;\r\n      }\r\n      const label = radio.nextElementSibling;\r\n      if (label && label.matches('.btn')) {\r\n        label.setAttribute('aria-selected', String(isChecked));\r\n      }\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.gridManager) {\r\n      this.gridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this._suppressStateManagerEvent = true;\r\n    this.stateManager.switchMode(normalized);\r\n    this._suppressStateManagerEvent = false;\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    this._applyProgressModeSwitch(normalized, { showToast: true });\r\n  }\r\n\r\n  _applyProgressModeSwitch(nextMode, options = {}) {\r\n    const normalized = nextMode === 'actual' ? 'actual' : 'planned';\r\n    const previousInputMode = this.state.inputMode || 'percentage';\r\n    this.state.progressMode = normalized;\r\n\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n    }\r\n\r\n    if (this.gridManager && typeof this.gridManager.setInputMode === 'function') {\r\n      const currentMode = this.state.inputMode || 'percentage';\r\n      if (currentMode !== previousInputMode) {\r\n        this.gridManager.setInputMode(currentMode);\r\n      }\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._updateCostToggleAvailability();\r\n    this._updateProgressModeIndicator(normalized);\r\n    this._syncGridViews();\r\n    this._updateCharts();\r\n\r\n    if (options.showToast) {\r\n      const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n      this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n    }\r\n  }\r\n\r\n  _updateProgressModeIndicator(mode) {\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (!indicator) {\r\n      return;\r\n    }\r\n    const normalized = mode === 'actual' ? 'actual' : 'planned';\r\n    const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n    const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n    indicator.textContent = `Mode: ${label}`;\r\n    indicator.className = `badge ${bgClass} ms-2`;\r\n    indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize TanStack Table grid when enabled\r\n   */\r\n  _initTanStackGridIfNeeded() {\r\n    const container = this.state.domRefs.tanstackGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] TanStack grid container not available');\r\n      return;\r\n    }\r\n\r\n    container.classList.remove('d-none');\r\n\r\n    if (this.state.useUnifiedTable) {\r\n      if (!this.unifiedManager) {\r\n        this.unifiedManager = new UnifiedTableManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n        });\r\n        this.unifiedManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    } else {\r\n      if (!this.gridManager) {\r\n        this.gridManager = new TanStackGridManager(this.state, {\r\n          showToast: this.showToast.bind(this),\r\n          onCellChange: (payload) => this._handleGridCellChange(payload),\r\n          getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n        });\r\n        this.gridManager.mount(container, {\r\n          topScroll: this.state.domRefs.tanstackGridTopScroll,\r\n          topScrollInner: this.state.domRefs.tanstackGridTopScrollInner,\r\n          body: this.state.domRefs.tanstackGridBody,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Step 3.6: Ensure dependencies array exists (for unified Gantt overlay)\r\n      this.state.dependencies = this.state.dependencies || [];\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    if (!this.state.useUPlotKurva) {\r\n      console.warn('[JadwalKegiatanApp] uPlot dimatikan, melewati inisialisasi chart');\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const kurvaSModule = await import('@modules/kurva-s/uplot-chart.js');\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSUPlotChart || kurvaSModule.default;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n          enableCostView: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart V2 (Frozen Column Architecture)\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    if (this.state.useUnifiedTable && this.state.keepLegacyGantt === false) {\r\n      console.log('[JadwalKegiatanApp] Unified mode active - rendering Gantt via unified table overlay');\r\n      const ganttContainer = document.getElementById('gantt-redesign-container');\r\n      if (!ganttContainer) {\r\n        console.warn('[JadwalKegiatanApp] Gantt container not found for unified overlay');\r\n        return;\r\n      }\r\n      await this._initializeUnifiedGanttOverlay(ganttContainer);\r\n      return;\r\n    }\r\n\r\n    // Check if already initialized\r\n    if (this.ganttFrozenGrid) {\r\n      console.log('[JadwalKegiatanApp] Gantt already initialized, skipping');\r\n      return;\r\n    }\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Initialize V2: Frozen Column Architecture (now default)\r\n      console.log(' Initializing Gantt V2 (Frozen Column)...');\r\n      await this._initializeFrozenGantt(ganttContainer);\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize V2: Frozen Column Gantt (Now Default)\r\n   * @private\r\n   */\r\n  async _initializeFrozenGantt(container) {\r\n    console.log('[JadwalKegiatanApp]  Container found:', container);\r\n\r\n    // Lazy load V2 module\r\n    const { GanttFrozenGrid } = await import('@modules/gantt-v2/gantt-frozen-grid.js');\r\n\r\n    // Create Gantt instance\r\n    this.ganttFrozenGrid = new GanttFrozenGrid(container, {\r\n      rowHeight: 40,\r\n      timeScale: 'week'\r\n    });\r\n\r\n    // Initialize with app context (provides StateManager, tahapanList, etc.)\r\n    await this.ganttFrozenGrid.initialize(this);\r\n\r\n    console.log('[JadwalKegiatanApp]  Gantt V2 (Frozen Column) initialized successfully!');\r\n    Toast.success(' Gantt Chart loaded', 2000);\r\n  }\r\n\r\n  async _initializeUnifiedGanttOverlay(ganttContainer) {\n    let host = ganttContainer.querySelector('.unified-gantt-host');\n    if (!host) {\n      host = document.createElement('div');\n      host.className = 'unified-gantt-host';\n      host.style.position = 'relative';\n      host.style.minHeight = '420px';\n      host.style.width = '100%';\n      ganttContainer.innerHTML = '';\n      ganttContainer.appendChild(host);\n    }\n\n    if (!this.unifiedGanttManager) {\n      this.unifiedGanttManager = new UnifiedTableManager(this.state, {\n        showToast: this.showToast.bind(this),\n        onCellChange: (payload) => this._handleGridCellChange(payload),\n        getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\n      });\n      this.unifiedGanttManager.mount(host, {});\n    }\n\n    const gridPayload = {\n      tree: this.state.pekerjaanTree || [],\n      timeColumns: this._getDisplayTimeColumns(),\n      inputMode: this.state.inputMode || 'percentage',\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\n      dependencies: this.state.dependencies || [],\n    };\n    this.unifiedGanttManager.updateData(gridPayload);\n    this.unifiedGanttManager.switchMode('gantt');\n  }\n\n  /**\n   * Prepare data for redesigned Gantt Chart\n   * @private\n   * @returns {Object} Gantt data structure\n   */\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      //  FILTER: Only send pekerjaan nodes (actual tasks) to Gantt Chart\r\n      // Pekerjaan nodes already have complete parent chain info (klasifikasi_name, sub_klasifikasi_name)\r\n      const pekerjaanNodes = this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan');\r\n\r\n      console.log(`[JadwalKegiatanApp] Transforming ${pekerjaanNodes.length} pekerjaan nodes for Gantt (filtered from ${this.state.flatPekerjaan.length} total nodes)`);\r\n\r\n      // DEBUG: Log first node structure\r\n      if (pekerjaanNodes.length > 0) {\r\n        console.log('[JadwalKegiatanApp] Sample pekerjaan node:', pekerjaanNodes[0]);\r\n      }\r\n\r\n      pekerjaanNodes.forEach(node => {\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        // Pekerjaan nodes now have complete parent info from DataLoader (after fix)\r\n        data.push({\r\n          // Klasifikasi (parent level 1)\r\n          klasifikasi_id: node.klasifikasi_id,\r\n          klasifikasi_name: node.klasifikasi_name || 'Unknown Klasifikasi',\r\n          klasifikasi_kode: node.klasifikasi_kode || '',\r\n\r\n          // Sub-Klasifikasi (parent level 2)\r\n          sub_klasifikasi_id: node.sub_klasifikasi_id,\r\n          sub_klasifikasi_name: node.sub_klasifikasi_name || 'Unknown Sub-Klasifikasi',\r\n          sub_klasifikasi_kode: node.sub_klasifikasi_kode || '',\r\n\r\n          // Pekerjaan (leaf node / actual task) - use 'nama' property from DataLoader\r\n          pekerjaan_id: node.id,\r\n          pekerjaan_name: node.nama || node.name || 'Unknown Pekerjaan',\r\n          pekerjaan_kode: node.kode || '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || ''\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n    this._bindUnifiedTabSync();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (this.state.useUnifiedTable && this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update Gantt V2 with latest data\r\n    if (this.ganttFrozenGrid && typeof this.ganttFrozenGrid.update === 'function') {\r\n      try {\r\n        this.ganttFrozenGrid.update();\r\n        console.log('[JadwalKegiatanApp]  Gantt V2 chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Gantt V2 chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n    this.state.dependencies = this.state.dependencies || [];\r\n\r\n    const gridPayload = {\r\n      tree: this.state.pekerjaanTree || [],\r\n      timeColumns: displayColumns,\r\n      inputMode: this.state.inputMode || 'percentage',\r\n      timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      dependencies: this.state.dependencies || [],\r\n    };\r\n\r\n    if (this.state.useUnifiedTable && this.unifiedManager) {\r\n      this.unifiedManager.updateData(gridPayload);\r\n      if (this.unifiedGanttManager) {\r\n        this.unifiedGanttManager.updateData(gridPayload);\r\n      }\r\n    } else if (this.gridManager) {\r\n      this.gridManager.updateData(gridPayload);\r\n      if (typeof this.gridManager.updateTopScrollMetrics === 'function') {\r\n        this.gridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _renderGrid() {\r\n    if (this.gridManager) {\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n    if (typeof this._renderLegacyGrid === 'function') {\r\n      this._renderLegacyGrid();\r\n    }\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.gridManager && typeof this.gridManager.refreshCells === 'function') {\r\n      this.gridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.gridManager && typeof this.gridManager.refreshRowStyles === 'function') {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.gridManager) {\r\n        this.gridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.gridManager) {\r\n      this.gridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getRowCostCapacity(pekerjaanId) {\r\n    const hargaMap = this.state?.hargaMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (hargaMap instanceof Map && hargaMap.has(numericId)) {\r\n      return Number(hargaMap.get(numericId)) || 0;\r\n    }\r\n    if (hargaMap && typeof hargaMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(hargaMap, key)) {\r\n        return Number(hargaMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode) {\r\n      const costFields = [\r\n        'budgeted_cost',\r\n        'total_biaya',\r\n        'totalBiaya',\r\n        'total_cost',\r\n        'biaya',\r\n      ];\r\n      for (const field of costFields) {\r\n        if (typeof fallbackNode[field] !== 'undefined') {\r\n          const numeric = Number(fallbackNode[field]);\r\n          if (Number.isFinite(numeric)) {\r\n            return numeric;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _getMergedCostCells(modeState) {\r\n    const merged = new Map();\r\n    if (modeState?.costAssignmentMap instanceof Map) {\r\n      modeState.costAssignmentMap.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    if (modeState?.costModifiedCells instanceof Map) {\r\n      modeState.costModifiedCells.forEach((value, key) => {\r\n        const numeric = Number(value);\r\n        if (Number.isFinite(numeric)) {\r\n          merged.set(key, numeric);\r\n        }\r\n      });\r\n    }\r\n    return merged;\r\n  }\r\n\r\n  _calculateAllCostTotals() {\r\n    const totals = new Map();\r\n    const modeState = this._getCurrentModeState();\r\n    if (!modeState) {\r\n      return totals;\r\n    }\r\n    const merged = this._getMergedCostCells(modeState);\r\n    merged.forEach((value, cellKey) => {\r\n      const pekerjaanId = parseInt((cellKey || '').split('-')[0], 10);\r\n      if (!Number.isFinite(pekerjaanId)) {\r\n        return;\r\n      }\r\n      totals.set(pekerjaanId, (totals.get(pekerjaanId) || 0) + Number(value));\r\n    });\r\n    return totals;\r\n  }\r\n\r\n  _formatCurrency(value) {\r\n    const numeric = Number(value) || 0;\r\n    if (!this._currencyFormatter && typeof Intl !== 'undefined') {\r\n      this._currencyFormatter = new Intl.NumberFormat('id-ID', {\r\n        style: 'currency',\r\n        currency: 'IDR',\r\n        maximumFractionDigits: 0,\r\n      });\r\n    }\r\n    if (this._currencyFormatter) {\r\n      return this._currencyFormatter.format(numeric);\r\n    }\r\n    return `Rp ${numeric.toLocaleString('id-ID')}`;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    const costViolations = [];\r\n    const normalizedMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    if (normalizedMode === 'actual') {\r\n      const costTotals = this._calculateAllCostTotals();\r\n      costTotals.forEach((totalCost, pekerjaanId) => {\r\n        if (!Number.isFinite(totalCost)) {\r\n          return;\r\n        }\r\n        const capacity = this._getRowCostCapacity(pekerjaanId);\r\n        const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 1) : 1;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (totalCost > capacity + tolerance) {\r\n            costViolations.push({\r\n              type: 'cost',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalCost,\r\n              capacity,\r\n            });\r\n          }\r\n        } else if (totalCost > tolerance) {\r\n          costViolations.push({\r\n            type: 'cost',\r\n            pekerjaan_id: pekerjaanId,\r\n            total: totalCost,\r\n            capacity: 0,\r\n            missingCapacity: true,\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0 && costViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations, costViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      if (item.type === 'cost') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: biaya aktual tidak dapat disimpan karena master biaya 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total biaya ${this._formatCurrency(item.total)} > batas ${this._formatCurrency(item.capacity)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n    return this._buildMonthlyColumns(sourceColumns);\r\n  }\r\n\r\n  _buildMonthlyColumns(sourceColumns) {\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n      const startDate = this._coerceDate(blockColumns[0]?.startDate || blockColumns[0]?.start_date);\r\n      const endDate = this._coerceDate(blockColumns[blockColumns.length - 1]?.endDate || blockColumns[blockColumns.length - 1]?.end_date);\r\n      const rangeText = this._formatShortRange(startDate, endDate);\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel: rangeText || rangeLabel,\r\n        rangeText,\r\n        startDate,\r\n        endDate,\r\n        tooltip: startLabel && endLabel ? `${startLabel} \\u2014 ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n        readOnly: true,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _coerceDate(value) {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n    if (value instanceof Date) {\r\n      return Number.isNaN(value.getTime()) ? null : value;\r\n    }\r\n    const parsed = new Date(value);\r\n    return Number.isNaN(parsed.getTime()) ? null : parsed;\r\n  }\r\n\r\n  _formatShortRange(startDate, endDate) {\r\n    const format = (date) => {\r\n      if (!(date instanceof Date) || Number.isNaN(date.getTime())) {\r\n        return '';\r\n      }\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      return `${day}/${month}`;\r\n    };\r\n    const start = format(startDate);\r\n    const end = format(endDate);\r\n    if (start && end) {\r\n      return `${start} - ${end}`;\r\n    }\r\n    return start || end || '';\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  _bindUnifiedTabSync() {\n    if (!this.state.useUnifiedTable) {\n      return;\n    }\n    const scurveTab =\n      document.querySelector('#scurve-tab') ||\r\n      document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n    const ganttTab =\r\n      document.querySelector('#gantt-tab') ||\r\n      document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    if (scurveTab) {\r\n      const handler = () => {\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('kurva');\r\n        }\r\n      };\r\n      scurveTab.addEventListener('shown.bs.tab', handler);\r\n      scurveTab.addEventListener('click', handler);\r\n    }\r\n\r\n    if (ganttTab) {\r\n      const handler = () => {\r\n        if (this.unifiedManager) {\r\n          this.unifiedManager.switchMode('gantt');\r\n        }\r\n      };\n      ganttTab.addEventListener('shown.bs.tab', handler);\n      ganttTab.addEventListener('click', handler);\n    }\n\n    if (ganttTab) {\n      const handlerUnifiedGantt = () => {\n        if (this.unifiedGanttManager) {\n          this.unifiedGanttManager.switchMode('gantt');\n        }\n      };\n      ganttTab.addEventListener('shown.bs.tab', handlerUnifiedGantt);\n      ganttTab.addEventListener('click', handlerUnifiedGantt);\n    }\n  }\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    this._unbindStateManagerEvents();\n\n    if (this.gridManager) {\n      this.gridManager.destroy();\n      this.gridManager = null;\n    }\n    this.unifiedManager = null;\n    this.unifiedGanttManager = null;\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n\r\n"],"file":"assets/js/jadwal-kegiatan-BEma-Slv.js"}