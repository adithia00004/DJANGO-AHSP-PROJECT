var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;import{T as i}from"./chart-modules-7de66ekb.js";class s{constructor(e,i={}){if(this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error("Gantt container not found");this.options=((e,i)=>{for(var s in i||(i={}))n.call(i,s)&&o(e,s,i[s]);if(t)for(var s of t(i))a.call(i,s)&&o(e,s,i[s]);return e})({rowHeight:i.rowHeight||40,frozenColumnWidth:280,volumeColumnWidth:70,satuanColumnWidth:70,timelineColumnWidth:100,timeScale:i.timeScale||"week"},i),this.state={rows:[],timelineColumns:[],scrollTop:0,scrollLeft:0,initialized:!1,expandedNodes:new Map},this.elements={gridContainer:null},this.themeObserver=null,this.pekerjaan=[],this.timeColumns=[]}initialize(e){return t=this,n=null,a=function*(){var t,n,a,o,s;console.log("ðŸš€ Initializing Gantt Frozen Grid V2 (Phase 2: Real Data)...");try{this.app=e,this.stateManager=e.stateManager,this.timeColumnGenerator=e.timeColumnGenerator,console.log("[GanttV2] App references:",{hasStateManager:!!this.stateManager,hasTimeColumnGenerator:!!this.timeColumnGenerator,hasFlatPekerjaan:!!(null==(t=e.state)?void 0:t.flatPekerjaan)});const r=e.state.flatPekerjaan||[],l=(null==(a=null==(n=this.timeColumnGenerator)?void 0:n.state)?void 0:a.timeColumns)||(null==(o=e.state)?void 0:o.timeColumns)||[];if(console.log("[GanttV2] Data loaded:",{pekerjaanCount:r.length,timeColumnsCount:l.length,timeScale:(null==(s=e.state)?void 0:s.timeScale)||"unknown"}),!(l.length>0)){console.warn("[GanttV2] âš ï¸ NO TIME COLUMNS! TimeColumnGenerator might not be initialized."),console.log("[GanttV2] TimeColumnGenerator object:",this.timeColumnGenerator),console.warn("[GanttV2] Falling back to DEMO mode with hardcoded 20 weeks...");const e=this._generateDemoTimeColumns(20);return this._buildDOM(e.length),this._renderRealData(r,e),this.state.initialized=!0,console.log("âœ… Gantt Frozen Grid V2 initialized (DEMO MODE - no TimeColumnGenerator)"),void i.success("ðŸ“Š Gantt Chart loaded (Demo Mode)",2e3)}{console.log("[GanttV2] First 3 columns:",l.slice(0,3)),console.log("[GanttV2] First 3 column IDs:",l.slice(0,3).map(e=>e.id)),console.log("[GanttV2] Last 3 columns:",l.slice(-3)),console.log("[GanttV2] Last 3 column IDs:",l.slice(-3).map(e=>e.id));const e=l[0];console.log("[GanttV2] First column structure:",{id:e.id,tahapanId:e.tahapanId,label:e.label})}r.length>0&&(console.log("[GanttV2] First pekerjaan:",r[0]),console.log("[GanttV2] Pekerjaan types:",r.slice(0,5).map(e=>{var t;return{id:e.id,type:e.type,level:e.level,nama:null==(t=e.nama)?void 0:t.substring(0,30)}}))),this.pekerjaan=r,this.timeColumns=l,this._initializeExpandState(r),this._buildDOM(l.length),this._renderRealData(r,l),this._setupThemeObserver(r,l),this.state.initialized=!0,console.log("âœ… Gantt Frozen Grid V2 initialized successfully"),i.success("ðŸ“Š Gantt Chart loaded",2e3)}catch(r){throw console.error("âŒ Failed to initialize Gantt Frozen Grid:",r),r}},new Promise((e,o)=>{var i=e=>{try{r(a.next(e))}catch(t){o(t)}},s=e=>{try{r(a.throw(e))}catch(t){o(t)}},r=t=>t.done?e(t.value):Promise.resolve(t.value).then(i,s);r((a=a.apply(t,n)).next())});var t,n,a}_buildDOM(e){this.container.innerHTML="",this.container.className="gantt-frozen-container";const t=document.documentElement.getAttribute("data-bs-theme"),n="dark"===t;console.log("[GanttV2] Theme detection:",{"data-bs-theme":t,isDarkMode:n,hasTimeColumns:e});const a=n?"#1e1e1e":"#ffffff",o=n?"#404040":"#dee2e6",i=document.createElement("div");i.className="gantt-grid",i.style.cssText=`\n      display: grid;\n      grid-template-columns: 280px 70px 70px repeat(${e}, 100px);\n      overflow: auto;\n      height: 600px;\n      background: ${a};\n      border: 1px solid ${o};\n    `,this.container.appendChild(i),this.elements.gridContainer=i,this.isDarkMode=n,this.borderColor=o}_renderRealData(e,t){this._renderHeaders(t),this._renderDataRows(e,t)}_renderHeaders(e){const t=this.isDarkMode?"#2d2d2d":"var(--bs-light, #f8f9fa)",n=this.isDarkMode?"#e0e0e0":"#212529";[{label:"Pekerjaan",width:"280px"},{label:"Volume",width:"70px"},{label:"Satuan",width:"70px"}].forEach((e,a)=>{const o=document.createElement("div");o.className="gantt-header-cell frozen",o.style.cssText=`\n        position: sticky;\n        left: ${this._calculateStickyLeft(a)}px;\n        top: 0;\n        z-index: 20;\n        background: ${t};\n        color: ${n};\n        font-weight: 600;\n        padding: 0.5rem;\n        border-bottom: 2px solid ${this.borderColor};\n        border-right: ${2===a?"2px":"1px"} solid ${this.borderColor};\n        ${0===a?`border-left: 1px solid ${this.borderColor};`:""}\n        display: flex;\n        align-items: center;\n        height: ${this.options.rowHeight}px;\n        box-sizing: border-box;\n      `,o.textContent=e.label,this.elements.gridContainer.appendChild(o)}),e.forEach((e,a)=>{const o=document.createElement("div");o.className="gantt-header-cell timeline",o.style.cssText=`\n        position: sticky;\n        top: 0;\n        z-index: 10;\n        background: ${t};\n        color: ${n};\n        font-weight: 600;\n        padding: 0.25rem;\n        border-bottom: 2px solid ${this.borderColor};\n        border-right: 1px solid ${this.isDarkMode?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)"};\n        ${0===a?`border-left: 1px solid ${this.borderColor};`:""}\n        text-align: center;\n        font-size: 0.75rem;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        gap: 0.1rem;\n        line-height: 1.1;\n        height: ${this.options.rowHeight}px;\n        box-sizing: border-box;\n      `;const i=document.createElement("div");if(i.style.cssText="font-weight: 600; font-size: 0.7rem;",i.textContent=e.label||e.id,o.appendChild(i),e.rangeLabel||e.subLabel){const t=document.createElement("div");t.style.cssText=`\n          font-weight: 400;\n          font-size: 0.6rem;\n          color: ${this.isDarkMode?"#9ca3af":"#6c757d"};\n          opacity: 0.85;\n        `,t.textContent=e.rangeLabel||e.subLabel,o.appendChild(t)}this.elements.gridContainer.appendChild(o)}),console.log(`[GanttV2] Rendered ${e.length} timeline headers`)}_renderDataRows(e,t){if(!e||0===e.length)return void console.warn("[GanttV2] No pekerjaan data to render");const n=this._getVisibleRows(e);console.log(`[GanttV2] Rendering ${n.length}/${e.length} visible rows`),n.forEach(e=>{const n=e.level||0,a=e.children&&e.children.length>0;this._createFrozenCell(e.nama||e.name||"Unknown",0,n,"left",e,a),this._createFrozenCell(e.volume||0,1,0,"right"),this._createFrozenCell(e.satuan||"-",2,0,"center"),this._renderTimelineCells(e,t)}),console.log(`âœ… Rendered ${n.length} rows`)}_createFrozenCell(e,t,n=0,a="left",o=null,i=!1){const s=document.createElement("div");s.className="gantt-cell frozen",0===t&&s.classList.add("tree-column"),2===t&&s.classList.add("frozen-last");const r=this._calculateStickyLeft(t),l=0===t?.5+1.5*n+"rem":"0.5rem",d=this.isDarkMode?"#1e1e1e":"white",c=this.isDarkMode?"#e0e0e0":"#212529",h=0===n?"700":1===n?"600":"400";if(s.style.cssText=`\n      position: sticky;\n      left: ${r}px;\n      z-index: 5;\n      background: ${d};\n      color: ${c};\n      padding: 0.5rem;\n      padding-left: ${l};\n      display: flex;\n      align-items: center;\n      justify-content: ${"right"===a?"flex-end":"center"===a?"center":"flex-start"};\n      font-size: ${0===t?"0.7rem":"0.875rem"};\n      font-weight: ${0===t?h:"400"};\n      height: ${this.options.rowHeight}px;\n      line-height: 1.2;\n      box-sizing: border-box;\n      overflow: hidden;\n    `,0===t){const t=document.createElement("span");t.textContent=e,t.style.cssText="\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        flex: 1;\n      ",s.appendChild(t)}else s.textContent=e;return this.elements.gridContainer.appendChild(s),s}_renderTimelineCells(e,t){var n;const a=this.stateManager.getAllCellsForMode("planned"),o=this.stateManager.getAllCellsForMode("actual"),i=this._extractAssignmentsForPekerjaan(e.id,a,t),s=this._extractAssignmentsForPekerjaan(e.id,o,t);if("pekerjaan"===e.type&&(console.log(`[GanttV2] Row ${e.id} (${null==(n=e.nama)?void 0:n.substring(0,30)}) assignments:`,{planned:i.length,actual:s.length,plannedSample:i.slice(0,3),actualSample:s.slice(0,3),plannedCellsTotal:a.size,actualCellsTotal:o.size}),a.size>0)){const e=Array.from(a.keys()).slice(0,5);console.log("[GanttV2] Sample planned cell keys:",e)}const r=this._getBarRange(i,t),l=this._getBarRange(s,t);t.forEach((e,n)=>{const a=this._createTimelineCell(n);r&&n>=r.startIndex&&n<=r.endIndex&&this._addContinuousBarSegment(a,"planned",n,r,i,t),l&&n>=l.startIndex&&n<=l.endIndex&&this._addContinuousBarSegment(a,"actual",n,l,s,t),this.elements.gridContainer.appendChild(a)})}_extractAssignmentsForPekerjaan(e,t,n){const a=[],o=String(e);let i=!1;return t.forEach((t,s)=>{const[r,l]=s.split("-");if(r===o&&t>0){const o=parseInt(l.replace("col_",""));i||(console.log(`[GanttV2] First match for pekerjaan ${e}:`,{cellKey:s,columnId:l,tahapanId:o,value:t,timeColumnsHasId:n.some(e=>e.tahapanId===o)}),i=!0),a.push({tahapan_id:o,volume:t})}}),a}_getBarRange(e,t){if(!e||0===e.length)return null;let n=1/0,a=-1;return e.forEach(e=>{const o=t.findIndex(t=>t.tahapanId===e.tahapan_id);-1!==o&&(n=Math.min(n,o),a=Math.max(a,o))}),n===1/0?null:{startIndex:n,endIndex:a}}_addContinuousBarSegment(e,t,n,a,o,i){const s=n===a.startIndex,r=n===a.endIndex,l=s&&r,d=i[n],c=o.find(e=>d&&e.tahapan_id===d.tahapanId),h=(null==c?void 0:c.volume)||0,m="planned"===t?{bg:this.isDarkMode?"rgba(66, 153, 225, 0.5)":"rgba(13, 110, 253, 0.5)",border:this.isDarkMode?"#4299e1":"#0d6efd",progress:this.isDarkMode?"#2c5282":"#084298"}:{bg:this.isDarkMode?"rgba(237, 137, 54, 0.9)":"rgba(253, 126, 20, 0.9)",border:this.isDarkMode?"#ed8936":"#dc6d08",progress:this.isDarkMode?"#9c4221":"#b34d00"},p=document.createElement("div");if(p.className=`gantt-bar-continuous ${t}`,p.style.cssText=`\n      position: absolute;\n      top: ${"planned"===t?"25%":"50%"};\n      left: 0;\n      width: 100%;\n      height: 18px;\n      transform: translateY(-50%);\n      background: ${m.bg};\n      border-top: 1px solid ${m.border};\n      border-bottom: 2px solid ${m.border};\n      ${s||l?`border-left: 2px solid ${m.border}; border-top-left-radius: 4px; border-bottom-left-radius: 4px;`:""}\n      ${r||l?`border-right: 2px solid ${m.border}; border-top-right-radius: 4px; border-bottom-right-radius: 4px;`:""}\n      z-index: ${"actual"===t?"3":"2"};\n      overflow: hidden;\n    `,h>0){const e=document.createElement("div");e.className="gantt-bar-progress",e.style.cssText=`\n        position: absolute;\n        left: 0;\n        top: 0;\n        height: 100%;\n        width: ${Math.min(h,100)}%;\n        background: ${m.progress};\n        opacity: 0.6;\n      `,p.appendChild(e)}e.appendChild(p)}_createTimelineCell(e){const t=document.createElement("div");t.className="gantt-cell timeline",0===e&&t.classList.add("timeline-first"),t.dataset.colIndex=e;const n=this.isDarkMode?"#1e1e1e":"white";return t.style.cssText=`\n      position: relative;\n      background: ${n};\n      height: ${this.options.rowHeight}px;\n      box-sizing: border-box;\n    `,t}_calculateStickyLeft(e){return[0,280,350][e]||0}_generateDemoTimeColumns(e){const t=[];for(let n=0;n<e;n++)t.push({id:1e3+n,label:`W${n+1}`,startDate:new Date(2025,0,1+7*n),endDate:new Date(2025,0,8+7*n)});return t}_initializeExpandState(e){e.forEach(e=>{e.children&&e.children.length>0&&this.state.expandedNodes.set(e.id,!0)}),console.log(`[GanttV2] Initialized expand state for ${this.state.expandedNodes.size} parent nodes`)}_getVisibleRows(e){const t=[],n=new Set;return e.forEach(e=>{const a=e.parent_id||e.parentId;if(a&&n.has(a))return void n.add(e.id);t.push(e);!1===this.state.expandedNodes.get(e.id)&&n.add(e.id)}),t}_toggleNodeExpand(e){const t=!this.state.expandedNodes.get(e);this.state.expandedNodes.set(e,t),console.log(`[GanttV2] Node ${e} ${t?"expanded":"collapsed"}`),this._buildDOM(this.timeColumns.length),this._renderRealData(this.pekerjaan,this.timeColumns)}_setupThemeObserver(e,t){this.themeObserver&&this.themeObserver.disconnect(),this.themeObserver=new MutationObserver(n=>{n.forEach(n=>{if("attributes"===n.type&&"data-bs-theme"===n.attributeName){const n=document.documentElement.getAttribute("data-bs-theme");console.log("[GanttV2] Theme changed to:",n),this._buildDOM(t.length),this._renderRealData(e,t),i.info(`ðŸŽ¨ Gantt theme updated: ${n}`,1500)}})}),this.themeObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]}),console.log("[GanttV2] Theme observer setup complete")}update(){var e,t,n;if(!this.state.initialized)return void console.warn("[GanttV2] Cannot update - not initialized");if(!this.app)return void console.warn("[GanttV2] Cannot update - no app reference");console.log("[GanttV2] Updating chart with latest data...");const a=this.app.state.flatPekerjaan||[],o=(null==(t=null==(e=this.timeColumnGenerator)?void 0:e.state)?void 0:t.timeColumns)||(null==(n=this.app.state)?void 0:n.timeColumns)||[];this.elements.gridContainer&&(this.elements.gridContainer.innerHTML=""),this._renderRealData(a,o),this.pekerjaan=a,this.timeColumns=o,console.log("[GanttV2] âœ… Chart updated successfully")}destroy(){this.themeObserver&&(this.themeObserver.disconnect(),this.themeObserver=null),this.container&&(this.container.innerHTML=""),this.state.initialized=!1,console.log("Gantt Frozen Grid destroyed")}}export{s as GanttFrozenGrid};
//# sourceMappingURL=gantt-frozen-grid-QMnIxjuC.js.map
