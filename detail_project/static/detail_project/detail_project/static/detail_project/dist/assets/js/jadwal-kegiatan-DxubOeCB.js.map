{"version":3,"mappings":"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","names":["BaseNode","constructor","data","this","id","name","expanded","visible","level","parentId","toggleExpand","isLeaf","TaskBar","startDate","Date","endDate","progress","duration","calculateDuration","diffTime","Math","abs","ceil","isValid","getProgressDate","progressDays","floor","progressDate","setDate","getDate","PekerjaanNode","super","type","kode","planned","tgl_mulai_rencana","tgl_selesai_rencana","progress_rencana","actual","tgl_mulai_realisasi","tgl_selesai_realisasi","progress_realisasi","status","_calculateStatus","volume","satuan","subKlasifikasiId","sub_klasifikasi_id","klasifikasiId","klasifikasi_id","now","updateStatus","getStartDate","dates","filter","d","length","min","getEndDate","max","SubKlasifikasiNode","pekerjaan","addPekerjaan","push","getPekerjaan","getPekerjaanCount","getAggregatedProgress","mode","totalProgress","reduce","sum","p","round","getDateRange","start","end","startDates","map","endDates","KlasifikasiNode","subKlasifikasi","addSubKlasifikasi","getSubKlasifikasi","getAllPekerjaan","flatMap","sub","getTotalPekerjaanCount","allPekerjaan","ranges","r","Milestone","_generateId","date","title","description","color","icon","comments","linkedPekerjaan","createdAt","createdBy","random","toString","substr","addComment","comment","text","author","timestamp","removeComment","commentId","c","linkPekerjaan","pekerjaanId","includes","unlinkPekerjaan","ProjectMetadata","projectId","project_id","projectName","project_name","start_date","end_date","currentDate","getDuration","getTimeProgress","total","elapsed","GanttDataModel","klasifikasi","milestones","projectMeta","_flattenedNodes","_nodeIndex","Map","initialize","rawData","console","log","project","_buildHierarchy","m","_buildNodeIndex","flatData","klasifikasiMap","subKlasifikasiMap","forEach","row","has","set","klasifikasi_name","klasifikasi_kode","sub_klasifikasi_name","sub_klasifikasi_kode","pekerjaan_id","pekerjaan_name","pekerjaan_kode","get","Array","from","values","clear","klas","pek","getNodeById","nodeId","getFlattenedTree","flattened","toggleNode","node","getProjectDateRange","addMilestone","milestoneData","milestone","removeMilestone","milestoneId","getMilestoneById","find","getMilestonesInRange","searchNodes","searchText","lowerSearch","toLowerCase","results","toJSON","KeyboardShortcuts","shortcuts","enabled","_boundHandler","_handleKeyDown","bind","init","document","addEventListener","register","key","callback","options","preventDefault","unregister","delete","event","activeElement","isInput","tagName","isContentEditable","parts","ctrlKey","altKey","shiftKey","metaKey","combo","join","shortcut","enable","disable","getShortcuts","entries","destroy","removeEventListener","RippleEffect","add","element","classList","e","ripple","createElement","rect","getBoundingClientRect","size","width","height","x","clientX","left","y","clientY","top","style","appendChild","setTimeout","remove","addToAll","selector","querySelectorAll","el","ButtonStateManager","setLoading","button","loadingText","dataset","originalText","innerHTML","disabled","setSuccess","setError","reset","markChanges","hasChanges","setAttribute","removeAttribute","Toast","success","message","_b","_a","window","DP","core","toast","show","error","warning","warn","info","GanttTreePanel","container","dataModel","__spreadValues","minWidth","maxWidth","showSearch","showStats","state","selectedNodeId","hoveredNodeId","scrollTop","onNodeClick","onNodeExpand","onSearchChange","elements","_buildDOM","_attachEventListeners","render","className","header","searchInput","querySelector","statsBar","treeContent","resizeHandle","debouncedSearch","func","wait","timeout","args","clearTimeout","debounce","value","target","_handleTreeClick","contains","_highlightRow","_unhighlightRow","_setupResizeHandle","closest","_toggleNode","_selectNode","isResizing","startX","startWidth","offsetWidth","body","cursor","delta","newWidth","_renderStats","_renderTree","klasifikasiCount","count","avgProgress","nodes","html","_filterNodesBySearch","_renderNode","searchLower","isSelected","indent","expandBtn","progressBadge","_getStatusIcon","expandIcon","_getProgressClass","_highlightSearch","icons","complete","delayed","regex","RegExp","replace","setMode","scrollToNode","scrollIntoView","behavior","block","expandAll","collapseAll","getSelectedNode","getScrollTop","setScrollTop","GanttTimelinePanel","rowHeight","barHeight","barPadding","zoom","showGrid","showToday","showMilestones","canvas","scale","timeline","scaleCtx","timelineCtx","pixelsPerDay","totalWidth","totalHeight","visibleNodes","dateRange","totalDays","scrollState","onBarClick","onMilestoneClick","onScroll","colors","fill","stroke","grid","today","textSecondary","_animationFrameId","_renderPending","_setupCanvas","_calculateDateRange","content","toolbar","scaleCanvas","timelineCanvas","getContext","_setupHighDPICanvas","ctx","dpr","devicePixelRatio","projectRange","setFullYear","getFullYear","padding","getTime","toLocaleDateString","btn","_setZoom","fitBtn","_fitToScreen","todayBtn","_scrollToToday","_handleCanvasClick","scrollLeft","_scheduleRender","resizeObserver","ResizeObserver","_handleResize","observe","toggle","_calculatePixelsPerDay","day","week","month","quarter","contentWidth","scrollX","_getMilestoneAtPoint","bar","_getBarAtPoint","milestoneX","_dateToX","milestoneY","sqrt","pow","i","nodeY","endX","barY","requestAnimationFrame","_renderScale","_renderTimeline","offsetHeight","clearRect","fillStyle","fillRect","_renderDayScale","_renderWeekScale","_renderMonthScale","_renderQuarterScale","_renderMilestonesInScale","font","textAlign","textBaseline","currentMonth","getMonth","strokeStyle","lineWidth","beginPath","moveTo","lineTo","fillText","year","setMonth","arc","PI","_renderGrid","_renderTodayMarker","index","_renderNodeBars","setLineDash","_renderBar","taskBar","strokeRect","progressWidth","_xToDate","daysFromStart","syncScrollY","getScrollState","cancelAnimationFrame","disconnect","GanttChartRedesign","Error","enableMilestones","enableSync","treePanel","timelinePanel","loading","initialized","onDataChange","onNodeSelect","onMilestoneChange","milestonePopup","__async","_createComponents","_setupSync","_showError","treeContainer","timelineContainer","_handleNodeClick","_handleNodeExpand","_handleSearchChange","_handleBarClick","_handleMilestoneClick","_handleTimelineScroll","_createMilestonePopup","treeScrolling","timelineScrolling","_showMilestonePopup","popup","_hideMilestonePopup","textContent","weekday","commentsContainer","_formatDate","diff","seconds","minutes","hours","days","_showLoading","_showEmpty","updateData","exportData","search","JadwalKegiatanApp","eventManager","agGridManager","stateManager","StateManager","getInstance","dataLoader","timeColumnGenerator","gridRenderer","saveHandler","kurvaSChart","ganttChart","ganttChartRedesign","_chartModulesLoaded","_chartModulesLoading","keyboardShortcuts","_weekBoundarySaveTimer","_pendingWeekBoundary","_isRegeneratingTimeline","_queuedRegeneratePayload","_isEnforcingWeekly","_exportManagerInstance","_exportBindingsAttached","_costToggleBtn","_costToggleBtnText","_costToggleSpinner","_costToggleBtnIcon","_costViewAutoActivated","_ganttScrollSyncHandlers","_getProjectDateRange","projectStart","parsed","Number","isNaN","projectEnd","parsedEnd","_estimateExpectedWeeklyColumns","diffDays","_countWeeklyColumns","isArray","timeColumns","col","generationMode","isFinite","weekNumber","week_number","arguments","config","_setupState","_setupDomRefs","_attachEvents","_loadInitialData","existingState","kelolaTahapanPageState","JadwalPekerjaanApp","Object","assign","pekerjaanTree","tahapanList","timeColumnIndex","expandedNodes","Set","volumeMap","isLoading","domRefs","apiEndpoints","useAgGrid","timeScale","inputMode","saveMode","weekStartDay","weekEndDay","displayScale","progressMode","displayMode","plannedState","progressTotals","volumeTotals","cellVolumeOverrides","cellValidationMap","failedRows","autoWarningRows","volumeWarningRows","validationWarningRows","saveErrorRows","apiFailedRows","showCompletionWarnings","isDirty","actualState","initialState","_createTimeColumnIndex","_ensureStateCollections","_setupStateDelegation","getCurrentState","defineProperty","states","modifiedCells","configurable","assignmentMap","costAssignmentMap","costModifiedCells","hasUnsavedChanges","_getCurrentModeState","_updateSaveButtonState","saveButton","hasFailures","_c","Boolean","root","getElementById","leftThead","rightThead","leftTbody","rightTbody","leftPanelScroll","rightPanelScroll","rightTable","horizontalScrollTop","horizontalScrollInner","timeHeaderRow","refreshButton","resetButton","agGridContainer","agGridTopScroll","agGridTopScrollInner","scurveChart","ganttChartWrapper","ganttTreeBody","ganttTreeScroll","ganttSummaryTable","ganttSummaryBody","ganttSummaryTotal","statusBar","statusMessageEl","itemCountEl","modifiedCountEl","totalProgressEl","weekStartSelect","weekEndSelect","_applyDataset","rootElement","allowedTimeScales","datasetScale","defaultTimeScale","datasetInputMode","defaultInputMode","allowedInputModes","parsedWeekEndDay","parseInt","_d","weekend","weekEnd","week_end_day","parsedWeekStartDay","_f","_e","week_start_day","normalized","endpoints","base","apiBase","tahapan","apiTahapan","listPekerjaan","apiListPekerjaan","apiVolume","assignmentsBase","apiAssignmentsBase","save","apiSave","_getDefaultSaveEndpoint","weekBoundary","apiWeekBoundary","regenerateTahapan","apiRegenerateTahapan","apiResetProgress","enableAgGrid","helpers","updateProgressIndicator","showToast","cleanup","attachGridEvents","_attachToolbarEvents","_initAgGridIfNeeded","saveChanges","refresh","_handleResetProgress","_syncToolbarRadios","_attachRadioGroupHandler","_handleDisplayModeChange","_handleProgressModeChange","_handleTimeScaleChange","_setupWeekBoundaryControls","_setupExportButtons","_setupCostViewToggle","_setupKeyboardShortcuts","_setupUXEnhancements","plannedRadio","checked","dispatchEvent","Event","bubbles","actualRadio","percentageRadio","volumeRadio","costRadio","dropdown","previousElementSibling","bsDropdown","bootstrap","Dropdown","hide","_showKeyboardShortcutsHelp","hasAttribute","getAttribute","modalHtml","s","existingModal","insertAdjacentHTML","Modal","ExportManager","format","exportAs","toggleBtn","toggleBtnText","toggleBtnSpinner","toggleBtnIcon","toggleView","_setCostToggleButtonState","viewMode","isCostMode","label","iconClass","_activateDefaultCostView","enableCostView","groupName","handler","radios","radio","_syncWeekBoundaryControls","nextStart","_normalizePythonWeekday","_getWeekStartDay","derivedEnd","_handleWeekBoundaryChange","source","nextEnd","_getWeekEndDay","derivedStart","endpoint","modeLabel","confirm","_updateStatusBar","response","fetch","method","credentials","headers","_getCsrfToken","JSON","stringify","ok","catch","result","json","_resetEditedCellsState","_clearFailedRows","forceReload","String","normalizedEnd","normalizedStart","_formatWeekdayLabel","prefix","_regenerateColumnsForWeekBoundary","_persistWeekBoundarySettings","TimeColumnGenerator","generate","_syncGridViews","_recalculateAllProgressTotals","_invalidateCachedDataset","flatPekerjaan","payload","then","resolvedStart","resolvedEnd","_regenerateTimeline","statusLabel","toastLabel","successMessage","next","pyDay","_updateCostToggleAvailability","setInputMode","oldMode","oldStats","getStats","switchMode","newStats","toUpperCase","modifiedCount","assignmentCount","indicator","bgClass","cssText","isActual","nextScale","_updateCharts","AGGridManager","onCellChange","_handleAgGridCellChange","getCellValidationState","cellKey","_getCellValidationState","mount","DataLoader","GridRenderer","SaveHandler","apiUrl","onSuccess","_onSaveSuccess","onError","_onSaveError","msg","loadAllData","skipIfLoaded","normalizedDisplayScale","weeklyCount","expectedWeeks","firstColumnMode","_g","_i","_h","loadAssignments","_loadKurvaSData","_j","_k","_l","_initializeCharts","statusText","hargaMap","k","v","parseFloat","totalBiayaProject","pekerjaanMeta","keys","hargaCount","totalBiaya","totalBiayaFormatted","toLocaleString","activeTimeColumns","_getDisplayTimeColumns","rendered","renderTables","leftHTML","rightHTML","renderTimeHeader","syncRowHeights","_updateLegacyHorizontalScroll","_loadChartModules","kurvaSModule","ganttModule","Promise","all","__vitePreload","import","n","__VITE_PRELOAD__","f","KurvaSChartClass","KurvaSChart","GanttChartClass","GanttChart","_initializeChartsAfterLoad","useIdealCurve","steepnessFactor","smoothCurves","showArea","activatePromise","_initializeRedesignedGantt","retryCount","resolve","ganttContainer","ganttView","ganttTab","currentMode","action","ganttData","_prepareGanttData","dataCount","milestonesCount","stack","parent_id","progressRencana","progressRealisasi","tahapanCount","plannedSum","actualSum","plannedVal","getCellValue","column_id","actualVal","node_type","_setupLazyChartLoading","scurveTab","once","update","_renderGanttSummary","_renderGanttTree","_attachGanttScrollSync","treeScroll","wrapper","chartScroll","scrollEl","scrollHandler","wheelHandler","deltaY","passive","_escapeHtml","char","_validateRowTotalsBeforeSave","_clearSaveErrorRows","_clearApiFailedRows","_markFailedRowsFromError","_buildTimeColumns","tahap","rawId","fieldId","nama","order","urutan","tanggal_mulai","tanggal_selesai","isAutoGenerated","is_auto_generated","generation_mode","columns","_fetchJson","_0","url","errorText","displayColumns","tree","updateTopScrollMetrics","scrollInner","scrollWidth","_refreshFailedRowsUnion","_markFailedRowsFromIds","idSet","_setSaveErrorRows","refreshRowStyles","_clearSaveErrorForRow","ids","_extractPekerjaanIdsFromError","collect","items","item","validationErrors","details","_getContainerValue","prototype","hasOwnProperty","call","_calculateRowTotalPercent","fieldKey","numeric","toFixed","_calculateRowTotalVolume","kapasitas","_getRowVolume","overrides","totalVolume","volumeValue","overrideValue","percentValue","_setCellVolumeOverride","_clearCellVolumeOverride","_updateCellValidationState","validationResult","current","nextState","changed","refreshCells","_updateProgressTotals","_updateAutoWarningRows","_updateCompletionWarningRows","_updateVolumeTotals","percentOverride","percentTotal","derivedPercent","_updateVolumeWarningRows","deferRefresh","union","totalPercent","_recomputeCompletionWarnings","capacity","percentReference","tolerance","shouldWarn","numericId","fallbackNode","percentViolations","volumeViolations","volumeTolerance","effectivePercent","missingCapacity","combined","concat","messages","slice","pekerjaanCount","_calculateProjectProgress","maximumFractionDigits","aggregate","avg","pekerjaanTotals","split","numericValue","_buildAssignmentsPayload","assignments","columnIndex","_parseCellKey","columnMeta","proportion","tahapan_id","_getSaveMode","fallback","fallbackSafe","baseColumns","weeklyColumns","isWeeklyColumn","sourceColumns","aggregated","blockColumns","blockIndex","startWeek","endWeek","startLabel","rangeLabel","endLabel","tooltip","childColumns","separatorIndex","indexOf","cookieValue","cookie","cookies","trim","substring","decodeURIComponent","displayValue","isVolumeMode","validation","columnId","valueType","normalizedValue","modeState","resolvedPekerjaanId","readyState"],"ignoreList":[],"sources":["../../../../../../js/src/modules/gantt/gantt-data-model.js","../../../../../../js/src/modules/shared/ux-enhancements.js","../../../../../../js/src/modules/gantt/gantt-tree-panel.js","../../../../../../js/src/modules/gantt/gantt-timeline-panel.js","../../../../../../js/src/modules/gantt/gantt-chart-redesign.js","../../../../../../js/src/jadwal_kegiatan_app.js"],"sourcesContent":["/**\r\n * Gantt Chart Data Model\r\n * Hierarchical data structure for Klasifikasi  Sub-Klasifikasi  Pekerjaan\r\n * @module gantt-data-model\r\n */\r\n\r\n/**\r\n * Base Node - shared properties for all node types\r\n */\r\nclass BaseNode {\r\n  constructor(data) {\r\n    this.id = data.id;\r\n    this.name = data.name;\r\n    this.expanded = data.expanded !== undefined ? data.expanded : true;\r\n    this.visible = true;\r\n    this.level = 0;\r\n    this.parentId = null;\r\n  }\r\n\r\n  /**\r\n   * Toggle expand/collapse state\r\n   */\r\n  toggleExpand() {\r\n    this.expanded = !this.expanded;\r\n    return this.expanded;\r\n  }\r\n\r\n  /**\r\n   * Check if node is leaf (no children)\r\n   */\r\n  isLeaf() {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Task Bar - represents planned or actual timeline\r\n */\r\nexport class TaskBar {\r\n  constructor(data = {}) {\r\n    this.startDate = data.startDate ? new Date(data.startDate) : null;\r\n    this.endDate = data.endDate ? new Date(data.endDate) : null;\r\n    this.progress = data.progress || 0; // 0-100\r\n    this.duration = data.duration || 0; // in days\r\n  }\r\n\r\n  /**\r\n   * Calculate duration in days\r\n   */\r\n  calculateDuration() {\r\n    if (!this.startDate || !this.endDate) return 0;\r\n    const diffTime = Math.abs(this.endDate - this.startDate);\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays;\r\n  }\r\n\r\n  /**\r\n   * Check if bar is valid\r\n   */\r\n  isValid() {\r\n    return this.startDate && this.endDate && this.startDate <= this.endDate;\r\n  }\r\n\r\n  /**\r\n   * Get progress date (where progress bar ends)\r\n   */\r\n  getProgressDate() {\r\n    if (!this.isValid() || this.progress === 0) return this.startDate;\r\n    const duration = this.calculateDuration();\r\n    const progressDays = Math.floor((duration * this.progress) / 100);\r\n    const progressDate = new Date(this.startDate);\r\n    progressDate.setDate(progressDate.getDate() + progressDays);\r\n    return progressDate;\r\n  }\r\n}\r\n\r\n/**\r\n * Pekerjaan Node - leaf node with planned and actual bars\r\n */\r\nexport class PekerjaanNode extends BaseNode {\r\n  constructor(data) {\r\n    super(data);\r\n    this.type = 'pekerjaan';\r\n    this.kode = data.kode || '';\r\n\r\n    // Dual bars\r\n    this.planned = new TaskBar({\r\n      startDate: data.tgl_mulai_rencana,\r\n      endDate: data.tgl_selesai_rencana,\r\n      progress: data.progress_rencana || 0\r\n    });\r\n\r\n    this.actual = new TaskBar({\r\n      startDate: data.tgl_mulai_realisasi,\r\n      endDate: data.tgl_selesai_realisasi,\r\n      progress: data.progress_realisasi || 0\r\n    });\r\n\r\n    // Status calculation\r\n    this.status = this._calculateStatus();\r\n\r\n    // Volume & satuan\r\n    this.volume = data.volume || 0;\r\n    this.satuan = data.satuan || '';\r\n\r\n    // References\r\n    this.subKlasifikasiId = data.sub_klasifikasi_id;\r\n    this.klasifikasiId = data.klasifikasi_id;\r\n  }\r\n\r\n  /**\r\n   * Calculate status based on dates and progress\r\n   */\r\n  _calculateStatus() {\r\n    const now = new Date();\r\n\r\n    // Not started if no actual start date\r\n    if (!this.actual.startDate) {\r\n      return 'not-started';\r\n    }\r\n\r\n    // Completed if progress is 100%\r\n    if (this.actual.progress === 100) {\r\n      return 'complete';\r\n    }\r\n\r\n    // In progress if started but not complete\r\n    if (this.actual.startDate <= now) {\r\n      // Check if delayed (actual progress < planned progress)\r\n      if (this.actual.progress < this.planned.progress) {\r\n        return 'delayed';\r\n      }\r\n      return 'in-progress';\r\n    }\r\n\r\n    return 'not-started';\r\n  }\r\n\r\n  /**\r\n   * Update status\r\n   */\r\n  updateStatus() {\r\n    this.status = this._calculateStatus();\r\n  }\r\n\r\n  /**\r\n   * Check if node is leaf\r\n   */\r\n  isLeaf() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get earliest start date\r\n   */\r\n  getStartDate() {\r\n    const dates = [this.planned.startDate, this.actual.startDate].filter(d => d);\r\n    if (dates.length === 0) return null;\r\n    return new Date(Math.min(...dates));\r\n  }\r\n\r\n  /**\r\n   * Get latest end date\r\n   */\r\n  getEndDate() {\r\n    const dates = [this.planned.endDate, this.actual.endDate].filter(d => d);\r\n    if (dates.length === 0) return null;\r\n    return new Date(Math.max(...dates));\r\n  }\r\n}\r\n\r\n/**\r\n * Sub-Klasifikasi Node - middle level\r\n */\r\nexport class SubKlasifikasiNode extends BaseNode {\r\n  constructor(data) {\r\n    super(data);\r\n    this.type = 'sub-klasifikasi';\r\n    this.kode = data.kode || '';\r\n    this.pekerjaan = [];\r\n    this.klasifikasiId = data.klasifikasi_id;\r\n    this.level = 2;\r\n  }\r\n\r\n  /**\r\n   * Add pekerjaan\r\n   */\r\n  addPekerjaan(pekerjaan) {\r\n    pekerjaan.level = 3;\r\n    pekerjaan.parentId = this.id;\r\n    this.pekerjaan.push(pekerjaan);\r\n  }\r\n\r\n  /**\r\n   * Get all pekerjaan\r\n   */\r\n  getPekerjaan() {\r\n    return this.pekerjaan;\r\n  }\r\n\r\n  /**\r\n   * Get pekerjaan count\r\n   */\r\n  getPekerjaanCount() {\r\n    return this.pekerjaan.length;\r\n  }\r\n\r\n  /**\r\n   * Calculate aggregated progress\r\n   */\r\n  getAggregatedProgress(mode = 'planned') {\r\n    if (this.pekerjaan.length === 0) return 0;\r\n\r\n    const totalProgress = this.pekerjaan.reduce((sum, p) => {\r\n      return sum + (mode === 'planned' ? p.planned.progress : p.actual.progress);\r\n    }, 0);\r\n\r\n    return Math.round(totalProgress / this.pekerjaan.length);\r\n  }\r\n\r\n  /**\r\n   * Get date range (earliest start to latest end)\r\n   */\r\n  getDateRange() {\r\n    if (this.pekerjaan.length === 0) return { start: null, end: null };\r\n\r\n    const startDates = this.pekerjaan\r\n      .map(p => p.getStartDate())\r\n      .filter(d => d);\r\n\r\n    const endDates = this.pekerjaan\r\n      .map(p => p.getEndDate())\r\n      .filter(d => d);\r\n\r\n    return {\r\n      start: startDates.length > 0 ? new Date(Math.min(...startDates)) : null,\r\n      end: endDates.length > 0 ? new Date(Math.max(...endDates)) : null\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if node is leaf\r\n   */\r\n  isLeaf() {\r\n    return this.pekerjaan.length === 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Klasifikasi Node - top level\r\n */\r\nexport class KlasifikasiNode extends BaseNode {\r\n  constructor(data) {\r\n    super(data);\r\n    this.type = 'klasifikasi';\r\n    this.kode = data.kode || '';\r\n    this.subKlasifikasi = [];\r\n    this.level = 1;\r\n  }\r\n\r\n  /**\r\n   * Add sub-klasifikasi\r\n   */\r\n  addSubKlasifikasi(subKlasifikasi) {\r\n    subKlasifikasi.level = 2;\r\n    subKlasifikasi.parentId = this.id;\r\n    this.subKlasifikasi.push(subKlasifikasi);\r\n  }\r\n\r\n  /**\r\n   * Get all sub-klasifikasi\r\n   */\r\n  getSubKlasifikasi() {\r\n    return this.subKlasifikasi;\r\n  }\r\n\r\n  /**\r\n   * Get all pekerjaan (flattened from all sub-klasifikasi)\r\n   */\r\n  getAllPekerjaan() {\r\n    return this.subKlasifikasi.flatMap(sub => sub.getPekerjaan());\r\n  }\r\n\r\n  /**\r\n   * Get total pekerjaan count\r\n   */\r\n  getTotalPekerjaanCount() {\r\n    return this.subKlasifikasi.reduce((sum, sub) => {\r\n      return sum + sub.getPekerjaanCount();\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Calculate aggregated progress\r\n   */\r\n  getAggregatedProgress(mode = 'planned') {\r\n    const allPekerjaan = this.getAllPekerjaan();\r\n    if (allPekerjaan.length === 0) return 0;\r\n\r\n    const totalProgress = allPekerjaan.reduce((sum, p) => {\r\n      return sum + (mode === 'planned' ? p.planned.progress : p.actual.progress);\r\n    }, 0);\r\n\r\n    return Math.round(totalProgress / allPekerjaan.length);\r\n  }\r\n\r\n  /**\r\n   * Get date range\r\n   */\r\n  getDateRange() {\r\n    if (this.subKlasifikasi.length === 0) return { start: null, end: null };\r\n\r\n    const ranges = this.subKlasifikasi.map(sub => sub.getDateRange());\r\n    const startDates = ranges.map(r => r.start).filter(d => d);\r\n    const endDates = ranges.map(r => r.end).filter(d => d);\r\n\r\n    return {\r\n      start: startDates.length > 0 ? new Date(Math.min(...startDates)) : null,\r\n      end: endDates.length > 0 ? new Date(Math.max(...endDates)) : null\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if node is leaf\r\n   */\r\n  isLeaf() {\r\n    return this.subKlasifikasi.length === 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Milestone - marks important dates with comments\r\n */\r\nexport class Milestone {\r\n  constructor(data) {\r\n    this.id = data.id || this._generateId();\r\n    this.date = new Date(data.date);\r\n    this.title = data.title || '';\r\n    this.description = data.description || '';\r\n    this.color = data.color || '#ff6b6b';\r\n    this.icon = data.icon || '';\r\n    this.comments = data.comments || [];\r\n    this.linkedPekerjaan = data.linkedPekerjaan || []; // Array of pekerjaan IDs\r\n    this.createdAt = data.createdAt ? new Date(data.createdAt) : new Date();\r\n    this.createdBy = data.createdBy || '';\r\n  }\r\n\r\n  /**\r\n   * Generate unique ID\r\n   */\r\n  _generateId() {\r\n    return `milestone_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Add comment\r\n   */\r\n  addComment(comment) {\r\n    this.comments.push({\r\n      id: `comment_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      text: comment.text,\r\n      author: comment.author || '',\r\n      timestamp: new Date()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove comment\r\n   */\r\n  removeComment(commentId) {\r\n    this.comments = this.comments.filter(c => c.id !== commentId);\r\n  }\r\n\r\n  /**\r\n   * Link pekerjaan\r\n   */\r\n  linkPekerjaan(pekerjaanId) {\r\n    if (!this.linkedPekerjaan.includes(pekerjaanId)) {\r\n      this.linkedPekerjaan.push(pekerjaanId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unlink pekerjaan\r\n   */\r\n  unlinkPekerjaan(pekerjaanId) {\r\n    this.linkedPekerjaan = this.linkedPekerjaan.filter(id => id !== pekerjaanId);\r\n  }\r\n}\r\n\r\n/**\r\n * Project Metadata\r\n */\r\nexport class ProjectMetadata {\r\n  constructor(data) {\r\n    this.projectId = data.project_id;\r\n    this.projectName = data.project_name || '';\r\n    this.startDate = new Date(data.start_date);\r\n    this.endDate = new Date(data.end_date);\r\n    this.currentDate = new Date();\r\n  }\r\n\r\n  /**\r\n   * Get project duration in days\r\n   */\r\n  getDuration() {\r\n    const diffTime = Math.abs(this.endDate - this.startDate);\r\n    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n  }\r\n\r\n  /**\r\n   * Get progress percentage based on time elapsed\r\n   */\r\n  getTimeProgress() {\r\n    const total = this.endDate - this.startDate;\r\n    const elapsed = this.currentDate - this.startDate;\r\n    return Math.round((elapsed / total) * 100);\r\n  }\r\n}\r\n\r\n/**\r\n * Main Gantt Data Model\r\n */\r\nexport class GanttDataModel {\r\n  constructor() {\r\n    this.klasifikasi = [];\r\n    this.milestones = [];\r\n    this.projectMeta = null;\r\n    this._flattenedNodes = null; // Cache for flattened tree\r\n    this._nodeIndex = new Map(); // Quick lookup by ID\r\n  }\r\n\r\n  /**\r\n   * Initialize from raw data\r\n   */\r\n  initialize(rawData) {\r\n    console.log(' Initializing Gantt Data Model...');\r\n\r\n    // Project metadata\r\n    this.projectMeta = new ProjectMetadata(rawData.project);\r\n\r\n    // Build hierarchy\r\n    this._buildHierarchy(rawData.data);\r\n\r\n    // Load milestones\r\n    if (rawData.milestones) {\r\n      this.milestones = rawData.milestones.map(m => new Milestone(m));\r\n    }\r\n\r\n    // Build index\r\n    this._buildNodeIndex();\r\n\r\n    console.log(` Gantt Data Model initialized: ${this.klasifikasi.length} klasifikasi, ${this.getTotalPekerjaanCount()} pekerjaan`);\r\n  }\r\n\r\n  /**\r\n   * Build hierarchy from flat data\r\n   */\r\n  _buildHierarchy(flatData) {\r\n    // Group by klasifikasi\r\n    const klasifikasiMap = new Map();\r\n    const subKlasifikasiMap = new Map();\r\n\r\n    // First pass: create all nodes\r\n    flatData.forEach(row => {\r\n      // Create/get klasifikasi\r\n      if (!klasifikasiMap.has(row.klasifikasi_id)) {\r\n        klasifikasiMap.set(row.klasifikasi_id, new KlasifikasiNode({\r\n          id: row.klasifikasi_id,\r\n          name: row.klasifikasi_name,\r\n          kode: row.klasifikasi_kode\r\n        }));\r\n      }\r\n\r\n      // Create/get sub-klasifikasi\r\n      if (!subKlasifikasiMap.has(row.sub_klasifikasi_id)) {\r\n        const subKlasifikasi = new SubKlasifikasiNode({\r\n          id: row.sub_klasifikasi_id,\r\n          name: row.sub_klasifikasi_name,\r\n          kode: row.sub_klasifikasi_kode,\r\n          klasifikasi_id: row.klasifikasi_id\r\n        });\r\n        subKlasifikasiMap.set(row.sub_klasifikasi_id, subKlasifikasi);\r\n      }\r\n\r\n      // Create pekerjaan\r\n      const pekerjaan = new PekerjaanNode({\r\n        id: row.pekerjaan_id,\r\n        name: row.pekerjaan_name,\r\n        kode: row.pekerjaan_kode,\r\n        tgl_mulai_rencana: row.tgl_mulai_rencana,\r\n        tgl_selesai_rencana: row.tgl_selesai_rencana,\r\n        tgl_mulai_realisasi: row.tgl_mulai_realisasi,\r\n        tgl_selesai_realisasi: row.tgl_selesai_realisasi,\r\n        progress_rencana: row.progress_rencana,\r\n        progress_realisasi: row.progress_realisasi,\r\n        volume: row.volume,\r\n        satuan: row.satuan,\r\n        sub_klasifikasi_id: row.sub_klasifikasi_id,\r\n        klasifikasi_id: row.klasifikasi_id\r\n      });\r\n\r\n      // Add to parent\r\n      subKlasifikasiMap.get(row.sub_klasifikasi_id).addPekerjaan(pekerjaan);\r\n    });\r\n\r\n    // Second pass: build tree\r\n    subKlasifikasiMap.forEach(subKlasifikasi => {\r\n      const klasifikasi = klasifikasiMap.get(subKlasifikasi.klasifikasiId);\r\n      if (klasifikasi) {\r\n        klasifikasi.addSubKlasifikasi(subKlasifikasi);\r\n      }\r\n    });\r\n\r\n    // Store as array\r\n    this.klasifikasi = Array.from(klasifikasiMap.values());\r\n  }\r\n\r\n  /**\r\n   * Build node index for quick lookup\r\n   */\r\n  _buildNodeIndex() {\r\n    this._nodeIndex.clear();\r\n\r\n    this.klasifikasi.forEach(klas => {\r\n      this._nodeIndex.set(klas.id, klas);\r\n\r\n      klas.getSubKlasifikasi().forEach(sub => {\r\n        this._nodeIndex.set(sub.id, sub);\r\n\r\n        sub.getPekerjaan().forEach(pek => {\r\n          this._nodeIndex.set(pek.id, pek);\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get node by ID\r\n   */\r\n  getNodeById(nodeId) {\r\n    return this._nodeIndex.get(nodeId);\r\n  }\r\n\r\n  /**\r\n   * Get flattened tree (respecting expand/collapse state)\r\n   */\r\n  getFlattenedTree() {\r\n    const flattened = [];\r\n\r\n    this.klasifikasi.forEach(klas => {\r\n      flattened.push(klas);\r\n\r\n      if (klas.expanded) {\r\n        klas.getSubKlasifikasi().forEach(sub => {\r\n          flattened.push(sub);\r\n\r\n          if (sub.expanded) {\r\n            sub.getPekerjaan().forEach(pek => {\r\n              flattened.push(pek);\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    return flattened;\r\n  }\r\n\r\n  /**\r\n   * Toggle node expand state\r\n   */\r\n  toggleNode(nodeId) {\r\n    const node = this.getNodeById(nodeId);\r\n    if (node && !node.isLeaf()) {\r\n      node.toggleExpand();\r\n      this._flattenedNodes = null; // Invalidate cache\r\n      return node.expanded;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get total pekerjaan count\r\n   */\r\n  getTotalPekerjaanCount() {\r\n    return this.klasifikasi.reduce((sum, klas) => {\r\n      return sum + klas.getTotalPekerjaanCount();\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Get project date range\r\n   */\r\n  getProjectDateRange() {\r\n    if (!this.projectMeta) return { start: null, end: null };\r\n    return {\r\n      start: this.projectMeta.startDate,\r\n      end: this.projectMeta.endDate\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Add milestone\r\n   */\r\n  addMilestone(milestoneData) {\r\n    const milestone = new Milestone(milestoneData);\r\n    this.milestones.push(milestone);\r\n    return milestone;\r\n  }\r\n\r\n  /**\r\n   * Remove milestone\r\n   */\r\n  removeMilestone(milestoneId) {\r\n    this.milestones = this.milestones.filter(m => m.id !== milestoneId);\r\n  }\r\n\r\n  /**\r\n   * Get milestone by ID\r\n   */\r\n  getMilestoneById(milestoneId) {\r\n    return this.milestones.find(m => m.id === milestoneId);\r\n  }\r\n\r\n  /**\r\n   * Get milestones in date range\r\n   */\r\n  getMilestonesInRange(startDate, endDate) {\r\n    return this.milestones.filter(m => {\r\n      return m.date >= startDate && m.date <= endDate;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Search nodes by text\r\n   */\r\n  searchNodes(searchText) {\r\n    const lowerSearch = searchText.toLowerCase();\r\n    const results = [];\r\n\r\n    this.klasifikasi.forEach(klas => {\r\n      if (klas.name.toLowerCase().includes(lowerSearch) ||\r\n          klas.kode.toLowerCase().includes(lowerSearch)) {\r\n        results.push(klas);\r\n      }\r\n\r\n      klas.getSubKlasifikasi().forEach(sub => {\r\n        if (sub.name.toLowerCase().includes(lowerSearch) ||\r\n            sub.kode.toLowerCase().includes(lowerSearch)) {\r\n          results.push(sub);\r\n        }\r\n\r\n        sub.getPekerjaan().forEach(pek => {\r\n          if (pek.name.toLowerCase().includes(lowerSearch) ||\r\n              pek.kode.toLowerCase().includes(lowerSearch)) {\r\n            results.push(pek);\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Export to JSON\r\n   */\r\n  toJSON() {\r\n    return {\r\n      klasifikasi: this.klasifikasi,\r\n      milestones: this.milestones,\r\n      projectMeta: this.projectMeta\r\n    };\r\n  }\r\n}\r\n\r\nexport default GanttDataModel;\r\n","/**\r\n * UX Enhancements Module\r\n * Provides keyboard shortcuts, ripple effects, and other UX improvements\r\n * @module ux-enhancements\r\n */\r\n\r\n/**\r\n * Keyboard Shortcuts Manager\r\n */\r\nexport class KeyboardShortcuts {\r\n  constructor() {\r\n    this.shortcuts = new Map();\r\n    this.enabled = true;\r\n    this._boundHandler = this._handleKeyDown.bind(this);\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    document.addEventListener('keydown', this._boundHandler);\r\n    console.log(' Keyboard shortcuts initialized');\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * @param {string} key - Key combination (e.g., 'ctrl+s', 'alt+p')\r\n   * @param {Function} callback - Function to call when shortcut triggered\r\n   * @param {Object} options - Additional options\r\n   */\r\n  register(key, callback, options = {}) {\r\n    const { description = '', preventDefault = true } = options;\r\n\r\n    this.shortcuts.set(key.toLowerCase(), {\r\n      callback,\r\n      description,\r\n      preventDefault\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unregister a keyboard shortcut\r\n   */\r\n  unregister(key) {\r\n    this.shortcuts.delete(key.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  _handleKeyDown(event) {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input/textarea\r\n    const activeElement = document.activeElement;\r\n    const isInput = activeElement.tagName === 'INPUT' ||\r\n                   activeElement.tagName === 'TEXTAREA' ||\r\n                   activeElement.isContentEditable;\r\n\r\n    // Build key combination string\r\n    const parts = [];\r\n    if (event.ctrlKey) parts.push('ctrl');\r\n    if (event.altKey) parts.push('alt');\r\n    if (event.shiftKey) parts.push('shift');\r\n    if (event.metaKey) parts.push('meta');\r\n\r\n    const key = event.key.toLowerCase();\r\n    if (!['control', 'alt', 'shift', 'meta'].includes(key)) {\r\n      parts.push(key);\r\n    }\r\n\r\n    const combo = parts.join('+');\r\n    const shortcut = this.shortcuts.get(combo);\r\n\r\n    if (shortcut) {\r\n      // Allow Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X in inputs\r\n      const allowedInInput = ['ctrl+a', 'ctrl+c', 'ctrl+v', 'ctrl+x', 'ctrl+z'];\r\n      if (isInput && !allowedInInput.includes(combo)) {\r\n        return;\r\n      }\r\n\r\n      if (shortcut.preventDefault) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      shortcut.callback(event);\r\n      console.log(` Shortcut triggered: ${combo}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enable shortcuts\r\n   */\r\n  enable() {\r\n    this.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * Disable shortcuts\r\n   */\r\n  disable() {\r\n    this.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getShortcuts() {\r\n    return Array.from(this.shortcuts.entries()).map(([key, data]) => ({\r\n      key,\r\n      description: data.description\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy() {\r\n    document.removeEventListener('keydown', this._boundHandler);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n/**\r\n * Ripple Effect Manager\r\n */\r\nexport class RippleEffect {\r\n  /**\r\n   * Add ripple effect to element\r\n   * @param {HTMLElement} element - Target element\r\n   */\r\n  static add(element) {\r\n    if (!element) return;\r\n\r\n    element.classList.add('btn-ripple');\r\n\r\n    // Optional: Add click listener for more control\r\n    element.addEventListener('click', function(e) {\r\n      const ripple = document.createElement('span');\r\n      ripple.classList.add('ripple-circle');\r\n\r\n      const rect = this.getBoundingClientRect();\r\n      const size = Math.max(rect.width, rect.height);\r\n      const x = e.clientX - rect.left - size / 2;\r\n      const y = e.clientY - rect.top - size / 2;\r\n\r\n      ripple.style.width = ripple.style.height = size + 'px';\r\n      ripple.style.left = x + 'px';\r\n      ripple.style.top = y + 'px';\r\n\r\n      this.appendChild(ripple);\r\n\r\n      setTimeout(() => ripple.remove(), 600);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add ripple to multiple elements\r\n   * @param {string} selector - CSS selector\r\n   */\r\n  static addToAll(selector) {\r\n    document.querySelectorAll(selector).forEach(el => {\r\n      RippleEffect.add(el);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Button State Manager\r\n */\r\nexport class ButtonStateManager {\r\n  /**\r\n   * Set button to loading state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {string} loadingText - Optional loading text\r\n   */\r\n  static setLoading(button, loadingText = 'Loading...') {\r\n    if (!button) return;\r\n\r\n    button.dataset.originalText = button.innerHTML;\r\n    button.disabled = true;\r\n    button.classList.add('loading');\r\n\r\n    const spinner = '<span class=\"spinner-border spinner-border-sm me-2\" role=\"status\" aria-hidden=\"true\"></span>';\r\n    button.innerHTML = spinner + loadingText;\r\n  }\r\n\r\n  /**\r\n   * Set button to success state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show success state (ms)\r\n   */\r\n  static setSuccess(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('success');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('success');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Set button to error state\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {number} duration - Duration to show error state (ms)\r\n   */\r\n  static setError(button, duration = 2000) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading');\r\n    button.classList.add('error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n\r\n    setTimeout(() => {\r\n      button.classList.remove('error');\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Reset button to normal state\r\n   * @param {HTMLElement} button - Button element\r\n   */\r\n  static reset(button) {\r\n    if (!button) return;\r\n\r\n    button.disabled = false;\r\n    button.classList.remove('loading', 'success', 'error');\r\n\r\n    if (button.dataset.originalText) {\r\n      button.innerHTML = button.dataset.originalText;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark button with \"has changes\" indicator\r\n   * @param {HTMLElement} button - Button element\r\n   * @param {boolean} hasChanges - Whether there are unsaved changes\r\n   */\r\n  static markChanges(button, hasChanges) {\r\n    if (!button) return;\r\n\r\n    if (hasChanges) {\r\n      button.classList.add('has-changes');\r\n      button.setAttribute('data-tooltip', 'You have unsaved changes');\r\n    } else {\r\n      button.classList.remove('has-changes');\r\n      button.removeAttribute('data-tooltip');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toast Notifications (wrapper untuk DP.core.toast)\r\n */\r\nexport class Toast {\r\n  /**\r\n   * Show success toast\r\n   */\r\n  static success(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'success', duration);\r\n    } else {\r\n      console.log(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show error toast\r\n   */\r\n  static error(message, duration = 3000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'danger', duration);\r\n    } else {\r\n      console.error(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show warning toast\r\n   */\r\n  static warning(message, duration = 2000) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'warning', duration);\r\n    } else {\r\n      console.warn(` ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show info toast\r\n   */\r\n  static info(message, duration = 1600) {\r\n    if (window.DP?.core?.toast) {\r\n      window.DP.core.toast.show(message, 'info', duration);\r\n    } else {\r\n      console.info(` ${message}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Smooth Scroll Helper\r\n */\r\nexport class SmoothScroll {\r\n  /**\r\n   * Scroll to element smoothly\r\n   * @param {HTMLElement|string} target - Element or selector\r\n   * @param {Object} options - Scroll options\r\n   */\r\n  static to(target, options = {}) {\r\n    const element = typeof target === 'string'\r\n      ? document.querySelector(target)\r\n      : target;\r\n\r\n    if (!element) return;\r\n\r\n    const {\r\n      offset = 0,\r\n      behavior = 'smooth',\r\n      block = 'start'\r\n    } = options;\r\n\r\n    const elementPosition = element.getBoundingClientRect().top;\r\n    const offsetPosition = elementPosition + window.pageYOffset - offset;\r\n\r\n    window.scrollTo({\r\n      top: offsetPosition,\r\n      behavior\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Scroll to top\r\n   */\r\n  static toTop() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      behavior: 'smooth'\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce utility\r\n */\r\nexport function debounce(func, wait = 300) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle utility\r\n */\r\nexport function throttle(func, limit = 100) {\r\n  let inThrottle;\r\n  return function executedFunction(...args) {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Initialize all UX enhancements\r\n */\r\nexport function initializeUXEnhancements() {\r\n  console.log(' Initializing UX enhancements...');\r\n\r\n  // Add ripple effects to all primary buttons\r\n  RippleEffect.addToAll('.btn-primary, .btn-save, .btn-danger');\r\n\r\n  // Add tooltips to buttons with title attribute\r\n  document.querySelectorAll('button[title]').forEach(btn => {\r\n    if (!btn.hasAttribute('data-tooltip')) {\r\n      btn.setAttribute('data-tooltip', btn.getAttribute('title'));\r\n    }\r\n  });\r\n\r\n  console.log(' UX enhancements initialized');\r\n}\r\n\r\n/**\r\n * Default export\r\n */\r\nexport default {\r\n  KeyboardShortcuts,\r\n  RippleEffect,\r\n  ButtonStateManager,\r\n  Toast,\r\n  SmoothScroll,\r\n  debounce,\r\n  throttle,\r\n  initializeUXEnhancements\r\n};\r\n","/**\r\n * Gantt Tree Panel Component\r\n * Displays hierarchical tree with expand/collapse functionality\r\n * @module gantt-tree-panel\r\n */\r\n\r\nimport { debounce } from '@modules/shared/ux-enhancements.js';\r\n\r\n/**\r\n * Tree Panel Component\r\n */\r\nexport class GanttTreePanel {\r\n  constructor(container, dataModel, options = {}) {\r\n    this.container = container;\r\n    this.dataModel = dataModel;\r\n\r\n    // Options\r\n    this.options = {\r\n      width: options.width || '30%',\r\n      minWidth: options.minWidth || 250,\r\n      maxWidth: options.maxWidth || 500,\r\n      showSearch: options.showSearch !== false,\r\n      showStats: options.showStats !== false,\r\n      mode: options.mode || 'planned', // 'planned' or 'actual'\r\n      ...options\r\n    };\r\n\r\n    // State\r\n    this.state = {\r\n      searchText: '',\r\n      selectedNodeId: null,\r\n      hoveredNodeId: null,\r\n      scrollTop: 0\r\n    };\r\n\r\n    // Event callbacks\r\n    this.onNodeClick = options.onNodeClick || (() => {});\r\n    this.onNodeExpand = options.onNodeExpand || (() => {});\r\n    this.onSearchChange = options.onSearchChange || (() => {});\r\n\r\n    // DOM elements\r\n    this.elements = {};\r\n\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initialize tree panel\r\n   */\r\n  init() {\r\n    console.log(' Initializing Tree Panel...');\r\n    this._buildDOM();\r\n    this._attachEventListeners();\r\n    this.render();\r\n    console.log(' Tree Panel initialized');\r\n  }\r\n\r\n  /**\r\n   * Build DOM structure\r\n   */\r\n  _buildDOM() {\r\n    this.container.innerHTML = '';\r\n    this.container.className = 'gantt-tree-panel';\r\n\r\n    // Header with search\r\n    if (this.options.showSearch) {\r\n      const header = document.createElement('div');\r\n      header.className = 'tree-panel-header';\r\n      header.innerHTML = `\r\n        <div class=\"tree-search-container\">\r\n          <input\r\n            type=\"text\"\r\n            class=\"tree-search-input\"\r\n            placeholder=\"Search tasks...\"\r\n            aria-label=\"Search tasks\"\r\n          />\r\n          <i class=\"bi bi-search tree-search-icon\"></i>\r\n        </div>\r\n      `;\r\n      this.container.appendChild(header);\r\n      this.elements.searchInput = header.querySelector('.tree-search-input');\r\n    }\r\n\r\n    // Stats bar\r\n    if (this.options.showStats) {\r\n      const statsBar = document.createElement('div');\r\n      statsBar.className = 'tree-stats-bar';\r\n      this.container.appendChild(statsBar);\r\n      this.elements.statsBar = statsBar;\r\n    }\r\n\r\n    // Tree content (scrollable)\r\n    const treeContent = document.createElement('div');\r\n    treeContent.className = 'tree-content';\r\n    this.container.appendChild(treeContent);\r\n    this.elements.treeContent = treeContent;\r\n\r\n    // Resize handle\r\n    const resizeHandle = document.createElement('div');\r\n    resizeHandle.className = 'tree-resize-handle';\r\n    resizeHandle.setAttribute('aria-label', 'Resize tree panel');\r\n    this.container.appendChild(resizeHandle);\r\n    this.elements.resizeHandle = resizeHandle;\r\n  }\r\n\r\n  /**\r\n   * Attach event listeners\r\n   */\r\n  _attachEventListeners() {\r\n    // Search\r\n    if (this.elements.searchInput) {\r\n      const debouncedSearch = debounce((value) => {\r\n        this.state.searchText = value;\r\n        this.onSearchChange(value);\r\n        this.render();\r\n      }, 300);\r\n\r\n      this.elements.searchInput.addEventListener('input', (e) => {\r\n        debouncedSearch(e.target.value);\r\n      });\r\n    }\r\n\r\n    // Tree content events (delegated)\r\n    this.elements.treeContent.addEventListener('click', (e) => {\r\n      this._handleTreeClick(e);\r\n    });\r\n\r\n    this.elements.treeContent.addEventListener('mouseenter', (e) => {\r\n      if (e.target.classList.contains('tree-node-row')) {\r\n        const nodeId = e.target.dataset.nodeId;\r\n        this.state.hoveredNodeId = nodeId;\r\n        this._highlightRow(nodeId);\r\n      }\r\n    }, true);\r\n\r\n    this.elements.treeContent.addEventListener('mouseleave', (e) => {\r\n      if (e.target.classList.contains('tree-node-row')) {\r\n        this.state.hoveredNodeId = null;\r\n        this._unhighlightRow(e.target.dataset.nodeId);\r\n      }\r\n    }, true);\r\n\r\n    // Resize handle\r\n    this._setupResizeHandle();\r\n\r\n    // Scroll sync\r\n    this.elements.treeContent.addEventListener('scroll', () => {\r\n      this.state.scrollTop = this.elements.treeContent.scrollTop;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle tree click events\r\n   */\r\n  _handleTreeClick(e) {\r\n    const target = e.target;\r\n\r\n    // Expand/collapse button\r\n    if (target.classList.contains('tree-expand-btn')) {\r\n      const nodeId = target.closest('.tree-node-row').dataset.nodeId;\r\n      this._toggleNode(nodeId);\r\n      return;\r\n    }\r\n\r\n    // Node row click\r\n    if (target.classList.contains('tree-node-row') || target.closest('.tree-node-row')) {\r\n      const row = target.classList.contains('tree-node-row')\r\n        ? target\r\n        : target.closest('.tree-node-row');\r\n\r\n      const nodeId = row.dataset.nodeId;\r\n      this._selectNode(nodeId);\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle node expand/collapse\r\n   */\r\n  _toggleNode(nodeId) {\r\n    const expanded = this.dataModel.toggleNode(nodeId);\r\n    this.onNodeExpand(nodeId, expanded);\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Select node\r\n   */\r\n  _selectNode(nodeId) {\r\n    this.state.selectedNodeId = nodeId;\r\n    this.onNodeClick(nodeId);\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Highlight row on hover\r\n   */\r\n  _highlightRow(nodeId) {\r\n    const row = this.elements.treeContent.querySelector(`[data-node-id=\"${nodeId}\"]`);\r\n    if (row) {\r\n      row.classList.add('hovered');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unhighlight row\r\n   */\r\n  _unhighlightRow(nodeId) {\r\n    const row = this.elements.treeContent.querySelector(`[data-node-id=\"${nodeId}\"]`);\r\n    if (row) {\r\n      row.classList.remove('hovered');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup resize handle\r\n   */\r\n  _setupResizeHandle() {\r\n    let isResizing = false;\r\n    let startX = 0;\r\n    let startWidth = 0;\r\n\r\n    this.elements.resizeHandle.addEventListener('mousedown', (e) => {\r\n      isResizing = true;\r\n      startX = e.clientX;\r\n      startWidth = this.container.offsetWidth;\r\n      document.body.style.cursor = 'col-resize';\r\n      e.preventDefault();\r\n    });\r\n\r\n    document.addEventListener('mousemove', (e) => {\r\n      if (!isResizing) return;\r\n\r\n      const delta = e.clientX - startX;\r\n      const newWidth = startWidth + delta;\r\n\r\n      // Constrain width\r\n      if (newWidth >= this.options.minWidth && newWidth <= this.options.maxWidth) {\r\n        this.container.style.width = newWidth + 'px';\r\n      }\r\n    });\r\n\r\n    document.addEventListener('mouseup', () => {\r\n      if (isResizing) {\r\n        isResizing = false;\r\n        document.body.style.cursor = '';\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render tree panel\r\n   */\r\n  render() {\r\n    // Render stats\r\n    if (this.elements.statsBar) {\r\n      this._renderStats();\r\n    }\r\n\r\n    // Render tree\r\n    this._renderTree();\r\n  }\r\n\r\n  /**\r\n   * Render stats bar\r\n   */\r\n  _renderStats() {\r\n    const total = this.dataModel.getTotalPekerjaanCount();\r\n    const klasifikasiCount = this.dataModel.klasifikasi.length;\r\n\r\n    // Calculate overall progress\r\n    let totalProgress = 0;\r\n    let count = 0;\r\n\r\n    this.dataModel.klasifikasi.forEach(klas => {\r\n      const progress = klas.getAggregatedProgress(this.options.mode);\r\n      if (progress > 0) {\r\n        totalProgress += progress;\r\n        count++;\r\n      }\r\n    });\r\n\r\n    const avgProgress = count > 0 ? Math.round(totalProgress / count) : 0;\r\n\r\n    this.elements.statsBar.innerHTML = `\r\n      <div class=\"tree-stat\">\r\n        <i class=\"bi bi-diagram-3\"></i>\r\n        <span>${klasifikasiCount} Categories</span>\r\n      </div>\r\n      <div class=\"tree-stat\">\r\n        <i class=\"bi bi-list-check\"></i>\r\n        <span>${total} Tasks</span>\r\n      </div>\r\n      <div class=\"tree-stat\">\r\n        <i class=\"bi bi-graph-up\"></i>\r\n        <span>${avgProgress}% Complete</span>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Render tree nodes\r\n   */\r\n  _renderTree() {\r\n    const nodes = this.dataModel.getFlattenedTree();\r\n    const searchActive = this.state.searchText.length > 0;\r\n\r\n    // Filter by search\r\n    const filteredNodes = searchActive\r\n      ? this._filterNodesBySearch(nodes)\r\n      : nodes;\r\n\r\n    const html = filteredNodes.map(node => this._renderNode(node)).join('');\r\n\r\n    this.elements.treeContent.innerHTML = html;\r\n\r\n    // Restore scroll position\r\n    this.elements.treeContent.scrollTop = this.state.scrollTop;\r\n  }\r\n\r\n  /**\r\n   * Filter nodes by search text\r\n   */\r\n  _filterNodesBySearch(nodes) {\r\n    const searchLower = this.state.searchText.toLowerCase();\r\n    return nodes.filter(node => {\r\n      return node.name.toLowerCase().includes(searchLower) ||\r\n             node.kode.toLowerCase().includes(searchLower);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render single node\r\n   */\r\n  _renderNode(node) {\r\n    const isSelected = this.state.selectedNodeId === node.id;\r\n    const indent = (node.level - 1) * 20; // 20px per level\r\n\r\n    let icon = '';\r\n    let expandBtn = '';\r\n    let progressBadge = '';\r\n\r\n    // Icon based on type\r\n    switch (node.type) {\r\n      case 'klasifikasi':\r\n        icon = '<i class=\"bi bi-folder2\"></i>';\r\n        break;\r\n      case 'sub-klasifikasi':\r\n        icon = '<i class=\"bi bi-folder\"></i>';\r\n        break;\r\n      case 'pekerjaan':\r\n        icon = this._getStatusIcon(node.status);\r\n        break;\r\n    }\r\n\r\n    // Expand button for non-leaf nodes\r\n    if (!node.isLeaf()) {\r\n      const expandIcon = node.expanded ? 'chevron-down' : 'chevron-right';\r\n      expandBtn = `\r\n        <button class=\"tree-expand-btn\" aria-label=\"${node.expanded ? 'Collapse' : 'Expand'}\">\r\n          <i class=\"bi bi-${expandIcon}\"></i>\r\n        </button>\r\n      `;\r\n    } else {\r\n      expandBtn = '<span class=\"tree-expand-spacer\"></span>';\r\n    }\r\n\r\n    // Progress badge for parent nodes\r\n    if (node.type !== 'pekerjaan') {\r\n      const progress = node.getAggregatedProgress(this.options.mode);\r\n      const progressClass = this._getProgressClass(progress);\r\n      progressBadge = `\r\n        <span class=\"tree-progress-badge ${progressClass}\">\r\n          ${progress}%\r\n        </span>\r\n      `;\r\n    } else {\r\n      // Status badge for pekerjaan\r\n      const progress = this.options.mode === 'planned'\r\n        ? node.planned.progress\r\n        : node.actual.progress;\r\n      const progressClass = this._getProgressClass(progress);\r\n      progressBadge = `\r\n        <span class=\"tree-progress-badge ${progressClass}\">\r\n          ${progress}%\r\n        </span>\r\n      `;\r\n    }\r\n\r\n    return `\r\n      <div\r\n        class=\"tree-node-row level-${node.level} ${isSelected ? 'selected' : ''} ${node.type}\"\r\n        data-node-id=\"${node.id}\"\r\n        data-node-type=\"${node.type}\"\r\n        style=\"padding-left: ${indent}px\"\r\n      >\r\n        ${expandBtn}\r\n        <span class=\"tree-node-icon\">${icon}</span>\r\n        <span class=\"tree-node-label\">\r\n          ${node.kode ? `<span class=\"tree-node-kode\">${node.kode}</span>` : ''}\r\n          <span class=\"tree-node-name\">${this._highlightSearch(node.name)}</span>\r\n        </span>\r\n        ${progressBadge}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Get status icon for pekerjaan\r\n   */\r\n  _getStatusIcon(status) {\r\n    const icons = {\r\n      'not-started': '<i class=\"bi bi-circle text-muted\"></i>',\r\n      'in-progress': '<i class=\"bi bi-play-circle text-primary\"></i>',\r\n      'complete': '<i class=\"bi bi-check-circle text-success\"></i>',\r\n      'delayed': '<i class=\"bi bi-exclamation-circle text-danger\"></i>'\r\n    };\r\n    return icons[status] || icons['not-started'];\r\n  }\r\n\r\n  /**\r\n   * Get progress class based on percentage\r\n   */\r\n  _getProgressClass(progress) {\r\n    if (progress === 0) return 'progress-none';\r\n    if (progress < 25) return 'progress-low';\r\n    if (progress < 50) return 'progress-medium';\r\n    if (progress < 75) return 'progress-high';\r\n    if (progress < 100) return 'progress-very-high';\r\n    return 'progress-complete';\r\n  }\r\n\r\n  /**\r\n   * Highlight search text in string\r\n   */\r\n  _highlightSearch(text) {\r\n    if (!this.state.searchText) return text;\r\n\r\n    const regex = new RegExp(`(${this.state.searchText})`, 'gi');\r\n    return text.replace(regex, '<mark>$1</mark>');\r\n  }\r\n\r\n  /**\r\n   * Update mode (planned/actual)\r\n   */\r\n  setMode(mode) {\r\n    this.options.mode = mode;\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Scroll to node\r\n   */\r\n  scrollToNode(nodeId) {\r\n    const row = this.elements.treeContent.querySelector(`[data-node-id=\"${nodeId}\"]`);\r\n    if (row) {\r\n      row.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      this._selectNode(nodeId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Expand all nodes\r\n   */\r\n  expandAll() {\r\n    this.dataModel.klasifikasi.forEach(klas => {\r\n      klas.expanded = true;\r\n      klas.getSubKlasifikasi().forEach(sub => {\r\n        sub.expanded = true;\r\n      });\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Collapse all nodes\r\n   */\r\n  collapseAll() {\r\n    this.dataModel.klasifikasi.forEach(klas => {\r\n      klas.expanded = false;\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Get selected node\r\n   */\r\n  getSelectedNode() {\r\n    return this.dataModel.getNodeById(this.state.selectedNodeId);\r\n  }\r\n\r\n  /**\r\n   * Get scroll top\r\n   */\r\n  getScrollTop() {\r\n    return this.state.scrollTop;\r\n  }\r\n\r\n  /**\r\n   * Set scroll top\r\n   */\r\n  setScrollTop(scrollTop) {\r\n    this.state.scrollTop = scrollTop;\r\n    this.elements.treeContent.scrollTop = scrollTop;\r\n  }\r\n\r\n  /**\r\n   * Destroy tree panel\r\n   */\r\n  destroy() {\r\n    this.container.innerHTML = '';\r\n    console.log(' Tree Panel destroyed');\r\n  }\r\n}\r\n\r\nexport default GanttTreePanel;\r\n","/**\r\n * Gantt Timeline Panel Component\r\n * Canvas-based rendering for high performance\r\n * @module gantt-timeline-panel\r\n */\r\n\r\n/**\r\n * Timeline Panel Component\r\n */\r\nexport class GanttTimelinePanel {\r\n  constructor(container, dataModel, options = {}) {\r\n    this.container = container;\r\n    this.dataModel = dataModel;\r\n\r\n    // Options\r\n    this.options = {\r\n      rowHeight: options.rowHeight || 40,\r\n      barHeight: options.barHeight || 24,\r\n      barPadding: options.barPadding || 8,\r\n      zoom: options.zoom || 'month', // 'day', 'week', 'month', 'quarter'\r\n      mode: options.mode || 'planned', // 'planned' or 'actual'\r\n      showGrid: options.showGrid !== false,\r\n      showToday: options.showToday !== false,\r\n      showMilestones: options.showMilestones !== false,\r\n      ...options\r\n    };\r\n\r\n    // Canvas rendering state\r\n    this.canvas = {\r\n      scale: null,\r\n      timeline: null,\r\n      scaleCtx: null,\r\n      timelineCtx: null,\r\n      pixelsPerDay: 1,\r\n      totalWidth: 0,\r\n      totalHeight: 0,\r\n      visibleNodes: []\r\n    };\r\n\r\n    // Date range\r\n    this.dateRange = {\r\n      start: null,\r\n      end: null,\r\n      totalDays: 0\r\n    };\r\n\r\n    // Scroll state\r\n    this.scrollState = {\r\n      x: 0,\r\n      y: 0\r\n    };\r\n\r\n    // Event callbacks\r\n    this.onBarClick = options.onBarClick || (() => {});\r\n    this.onMilestoneClick = options.onMilestoneClick || (() => {});\r\n    this.onScroll = options.onScroll || (() => {});\r\n\r\n    // Colors\r\n    this.colors = {\r\n      planned: {\r\n        fill: 'rgba(13, 110, 252, 0.2)',\r\n        stroke: '#0d6efd',\r\n        progress: 'rgba(13, 110, 252, 0.5)'\r\n      },\r\n      actual: {\r\n        fill: 'rgba(25, 135, 84, 0.8)',\r\n        stroke: '#198754',\r\n        progress: '#198754'\r\n      },\r\n      grid: '#e9ecef',\r\n      today: '#dc3545',\r\n      text: '#212529',\r\n      textSecondary: '#6c757d'\r\n    };\r\n\r\n    // Performance optimization\r\n    this._animationFrameId = null;\r\n    this._renderPending = false;\r\n\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initialize timeline panel\r\n   */\r\n  init() {\r\n    console.log(' Initializing Timeline Panel...');\r\n    this._buildDOM();\r\n    this._setupCanvas();\r\n    this._calculateDateRange();\r\n    this._attachEventListeners();\r\n    this.render();\r\n    console.log(' Timeline Panel initialized');\r\n  }\r\n\r\n  /**\r\n   * Build DOM structure\r\n   */\r\n  _buildDOM() {\r\n    this.container.innerHTML = '';\r\n    this.container.className = 'gantt-timeline-panel';\r\n\r\n    // Header with toolbar\r\n    const header = document.createElement('div');\r\n    header.className = 'timeline-header';\r\n    header.innerHTML = `\r\n      <div class=\"timeline-toolbar\">\r\n        <div class=\"timeline-toolbar-group\">\r\n          <span class=\"timeline-toolbar-label\">Zoom:</span>\r\n          <button class=\"timeline-zoom-btn\" data-zoom=\"day\">Day</button>\r\n          <button class=\"timeline-zoom-btn\" data-zoom=\"week\">Week</button>\r\n          <button class=\"timeline-zoom-btn active\" data-zoom=\"month\">Month</button>\r\n          <button class=\"timeline-zoom-btn\" data-zoom=\"quarter\">Quarter</button>\r\n        </div>\r\n        <div class=\"timeline-toolbar-group\">\r\n          <button class=\"btn btn-sm btn-outline-primary\" id=\"timeline-fit-btn\">\r\n            <i class=\"bi bi-arrows-angle-contract\"></i> Fit to Screen\r\n          </button>\r\n        </div>\r\n        <div class=\"timeline-toolbar-group\">\r\n          <button class=\"btn btn-sm btn-outline-secondary\" id=\"timeline-today-btn\">\r\n            <i class=\"bi bi-calendar-check\"></i> Today\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div class=\"timeline-scale\">\r\n        <canvas class=\"timeline-scale-canvas\"></canvas>\r\n      </div>\r\n    `;\r\n    this.container.appendChild(header);\r\n\r\n    // Timeline content\r\n    const content = document.createElement('div');\r\n    content.className = 'timeline-content';\r\n    content.innerHTML = `\r\n      <div class=\"timeline-canvas-wrapper\">\r\n        <canvas class=\"timeline-canvas\"></canvas>\r\n      </div>\r\n    `;\r\n    this.container.appendChild(content);\r\n\r\n    // Store references\r\n    this.elements = {\r\n      header,\r\n      toolbar: header.querySelector('.timeline-toolbar'),\r\n      scaleCanvas: header.querySelector('.timeline-scale-canvas'),\r\n      content,\r\n      timelineCanvas: content.querySelector('.timeline-canvas')\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Setup canvas contexts\r\n   */\r\n  _setupCanvas() {\r\n    this.canvas.scale = this.elements.scaleCanvas;\r\n    this.canvas.timeline = this.elements.timelineCanvas;\r\n\r\n    this.canvas.scaleCtx = this.canvas.scale.getContext('2d');\r\n    this.canvas.timelineCtx = this.canvas.timeline.getContext('2d');\r\n\r\n    // Enable high DPI rendering\r\n    this._setupHighDPICanvas(this.canvas.scale, this.canvas.scaleCtx);\r\n    this._setupHighDPICanvas(this.canvas.timeline, this.canvas.timelineCtx);\r\n  }\r\n\r\n  /**\r\n   * Setup high DPI canvas\r\n   */\r\n  _setupHighDPICanvas(canvas, ctx) {\r\n    const dpr = window.devicePixelRatio || 1;\r\n    const rect = canvas.getBoundingClientRect();\r\n\r\n    canvas.width = rect.width * dpr;\r\n    canvas.height = rect.height * dpr;\r\n\r\n    canvas.style.width = rect.width + 'px';\r\n    canvas.style.height = rect.height + 'px';\r\n\r\n    ctx.scale(dpr, dpr);\r\n  }\r\n\r\n  /**\r\n   * Calculate date range from data\r\n   */\r\n  _calculateDateRange() {\r\n    const projectRange = this.dataModel.getProjectDateRange();\r\n\r\n    if (projectRange.start && projectRange.end) {\r\n      this.dateRange.start = new Date(projectRange.start);\r\n      this.dateRange.end = new Date(projectRange.end);\r\n    } else {\r\n      // Default to 1 year range\r\n      this.dateRange.start = new Date();\r\n      this.dateRange.end = new Date();\r\n      this.dateRange.end.setFullYear(this.dateRange.end.getFullYear() + 1);\r\n    }\r\n\r\n    // Add padding (10% on each side)\r\n    const totalMs = this.dateRange.end - this.dateRange.start;\r\n    const padding = totalMs * 0.1;\r\n\r\n    this.dateRange.start = new Date(this.dateRange.start.getTime() - padding);\r\n    this.dateRange.end = new Date(this.dateRange.end.getTime() + padding);\r\n\r\n    // Calculate total days\r\n    const diffTime = Math.abs(this.dateRange.end - this.dateRange.start);\r\n    this.dateRange.totalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n    console.log(` Date range: ${this.dateRange.start.toLocaleDateString()} - ${this.dateRange.end.toLocaleDateString()} (${this.dateRange.totalDays} days)`);\r\n  }\r\n\r\n  /**\r\n   * Attach event listeners\r\n   */\r\n  _attachEventListeners() {\r\n    // Zoom buttons\r\n    this.elements.toolbar.querySelectorAll('.timeline-zoom-btn').forEach(btn => {\r\n      btn.addEventListener('click', () => {\r\n        this._setZoom(btn.dataset.zoom);\r\n      });\r\n    });\r\n\r\n    // Fit to screen button\r\n    const fitBtn = this.elements.toolbar.querySelector('#timeline-fit-btn');\r\n    if (fitBtn) {\r\n      fitBtn.addEventListener('click', () => this._fitToScreen());\r\n    }\r\n\r\n    // Today button\r\n    const todayBtn = this.elements.toolbar.querySelector('#timeline-today-btn');\r\n    if (todayBtn) {\r\n      todayBtn.addEventListener('click', () => this._scrollToToday());\r\n    }\r\n\r\n    // Canvas click events\r\n    this.canvas.timeline.addEventListener('click', (e) => {\r\n      this._handleCanvasClick(e);\r\n    });\r\n\r\n    // Scroll sync\r\n    this.elements.content.addEventListener('scroll', () => {\r\n      this.scrollState.x = this.elements.content.scrollLeft;\r\n      this.scrollState.y = this.elements.content.scrollTop;\r\n      this.onScroll(this.scrollState);\r\n      this._scheduleRender();\r\n    });\r\n\r\n    // Resize observer\r\n    this.resizeObserver = new ResizeObserver(() => {\r\n      this._handleResize();\r\n    });\r\n    this.resizeObserver.observe(this.container);\r\n  }\r\n\r\n  /**\r\n   * Set zoom level\r\n   */\r\n  _setZoom(zoom) {\r\n    this.options.zoom = zoom;\r\n\r\n    // Update active button\r\n    this.elements.toolbar.querySelectorAll('.timeline-zoom-btn').forEach(btn => {\r\n      btn.classList.toggle('active', btn.dataset.zoom === zoom);\r\n    });\r\n\r\n    // Recalculate pixels per day\r\n    this._calculatePixelsPerDay();\r\n    this._scheduleRender();\r\n  }\r\n\r\n  /**\r\n   * Calculate pixels per day based on zoom\r\n   */\r\n  _calculatePixelsPerDay() {\r\n    const zoomSettings = {\r\n      day: 40,\r\n      week: 8,\r\n      month: 2,\r\n      quarter: 0.7\r\n    };\r\n\r\n    this.canvas.pixelsPerDay = zoomSettings[this.options.zoom] || 2;\r\n    this.canvas.totalWidth = this.dateRange.totalDays * this.canvas.pixelsPerDay;\r\n  }\r\n\r\n  /**\r\n   * Fit timeline to screen width\r\n   */\r\n  _fitToScreen() {\r\n    const contentWidth = this.elements.content.offsetWidth;\r\n    this.canvas.pixelsPerDay = contentWidth / this.dateRange.totalDays;\r\n    this.canvas.totalWidth = contentWidth;\r\n\r\n    // Update zoom button (custom)\r\n    this.elements.toolbar.querySelectorAll('.timeline-zoom-btn').forEach(btn => {\r\n      btn.classList.remove('active');\r\n    });\r\n\r\n    this._scheduleRender();\r\n  }\r\n\r\n  /**\r\n   * Scroll to today's date\r\n   */\r\n  _scrollToToday() {\r\n    const today = new Date();\r\n    const daysFromStart = Math.floor((today - this.dateRange.start) / (1000 * 60 * 60 * 24));\r\n    const scrollX = daysFromStart * this.canvas.pixelsPerDay - (this.elements.content.offsetWidth / 2);\r\n\r\n    this.elements.content.scrollLeft = Math.max(0, scrollX);\r\n  }\r\n\r\n  /**\r\n   * Handle canvas click\r\n   */\r\n  _handleCanvasClick(e) {\r\n    const rect = this.canvas.timeline.getBoundingClientRect();\r\n    const x = e.clientX - rect.left + this.scrollState.x;\r\n    const y = e.clientY - rect.top + this.scrollState.y;\r\n\r\n    // Check milestone clicks\r\n    const milestone = this._getMilestoneAtPoint(x, y);\r\n    if (milestone) {\r\n      this.onMilestoneClick(milestone, e);\r\n      return;\r\n    }\r\n\r\n    // Check bar clicks\r\n    const bar = this._getBarAtPoint(x, y);\r\n    if (bar) {\r\n      this.onBarClick(bar.node, bar.type, e);\r\n      return;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get milestone at point\r\n   */\r\n  _getMilestoneAtPoint(x, y) {\r\n    const milestoneRadius = 12;\r\n\r\n    for (const milestone of this.dataModel.milestones) {\r\n      const milestoneX = this._dateToX(milestone.date);\r\n      const milestoneY = 20; // Fixed Y position in scale area\r\n\r\n      const distance = Math.sqrt(\r\n        Math.pow(x - milestoneX, 2) + Math.pow(y - milestoneY, 2)\r\n      );\r\n\r\n      if (distance <= milestoneRadius) {\r\n        return milestone;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get bar at point\r\n   */\r\n  _getBarAtPoint(x, y) {\r\n    const nodes = this.canvas.visibleNodes;\r\n\r\n    for (let i = 0; i < nodes.length; i++) {\r\n      const node = nodes[i];\r\n      const nodeY = i * this.options.rowHeight;\r\n\r\n      if (y < nodeY || y > nodeY + this.options.rowHeight) continue;\r\n\r\n      if (node.type === 'pekerjaan') {\r\n        // Check planned bar\r\n        const planned = node.planned;\r\n        if (planned.isValid()) {\r\n          const startX = this._dateToX(planned.startDate);\r\n          const endX = this._dateToX(planned.endDate);\r\n          const barY = nodeY + this.options.barPadding;\r\n          const barHeight = this.options.barHeight;\r\n\r\n          if (x >= startX && x <= endX && y >= barY && y <= barY + barHeight) {\r\n            return { node, type: 'planned' };\r\n          }\r\n        }\r\n\r\n        // Check actual bar\r\n        const actual = node.actual;\r\n        if (actual.isValid()) {\r\n          const startX = this._dateToX(actual.startDate);\r\n          const endX = this._dateToX(actual.endDate);\r\n          const barY = nodeY + this.options.barPadding + (this.options.barHeight / 2) - 6;\r\n          const barHeight = 12;\r\n\r\n          if (x >= startX && x <= endX && y >= barY && y <= barY + barHeight) {\r\n            return { node, type: 'actual' };\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Handle resize\r\n   */\r\n  _handleResize() {\r\n    this._setupHighDPICanvas(this.canvas.scale, this.canvas.scaleCtx);\r\n    this._setupHighDPICanvas(this.canvas.timeline, this.canvas.timelineCtx);\r\n    this._scheduleRender();\r\n  }\r\n\r\n  /**\r\n   * Schedule render (throttled via requestAnimationFrame)\r\n   */\r\n  _scheduleRender() {\r\n    if (this._renderPending) return;\r\n\r\n    this._renderPending = true;\r\n    this._animationFrameId = requestAnimationFrame(() => {\r\n      this.render();\r\n      this._renderPending = false;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render timeline\r\n   */\r\n  render() {\r\n    this._calculatePixelsPerDay();\r\n\r\n    // Get visible nodes from data model\r\n    this.canvas.visibleNodes = this.dataModel.getFlattenedTree();\r\n    this.canvas.totalHeight = this.canvas.visibleNodes.length * this.options.rowHeight;\r\n\r\n    // Resize timeline canvas\r\n    this.canvas.timeline.style.width = this.canvas.totalWidth + 'px';\r\n    this.canvas.timeline.style.height = this.canvas.totalHeight + 'px';\r\n    this._setupHighDPICanvas(this.canvas.timeline, this.canvas.timelineCtx);\r\n\r\n    // Resize scale canvas\r\n    this.canvas.scale.style.width = this.canvas.totalWidth + 'px';\r\n    this._setupHighDPICanvas(this.canvas.scale, this.canvas.scaleCtx);\r\n\r\n    // Render scale\r\n    this._renderScale();\r\n\r\n    // Render timeline\r\n    this._renderTimeline();\r\n  }\r\n\r\n  /**\r\n   * Render scale (date headers)\r\n   */\r\n  _renderScale() {\r\n    const ctx = this.canvas.scaleCtx;\r\n    const width = this.canvas.totalWidth;\r\n    const height = this.canvas.scale.offsetHeight;\r\n\r\n    // Clear\r\n    ctx.clearRect(0, 0, width, height);\r\n\r\n    // Background\r\n    ctx.fillStyle = '#f8f9fa';\r\n    ctx.fillRect(0, 0, width, height);\r\n\r\n    // Draw scale based on zoom level\r\n    switch (this.options.zoom) {\r\n      case 'day':\r\n        this._renderDayScale(ctx);\r\n        break;\r\n      case 'week':\r\n        this._renderWeekScale(ctx);\r\n        break;\r\n      case 'month':\r\n        this._renderMonthScale(ctx);\r\n        break;\r\n      case 'quarter':\r\n        this._renderQuarterScale(ctx);\r\n        break;\r\n    }\r\n\r\n    // Draw milestones\r\n    if (this.options.showMilestones) {\r\n      this._renderMilestonesInScale(ctx);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render day scale\r\n   */\r\n  _renderDayScale(ctx) {\r\n    const startDate = new Date(this.dateRange.start);\r\n    const endDate = new Date(this.dateRange.end);\r\n\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'middle';\r\n\r\n    let currentDate = new Date(startDate);\r\n    let currentMonth = null;\r\n\r\n    while (currentDate <= endDate) {\r\n      const x = this._dateToX(currentDate);\r\n\r\n      // Month separator\r\n      if (currentDate.getMonth() !== currentMonth) {\r\n        currentMonth = currentDate.getMonth();\r\n        ctx.strokeStyle = '#dee2e6';\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x, 0);\r\n        ctx.lineTo(x, 60);\r\n        ctx.stroke();\r\n\r\n        // Month label\r\n        ctx.fillStyle = '#212529';\r\n        ctx.font = 'bold 12px sans-serif';\r\n        ctx.fillText(\r\n          currentDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),\r\n          x + 30,\r\n          15\r\n        );\r\n      }\r\n\r\n      // Day label\r\n      ctx.fillStyle = '#6c757d';\r\n      ctx.font = '10px sans-serif';\r\n      ctx.fillText(currentDate.getDate(), x + (this.canvas.pixelsPerDay / 2), 45);\r\n\r\n      // Grid line\r\n      ctx.strokeStyle = '#e9ecef';\r\n      ctx.lineWidth = 1;\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, 30);\r\n      ctx.lineTo(x, 60);\r\n      ctx.stroke();\r\n\r\n      currentDate.setDate(currentDate.getDate() + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render month scale\r\n   */\r\n  _renderMonthScale(ctx) {\r\n    const startDate = new Date(this.dateRange.start);\r\n    const endDate = new Date(this.dateRange.end);\r\n\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.textBaseline = 'middle';\r\n\r\n    let currentDate = new Date(startDate);\r\n    currentDate.setDate(1); // Start of month\r\n\r\n    while (currentDate <= endDate) {\r\n      const x = this._dateToX(currentDate);\r\n\r\n      // Year separator\r\n      if (currentDate.getMonth() === 0) {\r\n        ctx.strokeStyle = '#dee2e6';\r\n        ctx.lineWidth = 2;\r\n        ctx.beginPath();\r\n        ctx.moveTo(x, 0);\r\n        ctx.lineTo(x, 60);\r\n        ctx.stroke();\r\n\r\n        // Year label\r\n        ctx.fillStyle = '#212529';\r\n        ctx.font = 'bold 12px sans-serif';\r\n        ctx.fillText(currentDate.getFullYear(), x + 30, 15);\r\n      }\r\n\r\n      // Month label\r\n      ctx.fillStyle = '#6c757d';\r\n      ctx.font = '11px sans-serif';\r\n      ctx.fillText(\r\n        currentDate.toLocaleDateString('en-US', { month: 'short' }),\r\n        x + 15,\r\n        45\r\n      );\r\n\r\n      // Grid line\r\n      ctx.strokeStyle = '#e9ecef';\r\n      ctx.lineWidth = 1;\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, 30);\r\n      ctx.lineTo(x, 60);\r\n      ctx.stroke();\r\n\r\n      currentDate.setMonth(currentDate.getMonth() + 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render week scale (simplified)\r\n   */\r\n  _renderWeekScale(ctx) {\r\n    this._renderMonthScale(ctx);\r\n  }\r\n\r\n  /**\r\n   * Render quarter scale (simplified)\r\n   */\r\n  _renderQuarterScale(ctx) {\r\n    this._renderMonthScale(ctx);\r\n  }\r\n\r\n  /**\r\n   * Render milestones in scale\r\n   */\r\n  _renderMilestonesInScale(ctx) {\r\n    this.dataModel.milestones.forEach(milestone => {\r\n      const x = this._dateToX(milestone.date);\r\n      const y = 20;\r\n\r\n      // Draw marker\r\n      ctx.fillStyle = milestone.color;\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, 12, 0, Math.PI * 2);\r\n      ctx.fill();\r\n\r\n      // Draw icon\r\n      ctx.fillStyle = 'white';\r\n      ctx.font = '14px sans-serif';\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText(milestone.icon, x, y);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render timeline (bars)\r\n   */\r\n  _renderTimeline() {\r\n    const ctx = this.canvas.timelineCtx;\r\n    const width = this.canvas.totalWidth;\r\n    const height = this.canvas.totalHeight;\r\n\r\n    // Clear\r\n    ctx.clearRect(0, 0, width, height);\r\n\r\n    // Draw grid\r\n    if (this.options.showGrid) {\r\n      this._renderGrid(ctx);\r\n    }\r\n\r\n    // Draw today marker\r\n    if (this.options.showToday) {\r\n      this._renderTodayMarker(ctx);\r\n    }\r\n\r\n    // Draw bars\r\n    this.canvas.visibleNodes.forEach((node, index) => {\r\n      const y = index * this.options.rowHeight;\r\n      this._renderNodeBars(ctx, node, y);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Render grid lines\r\n   */\r\n  _renderGrid(ctx) {\r\n    const startDate = new Date(this.dateRange.start);\r\n    const endDate = new Date(this.dateRange.end);\r\n\r\n    ctx.strokeStyle = this.colors.grid;\r\n    ctx.lineWidth = 1;\r\n\r\n    // Vertical lines (monthly)\r\n    let currentDate = new Date(startDate);\r\n    currentDate.setDate(1);\r\n\r\n    while (currentDate <= endDate) {\r\n      const x = this._dateToX(currentDate);\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo(x, 0);\r\n      ctx.lineTo(x, this.canvas.totalHeight);\r\n      ctx.stroke();\r\n\r\n      currentDate.setMonth(currentDate.getMonth() + 1);\r\n    }\r\n\r\n    // Horizontal lines (rows)\r\n    for (let i = 0; i <= this.canvas.visibleNodes.length; i++) {\r\n      const y = i * this.options.rowHeight;\r\n\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, y);\r\n      ctx.lineTo(this.canvas.totalWidth, y);\r\n      ctx.stroke();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render today marker\r\n   */\r\n  _renderTodayMarker(ctx) {\r\n    const today = new Date();\r\n    const x = this._dateToX(today);\r\n\r\n    ctx.strokeStyle = this.colors.today;\r\n    ctx.lineWidth = 2;\r\n    ctx.setLineDash([5, 5]);\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x, 0);\r\n    ctx.lineTo(x, this.canvas.totalHeight);\r\n    ctx.stroke();\r\n\r\n    ctx.setLineDash([]);\r\n  }\r\n\r\n  /**\r\n   * Render node bars\r\n   */\r\n  _renderNodeBars(ctx, node, y) {\r\n    if (node.type !== 'pekerjaan') return;\r\n\r\n    const barY = y + this.options.barPadding;\r\n\r\n    // Render planned bar (background, transparent)\r\n    if (node.planned.isValid()) {\r\n      this._renderBar(ctx, node.planned, barY, this.colors.planned, 'planned');\r\n    }\r\n\r\n    // Render actual bar (foreground, solid, smaller)\r\n    if (node.actual.isValid()) {\r\n      this._renderBar(ctx, node.actual, barY + (this.options.barHeight / 2) - 6, this.colors.actual, 'actual', 12);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render single bar\r\n   */\r\n  _renderBar(ctx, taskBar, y, colors, type, height = null) {\r\n    if (!taskBar.isValid()) return;\r\n\r\n    const startX = this._dateToX(taskBar.startDate);\r\n    const endX = this._dateToX(taskBar.endDate);\r\n    const width = endX - startX;\r\n    const barHeight = height || this.options.barHeight;\r\n\r\n    // Bar background\r\n    ctx.fillStyle = colors.fill;\r\n    ctx.fillRect(startX, y, width, barHeight);\r\n\r\n    // Bar border\r\n    ctx.strokeStyle = colors.stroke;\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeRect(startX, y, width, barHeight);\r\n\r\n    // Progress fill\r\n    if (taskBar.progress > 0) {\r\n      const progressWidth = (width * taskBar.progress) / 100;\r\n      ctx.fillStyle = colors.progress;\r\n      ctx.fillRect(startX, y, progressWidth, barHeight);\r\n    }\r\n\r\n    // Progress text\r\n    if (type === 'planned' && width > 40) {\r\n      ctx.fillStyle = this.colors.text;\r\n      ctx.font = '11px sans-serif';\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText(`${taskBar.progress}%`, startX + width / 2, y + barHeight / 2);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert date to X coordinate\r\n   */\r\n  _dateToX(date) {\r\n    const daysFromStart = Math.floor((date - this.dateRange.start) / (1000 * 60 * 60 * 24));\r\n    return daysFromStart * this.canvas.pixelsPerDay;\r\n  }\r\n\r\n  /**\r\n   * Convert X coordinate to date\r\n   */\r\n  _xToDate(x) {\r\n    const daysFromStart = x / this.canvas.pixelsPerDay;\r\n    const date = new Date(this.dateRange.start);\r\n    date.setDate(date.getDate() + Math.floor(daysFromStart));\r\n    return date;\r\n  }\r\n\r\n  /**\r\n   * Update mode (planned/actual)\r\n   */\r\n  setMode(mode) {\r\n    this.options.mode = mode;\r\n    this._scheduleRender();\r\n  }\r\n\r\n  /**\r\n   * Sync scroll with tree panel\r\n   */\r\n  syncScrollY(scrollTop) {\r\n    this.elements.content.scrollTop = scrollTop;\r\n  }\r\n\r\n  /**\r\n   * Get scroll state\r\n   */\r\n  getScrollState() {\r\n    return this.scrollState;\r\n  }\r\n\r\n  /**\r\n   * Destroy timeline panel\r\n   */\r\n  destroy() {\r\n    if (this._animationFrameId) {\r\n      cancelAnimationFrame(this._animationFrameId);\r\n    }\r\n\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n    }\r\n\r\n    this.container.innerHTML = '';\r\n    console.log(' Timeline Panel destroyed');\r\n  }\r\n}\r\n\r\nexport default GanttTimelinePanel;\r\n","/**\r\n * Gantt Chart Redesign - Main Component\r\n * Orchestrates tree panel, timeline panel, and data synchronization\r\n * @module gantt-chart-redesign\r\n */\r\n\r\nimport { GanttDataModel } from './gantt-data-model.js';\r\nimport { GanttTreePanel } from './gantt-tree-panel.js';\r\nimport { GanttTimelinePanel } from './gantt-timeline-panel.js';\r\nimport { Toast } from '@modules/shared/ux-enhancements.js';\r\n\r\n/**\r\n * Main Gantt Chart Component\r\n */\r\nexport class GanttChartRedesign {\r\n  constructor(container, options = {}) {\r\n    this.container = typeof container === 'string'\r\n      ? document.querySelector(container)\r\n      : container;\r\n\r\n    if (!this.container) {\r\n      throw new Error('Gantt container not found');\r\n    }\r\n\r\n    // Options\r\n    this.options = {\r\n      mode: options.mode || 'planned', // 'planned' or 'actual'\r\n      rowHeight: options.rowHeight || 40,\r\n      enableMilestones: options.enableMilestones !== false,\r\n      enableSync: options.enableSync !== false,\r\n      ...options\r\n    };\r\n\r\n    // Data model\r\n    this.dataModel = new GanttDataModel();\r\n\r\n    // Components\r\n    this.treePanel = null;\r\n    this.timelinePanel = null;\r\n\r\n    // State\r\n    this.state = {\r\n      loading: false,\r\n      initialized: false,\r\n      selectedNodeId: null,\r\n      mode: this.options.mode\r\n    };\r\n\r\n    // Event callbacks\r\n    this.onDataChange = options.onDataChange || (() => {});\r\n    this.onNodeSelect = options.onNodeSelect || (() => {});\r\n    this.onMilestoneChange = options.onMilestoneChange || (() => {});\r\n\r\n    // Milestone popup\r\n    this.milestonePopup = null;\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt Chart\r\n   */\r\n  async initialize(rawData) {\r\n    console.log(' Initializing Gantt Chart Redesign...');\r\n    this.state.loading = true;\r\n\r\n    try {\r\n      // Build DOM structure (tree + timeline containers)\r\n      this._buildDOM();\r\n\r\n      // Note: Loading spinner already shown in HTML template\r\n      // No need to call _showLoading() which would overwrite the DOM!\r\n\r\n      // Initialize data model\r\n      this.dataModel.initialize(rawData);\r\n\r\n      // Create components\r\n      await this._createComponents();\r\n\r\n      // Setup synchronization\r\n      this._setupSync();\r\n\r\n      // Mark as initialized BEFORE rendering\r\n      this.state.loading = false;\r\n      this.state.initialized = true;\r\n\r\n      // Initial render (must be after state.initialized = true)\r\n      this.render();\r\n\r\n      console.log(' Gantt Chart Redesign initialized successfully');\r\n      Toast.success('Gantt Chart loaded successfully');\r\n\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Gantt Chart:', error);\r\n      this._showError('Failed to initialize Gantt Chart: ' + error.message);\r\n      this.state.loading = false;\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build DOM structure\r\n   */\r\n  _buildDOM() {\r\n    this.container.innerHTML = '';\r\n    this.container.className = 'gantt-container';\r\n\r\n    // Create panels\r\n    const treeContainer = document.createElement('div');\r\n    treeContainer.className = 'gantt-tree-panel-container';\r\n    this.container.appendChild(treeContainer);\r\n\r\n    const timelineContainer = document.createElement('div');\r\n    timelineContainer.className = 'gantt-timeline-panel-container';\r\n    this.container.appendChild(timelineContainer);\r\n\r\n    // Store references\r\n    this.elements = {\r\n      treeContainer,\r\n      timelineContainer\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create components\r\n   */\r\n  async _createComponents() {\r\n    // Create tree panel\r\n    this.treePanel = new GanttTreePanel(\r\n      this.elements.treeContainer,\r\n      this.dataModel,\r\n      {\r\n        mode: this.state.mode,\r\n        onNodeClick: (nodeId) => this._handleNodeClick(nodeId),\r\n        onNodeExpand: (nodeId, expanded) => this._handleNodeExpand(nodeId, expanded),\r\n        onSearchChange: (searchText) => this._handleSearchChange(searchText)\r\n      }\r\n    );\r\n\r\n    // Create timeline panel\r\n    this.timelinePanel = new GanttTimelinePanel(\r\n      this.elements.timelineContainer,\r\n      this.dataModel,\r\n      {\r\n        mode: this.state.mode,\r\n        rowHeight: this.options.rowHeight,\r\n        showMilestones: this.options.enableMilestones,\r\n        onBarClick: (node, type, event) => this._handleBarClick(node, type, event),\r\n        onMilestoneClick: (milestone, event) => this._handleMilestoneClick(milestone, event),\r\n        onScroll: (scrollState) => this._handleTimelineScroll(scrollState)\r\n      }\r\n    );\r\n\r\n    // Create milestone popup\r\n    this._createMilestonePopup();\r\n  }\r\n\r\n  /**\r\n   * Setup synchronization between panels\r\n   */\r\n  _setupSync() {\r\n    if (!this.options.enableSync) return;\r\n\r\n    // Sync scroll between tree and timeline\r\n    let treeScrolling = false;\r\n    let timelineScrolling = false;\r\n\r\n    // Tree scroll -> Timeline scroll\r\n    this.treePanel.elements.treeContent.addEventListener('scroll', () => {\r\n      if (timelineScrolling) return;\r\n      treeScrolling = true;\r\n\r\n      const scrollTop = this.treePanel.getScrollTop();\r\n      this.timelinePanel.syncScrollY(scrollTop);\r\n\r\n      setTimeout(() => { treeScrolling = false; }, 50);\r\n    });\r\n\r\n    // Timeline scroll -> Tree scroll\r\n    this.timelinePanel.elements.content.addEventListener('scroll', () => {\r\n      if (treeScrolling) return;\r\n      timelineScrolling = true;\r\n\r\n      const scrollTop = this.timelinePanel.elements.content.scrollTop;\r\n      this.treePanel.setScrollTop(scrollTop);\r\n\r\n      setTimeout(() => { timelineScrolling = false; }, 50);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle node click\r\n   */\r\n  _handleNodeClick(nodeId) {\r\n    this.state.selectedNodeId = nodeId;\r\n    const node = this.dataModel.getNodeById(nodeId);\r\n\r\n    console.log(' Node selected:', node);\r\n\r\n    // Notify external listeners\r\n    this.onNodeSelect(node);\r\n\r\n    // Highlight in timeline (future enhancement)\r\n  }\r\n\r\n  /**\r\n   * Handle node expand/collapse\r\n   */\r\n  _handleNodeExpand(nodeId, expanded) {\r\n    console.log(`${expanded ? '' : ''} Node ${expanded ? 'expanded' : 'collapsed'}:`, nodeId);\r\n\r\n    // Re-render both panels\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Handle search change\r\n   */\r\n  _handleSearchChange(searchText) {\r\n    console.log(' Search:', searchText);\r\n\r\n    // Future: Highlight matching nodes in timeline\r\n  }\r\n\r\n  /**\r\n   * Handle bar click\r\n   */\r\n  _handleBarClick(node, type, event) {\r\n    console.log(` Bar clicked: ${node.name} (${type})`);\r\n\r\n    // Select the node\r\n    this._handleNodeClick(node.id);\r\n\r\n    // Show bar details (future enhancement)\r\n    Toast.info(`${node.name}: ${type === 'planned' ? 'Planned' : 'Actual'} - ${type === 'planned' ? node.planned.progress : node.actual.progress}%`);\r\n  }\r\n\r\n  /**\r\n   * Handle milestone click\r\n   */\r\n  _handleMilestoneClick(milestone, event) {\r\n    console.log(' Milestone clicked:', milestone);\r\n\r\n    // Show milestone popup\r\n    this._showMilestonePopup(milestone, event);\r\n  }\r\n\r\n  /**\r\n   * Handle timeline scroll\r\n   */\r\n  _handleTimelineScroll(scrollState) {\r\n    // Future: Update visible date range indicator\r\n  }\r\n\r\n  /**\r\n   * Create milestone popup\r\n   */\r\n  _createMilestonePopup() {\r\n    if (!this.options.enableMilestones) return;\r\n\r\n    const popup = document.createElement('div');\r\n    popup.className = 'milestone-popup';\r\n    popup.innerHTML = `\r\n      <div class=\"milestone-popup-header\">\r\n        <h6 class=\"milestone-popup-title\"></h6>\r\n        <button class=\"milestone-popup-close\" aria-label=\"Close\">\r\n          <i class=\"bi bi-x\"></i>\r\n        </button>\r\n      </div>\r\n      <div class=\"milestone-popup-body\">\r\n        <div class=\"milestone-popup-date\">\r\n          <i class=\"bi bi-calendar\"></i>\r\n          <span class=\"milestone-date-text\"></span>\r\n        </div>\r\n        <div class=\"milestone-popup-description\"></div>\r\n        <div class=\"milestone-popup-comments\"></div>\r\n      </div>\r\n    `;\r\n\r\n    document.body.appendChild(popup);\r\n    this.milestonePopup = popup;\r\n\r\n    // Close button\r\n    popup.querySelector('.milestone-popup-close').addEventListener('click', () => {\r\n      this._hideMilestonePopup();\r\n    });\r\n\r\n    // Click outside to close\r\n    document.addEventListener('click', (e) => {\r\n      if (popup.classList.contains('visible') &&\r\n          !popup.contains(e.target) &&\r\n          !e.target.closest('.milestone-marker')) {\r\n        this._hideMilestonePopup();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show milestone popup\r\n   */\r\n  _showMilestonePopup(milestone, event) {\r\n    if (!this.milestonePopup) return;\r\n\r\n    // Populate popup\r\n    this.milestonePopup.querySelector('.milestone-popup-title').textContent = milestone.title;\r\n    this.milestonePopup.querySelector('.milestone-date-text').textContent =\r\n      milestone.date.toLocaleDateString('en-US', {\r\n        weekday: 'long',\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      });\r\n    this.milestonePopup.querySelector('.milestone-popup-description').textContent =\r\n      milestone.description || 'No description';\r\n\r\n    // Render comments\r\n    const commentsContainer = this.milestonePopup.querySelector('.milestone-popup-comments');\r\n    if (milestone.comments.length > 0) {\r\n      commentsContainer.innerHTML = milestone.comments.map(comment => `\r\n        <div class=\"milestone-comment\">\r\n          <div class=\"milestone-comment-author\">${comment.author}</div>\r\n          <div class=\"milestone-comment-text\">${comment.text}</div>\r\n          <div class=\"milestone-comment-time\">${this._formatDate(comment.timestamp)}</div>\r\n        </div>\r\n      `).join('');\r\n    } else {\r\n      commentsContainer.innerHTML = '<p class=\"text-muted\">No comments yet</p>';\r\n    }\r\n\r\n    // Position popup near click\r\n    const x = event.clientX;\r\n    const y = event.clientY;\r\n\r\n    this.milestonePopup.style.left = x + 10 + 'px';\r\n    this.milestonePopup.style.top = y + 10 + 'px';\r\n\r\n    // Show popup\r\n    this.milestonePopup.classList.add('visible');\r\n  }\r\n\r\n  /**\r\n   * Hide milestone popup\r\n   */\r\n  _hideMilestonePopup() {\r\n    if (this.milestonePopup) {\r\n      this.milestonePopup.classList.remove('visible');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format date for display\r\n   */\r\n  _formatDate(date) {\r\n    const now = new Date();\r\n    const diff = now - date;\r\n    const seconds = Math.floor(diff / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    const hours = Math.floor(minutes / 60);\r\n    const days = Math.floor(hours / 24);\r\n\r\n    if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;\r\n    if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;\r\n    if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\r\n    return 'Just now';\r\n  }\r\n\r\n  /**\r\n   * Show loading state\r\n   */\r\n  _showLoading() {\r\n    this.container.innerHTML = `\r\n      <div class=\"gantt-loading\">\r\n        <div class=\"gantt-loading-spinner\"></div>\r\n        <p>Loading Gantt Chart...</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Show error state\r\n   */\r\n  _showError(message) {\r\n    this.container.innerHTML = `\r\n      <div class=\"gantt-empty\">\r\n        <i class=\"bi bi-exclamation-triangle text-danger\"></i>\r\n        <h5>Error Loading Gantt Chart</h5>\r\n        <p>${message}</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Show empty state\r\n   */\r\n  _showEmpty() {\r\n    this.container.innerHTML = `\r\n      <div class=\"gantt-empty\">\r\n        <i class=\"bi bi-calendar-x\"></i>\r\n        <h5>No Data Available</h5>\r\n        <p>No tasks to display in Gantt Chart</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Render Gantt Chart\r\n   */\r\n  render() {\r\n    if (!this.state.initialized) return;\r\n\r\n    // Check if data is empty\r\n    if (this.dataModel.getTotalPekerjaanCount() === 0) {\r\n      this._showEmpty();\r\n      return;\r\n    }\r\n\r\n    // Render both panels\r\n    this.treePanel.render();\r\n    this.timelinePanel.render();\r\n  }\r\n\r\n  /**\r\n   * Set mode (planned/actual)\r\n   */\r\n  setMode(mode) {\r\n    if (!['planned', 'actual'].includes(mode)) {\r\n      console.warn('Invalid mode:', mode);\r\n      return;\r\n    }\r\n\r\n    this.state.mode = mode;\r\n\r\n    if (this.treePanel) {\r\n      this.treePanel.setMode(mode);\r\n    }\r\n\r\n    if (this.timelinePanel) {\r\n      this.timelinePanel.setMode(mode);\r\n    }\r\n\r\n    console.log(` Mode changed to: ${mode}`);\r\n  }\r\n\r\n  /**\r\n   * Expand all nodes\r\n   */\r\n  expandAll() {\r\n    if (this.treePanel) {\r\n      this.treePanel.expandAll();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Collapse all nodes\r\n   */\r\n  collapseAll() {\r\n    if (this.treePanel) {\r\n      this.treePanel.collapseAll();\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll to node\r\n   */\r\n  scrollToNode(nodeId) {\r\n    if (this.treePanel) {\r\n      this.treePanel.scrollToNode(nodeId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add milestone\r\n   */\r\n  addMilestone(milestoneData) {\r\n    const milestone = this.dataModel.addMilestone(milestoneData);\r\n    this.onMilestoneChange('add', milestone);\r\n    this.render();\r\n    Toast.success('Milestone added');\r\n    return milestone;\r\n  }\r\n\r\n  /**\r\n   * Remove milestone\r\n   */\r\n  removeMilestone(milestoneId) {\r\n    this.dataModel.removeMilestone(milestoneId);\r\n    this.onMilestoneChange('remove', milestoneId);\r\n    this.render();\r\n    Toast.success('Milestone removed');\r\n  }\r\n\r\n  /**\r\n   * Update data from external source (grid)\r\n   */\r\n  updateData(rawData) {\r\n    console.log(' Updating Gantt data...');\r\n\r\n    try {\r\n      this.dataModel.initialize(rawData);\r\n      this.render();\r\n      Toast.success('Gantt Chart updated');\r\n    } catch (error) {\r\n      console.error(' Failed to update data:', error);\r\n      Toast.error('Failed to update Gantt Chart');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export data\r\n   */\r\n  exportData() {\r\n    return this.dataModel.toJSON();\r\n  }\r\n\r\n  /**\r\n   * Get selected node\r\n   */\r\n  getSelectedNode() {\r\n    return this.dataModel.getNodeById(this.state.selectedNodeId);\r\n  }\r\n\r\n  /**\r\n   * Search nodes\r\n   */\r\n  search(searchText) {\r\n    return this.dataModel.searchNodes(searchText);\r\n  }\r\n\r\n  /**\r\n   * Destroy Gantt Chart\r\n   */\r\n  destroy() {\r\n    console.log(' Destroying Gantt Chart...');\r\n\r\n    if (this.treePanel) {\r\n      this.treePanel.destroy();\r\n    }\r\n\r\n    if (this.timelinePanel) {\r\n      this.timelinePanel.destroy();\r\n    }\r\n\r\n    if (this.milestonePopup) {\r\n      this.milestonePopup.remove();\r\n    }\r\n\r\n    this.container.innerHTML = '';\r\n    this.state.initialized = false;\r\n\r\n    console.log(' Gantt Chart destroyed');\r\n  }\r\n}\r\n\r\nexport default GanttChartRedesign;\r\n","/**\r\n * Jadwal Kegiatan Main Entry Point\r\n * Modern modular implementation with Vite bundling\r\n * License: MIT\r\n */\r\n/* global ExportManager */\r\n\r\nimport { attachGridEvents } from '@modules/grid/grid-event-handlers.js';\r\nimport { AGGridManager } from '@modules/grid/ag-grid-setup.js';\r\nimport { updateProgressIndicator } from '@modules/shared/validation-utils.js';\r\nimport { DataLoader } from '@modules/core/data-loader.js';\r\nimport { TimeColumnGenerator } from '@modules/core/time-column-generator.js';\r\nimport { GridRenderer } from '@modules/grid/grid-renderer.js';\r\nimport { SaveHandler } from '@modules/core/save-handler.js';\r\n// Chart modules now lazy loaded for better initial performance\r\n// import { KurvaSChart } from '@modules/kurva-s/echarts-setup.js';\r\n// import { GanttChart } from '@modules/gantt/frappe-gantt-setup.js'; // OLD - Frappe Gantt\r\nimport { GanttChartRedesign } from '@modules/gantt/gantt-chart-redesign.js'; // NEW - Redesigned Gantt\r\nimport { StateManager } from '@modules/core/state-manager.js'; // Phase 0.3: StateManager integration\r\nimport {\r\n  KeyboardShortcuts,\r\n  ButtonStateManager,\r\n  Toast,\r\n  initializeUXEnhancements\r\n} from '@modules/shared/ux-enhancements.js'; // UX Enhancements\r\n\r\n/**\r\n * Initialize Jadwal Kegiatan Grid Application\r\n */\r\nclass JadwalKegiatanApp {\r\n  constructor() {\r\n    this.state = null;\r\n    this.eventManager = null;\r\n    this.initialized = false;\r\n    this.agGridManager = null;\r\n\r\n    // Phase 0.3: StateManager for clean state management\r\n    this.stateManager = StateManager.getInstance();\r\n\r\n    // Modern modules\r\n    this.dataLoader = null;\r\n    this.timeColumnGenerator = null;\r\n    this.gridRenderer = null;\r\n    this.saveHandler = null;\r\n\r\n    // Chart modules (lazy loaded)\r\n    this.kurvaSChart = null;\r\n    this.ganttChart = null; // OLD Frappe Gantt (deprecated)\r\n    this.ganttChartRedesign = null; // NEW Redesigned Gantt\r\n    this._chartModulesLoaded = false;\r\n    this._chartModulesLoading = false;\r\n\r\n    // UX Enhancements\r\n    this.keyboardShortcuts = null;\r\n\r\n    this._weekBoundarySaveTimer = null;\r\n    this._pendingWeekBoundary = null;\r\n    this._isRegeneratingTimeline = false;\r\n    this._queuedRegeneratePayload = null;\r\n    this._isEnforcingWeekly = false;\r\n    this._exportManagerInstance = null;\r\n    this._exportBindingsAttached = false;\r\n    this._costToggleBtn = null;\r\n    this._costToggleBtnText = null;\r\n    this._costToggleSpinner = null;\r\n    this._costToggleBtnIcon = null;\r\n    this._costViewAutoActivated = false;\r\n    this._ganttScrollSyncHandlers = null;\r\n\r\n  }\r\n\r\n  _getProjectDateRange() {\r\n    let start = null;\r\n    let end = null;\r\n    if (this.state?.projectStart) {\r\n      const parsed = new Date(this.state.projectStart);\r\n      if (!Number.isNaN(parsed.getTime())) {\r\n        start = parsed;\r\n      }\r\n    }\r\n    if (this.state?.projectEnd) {\r\n      const parsedEnd = new Date(this.state.projectEnd);\r\n      if (!Number.isNaN(parsedEnd.getTime())) {\r\n        end = parsedEnd;\r\n      }\r\n    }\r\n    if (start && (!end || Number.isNaN(end.getTime()))) {\r\n      end = new Date(start.getFullYear(), 11, 31);\r\n    }\r\n    return { start, end };\r\n  }\r\n\r\n  _estimateExpectedWeeklyColumns() {\r\n    const { start, end } = this._getProjectDateRange();\r\n    if (!start || !end || Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n      return 0;\r\n    }\r\n    const msPerDay = 1000 * 60 * 60 * 24;\r\n    const diffDays = Math.max(0, Math.floor((end - start) / msPerDay)) + 1;\r\n    return Math.max(1, Math.ceil(diffDays / 7));\r\n  }\r\n\r\n  _countWeeklyColumns() {\r\n    if (!Array.isArray(this.state.timeColumns)) {\r\n      return 0;\r\n    }\r\n    return this.state.timeColumns.filter((col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      return Number.isFinite(Number(col.weekNumber ?? col.week_number));\r\n    }).length;\r\n  }\r\n\r\n  /**\r\n   * Initialize the application\r\n   *\r\n   * @param {Object} config - Configuration options\r\n   * @param {Object} config.initialState - Initial application state\r\n   * @param {Object} config.domRefs - DOM element references\r\n   */\r\n  async initialize(config = {}) {\r\n    if (this.initialized) {\r\n      console.warn('JadwalKegiatanApp already initialized');\r\n      return;\r\n    }\r\n\r\n    console.log(' Initializing Jadwal Kegiatan App (Vite Build)');\r\n\r\n    try {\r\n      // Setup state\r\n      this._setupState(config);\r\n\r\n      // Setup DOM references\r\n      this._setupDomRefs(config);\r\n\r\n      // Attach event handlers\r\n      this._attachEvents();\r\n\r\n      // Load initial data\r\n      await this._loadInitialData();\r\n\r\n      this.initialized = true;\r\n      console.log(' Jadwal Kegiatan App initialized successfully');\r\n\r\n      // Expose to window for backwards compatibility\r\n      window.JadwalKegiatanApp = this;\r\n    } catch (error) {\r\n      console.error(' Failed to initialize Jadwal Kegiatan App:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup application state\r\n   */\r\n  _setupState(config) {\r\n    // Check if there's existing global state (backwards compatibility)\r\n    const existingState = window.kelolaTahapanPageState || window.JadwalPekerjaanApp?.state;\r\n\r\n    this.state = Object.assign(\r\n      {\r\n        // Shared state (mode-independent)\r\n        pekerjaanTree: [],\r\n        timeColumns: [],\r\n        tahapanList: [],\r\n        timeColumnIndex: {},\r\n        expandedNodes: new Set(),\r\n        volumeMap: new Map(),\r\n        isLoading: false,\r\n        error: null,\r\n        domRefs: {},\r\n        apiEndpoints: {},\r\n        projectId: null,\r\n        projectName: '',\r\n        projectStart: null,\r\n        projectEnd: null,\r\n        useAgGrid: true, // Performance: AG Grid default enabled for large datasets\r\n        timeScale: 'weekly',\r\n        inputMode: 'percentage',\r\n        saveMode: 'weekly',\r\n        weekStartDay: 0,\r\n        weekEndDay: 6,\r\n        displayScale: null,\r\n        progressMode: 'planned',  // Phase 2E.1: Current active mode\r\n        displayMode: 'percentage', // Phase 2E.1: 'percentage' or 'volume'\r\n\r\n        // Phase 0.3: StateManager reference\r\n        stateManager: this.stateManager,\r\n\r\n        // Phase 0.3: Cell values now managed by StateManager\r\n        // Keeping other mode-specific state here temporarily for non-cell data\r\n        plannedState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n        actualState: {\r\n          // modifiedCells: managed by StateManager\r\n          // assignmentMap: managed by StateManager\r\n          progressTotals: new Map(),\r\n          volumeTotals: new Map(),\r\n          cellVolumeOverrides: new Map(),\r\n          cellValidationMap: new Map(),\r\n          failedRows: new Set(),\r\n          autoWarningRows: new Set(),\r\n          volumeWarningRows: new Set(),\r\n          validationWarningRows: new Set(),\r\n          saveErrorRows: new Set(),\r\n          apiFailedRows: new Set(),\r\n          showCompletionWarnings: false,\r\n          isDirty: false,\r\n        },\r\n\r\n        // Phase 0.3: Backward compatibility maintained via StateManager\r\n        // Legacy properties for non-cell data still delegate to current mode\r\n        progressTotals: null,\r\n        volumeTotals: null,\r\n        cellVolumeOverrides: null,\r\n        cellValidationMap: null,\r\n        failedRows: null,\r\n        autoWarningRows: null,\r\n        volumeWarningRows: null,\r\n        validationWarningRows: null,\r\n        saveErrorRows: null,\r\n        apiFailedRows: null,\r\n        showCompletionWarnings: false,\r\n        isDirty: false,\r\n      },\r\n      existingState || {},\r\n      config.initialState || {}\r\n    );\r\n\r\n    // Expose to window for backwards compatibility\r\n    window.kelolaTahapanPageState = this.state;\r\n\r\n    this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n    this._ensureStateCollections();\r\n    if (!this.state.displayScale) {\r\n      this.state.displayScale = this.state.timeScale || 'weekly';\r\n    }\r\n\r\n    // Phase 2E.1: Setup property delegation for backward compatibility\r\n    this._setupStateDelegation();\r\n  }\r\n\r\n  /**\r\n   * Setup property delegation for backward compatibility.\r\n   * Phase 0.3: Cell data (modifiedCells, assignmentMap) now managed by StateManager\r\n   * Other mode-specific properties still delegate to current mode state\r\n   */\r\n  _setupStateDelegation() {\r\n    const getCurrentState = () => {\r\n      return this.state.progressMode === 'actual'\r\n        ? this.state.actualState\r\n        : this.state.plannedState;\r\n    };\r\n\r\n    // Phase 0.3: modifiedCells and assignmentMap are now managed by StateManager\r\n    // Add backward compatibility getters that delegate to StateManager\r\n    Object.defineProperty(this.state, 'modifiedCells', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        // This is used by legacy code that expects Map operations\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].modifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'assignmentMap', {\r\n      get: () => {\r\n        // Return a Map-like object for backward compatibility\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].assignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costAssignmentMap', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costAssignmentMap;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'costModifiedCells', {\r\n      get: () => {\r\n        const mode = this.state.progressMode;\r\n        return this.stateManager.states[mode].costModifiedCells;\r\n      },\r\n      configurable: true\r\n    });\r\n\r\n    // Other properties still delegate to current mode state (not managed by StateManager yet)\r\n    Object.defineProperty(this.state, 'progressTotals', {\r\n      get: () => getCurrentState().progressTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'volumeTotals', {\r\n      get: () => getCurrentState().volumeTotals,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellVolumeOverrides', {\r\n      get: () => getCurrentState().cellVolumeOverrides,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'cellValidationMap', {\r\n      get: () => getCurrentState().cellValidationMap,\r\n      configurable: true\r\n    });\r\n\r\n    Object.defineProperty(this.state, 'isDirty', {\r\n      get: () => getCurrentState().isDirty || this.stateManager.hasUnsavedChanges(),\r\n      set: (value) => { getCurrentState().isDirty = value; },\r\n      configurable: true\r\n    });\r\n\r\n    console.log('[JadwalKegiatanApp] Phase 0.3: State delegation setup with StateManager integration');\r\n  }\r\n\r\n  /**\r\n   * Get the current mode's state object.\r\n   * Phase 0.3: Delegated to StateManager\r\n   * @returns {Object} Current mode state (plannedState or actualState)\r\n   */\r\n  _getCurrentModeState() {\r\n    const mode = this.state.progressMode === 'actual' ? 'actual' : 'planned';\r\n    return this.stateManager.states[mode];\r\n  }\r\n\r\n  _updateSaveButtonState() {\r\n    const saveButton = this.state?.domRefs?.saveButton;\r\n    if (!saveButton) {\r\n      return;\r\n    }\r\n    const hasFailures = this.state?.failedRows instanceof Set && this.state.failedRows.size > 0;\r\n    saveButton.disabled = false;\r\n    saveButton.classList.toggle('btn-outline-danger', Boolean(hasFailures));\r\n    saveButton.classList.toggle('btn-success', !hasFailures);\r\n    if (hasFailures) {\r\n      saveButton.setAttribute(\r\n        'title',\r\n        'Ada baris dengan peringatan (>100%/volume). Klik untuk melihat detail dan perbaiki.'\r\n      );\r\n    } else {\r\n      saveButton.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  _ensureStateCollections() {\r\n    if (!(this.state.failedRows instanceof Set)) {\r\n      this.state.failedRows = new Set();\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    if (!(this.state.apiFailedRows instanceof Set)) {\r\n      this.state.apiFailedRows = new Set();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup DOM references\r\n   */\r\n  _setupDomRefs(config) {\r\n    const domRefs = Object.assign(\r\n      {\r\n        root: document.getElementById('tahapan-grid-app'),\r\n        leftThead: document.getElementById('left-thead'),\r\n        rightThead: document.getElementById('right-thead'),\r\n        leftTbody: document.getElementById('left-tbody'),\r\n        rightTbody: document.getElementById('right-tbody'),\r\n        leftPanelScroll: document.querySelector('.left-panel-scroll'),\r\n        rightPanelScroll:\r\n          document.getElementById('right-panel-scroll-bottom') ||\r\n          document.querySelector('.right-panel-scroll'),\r\n        rightTable: document.getElementById('right-table'),\r\n        horizontalScrollTop: document.getElementById('right-panel-scroll-top'),\r\n        horizontalScrollInner: document.getElementById('right-panel-scroll-inner'),\r\n        timeHeaderRow: document.getElementById('time-header-row'),\r\n        saveButton: document.getElementById('save-button') || document.getElementById('btn-save-all'),\r\n        refreshButton: document.getElementById('refresh-button'),\r\n        resetButton: document.getElementById('btn-reset-progress'),\r\n        agGridContainer: document.getElementById('ag-grid-container'),\r\n        agGridTopScroll: document.getElementById('ag-grid-scroll-top'),\r\n        agGridTopScrollInner: document.getElementById('ag-grid-scroll-inner'),\r\n        scurveChart: document.getElementById('scurve-chart'),\r\n        ganttChart: document.getElementById('gantt-chart'),\r\n        ganttChartWrapper: document.getElementById('gantt-chart-wrapper'),\r\n        ganttTreeBody: document.getElementById('gantt-tree-body'),\r\n        ganttTreeScroll: document.getElementById('gantt-tree-scroll'),\r\n        ganttSummaryTable: document.getElementById('gantt-summary-table'),\r\n        ganttSummaryBody: document.getElementById('gantt-summary-body'),\r\n        ganttSummaryTotal: document.getElementById('gantt-summary-total'),\r\n        statusBar: document.querySelector('.status-bar'),\r\n        statusMessageEl: document.getElementById('status-message'),\r\n        itemCountEl: document.getElementById('item-count'),\r\n        modifiedCountEl: document.getElementById('modified-count'),\r\n        totalProgressEl: document.getElementById('total-progress'),\r\n        weekStartSelect: document.getElementById('week-start-day-select'),\r\n        weekEndSelect: document.getElementById('week-end-day-select'),\r\n      },\r\n      config.domRefs || {}\r\n    );\r\n\r\n    this.state.domRefs = domRefs;\r\n    this._updateSaveButtonState();\r\n\r\n    if (!domRefs.root) {\r\n      throw new Error('Root container #tahapan-grid-app tidak ditemukan');\r\n    }\r\n\r\n    this._applyDataset(domRefs.root);\r\n\r\n    if (this.state.useAgGrid) {\r\n      if (!domRefs.agGridContainer) {\r\n        throw new Error('AG Grid container #ag-grid-container tidak ditemukan');\r\n      }\r\n    } else {\r\n      if (!domRefs.leftTbody || !domRefs.rightTbody) {\r\n        throw new Error('Critical DOM elements not found (leftTbody, rightTbody)');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply dataset attributes from root container into state\r\n   */\r\n  _applyDataset(rootElement) {\r\n    if (!rootElement || !rootElement.dataset) {\r\n      return;\r\n    }\r\n\r\n    const { dataset } = rootElement;\r\n\r\n    this.state.projectId = Number(dataset.projectId || this.state.projectId || 0) || this.state.projectId;\r\n    this.state.projectName = dataset.projectName || this.state.projectName;\r\n    this.state.projectStart = dataset.projectStart || this.state.projectStart;\r\n    this.state.projectEnd = dataset.projectEnd || this.state.projectEnd;\r\n\r\n    const allowedTimeScales = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    const datasetScale =\r\n      (dataset.defaultTimeScale ||\r\n        dataset.timeScale ||\r\n        dataset.saveMode ||\r\n        this.state.timeScale ||\r\n        this.state.saveMode ||\r\n        '')\r\n        .toString()\r\n        .toLowerCase();\r\n    if (allowedTimeScales.has(datasetScale)) {\r\n      this.state.timeScale = datasetScale;\r\n      this.state.saveMode = datasetScale;\r\n    } else if (!this.state.timeScale) {\r\n      this.state.timeScale = this.state.saveMode || 'weekly';\r\n    }\r\n    this.state.displayScale = this.state.timeScale || 'weekly';\r\n\r\n    const datasetInputMode =\r\n      (dataset.defaultInputMode || dataset.inputMode || dataset.displayMode || this.state.inputMode || 'percentage')\r\n        .toString()\r\n        .toLowerCase();\r\n    const allowedInputModes = new Set(['percentage', 'volume', 'cost']);\r\n    this.state.inputMode = allowedInputModes.has(datasetInputMode) ? datasetInputMode : 'percentage';\r\n\r\n    const parsedWeekEndDay = Number.parseInt(\r\n      dataset.weekEndDay ?? dataset.weekend ?? dataset.weekEnd ?? dataset.week_end_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekEndDay = parsedWeekEndDay;\r\n    }\r\n\r\n    const parsedWeekStartDay = Number.parseInt(\r\n      dataset.weekStartDay ?? dataset.week_start_day ?? '',\r\n      10\r\n    );\r\n    if (!Number.isNaN(parsedWeekStartDay)) {\r\n      const normalized = ((parsedWeekStartDay % 7) + 7) % 7;\r\n      this.state.weekStartDay = normalized;\r\n    } else if (!Number.isNaN(parsedWeekEndDay)) {\r\n      this.state.weekStartDay = (this.state.weekEndDay + 1) % 7;\r\n    }\r\n\r\n    const endpoints = Object.assign(\r\n      {\r\n        base: dataset.apiBase || '',\r\n        tahapan: dataset.apiTahapan || dataset.apiBase || '',\r\n        listPekerjaan: dataset.apiListPekerjaan || '',\r\n        volume: dataset.apiVolume || '',\r\n        assignmentsBase: dataset.apiAssignmentsBase || '',\r\n        save:\r\n          dataset.apiSave ||\r\n          (this.state.apiEndpoints && this.state.apiEndpoints.save) ||\r\n          this._getDefaultSaveEndpoint(),\r\n        weekBoundary: dataset.apiWeekBoundary || '',\r\n        regenerateTahapan: dataset.apiRegenerateTahapan || '',\r\n        reset: dataset.apiResetProgress || (this.state.apiEndpoints && this.state.apiEndpoints.reset) || '',\r\n      },\r\n      this.state.apiEndpoints || {}\r\n    );\r\n\r\n    this.state.apiEndpoints = endpoints;\r\n    this.state.useAgGrid = dataset.enableAgGrid === 'true' || this.state.useAgGrid;\r\n  }\r\n\r\n  /**\r\n   * Attach event handlers using modern delegation pattern\r\n   */\r\n  _attachEvents() {\r\n    const helpers = {\r\n      updateProgressIndicator: (pekerjaanId, total) => {\r\n        updateProgressIndicator(pekerjaanId, total, this.state);\r\n      },\r\n      showToast: this.showToast.bind(this),\r\n    };\r\n\r\n    if (!this.state.useAgGrid) {\r\n      this.eventManager = attachGridEvents(this.state, helpers);\r\n    } else if (this.eventManager) {\r\n      this.eventManager.cleanup();\r\n      this.eventManager = null;\r\n    }\r\n\r\n    // Attach toolbar events\r\n    this._attachToolbarEvents();\r\n\r\n    // Initialize AG Grid when enabled\r\n    this._initAgGridIfNeeded();\r\n  }\r\n\r\n  /**\r\n   * Attach toolbar button events\r\n   */\r\n  _attachToolbarEvents() {\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    const refreshButton = this.state.domRefs.refreshButton;\r\n    const resetButton = this.state.domRefs.resetButton;\r\n\r\n    if (saveButton) {\r\n      saveButton.addEventListener('click', () => this.saveChanges());\r\n    }\r\n\r\n    if (refreshButton) {\r\n      refreshButton.addEventListener('click', () => this.refresh());\r\n    }\r\n\r\n    if (resetButton) {\r\n      resetButton.addEventListener('click', () => this._handleResetProgress());\r\n    }\r\n\r\n    this._syncToolbarRadios();\r\n    this._attachRadioGroupHandler('displayMode', (value) => this._handleDisplayModeChange(value));\r\n    this._attachRadioGroupHandler('progressMode', (value) => this._handleProgressModeChange(value));  // Phase 2E.1\r\n    this._attachRadioGroupHandler('timeScale', (value) => this._handleTimeScaleChange(value));\r\n    this._setupWeekBoundaryControls();\r\n    this._setupExportButtons();\r\n    this._setupCostViewToggle();  // Phase 1: Cost view toggle button\r\n    this._setupKeyboardShortcuts();  // UX Enhancement: Keyboard shortcuts\r\n    this._setupUXEnhancements();  // UX Enhancement: Ripple effects, tooltips\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard shortcuts for power users\r\n   */\r\n  _setupKeyboardShortcuts() {\r\n    // Initialize keyboard shortcuts manager\r\n    this.keyboardShortcuts = new KeyboardShortcuts();\r\n\r\n    // Ctrl+S: Save\r\n    this.keyboardShortcuts.register('ctrl+s', () => {\r\n      this.saveChanges();\r\n      Toast.info('Saving changes... (Ctrl+S)');\r\n    }, {\r\n      description: 'Save all changes'\r\n    });\r\n\r\n    // Ctrl+R: Refresh (override browser default)\r\n    this.keyboardShortcuts.register('ctrl+r', () => {\r\n      this.refresh();\r\n      Toast.info('Refreshing data... (Ctrl+R)');\r\n    }, {\r\n      description: 'Refresh data from server'\r\n    });\r\n\r\n    // Ctrl+Alt+P: Switch to Planned mode\r\n    this.keyboardShortcuts.register('ctrl+alt+p', () => {\r\n      const plannedRadio = document.getElementById('mode-planned');\r\n      if (plannedRadio) {\r\n        plannedRadio.checked = true;\r\n        plannedRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Perencanaan mode (Ctrl+Alt+P)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Perencanaan mode'\r\n    });\r\n\r\n    // Ctrl+Alt+A: Switch to Actual mode\r\n    this.keyboardShortcuts.register('ctrl+alt+a', () => {\r\n      const actualRadio = document.getElementById('mode-actual');\r\n      if (actualRadio) {\r\n        actualRadio.checked = true;\r\n        actualRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Switched to Realisasi mode (Ctrl+Alt+A)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Realisasi mode'\r\n    });\r\n\r\n    // Ctrl+Alt+1: Switch to Percentage display\r\n    this.keyboardShortcuts.register('ctrl+alt+1', () => {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio && !percentageRadio.disabled) {\r\n        percentageRadio.checked = true;\r\n        percentageRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Percentage (Ctrl+Alt+1)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Percentage display'\r\n    });\r\n\r\n    // Ctrl+Alt+2: Switch to Volume display\r\n    this.keyboardShortcuts.register('ctrl+alt+2', () => {\r\n      const volumeRadio = document.getElementById('mode-volume');\r\n      if (volumeRadio && !volumeRadio.disabled) {\r\n        volumeRadio.checked = true;\r\n        volumeRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Volume (Ctrl+Alt+2)');\r\n      }\r\n    }, {\r\n      description: 'Switch to Volume display'\r\n    });\r\n\r\n    // Ctrl+Alt+3: Switch to Cost display (if enabled)\r\n    this.keyboardShortcuts.register('ctrl+alt+3', () => {\r\n      const costRadio = document.getElementById('mode-cost');\r\n      if (costRadio && !costRadio.disabled) {\r\n        costRadio.checked = true;\r\n        costRadio.dispatchEvent(new Event('change', { bubbles: true }));\r\n        Toast.info('Display: Cost (Ctrl+Alt+3)');\r\n      } else {\r\n        Toast.warning('Cost view only available in Realisasi mode');\r\n      }\r\n    }, {\r\n      description: 'Switch to Cost display'\r\n    });\r\n\r\n    // Escape: Close modals/dropdowns\r\n    this.keyboardShortcuts.register('escape', () => {\r\n      // Close any open Bootstrap dropdowns\r\n      const openDropdowns = document.querySelectorAll('.dropdown-menu.show');\r\n      openDropdowns.forEach(dropdown => {\r\n        const toggle = dropdown.previousElementSibling;\r\n        if (toggle) {\r\n          const bsDropdown = bootstrap.Dropdown.getInstance(toggle);\r\n          if (bsDropdown) bsDropdown.hide();\r\n        }\r\n      });\r\n    }, {\r\n      description: 'Close open menus',\r\n      preventDefault: false // Allow default Escape behavior\r\n    });\r\n\r\n    // Ctrl+?: Show keyboard shortcuts help\r\n    this.keyboardShortcuts.register('ctrl+shift+/', () => {\r\n      this._showKeyboardShortcutsHelp();\r\n    }, {\r\n      description: 'Show keyboard shortcuts help'\r\n    });\r\n\r\n    console.log(' Keyboard shortcuts registered:', this.keyboardShortcuts.getShortcuts());\r\n  }\r\n\r\n  /**\r\n   * Setup UX enhancements (ripple effects, tooltips, etc.)\r\n   */\r\n  _setupUXEnhancements() {\r\n    // Initialize general UX enhancements\r\n    initializeUXEnhancements();\r\n\r\n    // Add keyboard hint to Save button\r\n    const saveButton = this.state.domRefs.saveButton;\r\n    if (saveButton) {\r\n      saveButton.setAttribute('data-keyboard-hint', 'Ctrl+S');\r\n    }\r\n\r\n    console.log(' UX enhancements applied');\r\n  }\r\n\r\n  /**\r\n   * Show keyboard shortcuts help modal\r\n   */\r\n  _showKeyboardShortcutsHelp() {\r\n    const shortcuts = this.keyboardShortcuts.getShortcuts();\r\n    const shortcutList = shortcuts.map(s => `\r\n      <tr>\r\n        <td><kbd>${s.key.replace(/\\+/g, '</kbd> + <kbd>')}</kbd></td>\r\n        <td>${s.description}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    const modalHtml = `\r\n      <div class=\"modal fade\" id=\"keyboardShortcutsModal\" tabindex=\"-1\">\r\n        <div class=\"modal-dialog\">\r\n          <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n              <h5 class=\"modal-title\">\r\n                <i class=\"bi bi-keyboard\"></i> Keyboard Shortcuts\r\n              </h5>\r\n              <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n              <table class=\"table table-sm\">\r\n                <thead>\r\n                  <tr>\r\n                    <th style=\"width: 40%\">Shortcut</th>\r\n                    <th>Action</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  ${shortcutList}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Remove existing modal if any\r\n    const existingModal = document.getElementById('keyboardShortcutsModal');\r\n    if (existingModal) existingModal.remove();\r\n\r\n    // Add modal to DOM\r\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\r\n\r\n    // Show modal\r\n    const modal = new bootstrap.Modal(document.getElementById('keyboardShortcutsModal'));\r\n    modal.show();\r\n\r\n    // Cleanup on hide\r\n    document.getElementById('keyboardShortcutsModal').addEventListener('hidden.bs.modal', function() {\r\n      this.remove();\r\n    });\r\n  }\r\n\r\n  _setupExportButtons() {\r\n    if (this._exportBindingsAttached) {\r\n      return;\r\n    }\r\n    if (typeof ExportManager === 'undefined') {\r\n      console.warn('[JadwalKegiatanApp] ExportManager is not loaded; export buttons disabled');\r\n      return;\r\n    }\r\n    if (!this.state?.projectId) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this._exportManagerInstance = new ExportManager(this.state.projectId, 'jadwal-pekerjaan');\r\n      const formats = ['csv', 'pdf', 'word', 'xlsx'];\r\n      formats.forEach((format) => {\r\n        const button = document.getElementById(`btn-export-${format}`);\r\n        if (!button) {\r\n          return;\r\n        }\r\n        button.addEventListener('click', () => {\r\n          this._exportManagerInstance.exportAs(format);\r\n        });\r\n      });\r\n      this._exportBindingsAttached = true;\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to initialize export buttons', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Setup Cost View Toggle Button\r\n   * @private\r\n   */\r\n  _setupCostViewToggle() {\r\n    const toggleBtn = document.getElementById('toggleCostViewBtn');\r\n    const toggleBtnText = document.getElementById('toggleCostViewBtnText');\r\n    const toggleBtnSpinner = document.getElementById('toggleCostViewBtnSpinner');\r\n    const toggleBtnIcon = toggleBtn?.querySelector('i');\r\n\r\n    if (!toggleBtn) {\r\n      console.log('[JadwalKegiatanApp] Cost view toggle button not found (chart tab may not be active)');\r\n      return;\r\n    }\r\n\r\n    if (!this.kurvaSChart) {\r\n      console.warn('[JadwalKegiatanApp] Kurva S chart not initialized, cannot setup toggle');\r\n      return;\r\n    }\r\n\r\n    this._costToggleBtn = toggleBtn;\r\n    this._costToggleBtnText = toggleBtnText;\r\n    this._costToggleSpinner = toggleBtnSpinner;\r\n    this._costToggleBtnIcon = toggleBtnIcon;\r\n\r\n    toggleBtn.addEventListener('click', async () => {\r\n      toggleBtn.disabled = true;\r\n      toggleBtnSpinner?.classList.remove('d-none');\r\n\r\n      try {\r\n        const success = await this.kurvaSChart.toggleView();\r\n        if (success) {\r\n          this._setCostToggleButtonState();\r\n          console.log('[JadwalKegiatanApp] Switched Kurva-S view:', this.kurvaSChart.viewMode);\r\n        } else {\r\n          console.error('[JadwalKegiatanApp] Failed to toggle view');\r\n        }\r\n      } catch (error) {\r\n        console.error('[JadwalKegiatanApp] Error toggling cost view:', error);\r\n      } finally {\r\n        toggleBtn.disabled = false;\r\n        toggleBtnSpinner?.classList.add('d-none');\r\n      }\r\n    });\r\n\r\n    this._setCostToggleButtonState();\r\n    console.log('[JadwalKegiatanApp] Cost view toggle button setup complete');\r\n  }\r\n\r\n  _setCostToggleButtonState() {\r\n    if (!this._costToggleBtn || !this.kurvaSChart) {\r\n      return;\r\n    }\r\n\r\n    const isCostMode = this.kurvaSChart.viewMode === 'cost';\r\n    const label = isCostMode ? 'Show Progress View' : 'Show Cost View';\r\n    const iconClass = isCostMode ? 'fas fa-chart-line' : 'fas fa-money-bill-wave';\r\n\r\n    if (this._costToggleBtnText) {\r\n      this._costToggleBtnText.textContent = label;\r\n    }\r\n    if (this._costToggleBtnIcon) {\r\n      this._costToggleBtnIcon.className = iconClass;\r\n    }\r\n  }\r\n  async _activateDefaultCostView() {\r\n    if (this._costViewAutoActivated) {\r\n      this._setCostToggleButtonState();\r\n      return;\r\n    }\r\n\r\n  if (!this.kurvaSChart) {\r\n    return;\r\n  }\r\n\r\n  const chartOptions = this.kurvaSChart.options || {};\r\n  if (!chartOptions.enableCostView) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const success = await this.kurvaSChart.toggleView('cost');\r\n    if (success) {\r\n      this._costViewAutoActivated = true;\r\n      this._setCostToggleButtonState();\r\n      console.log('[JadwalKegiatanApp] Defaulted Kurva-S to cost view');\r\n    }\r\n  } catch (error) {\r\n    console.warn('[JadwalKegiatanApp] Failed to enable cost view automatically:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n  _attachRadioGroupHandler(groupName, handler) {\r\n    const radios = document.querySelectorAll(`input[name=\"${groupName}\"]`);\r\n    if (!radios || radios.length === 0) {\r\n      return;\r\n    }\r\n\r\n    radios.forEach((radio) => {\r\n      radio.addEventListener('change', (event) => {\r\n        if (!event.target.checked) {\r\n          return;\r\n        }\r\n        handler(event.target.value);\r\n      });\r\n    });\r\n  }\r\n\r\n  _setupWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (!weekStartSelect || !weekEndSelect) {\r\n      return;\r\n    }\r\n\r\n    this._syncWeekBoundaryControls();\r\n\r\n    weekStartSelect.addEventListener('change', (event) => {\r\n      const nextStart = this._normalizePythonWeekday(event.target.value, this._getWeekStartDay());\r\n      const derivedEnd = (nextStart + 6) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: nextStart, weekEndDay: derivedEnd, source: 'start' });\r\n    });\r\n\r\n    weekEndSelect.addEventListener('change', (event) => {\r\n      const nextEnd = this._normalizePythonWeekday(event.target.value, this._getWeekEndDay());\r\n      const derivedStart = (nextEnd + 1) % 7;\r\n      this._handleWeekBoundaryChange({ weekStartDay: derivedStart, weekEndDay: nextEnd, source: 'end' });\r\n    });\r\n  }\r\n\r\n  async _handleResetProgress() {\r\n    const endpoint = this.state.apiEndpoints?.reset;\r\n    if (!endpoint) {\r\n      this.showToast('Endpoint reset tidak tersedia', 'danger', 3200);\r\n      return;\r\n    }\r\n\r\n    // Phase 2E.1: Mode-aware reset\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const modeLabel = progressMode === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n\r\n    const confirmed = window.confirm(\r\n      `Reset semua progress ${modeLabel} ke 0%?\\n\\n` +\r\n      `Data ${modeLabel === 'Perencanaan' ? 'Realisasi' : 'Perencanaan'} tidak akan terpengaruh.\\n\\n` +\r\n      `Operasi ini dapat di-undo dengan memasukkan ulang data.`\r\n    );\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.state.isLoading = true;\r\n      this._updateStatusBar(`Mereset progress ${modeLabel}...`);\r\n\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({ mode: progressMode }),  // Phase 2E.1: Send mode parameter\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const text = await response.text().catch(() => '');\r\n        throw new Error(text || `HTTP ${response.status}`);\r\n      }\r\n\r\n      const result = await response.json().catch(() => ({}));\r\n      this._resetEditedCellsState();\r\n      if (this.state.assignmentMap instanceof Map) {\r\n        this.state.assignmentMap.clear();\r\n      } else {\r\n        this.state.assignmentMap = new Map();\r\n      }\r\n      this._clearFailedRows();\r\n      this.state.isDirty = false;\r\n\r\n      const message =\r\n        result?.message || 'Progress berhasil direset. Silakan input ulang jadwal pekerjaan.';\r\n      this.showToast(message, 'success', 3400);\r\n\r\n      await this._loadInitialData({ forceReload: true });\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to reset progress', error);\r\n      this.showToast('Gagal mereset progress. Coba lagi atau hubungi admin.', 'danger', 3600);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n    }\r\n  }\r\n\r\n  _syncWeekBoundaryControls() {\r\n    const { weekStartSelect, weekEndSelect } = this.state.domRefs || {};\r\n    if (weekStartSelect) {\r\n      weekStartSelect.value = String(this._getWeekStartDay());\r\n    }\r\n    if (weekEndSelect) {\r\n      weekEndSelect.value = String(this._getWeekEndDay());\r\n    }\r\n  }\r\n\r\n  _handleWeekBoundaryChange({ weekStartDay, weekEndDay, source }) {\r\n    const normalizedEnd = this._normalizePythonWeekday(weekEndDay, this._getWeekEndDay());\r\n    const normalizedStart = this._normalizePythonWeekday(weekStartDay, (normalizedEnd + 1) % 7);\r\n    if (normalizedStart === this._getWeekStartDay() && normalizedEnd === this._getWeekEndDay()) {\r\n      this._syncWeekBoundaryControls();\r\n      return;\r\n    }\r\n\r\n    this.state.weekStartDay = normalizedStart;\r\n    this.state.weekEndDay = normalizedEnd;\r\n    this._syncWeekBoundaryControls();\r\n\r\n    const label = `${this._formatWeekdayLabel(normalizedStart)}  ${this._formatWeekdayLabel(normalizedEnd)}`;\r\n    const prefix = source === 'start' ? 'Week start disetel ke' : 'Week end disetel ke';\r\n    this.showToast(`${prefix} ${label}`, 'info', 2400);\r\n\r\n    this._regenerateColumnsForWeekBoundary();\r\n    this._persistWeekBoundarySettings(normalizedStart, normalizedEnd);\r\n  }\r\n\r\n  _regenerateColumnsForWeekBoundary() {\r\n    if (!Array.isArray(this.state.tahapanList) || this.state.tahapanList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (!this.timeColumnGenerator) {\r\n      this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    }\r\n\r\n    try {\r\n      this.timeColumnGenerator.generate();\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n      this._syncGridViews();\r\n      this._recalculateAllProgressTotals();\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate columns for week boundary change', error);\r\n      this.showToast('Gagal menerapkan pengaturan minggu', 'danger', 3200);\r\n    }\r\n  }\r\n\r\n  _invalidateCachedDataset() {\r\n    this.state.pekerjaanTree = [];\r\n    this.state.tahapanList = [];\r\n    this.state.timeColumns = [];\r\n    this.state.flatPekerjaan = [];\r\n    this.state.timeColumnIndex = {};\r\n    this.state.assignmentMap = new Map();\r\n    this._resetEditedCellsState();\r\n  }\r\n\r\n  _resetEditedCellsState() {\r\n    if (this.state.modifiedCells instanceof Map) {\r\n      this.state.modifiedCells.clear();\r\n    } else {\r\n      this.state.modifiedCells = new Map();\r\n    }\r\n    if (this.state.cellVolumeOverrides instanceof Map) {\r\n      this.state.cellVolumeOverrides.clear();\r\n    } else {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    if (this.state.cellValidationMap instanceof Map) {\r\n      this.state.cellValidationMap.clear();\r\n    } else {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    if (this.state.validationWarningRows instanceof Set) {\r\n      this.state.validationWarningRows.clear();\r\n    } else {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    } else {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    this.state.showCompletionWarnings = false;\r\n  }\r\n\r\n  _persistWeekBoundarySettings(weekStartDay, weekEndDay) {\r\n    const endpoint = this.state.apiEndpoints?.weekBoundary;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._weekBoundarySaveTimer) {\r\n      clearTimeout(this._weekBoundarySaveTimer);\r\n    }\r\n    this._pendingWeekBoundary = { weekStartDay, weekEndDay };\r\n\r\n    this._weekBoundarySaveTimer = window.setTimeout(() => {\r\n      this._weekBoundarySaveTimer = null;\r\n      const payload = this._pendingWeekBoundary || { weekStartDay, weekEndDay };\r\n      this._pendingWeekBoundary = null;\r\n      const body = JSON.stringify({\r\n        week_start_day: payload.weekStartDay,\r\n        week_end_day: payload.weekEndDay,\r\n      });\r\n\r\n      fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body,\r\n      })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}`);\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((data) => {\r\n          const resolvedStart =\r\n            typeof data?.week_start_day !== 'undefined' ? data.week_start_day : payload.weekStartDay;\r\n          const resolvedEnd =\r\n            typeof data?.week_end_day !== 'undefined' ? data.week_end_day : payload.weekEndDay;\r\n          this.state.weekStartDay = resolvedStart;\r\n          this.state.weekEndDay = resolvedEnd;\r\n          this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: resolvedStart,\r\n            weekEndDay: resolvedEnd,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[JadwalKegiatanApp] Failed to persist week boundary setting', error);\r\n        });\r\n    }, 500);\r\n  }\r\n\r\n  async _regenerateTimeline(options = {}) {\r\n    const { mode = 'weekly', weekStartDay, weekEndDay } = options;\r\n    const endpoint = this.state.apiEndpoints?.regenerateTahapan;\r\n    if (!endpoint) {\r\n      return;\r\n    }\r\n\r\n    if (this._isRegeneratingTimeline) {\r\n      this._queuedRegeneratePayload = { mode, weekStartDay, weekEndDay };\r\n      return;\r\n    }\r\n\r\n    if (this.state.isDirty && this.state.modifiedCells instanceof Map && this.state.modifiedCells.size > 0) {\r\n      const confirmed = window.confirm(\r\n        'Mengubah batas minggu akan me-refresh data dan membatalkan perubahan yang belum disimpan. Lanjutkan?'\r\n      );\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n      this._resetEditedCellsState();\r\n      this.state.isDirty = false;\r\n    }\r\n\r\n    this._isRegeneratingTimeline = true;\r\n    this.state.isLoading = true;\r\n    const statusLabel = mode === 'monthly' ? 'Mengatur ulang struktur bulanan...' : 'Mengatur ulang struktur minggu...';\r\n    this._updateStatusBar(statusLabel);\r\n    const toastLabel =\r\n      mode === 'monthly'\r\n        ? 'Mengatur ulang kolom monthly...'\r\n        : 'Mengatur ulang kolom weekly sesuai preferensi Anda...';\r\n    this.showToast(toastLabel, 'info', 2400);\r\n\r\n    try {\r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-CSRFToken': this._getCsrfToken(),\r\n        },\r\n        body: JSON.stringify({\r\n          mode,\r\n          ...(mode === 'weekly'\r\n            ? {\r\n                week_start_day:\r\n                  typeof weekStartDay === 'number' ? weekStartDay : this._getWeekStartDay(),\r\n                week_end_day:\r\n                  typeof weekEndDay === 'number' ? weekEndDay : this._getWeekEndDay(),\r\n              }\r\n            : {}),\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`);\r\n      }\r\n\r\n      this._invalidateCachedDataset();\r\n      await this._loadInitialData({ forceReload: true });\r\n      const successMessage =\r\n        mode === 'monthly' ? 'Struktur monthly diperbarui (read-only)' : 'Periode minggu diperbarui';\r\n      this.showToast(successMessage, 'success', 2200);\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Failed to regenerate weekly structure', error);\r\n      this.showToast('Gagal memperbarui struktur waktu', 'danger', 3200);\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._updateStatusBar();\r\n      this._isRegeneratingTimeline = false;\r\n      if (this._queuedRegeneratePayload) {\r\n        const next = this._queuedRegeneratePayload;\r\n        this._queuedRegeneratePayload = null;\r\n        this._regenerateTimeline(next);\r\n      }\r\n    }\r\n  }\r\n\r\n  _formatWeekdayLabel(pyDay) {\r\n    const names = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];\r\n    const normalized = this._normalizePythonWeekday(pyDay, 0);\r\n    return names[normalized] || `Day ${normalized}`;\r\n  }\r\n\r\n  _syncToolbarRadios() {\r\n    const displayMode = this.state.inputMode || 'percentage';\r\n    document.querySelectorAll('input[name=\"displayMode\"]').forEach((radio) => {\r\n      radio.checked = radio.value === displayMode;\r\n    });\r\n\r\n    const timeScale = this.state.displayScale || this.state.timeScale || 'weekly';\r\n    document.querySelectorAll('input[name=\"timeScale\"]').forEach((radio) => {\r\n      radio.checked = radio.value === timeScale;\r\n    });\r\n\r\n    this._updateCostToggleAvailability();\r\n  }\r\n\r\n  _handleDisplayModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['percentage', 'volume', 'cost']);\r\n    if (!allowed.has(normalized) || this.state.inputMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    if (normalized === 'cost' && (this.state.progressMode || 'planned') !== 'actual') {\r\n      this.showToast('Mode biaya hanya tersedia saat melihat Realisasi', 'warning', 2600);\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.inputMode = normalized;\r\n    this.state.displayMode = normalized;  // Phase 2E.1: Keep displayMode in sync\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.setInputMode(normalized);\r\n    }\r\n\r\n    this._syncGridViews();\r\n\r\n    let label = 'Persentase';\r\n    if (normalized === 'volume') {\r\n      label = 'Volume';\r\n    } else if (normalized === 'cost') {\r\n      label = 'Biaya';\r\n    }\r\n    this.showToast(`Mode input diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  /**\r\n   * Handle progress mode change (Phase 2E.1: Planned vs Actual)\r\n   * Phase 0.3: Delegates to StateManager for mode switching\r\n   * @param {string} mode - 'planned' or 'actual'\r\n   */\r\n  _handleProgressModeChange(mode) {\r\n    const normalized = (mode || '').toLowerCase();\r\n    const allowed = new Set(['planned', 'actual']);\r\n\r\n    if (!allowed.has(normalized) || this.state.progressMode === normalized) {\r\n      return;\r\n    }\r\n\r\n    const oldMode = this.state.progressMode;\r\n    console.log(`[ModeChange] Switching progress mode from ${oldMode} to ${normalized}`);\r\n\r\n    // Phase 0.3: Get state sizes from StateManager\r\n    const oldStats = this.stateManager.states[oldMode].getStats();\r\n\r\n    // Phase 0.3: Switch mode in StateManager\r\n    this.stateManager.switchMode(normalized);\r\n\r\n    // Switch mode in local state (for other non-cell properties)\r\n    this.state.progressMode = normalized;\r\n    if (normalized !== 'actual' && this.state.inputMode === 'cost') {\r\n      this.state.inputMode = 'percentage';\r\n      this.state.displayMode = 'percentage';\r\n      this._syncToolbarRadios();\r\n    }\r\n\r\n    // Log new state after switch\r\n    const newStats = this.stateManager.states[normalized].getStats();\r\n    console.log(`[ModeChange] State switch complete:`);\r\n    console.log(`  - Old ${oldMode.toUpperCase()}: ${oldStats.modifiedCount} modified, ${oldStats.assignmentCount} assignments`);\r\n    console.log(`  - New ${normalized.toUpperCase()}: ${newStats.modifiedCount} modified, ${newStats.assignmentCount} assignments`);\r\n\r\n    // Update mode indicator badge\r\n    const indicator = document.getElementById('progress-mode-indicator');\r\n    if (indicator) {\r\n      const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n      const bgClass = normalized === 'planned' ? 'bg-info' : 'bg-warning';\r\n      indicator.textContent = `Mode: ${label}`;\r\n      indicator.className = `badge ${bgClass} ms-2`;\r\n      indicator.style.cssText = 'font-size: 0.75rem; vertical-align: middle;';\r\n    }\r\n\r\n    // Reload data with the new progress mode (will load from new mode's state)\r\n    this._syncGridViews();\r\n\r\n    const label = normalized === 'planned' ? 'Perencanaan' : 'Realisasi';\r\n    this.showToast(`Mode progress diubah ke ${label}`, 'info', 2200);\r\n  }\r\n\r\n  _updateCostToggleAvailability() {\r\n    const costRadio = document.getElementById('mode-cost');\r\n    if (!costRadio) {\r\n      return;\r\n    }\r\n    const isActual = (this.state.progressMode || 'planned') === 'actual';\r\n    costRadio.disabled = !isActual;\r\n    if (!isActual && costRadio.checked) {\r\n      const percentageRadio = document.getElementById('mode-percentage');\r\n      if (percentageRadio) {\r\n        percentageRadio.checked = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  _handleTimeScaleChange(nextScale) {\r\n    const normalized = (nextScale || '').toLowerCase();\r\n    const allowed = new Set(['weekly', 'monthly']);\r\n    if (!allowed.has(normalized)) {\r\n      this._syncToolbarRadios();\r\n      this.showToast('Mode waktu ini belum aktif pada fase saat ini', 'warning', 3200);\r\n      return;\r\n    }\r\n\r\n    if ((this.state.displayScale || this.state.timeScale || 'weekly') === normalized) {\r\n      this._syncToolbarRadios();\r\n      return;\r\n    }\r\n\r\n    this.state.displayScale = normalized;\r\n    this._syncToolbarRadios();\r\n    this._syncGridViews();\r\n    this._renderGrid();\r\n    this._updateCharts();\r\n\r\n    if (normalized === 'weekly') {\r\n      this.showToast('Time scale diatur ke Weekly', 'info', 2000);\r\n    } else {\r\n      this.showToast('Time scale diatur ke Monthly (akumulasi 4 minggu, read-only)', 'info', 2600);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize AG Grid when enabled\r\n   */\r\n  _initAgGridIfNeeded() {\r\n    if (!this.state.useAgGrid) {\r\n      return;\r\n    }\r\n\r\n    const container = this.state.domRefs.agGridContainer;\r\n    if (!container) {\r\n      console.warn('[JadwalKegiatanApp] AG Grid container not available');\r\n      return;\r\n    }\r\n\r\n    if (!this.agGridManager) {\r\n      this.agGridManager = new AGGridManager(this.state, {\r\n        showToast: this.showToast.bind(this),\r\n        onCellChange: (payload) => this._handleAgGridCellChange(payload),\r\n        getCellValidationState: (cellKey) => this._getCellValidationState(cellKey),\r\n      });\r\n      this.agGridManager.mount(container);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load initial data from server\r\n   */\r\n  async _loadInitialData(options = {}) {\r\n    const { forceReload = false } = options;\r\n    // Check if data is already loaded (from Django template)\r\n    if (!forceReload && this.state.pekerjaanTree?.length > 0) {\r\n      console.log('[JadwalKegiatanApp] Using template dataset');\r\n      console.log('Preloaded pekerjaanTree items:', this.state.pekerjaanTree.length);\r\n      console.log('Preloaded tahapanList items:', this.state.tahapanList?.length || 0);\r\n      console.log('Preloaded timeColumns items:', this.state.timeColumns?.length || 0);\r\n      this._recalculateAllProgressTotals();\r\n      this._syncGridViews();\r\n      return;\r\n    }\r\n\r\n    // Initialize modern modules\r\n    this.state.apiBase = this.state.apiEndpoints?.tahapan || `/detail_project/api/project/${this.state.projectId}/tahapan/`;\r\n    this.dataLoader = new DataLoader(this.state);\r\n    this.timeColumnGenerator = new TimeColumnGenerator(this.state);\r\n    this.gridRenderer = new GridRenderer(this.state);\r\n    this.saveHandler = new SaveHandler(this.state, {\r\n      apiUrl: this.state.apiEndpoints?.save || `/detail_project/api/project/${this.state.projectId}/pekerjaan/assign_weekly/`,\r\n      onSuccess: (result) => this._onSaveSuccess(result),\r\n      onError: (error) => this._onSaveError(error),\r\n      showToast: (msg, type) => this.showToast(msg, type)\r\n    });\r\n\r\n    this.state.isLoading = true;\r\n\r\n    try {\r\n      console.log('[JadwalKegiatanApp] Loading data using modern DataLoader...');\r\n\r\n      // Step 1: Load all base data (tahapan, pekerjaan, volumes)\r\n      await this.dataLoader.loadAllData({ skipIfLoaded: false });\r\n\r\n      // Step 2: Generate time columns from loaded tahapan\r\n      this.timeColumnGenerator.generate();\r\n      const normalizedDisplayScale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n      if (!this._isEnforcingWeekly && normalizedDisplayScale === 'weekly') {\r\n        const weeklyCount = this._countWeeklyColumns();\r\n        const expectedWeeks = this._estimateExpectedWeeklyColumns();\r\n        const firstColumnMode =\r\n          (this.state.timeColumns?.[0]?.generationMode || this.state.timeColumns?.[0]?.type || '').toLowerCase();\r\n\r\n        const shouldForceWeekly =\r\n          weeklyCount === 0 ||\r\n          firstColumnMode === 'monthly' ||\r\n          (expectedWeeks > 0 && weeklyCount > 0 && weeklyCount < expectedWeeks);\r\n\r\n        if (shouldForceWeekly) {\r\n          console.warn('[JadwalKegiatanApp] Weekly columns incomplete; regenerating weekly structure based on project timeline...');\r\n          this._isEnforcingWeekly = true;\r\n          await this._regenerateTimeline({\r\n            mode: 'weekly',\r\n            weekStartDay: this._getWeekStartDay(),\r\n            weekEndDay: this._getWeekEndDay(),\r\n          });\r\n          this._isEnforcingWeekly = false;\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Step 3: Load assignments (depends on time columns)\r\n      await this.dataLoader.loadAssignments();\r\n      this._recalculateAllProgressTotals();\r\n\r\n      // Step 3.5: Load Kurva S harga data (Phase 2F.0)\r\n      await this._loadKurvaSData();\r\n\r\n      // Build time column index for quick lookup\r\n      this.state.timeColumnIndex = this._createTimeColumnIndex(this.state.timeColumns);\r\n\r\n      console.log(\r\n        `[JadwalKegiatanApp]  Data loaded successfully:`,\r\n        `${this.state.flatPekerjaan?.length || 0} pekerjaan,`,\r\n        `${this.state.tahapanList?.length || 0} tahapan,`,\r\n        `${this.state.timeColumns?.length || 0} columns`\r\n      );\r\n\r\n      // Step 4: Render grid\r\n      this._renderGrid();\r\n\r\n      // Step 5: Initialize and update charts\r\n      this._initializeCharts();\r\n      this._updateCharts();\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load data:', error);\r\n      this.state.error = error;\r\n      this.showToast('Gagal memuat data: ' + error.message, 'danger');\r\n    } finally {\r\n      this.state.isLoading = false;\r\n      this._syncGridViews();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load Kurva S harga data from API (Phase 2F.0)\r\n   *\r\n   * Loads harga-based data for Kurva S chart instead of volume-based.\r\n   * This fixes the calculation to use cost (Rupiah) instead of physical volume.\r\n   *\r\n   * @private\r\n   */\r\n  async _loadKurvaSData() {\r\n    try {\r\n      const apiUrl = `/detail_project/api/v2/project/${this.state.projectId}/kurva-s-data/`;\r\n\r\n      console.log('[JadwalKegiatanApp] Loading Kurva S harga data from:', apiUrl);\r\n\r\n      const response = await fetch(apiUrl, {\r\n        credentials: 'same-origin',\r\n        headers: {\r\n          'X-Requested-With': 'XMLHttpRequest',\r\n        }\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      // Store harga data in state\r\n      this.state.hargaMap = new Map(\r\n        Object.entries(data.hargaMap || {}).map(([k, v]) => [k, parseFloat(v) || 0])\r\n      );\r\n      this.state.totalBiayaProject = parseFloat(data.totalBiayaProject || 0);\r\n      this.state.pekerjaanMeta = data.pekerjaanMeta || {};\r\n\r\n      // Update volumeMap if needed (backward compatibility)\r\n      if (data.volumeMap && Object.keys(data.volumeMap).length > 0) {\r\n        const existingSize = this.state.volumeMap?.size || 0;\r\n        if (existingSize === 0) {\r\n          this.state.volumeMap = new Map(\r\n            Object.entries(data.volumeMap).map(([k, v]) => [k, parseFloat(v) || 0])\r\n          );\r\n        }\r\n      }\r\n\r\n      console.log('[JadwalKegiatanApp]  Kurva S data loaded:', {\r\n        hargaCount: this.state.hargaMap.size,\r\n        totalBiaya: this.state.totalBiayaProject,\r\n        totalBiayaFormatted: `Rp ${this.state.totalBiayaProject.toLocaleString('id-ID')}`,\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to load Kurva S data:', error);\r\n      // Fallback: use empty maps (Kurva S will use fallback calculation)\r\n      this.state.hargaMap = this.state.hargaMap || new Map();\r\n      this.state.totalBiayaProject = this.state.totalBiayaProject || 0;\r\n      this.state.pekerjaanMeta = this.state.pekerjaanMeta || {};\r\n\r\n      // Don't show error toast - this is non-critical, Kurva S has fallback\r\n      console.warn('[JadwalKegiatanApp] Kurva S will use fallback calculation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Render grid using GridRenderer\r\n   * @private\r\n   */\r\n  _renderGrid() {\r\n    if (!this.gridRenderer) {\r\n      console.warn('[JadwalKegiatanApp] GridRenderer not initialized');\r\n      return;\r\n    }\r\n\r\n    this.state.activeTimeColumns = this._getDisplayTimeColumns();\r\n\r\n    console.log('[JadwalKegiatanApp] Rendering grid...');\r\n\r\n    // Render tables\r\n    const rendered = this.gridRenderer.renderTables();\r\n    if (!rendered) {\r\n      console.warn('[JadwalKegiatanApp] Grid rendering returned null');\r\n      return;\r\n    }\r\n\r\n    const { leftHTML, rightHTML } = rendered;\r\n\r\n    // Update DOM\r\n    const leftTbody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\r\n    const rightTbody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\r\n\r\n    if (leftTbody) {\r\n      leftTbody.innerHTML = leftHTML;\r\n    }\r\n\r\n    if (rightTbody) {\r\n      rightTbody.innerHTML = rightHTML;\r\n    }\r\n\r\n    // Render time headers\r\n    const timeHeaderRow = this.state.domRefs?.timeHeaderRow || document.getElementById('time-header-row');\r\n    if (timeHeaderRow) {\r\n      this.gridRenderer.renderTimeHeader(timeHeaderRow);\r\n    }\r\n\r\n    // Sync row heights\r\n    this.gridRenderer.syncRowHeights(this.state.domRefs || {});\r\n    this._updateLegacyHorizontalScroll();\r\n\r\n    console.log('[JadwalKegiatanApp]  Grid rendered');\r\n\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  /**\r\n   * Lazy load chart modules for better initial performance\r\n   * @private\r\n   */\r\n  async _loadChartModules() {\r\n    if (this._chartModulesLoaded || this._chartModulesLoading) {\r\n      return;\r\n    }\r\n\r\n    this._chartModulesLoading = true;\r\n    console.log(' Loading chart modules (lazy)...');\r\n\r\n    try {\r\n      const [kurvaSModule, ganttModule] = await Promise.all([\r\n        import('@modules/kurva-s/echarts-setup.js'),\r\n        import('@modules/gantt/frappe-gantt-setup.js')\r\n      ]);\r\n\r\n      // Store module classes\r\n      this.KurvaSChartClass = kurvaSModule.KurvaSChart;\r\n      this.GanttChartClass = ganttModule.GanttChart;\r\n\r\n      this._chartModulesLoaded = true;\r\n      this._chartModulesLoading = false;\r\n\r\n      console.log(' Chart modules loaded');\r\n\r\n      // Initialize charts after loading\r\n      this._initializeChartsAfterLoad();\r\n    } catch (error) {\r\n      console.error(' Failed to load chart modules:', error);\r\n      this._chartModulesLoading = false;\r\n      Toast.error('Failed to load chart modules');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules after lazy load\r\n   * @private\r\n   */\r\n  _initializeChartsAfterLoad() {\r\n    console.log('[JadwalKegiatanApp] Initializing charts after load...');\r\n\r\n    // Initialize Kurva-S Chart\r\n    if (this.state.domRefs?.scurveChart && this.KurvaSChartClass) {\r\n      try {\r\n        this.kurvaSChart = new this.KurvaSChartClass(this.state, {\r\n          useIdealCurve: true,\r\n          steepnessFactor: 0.8,\r\n          smoothCurves: true,\r\n          showArea: true,\r\n        });\r\n        const success = this.kurvaSChart.initialize(this.state.domRefs.scurveChart);\r\n        if (success) {\r\n          console.log('[JadwalKegiatanApp] Kurva-S chart initialized');\r\n          const activatePromise = this._activateDefaultCostView();\r\n          if (activatePromise && typeof activatePromise.catch === 'function') {\r\n            activatePromise.catch((error) => {\r\n              console.warn('[JadwalKegiatanApp] Failed to auto-enable cost view:', error);\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to initialize Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // ========================================\r\n    // OLD Gantt Chart (Frappe Gantt) - DISABLED\r\n    // ========================================\r\n    // The old Gantt Chart has been completely replaced with a new redesigned version.\r\n    // All initialization code for the old Gantt has been removed to prevent conflicts.\r\n    // See _initializeRedesignedGantt() method for the new implementation.\r\n\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart initialization SKIPPED (replaced by new design)');\r\n\r\n    // NOTE: NEW Redesigned Gantt Chart will be initialized lazily when tab is clicked\r\n    // See _setupLazyChartLoading() method\r\n  }\r\n\r\n  /**\r\n   * Initialize Redesigned Gantt Chart with retry logic\r\n   * Called ONLY when Gantt tab is clicked for the first time\r\n   * @private\r\n   */\r\n  async _initializeRedesignedGantt(retryCount = 0) {\r\n    const MAX_RETRIES = 3;\r\n    const RETRY_DELAY = 200; // ms\r\n\r\n    // Check if already initialized\r\n    if (this.ganttChartRedesign) {\r\n      console.log('[JadwalKegiatanApp] Redesigned Gantt already initialized, skipping');\r\n      return;\r\n    }\r\n\r\n    // Wait a bit for DOM to be ready (Bootstrap tab transition)\r\n    if (retryCount === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    const ganttContainer = document.getElementById('gantt-redesign-container');\r\n\r\n    if (!ganttContainer) {\r\n      console.warn(`[JadwalKegiatanApp]  Gantt container not found (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n      // Retry if not max retries\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`[JadwalKegiatanApp] Retrying in ${RETRY_DELAY}ms...`);\r\n        await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\r\n        return this._initializeRedesignedGantt(retryCount + 1);\r\n      }\r\n\r\n      console.error('[JadwalKegiatanApp]  Gantt redesign container not found after retries');\r\n      console.error('[JadwalKegiatanApp] DOM state:', {\r\n        ganttView: document.getElementById('gantt-view'),\r\n        ganttTab: document.getElementById('gantt-tab')\r\n      });\r\n      Toast.error('Failed to find Gantt container');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      console.log(' Initializing COMPLETELY NEW Redesigned Gantt Chart...');\r\n      console.log('[JadwalKegiatanApp]  Container found:', ganttContainer);\r\n\r\n      // Create Gantt instance\r\n      this.ganttChartRedesign = new GanttChartRedesign(ganttContainer, {\r\n        mode: this.state.currentMode || 'planned',\r\n        rowHeight: 40,\r\n        enableMilestones: true,\r\n        enableSync: true,\r\n        onNodeSelect: (node) => {\r\n          console.log(' Node selected in Gantt:', node);\r\n          // Future: Sync with grid selection\r\n        },\r\n        onDataChange: () => {\r\n          console.log(' Gantt data changed');\r\n          // Future: Sync back to grid\r\n        },\r\n        onMilestoneChange: (action, milestone) => {\r\n          console.log(` Milestone ${action}:`, milestone);\r\n          // Future: Save milestone changes to backend\r\n        }\r\n      });\r\n\r\n      // Prepare data for Gantt\r\n      const ganttData = this._prepareGanttData();\r\n      console.log('[JadwalKegiatanApp] Prepared Gantt data:', {\r\n        dataCount: ganttData.data.length,\r\n        project: ganttData.project,\r\n        milestonesCount: ganttData.milestones.length\r\n      });\r\n\r\n      // Initialize with data\r\n      await this.ganttChartRedesign.initialize(ganttData);\r\n\r\n      console.log('[JadwalKegiatanApp]  NEW Redesigned Gantt Chart initialized successfully!');\r\n      Toast.success(' New Gantt Chart loaded!', 2000);\r\n\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp]  Failed to initialize Redesigned Gantt:', error);\r\n      console.error('[JadwalKegiatanApp] Error stack:', error.stack);\r\n      Toast.error('Failed to load new Gantt Chart');\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare data for redesigned Gantt Chart\r\n   * @private\r\n   * @returns {Object} Gantt data structure\r\n   */\r\n  _prepareGanttData() {\r\n    const data = [];\r\n\r\n    // Transform hierarchical data from state (Phase 0.3: use flatPekerjaan from DataLoader)\r\n    if (this.state?.flatPekerjaan && Array.isArray(this.state.flatPekerjaan)) {\r\n      console.log(`[JadwalKegiatanApp] Transforming ${this.state.flatPekerjaan.length} nodes for Gantt`);\r\n\r\n      this.state.flatPekerjaan.forEach(node => {\r\n        // Extract parent hierarchy info\r\n        const klasifikasiId = node.type === 'klasifikasi' ? node.id :\r\n                             (node.type === 'subKlasifikasi' ? node.parent_id :\r\n                             (node.type === 'pekerjaan' ? node.klasifikasi_id : null));\r\n\r\n        const subKlasifikasiId = node.type === 'subKlasifikasi' ? node.id :\r\n                                (node.type === 'pekerjaan' ? node.sub_klasifikasi_id : null);\r\n\r\n        const pekerjaanId = node.type === 'pekerjaan' ? node.id : null;\r\n\r\n        // Get progress from StateManager for pekerjaan nodes\r\n        let progressRencana = 0;\r\n        let progressRealisasi = 0;\r\n\r\n        if (node.type === 'pekerjaan' && this.stateManager) {\r\n          // Calculate average progress across all tahapan for this pekerjaan\r\n          const tahapanList = this.state.tahapanList || [];\r\n          const tahapanCount = tahapanList.length;\r\n\r\n          if (tahapanCount > 0) {\r\n            let plannedSum = 0;\r\n            let actualSum = 0;\r\n\r\n            tahapanList.forEach(tahapan => {\r\n              const plannedVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'planned');\r\n              const actualVal = this.stateManager.getCellValue(node.id, tahapan.column_id, 'actual');\r\n              plannedSum += plannedVal || 0;\r\n              actualSum += actualVal || 0;\r\n            });\r\n\r\n            progressRencana = Math.round(plannedSum / tahapanCount);\r\n            progressRealisasi = Math.round(actualSum / tahapanCount);\r\n          }\r\n        }\r\n\r\n        data.push({\r\n          // Hierarchy IDs\r\n          klasifikasi_id: klasifikasiId,\r\n          klasifikasi_name: node.type === 'klasifikasi' ? node.name :\r\n                           (node.klasifikasi_name || ''),\r\n          klasifikasi_kode: node.type === 'klasifikasi' ? node.kode :\r\n                           (node.klasifikasi_kode || ''),\r\n\r\n          sub_klasifikasi_id: subKlasifikasiId,\r\n          sub_klasifikasi_name: node.type === 'subKlasifikasi' ? node.name :\r\n                               (node.sub_klasifikasi_name || ''),\r\n          sub_klasifikasi_kode: node.type === 'subKlasifikasi' ? node.kode :\r\n                               (node.sub_klasifikasi_kode || ''),\r\n\r\n          pekerjaan_id: pekerjaanId,\r\n          pekerjaan_name: node.type === 'pekerjaan' ? node.name : '',\r\n          pekerjaan_kode: node.type === 'pekerjaan' ? node.kode : '',\r\n\r\n          // Dates (use project dates as fallback)\r\n          tgl_mulai_rencana: node.tgl_mulai_rencana || this.state.projectStart,\r\n          tgl_selesai_rencana: node.tgl_selesai_rencana || this.state.projectEnd,\r\n          tgl_mulai_realisasi: node.tgl_mulai_realisasi || this.state.projectStart,\r\n          tgl_selesai_realisasi: node.tgl_selesai_realisasi || this.state.projectEnd,\r\n\r\n          // Progress\r\n          progress_rencana: progressRencana,\r\n          progress_realisasi: progressRealisasi,\r\n\r\n          // Volume info\r\n          volume: node.volume || 0,\r\n          satuan: node.satuan || '',\r\n\r\n          // Node type\r\n          node_type: node.type\r\n        });\r\n      });\r\n    } else {\r\n      console.warn('[JadwalKegiatanApp] No flatPekerjaan data available for Gantt');\r\n    }\r\n\r\n    // Project metadata\r\n    const projectMeta = {\r\n      project_id: this.state.projectId,\r\n      project_name: this.state.projectName || 'Project',\r\n      start_date: this.state.projectStart,\r\n      end_date: this.state.projectEnd\r\n    };\r\n\r\n    console.log(`[JadwalKegiatanApp] Prepared ${data.length} nodes for Gantt Chart`);\r\n\r\n    return {\r\n      data,\r\n      project: projectMeta,\r\n      milestones: [] // Future: Load from backend\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initialize chart modules (now lazy loaded on demand)\r\n   * @private\r\n   */\r\n  _initializeCharts() {\r\n    // Setup lazy loading for chart tabs\r\n    this._setupLazyChartLoading();\r\n  }\r\n\r\n  /**\r\n   * Setup lazy loading for chart tabs\r\n   * @private\r\n   */\r\n  _setupLazyChartLoading() {\r\n    // Find chart tab buttons - match actual IDs from template\r\n    const scurveTab = document.querySelector('#scurve-tab') ||\r\n                     document.querySelector('[data-bs-target=\"#scurve-view\"]');\r\n\r\n    const ganttTab = document.querySelector('#gantt-tab') ||\r\n                    document.querySelector('[data-bs-target=\"#gantt-view\"]');\r\n\r\n    console.log('[LazyLoad] Found tabs:', { scurveTab, ganttTab });\r\n\r\n    if (scurveTab) {\r\n      scurveTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad] Kurva S tab shown');\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n\r\n      scurveTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad] Kurva S tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    if (ganttTab) {\r\n      // When Gantt tab is shown, initialize NEW Gantt Chart\r\n      ganttTab.addEventListener('shown.bs.tab', async () => {\r\n        console.log('[LazyLoad]  Gantt tab shown - initializing NEW Gantt Chart!');\r\n\r\n        if (!this._chartModulesLoaded) {\r\n          await this._loadChartModules();\r\n        }\r\n\r\n        // Initialize NEW Redesigned Gantt Chart\r\n        await this._initializeRedesignedGantt();\r\n      }, { once: true });\r\n\r\n      ganttTab.addEventListener('click', async () => {\r\n        console.log('[LazyLoad]  Gantt tab clicked');\r\n        if (!this._chartModulesLoaded && !this._chartModulesLoading) {\r\n          await this._loadChartModules();\r\n        }\r\n      }, { once: true });\r\n    }\r\n\r\n    console.log(' Chart lazy loading configured (with NEW Gantt initialization)');\r\n  }\r\n\r\n  /**\r\n   * Update charts with current data\r\n   * @private\r\n   */\r\n  _updateCharts() {\r\n    console.log('[JadwalKegiatanApp] Updating charts...');\r\n\r\n    // Update Kurva-S Chart\r\n    if (this.kurvaSChart) {\r\n      try {\r\n        this.kurvaSChart.update();\r\n        console.log('[JadwalKegiatanApp]  Kurva-S chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update Kurva-S chart:', error);\r\n      }\r\n    }\r\n\r\n    // Update NEW Redesigned Gantt Chart\r\n    if (this.ganttChartRedesign) {\r\n      try {\r\n        const ganttData = this._prepareGanttData();\r\n        this.ganttChartRedesign.updateData(ganttData);\r\n        console.log('[JadwalKegiatanApp]  NEW Gantt chart updated');\r\n      } catch (error) {\r\n        console.warn('[JadwalKegiatanApp] Failed to update NEW Gantt chart:', error);\r\n      }\r\n    }\r\n\r\n    // OLD Gantt Chart - DISABLED\r\n    console.log('[JadwalKegiatanApp]  OLD Gantt Chart update SKIPPED (replaced by new design)');\r\n  }\r\n\r\n  /**\r\n   * Render Gantt summary table under the chart\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttSummary() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttSummary() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttSummaryBody;\r\n    const totalEl = this.state.domRefs?.ganttSummaryTotal;\r\n\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    const setEmptyState = (message) => {\r\n      bodyEl.innerHTML = `\r\n        <tr>\r\n          <td colspan=\"5\" class=\"text-muted text-center py-3\">${message}</td>\r\n        </tr>\r\n      `;\r\n      if (totalEl) {\r\n        totalEl.textContent = '';\r\n      }\r\n    };\r\n\r\n    if (!this.ganttChart) {\r\n      setEmptyState('Gantt chart belum siap ditampilkan.');\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getSummaryRows();\r\n    const stats = typeof this.ganttChart.getSummaryStats === 'function'\r\n      ? this.ganttChart.getSummaryStats()\r\n      : { total: rows.length, complete: 0, inProgress: 0, notStarted: 0 };\r\n\r\n    if (!rows.length) {\r\n      setEmptyState('Tidak ada pekerjaan yang memiliki jadwal.');\r\n      return;\r\n    }\r\n\r\n    const summaryHtml = rows.map((row) => {\r\n      const safeName = this._escapeHtml(row.shortLabel || row.label || '-');\r\n      const safePath = this._escapeHtml(row.pathLabel || '');\r\n      const plannedBlock = row.planned?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip planned\">\r\n            <span class=\"chip-label\">Rencana</span>\r\n            <span>${this._escapeHtml(row.planned.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.planned.startLabel || '-')} s/d ${this._escapeHtml(row.planned.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      const actualBlock = row.actual?.hasData\r\n        ? `\r\n          <div class=\"gantt-summary-chip actual\">\r\n            <span class=\"chip-label\">Realisasi</span>\r\n            <span>${this._escapeHtml(row.actual.progressLabel || '0%')}</span>\r\n          </div>\r\n          <div class=\"gantt-summary-range\">${this._escapeHtml(row.actual.startLabel || '-')} s/d ${this._escapeHtml(row.actual.endLabel || '-')}</div>\r\n        `\r\n        : '<span class=\"text-muted small\">Belum ada data</span>';\r\n\r\n      let deltaClass = 'text-muted';\r\n      if (row.delta > 0) {\r\n        deltaClass = 'text-danger';\r\n      } else if (row.delta < 0) {\r\n        deltaClass = 'text-success';\r\n      }\r\n\r\n      const deltaLabel = this._escapeHtml(row.deltaLabel || '0%');\r\n\r\n      return `\r\n        <tr>\r\n          <td class=\"text-muted\">${row.index}</td>\r\n          <td>\r\n            <div class=\"gantt-summary-name\">${safeName}</div>\r\n            <div class=\"gantt-summary-path\">${safePath}</div>\r\n          </td>\r\n          <td class=\"gantt-summary-dual\">${plannedBlock}</td>\r\n          <td class=\"gantt-summary-dual\">${actualBlock}</td>\r\n          <td>\r\n            <div class=\"${deltaClass} fw-semibold\">${deltaLabel}</div>\r\n          </td>\r\n        </tr>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = summaryHtml;\r\n\r\n    if (totalEl) {\r\n      totalEl.textContent = `${stats.total} pekerjaan  ${stats.complete} selesai  ${stats.inProgress} berjalan`;\r\n    }\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Render klasifikasi tree untuk Gantt\r\n   * OLD GANTT METHOD - DISABLED\r\n   * @private\r\n   * @deprecated Use new Gantt Chart instead\r\n   */\r\n  _renderGanttTree() {\r\n    console.log('[JadwalKegiatanApp]  _renderGanttTree() SKIPPED (old Gantt method)');\r\n    return; // Method disabled - old Gantt Chart no longer used\r\n\r\n    /* DISABLED CODE\r\n    const bodyEl = this.state.domRefs?.ganttTreeBody;\r\n    if (!bodyEl) {\r\n      return;\r\n    }\r\n\r\n    if (!this.ganttChart) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Gantt chart belum siap ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rows = this.ganttChart.getHierarchy();\r\n    if (!rows.length) {\r\n      bodyEl.innerHTML = '<div class=\"text-muted text-center py-3\">Tidak ada pekerjaan untuk ditampilkan.</div>';\r\n      return;\r\n    }\r\n\r\n    const rowHeight = Math.max(32, Math.round(this.ganttChart.getRowHeight()));\r\n    bodyEl.style.setProperty('--gantt-tree-row-height', `${rowHeight}px`);\r\n\r\n    const treeHtml = rows.map((row, index) => {\r\n      const indentLevel = Math.max(0, (row.level || 0) - 1);\r\n      const subtitleParts = Array.isArray(row.pathParts) ? row.pathParts.slice(0, -1) : [];\r\n      const subtitle = subtitleParts.length > 0 ? subtitleParts.join(' / ') : '';\r\n      const prefixDot = row.level > 0 ? ''.repeat(Math.min(row.level, 3)) : '';\r\n\r\n      return `\r\n        <div class=\"gantt-tree-row\" data-row-index=\"${index}\">\r\n          <span class=\"tree-prefix\">${prefixDot}</span>\r\n          <div class=\"tree-label\" data-level=\"${row.level || 0}\">\r\n            <span style=\"--tree-indent:${indentLevel}\">${this._escapeHtml(row.label || row.kode || 'Pekerjaan')}</span>\r\n            ${subtitle ? `<small class=\"d-block text-muted\">${this._escapeHtml(subtitle)}</small>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    bodyEl.innerHTML = treeHtml;\r\n    this._attachGanttScrollSync();\r\n    */ // END DISABLED CODE\r\n  }\r\n\r\n  /**\r\n   * Sinkronisasi scroll antara panel tree dan chart\r\n   * @private\r\n   */\r\n  _attachGanttScrollSync() {\r\n    const treeScroll = this.state.domRefs?.ganttTreeScroll;\r\n    const wrapper = this.state.domRefs?.ganttChartWrapper;\r\n    if (!treeScroll || !wrapper) {\r\n      return;\r\n    }\r\n\r\n    const chartScroll = wrapper.querySelector('.gantt-container');\r\n    if (!chartScroll) {\r\n      return;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers?.scrollEl && this._ganttScrollSyncHandlers.scrollEl !== chartScroll) {\r\n      this._ganttScrollSyncHandlers.scrollEl.removeEventListener('scroll', this._ganttScrollSyncHandlers.scrollHandler);\r\n      treeScroll.removeEventListener('wheel', this._ganttScrollSyncHandlers.wheelHandler);\r\n      this._ganttScrollSyncHandlers = null;\r\n    }\r\n\r\n    if (this._ganttScrollSyncHandlers) {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n      return;\r\n    }\r\n\r\n    const scrollHandler = () => {\r\n      treeScroll.scrollTop = chartScroll.scrollTop;\r\n    };\r\n    const wheelHandler = (event) => {\r\n      if (event.deltaY !== 0) {\r\n        chartScroll.scrollTop += event.deltaY;\r\n      }\r\n    };\r\n\r\n    chartScroll.addEventListener('scroll', scrollHandler);\r\n    treeScroll.addEventListener('wheel', wheelHandler, { passive: true });\r\n    this._ganttScrollSyncHandlers = {\r\n      scrollEl: chartScroll,\r\n      scrollHandler,\r\n      wheelHandler,\r\n    };\r\n  }\r\n\r\n  _escapeHtml(value) {\r\n    if (value === null || value === undefined) {\r\n      return '';\r\n    }\r\n    return String(value).replace(/[&<>\"']/g, (char) => {\r\n      const map = {\r\n        '&': '&amp;',\r\n        '<': '&lt;',\r\n        '>': '&gt;',\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n      };\r\n      return map[char] || char;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save changes to server (using modern SaveHandler)\r\n   */\r\n  async saveChanges() {\r\n    if (!this.saveHandler) {\r\n      console.error('[JadwalKegiatanApp] SaveHandler not initialized');\r\n      Toast.error('Save handler not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this._validateRowTotalsBeforeSave()) {\r\n      Toast.warning('Please fix validation errors before saving');\r\n      return;\r\n    }\r\n\r\n    const saveButton = this.state.domRefs.saveButton;\r\n\r\n    // Set button to loading state\r\n    if (saveButton) {\r\n      ButtonStateManager.setLoading(saveButton, 'Saving...');\r\n    }\r\n\r\n    try {\r\n      // Delegate to SaveHandler\r\n      const result = await this.saveHandler.save();\r\n\r\n      // Re-render grid after save\r\n      if (result.success) {\r\n        this._renderGrid();\r\n        this._recalculateAllProgressTotals();\r\n\r\n        // Set button to success state\r\n        if (saveButton) {\r\n          ButtonStateManager.setSuccess(saveButton, 2000);\r\n        }\r\n\r\n        Toast.success('Changes saved successfully!');\r\n      } else {\r\n        // Set button to error state\r\n        if (saveButton) {\r\n          ButtonStateManager.setError(saveButton, 2000);\r\n        }\r\n\r\n        Toast.error(result.message || 'Failed to save changes');\r\n      }\r\n    } catch (error) {\r\n      console.error('[JadwalKegiatanApp] Save error:', error);\r\n\r\n      // Set button to error state\r\n      if (saveButton) {\r\n        ButtonStateManager.setError(saveButton, 2000);\r\n      }\r\n\r\n      Toast.error('An error occurred while saving');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful save\r\n   * @param {Object} result - Save result\r\n   * @private\r\n   */\r\n  _onSaveSuccess(result) {\r\n    console.log('[JadwalKegiatanApp] Save completed successfully');\r\n    this.state.isDirty = false;\r\n    this._clearSaveErrorRows();\r\n\r\n    // Update status bar if exists\r\n    const progressMode = (this.state.progressMode || 'planned').toLowerCase();\r\n    const statusLabel = progressMode === 'actual'\r\n      ? 'Perubahan realisasi tersimpan'\r\n      : 'Perubahan perencanaan tersimpan';\r\n    this._updateStatusBar(statusLabel);\r\n    this._clearApiFailedRows();\r\n\r\n    // Re-render grid to update UI\r\n    this._renderGrid();\r\n    this._recalculateAllProgressTotals();\r\n\r\n    // Update charts with new data\r\n    this._updateCharts();\r\n  }\r\n\r\n  /**\r\n   * Handle save error\r\n   * @param {Error} error - Error object\r\n   * @private\r\n   */\r\n  _onSaveError(error) {\r\n    console.error('[JadwalKegiatanApp] Save failed:', error);\r\n    // Error toast already shown by SaveHandler\r\n    this._markFailedRowsFromError(error);\r\n  }\r\n\r\n  /**\r\n   * Refresh data from server\r\n   */\r\n  async refresh() {\r\n    if (this.state.isDirty) {\r\n      const confirmed = confirm(\r\n        'Ada perubahan yang belum disimpan. Yakin ingin refresh?'\r\n      );\r\n      if (!confirmed) return;\r\n    }\r\n\r\n    console.log('Refreshing data...');\r\n    this._resetEditedCellsState();\r\n    this.state.isDirty = false;\r\n\r\n    await this._loadInitialData({ forceReload: true });\r\n    this.showToast('Data berhasil di-refresh', 'success');\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message, type = 'info', duration = 3000) {\r\n    // Use existing toast system if available\r\n    if (typeof window.showToast === 'function') {\r\n      window.showToast(message, type, duration);\r\n      return;\r\n    }\r\n\r\n    // Fallback toast implementation\r\n    console.log(`[${type.toUpperCase()}] ${message}`);\r\n\r\n    const toast = document.createElement('div');\r\n    toast.className = `toast toast-${type}`;\r\n    toast.textContent = message;\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.add('show');\r\n    }, 10);\r\n\r\n    setTimeout(() => {\r\n      toast.classList.remove('show');\r\n      setTimeout(() => toast.remove(), 300);\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Build normalized time columns from tahapan list\r\n   */\r\n  _buildTimeColumns(tahapanList = []) {\r\n    if (!Array.isArray(tahapanList)) {\r\n      return [];\r\n    }\r\n\r\n    return tahapanList.map((tahap, index) => {\r\n      const rawId = tahap?.id ?? `tahapan-${index + 1}`;\r\n      const safeId = String(rawId).replace(/[^a-zA-Z0-9_-]/g, '_');\r\n      const fieldId = `col_${safeId}`;\r\n      const label = tahap?.nama || tahap?.name || `Tahapan ${index + 1}`;\r\n      const order =\r\n        typeof tahap?.urutan === 'number'\r\n          ? tahap.urutan\r\n          : Number.parseInt(tahap?.urutan, 10) || index;\r\n      const weekNumber = order + 1;\r\n      return {\r\n        id: rawId,\r\n        fieldId,\r\n        label,\r\n        order,\r\n        weekNumber,\r\n        startDate: tahap?.tanggal_mulai || tahap?.start_date || tahap?.startDate || null,\r\n        endDate: tahap?.tanggal_selesai || tahap?.end_date || tahap?.endDate || null,\r\n        isAutoGenerated: Boolean(tahap?.is_auto_generated),\r\n        generationMode: tahap?.generation_mode || null,\r\n      };\r\n    });\r\n  }\r\n\r\n  _createTimeColumnIndex(columns = []) {\r\n    const index = {};\r\n    (columns || []).forEach((col) => {\r\n      const key = col.fieldId || col.id;\r\n      if (key) {\r\n        index[key] = col;\r\n      }\r\n    });\r\n    return index;\r\n  }\r\n\r\n  _getDefaultSaveEndpoint() {\r\n    const projectId = this.state?.projectId;\r\n    if (!projectId) {\r\n      return '';\r\n    }\r\n    return `/detail_project/api/v2/project/${projectId}/assign-weekly/`;\r\n  }\r\n\r\n  /**\r\n   * Fetch JSON helper with sane defaults\r\n   */\r\n  async _fetchJson(url, options = {}) {\r\n    if (!url) {\r\n      throw new Error('URL tidak boleh kosong saat memanggil _fetchJson');\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      credentials: 'same-origin',\r\n      ...options,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text().catch(() => '');\r\n      throw new Error(errorText || `HTTP ${response.status}: ${response.statusText}`);\r\n    }\r\n\r\n    return response.json();\r\n  }\r\n\r\n  /**\r\n   * Sync rendered grids (AG Grid + future legacy bridging)\r\n   */\r\n  _syncGridViews() {\r\n    const displayColumns = this._getDisplayTimeColumns();\r\n    this.state.activeTimeColumns = displayColumns;\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.updateData({\r\n        tree: this.state.pekerjaanTree || [],\r\n        timeColumns: displayColumns,\r\n        inputMode: this.state.inputMode || 'percentage',\r\n        timeScale: this.state.displayScale || this.state.timeScale || 'weekly',\r\n      });\r\n      if (typeof this.agGridManager.updateTopScrollMetrics === 'function') {\r\n        this.agGridManager.updateTopScrollMetrics();\r\n      }\r\n    }\r\n    this._updateLegacyHorizontalScroll();\r\n  }\r\n\r\n  _updateLegacyHorizontalScroll() {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const scrollTop = domRefs.horizontalScrollTop;\r\n    const scrollInner = domRefs.horizontalScrollInner;\r\n    const rightTable = domRefs.rightTable;\r\n    if (!scrollTop || !scrollInner || !rightTable) {\r\n      return;\r\n    }\r\n    window.requestAnimationFrame(() => {\r\n      scrollInner.style.width = `${rightTable.scrollWidth}px`;\r\n    });\r\n  }\r\n\r\n  _clearApiFailedRows() {\r\n    if (this.state.apiFailedRows instanceof Set && this.state.apiFailedRows.size > 0) {\r\n      this.state.apiFailedRows.clear();\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromIds(idSet) {\r\n    if (!(idSet instanceof Set) || idSet.size === 0) {\r\n      this._clearApiFailedRows();\r\n      return;\r\n    }\r\n    this.state.apiFailedRows = new Set(Array.from(idSet));\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _setSaveErrorRows(idSet) {\r\n    if (!(this.state.saveErrorRows instanceof Set)) {\r\n      this.state.saveErrorRows = new Set();\r\n    }\r\n    const normalized = idSet instanceof Set ? Array.from(idSet) : [];\r\n    this.state.saveErrorRows = new Set(normalized.map((id) => Number(id)));\r\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorRows() {\r\n    if (this.state.saveErrorRows instanceof Set && this.state.saveErrorRows.size > 0) {\r\n      this.state.saveErrorRows.clear();\r\n      if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n        this.agGridManager.refreshRowStyles();\r\n      }\r\n    }\r\n  }\r\n\r\n  _clearSaveErrorForRow(pekerjaanId) {\r\n    if (\r\n      !pekerjaanId ||\r\n      !(this.state.saveErrorRows instanceof Set) ||\r\n      this.state.saveErrorRows.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    const removed = this.state.saveErrorRows.delete(Number(pekerjaanId));\r\n    if (removed && this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _markFailedRowsFromError(error) {\r\n    const ids = this._extractPekerjaanIdsFromError(error);\r\n    this._markFailedRowsFromIds(ids);\r\n  }\r\n\r\n  _extractPekerjaanIdsFromError(error) {\r\n    const idSet = new Set();\r\n    const collect = (items = []) => {\r\n      items.forEach((item) => {\r\n        const pekerjaanId =\r\n          item?.pekerjaan_id ||\r\n          item?.pekerjaanId ||\r\n          item?.item?.pekerjaan_id ||\r\n          item?.item?.pekerjaanId ||\r\n          null;\r\n        if (pekerjaanId) {\r\n          idSet.add(Number(pekerjaanId));\r\n        }\r\n      });\r\n    };\r\n\r\n    if (Array.isArray(error?.validationErrors)) {\r\n      collect(error.validationErrors);\r\n    }\r\n    if (Array.isArray(error?.details)) {\r\n      collect(error.details);\r\n    }\r\n\r\n    return idSet;\r\n  }\r\n\r\n  _getContainerValue(container, key) {\r\n    if (!container || !key) {\r\n      return null;\r\n    }\r\n    if (container instanceof Map) {\r\n      return container.has(key) ? container.get(key) : null;\r\n    }\r\n    if (typeof container === 'object') {\r\n      return Object.prototype.hasOwnProperty.call(container, key) ? container[key] : null;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _calculateRowTotalPercent(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const columns = this.state.timeColumns || [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    let total = 0;\r\n\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let value = null;\r\n      if (modifiedCells && modifiedCells.has(cellKey)) {\r\n        value = modifiedCells.get(cellKey);\r\n      } else {\r\n        value = this._getContainerValue(assignmentMap, cellKey);\r\n      }\r\n      const numeric = Number(value);\r\n      if (Number.isFinite(numeric)) {\r\n        total += numeric;\r\n      }\r\n    });\r\n\r\n    return Number(total.toFixed(2));\r\n  }\r\n\r\n  _calculateRowTotalVolume(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const columns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const modifiedCells = this.state.modifiedCells instanceof Map ? this.state.modifiedCells : null;\r\n    const assignmentMap = this.state.assignmentMap;\r\n    const overrides = this.state.cellVolumeOverrides instanceof Map ? this.state.cellVolumeOverrides : null;\r\n\r\n    let totalVolume = 0;\r\n    columns.forEach((col) => {\r\n      const fieldKey = col.fieldId || col.id;\r\n      if (!fieldKey) {\r\n        return;\r\n      }\r\n      const cellKey = `${pekerjaanId}-${fieldKey}`;\r\n      let volumeValue = null;\r\n\r\n      if (overrides && overrides.has(cellKey)) {\r\n        const overrideValue = Number(overrides.get(cellKey));\r\n        if (Number.isFinite(overrideValue)) {\r\n          volumeValue = overrideValue;\r\n        }\r\n      }\r\n\r\n      if (volumeValue === null) {\r\n        let percentValue = null;\r\n        if (modifiedCells && modifiedCells.has(cellKey)) {\r\n          percentValue = Number(modifiedCells.get(cellKey));\r\n        } else if (assignmentMap) {\r\n          percentValue = Number(this._getContainerValue(assignmentMap, cellKey));\r\n        }\r\n\r\n        if (Number.isFinite(percentValue) && Number.isFinite(kapasitas) && kapasitas > 0) {\r\n          volumeValue = (percentValue / 100) * kapasitas;\r\n        }\r\n      }\r\n\r\n      if (Number.isFinite(volumeValue)) {\r\n        totalVolume += volumeValue;\r\n      }\r\n    });\r\n\r\n    return Number(totalVolume.toFixed(3));\r\n  }\r\n\r\n  _setCellVolumeOverride(cellKey, volumeValue) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    }\r\n    const numeric = Number(volumeValue);\r\n    if (Number.isFinite(numeric)) {\r\n      this.state.cellVolumeOverrides.set(cellKey, Number(numeric.toFixed(3)));\r\n    } else if (this.state.cellVolumeOverrides.has(cellKey)) {\r\n      this.state.cellVolumeOverrides.delete(cellKey);\r\n    }\r\n  }\r\n\r\n  _clearCellVolumeOverride(cellKey) {\r\n    if (\r\n      !cellKey ||\r\n      !(this.state.cellVolumeOverrides instanceof Map) ||\r\n      this.state.cellVolumeOverrides.size === 0\r\n    ) {\r\n      return;\r\n    }\r\n    this.state.cellVolumeOverrides.delete(cellKey);\r\n  }\r\n\r\n  _updateCellValidationState(cellKey, validationResult) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n    if (!(this.state.cellValidationMap instanceof Map)) {\r\n      this.state.cellValidationMap = new Map();\r\n    }\r\n    const current = this.state.cellValidationMap.get(cellKey) || null;\r\n    const nextState =\r\n      validationResult && validationResult.isValid === false\r\n        ? validationResult.level === 'warning'\r\n          ? 'warning'\r\n          : 'error'\r\n        : null;\r\n    let changed = false;\r\n    if (nextState) {\r\n      if (current !== nextState) {\r\n        this.state.cellValidationMap.set(cellKey, nextState);\r\n        changed = true;\r\n      }\r\n    } else if (current) {\r\n      this.state.cellValidationMap.delete(cellKey);\r\n      changed = true;\r\n    }\r\n    if (changed && this.agGridManager && typeof this.agGridManager.refreshCells === 'function') {\r\n      this.agGridManager.refreshCells();\r\n    }\r\n  }\r\n\r\n  _getCellValidationState(cellKey) {\r\n    if (!cellKey || !(this.state.cellValidationMap instanceof Map)) {\r\n      return null;\r\n    }\r\n    return this.state.cellValidationMap.get(cellKey) || null;\r\n  }\r\n\r\n  _updateProgressTotals(pekerjaanId) {\r\n    if (!pekerjaanId) {\r\n      return 0;\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    }\r\n    const total = this._calculateRowTotalPercent(pekerjaanId);\r\n    this.state.progressTotals.set(Number(pekerjaanId), total);\r\n    this._updateAutoWarningRows(Number(pekerjaanId), total);\r\n    this._updateCompletionWarningRows(Number(pekerjaanId), total);\r\n    this._updateStatusBar();\r\n    return total;\r\n  }\r\n\r\n  _updateVolumeTotals(pekerjaanId, percentOverride = null, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    }\r\n    const totalVolume = this._calculateRowTotalVolume(pekerjaanId);\r\n    this.state.volumeTotals.set(Number(pekerjaanId), totalVolume);\r\n\r\n    const percentTotal =\r\n      Number.isFinite(percentOverride) && percentOverride !== null\r\n        ? Number(percentOverride)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const kapasitas = this._getRowVolume(pekerjaanId);\r\n    const derivedPercent =\r\n      !Number.isFinite(percentTotal) && Number.isFinite(totalVolume) && Number.isFinite(kapasitas) && kapasitas > 0\r\n        ? (totalVolume / kapasitas) * 100\r\n        : percentTotal;\r\n\r\n    this._updateVolumeWarningRows(Number(pekerjaanId), totalVolume, {\r\n      percentTotal: derivedPercent,\r\n      deferRefresh: options.deferRefresh,\r\n    });\r\n  }\r\n\r\n  _recalculateAllProgressTotals() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      this.state.progressTotals = new Map();\r\n    } else {\r\n      this.state.progressTotals.clear();\r\n    }\r\n    if (!(this.state.volumeTotals instanceof Map)) {\r\n      this.state.volumeTotals = new Map();\r\n    } else {\r\n      this.state.volumeTotals.clear();\r\n    }\r\n    if (!(this.state.cellVolumeOverrides instanceof Map)) {\r\n      this.state.cellVolumeOverrides = new Map();\r\n    } else {\r\n      this.state.cellVolumeOverrides.clear();\r\n    }\r\n    this.state.autoWarningRows = new Set();\r\n    this.state.volumeWarningRows = new Set();\r\n    this.state.validationWarningRows = new Set();\r\n    this.state.saveErrorRows = new Set();\r\n\r\n    const pekerjaanNodes = Array.isArray(this.state.flatPekerjaan)\r\n      ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan' && node.id)\r\n      : [];\r\n\r\n    pekerjaanNodes.forEach((node) => {\r\n      const total = this._calculateRowTotalPercent(node.id);\r\n      this.state.progressTotals.set(Number(node.id), total);\r\n      this._updateAutoWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateCompletionWarningRows(Number(node.id), total, { deferRefresh: true });\r\n      this._updateVolumeTotals(Number(node.id), total, { deferRefresh: true });\r\n    });\r\n\r\n    this._refreshFailedRowsUnion();\r\n    if (this.state.showCompletionWarnings && this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n    this._updateStatusBar();\r\n  }\r\n\r\n  _refreshFailedRowsUnion() {\r\n    const union = new Set();\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.apiFailedRows instanceof Set) {\r\n      this.state.apiFailedRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.forEach((id) => union.add(Number(id)));\r\n    }\r\n    this.state.failedRows = union;\r\n    this._updateSaveButtonState();\r\n    if (this.agGridManager && typeof this.agGridManager.refreshRowStyles === 'function') {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateAutoWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.autoWarningRows instanceof Set)) {\r\n      this.state.autoWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    let changed = false;\r\n    if (totalPercent > 100 + tolerance) {\r\n      if (!this.state.autoWarningRows.has(pekerjaanId)) {\r\n        this.state.autoWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.autoWarningRows.has(pekerjaanId)) {\r\n      this.state.autoWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _updateCompletionWarningRows(pekerjaanId, totalPercent, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    }\r\n    const tolerance = 0.01;\r\n    const upperBound = 100 - tolerance;\r\n    const shouldWarn =\r\n      this.state.showCompletionWarnings &&\r\n      Number.isFinite(totalPercent) &&\r\n      totalPercent > tolerance &&\r\n      totalPercent < upperBound;\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.validationWarningRows.has(pekerjaanId)) {\r\n        this.state.validationWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.validationWarningRows.has(pekerjaanId)) {\r\n      this.state.validationWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh && this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _recomputeCompletionWarnings() {\r\n    if (!(this.state.validationWarningRows instanceof Set)) {\r\n      this.state.validationWarningRows = new Set();\r\n    } else {\r\n      this.state.validationWarningRows.clear();\r\n    }\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      if (this.agGridManager) {\r\n        this.agGridManager.refreshRowStyles();\r\n      }\r\n      return;\r\n    }\r\n    this.state.progressTotals.forEach((total, pekerjaanId) => {\r\n      this._updateCompletionWarningRows(Number(pekerjaanId), total, { deferRefresh: true });\r\n    });\r\n    if (this.agGridManager) {\r\n      this.agGridManager.refreshRowStyles();\r\n    }\r\n  }\r\n\r\n  _updateVolumeWarningRows(pekerjaanId, totalVolume, options = {}) {\r\n    if (!pekerjaanId) {\r\n      return;\r\n    }\r\n    if (!(this.state.volumeWarningRows instanceof Set)) {\r\n      this.state.volumeWarningRows = new Set();\r\n    }\r\n\r\n    const capacity = this._getRowVolume(pekerjaanId);\r\n    const percentReference =\r\n      options && Number.isFinite(options.percentTotal)\r\n        ? Number(options.percentTotal)\r\n        : this.state.progressTotals instanceof Map\r\n          ? this.state.progressTotals.get(Number(pekerjaanId))\r\n          : null;\r\n\r\n    const tolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n    let shouldWarn = false;\r\n    if (Number.isFinite(capacity) && capacity > 0) {\r\n      shouldWarn = Number.isFinite(totalVolume) && totalVolume > capacity + tolerance;\r\n    } else if (Number.isFinite(percentReference)) {\r\n      shouldWarn = percentReference > tolerance;\r\n    }\r\n\r\n    let changed = false;\r\n    if (shouldWarn) {\r\n      if (!this.state.volumeWarningRows.has(pekerjaanId)) {\r\n        this.state.volumeWarningRows.add(pekerjaanId);\r\n        changed = true;\r\n      }\r\n    } else if (this.state.volumeWarningRows.has(pekerjaanId)) {\r\n      this.state.volumeWarningRows.delete(pekerjaanId);\r\n      changed = true;\r\n    }\r\n\r\n    if (changed && !options.deferRefresh) {\r\n      this._refreshFailedRowsUnion();\r\n    }\r\n  }\r\n\r\n  _clearFailedRows() {\r\n    if (this.state.autoWarningRows instanceof Set) {\r\n      this.state.autoWarningRows.clear();\r\n    }\r\n    if (this.state.volumeWarningRows instanceof Set) {\r\n      this.state.volumeWarningRows.clear();\r\n    }\r\n    if (this.state.failedRows instanceof Set) {\r\n      this.state.failedRows.clear();\r\n    }\r\n    if (this.state.saveErrorRows instanceof Set) {\r\n      this.state.saveErrorRows.clear();\r\n    }\r\n    this._refreshFailedRowsUnion();\r\n  }\r\n\r\n  _getRowVolume(pekerjaanId) {\r\n    const volumeMap = this.state?.volumeMap;\r\n    const numericId = Number(pekerjaanId);\r\n    if (volumeMap instanceof Map && volumeMap.has(numericId)) {\r\n      return Number(volumeMap.get(numericId)) || 0;\r\n    }\r\n    if (volumeMap && typeof volumeMap === 'object') {\r\n      const key = String(numericId);\r\n      if (Object.prototype.hasOwnProperty.call(volumeMap, key)) {\r\n        return Number(volumeMap[key]) || 0;\r\n      }\r\n    }\r\n    const fallbackNode =\r\n      Array.isArray(this.state.flatPekerjaan) &&\r\n      this.state.flatPekerjaan.find((node) => Number(node.id) === numericId);\r\n    if (fallbackNode && typeof fallbackNode.volume !== 'undefined') {\r\n      return Number(fallbackNode.volume) || 0;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  _validateRowTotalsBeforeSave() {\r\n    if (!(this.state.progressTotals instanceof Map)) {\r\n      return true;\r\n    }\r\n    if (!this.state.showCompletionWarnings) {\r\n      this.state.showCompletionWarnings = true;\r\n    }\r\n    this._recomputeCompletionWarnings();\r\n    const percentTolerance = 0.01;\r\n    const percentViolations = [];\r\n\r\n    this.state.progressTotals.forEach((totalPercent, pekerjaanId) => {\r\n      if (!Number.isFinite(totalPercent)) {\r\n        return;\r\n      }\r\n      if (totalPercent > 100 + percentTolerance) {\r\n        percentViolations.push({\r\n          type: 'percent',\r\n          pekerjaan_id: pekerjaanId,\r\n          total: totalPercent,\r\n        });\r\n      }\r\n    });\r\n\r\n    const volumeViolations = [];\r\n    if (this.state.volumeTotals instanceof Map) {\r\n      this.state.volumeTotals.forEach((totalVolume, pekerjaanId) => {\r\n        const capacity = this._getRowVolume(pekerjaanId);\r\n        const volumeTolerance = Number.isFinite(capacity) && capacity > 0 ? Math.max(capacity * 0.001, 0.01) : 0.01;\r\n        const percentTotal =\r\n          this.state.progressTotals instanceof Map && this.state.progressTotals.has(pekerjaanId)\r\n            ? this.state.progressTotals.get(pekerjaanId)\r\n            : null;\r\n        const effectivePercent =\r\n          Number.isFinite(percentTotal) && percentTotal !== null\r\n            ? Number(percentTotal)\r\n            : Number.isFinite(totalVolume) && Number.isFinite(capacity) && capacity > 0\r\n              ? (Number(totalVolume) / Number(capacity)) * 100\r\n              : null;\r\n        if (Number.isFinite(capacity) && capacity > 0) {\r\n          if (Number.isFinite(totalVolume) && totalVolume > capacity + volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity,\r\n            });\r\n          }\r\n        } else {\r\n          if (Number.isFinite(effectivePercent) && effectivePercent > volumeTolerance) {\r\n            volumeViolations.push({\r\n              type: 'volume',\r\n              pekerjaan_id: pekerjaanId,\r\n              total: totalVolume,\r\n              capacity: capacity || 0,\r\n              missingCapacity: true,\r\n            });\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (percentViolations.length === 0 && volumeViolations.length === 0) {\r\n      this._clearFailedRows();\r\n      this._clearSaveErrorRows();\r\n      return true;\r\n    }\r\n\r\n    const ids = new Set();\r\n    const combined = percentViolations.concat(volumeViolations);\r\n    const messages = combined.slice(0, 3).map((item) => {\r\n      ids.add(Number(item.pekerjaan_id));\r\n      if (item.type === 'volume') {\r\n        if (item.missingCapacity) {\r\n          return `- Pekerjaan ${item.pekerjaan_id}: volume tidak dapat disimpan karena master volume 0`;\r\n        }\r\n        return `- Pekerjaan ${item.pekerjaan_id}: total volume ${item.total.toFixed(3)} > kapasitas ${item.capacity.toFixed(3)}`;\r\n      }\r\n      return `- Pekerjaan ${item.pekerjaan_id}: total ${item.total.toFixed(2)}% > 100%`;\r\n    });\r\n\r\n    if (combined.length > 3) {\r\n      messages.push(`(+${combined.length - 3} lagi)`);\r\n    }\r\n\r\n    this._markFailedRowsFromIds(ids);\r\n    this._setSaveErrorRows(ids);\r\n    this.showToast(`Tidak dapat menyimpan:\\n${messages.join('\\n')}`, 'danger', 5000);\r\n    return false;\r\n  }\r\n\r\n  _updateStatusBar(message = 'Ready') {\r\n    const domRefs = this.state?.domRefs || {};\r\n    const hasElements =\r\n      domRefs.statusMessageEl || domRefs.itemCountEl || domRefs.modifiedCountEl || domRefs.totalProgressEl;\r\n    if (!hasElements) {\r\n      return;\r\n    }\r\n\r\n    if (domRefs.statusMessageEl && typeof message === 'string') {\r\n      domRefs.statusMessageEl.textContent = message;\r\n    }\r\n\r\n    if (domRefs.itemCountEl) {\r\n      const pekerjaanCount = Array.isArray(this.state?.flatPekerjaan)\r\n        ? this.state.flatPekerjaan.filter((node) => node?.type === 'pekerjaan').length\r\n        : 0;\r\n      domRefs.itemCountEl.textContent = pekerjaanCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.modifiedCountEl) {\r\n      const modifiedCount = this.state?.modifiedCells instanceof Map ? this.state.modifiedCells.size : 0;\r\n      domRefs.modifiedCountEl.textContent = modifiedCount.toLocaleString('id-ID');\r\n    }\r\n\r\n    if (domRefs.totalProgressEl) {\r\n      const totalProgress = this._calculateProjectProgress();\r\n      domRefs.totalProgressEl.textContent =\r\n        totalProgress === null\r\n          ? '-'\r\n          : `${totalProgress.toLocaleString('id-ID', { maximumFractionDigits: 1 })}%`;\r\n    }\r\n  }\r\n\r\n  _calculateProjectProgress() {\r\n    if (this.state?.progressTotals instanceof Map && this.state.progressTotals.size > 0) {\r\n      let aggregate = 0;\r\n      this.state.progressTotals.forEach((value) => {\r\n        aggregate += Number(value) || 0;\r\n      });\r\n      const avg = aggregate / this.state.progressTotals.size;\r\n      return Math.round(avg * 10) / 10;\r\n    }\r\n\r\n    if (this.state?.assignmentMap instanceof Map && this.state.assignmentMap.size > 0) {\r\n      const pekerjaanTotals = new Map();\r\n      this.state.assignmentMap.forEach((value, cellKey) => {\r\n        const [pekerjaanId] = `${cellKey}`.split('-');\r\n        const numericValue = Number(value) || 0;\r\n        const current = pekerjaanTotals.get(pekerjaanId) || 0;\r\n        pekerjaanTotals.set(pekerjaanId, current + numericValue);\r\n      });\r\n\r\n      if (pekerjaanTotals.size > 0) {\r\n        let sum = 0;\r\n        pekerjaanTotals.forEach((value) => {\r\n          sum += value;\r\n        });\r\n        const avg = sum / pekerjaanTotals.size;\r\n        return Math.round(avg * 10) / 10;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  _buildAssignmentsPayload() {\r\n    if (!this.state.modifiedCells || this.state.modifiedCells.size === 0) {\r\n      return [];\r\n    }\r\n\r\n    const assignments = [];\r\n    const columnIndex = this.state.timeColumnIndex || {};\r\n\r\n    this.state.modifiedCells.forEach((value, cellKey) => {\r\n      const parsed = this._parseCellKey(cellKey);\r\n      if (!parsed?.pekerjaanId || !parsed.fieldId) {\r\n        return;\r\n      }\r\n\r\n      const columnMeta = columnIndex[parsed.fieldId];\r\n      if (!columnMeta) {\r\n        console.warn('[JadwalKegiatanApp] Column metadata not found for', parsed.fieldId);\r\n        return;\r\n      }\r\n\r\n      const proportion = parseFloat(value);\r\n      if (Number.isNaN(proportion)) {\r\n        return;\r\n      }\r\n\r\n      const weekNumber = columnMeta.weekNumber || columnMeta.order + 1 || 1;\r\n\r\n      assignments.push({\r\n        pekerjaan_id: Number(parsed.pekerjaanId),\r\n        week_number: weekNumber,\r\n        proportion: Number(proportion.toFixed(2)),\r\n        tahapan_id: columnMeta.id || null,\r\n      });\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  _getSaveMode() {\r\n    const normalized = (this.state?.saveMode || 'weekly').toLowerCase();\r\n    const allowed = new Set(['daily', 'weekly', 'monthly', 'custom']);\r\n    return allowed.has(normalized) ? normalized : 'weekly';\r\n  }\r\n\r\n  _normalizePythonWeekday(value, fallback = 0) {\r\n    const fallbackSafe = Number.isFinite(fallback) ? ((fallback % 7) + 7) % 7 : 0;\r\n    const parsed = Number(value);\r\n    if (!Number.isFinite(parsed)) {\r\n      return fallbackSafe;\r\n    }\r\n    const normalized = parsed % 7;\r\n    return normalized < 0 ? normalized + 7 : normalized;\r\n  }\r\n\r\n  _getWeekStartDay() {\r\n    if (Number.isFinite(Number(this.state?.weekStartDay))) {\r\n      return this._normalizePythonWeekday(this.state.weekStartDay, (this._getWeekEndDay() + 1) % 7);\r\n    }\r\n    return (this._getWeekEndDay() + 1) % 7;\r\n  }\r\n\r\n  _getWeekEndDay() {\r\n    return this._normalizePythonWeekday(this.state?.weekEndDay, 6);\r\n  }\r\n\r\n  _getDisplayTimeColumns() {\r\n    const baseColumns = Array.isArray(this.state.timeColumns) ? this.state.timeColumns : [];\r\n    const scale = (this.state.displayScale || this.state.timeScale || 'weekly').toLowerCase();\r\n    if (scale !== 'monthly') {\r\n      return baseColumns;\r\n    }\r\n\r\n    const isWeeklyColumn = (col) => {\r\n      const mode = (col.generationMode || col.type || '').toLowerCase();\r\n      if (mode === 'monthly') {\r\n        return false;\r\n      }\r\n      if (mode === 'weekly' || mode === 'week' || mode === 'wk') {\r\n        return true;\r\n      }\r\n      if (Number.isFinite(Number(col.weekNumber ?? col.week_number))) {\r\n        return true;\r\n      }\r\n      const label = (col.label || '').toLowerCase();\r\n      return label.includes('week') || label.includes('minggu');\r\n    };\r\n\r\n    const weeklyColumns = baseColumns.filter((col) => isWeeklyColumn(col));\r\n    const sourceColumns = weeklyColumns.length > 0 ? weeklyColumns : baseColumns;\r\n\r\n    const blockSize = 4;\r\n    const aggregated = [];\r\n    for (let i = 0; i < sourceColumns.length; i += blockSize) {\r\n      const blockColumns = sourceColumns.slice(i, i + blockSize);\r\n      if (!blockColumns.length) {\r\n        continue;\r\n      }\r\n      const blockIndex = aggregated.length;\r\n      const startWeek = blockColumns[0]?.weekNumber ?? blockColumns[0]?.order ?? i + 1;\r\n      const endWeek = blockColumns[blockColumns.length - 1]?.weekNumber ?? startWeek + blockColumns.length - 1;\r\n      const startLabel = blockColumns[0]?.rangeLabel || blockColumns[0]?.label || '';\r\n      const endLabel = blockColumns[blockColumns.length - 1]?.rangeLabel || blockColumns[blockColumns.length - 1]?.label || '';\r\n      const label = `Month ${blockIndex + 1}`;\r\n      const rangeLabel = `Week ${startWeek}-${endWeek}`;\r\n\r\n      aggregated.push({\r\n        id: `month-${blockIndex + 1}`,\r\n        fieldId: `month_${blockIndex + 1}`,\r\n        label,\r\n        rangeLabel,\r\n        tooltip: startLabel && endLabel ? `${startLabel}  ${endLabel}` : `${label}: Week ${startWeek}-${endWeek}`,\r\n        generationMode: 'monthly',\r\n        type: 'monthly',\r\n        index: blockIndex,\r\n        childColumns: blockColumns,\r\n      });\r\n    }\r\n\r\n    return aggregated;\r\n  }\r\n\r\n  _parseCellKey(cellKey) {\r\n    if (!cellKey || typeof cellKey !== 'string') {\r\n      return null;\r\n    }\r\n    const separatorIndex = cellKey.indexOf('-');\r\n    if (separatorIndex === -1) {\r\n      return { pekerjaanId: cellKey, fieldId: null };\r\n    }\r\n\r\n    return {\r\n      pekerjaanId: cellKey.slice(0, separatorIndex),\r\n      fieldId: cellKey.slice(separatorIndex + 1),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get CSRF token from cookie\r\n   */\r\n  _getCsrfToken() {\r\n    const name = 'csrftoken';\r\n    let cookieValue = null;\r\n\r\n    if (document.cookie && document.cookie !== '') {\r\n      const cookies = document.cookie.split(';');\r\n      for (let i = 0; i < cookies.length; i++) {\r\n        const cookie = cookies[i].trim();\r\n        if (cookie.substring(0, name.length + 1) === name + '=') {\r\n          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return cookieValue;\r\n  }\r\n\r\n  /**\r\n   * Handle AG Grid cell change\r\n   */\r\n  _handleAgGridCellChange({\r\n    cellKey,\r\n    value,\r\n    columnMeta,\r\n    displayValue,\r\n    isVolumeMode,\r\n    validation,\r\n    pekerjaanId,\r\n    columnId,\r\n    valueType = 'percentage',\r\n  }) {\r\n    if (!cellKey) {\r\n      return;\r\n    }\r\n\r\n    if (validation) {\r\n      this._updateCellValidationState(cellKey, validation);\r\n    }\r\n\r\n    let normalizedValue = value;\r\n    if (typeof normalizedValue === 'string') {\r\n      normalizedValue = parseFloat(normalizedValue);\r\n    }\r\n    if (Number.isNaN(normalizedValue)) {\r\n      normalizedValue = 0;\r\n    }\r\n\r\n    // Phase 2E.1: Get current mode's state for isolated data tracking\r\n    const modeState = this._getCurrentModeState();\r\n    const progressMode = this.state.progressMode || 'planned';\r\n    const normalizedValueType = (valueType || (isVolumeMode ? 'volume' : 'percentage')).toLowerCase();\r\n    const isCostMode = normalizedValueType === 'cost';\r\n\r\n    console.log(`[CellChange] Mode: ${progressMode.toUpperCase()}, Cell: ${cellKey}, Value: ${normalizedValue}`);\r\n\r\n    if (isCostMode) {\r\n      if (progressMode !== 'actual') {\r\n        this.showToast('Biaya aktual hanya bisa diedit pada mode Realisasi', 'warning', 2600);\r\n        return;\r\n      }\r\n      modeState.costModifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    } else {\r\n      // Write to mode-specific state (isolated from other mode)\r\n      modeState.modifiedCells.set(cellKey, normalizedValue);\r\n      modeState.isDirty = true;\r\n    }\r\n\r\n    if (columnMeta?.fieldId && this.state.timeColumnIndex) {\r\n      this.state.timeColumnIndex[columnMeta.fieldId] =\r\n        columnMeta || this.state.timeColumnIndex[columnMeta.fieldId];\r\n    }\r\n\r\n    if (isVolumeMode) {\r\n      this._setCellVolumeOverride(cellKey, displayValue);\r\n    } else {\r\n      this._clearCellVolumeOverride(cellKey);\r\n    }\r\n\r\n    const parsed = this._parseCellKey(cellKey);\r\n    const resolvedPekerjaanId = pekerjaanId || parsed?.pekerjaanId;\r\n    if (resolvedPekerjaanId) {\r\n      this._clearSaveErrorForRow(Number(resolvedPekerjaanId));\r\n      const percentTotal = this._updateProgressTotals(Number(resolvedPekerjaanId));\r\n      this._updateVolumeTotals(Number(resolvedPekerjaanId), percentTotal);\r\n    }\r\n\r\n    if (!isCostMode) {\r\n      console.log(`[CellChange] ${progressMode.toUpperCase()} modifiedCells size: ${modeState.modifiedCells.size}`);\r\n      // Phase 2F.0: Real-time Kurva S update on cell change (before save)\r\n      // This allows users to see chart changes immediately as they type\r\n      this._updateCharts();\r\n      console.log(`[CellChange] Real-time Kurva-S chart updated`);\r\n    } else {\r\n      console.log(`[CellChange] Cost map size: ${modeState.costModifiedCells.size}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup and destroy the application\r\n   */\r\n  destroy() {\r\n    if (this.eventManager) {\r\n      this.eventManager.cleanup();\r\n      this.eventManager = null;\r\n    }\r\n\r\n    if (this.agGridManager) {\r\n      this.agGridManager.destroy();\r\n      this.agGridManager = null;\r\n    }\r\n\r\n    this.state = null;\r\n    this.initialized = false;\r\n\r\n    console.log('JadwalKegiatanApp destroyed');\r\n  }\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', () => {\r\n    const app = new JadwalKegiatanApp();\r\n    app.initialize();\r\n  });\r\n} else {\r\n  // DOM already loaded\r\n  const app = new JadwalKegiatanApp();\r\n  app.initialize();\r\n}\r\n\r\n// Export for manual initialization\r\nexport default JadwalKegiatanApp;\r\n"],"file":"assets/js/jadwal-kegiatan-DxubOeCB.js"}