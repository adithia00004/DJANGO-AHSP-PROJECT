{"version":3,"file":"gantt-frozen-grid-QMnIxjuC.js","sources":["../../../../../../js/src/modules/gantt-v2/gantt-frozen-grid.js"],"sourcesContent":["/**\r\n * Gantt Frozen Grid - V2 Architecture\r\n * Proof of Concept: Single grid with frozen columns (CSS sticky)\r\n * @module gantt-frozen-grid\r\n */\r\n\r\nimport { Toast } from '@modules/shared/ux-enhancements.js';\r\n\r\n/**\r\n * GanttFrozenGrid - Main component for frozen column Gantt\r\n */\r\nexport class GanttFrozenGrid {\r\n  constructor(container, options = {}) {\r\n    this.container = typeof container === 'string'\r\n      ? document.querySelector(container)\r\n      : container;\r\n\r\n    if (!this.container) {\r\n      throw new Error('Gantt container not found');\r\n    }\r\n\r\n    // Options\r\n    this.options = {\r\n      rowHeight: options.rowHeight || 40,\r\n      frozenColumnWidth: 280,\r\n      volumeColumnWidth: 70,\r\n      satuanColumnWidth: 70,\r\n      timelineColumnWidth: 100,\r\n      timeScale: options.timeScale || 'week',\r\n      ...options\r\n    };\r\n\r\n    // State\r\n    this.state = {\r\n      rows: [],\r\n      timelineColumns: [],\r\n      scrollTop: 0,\r\n      scrollLeft: 0,\r\n      initialized: false,\r\n      expandedNodes: new Map() // Track expand/collapse state by node ID\r\n    };\r\n\r\n    // Elements\r\n    this.elements = {\r\n      gridContainer: null\r\n    };\r\n\r\n    // Theme observer\r\n    this.themeObserver = null;\r\n\r\n    // Store pekerjaan and timeColumns for re-render after expand/collapse\r\n    this.pekerjaan = [];\r\n    this.timeColumns = [];\r\n  }\r\n\r\n  /**\r\n   * Initialize Gantt with app context\r\n   * @param {JadwalKegiatanApp} app - App instance with StateManager, tahapan, etc.\r\n   */\r\n  async initialize(app) {\r\n    console.log('ðŸš€ Initializing Gantt Frozen Grid V2 (Phase 2: Real Data)...');\r\n\r\n    try {\r\n      // Store app reference for data access\r\n      this.app = app;\r\n      this.stateManager = app.stateManager;\r\n      this.timeColumnGenerator = app.timeColumnGenerator;\r\n\r\n      // Debug: Check what we have\r\n      console.log('[GanttV2] App references:', {\r\n        hasStateManager: !!this.stateManager,\r\n        hasTimeColumnGenerator: !!this.timeColumnGenerator,\r\n        hasFlatPekerjaan: !!app.state?.flatPekerjaan\r\n      });\r\n\r\n      // Get real data\r\n      const pekerjaan = app.state.flatPekerjaan || [];\r\n\r\n      // IMPORTANT: TimeColumnGenerator stores columns in state.timeColumns, not this.columns!\r\n      const timeColumns = this.timeColumnGenerator?.state?.timeColumns || app.state?.timeColumns || [];\r\n\r\n      console.log('[GanttV2] Data loaded:', {\r\n        pekerjaanCount: pekerjaan.length,\r\n        timeColumnsCount: timeColumns.length,\r\n        timeScale: app.state?.timeScale || 'unknown'\r\n      });\r\n\r\n      // Debug: Show first few columns and pekerjaan\r\n      if (timeColumns.length > 0) {\r\n        console.log('[GanttV2] First 3 columns:', timeColumns.slice(0, 3));\r\n        console.log('[GanttV2] First 3 column IDs:', timeColumns.slice(0, 3).map(c => c.id));\r\n        console.log('[GanttV2] Last 3 columns:', timeColumns.slice(-3));\r\n        console.log('[GanttV2] Last 3 column IDs:', timeColumns.slice(-3).map(c => c.id));\r\n\r\n        // CRITICAL: Check if column ID is tahapanId\r\n        const firstCol = timeColumns[0];\r\n        console.log('[GanttV2] First column structure:', {\r\n          id: firstCol.id,\r\n          tahapanId: firstCol.tahapanId,\r\n          label: firstCol.label\r\n        });\r\n      } else {\r\n        console.warn('[GanttV2] âš ï¸ NO TIME COLUMNS! TimeColumnGenerator might not be initialized.');\r\n        console.log('[GanttV2] TimeColumnGenerator object:', this.timeColumnGenerator);\r\n\r\n        // Fallback to demo mode\r\n        console.warn('[GanttV2] Falling back to DEMO mode with hardcoded 20 weeks...');\r\n        const demoColumns = this._generateDemoTimeColumns(20);\r\n\r\n        this._buildDOM(demoColumns.length);\r\n        this._renderRealData(pekerjaan, demoColumns);\r\n\r\n        this.state.initialized = true;\r\n        console.log('âœ… Gantt Frozen Grid V2 initialized (DEMO MODE - no TimeColumnGenerator)');\r\n        Toast.success('ðŸ“Š Gantt Chart loaded (Demo Mode)', 2000);\r\n        return;\r\n      }\r\n\r\n      // Debug: Show first few pekerjaan\r\n      if (pekerjaan.length > 0) {\r\n        console.log('[GanttV2] First pekerjaan:', pekerjaan[0]);\r\n        console.log('[GanttV2] Pekerjaan types:', pekerjaan.slice(0, 5).map(p => ({\r\n          id: p.id,\r\n          type: p.type,\r\n          level: p.level,\r\n          nama: p.nama?.substring(0, 30)\r\n        })));\r\n      }\r\n\r\n      // Store data for re-render (expand/collapse)\r\n      this.pekerjaan = pekerjaan;\r\n      this.timeColumns = timeColumns;\r\n\r\n      // Initialize all non-leaf nodes as expanded by default\r\n      this._initializeExpandState(pekerjaan);\r\n\r\n      // Build DOM structure with dynamic columns\r\n      this._buildDOM(timeColumns.length);\r\n\r\n      // Render real data\r\n      this._renderRealData(pekerjaan, timeColumns);\r\n\r\n      // Setup theme observer to re-render on theme change\r\n      this._setupThemeObserver(pekerjaan, timeColumns);\r\n\r\n      this.state.initialized = true;\r\n\r\n      console.log('âœ… Gantt Frozen Grid V2 initialized successfully');\r\n      Toast.success('ðŸ“Š Gantt Chart loaded', 2000);\r\n\r\n    } catch (error) {\r\n      console.error('âŒ Failed to initialize Gantt Frozen Grid:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build DOM structure with CSS Grid\r\n   * @private\r\n   */\r\n  _buildDOM(timeColumnCount) {\r\n    this.container.innerHTML = '';\r\n    this.container.className = 'gantt-frozen-container';\r\n\r\n    // Detect dark mode - ONLY check data-bs-theme attribute (Bootstrap 5.3+)\r\n    // Don't use prefers-color-scheme as fallback to avoid conflicts\r\n    const theme = document.documentElement.getAttribute('data-bs-theme');\r\n    const isDarkMode = theme === 'dark';\r\n\r\n    console.log('[GanttV2] Theme detection:', {\r\n      'data-bs-theme': theme,\r\n      isDarkMode,\r\n      hasTimeColumns: timeColumnCount\r\n    });\r\n\r\n    const bgColor = isDarkMode ? '#1e1e1e' : '#ffffff';\r\n    const borderColor = isDarkMode ? '#404040' : '#dee2e6';\r\n\r\n    // Create grid container with dynamic columns\r\n    const gridContainer = document.createElement('div');\r\n    gridContainer.className = 'gantt-grid';\r\n    gridContainer.style.cssText = `\r\n      display: grid;\r\n      grid-template-columns: 280px 70px 70px repeat(${timeColumnCount}, 100px);\r\n      overflow: auto;\r\n      height: 600px;\r\n      background: ${bgColor};\r\n      border: 1px solid ${borderColor};\r\n    `;\r\n\r\n    this.container.appendChild(gridContainer);\r\n    this.elements.gridContainer = gridContainer;\r\n\r\n    // Store for later use\r\n    this.isDarkMode = isDarkMode;\r\n    this.borderColor = borderColor;\r\n  }\r\n\r\n  /**\r\n   * Render real data (Phase 2)\r\n   * @private\r\n   */\r\n  _renderRealData(pekerjaan, timeColumns) {\r\n    this._renderHeaders(timeColumns);\r\n    this._renderDataRows(pekerjaan, timeColumns);\r\n  }\r\n\r\n  /**\r\n   * Render header row with real timeline\r\n   * @private\r\n   */\r\n  _renderHeaders(timeColumns) {\r\n    const headerBg = this.isDarkMode ? '#2d2d2d' : 'var(--bs-light, #f8f9fa)';\r\n    const headerColor = this.isDarkMode ? '#e0e0e0' : '#212529';\r\n\r\n    // Frozen headers\r\n    const frozenHeaders = [\r\n      { label: 'Pekerjaan', width: '280px' },\r\n      { label: 'Volume', width: '70px' },\r\n      { label: 'Satuan', width: '70px' }\r\n    ];\r\n\r\n    frozenHeaders.forEach((header, i) => {\r\n      const headerCell = document.createElement('div');\r\n      headerCell.className = 'gantt-header-cell frozen';\r\n      headerCell.style.cssText = `\r\n        position: sticky;\r\n        left: ${this._calculateStickyLeft(i)}px;\r\n        top: 0;\r\n        z-index: 20;\r\n        background: ${headerBg};\r\n        color: ${headerColor};\r\n        font-weight: 600;\r\n        padding: 0.5rem;\r\n        border-bottom: 2px solid ${this.borderColor};\r\n        border-right: ${i === 2 ? '2px' : '1px'} solid ${this.borderColor};\r\n        ${i === 0 ? `border-left: 1px solid ${this.borderColor};` : ''}\r\n        display: flex;\r\n        align-items: center;\r\n        height: ${this.options.rowHeight}px;\r\n        box-sizing: border-box;\r\n      `;\r\n      headerCell.textContent = header.label;\r\n      this.elements.gridContainer.appendChild(headerCell);\r\n    });\r\n\r\n    // Timeline headers from TimeColumnGenerator\r\n    timeColumns.forEach((col, i) => {\r\n      const headerCell = document.createElement('div');\r\n      headerCell.className = 'gantt-header-cell timeline';\r\n      headerCell.style.cssText = `\r\n        position: sticky;\r\n        top: 0;\r\n        z-index: 10;\r\n        background: ${headerBg};\r\n        color: ${headerColor};\r\n        font-weight: 600;\r\n        padding: 0.25rem;\r\n        border-bottom: 2px solid ${this.borderColor};\r\n        border-right: 1px solid ${this.isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)'};\r\n        ${i === 0 ? `border-left: 1px solid ${this.borderColor};` : ''}\r\n        text-align: center;\r\n        font-size: 0.75rem;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: center;\r\n        align-items: center;\r\n        gap: 0.1rem;\r\n        line-height: 1.1;\r\n        height: ${this.options.rowHeight}px;\r\n        box-sizing: border-box;\r\n      `;\r\n\r\n      // Main label (e.g., \"Week 1\" or \"Jan 2025\")\r\n      const labelSpan = document.createElement('div');\r\n      labelSpan.style.cssText = 'font-weight: 600; font-size: 0.7rem;';\r\n      labelSpan.textContent = col.label || col.id;\r\n      headerCell.appendChild(labelSpan);\r\n\r\n      // Date range (e.g., \"01-07 Jan\")\r\n      if (col.rangeLabel || col.subLabel) {\r\n        const rangeSpan = document.createElement('div');\r\n        rangeSpan.style.cssText = `\r\n          font-weight: 400;\r\n          font-size: 0.6rem;\r\n          color: ${this.isDarkMode ? '#9ca3af' : '#6c757d'};\r\n          opacity: 0.85;\r\n        `;\r\n        rangeSpan.textContent = col.rangeLabel || col.subLabel;\r\n        headerCell.appendChild(rangeSpan);\r\n      }\r\n\r\n      this.elements.gridContainer.appendChild(headerCell);\r\n    });\r\n\r\n    console.log(`[GanttV2] Rendered ${timeColumns.length} timeline headers`);\r\n  }\r\n\r\n  /**\r\n   * Render data rows with real pekerjaan\r\n   * @private\r\n   */\r\n  _renderDataRows(pekerjaan, timeColumns) {\r\n    if (!pekerjaan || pekerjaan.length === 0) {\r\n      console.warn('[GanttV2] No pekerjaan data to render');\r\n      return;\r\n    }\r\n\r\n    // Get only visible rows (respecting expand/collapse state)\r\n    const visibleRows = this._getVisibleRows(pekerjaan);\r\n\r\n    console.log(`[GanttV2] Rendering ${visibleRows.length}/${pekerjaan.length} visible rows`);\r\n\r\n    visibleRows.forEach(node => {\r\n      // Determine level for indentation\r\n      const level = node.level || 0;\r\n      const hasChildren = node.children && node.children.length > 0;\r\n\r\n      // Frozen cells (pass node for expand/collapse toggle)\r\n      this._createFrozenCell(node.nama || node.name || 'Unknown', 0, level, 'left', node, hasChildren);\r\n      this._createFrozenCell(node.volume || 0, 1, 0, 'right');\r\n      this._createFrozenCell(node.satuan || '-', 2, 0, 'center');\r\n\r\n      // Timeline cells with assignments\r\n      // Only render bars for actual pekerjaan (leaf nodes)\r\n      this._renderTimelineCells(node, timeColumns);\r\n    });\r\n\r\n    console.log(`âœ… Rendered ${visibleRows.length} rows`);\r\n  }\r\n\r\n  /**\r\n   * Create frozen cell with text wrap support and expand/collapse toggle\r\n   * @private\r\n   */\r\n  _createFrozenCell(content, columnIndex, level = 0, align = 'left', node = null, hasChildren = false) {\r\n    const cell = document.createElement('div');\n    cell.className = 'gantt-cell frozen';\n    if (columnIndex === 0) {\n      cell.classList.add('tree-column');\n    }\n    if (columnIndex === 2) {\n      cell.classList.add('frozen-last');\n    }\n\n    const stickyLeft = this._calculateStickyLeft(columnIndex);\n    const paddingLeft = columnIndex === 0 ? `${0.5 + level * 1.5}rem` : '0.5rem'; // Indentation based on level\n\n    const bgColor = this.isDarkMode ? '#1e1e1e' : 'white';\n    const textColor = this.isDarkMode ? '#e0e0e0' : '#212529';\r\n\r\n    // Determine font weight based on hierarchy level\r\n    // Level 0 = Klasifikasi (bold 700), Level 1 = Sub-klasifikasi (semibold 600), Level 2+ = Pekerjaan (normal 400)\r\n    const fontWeight = level === 0 ? '700' : level === 1 ? '600' : '400';\r\n\r\n    // Fix #1: Add border-left to prevent gap on left side\r\n    // Fix #2: Use font-size 0.7rem and ensure text is vertically centered with align-items: center\r\n    cell.style.cssText = `\r\n      position: sticky;\r\n      left: ${stickyLeft}px;\r\n      z-index: 5;\r\n      background: ${bgColor};\n      color: ${textColor};\n      padding: 0.5rem;\n      padding-left: ${paddingLeft};\n      display: flex;\n      align-items: center;\n      justify-content: ${align === 'right' ? 'flex-end' : align === 'center' ? 'center' : 'flex-start'};\n      font-size: ${columnIndex === 0 ? '0.7rem' : '0.875rem'};\r\n      font-weight: ${columnIndex === 0 ? fontWeight : '400'};\r\n      height: ${this.options.rowHeight}px;\r\n      line-height: 1.2;\r\n      box-sizing: border-box;\r\n      overflow: hidden;\r\n    `;\r\n\r\n    // Text content wrapper for first column (name)\r\n    if (columnIndex === 0) {\r\n      const textSpan = document.createElement('span');\r\n      textSpan.textContent = content;\r\n      textSpan.style.cssText = `\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        white-space: nowrap;\r\n        flex: 1;\r\n      `;\r\n      cell.appendChild(textSpan);\r\n    } else {\r\n      // For other columns (volume, satuan), just add text directly\r\n      cell.textContent = content;\r\n    }\r\n\r\n    this.elements.gridContainer.appendChild(cell);\r\n\r\n    return cell;\r\n  }\r\n\r\n  /**\r\n   * Render timeline cells for a pekerjaan row with continuous bars\r\n   * @private\r\n   */\r\n  _renderTimelineCells(node, timeColumns) {\r\n    // Get all cell values for planned and actual modes\r\n    const plannedCells = this.stateManager.getAllCellsForMode('planned');\r\n    const actualCells = this.stateManager.getAllCellsForMode('actual');\r\n\r\n    // Extract assignments for this pekerjaan\r\n    const plannedAssignments = this._extractAssignmentsForPekerjaan(node.id, plannedCells, timeColumns);\r\n    const actualAssignments = this._extractAssignmentsForPekerjaan(node.id, actualCells, timeColumns);\r\n\r\n    // Debug assignments for ALL pekerjaan (type === 'pekerjaan')\r\n    if (node.type === 'pekerjaan') {\r\n      console.log(`[GanttV2] Row ${node.id} (${node.nama?.substring(0, 30)}) assignments:`, {\r\n        planned: plannedAssignments.length,\r\n        actual: actualAssignments.length,\r\n        plannedSample: plannedAssignments.slice(0, 3),\r\n        actualSample: actualAssignments.slice(0, 3),\r\n        plannedCellsTotal: plannedCells.size,\r\n        actualCellsTotal: actualCells.size\r\n      });\r\n\r\n      // Debug: Show sample cell keys\r\n      if (plannedCells.size > 0) {\r\n        const sampleKeys = Array.from(plannedCells.keys()).slice(0, 5);\r\n        console.log(`[GanttV2] Sample planned cell keys:`, sampleKeys);\r\n      }\r\n    }\r\n\r\n    // Find date range for bars\r\n    const plannedRange = this._getBarRange(plannedAssignments, timeColumns);\r\n    const actualRange = this._getBarRange(actualAssignments, timeColumns);\r\n\r\n    // Render each timeline cell\r\n    timeColumns.forEach((col, colIndex) => {\r\n      const cell = this._createTimelineCell(colIndex);\r\n\r\n      // Check if this cell is part of planned bar range\r\n      if (plannedRange && colIndex >= plannedRange.startIndex && colIndex <= plannedRange.endIndex) {\r\n        this._addContinuousBarSegment(cell, 'planned', colIndex, plannedRange, plannedAssignments, timeColumns);\r\n      }\r\n\r\n      // Check if this cell is part of actual bar range\r\n      if (actualRange && colIndex >= actualRange.startIndex && colIndex <= actualRange.endIndex) {\r\n        this._addContinuousBarSegment(cell, 'actual', colIndex, actualRange, actualAssignments, timeColumns);\r\n      }\r\n\r\n      this.elements.gridContainer.appendChild(cell);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Extract assignments for a specific pekerjaan from cell map\r\n   * @private\r\n   * @param {number|string} pekerjaanId - Pekerjaan ID\r\n   * @param {Map} cellMap - Cell value map from StateManager (key format: \"pekerjaanId-columnId\")\r\n   * @param {Array} timeColumns - Timeline columns\r\n   * @returns {Array} Array of assignments {tahapan_id, volume}\r\n   */\r\n  _extractAssignmentsForPekerjaan(pekerjaanId, cellMap, timeColumns) {\r\n    const assignments = [];\r\n    const pekerjaanIdStr = String(pekerjaanId);\r\n\r\n    // Debug: Log first matching cell\r\n    let firstMatch = false;\r\n\r\n    // Iterate through all cells and find ones belonging to this pekerjaan\r\n    cellMap.forEach((value, cellKey) => {\r\n      const [cellPekerjaanId, columnId] = cellKey.split('-');\r\n\r\n      if (cellPekerjaanId === pekerjaanIdStr && value > 0) {\r\n        // Find the tahapan_id (column ID) from columnId\r\n        const tahapanId = parseInt(columnId.replace('col_', ''));\r\n\r\n        // Debug first match\r\n        if (!firstMatch) {\r\n          console.log(`[GanttV2] First match for pekerjaan ${pekerjaanId}:`, {\r\n            cellKey,\r\n            columnId,\r\n            tahapanId,\r\n            value,\r\n            timeColumnsHasId: timeColumns.some(col => col.tahapanId === tahapanId)\r\n          });\r\n          firstMatch = true;\r\n        }\r\n\r\n        assignments.push({\r\n          tahapan_id: tahapanId,\r\n          volume: value\r\n        });\r\n      }\r\n    });\r\n\r\n    return assignments;\r\n  }\r\n\r\n  /**\r\n   * Get bar range (start and end column index) for assignments\r\n   * @private\r\n   */\r\n  _getBarRange(assignments, timeColumns) {\r\n    if (!assignments || assignments.length === 0) return null;\r\n\r\n    let startIndex = Infinity;\r\n    let endIndex = -1;\r\n\r\n    assignments.forEach(assignment => {\r\n      // FIXED: Use col.tahapanId (numeric) instead of col.id (string \"tahap-XXXX\")\r\n      const colIndex = timeColumns.findIndex(col => col.tahapanId === assignment.tahapan_id);\r\n      if (colIndex !== -1) {\r\n        startIndex = Math.min(startIndex, colIndex);\r\n        endIndex = Math.max(endIndex, colIndex);\r\n      }\r\n    });\r\n\r\n    if (startIndex === Infinity) return null;\r\n\r\n    return { startIndex, endIndex };\r\n  }\r\n\r\n  /**\r\n   * Add continuous bar segment to cell\r\n   * @private\r\n   */\r\n  _addContinuousBarSegment(cell, type, colIndex, range, assignments, timeColumns) {\r\n    const isFirst = colIndex === range.startIndex;\r\n    const isLast = colIndex === range.endIndex;\r\n    const isSingle = isFirst && isLast;\r\n\r\n    // Calculate progress for this cell\r\n    const col = timeColumns[colIndex];\r\n    // FIXED: Use col.tahapanId (numeric) instead of col.id (string \"tahap-XXXX\")\r\n    const assignment = assignments.find(a => col && a.tahapan_id === col.tahapanId);\r\n    const progress = assignment?.volume || 0;\r\n\r\n    // Dark mode colors\r\n    const colors = type === 'planned'\r\n      ? {\r\n          bg: this.isDarkMode ? 'rgba(66, 153, 225, 0.5)' : 'rgba(13, 110, 253, 0.5)',\r\n          border: this.isDarkMode ? '#4299e1' : '#0d6efd',\r\n          progress: this.isDarkMode ? '#2c5282' : '#084298'\r\n        }\r\n      : {\r\n          bg: this.isDarkMode ? 'rgba(237, 137, 54, 0.9)' : 'rgba(253, 126, 20, 0.9)',\r\n          border: this.isDarkMode ? '#ed8936' : '#dc6d08',\r\n          progress: this.isDarkMode ? '#9c4221' : '#b34d00'\r\n        };\r\n\r\n    const bar = document.createElement('div');\r\n    bar.className = `gantt-bar-continuous ${type}`;\r\n    bar.style.cssText = `\r\n      position: absolute;\r\n      top: ${type === 'planned' ? '25%' : '50%'};\r\n      left: 0;\r\n      width: 100%;\r\n      height: 18px;\r\n      transform: translateY(-50%);\r\n      background: ${colors.bg};\r\n      border-top: 1px solid ${colors.border};\r\n      border-bottom: 2px solid ${colors.border};\r\n      ${isFirst || isSingle ? `border-left: 2px solid ${colors.border}; border-top-left-radius: 4px; border-bottom-left-radius: 4px;` : ''}\r\n      ${isLast || isSingle ? `border-right: 2px solid ${colors.border}; border-top-right-radius: 4px; border-bottom-right-radius: 4px;` : ''}\r\n      z-index: ${type === 'actual' ? '3' : '2'};\r\n      overflow: hidden;\r\n    `;\r\n\r\n    // Progress fill\r\n    if (progress > 0) {\r\n      const progressFill = document.createElement('div');\r\n      progressFill.className = 'gantt-bar-progress';\r\n      progressFill.style.cssText = `\r\n        position: absolute;\r\n        left: 0;\r\n        top: 0;\r\n        height: 100%;\r\n        width: ${Math.min(progress, 100)}%;\r\n        background: ${colors.progress};\r\n        opacity: 0.6;\r\n      `;\r\n      bar.appendChild(progressFill);\r\n    }\r\n\r\n    cell.appendChild(bar);\r\n  }\r\n\r\n  /**\r\n   * Create timeline cell\r\n   * @private\r\n   */\r\n  _createTimelineCell(colIndex) {\r\n    const cell = document.createElement('div');\n    cell.className = 'gantt-cell timeline';\n    if (colIndex === 0) {\n      cell.classList.add('timeline-first');\n    }\n    cell.dataset.colIndex = colIndex;\n\n    const bgColor = this.isDarkMode ? '#1e1e1e' : 'white';\n\n    // CRITICAL: Use height, not min-height, to match frozen cells\n    cell.style.cssText = `\n      position: relative;\n      background: ${bgColor};\n      height: ${this.options.rowHeight}px;\n      box-sizing: border-box;\n    `;\n\r\n    return cell;\r\n  }\r\n\r\n  /**\r\n   * Calculate sticky left position for frozen columns\r\n   * @private\r\n   */\r\n  _calculateStickyLeft(columnIndex) {\r\n    const widths = [0, 280, 350]; // Cumulative widths\r\n    return widths[columnIndex] || 0;\r\n  }\r\n\r\n  /**\r\n   * Generate demo time columns (fallback when TimeColumnGenerator not available)\r\n   * @private\r\n   * @param {number} count - Number of weeks to generate\r\n   * @returns {Array} Array of column objects\r\n   */\r\n  _generateDemoTimeColumns(count) {\r\n    const columns = [];\r\n    for (let i = 0; i < count; i++) {\r\n      columns.push({\r\n        id: 1000 + i, // Use high IDs to avoid conflicts\r\n        label: `W${i + 1}`,\r\n        startDate: new Date(2025, 0, 1 + i * 7), // Weekly intervals\r\n        endDate: new Date(2025, 0, 8 + i * 7)\r\n      });\r\n    }\r\n    return columns;\r\n  }\r\n\r\n  /**\r\n   * Initialize expand state for all non-leaf nodes (Phase 3.1)\r\n   * @private\r\n   */\r\n  _initializeExpandState(pekerjaan) {\r\n    pekerjaan.forEach(node => {\r\n      if (node.children && node.children.length > 0) {\r\n        // Default: all nodes expanded\r\n        this.state.expandedNodes.set(node.id, true);\r\n      }\r\n    });\r\n    console.log(`[GanttV2] Initialized expand state for ${this.state.expandedNodes.size} parent nodes`);\r\n  }\r\n\r\n  /**\r\n   * Get visible rows based on expand/collapse state (Phase 3.1)\r\n   * IMPORTANT: flatPekerjaan is already a flat array, not nested!\r\n   * @private\r\n   */\r\n  _getVisibleRows(pekerjaan) {\r\n    const visible = [];\r\n    const collapsedParents = new Set();\r\n\r\n    // flatPekerjaan is already flat, so just filter based on parent collapse state\r\n    pekerjaan.forEach(node => {\r\n      // Check if any of this node's parents are collapsed\r\n      const parentId = node.parent_id || node.parentId;\r\n\r\n      // If this node has a parent that's collapsed, skip it\r\n      if (parentId && collapsedParents.has(parentId)) {\r\n        // Also mark this node as having a collapsed parent\r\n        collapsedParents.add(node.id);\r\n        return;\r\n      }\r\n\r\n      // Add this node to visible list\r\n      visible.push(node);\r\n\r\n      // If this node is collapsed, mark it so its children will be hidden\r\n      const isCollapsed = this.state.expandedNodes.get(node.id) === false;\r\n      if (isCollapsed) {\r\n        collapsedParents.add(node.id);\r\n      }\r\n    });\r\n\r\n    return visible;\r\n  }\r\n\r\n  /**\r\n   * Toggle expand/collapse state for a node (Phase 3.1)\r\n   * @private\r\n   */\r\n  _toggleNodeExpand(nodeId) {\r\n    const currentState = this.state.expandedNodes.get(nodeId);\r\n    const newState = !currentState;\r\n\r\n    this.state.expandedNodes.set(nodeId, newState);\r\n\r\n    console.log(`[GanttV2] Node ${nodeId} ${newState ? 'expanded' : 'collapsed'}`);\r\n\r\n    // Re-render chart with new expand state\r\n    this._buildDOM(this.timeColumns.length);\r\n    this._renderRealData(this.pekerjaan, this.timeColumns);\r\n  }\r\n\r\n  /**\r\n   * Setup theme observer to re-render on dark/light mode switch\r\n   * @private\r\n   */\r\n  _setupThemeObserver(pekerjaan, timeColumns) {\r\n    // Disconnect previous observer if exists\r\n    if (this.themeObserver) {\r\n      this.themeObserver.disconnect();\r\n    }\r\n\r\n    // Watch for data-bs-theme attribute changes on <html>\r\n    this.themeObserver = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {\r\n          const newTheme = document.documentElement.getAttribute('data-bs-theme');\r\n          console.log('[GanttV2] Theme changed to:', newTheme);\r\n\r\n          // Re-render entire chart with new theme colors\r\n          this._buildDOM(timeColumns.length);\r\n          this._renderRealData(pekerjaan, timeColumns);\r\n\r\n          Toast.info(`ðŸŽ¨ Gantt theme updated: ${newTheme}`, 1500);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.themeObserver.observe(document.documentElement, {\r\n      attributes: true,\r\n      attributeFilter: ['data-bs-theme']\r\n    });\r\n\r\n    console.log('[GanttV2] Theme observer setup complete');\r\n  }\r\n\r\n  /**\r\n   * Update Gantt chart with latest data\r\n   * Called after data changes (e.g., after save)\r\n   */\r\n  update() {\r\n    if (!this.state.initialized) {\r\n      console.warn('[GanttV2] Cannot update - not initialized');\r\n      return;\r\n    }\r\n\r\n    if (!this.app) {\r\n      console.warn('[GanttV2] Cannot update - no app reference');\r\n      return;\r\n    }\r\n\r\n    console.log('[GanttV2] Updating chart with latest data...');\r\n\r\n    // Get fresh data from app\r\n    const pekerjaan = this.app.state.flatPekerjaan || [];\r\n    const timeColumns = this.timeColumnGenerator?.state?.timeColumns || this.app.state?.timeColumns || [];\r\n\r\n    // Clear existing grid content (but keep container structure)\r\n    if (this.elements.gridContainer) {\r\n      this.elements.gridContainer.innerHTML = '';\r\n    }\r\n\r\n    // Re-render with updated data\r\n    this._renderRealData(pekerjaan, timeColumns);\r\n\r\n    // Store for expand/collapse\r\n    this.pekerjaan = pekerjaan;\r\n    this.timeColumns = timeColumns;\r\n\r\n    console.log('[GanttV2] âœ… Chart updated successfully');\r\n  }\r\n\r\n  /**\r\n   * Destroy and cleanup\r\n   */\r\n  destroy() {\r\n    // Disconnect theme observer\r\n    if (this.themeObserver) {\r\n      this.themeObserver.disconnect();\r\n      this.themeObserver = null;\r\n    }\r\n\r\n    if (this.container) {\r\n      this.container.innerHTML = '';\r\n    }\r\n    this.state.initialized = false;\r\n    console.log('Gantt Frozen Grid destroyed');\r\n  }\r\n}\r\n"],"names":["GanttFrozenGrid","constructor","container","options","this","document","querySelector","Error","__spreadValues","rowHeight","frozenColumnWidth","volumeColumnWidth","satuanColumnWidth","timelineColumnWidth","timeScale","state","rows","timelineColumns","scrollTop","scrollLeft","initialized","expandedNodes","Map","elements","gridContainer","themeObserver","pekerjaan","timeColumns","initialize","app","console","log","stateManager","timeColumnGenerator","hasStateManager","hasTimeColumnGenerator","hasFlatPekerjaan","_a","flatPekerjaan","_c","_b","_d","pekerjaanCount","length","timeColumnsCount","_e","warn","demoColumns","_generateDemoTimeColumns","_buildDOM","_renderRealData","Toast","success","slice","map","c","id","firstCol","tahapanId","label","p","type","level","nama","substring","_initializeExpandState","_setupThemeObserver","error","timeColumnCount","innerHTML","className","theme","documentElement","getAttribute","isDarkMode","hasTimeColumns","bgColor","borderColor","createElement","style","cssText","appendChild","_renderHeaders","_renderDataRows","headerBg","headerColor","width","forEach","header","i","headerCell","_calculateStickyLeft","textContent","col","labelSpan","rangeLabel","subLabel","rangeSpan","visibleRows","_getVisibleRows","node","hasChildren","children","_createFrozenCell","name","volume","satuan","_renderTimelineCells","content","columnIndex","align","cell","classList","add","stickyLeft","paddingLeft","textColor","fontWeight","textSpan","plannedCells","getAllCellsForMode","actualCells","plannedAssignments","_extractAssignmentsForPekerjaan","actualAssignments","planned","actual","plannedSample","actualSample","plannedCellsTotal","size","actualCellsTotal","sampleKeys","Array","from","keys","plannedRange","_getBarRange","actualRange","colIndex","_createTimelineCell","startIndex","endIndex","_addContinuousBarSegment","pekerjaanId","cellMap","assignments","pekerjaanIdStr","String","firstMatch","value","cellKey","cellPekerjaanId","columnId","split","parseInt","replace","timeColumnsHasId","some","push","tahapan_id","Infinity","assignment","findIndex","Math","min","max","range","isFirst","isLast","isSingle","find","a","progress","colors","bg","border","bar","progressFill","dataset","count","columns","startDate","Date","endDate","set","visible","collapsedParents","Set","parentId","parent_id","has","get","_toggleNodeExpand","nodeId","newState","disconnect","MutationObserver","mutations","mutation","attributeName","newTheme","info","observe","attributes","attributeFilter","update","destroy"],"mappings":"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"}