{"version":3,"file":"grid-modules-_LCPdncz.js","sources":["../../../../../../js/src/modules/shared/event-delegation.js","../../../../../../js/src/modules/shared/performance-utils.js","../../../../../../js/src/modules/shared/validation-utils.js","../../../../../../js/src/modules/grid/grid-event-handlers.js","../../../../../../js/src/modules/grid/column-definitions.js","../../../../../../js/src/modules/grid/ag-grid-setup.js","../../../../../../js/src/modules/grid/grid-renderer.js"],"sourcesContent":["/**\n * Event Delegation Module\n * Provides memory-efficient event handling using delegation pattern\n * Prevents memory leaks from thousands of individual event listeners\n * License: MIT\n */\n\n/**\n * Event Delegation Manager\n * Manages delegated event listeners on a parent element\n */\nexport class EventDelegationManager {\n  constructor(rootElement) {\n    this.rootElement = rootElement;\n    this.handlers = new Map(); // event type -> array of handler configs\n    this.activeListeners = new Map(); // event type -> actual listener function\n  }\n\n  /**\n   * Registers a delegated event handler\n   *\n   * @param {string} eventType - Event type (e.g., 'click', 'input')\n   * @param {string} selector - CSS selector to match target elements\n   * @param {Function} handler - Event handler function\n   * @param {Object} options - Configuration options\n   * @param {boolean} options.capture - Use capture phase\n   * @param {boolean} options.passive - Mark as passive listener\n   *\n   * @example\n   * manager.on('click', '.time-cell.editable', (event, target) => {\n   *   console.log('Clicked cell:', target.dataset.cellId);\n   * });\n   */\n  on(eventType, selector, handler, options = {}) {\n    if (!this.handlers.has(eventType)) {\n      this.handlers.set(eventType, []);\n      this._attachListener(eventType, options);\n    }\n\n    this.handlers.get(eventType).push({\n      selector,\n      handler,\n      options,\n    });\n  }\n\n  /**\n   * Removes a delegated event handler\n   *\n   * @param {string} eventType - Event type\n   * @param {string} selector - CSS selector\n   * @param {Function} handler - Handler function to remove\n   */\n  off(eventType, selector, handler) {\n    if (!this.handlers.has(eventType)) {\n      return;\n    }\n\n    const handlers = this.handlers.get(eventType);\n    const index = handlers.findIndex(\n      (h) => h.selector === selector && h.handler === handler\n    );\n\n    if (index !== -1) {\n      handlers.splice(index, 1);\n\n      // If no more handlers for this event type, remove the listener\n      if (handlers.length === 0) {\n        this._detachListener(eventType);\n        this.handlers.delete(eventType);\n      }\n    }\n  }\n\n  /**\n   * Removes all handlers for an event type\n   *\n   * @param {string} eventType - Event type to clear\n   */\n  clearEvent(eventType) {\n    if (!this.handlers.has(eventType)) {\n      return;\n    }\n\n    this._detachListener(eventType);\n    this.handlers.delete(eventType);\n  }\n\n  /**\n   * Removes all handlers and cleans up\n   */\n  destroy() {\n    for (const eventType of this.handlers.keys()) {\n      this._detachListener(eventType);\n    }\n\n    this.handlers.clear();\n    this.activeListeners.clear();\n    this.rootElement = null;\n  }\n\n  /**\n   * Internal: Attaches the actual event listener to root element\n   */\n  _attachListener(eventType, options = {}) {\n    const listener = (event) => {\n      const handlers = this.handlers.get(eventType) || [];\n\n      for (const { selector, handler } of handlers) {\n        // Find the matching target (could be event.target or an ancestor)\n        const target = event.target.closest(selector);\n\n        if (target && this.rootElement.contains(target)) {\n          handler.call(target, event, target);\n        }\n      }\n    };\n\n    this.rootElement.addEventListener(eventType, listener, {\n      capture: options.capture || false,\n      passive: options.passive || false,\n    });\n\n    this.activeListeners.set(eventType, listener);\n  }\n\n  /**\n   * Internal: Detaches the event listener from root element\n   */\n  _detachListener(eventType) {\n    const listener = this.activeListeners.get(eventType);\n\n    if (listener) {\n      this.rootElement.removeEventListener(eventType, listener);\n      this.activeListeners.delete(eventType);\n    }\n  }\n}\n\n/**\n * Simplified event delegation helper function\n *\n * @param {HTMLElement} rootElement - Parent element to attach listener to\n * @param {string} eventType - Event type (e.g., 'click')\n * @param {string} selector - CSS selector for target elements\n * @param {Function} handler - Event handler\n * @param {Object} options - Event options\n * @returns {Function} Cleanup function\n *\n * @example\n * const cleanup = delegate(\n *   document.getElementById('grid-container'),\n *   'click',\n *   '.time-cell',\n *   (event, target) => {\n *     handleCellClick(target);\n *   }\n * );\n *\n * // Later, to cleanup:\n * cleanup();\n */\nexport function delegate(rootElement, eventType, selector, handler, options = {}) {\n  const listener = (event) => {\n    const target = event.target.closest(selector);\n\n    if (target && rootElement.contains(target)) {\n      handler.call(target, event, target);\n    }\n  };\n\n  rootElement.addEventListener(eventType, listener, options);\n\n  // Return cleanup function\n  return () => {\n    rootElement.removeEventListener(eventType, listener);\n  };\n}\n\n/**\n * Creates multiple delegated event listeners and returns cleanup function\n *\n * @param {HTMLElement} rootElement - Parent element\n * @param {Object} eventMap - Map of event configs\n * @returns {Function} Cleanup function for all listeners\n *\n * @example\n * const cleanup = delegateMultiple(gridContainer, {\n *   click: {\n *     '.time-cell': handleCellClick,\n *     '.expand-btn': handleExpand,\n *   },\n *   input: {\n *     '.time-cell input': handleInput,\n *   },\n *   blur: {\n *     '.time-cell input': handleBlur,\n *   },\n * });\n *\n * // Cleanup all listeners\n * cleanup();\n */\nexport function delegateMultiple(rootElement, eventMap) {\n  const cleanupFunctions = [];\n\n  for (const [eventType, selectorHandlers] of Object.entries(eventMap)) {\n    for (const [selector, handler] of Object.entries(selectorHandlers)) {\n      const cleanup = delegate(rootElement, eventType, selector, handler);\n      cleanupFunctions.push(cleanup);\n    }\n  }\n\n  // Return function that cleans up all listeners\n  return () => {\n    cleanupFunctions.forEach((cleanup) => cleanup());\n  };\n}\n\n/**\n * Safely removes old event listeners from an element\n * Useful for cleaning up before re-attaching new listeners\n *\n * @param {HTMLElement} element - Element to clean\n *\n * @example\n * cleanupEventListeners(gridContainer);\n * // Now safe to attach new listeners without duplicates\n */\nexport function cleanupEventListeners(element) {\n  if (!element || !element._delegatedHandlers) {\n    return;\n  }\n\n  const handlers = element._delegatedHandlers || [];\n\n  handlers.forEach(({ event, handler, options }) => {\n    element.removeEventListener(event, handler, options);\n  });\n\n  delete element._delegatedHandlers;\n}\n\n/**\n * Stores event listener references for later cleanup\n *\n * @param {HTMLElement} element - Element to track\n * @param {string} eventType - Event type\n * @param {Function} handler - Handler function\n * @param {Object} options - Event options\n */\nexport function trackEventListener(element, eventType, handler, options = {}) {\n  if (!element._delegatedHandlers) {\n    element._delegatedHandlers = [];\n  }\n\n  element._delegatedHandlers.push({\n    event: eventType,\n    handler,\n    options,\n  });\n}\n\n/**\n * One-time event listener with automatic cleanup\n *\n * @param {HTMLElement} element - Element to listen on\n * @param {string} eventType - Event type\n * @param {Function} handler - Handler function\n *\n * @example\n * once(saveButton, 'click', () => {\n *   console.log('This will only fire once');\n * });\n */\nexport function once(element, eventType, handler) {\n  const onceHandler = (event) => {\n    handler(event);\n    element.removeEventListener(eventType, onceHandler);\n  };\n\n  element.addEventListener(eventType, onceHandler);\n\n  return () => {\n    element.removeEventListener(eventType, onceHandler);\n  };\n}\n","/**\n * Performance Utilities Module\n * Provides debounce, throttle, and requestAnimationFrame helpers\n * License: MIT\n */\n\n/**\n * Debounces a function - delays execution until after wait time has elapsed\n * since the last call. Useful for input events, window resize.\n *\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @param {boolean} immediate - Execute on leading edge instead of trailing\n * @returns {Function} Debounced function\n *\n * @example\n * const debouncedSearch = debounce((query) => {\n *   console.log('Searching for:', query);\n * }, 300);\n *\n * input.addEventListener('input', (e) => debouncedSearch(e.target.value));\n */\nexport function debounce(func, wait, immediate = false) {\n  let timeout;\n\n  const debounced = function (...args) {\n    const context = this;\n\n    const later = () => {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    };\n\n    const callNow = immediate && !timeout;\n\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n\n    if (callNow) {\n      func.apply(context, args);\n    }\n  };\n\n  // Cancel method to clear pending execution\n  debounced.cancel = () => {\n    clearTimeout(timeout);\n    timeout = null;\n  };\n\n  return debounced;\n}\n\n/**\n * Throttles a function - ensures it's called at most once per specified time period.\n * Useful for scroll events, mousemove.\n *\n * @param {Function} func - Function to throttle\n * @param {number} limit - Minimum time between calls in milliseconds\n * @param {Object} options - Configuration options\n * @param {boolean} options.leading - Execute on leading edge (default: true)\n * @param {boolean} options.trailing - Execute on trailing edge (default: true)\n * @returns {Function} Throttled function\n *\n * @example\n * const throttledScroll = throttle(() => {\n *   console.log('Scroll position:', window.scrollY);\n * }, 16); // ~60fps\n *\n * window.addEventListener('scroll', throttledScroll);\n */\nexport function throttle(func, limit, options = {}) {\n  const { leading = true, trailing = true } = options;\n\n  let inThrottle;\n  let lastFunc;\n  let lastRan;\n\n  const throttled = function (...args) {\n    const context = this;\n\n    if (!inThrottle) {\n      if (leading) {\n        func.apply(context, args);\n        lastRan = Date.now();\n      }\n      inThrottle = true;\n    } else {\n      clearTimeout(lastFunc);\n      lastFunc = setTimeout(() => {\n        if (Date.now() - lastRan >= limit) {\n          if (trailing) {\n            func.apply(context, args);\n          }\n          lastRan = Date.now();\n        }\n      }, Math.max(limit - (Date.now() - lastRan), 0));\n    }\n\n    setTimeout(() => {\n      inThrottle = false;\n    }, limit);\n  };\n\n  // Cancel method to clear pending execution\n  throttled.cancel = () => {\n    clearTimeout(lastFunc);\n    inThrottle = false;\n  };\n\n  return throttled;\n}\n\n/**\n * requestAnimationFrame-based throttle for smooth animations\n * Ensures function is called at most once per animation frame (~60fps)\n *\n * @param {Function} func - Function to throttle\n * @returns {Function} RAF-throttled function\n *\n * @example\n * const rafScroll = rafThrottle(() => {\n *   // Sync scroll positions\n *   rightContainer.scrollLeft = leftContainer.scrollLeft;\n * });\n *\n * leftContainer.addEventListener('scroll', rafScroll);\n */\nexport function rafThrottle(func) {\n  let rafId = null;\n  let lastArgs = null;\n\n  const throttled = function (...args) {\n    lastArgs = args;\n\n    if (rafId === null) {\n      rafId = requestAnimationFrame(() => {\n        func.apply(this, lastArgs);\n        rafId = null;\n        lastArgs = null;\n      });\n    }\n  };\n\n  // Cancel method to clear pending execution\n  throttled.cancel = () => {\n    if (rafId !== null) {\n      cancelAnimationFrame(rafId);\n      rafId = null;\n      lastArgs = null;\n    }\n  };\n\n  return throttled;\n}\n\n/**\n * Batches multiple synchronous DOM reads/writes to prevent layout thrashing\n *\n * @param {Function} readFunc - Function that reads from DOM\n * @param {Function} writeFunc - Function that writes to DOM\n *\n * @example\n * batchDOMOperations(\n *   () => {\n *     // Read phase\n *     const width = element.offsetWidth;\n *     return { width };\n *   },\n *   (readResults) => {\n *     // Write phase\n *     element.style.height = readResults.width + 'px';\n *   }\n * );\n */\nexport function batchDOMOperations(readFunc, writeFunc) {\n  requestAnimationFrame(() => {\n    const readResults = readFunc();\n\n    requestAnimationFrame(() => {\n      writeFunc(readResults);\n    });\n  });\n}\n\n/**\n * Creates a performance monitor for measuring execution time\n *\n * @param {string} label - Label for the measurement\n * @returns {Object} Monitor object with start/end methods\n *\n * @example\n * const monitor = createPerformanceMonitor('Grid Render');\n * monitor.start();\n * // ... expensive operation\n * const duration = monitor.end(); // Returns duration in ms\n */\nexport function createPerformanceMonitor(label) {\n  let startTime = null;\n\n  return {\n    start() {\n      startTime = performance.now();\n      if (typeof performance.mark === 'function') {\n        performance.mark(`${label}-start`);\n      }\n    },\n\n    end() {\n      if (startTime === null) {\n        console.warn(`Performance monitor \"${label}\" was not started`);\n        return 0;\n      }\n\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n\n      if (typeof performance.mark === 'function') {\n        performance.mark(`${label}-end`);\n        performance.measure(label, `${label}-start`, `${label}-end`);\n      }\n\n      console.log(`⏱️ ${label}: ${duration.toFixed(2)}ms`);\n      startTime = null;\n\n      return duration;\n    },\n\n    cancel() {\n      startTime = null;\n    },\n  };\n}\n\n/**\n * Idle callback wrapper with fallback for browsers that don't support it\n *\n * @param {Function} callback - Function to execute when idle\n * @param {Object} options - Configuration options\n * @param {number} options.timeout - Maximum wait time in ms\n *\n * @example\n * requestIdleCallback(() => {\n *   // Perform non-critical work during idle time\n *   preloadNextPageData();\n * }, { timeout: 2000 });\n */\nexport function requestIdleCallback(callback, options = {}) {\n  if (typeof window.requestIdleCallback === 'function') {\n    return window.requestIdleCallback(callback, options);\n  }\n\n  // Fallback for browsers without requestIdleCallback\n  const timeout = options.timeout || 1;\n  const start = Date.now();\n\n  return setTimeout(() => {\n    callback({\n      didTimeout: false,\n      timeRemaining: () => Math.max(0, 50 - (Date.now() - start)),\n    });\n  }, timeout);\n}\n\n/**\n * Cancels an idle callback\n *\n * @param {number} id - ID returned from requestIdleCallback\n */\nexport function cancelIdleCallback(id) {\n  if (typeof window.cancelIdleCallback === 'function') {\n    window.cancelIdleCallback(id);\n  } else {\n    clearTimeout(id);\n  }\n}\n","/**\n * Validation Utilities Module\n * Provides real-time validation with visual feedback for jadwal kegiatan\n * License: MIT\n */\n\n/**\n * Validation result structure\n * @typedef {Object} ValidationResult\n * @property {boolean} isValid - Whether validation passed\n * @property {string} message - Validation message\n * @property {string} level - Severity level: 'error', 'warning', 'info'\n * @property {any} value - Validated/corrected value\n */\n\n/**\n * Validates a single cell percentage value\n *\n * @param {any} value - Value to validate\n * @param {Object} options - Validation options\n * @param {number} options.min - Minimum value (default: 0)\n * @param {number} options.max - Maximum value (default: 100)\n * @param {number} options.precision - Decimal precision (default: 1)\n * @returns {ValidationResult}\n *\n * @example\n * const result = validateCellValue('95.5', { min: 0, max: 100 });\n * if (!result.isValid) {\n *   showToast(result.message, 'danger');\n * }\n */\nexport function validateCellValue(value, options = {}) {\n  const { min = 0, max = 100, precision = 1 } = options;\n\n  // Handle empty values\n  if (value === null || value === undefined || value === '') {\n    return {\n      isValid: true,\n      message: '',\n      level: 'info',\n      value: 0,\n    };\n  }\n\n  // Convert to number\n  const numValue = parseFloat(value);\n\n  // Check if it's a valid number\n  if (isNaN(numValue)) {\n    return {\n      isValid: false,\n      message: `Nilai harus berupa angka (0-${max})`,\n      level: 'error',\n      value: 0,\n    };\n  }\n\n  // Check range\n  if (numValue < min) {\n    return {\n      isValid: false,\n      message: `Nilai tidak boleh kurang dari ${min}`,\n      level: 'error',\n      value: min,\n    };\n  }\n\n  if (numValue > max) {\n    return {\n      isValid: false,\n      message: `Nilai tidak boleh lebih dari ${max}`,\n      level: 'error',\n      value: max,\n    };\n  }\n\n  // Round to precision\n  const roundedValue = Math.round(numValue * Math.pow(10, precision)) / Math.pow(10, precision);\n\n  return {\n    isValid: true,\n    message: '',\n    level: 'info',\n    value: roundedValue,\n  };\n}\n\n/**\n * Validates total progress across all weeks for a single pekerjaan\n *\n * @param {Array<number>} weeklyValues - Array of weekly percentage values\n * @param {Object} options - Validation options\n * @param {number} options.maxTotal - Maximum total (default: 100)\n * @param {number} options.tolerance - Tolerance for rounding errors (default: 0.1)\n * @returns {ValidationResult}\n *\n * @example\n * const weekValues = [20, 30, 25, 25]; // Total = 100\n * const result = validateTotalProgress(weekValues);\n * if (result.level === 'warning') {\n *   showWarningIndicator(pekerjaanId, result.message);\n * }\n */\nexport function validateTotalProgress(weeklyValues, options = {}) {\n  const { maxTotal = 100, tolerance = 0.1 } = options;\n\n  const total = weeklyValues.reduce((sum, val) => sum + (parseFloat(val) || 0), 0);\n  const roundedTotal = Math.round(total * 10) / 10;\n\n  // Perfect total\n  if (Math.abs(roundedTotal - maxTotal) < tolerance) {\n    return {\n      isValid: true,\n      message: `Total: ${roundedTotal}%`,\n      level: 'info',\n      value: roundedTotal,\n    };\n  }\n\n  // Over 100%\n  if (roundedTotal > maxTotal) {\n    return {\n      isValid: false,\n      message: `Total melebihi ${maxTotal}% (${roundedTotal}%)`,\n      level: 'error',\n      value: roundedTotal,\n    };\n  }\n\n  // Under 100%\n  if (roundedTotal < maxTotal - tolerance) {\n    return {\n      isValid: false,\n      message: `Total kurang dari ${maxTotal}% (${roundedTotal}%)`,\n      level: 'warning',\n      value: roundedTotal,\n    };\n  }\n\n  return {\n    isValid: true,\n    message: `Total: ${roundedTotal}%`,\n    level: 'info',\n    value: roundedTotal,\n  };\n}\n\n/**\n * Applies visual feedback to a cell based on validation result\n *\n * @param {HTMLElement} cellElement - Cell DOM element\n * @param {ValidationResult} validationResult - Validation result\n * @param {Object} options - Display options\n * @param {boolean} options.showTooltip - Show tooltip with message\n * @param {number} options.tooltipDuration - Duration to show tooltip (ms)\n *\n * @example\n * const cell = document.querySelector('.time-cell');\n * const result = validateCellValue(95.5);\n * applyValidationFeedback(cell, result, { showTooltip: true });\n */\nexport function applyValidationFeedback(cellElement, validationResult, options = {}) {\n  const { showTooltip = true, tooltipDuration = 3000 } = options;\n\n  // Remove existing validation classes\n  cellElement.classList.remove(\n    'validation-error',\n    'validation-warning',\n    'validation-success'\n  );\n\n  // Remove existing tooltip\n  const existingTooltip = cellElement.querySelector('.validation-tooltip');\n  if (existingTooltip) {\n    existingTooltip.remove();\n  }\n\n  // Apply new validation class\n  if (!validationResult.isValid) {\n    if (validationResult.level === 'error') {\n      cellElement.classList.add('validation-error');\n    } else if (validationResult.level === 'warning') {\n      cellElement.classList.add('validation-warning');\n    }\n\n    // Show tooltip if enabled and there's a message\n    if (showTooltip && validationResult.message) {\n      const tooltip = document.createElement('div');\n      tooltip.className = `validation-tooltip validation-tooltip-${validationResult.level}`;\n      tooltip.textContent = validationResult.message;\n\n      cellElement.style.position = 'relative';\n      cellElement.appendChild(tooltip);\n\n      // Auto-remove after duration\n      if (tooltipDuration > 0) {\n        setTimeout(() => {\n          tooltip.remove();\n        }, tooltipDuration);\n      }\n    }\n  } else {\n    cellElement.classList.add('validation-success');\n  }\n}\n\n/**\n * Updates progress indicator for a pekerjaan row\n *\n * @param {string} pekerjaanId - Pekerjaan ID\n * @param {number} totalProgress - Total progress percentage\n * @param {Object} state - Application state object\n *\n * @example\n * updateProgressIndicator('pekerjaan-123', 95.5, state);\n */\nexport function updateProgressIndicator(pekerjaanId, totalProgress, state) {\n  const row = document.querySelector(`[data-pekerjaan-id=\"${pekerjaanId}\"]`);\n  if (!row) return;\n\n  const indicator = row.querySelector('.progress-indicator') || createProgressIndicator(row);\n\n  const validationResult = validateTotalProgress([totalProgress], { maxTotal: 100 });\n\n  // Update indicator appearance\n  indicator.textContent = `${totalProgress.toFixed(1)}%`;\n  indicator.className = 'progress-indicator';\n\n  if (validationResult.level === 'error') {\n    indicator.classList.add('progress-error');\n  } else if (validationResult.level === 'warning') {\n    indicator.classList.add('progress-warning');\n  } else {\n    indicator.classList.add('progress-success');\n  }\n\n  // Update state\n  if (state && state.progressTotals) {\n    state.progressTotals.set(pekerjaanId, totalProgress);\n  }\n}\n\n/**\n * Creates a progress indicator element if it doesn't exist\n *\n * @param {HTMLElement} rowElement - Row element\n * @returns {HTMLElement} Progress indicator element\n */\nfunction createProgressIndicator(rowElement) {\n  const nameCell = rowElement.querySelector('.name-cell');\n  if (!nameCell) return null;\n\n  const indicator = document.createElement('span');\n  indicator.className = 'progress-indicator';\n  nameCell.appendChild(indicator);\n\n  return indicator;\n}\n\n/**\n * Batch validates all cells in the grid\n *\n * @param {Map} modifiedCells - Map of cell changes (cellKey -> value)\n * @param {Object} state - Application state\n * @returns {Object} Validation summary\n *\n * @example\n * const summary = batchValidateGrid(state.modifiedCells, state);\n * if (summary.errorCount > 0) {\n *   showToast(`${summary.errorCount} error(s) found`, 'danger');\n *   return false;\n * }\n */\nexport function batchValidateGrid(modifiedCells, state) {\n  const summary = {\n    totalCells: 0,\n    validCells: 0,\n    errorCount: 0,\n    warningCount: 0,\n    errors: [],\n    warnings: [],\n  };\n\n  // Group cells by pekerjaan ID for total progress validation\n  const pekerjaanGroups = new Map();\n\n  for (const [cellKey, value] of modifiedCells.entries()) {\n    const [pekerjaanId, weekId] = cellKey.split('-');\n\n    // Validate individual cell\n    const cellResult = validateCellValue(value);\n    summary.totalCells++;\n\n    if (cellResult.isValid) {\n      summary.validCells++;\n    } else {\n      if (cellResult.level === 'error') {\n        summary.errorCount++;\n        summary.errors.push({ cellKey, message: cellResult.message });\n      } else if (cellResult.level === 'warning') {\n        summary.warningCount++;\n        summary.warnings.push({ cellKey, message: cellResult.message });\n      }\n    }\n\n    // Group by pekerjaan\n    if (!pekerjaanGroups.has(pekerjaanId)) {\n      pekerjaanGroups.set(pekerjaanId, []);\n    }\n    pekerjaanGroups.get(pekerjaanId).push(cellResult.value);\n  }\n\n  // Validate total progress for each pekerjaan\n  for (const [pekerjaanId, values] of pekerjaanGroups.entries()) {\n    const totalResult = validateTotalProgress(values);\n\n    if (!totalResult.isValid) {\n      if (totalResult.level === 'error') {\n        summary.errorCount++;\n        summary.errors.push({\n          cellKey: pekerjaanId,\n          message: `Pekerjaan ${pekerjaanId}: ${totalResult.message}`,\n        });\n      } else if (totalResult.level === 'warning') {\n        summary.warningCount++;\n        summary.warnings.push({\n          cellKey: pekerjaanId,\n          message: `Pekerjaan ${pekerjaanId}: ${totalResult.message}`,\n        });\n      }\n    }\n\n    // Update visual indicator\n    updateProgressIndicator(pekerjaanId, totalResult.value, state);\n  }\n\n  return summary;\n}\n\n/**\n * Shows validation summary in a toast notification\n *\n * @param {Object} summary - Validation summary from batchValidateGrid\n * @param {Function} showToast - Toast notification function\n *\n * @example\n * const summary = batchValidateGrid(state.modifiedCells, state);\n * showValidationSummary(summary, window.showToast);\n */\nexport function showValidationSummary(summary, showToast) {\n  if (summary.errorCount > 0) {\n    const errorMessages = summary.errors.slice(0, 3).map((e) => e.message).join('<br>');\n    const more = summary.errorCount > 3 ? `<br>...dan ${summary.errorCount - 3} error lainnya` : '';\n\n    showToast(`❌ ${summary.errorCount} Error:<br>${errorMessages}${more}`, 'danger', 5000);\n    return false;\n  }\n\n  if (summary.warningCount > 0) {\n    showToast(`⚠️ ${summary.warningCount} Warning - periksa total progress`, 'warning', 4000);\n  } else {\n    showToast(`✅ Validasi sukses (${summary.totalCells} sel)`, 'success', 2000);\n  }\n\n  return true;\n}\n\n/**\n * Real-time cell validation handler (use with event delegation)\n *\n * @param {Event} event - Input event\n * @param {HTMLElement} cellElement - Cell element\n * @param {Object} state - Application state\n *\n * @example\n * eventManager.on('blur', '.time-cell input', (event, target) => {\n *   const cell = target.closest('.time-cell');\n *   handleCellValidation(event, cell, state);\n * });\n */\nexport function handleCellValidation(event, cellElement, state) {\n  const input = event.target;\n  const value = input.value;\n\n  // Validate the cell value\n  const result = validateCellValue(value);\n\n  // Apply visual feedback\n  applyValidationFeedback(cellElement, result, {\n    showTooltip: !result.isValid,\n    tooltipDuration: 3000,\n  });\n\n  // Update the value to validated/corrected value\n  if (result.isValid || result.value !== parseFloat(value)) {\n    input.value = result.value;\n\n    // Update state\n    const cellKey = cellElement.dataset.cellId;\n    if (cellKey && state.modifiedCells) {\n      state.modifiedCells.set(cellKey, result.value);\n    }\n  }\n\n  // Show toast for errors\n  if (!result.isValid && result.level === 'error') {\n    if (typeof window.showToast === 'function') {\n      window.showToast(result.message, 'danger', 3000);\n    }\n  }\n\n  return result;\n}\n","/**\n * Grid Event Handlers Module (Refactored with Event Delegation)\n * Fixes memory leaks by using event delegation pattern\n * License: MIT\n */\n\nimport { EventDelegationManager, cleanupEventListeners } from '@shared/event-delegation.js';\nimport { rafThrottle } from '@shared/performance-utils.js';\nimport { handleCellValidation } from '@shared/validation-utils.js';\n\n/**\n * Grid Event Manager\n * Manages all grid events using efficient delegation pattern\n */\nexport class GridEventManager {\n  constructor(state, helpers) {\n    this.state = state;\n    this.helpers = helpers;\n    this.eventManagers = new Map();\n    this.scrollHandlers = new Map();\n  }\n\n  /**\n   * Attaches all grid event listeners using delegation\n   */\n  attachEvents() {\n    const leftTbody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\n    const rightTbody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\n    const leftScroll = this.state.domRefs?.leftPanelScroll || document.querySelector('.left-panel-scroll');\n    const rightScroll = this.state.domRefs?.rightPanelScroll || document.querySelector('.right-panel-scroll');\n\n    if (!leftTbody || !rightTbody) {\n      console.error('Grid containers not found');\n      return false;\n    }\n\n    // Clean up any existing listeners\n    this.cleanup();\n\n    // Setup left panel events (tree toggles, expand/collapse)\n    this._setupLeftPanelEvents(leftTbody);\n\n    // Setup right panel events (cell editing)\n    this._setupRightPanelEvents(rightTbody);\n\n    // Setup scroll synchronization\n    if (leftScroll && rightScroll) {\n      this._setupScrollSync(leftScroll, rightScroll);\n    }\n\n    const topHorizontalScroll =\n      this.state.domRefs?.horizontalScrollTop || document.getElementById('right-panel-scroll-top');\n    if (topHorizontalScroll && rightScroll) {\n      this._setupHorizontalScrollSync(topHorizontalScroll, rightScroll);\n    }\n\n    return true;\n  }\n\n  /**\n   * Setup left panel event delegation\n   */\n  _setupLeftPanelEvents(container) {\n    const leftManager = new EventDelegationManager(container);\n\n    // Tree toggle clicks\n    leftManager.on('click', '.tree-toggle', (event, target) => {\n      this._handleTreeToggle(event, target);\n    });\n\n    // Row selection (optional feature)\n    leftManager.on('click', '.name-cell', (event, target) => {\n      this._handleRowSelection(event, target);\n    });\n\n    this.eventManagers.set('left-panel', leftManager);\n  }\n\n  /**\n   * Setup right panel event delegation (cell editing)\n   */\n  _setupRightPanelEvents(container) {\n    const rightManager = new EventDelegationManager(container);\n\n    // Cell click (single click - select)\n    rightManager.on('click', '.time-cell.editable', (event, target) => {\n      this._handleCellClick(event, target);\n    });\n\n    // Cell double-click (enter edit mode)\n    rightManager.on('dblclick', '.time-cell.editable', (event, target) => {\n      this._handleCellDoubleClick(event, target);\n    });\n\n    // Input events on cell inputs (with validation)\n    rightManager.on('input', '.time-cell input', (event, target) => {\n      this._handleCellInput(event, target);\n    });\n\n    // Blur events (validate and save)\n    rightManager.on('blur', '.time-cell input', (event, target) => {\n      this._handleCellBlur(event, target);\n    });\n\n    // Keydown events (Enter, Escape, Tab navigation)\n    rightManager.on('keydown', '.time-cell input', (event, target) => {\n      this._handleCellKeydown(event, target);\n    });\n\n    this.eventManagers.set('right-panel', rightManager);\n  }\n\n  /**\n   * Setup scroll synchronization with RAF throttle for performance\n   */\n  _setupScrollSync(leftScroll, rightScroll) {\n    // Throttle scroll events to 60fps using requestAnimationFrame\n    const syncLeftToRight = rafThrottle(() => {\n      rightScroll.scrollTop = leftScroll.scrollTop;\n    });\n\n    const syncRightToLeft = rafThrottle(() => {\n      leftScroll.scrollTop = rightScroll.scrollTop;\n    });\n\n    // Attach scroll listeners\n    leftScroll.addEventListener('scroll', syncLeftToRight, { passive: true });\n    rightScroll.addEventListener('scroll', syncRightToLeft, { passive: true });\n\n    // Store handlers for cleanup\n    this.scrollHandlers.set('left', { element: leftScroll, handler: syncLeftToRight });\n    this.scrollHandlers.set('right', { element: rightScroll, handler: syncRightToLeft });\n  }\n\n  _setupHorizontalScrollSync(topScroll, bottomScroll) {\n    const syncTopToBottom = rafThrottle(() => {\n      bottomScroll.scrollLeft = topScroll.scrollLeft;\n    });\n\n    const syncBottomToTop = rafThrottle(() => {\n      topScroll.scrollLeft = bottomScroll.scrollLeft;\n    });\n\n    topScroll.addEventListener('scroll', syncTopToBottom, { passive: true });\n    bottomScroll.addEventListener('scroll', syncBottomToTop, { passive: true });\n\n    this.scrollHandlers.set('horizontal-top', { element: topScroll, handler: syncTopToBottom });\n    this.scrollHandlers.set('horizontal-bottom', { element: bottomScroll, handler: syncBottomToTop });\n  }\n\n  /**\n   * Handle tree toggle click\n   */\n  _handleTreeToggle(event, toggleElement) {\n    event.stopPropagation();\n\n    const nodeId = toggleElement.dataset.nodeId;\n    const isExpanded = !toggleElement.classList.contains('collapsed');\n\n    // Update state\n    if (isExpanded) {\n      this.state.expandedNodes.delete(nodeId);\n      toggleElement.classList.add('collapsed');\n    } else {\n      this.state.expandedNodes.add(nodeId);\n      toggleElement.classList.remove('collapsed');\n    }\n\n    // Toggle child rows\n    this._toggleNodeChildren(nodeId, !isExpanded);\n\n    // Sync row heights after DOM update\n    requestAnimationFrame(() => {\n      this._syncRowHeights();\n    });\n  }\n\n  /**\n   * Toggle visibility of child rows\n   */\n  _toggleNodeChildren(nodeId, show) {\n    const leftBody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\n    const rightBody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\n\n    const selector = `[data-parent-id=\"${nodeId}\"]`;\n    const leftChildren = leftBody.querySelectorAll(selector);\n    const rightChildren = rightBody.querySelectorAll(selector);\n\n    const display = show ? '' : 'none';\n\n    leftChildren.forEach((row) => {\n      row.style.display = display;\n\n      // Recursively hide/show descendants if this node is collapsed\n      if (!show) {\n        const childId = row.dataset.nodeId;\n        if (childId) {\n          this._toggleNodeChildren(childId, false);\n        }\n      }\n    });\n\n    rightChildren.forEach((row) => {\n      row.style.display = display;\n    });\n  }\n\n  /**\n   * Handle row selection (optional feature)\n   */\n  _handleRowSelection(event, cellElement) {\n    const row = cellElement.closest('tr');\n    if (!row) return;\n\n    // Toggle selected state\n    row.classList.toggle('row-selected');\n\n    // Sync with right panel\n    const rowIndex = row.dataset.rowIndex;\n    if (rowIndex) {\n      const rightRow = document.querySelector(\n        `.right-panel-scroll tr[data-row-index=\"${rowIndex}\"]`\n      );\n      if (rightRow) {\n        rightRow.classList.toggle('row-selected');\n      }\n    }\n  }\n\n  /**\n   * Handle cell click (select cell)\n   */\n  _handleCellClick(event, cellElement) {\n    // Remove selection from other cells\n    document.querySelectorAll('.time-cell.selected').forEach((cell) => {\n      cell.classList.remove('selected');\n    });\n\n    // Select this cell\n    cellElement.classList.add('selected');\n  }\n\n  /**\n   * Handle cell double-click (enter edit mode)\n   */\n  _handleCellDoubleClick(event, cellElement) {\n    event.preventDefault();\n\n    // Check if already in edit mode\n    if (cellElement.classList.contains('editing')) {\n      return;\n    }\n\n    // Enter edit mode\n    this._enterEditMode(cellElement);\n  }\n\n  /**\n   * Enter edit mode for a cell\n   */\n  _enterEditMode(cellElement) {\n    const currentValue = cellElement.dataset.value || '0';\n\n    // Create input element\n    const input = document.createElement('input');\n    input.type = 'number';\n    input.className = 'cell-input';\n    input.value = currentValue;\n    input.min = '0';\n    input.max = '100';\n    input.step = '0.1';\n\n    // Clear cell and add input\n    cellElement.innerHTML = '';\n    cellElement.appendChild(input);\n    cellElement.classList.add('editing');\n\n    // Focus and select\n    input.focus();\n    input.select();\n  }\n\n  /**\n   * Handle cell input (real-time validation)\n   */\n  _handleCellInput(event, inputElement) {\n    const cellElement = inputElement.closest('.time-cell');\n    if (!cellElement) return;\n\n    // Real-time validation is handled on blur to avoid performance issues\n    // But we can add visual feedback for obviously invalid input\n    const value = parseFloat(inputElement.value);\n\n    if (!isNaN(value)) {\n      if (value < 0 || value > 100) {\n        cellElement.classList.add('validation-warning');\n      } else {\n        cellElement.classList.remove('validation-warning');\n      }\n    }\n  }\n\n  /**\n   * Handle cell blur (validate and save)\n   */\n  _handleCellBlur(event, inputElement) {\n    const cellElement = inputElement.closest('.time-cell');\n    if (!cellElement) return;\n\n    // Validate the input\n    const validationResult = handleCellValidation(event, cellElement, this.state);\n\n    // Exit edit mode\n    this._exitEditMode(cellElement, validationResult.value);\n\n    // Update state\n    const cellKey = cellElement.dataset.cellId;\n    if (cellKey) {\n      this.state.modifiedCells = this.state.modifiedCells || new Map();\n      this.state.modifiedCells.set(cellKey, validationResult.value);\n\n      // Mark as dirty\n      this.state.isDirty = true;\n\n      // Calculate and update total progress for this pekerjaan\n      const [pekerjaanId] = cellKey.split('-');\n      this._updatePekerjaanProgress(pekerjaanId);\n    }\n  }\n\n  /**\n   * Exit edit mode and restore cell display\n   */\n  _exitEditMode(cellElement, value) {\n    cellElement.classList.remove('editing');\n    cellElement.dataset.value = value;\n\n    // Restore display\n    const formattedValue = value === 0 ? '-' : `${value}%`;\n    cellElement.innerHTML = `<span class=\"cell-value\">${formattedValue}</span>`;\n  }\n\n  /**\n   * Handle keyboard navigation in cells\n   */\n  _handleCellKeydown(event, inputElement) {\n    const cellElement = inputElement.closest('.time-cell');\n    if (!cellElement) return;\n\n    switch (event.key) {\n      case 'Enter':\n        event.preventDefault();\n        inputElement.blur(); // Will trigger blur handler\n        this._navigateToNextCell(cellElement, 'down');\n        break;\n\n      case 'Escape':\n        event.preventDefault();\n        // Restore original value\n        const originalValue = cellElement.dataset.originalValue || '0';\n        inputElement.value = originalValue;\n        inputElement.blur();\n        break;\n\n      case 'Tab':\n        event.preventDefault();\n        inputElement.blur();\n        const direction = event.shiftKey ? 'left' : 'right';\n        this._navigateToNextCell(cellElement, direction);\n        break;\n\n      case 'ArrowUp':\n        if (event.ctrlKey) {\n          event.preventDefault();\n          inputElement.blur();\n          this._navigateToNextCell(cellElement, 'up');\n        }\n        break;\n\n      case 'ArrowDown':\n        if (event.ctrlKey) {\n          event.preventDefault();\n          inputElement.blur();\n          this._navigateToNextCell(cellElement, 'down');\n        }\n        break;\n    }\n  }\n\n  /**\n   * Navigate to next cell (keyboard navigation)\n   */\n  _navigateToNextCell(currentCell, direction) {\n    const row = currentCell.closest('tr');\n    if (!row) return;\n\n    let nextCell = null;\n\n    switch (direction) {\n      case 'right':\n        nextCell = currentCell.nextElementSibling;\n        while (nextCell && !nextCell.classList.contains('editable')) {\n          nextCell = nextCell.nextElementSibling;\n        }\n        break;\n\n      case 'left':\n        nextCell = currentCell.previousElementSibling;\n        while (nextCell && !nextCell.classList.contains('editable')) {\n          nextCell = nextCell.previousElementSibling;\n        }\n        break;\n\n      case 'down':\n        const nextRow = row.nextElementSibling;\n        if (nextRow) {\n          const cellIndex = Array.from(row.children).indexOf(currentCell);\n          nextCell = nextRow.children[cellIndex];\n        }\n        break;\n\n      case 'up':\n        const prevRow = row.previousElementSibling;\n        if (prevRow) {\n          const cellIndex = Array.from(row.children).indexOf(currentCell);\n          nextCell = prevRow.children[cellIndex];\n        }\n        break;\n    }\n\n    if (nextCell && nextCell.classList.contains('editable')) {\n      this._enterEditMode(nextCell);\n    }\n  }\n\n  /**\n   * Update total progress for a pekerjaan\n   */\n  _updatePekerjaanProgress(pekerjaanId) {\n    const modifiedCells = this.state.modifiedCells || new Map();\n    const timeColumns = this.state.timeColumns || [];\n\n    let total = 0;\n\n    timeColumns.forEach((col) => {\n      const cellKey = `${pekerjaanId}-${col.id}`;\n      const value = modifiedCells.get(cellKey) || 0;\n      total += parseFloat(value) || 0;\n    });\n\n    // Update progress indicator (if validation-utils is available)\n    if (typeof this.helpers.updateProgressIndicator === 'function') {\n      this.helpers.updateProgressIndicator(pekerjaanId, total);\n    }\n  }\n\n  /**\n   * Sync row heights between left and right panels\n   */\n  _syncRowHeights() {\n    const leftBody = this.state.domRefs?.leftTbody || document.getElementById('left-tbody');\n    const rightBody = this.state.domRefs?.rightTbody || document.getElementById('right-tbody');\n\n    if (!leftBody || !rightBody) return;\n\n    const leftRows = leftBody.querySelectorAll('tr');\n    const rightRows = rightBody.querySelectorAll('tr');\n\n    leftRows.forEach((leftRow, index) => {\n      const rightRow = rightRows[index];\n      if (!rightRow) return;\n\n      // Reset heights\n      leftRow.style.height = '';\n      rightRow.style.height = '';\n\n      // Get natural heights\n      const leftHeight = leftRow.offsetHeight;\n      const rightHeight = rightRow.offsetHeight;\n\n      // Set to max\n      const maxHeight = Math.max(leftHeight, rightHeight);\n      leftRow.style.height = `${maxHeight}px`;\n      rightRow.style.height = `${maxHeight}px`;\n    });\n  }\n\n  /**\n   * Clean up all event listeners\n   */\n  cleanup() {\n    // Clean up event delegation managers\n    for (const manager of this.eventManagers.values()) {\n      manager.destroy();\n    }\n    this.eventManagers.clear();\n\n    // Clean up scroll handlers\n    for (const { element, handler } of this.scrollHandlers.values()) {\n      if (handler.cancel) {\n        handler.cancel();\n      }\n      element.removeEventListener('scroll', handler);\n    }\n    this.scrollHandlers.clear();\n  }\n}\n\n/**\n * Factory function to create and attach grid events\n *\n * @param {Object} state - Application state\n * @param {Object} helpers - Helper functions\n * @returns {GridEventManager} Event manager instance\n *\n * @example\n * const eventManager = attachGridEvents(state, {\n *   updateProgressIndicator: (id, total) => { ... },\n *   showToast: (msg, type) => { ... },\n * });\n *\n * // Later, cleanup:\n * eventManager.cleanup();\n */\nexport function attachGridEvents(state, helpers = {}) {\n  const manager = new GridEventManager(state, helpers);\n  manager.attachEvents();\n  return manager;\n}\n","/**\n * Build column definitions for AG Grid (dynamic time columns)\n */\n\n/**\n * @param {Array} timeColumns\n * @param {Object} options\n * @returns {Array}\n */\nexport function buildColumnDefs(timeColumns = [], options = {}) {\n  const editableChecker =\n    typeof options.isEditableFn === 'function' ? options.isEditableFn : defaultEditableChecker;\n  const inputMode = (options.inputMode || 'percentage').toLowerCase();\n  const validationStateGetter =\n    typeof options.getCellValidationState === 'function' ? options.getCellValidationState : null;\n\n  const baseColumns = [\n    {\n      headerName: 'Pekerjaan',\n      field: 'name',\n      minWidth: 280,\n      flex: 1.2,\n      pinned: 'left',\n      cellRenderer: pekerjaanCellRenderer,\n      cellClass: 'ag pekerjaan-col',\n      wrapText: true,\n      autoHeight: true,\n    },\n    {\n      headerName: 'Volume',\n      field: 'volume',\n      width: 70,\n      pinned: 'left',\n      resizable: false,\n      editable: false,\n      suppressHeaderMenuButton: true,\n      cellClass: 'ag-volume-col text-end',\n      valueFormatter: (params) => formatVolume(params.value),\n    },\n    {\n      headerName: 'Satuan',\n      field: 'unit',\n      width: 70,\n      pinned: 'left',\n      resizable: false,\n      editable: false,\n      suppressHeaderMenuButton: true,\n      cellClass: 'ag-unit-col text-center',\n    },\n  ];\n\n  const dynamicColumns = (timeColumns || []).map((column) => {\n    const field = column.fieldId || column.id || 'periode';\n    const headerTitle = column.label || column.id || 'Periode';\n    const rangeText =\n      column.rangeText ||\n      (column.rangeLabel ? column.rangeLabel.replace(/[()]/g, '').trim() : '');\n    const headerName = rangeText ? `${headerTitle}\\n${rangeText}` : headerTitle;\n    const getCellKey = (params) => {\n      const rowId =\n        params?.data?.raw?.id ||\n        params?.data?.id ||\n        params?.node?.data?.raw?.id ||\n        params?.node?.data?.id;\n      if (!rowId) {\n        return null;\n      }\n      return `${rowId}-${field}`;\n    };\n\n    const cellClassRules = {\n      'ag-cell-readonly': (params) => !editableChecker(params),\n    };\n\n    if (validationStateGetter) {\n      cellClassRules['ag-cell-invalid'] = (params) => {\n        const cellKey = getCellKey(params);\n        return cellKey ? validationStateGetter(cellKey) === 'error' : false;\n      };\n      cellClassRules['ag-cell-warning'] = (params) => {\n        const cellKey = getCellKey(params);\n        return cellKey ? validationStateGetter(cellKey) === 'warning' : false;\n      };\n    }\n\n    return {\n      headerName,\n      field,\n      minWidth: 100,\n      flex: 1,\n      type: 'numericColumn',\n      cellDataType: 'number',\n      editable: (params) => editableChecker(params),\n      cellEditor: 'agNumberCellEditor',\n      valueParser: (params) => parseNumericValue(params.newValue),\n      cellClass: 'ag-time-col',\n      cellClassRules,\n      headerClass: 'ag-time-header',\n      valueFormatter: (params) => formatTimeCellValue(params.value, inputMode),\n    };\n  });\n\n  return baseColumns.concat(dynamicColumns);\n}\n\nfunction pekerjaanCellRenderer(params) {\n  const value = params.value || '';\n  const level = params.data?.level || 0;\n  const wrapper = document.createElement('div');\n  wrapper.className = 'ag-pekerjaan-label';\n  wrapper.style.paddingLeft = `${level * 16}px`;\n  wrapper.textContent = value;\n  return wrapper;\n}\n\nfunction formatVolume(value) {\n  if (value === null || typeof value === 'undefined' || value === '') {\n    return '-';\n  }\n  const numericValue = Number(value);\n  if (Number.isNaN(numericValue)) {\n    return value;\n  }\n  return numericValue.toLocaleString('id-ID', {\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 2,\n  });\n}\n\nfunction defaultEditableChecker(params) {\n  const rowType = params?.data?.rowType || params?.data?.raw?.type;\n  return rowType === 'pekerjaan';\n}\n\nfunction formatTimeCellValue(value, mode = 'percentage') {\n  if (value === null || typeof value === 'undefined' || value === '') {\n    return '-';\n  }\n\n  if (mode === 'volume') {\n    const numericValue = Number(value);\n    if (Number.isNaN(numericValue)) {\n      return value;\n    }\n    return numericValue.toLocaleString('id-ID', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 3,\n    });\n  }\n\n  if (mode === 'cost') {\n    const numericValue = Number(value);\n    if (Number.isNaN(numericValue)) {\n      return value;\n    }\n    return numericValue.toLocaleString('id-ID', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n      style: 'currency',\n      currency: 'IDR',\n    });\n  }\n\n  return `${value}`;\n}\n\nfunction parseNumericValue(rawValue) {\n  if (rawValue === null || typeof rawValue === 'undefined' || rawValue === '') {\n    return null;\n  }\n\n  if (typeof rawValue === 'number') {\n    return Number.isFinite(rawValue) ? rawValue : null;\n  }\n\n  const parsed = parseFloat(rawValue);\n  return Number.isFinite(parsed) ? parsed : null;\n}\n","import { createGrid } from 'ag-grid-community';\nimport { buildColumnDefs } from './column-definitions.js';\nimport { validateCellValue } from '@modules/shared/validation-utils.js';\n\n/**\n * AGGridManager\n * Membungkus inisialisasi AG Grid agar mudah diintegrasikan bertahap\n */\nexport class AGGridManager {\n  constructor(state, helpers = {}) {\n    this.state = state;\n    this.helpers = helpers;\n    this.gridApi = null;\n    this.columnApi = null;\n    this.gridOptions = null;\n    this.container = null;\n    this.currentColumns = [];\n    this.themeObserver = null;\n    this.inputMode = (state?.inputMode || 'percentage').toLowerCase();\n    this.topScroll = null;\n    this.topScrollInner = null;\n    this.bottomHorizontalViewport = null;\n    this.horizontalScrollHandlers = [];\n    this._isSyncingHorizontalScroll = false;\n  }\n\n  mount(containerElement) {\n    if (!containerElement) {\n      console.warn('[AGGridManager] Container not provided');\n      return;\n    }\n\n    this.container = containerElement;\n    this.gridOptions = this._createGridOptions();\n\n    this.gridApi = createGrid(containerElement, this.gridOptions);\n    if (typeof this.gridApi.getColumnApi === 'function') {\n      this.columnApi = this.gridApi.getColumnApi();\n    }\n\n    containerElement.classList.add('ag-grid-initialized');\n    this._applyThemeClass();\n    this._setupThemeWatcher();\n    this._setupHorizontalScrollProxy();\n    this._updateTopScrollWidth();\n  }\n\n  updateData({ tree = [], timeColumns = [], inputMode, timeScale } = {}) {\n    if (!this.gridApi) {\n      return;\n    }\n\n    if (typeof inputMode === 'string') {\n      this.inputMode = inputMode.toLowerCase();\n    }\n\n    if (typeof timeScale === 'string') {\n      this.state.timeScale = timeScale.toLowerCase();\n    }\n\n    const columnDefs = buildColumnDefs(timeColumns, this._getColumnOptions());\n    this.currentColumns = timeColumns;\n\n    this.gridApi.setGridOption('columnDefs', columnDefs);\n    const rowData = this._buildRowData(tree, timeColumns);\n    this.gridApi.setGridOption('rowData', rowData);\n    this._updateTopScrollWidth();\n  }\n\n  destroy() {\n    if (this.gridApi) {\n      this.gridApi.destroy();\n      this.gridApi = null;\n      this.columnApi = null;\n    }\n    if (this.themeObserver) {\n      this.themeObserver.disconnect();\n      this.themeObserver = null;\n    }\n    this._teardownHorizontalScrollProxy();\n  }\n\n  _createGridOptions() {\n    return {\n      columnDefs: buildColumnDefs([], this._getColumnOptions()),\n      rowData: [],\n      animateRows: true,\n      suppressAggFuncInHeader: true,\n      rowHeight: 60,\n      headerHeight: 44,\n      defaultColDef: {\n        resizable: true,\n        sortable: false,\n        flex: 1,\n        minWidth: 120,\n      },\n      rowClassRules: {\n        'row-has-error': (params) => this._isFailedRow(params?.data),\n        'row-has-warning': (params) => this._isWarningRow(params?.data),\n        'row-save-error': (params) => this._hasSaveError(params?.data),\n      },\n      onCellValueChanged: (event) => this._handleCellValueChanged(event),\n    };\n  }\n\n  _buildRowData(tree = [], timeColumns = []) {\n    const rows = [];\n    const safeColumns = timeColumns || [];\n\n    const normalizeNodes = (nodes) => {\n      if (Array.isArray(nodes)) {\n        return nodes;\n      }\n      if (nodes && typeof nodes === 'object') {\n        return Object.values(nodes).filter(Boolean);\n      }\n      return [];\n    };\n\n    const getChildren = (node) => {\n      if (!node || typeof node !== 'object') {\n        return [];\n      }\n      const candidates = ['children', 'sub', 'pekerjaan', 'items', 'nodes'];\n      for (const key of candidates) {\n        if (Array.isArray(node[key]) && node[key].length > 0) {\n          return node[key];\n        }\n      }\n      return [];\n    };\n\n    const walk = (nodes, parentPath = [], depth = 0) => {\n      const iterable = normalizeNodes(nodes);\n      if (!iterable.length) {\n        return;\n      }\n\n      iterable.forEach((node, index) => {\n        if (!node) return;\n\n        const label =\n          node.snapshot_uraian ||\n          node.uraian ||\n          node.nama ||\n          node.name ||\n          `Node ${parentPath.length + index + 1}`;\n\n        const kode = node.snapshot_kode || node.kode || node.code || '';\n        const rowPath = parentPath.concat(label);\n\n        const rowType =\n          node.type ||\n          node.rowType ||\n          (node.children && node.children.length > 0 ? 'klasifikasi' : 'pekerjaan');\n\n        const rowId = node.id || node.pekerjaan_id || `node-${rowPath.join('-')}`;\n\n        const rowClasses = [];\n        if (rowType) {\n          rowClasses.push(`row-${rowType}`);\n        }\n\n        const row = {\n          id: rowId,\n          name: label,\n          code: kode,\n          path: rowPath,\n          level: depth,\n          raw: node,\n          rowType,\n          isEditable: rowType === 'pekerjaan',\n          rowClass: rowClasses.join(' '),\n          unit:\n            node.snapshot_satuan ||\n            node.satuan ||\n            node.unit ||\n            node.snapshot_unit ||\n            '',\n          volume: this._resolveVolumeValue(node),\n        };\n\n        const isCostMode = this.inputMode === 'cost';\n        if (safeColumns.length > 0) {\n          safeColumns.forEach((col) => {\n            const columnField = col.fieldId || col.id;\n            if (!columnField) {\n              return;\n            }\n\n            let value = null;\n            if (Array.isArray(col.childColumns) && col.childColumns.length > 0) {\n              value = col.childColumns.reduce((sum, child) => {\n                const childField = child.fieldId || child.id;\n                const childValue = isCostMode\n                  ? this._fetchCostValue(rowId, childField)\n                  : this._fetchAssignmentValue(rowId, childField);\n                return sum + (Number(childValue) || 0);\n              }, 0);\n            } else {\n              const assignmentMap =\n                node.assignments ||\n                node.assignment_map ||\n                node.assignmentMap ||\n                node[columnField];\n\n              if (assignmentMap && typeof assignmentMap === 'object') {\n                const directValue =\n                  assignmentMap[col.id] ??\n                  assignmentMap[col.fieldId] ??\n                  assignmentMap[col.label];\n                value = this._normalizeCellValue(directValue);\n              } else if (typeof node[columnField] !== 'undefined') {\n                value = this._normalizeCellValue(node[columnField]);\n              }\n\n              if ((value === null || typeof value === 'undefined')) {\n                value = isCostMode\n                  ? this._fetchCostValue(rowId, columnField)\n                  : this._fetchAssignmentValue(rowId, columnField);\n              }\n            }\n\n            let displayValue = value;\n            if (isCostMode) {\n              displayValue = Number.isFinite(Number(value)) ? Number(value) : null;\n            } else if (this.inputMode === 'volume' && value !== null && value !== undefined) {\n              displayValue = this._percentToVolume(displayValue, row.volume);\n            }\n\n            row[columnField] = displayValue;\n          });\n        }\n\n        rows.push(row);\n\n        const childNodes = getChildren(node);\n        if (childNodes.length > 0) {\n          walk(childNodes, rowPath, depth + 1);\n        }\n      });\n    };\n\n    walk(tree, []);\n    if (typeof console !== 'undefined') {\n      console.log(\n        '[AGGridManager] updateData',\n        rows.length,\n        'rows,',\n        safeColumns.length + 2,\n        'columns'\n      );\n    }\n    return rows;\n  }\n\n  _handleCellValueChanged(event) {\n    const colDef = event?.colDef;\n    const field = colDef?.field;\n    if (!field) {\n      return;\n    }\n\n    const rowData = event?.data;\n    const pekerjaanId = rowData?.raw?.id || rowData?.id;\n    if (!pekerjaanId) {\n      return;\n    }\n\n    if (this.state?.displayScale && this.state.displayScale !== 'weekly') {\n      if (typeof this.helpers.showToast === 'function') {\n        this.helpers.showToast('Pengeditan hanya tersedia pada mode weekly', 'warning');\n      }\n      if (event.node) {\n        event.node.setDataValue(field, event.oldValue);\n      }\n      return;\n    }\n\n    if (!this._isCellEditable(rowData)) {\n      if (typeof this.helpers.showToast === 'function') {\n        this.helpers.showToast('Progress hanya dapat diisi pada baris pekerjaan', 'warning');\n      }\n      if (event.node) {\n        event.node.setDataValue(field, event.oldValue);\n      }\n      return;\n    }\n\n    const inputMode = this.inputMode || 'percentage';\n    const isVolumeMode = inputMode === 'volume';\n    const isCostMode = inputMode === 'cost';\n    const rowVolume = Number(rowData?.volume) || 0;\n    let validation;\n\n    if (isCostMode) {\n      validation = this._validateCostValue(event.newValue);\n      if (!validation.isValid && validation.message && typeof this.helpers.showToast === 'function') {\n        this.helpers.showToast(validation.message, 'danger');\n      }\n    } else {\n      validation = validateCellValue(event.newValue, {\n        min: 0,\n        max: isVolumeMode ? (rowVolume || 0) : 100,\n        precision: isVolumeMode ? 3 : 1,\n      });\n      if (!validation.isValid && validation.message && typeof this.helpers.showToast === 'function') {\n        const toastType = validation.level === 'error' ? 'danger' : 'warning';\n        this.helpers.showToast(validation.message, toastType);\n      }\n    }\n\n    let displayValue = validation.value ?? 0;\n    let canonicalValue = displayValue;\n\n    if (isVolumeMode) {\n      canonicalValue = this._volumeToPercent(displayValue, rowVolume);\n    } else if (isCostMode) {\n      canonicalValue = Number.isFinite(displayValue) ? Number(displayValue) : 0;\n    }\n\n    canonicalValue = Number.isFinite(canonicalValue) ? Number(canonicalValue.toFixed(2)) : 0;\n\n    if (event.node) {\n      event.node.setDataValue(field, displayValue);\n    }\n\n    const columnMeta =\n      (this.currentColumns || []).find((col) => (col.fieldId || col.id) === field) || null;\n\n    const cellKey = `${pekerjaanId}-${field}`;\n    if (typeof this.helpers.onCellChange === 'function') {\n      this.helpers.onCellChange({\n        cellKey,\n        value: canonicalValue,\n        pekerjaanId,\n        columnId: field,\n        columnMeta,\n        displayValue,\n        rowVolume,\n        isVolumeMode,\n        valueType: isCostMode ? 'cost' : (isVolumeMode ? 'volume' : 'percentage'),\n        validation,\n      });\n    }\n  }\n\n  _resolveVolumeValue(node) {\n    const nodeId = node?.id || node?.pekerjaan_id;\n    const volumeMap = this.state?.volumeMap;\n    if (volumeMap instanceof Map && nodeId && volumeMap.has(nodeId)) {\n      return volumeMap.get(nodeId);\n    }\n    if (volumeMap && typeof volumeMap === 'object' && nodeId && volumeMap[nodeId]) {\n      return volumeMap[nodeId];\n    }\n    return (\n      node.volume ||\n      node.qty ||\n      node.jumlah ||\n      node.volume_total ||\n      node.total_volume ||\n      ''\n    );\n  }\n\n  updateTopScrollMetrics() {\n    this._updateTopScrollWidth();\n  }\n\n  _fetchAssignmentValue(pekerjaanId, columnField) {\n    if (!pekerjaanId || !columnField || !this.state?.assignmentMap) {\n      return null;\n    }\n\n    const cellKey = `${pekerjaanId}-${columnField}`;\n    const assignmentMap = this.state.assignmentMap;\n\n    if (assignmentMap instanceof Map) {\n      if (assignmentMap.has(cellKey)) {\n        return this._normalizeCellValue(assignmentMap.get(cellKey));\n      }\n      return null;\n    }\n\n    if (typeof assignmentMap === 'object' && assignmentMap !== null) {\n      if (Object.prototype.hasOwnProperty.call(assignmentMap, cellKey)) {\n        return this._normalizeCellValue(assignmentMap[cellKey]);\n      }\n    }\n\n    return null;\n  }\n\n  _fetchCostValue(pekerjaanId, columnField) {\n    if (!pekerjaanId || !columnField) {\n      return null;\n    }\n\n    const cellKey = `${pekerjaanId}-${columnField}`;\n    const modifiedCosts = this.state?.costModifiedCells;\n    if (modifiedCosts instanceof Map && modifiedCosts.has(cellKey)) {\n      return this._normalizeCellValue(modifiedCosts.get(cellKey));\n    }\n\n    const costMap = this.state?.costAssignmentMap;\n    if (costMap instanceof Map) {\n      if (costMap.has(cellKey)) {\n        return this._normalizeCellValue(costMap.get(cellKey));\n      }\n    } else if (costMap && typeof costMap === 'object') {\n      if (Object.prototype.hasOwnProperty.call(costMap, cellKey)) {\n        return this._normalizeCellValue(costMap[cellKey]);\n      }\n    }\n    return null;\n  }\n\n  _percentToVolume(percent, totalVolume) {\n    const numericPercent = Number(percent);\n    const numericVolume = Number(totalVolume);\n    if (!Number.isFinite(numericPercent) || !Number.isFinite(numericVolume)) {\n      return percent;\n    }\n    return (numericPercent / 100) * numericVolume;\n  }\n\n  _volumeToPercent(volumeValue, totalVolume) {\n    const numericVolume = Number(volumeValue);\n    const numericTotal = Number(totalVolume);\n    if (!Number.isFinite(numericVolume) || numericVolume < 0) {\n      return 0;\n    }\n    if (!Number.isFinite(numericTotal) || numericTotal <= 0) {\n      return 0;\n    }\n    const percent = (numericVolume / numericTotal) * 100;\n    return Math.min(100, Math.max(0, percent));\n  }\n\n  _validateCostValue(rawValue) {\n    if (rawValue === null || typeof rawValue === 'undefined' || rawValue === '') {\n      return {\n        isValid: true,\n        message: '',\n        value: 0,\n      };\n    }\n\n    const numeric = Number(rawValue);\n    if (!Number.isFinite(numeric)) {\n      return {\n        isValid: false,\n        message: 'Biaya aktual harus berupa angka',\n        value: 0,\n      };\n    }\n\n    if (numeric < 0) {\n      return {\n        isValid: false,\n        message: 'Biaya aktual minimal 0',\n        value: 0,\n      };\n    }\n\n    return {\n      isValid: true,\n      message: '',\n      value: Number(numeric.toFixed(2)),\n    };\n  }\n\n  _applyThemeClass() {\n    if (!this.container) {\n      return;\n    }\n    const theme = document.documentElement?.getAttribute('data-bs-theme') || 'light';\n    const isDark = theme.toLowerCase() === 'dark';\n    this.container.classList.remove('ag-theme-alpine', 'ag-theme-alpine-dark');\n    this.container.classList.add(isDark ? 'ag-theme-alpine-dark' : 'ag-theme-alpine');\n  }\n\n  setInputMode(mode) {\n    if (!mode) {\n      return;\n    }\n    const normalized = mode.toLowerCase();\n    if (this.inputMode === normalized) {\n      return;\n    }\n    this.inputMode = normalized;\n    if (this.gridApi) {\n      const columnDefs = buildColumnDefs(this.currentColumns, this._getColumnOptions());\n      this.gridApi.setGridOption('columnDefs', columnDefs);\n      this.gridApi.refreshCells({ force: true });\n    }\n  }\n\n  _getColumnOptions() {\n    return {\n      inputMode: this.inputMode || 'percentage',\n      isEditableFn: (params) => this._isCellEditable(params?.data || params),\n      getCellValidationState: (cellKey) =>\n        typeof this.helpers?.getCellValidationState === 'function'\n          ? this.helpers.getCellValidationState(cellKey)\n          : null,\n    };\n  }\n\n  _isCellEditable(target) {\n    if (!target) {\n      return false;\n    }\n    if (this.state?.displayScale && this.state.displayScale !== 'weekly') {\n      return false;\n    }\n    const rowData = target.data || target;\n    const rowType = rowData?.rowType || rowData?.raw?.type;\n    return rowType === 'pekerjaan';\n  }\n\n  _normalizeCellValue(value) {\n    if (value === null || typeof value === 'undefined' || value === '') {\n      return null;\n    }\n    if (typeof value === 'number') {\n      return Number.isFinite(value) ? value : null;\n    }\n    if (typeof value === 'string') {\n      const trimmed = value.trim();\n      if (trimmed === '') {\n        return null;\n      }\n      const parsed = parseFloat(trimmed.replace(',', '.'));\n      return Number.isFinite(parsed) ? parsed : null;\n    }\n    return null;\n  }\n\n  _setupHorizontalScrollProxy() {\n    const topScroll = document.getElementById('ag-grid-scroll-top');\n    const topInner = document.getElementById('ag-grid-scroll-inner');\n    if (!topScroll || !topInner) {\n      return;\n    }\n\n    const bottomViewport =\n      this.container?.querySelector('.ag-body-horizontal-scroll-viewport') ||\n      this.container?.querySelector('.ag-center-cols-viewport');\n    if (!bottomViewport) {\n      return;\n    }\n\n    this.topScroll = topScroll;\n    this.topScrollInner = topInner;\n    this.bottomHorizontalViewport = bottomViewport;\n\n    const syncTop = () => {\n      if (this._isSyncingHorizontalScroll) return;\n      this._isSyncingHorizontalScroll = true;\n      bottomViewport.scrollLeft = topScroll.scrollLeft;\n      this._isSyncingHorizontalScroll = false;\n    };\n\n    const syncBottom = () => {\n      if (this._isSyncingHorizontalScroll) return;\n      this._isSyncingHorizontalScroll = true;\n      topScroll.scrollLeft = bottomViewport.scrollLeft;\n      this._isSyncingHorizontalScroll = false;\n    };\n\n    topScroll.addEventListener('scroll', syncTop, { passive: true });\n    bottomViewport.addEventListener('scroll', syncBottom, { passive: true });\n    this.horizontalScrollHandlers.push({ element: topScroll, handler: syncTop });\n    this.horizontalScrollHandlers.push({ element: bottomViewport, handler: syncBottom });\n    setTimeout(() => this._updateTopScrollWidth(), 0);\n  }\n\n  _teardownHorizontalScrollProxy() {\n    this.horizontalScrollHandlers.forEach(({ element, handler }) => {\n      element.removeEventListener('scroll', handler);\n    });\n    this.horizontalScrollHandlers = [];\n    this.topScroll = null;\n    this.topScrollInner = null;\n    this.bottomHorizontalViewport = null;\n  }\n\n  _updateTopScrollWidth() {\n    if (!this.topScrollInner || !this.container) {\n      return;\n    }\n    const centerContainer = this.container.querySelector('.ag-center-cols-container');\n    if (!centerContainer) {\n      return;\n    }\n    const width = centerContainer.scrollWidth;\n    if (width > 0) {\n      this.topScrollInner.style.width = `${width}px`;\n    }\n  }\n\n  refreshRowStyles() {\n    if (this.gridApi) {\n      this.gridApi.refreshCells({ force: true });\n    }\n  }\n\n  refreshCells(options = {}) {\n    if (this.gridApi) {\n      this.gridApi.refreshCells({ force: true, ...options });\n    }\n  }\n\n  _setupThemeWatcher() {\n    if (this.themeObserver || typeof MutationObserver === 'undefined') {\n      return;\n    }\n    this.themeObserver = new MutationObserver((mutations) => {\n      mutations.forEach((mutation) => {\n        if (\n          mutation.type === 'attributes' &&\n          mutation.attributeName === 'data-bs-theme'\n        ) {\n          this._applyThemeClass();\n        }\n      });\n    });\n    this.themeObserver.observe(document.documentElement, {\n      attributes: true,\n      attributeFilter: ['data-bs-theme'],\n    });\n  }\n\n  _resolveRowId(rowData) {\n    if (!rowData) {\n      return null;\n    }\n    const raw = rowData.raw || rowData;\n    const candidate =\n      raw?.id ??\n      raw?.pekerjaan_id ??\n      rowData.id ??\n      rowData.pekerjaan_id ??\n      null;\n    if (candidate === null || typeof candidate === 'undefined') {\n      return null;\n    }\n    const numeric = Number(candidate);\n    return Number.isFinite(numeric) ? numeric : candidate;\n  }\n\n  _setHasFlag(setRef, rowId) {\n    if (rowId === null || typeof rowId === 'undefined' || !(setRef instanceof Set)) {\n      return false;\n    }\n    const numeric = Number(rowId);\n    const normalized = Number.isFinite(numeric) ? numeric : rowId;\n    return setRef.has(normalized);\n  }\n\n  _isFailedRow(rowData) {\n    const rowId = this._resolveRowId(rowData);\n    return this._setHasFlag(this.state?.failedRows, rowId);\n  }\n\n  _isWarningRow(rowData) {\n    const rowId = this._resolveRowId(rowData);\n    return this._setHasFlag(this.state?.validationWarningRows, rowId);\n  }\n\n  _hasSaveError(rowData) {\n    const rowId = this._resolveRowId(rowData);\n    return this._setHasFlag(this.state?.saveErrorRows, rowId);\n  }\n}\n","/**\n * GridRenderer - Modern ES6 Grid Rendering Engine\n * Handles dual-panel grid rendering (left tree structure + right time cells)\n *\n * Migrated from: jadwal_pekerjaan/kelola_tahapan/grid_module.js\n * Date: 2025-11-19\n *\n * ARCHITECTURE:\n * - ES6 class with clean method organization\n * - No global dependencies\n * - Returns HTML strings (DOM insertion handled externally)\n * - Event delegation ready (no individual listeners)\n * - Comprehensive logging with [GridRenderer] prefix\n *\n * RESPONSIBILITIES:\n * - Render left panel (tree structure with volume info)\n * - Render right panel (time cells with progress)\n * - Render time column headers\n * - Render progress chips and validation indicators\n * - Calculate row progress totals\n * - Provide tree expand/collapse logic\n * - Sync row heights between panels\n *\n * DOES NOT HANDLE (Phase 2C):\n * - Event listeners (grid-event-handlers.js)\n * - Cell editing (grid-cell-editor.js)\n * - Save operations (grid-save-handler.js)\n */\n\n// =========================================================================\n// UTILITY FUNCTIONS\n// =========================================================================\n\n/**\n * Escape HTML special characters to prevent XSS\n * @param {string} text - Text to escape\n * @returns {string} Escaped HTML\n */\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text || '';\n  return div.innerHTML;\n}\n\n/**\n * Format number with Indonesian locale\n * @param {number} num - Number to format\n * @param {number} decimals - Decimal places\n * @returns {string} Formatted number\n */\nfunction formatNumber(num, decimals = 2) {\n  if (num === null || num === undefined || num === '') return '-';\n  const n = parseFloat(num);\n  if (Number.isNaN(n)) return '-';\n  return n.toLocaleString('id-ID', {\n    minimumFractionDigits: decimals,\n    maximumFractionDigits: decimals,\n  });\n}\n\n// =========================================================================\n// GRID RENDERER CLASS\n// =========================================================================\n\n/**\n * GridRenderer - Main rendering engine for dual-panel grid\n *\n * @example\n * const renderer = new GridRenderer(state, {\n *   escapeHtml: customEscape,\n *   formatNumber: customFormat\n * });\n *\n * const { leftHTML, rightHTML } = renderer.renderTables();\n */\nexport class GridRenderer {\n  /**\n   * Create a new GridRenderer instance\n   * @param {Object} state - Application state\n   * @param {Array} state.pekerjaanTree - Hierarchical tree of pekerjaan\n   * @param {Array} state.timeColumns - Time column definitions\n   * @param {Map} state.volumeMap - Volume per pekerjaan (nodeId -> volume)\n   * @param {Map} state.assignmentMap - Saved progress values (cellKey -> percentage)\n   * @param {Map} state.modifiedCells - Modified but unsaved values (cellKey -> percentage)\n   * @param {Set} state.expandedNodes - IDs of expanded tree nodes\n   * @param {Set} state.volumeResetJobs - IDs of pekerjaan needing volume update\n   * @param {string} state.displayMode - Display mode ('percentage' | 'volume')\n   * @param {Array} state.flatPekerjaan - Flattened pekerjaan list\n   * @param {Object} options - Configuration options\n   * @param {Function} options.escapeHtml - Custom HTML escape function\n   * @param {Function} options.formatNumber - Custom number formatter\n   */\n  constructor(state, options = {}) {\n    if (!state) {\n      throw new Error('[GridRenderer] State is required');\n    }\n\n    this.state = state;\n    this.options = options;\n\n    // Utilities with fallback defaults\n    this.escapeHtml = options.escapeHtml || escapeHtml;\n    this.formatNumber = options.formatNumber || formatNumber;\n\n    console.log('[GridRenderer] Initialized');\n  }\n\n  _getDisplayColumns() {\n    if (Array.isArray(this.state?.activeTimeColumns) && this.state.activeTimeColumns.length > 0) {\n      return this.state.activeTimeColumns;\n    }\n\n    if (Array.isArray(this.state?.timeColumns)) {\n      return this.state.timeColumns;\n    }\n\n    return [];\n  }\n\n  _isCostMode() {\n    return (this.state?.displayMode || '').toLowerCase() === 'cost';\n  }\n\n  _formatDisplayValue(nodeId, percentValue, referenceValue = percentValue) {\n    const displayMode = (this.state?.displayMode || 'percentage').toLowerCase();\n    const numericValue = Number(percentValue);\n    const numericReference = Number(referenceValue);\n    const shouldDisplay = displayMode === 'cost'\n      ? Number.isFinite(numericValue) || Number.isFinite(numericReference)\n      : ( (numericValue > 0 && Number.isFinite(numericValue)) ||\n        (numericValue === 0 && Number.isFinite(numericReference) && numericReference > 0));\n    if (!shouldDisplay) {\n      return '';\n    }\n\n    if (displayMode === 'volume') {\n      const volumeMap = this.state?.volumeMap;\n      let totalVolume = 0;\n      if (volumeMap instanceof Map && volumeMap.has(nodeId)) {\n        totalVolume = Number(volumeMap.get(nodeId)) || 0;\n      } else if (volumeMap && typeof volumeMap === 'object' && volumeMap[nodeId]) {\n        totalVolume = Number(volumeMap[nodeId]) || 0;\n      }\n      if (!Number.isFinite(totalVolume) || totalVolume <= 0) {\n        return `<span class=\"cell-value percentage\">${numericValue.toFixed(1)}</span>`;\n      }\n      const volValue = ((numericValue / 100) * totalVolume).toFixed(2);\n      return `<span class=\"cell-value volume\">${volValue}</span>`;\n    }\n\n    if (displayMode === 'cost') {\n      const formatted = Number.isFinite(numericValue)\n        ? Number(numericValue).toLocaleString('id-ID', {\n            style: 'currency',\n            currency: 'IDR',\n            minimumFractionDigits: 0,\n            maximumFractionDigits: 0,\n          })\n        : '-';\n      return `<span class=\"cell-value cost\">${formatted}</span>`;\n    }\n\n    return `<span class=\"cell-value percentage\">${numericValue.toFixed(1)}</span>`;\n  }\n\n  // =======================================================================\n  // MAIN RENDERING\n  // =======================================================================\n\n  /**\n   * Render both left and right tables\n   * Main entry point for grid rendering.\n   *\n   * @returns {Object|null} { leftHTML: string, rightHTML: string } or null if invalid state\n   */\n  renderTables() {\n    if (!this.state || !Array.isArray(this.state.pekerjaanTree)) {\n      console.warn('[GridRenderer] Invalid state or missing pekerjaanTree');\n      return null;\n    }\n\n    console.log(`[GridRenderer] Rendering tables for ${this.state.pekerjaanTree.length} root nodes`);\n\n    const leftRows = [];\n    const rightRows = [];\n\n    // Recursively render each root node\n    this.state.pekerjaanTree.forEach((node) => {\n      this._renderLeftRow(node, leftRows, true, null);\n      this._renderRightRow(node, rightRows, true, null);\n    });\n\n    const leftHTML = leftRows.join('');\n    const rightHTML = rightRows.join('');\n\n    console.log(`[GridRenderer] ✅ Rendered ${leftRows.length} rows`);\n\n    return { leftHTML, rightHTML };\n  }\n\n  // =======================================================================\n  // LEFT PANEL RENDERING (Tree Structure)\n  // =======================================================================\n\n  /**\n   * Render a single row in the left panel (tree structure)\n   * Recursively renders children if node is expanded.\n   *\n   * @param {Object} node - Tree node\n   * @param {Array} leftRows - Accumulator for HTML rows\n   * @param {boolean} parentVisible - Whether parent is visible\n   * @private\n   */\n  _renderLeftRow(node, leftRows, parentVisible = true, parentId = null) {\n    const isExpanded = this._isNodeExpanded(node.id);\n    const isVisible = parentVisible;\n    const needsVolumeReset = (\n      node.type === 'pekerjaan' &&\n      this.state.volumeResetJobs instanceof Set &&\n      this.state.volumeResetJobs.has(node.id)\n    );\n\n    // Build row classes\n    const rowClasses = [`row-${node.type}`];\n    if (!isVisible) rowClasses.push('row-hidden');\n    if (needsVolumeReset) rowClasses.push('volume-warning');\n    const rowClass = rowClasses.join(' ').trim();\n\n    // Build level class for indentation\n    const levelClass = `level-${node.level}`;\n\n    // Tree toggle icon (only for parent nodes)\n    let toggleIcon = '';\n    if (node.children && node.children.length > 0) {\n      const toggleClass = isExpanded ? '' : 'collapsed';\n      toggleIcon = `<span class=\"tree-toggle ${toggleClass}\" data-node-id=\"${node.id}\">\n        <i class=\"bi bi-caret-down-fill\"></i>\n      </span>`;\n    }\n\n    // Volume display (only for pekerjaan nodes)\n    const volumeValue = (this.state.volumeMap && this.state.volumeMap.has(node.id))\n      ? this.state.volumeMap.get(node.id)\n      : 0;\n    const volume = node.type === 'pekerjaan'\n      ? this.formatNumber(volumeValue)\n      : '';\n\n    // Satuan display\n    const satuan = node.type === 'pekerjaan'\n      ? this.escapeHtml(node.satuan)\n      : '';\n\n    // Progress chip (only for pekerjaan nodes)\n    const progressChip = node.type === 'pekerjaan'\n      ? this._renderProgressChip(node.id)\n      : '';\n\n    // Render row\n    leftRows.push(`\n      <tr class=\"${rowClass}\" data-node-id=\"${node.id}\" data-parent-id=\"${parentId ?? ''}\" data-row-index=\"${leftRows.length}\">\n        <td class=\"col-uraian ${levelClass}\">\n          <div class=\"tree-node\">\n            <div class=\"tree-node-body\">\n              ${needsVolumeReset ? '<div class=\"tree-node-meta\"><span class=\"kt-volume-pill\">Perlu update volume</span></div>' : ''}\n              <div class=\"tree-node-title\">\n                <span class=\"tree-node-label\">${this.escapeHtml(node.nama)}</span>\n                ${progressChip}\n              </div>\n            </div>\n          </div>\n        </td>\n        <td class=\"col-volume text-right\">${volume}</td>\n        <td class=\"col-satuan\">${satuan}</td>\n      </tr>\n    `);\n\n    // Recursively render children\n    if (node.children && node.children.length > 0) {\n      node.children.forEach((child) => {\n        this._renderLeftRow(child, leftRows, isExpanded && isVisible, node.id);\n      });\n    }\n  }\n\n  // =======================================================================\n  // RIGHT PANEL RENDERING (Time Cells)\n  // =======================================================================\n\n  /**\n   * Render a single row in the right panel (time columns)\n   * Recursively renders children if node is expanded.\n   *\n   * @param {Object} node - Tree node\n   * @param {Array} rightRows - Accumulator for HTML rows\n   * @param {boolean} parentVisible - Whether parent is visible\n   * @private\n   */\n  _renderRightRow(node, rightRows, parentVisible = true, parentId = null) {\n    const isExpanded = this._isNodeExpanded(node.id);\n    const isVisible = parentVisible;\n    const isCostMode = this._isCostMode();\n    const needsVolumeReset = (\n      node.type === 'pekerjaan' &&\n      this.state.volumeResetJobs instanceof Set &&\n      this.state.volumeResetJobs.has(node.id)\n    );\n\n    // Build row classes\n    const rowClasses = [`row-${node.type}`];\n    if (!isVisible) rowClasses.push('row-hidden');\n    if (needsVolumeReset) rowClasses.push('volume-warning');\n    const rowClass = rowClasses.join(' ').trim();\n\n    // Render time cells for each column\n      const timeColumns = this._getDisplayColumns();\n      const timeCells = timeColumns\n      .map((col) => this._renderTimeCell(node, col))\n      .join('');\n\n    // Render row\n    rightRows.push(`\n      <tr class=\"${rowClass}\" data-node-id=\"${node.id}\" data-parent-id=\"${parentId ?? ''}\" data-row-index=\"${rightRows.length}\">\n        ${timeCells}\n      </tr>\n    `);\n\n    // Recursively render children\n    if (node.children && node.children.length > 0) {\n      node.children.forEach((child) => {\n        this._renderRightRow(child, rightRows, isExpanded && isVisible, node.id);\n      });\n    }\n  }\n\n  /**\n   * Render a single time cell\n   * Shows percentage or volume based on display mode.\n   * Only pekerjaan nodes are editable.\n   *\n   * @param {Object} node - Tree node\n   * @param {Object} column - Time column definition\n   * @returns {string} HTML for cell\n   * @private\n   */\n  _renderTimeCell(node, column) {\n    // Non-pekerjaan nodes get readonly cells\n    if (node.type !== 'pekerjaan') {\n      return `<td class=\"time-cell readonly\" data-node-id=\"${node.id}\" data-col-id=\"${column.id}\"></td>`;\n    }\n\n    if (Array.isArray(column.childColumns) && column.childColumns.length > 0) {\n      const aggregatedValue = column.childColumns.reduce((sum, childColumn) => {\n        const childId = childColumn.fieldId || childColumn.id;\n        const saved = isCostMode\n          ? this._getCostAssignmentValue(`${node.id}-${childId}`)\n          : this._getAssignmentValue(`${node.id}-${childId}`);\n        const { value } = this.getEffectiveCellValue(node.id, childId, saved);\n        return sum + (Number(value) || 0);\n      }, 0);\n\n      const displayValue = this._formatDisplayValue(node.id, aggregatedValue, aggregatedValue);\n      const dataValue = Number.isFinite(aggregatedValue) ? aggregatedValue.toFixed(2) : '';\n      return `<td class=\"time-cell readonly monthly\"\n                data-node-id=\"${node.id}\"\n                data-col-id=\"${column.id}\"\n                data-value=\"${dataValue}\"\n                tabindex=\"-1\">\n                ${displayValue}\n              </td>`;\n    }\n\n    const cellKey = `${node.id}-${column.id}`;\n    const savedValue = isCostMode\n      ? this._getCostAssignmentValue(cellKey)\n      : this._getAssignmentValue(cellKey);\n    const { value: currentValue, modifiedValue} = this.getEffectiveCellValue(node.id, column.id, savedValue);\n\n    // Determine column type (weekly or monthly)\n    const columnMode = (column.generationMode || column.type || '').toLowerCase();\n    const columnTypeClass = (columnMode === 'monthly') ? 'monthly' : 'weekly';\n\n    // Build cell classes\n    let cellClasses = `time-cell editable ${columnTypeClass}`;\n    if (savedValue > 0) {\n      cellClasses += ' saved';\n    }\n    if (modifiedValue !== undefined && modifiedValue !== savedValue) {\n      cellClasses += ' modified';\n    }\n\n    const displayValue = this._formatDisplayValue(node.id, currentValue, savedValue);\n\n    return `<td class=\"${cellClasses}\"\n                data-node-id=\"${node.id}\"\n                data-col-id=\"${column.id}\"\n                data-value=\"${currentValue}\"\n                data-saved-value=\"${savedValue}\"\n                tabindex=\"0\">\n              ${displayValue}\n            </td>`;\n  }\n\n  /**\n   * Render badge that indicates node type (Klasifikasi/Sub-Klasifikasi/Pekerjaan)\n   * @param {Object} node - Tree node\n   * @returns {string} HTML badge\n   * @private\n   */\n  /**\n   * Render time column headers\n   * Creates <th> elements with proper formatting and tooltips.\n   * Uses DocumentFragment for performance.\n   *\n   * @param {HTMLElement} headerRow - Header row element to populate\n   * @returns {HTMLElement|string} Populated header row or 'legacy' if invalid\n   */\n  renderTimeHeader(headerRow) {\n    const timeColumns = this._getDisplayColumns();\n    if (!headerRow || timeColumns.length === 0) {\n      console.warn('[GridRenderer] Invalid header row or time columns');\n      return 'legacy';\n    }\n\n    console.log(`[GridRenderer] Rendering ${timeColumns.length} time headers`);\n\n    headerRow.innerHTML = '';\n    const fragment = document.createDocumentFragment();\n\n    timeColumns.forEach((col) => {\n      const th = document.createElement('th');\n      th.dataset.colId = col.id;\n\n      const line1 = col.label || '';\n      const line2 = col.rangeLabel || col.subLabel || '';\n      const columnMode = (col.generationMode || col.type || '').toLowerCase();\n      const isMonthly = columnMode === 'monthly';\n\n      // Add weekly/monthly class for column width standardization\n      th.className = isMonthly ? 'monthly' : 'weekly';\n\n      const safeLine1 = this.escapeHtml(line1);\n      const safeLine2 = this.escapeHtml(line2);\n\n      // Build header content\n      const headerParts = [`<span class=\"time-header__label\">${safeLine1}</span>`];\n      if (line2) {\n        headerParts.push(`<span class=\"time-header__range\">${safeLine2}</span>`);\n      }\n      th.innerHTML = `<div class=\"time-header\">${headerParts.join('')}</div>`;\n\n      // Set tooltip\n      th.title = col.tooltip || (line2 ? `${line1} ${line2}`.trim() : line1);\n\n      fragment.appendChild(th);\n    });\n\n    headerRow.appendChild(fragment);\n    console.log('[GridRenderer] ✅ Time headers rendered');\n\n    return headerRow;\n  }\n\n  // =======================================================================\n  // PROGRESS CALCULATION & VALIDATION\n  // =======================================================================\n\n  /**\n   * Render progress chip for a pekerjaan row\n   * Shows total progress percentage with validation status.\n   *\n   * @param {string|number} nodeId - Node ID\n   * @returns {string} HTML for progress chip\n   * @private\n   */\n  _renderProgressChip(nodeId) {\n    const total = this.calculateRowProgress(nodeId);\n    if (total === null) {\n      return '';\n    }\n\n    const tolerance = 0.5;\n    let badgeClass = 'progress-chip--ok';\n    let label = 'On Track';\n\n    if (total > 100 + tolerance) {\n      badgeClass = 'progress-chip--over';\n      label = 'Over 100%';\n    } else if (total < 100 - tolerance) {\n      badgeClass = 'progress-chip--under';\n      label = 'Under 100%';\n    }\n\n    return `\n      <span class=\"progress-chip ${badgeClass}\" title=\"${label}\">\n        ${total.toFixed(1)}%\n      </span>\n    `;\n  }\n\n  /**\n   * Calculate total progress for a row (sum of all time columns)\n   * Used for progress validation (should total 100%).\n   *\n   * @param {string|number} nodeId - Node ID\n   * @returns {number|null} Total percentage or null if invalid\n   */\n  calculateRowProgress(nodeId) {\n    if (!this.state || !Array.isArray(this.state.timeColumns) || this.state.timeColumns.length === 0) {\n      return null;\n    }\n\n    let total = 0;\n    this.state.timeColumns.forEach((column) => {\n      const { value } = this.getEffectiveCellValue(nodeId, column.id);\n      const numeric = Number.isFinite(value) ? value : parseFloat(value) || 0;\n      total += numeric;\n    });\n\n    if (!Number.isFinite(total)) {\n      return null;\n    }\n\n    return parseFloat(total.toFixed(1));\n  }\n\n  // =======================================================================\n  // CELL VALUE RESOLUTION\n  // =======================================================================\n\n  /**\n   * Get effective cell value (modified or saved)\n   * Checks modifiedCells Map first, falls back to assignmentMap.\n   *\n   * @param {string|number} nodeId - Node ID\n   * @param {string} columnId - Column ID\n   * @param {number} fallbackSaved - Fallback saved value\n   * @returns {Object} { value: number, modifiedValue: number|undefined }\n   */\n  getEffectiveCellValue(nodeId, columnId, fallbackSaved = 0) {\n    const cellKey = `${nodeId}-${columnId}`;\n    const useCost = this._isCostMode();\n    const savedNumeric = typeof fallbackSaved === 'number'\n      ? fallbackSaved\n      : parseFloat(fallbackSaved) || 0;\n\n    let modifiedValue;\n    const modifiedSource = useCost ? this.state?.costModifiedCells : this.state?.modifiedCells;\n    if (modifiedSource instanceof Map && modifiedSource.has(cellKey)) {\n      const candidate = parseFloat(modifiedSource.get(cellKey));\n      if (Number.isFinite(candidate)) {\n        modifiedValue = candidate;\n      }\n    }\n\n    const value = modifiedValue !== undefined ? modifiedValue : savedNumeric;\n    return { value, modifiedValue };\n  }\n\n  /**\n   * Get saved assignment value from assignmentMap\n   * @param {string} cellKey - Cell key (nodeId-columnId)\n   * @returns {number} Saved value or 0\n   * @private\n   */\n  _getAssignmentValue(cellKey) {\n    if (!this.state || !this.state.assignmentMap) return 0;\n\n    if (this.state.assignmentMap instanceof Map) {\n      return this.state.assignmentMap.get(cellKey) || 0;\n    }\n\n    if (typeof this.state.assignmentMap.get === 'function') {\n      return this.state.assignmentMap.get(cellKey) || 0;\n    }\n\n    if (Object.prototype.hasOwnProperty.call(this.state.assignmentMap, cellKey)) {\n      return this.state.assignmentMap[cellKey];\n    }\n\n    return 0;\n  }\n\n  _getCostAssignmentValue(cellKey) {\n    if (!this.state || !this.state.costAssignmentMap) {\n      return 0;\n    }\n\n    const map = this.state.costAssignmentMap;\n    if (map instanceof Map) {\n      return Number(map.get(cellKey)) || 0;\n    }\n    if (typeof map.get === 'function') {\n      return Number(map.get(cellKey)) || 0;\n    }\n    if (Object.prototype.hasOwnProperty.call(map, cellKey)) {\n      return Number(map[cellKey]) || 0;\n    }\n    return 0;\n  }\n\n  // =======================================================================\n  // TREE STATE MANAGEMENT\n  // =======================================================================\n\n  /**\n   * Check if a node is expanded\n   * @param {string|number} nodeId - Node ID\n   * @returns {boolean} True if expanded\n   * @private\n   */\n  _isNodeExpanded(nodeId) {\n    if (!this.state || !this.state.expandedNodes) {\n      return true; // Default to expanded\n    }\n    return this.state.expandedNodes.has(nodeId) !== false;\n  }\n\n  /**\n   * Toggle node expansion state\n   * Updates expandedNodes Set and returns new state.\n   *\n   * @param {string|number} nodeId - Node ID\n   * @returns {boolean} New expanded state\n   */\n  toggleNode(nodeId) {\n    if (!this.state.expandedNodes) {\n      this.state.expandedNodes = new Set();\n    }\n\n    const isCurrentlyExpanded = this.state.expandedNodes.has(nodeId);\n\n    if (isCurrentlyExpanded) {\n      this.state.expandedNodes.delete(nodeId);\n      console.log(`[GridRenderer] Collapsed node: ${nodeId}`);\n      return false;\n    } else {\n      this.state.expandedNodes.add(nodeId);\n      console.log(`[GridRenderer] Expanded node: ${nodeId}`);\n      return true;\n    }\n  }\n\n  /**\n   * Expand a node\n   * @param {string|number} nodeId - Node ID\n   */\n  expandNode(nodeId) {\n    if (!this.state.expandedNodes) {\n      this.state.expandedNodes = new Set();\n    }\n    this.state.expandedNodes.add(nodeId);\n    console.log(`[GridRenderer] Expanded node: ${nodeId}`);\n  }\n\n  /**\n   * Collapse a node\n   * @param {string|number} nodeId - Node ID\n   */\n  collapseNode(nodeId) {\n    if (!this.state.expandedNodes) {\n      return;\n    }\n    this.state.expandedNodes.delete(nodeId);\n    console.log(`[GridRenderer] Collapsed node: ${nodeId}`);\n  }\n\n  /**\n   * Expand all nodes in tree\n   */\n  expandAll() {\n    if (!this.state.expandedNodes) {\n      this.state.expandedNodes = new Set();\n    }\n\n    const collectIds = (nodes) => {\n      nodes.forEach((node) => {\n        if (!node || !node.id) return;\n        if (node.children && node.children.length > 0) {\n          this.state.expandedNodes.add(node.id);\n          collectIds(node.children);\n        }\n      });\n    };\n\n    if (Array.isArray(this.state.pekerjaanTree)) {\n      collectIds(this.state.pekerjaanTree);\n      console.log(`[GridRenderer] Expanded all nodes (${this.state.expandedNodes.size} nodes)`);\n    }\n  }\n\n  /**\n   * Collapse all nodes in tree\n   */\n  collapseAll() {\n    if (this.state.expandedNodes) {\n      this.state.expandedNodes.clear();\n      console.log('[GridRenderer] Collapsed all nodes');\n    }\n  }\n\n  // =======================================================================\n  // UI SYNCHRONIZATION\n  // =======================================================================\n\n  /**\n   * Synchronize row heights between left and right panels\n   * Ensures rows align properly across dual panels.\n   *\n   * @param {Object} domRefs - DOM references\n   * @param {HTMLElement} domRefs.leftTbody - Left table body\n   * @param {HTMLElement} domRefs.rightTbody - Right table body\n   */\n  syncRowHeights(domRefs) {\n    if (this.state?.useAgGrid) {\n      return;\n    }\n\n    const leftTbody = domRefs.leftTbody || document.getElementById('left-tbody');\n    const rightTbody = domRefs.rightTbody || document.getElementById('right-tbody');\n\n    if (!leftTbody || !rightTbody) {\n      return;\n    }\n\n    const leftRows = leftTbody.querySelectorAll('tr');\n    const rightRows = rightTbody.querySelectorAll('tr');\n\n    console.log(`[GridRenderer] Syncing heights for ${leftRows.length} rows`);\n\n    // Batch read phase (avoid layout thrashing)\n    const heights = [];\n    leftRows.forEach((leftRow, index) => {\n      const rightRow = rightRows[index];\n      if (!rightRow) return;\n\n      // Reset heights first\n      leftRow.style.height = '';\n      rightRow.style.height = '';\n\n      // Read heights\n      const leftHeight = leftRow.offsetHeight;\n      const rightHeight = rightRow.offsetHeight;\n      const maxHeight = Math.max(leftHeight, rightHeight);\n\n      heights.push(maxHeight);\n    });\n\n    // Batch write phase\n    leftRows.forEach((leftRow, index) => {\n      const rightRow = rightRows[index];\n      if (!rightRow || !heights[index]) return;\n\n      const maxHeight = heights[index];\n      leftRow.style.height = `${maxHeight}px`;\n      rightRow.style.height = `${maxHeight}px`;\n    });\n\n    console.log('[GridRenderer] ✅ Row heights synchronized');\n  }\n\n  /**\n   * Synchronize header heights between left and right panels\n   * @param {Object} domRefs - DOM references\n   * @param {HTMLElement} domRefs.leftThead - Left table header\n   * @param {HTMLElement} domRefs.rightThead - Right table header\n   */\n  syncHeaderHeights(domRefs) {\n    const leftThead = domRefs.leftThead || document.getElementById('left-thead');\n    const rightThead = domRefs.rightThead || document.getElementById('right-thead');\n\n    if (!leftThead || !rightThead) {\n      console.warn('[GridRenderer] Cannot sync header heights: missing thead elements');\n      return;\n    }\n\n    const leftHeaderRow = leftThead.querySelector('tr');\n    const rightHeaderRow = rightThead.querySelector('tr');\n\n    if (!leftHeaderRow || !rightHeaderRow) {\n      console.warn('[GridRenderer] Cannot sync header heights: missing tr elements');\n      return;\n    }\n\n    // Reset heights\n    leftHeaderRow.style.height = '';\n    rightHeaderRow.style.height = '';\n\n    // Calculate max height\n    const maxHeight = Math.max(leftHeaderRow.offsetHeight, rightHeaderRow.offsetHeight);\n\n    // Apply max height\n    leftHeaderRow.style.height = `${maxHeight}px`;\n    rightHeaderRow.style.height = `${maxHeight}px`;\n\n    console.log(`[GridRenderer] Header heights synchronized: ${maxHeight}px`);\n  }\n\n  /**\n   * Setup scroll synchronization between left and right panels\n   * @param {Object} domRefs - DOM references\n   * @param {HTMLElement} domRefs.leftPanelScroll - Left scroll container\n   * @param {HTMLElement} domRefs.rightPanelScroll - Right scroll container\n   * @returns {Object|null} Cleanup handlers or null if already setup\n   */\n  setupScrollSync(domRefs) {\n    const leftPanel = domRefs.leftPanelScroll || document.querySelector('.left-panel-scroll');\n    const rightPanel = domRefs.rightPanelScroll || document.querySelector('.right-panel-scroll');\n\n    if (!leftPanel || !rightPanel) {\n      console.warn('[GridRenderer] Cannot setup scroll sync: missing scroll containers');\n      return null;\n    }\n\n    // Check if already setup\n    if (this.state.cache && this.state.cache.gridScrollSyncBound) {\n      console.log('[GridRenderer] Scroll sync already setup');\n      return this.state.cache.gridScrollSyncBound;\n    }\n\n    const syncFromRight = () => {\n      if (leftPanel.scrollTop !== rightPanel.scrollTop) {\n        leftPanel.scrollTop = rightPanel.scrollTop;\n      }\n    };\n\n    const syncFromLeft = () => {\n      if (rightPanel.scrollTop !== leftPanel.scrollTop) {\n        rightPanel.scrollTop = leftPanel.scrollTop;\n      }\n    };\n\n    rightPanel.addEventListener('scroll', syncFromRight, { passive: true });\n    leftPanel.addEventListener('scroll', syncFromLeft, { passive: true });\n\n    const handlers = { syncFromRight, syncFromLeft };\n\n    // Cache handlers for cleanup\n    if (!this.state.cache) {\n      this.state.cache = {};\n    }\n    this.state.cache.gridScrollSyncBound = handlers;\n\n    console.log('[GridRenderer] ✅ Scroll sync setup complete');\n    return handlers;\n  }\n\n  // =======================================================================\n  // UTILITY METHODS\n  // =======================================================================\n\n  /**\n   * Get statistics about rendered grid\n   * @returns {Object} Grid statistics\n   */\n  getStats() {\n    const totalRows = this.state.flatPekerjaan ? this.state.flatPekerjaan.length : 0;\n    const pekerjaanRows = this.state.flatPekerjaan\n      ? this.state.flatPekerjaan.filter(n => n.type === 'pekerjaan').length\n      : 0;\n    const timeColumns = this.state.timeColumns ? this.state.timeColumns.length : 0;\n    const totalCells = pekerjaanRows * timeColumns;\n    const modifiedCells = this.state.modifiedCells ? this.state.modifiedCells.size : 0;\n    const expandedNodes = this.state.expandedNodes ? this.state.expandedNodes.size : 0;\n\n    return {\n      totalRows,\n      pekerjaanRows,\n      timeColumns,\n      totalCells,\n      modifiedCells,\n      expandedNodes\n    };\n  }\n\n  /**\n   * Validate grid state\n   * @returns {Object} Validation result\n   */\n  validateState() {\n    const errors = [];\n    const warnings = [];\n\n    if (!Array.isArray(this.state.pekerjaanTree)) {\n      errors.push('Missing pekerjaanTree');\n    }\n\n    if (!Array.isArray(this.state.timeColumns)) {\n      errors.push('Missing timeColumns');\n    }\n\n    if (!(this.state.volumeMap instanceof Map)) {\n      warnings.push('volumeMap is not a Map');\n    }\n\n    if (!(this.state.assignmentMap instanceof Map)) {\n      warnings.push('assignmentMap is not a Map');\n    }\n\n    if (!(this.state.modifiedCells instanceof Map)) {\n      warnings.push('modifiedCells is not a Map');\n    }\n\n    if (!(this.state.expandedNodes instanceof Set)) {\n      warnings.push('expandedNodes is not a Set');\n    }\n\n    const isValid = errors.length === 0;\n\n    if (!isValid) {\n      console.error('[GridRenderer] Validation errors:', errors);\n    }\n\n    if (warnings.length > 0) {\n      console.warn('[GridRenderer] Validation warnings:', warnings);\n    }\n\n    return {\n      isValid,\n      errors,\n      warnings\n    };\n  }\n}\n\n// Export utilities for external use\nexport {\n  escapeHtml,\n  formatNumber\n};\n"],"names":["EventDelegationManager","constructor","rootElement","this","handlers","Map","activeListeners","on","eventType","selector","handler","options","has","set","_attachListener","get","push","off","index","findIndex","h","splice","length","_detachListener","delete","clearEvent","destroy","keys","clear","listener","event","target","closest","contains","call","addEventListener","capture","passive","removeEventListener","rafThrottle","func","rafId","lastArgs","throttled","args","requestAnimationFrame","apply","cancel","cancelAnimationFrame","validateCellValue","value","min","max","precision","isValid","message","level","numValue","parseFloat","isNaN","Math","round","pow","updateProgressIndicator","pekerjaanId","totalProgress","state","row","document","querySelector","indicator","rowElement","nameCell","createElement","className","appendChild","createProgressIndicator","validationResult","weeklyValues","maxTotal","tolerance","total","reduce","sum","val","roundedTotal","abs","validateTotalProgress","textContent","toFixed","classList","add","progressTotals","handleCellValidation","cellElement","input","result","showTooltip","tooltipDuration","remove","existingTooltip","tooltip","style","position","setTimeout","applyValidationFeedback","cellKey","dataset","cellId","modifiedCells","window","showToast","GridEventManager","helpers","eventManagers","scrollHandlers","attachEvents","leftTbody","_a","domRefs","getElementById","rightTbody","_b","leftScroll","_c","leftPanelScroll","rightScroll","_d","rightPanelScroll","console","error","cleanup","_setupLeftPanelEvents","_setupRightPanelEvents","_setupScrollSync","topHorizontalScroll","_e","horizontalScrollTop","_setupHorizontalScrollSync","container","leftManager","_handleTreeToggle","_handleRowSelection","rightManager","_handleCellClick","_handleCellDoubleClick","_handleCellInput","_handleCellBlur","_handleCellKeydown","syncLeftToRight","scrollTop","syncRightToLeft","element","topScroll","bottomScroll","syncTopToBottom","scrollLeft","syncBottomToTop","toggleElement","stopPropagation","nodeId","isExpanded","expandedNodes","_toggleNodeChildren","_syncRowHeights","show","leftBody","rightBody","leftChildren","querySelectorAll","rightChildren","display","forEach","childId","toggle","rowIndex","rightRow","cell","preventDefault","_enterEditMode","currentValue","type","step","innerHTML","focus","select","inputElement","_exitEditMode","isDirty","split","_updatePekerjaanProgress","formattedValue","key","blur","_navigateToNextCell","originalValue","direction","shiftKey","ctrlKey","currentCell","nextCell","nextElementSibling","previousElementSibling","nextRow","cellIndex","Array","from","children","indexOf","prevRow","timeColumns","col","id","leftRows","rightRows","leftRow","height","leftHeight","offsetHeight","rightHeight","maxHeight","manager","values","attachGridEvents","buildColumnDefs","editableChecker","isEditableFn","defaultEditableChecker","inputMode","toLowerCase","validationStateGetter","getCellValidationState","baseColumns","headerName","field","minWidth","flex","pinned","cellRenderer","pekerjaanCellRenderer","cellClass","wrapText","autoHeight","width","resizable","editable","suppressHeaderMenuButton","valueFormatter","params","numericValue","Number","toLocaleString","minimumFractionDigits","maximumFractionDigits","formatVolume","dynamicColumns","map","column","fieldId","headerTitle","label","rangeText","rangeLabel","replace","trim","getCellKey","rowId","data","raw","_f","node","_h","_g","cellClassRules","cellDataType","cellEditor","valueParser","rawValue","isFinite","parsed","parseNumericValue","newValue","headerClass","mode","currency","formatTimeCellValue","concat","wrapper","paddingLeft","rowType","AGGridManager","gridApi","columnApi","gridOptions","currentColumns","themeObserver","topScrollInner","bottomHorizontalViewport","horizontalScrollHandlers","_isSyncingHorizontalScroll","mount","containerElement","_createGridOptions","createGrid","getColumnApi","_applyThemeClass","_setupThemeWatcher","_setupHorizontalScrollProxy","_updateTopScrollWidth","warn","updateData","tree","timeScale","columnDefs","_getColumnOptions","setGridOption","rowData","_buildRowData","disconnect","_teardownHorizontalScrollProxy","animateRows","suppressAggFuncInHeader","rowHeight","headerHeight","defaultColDef","sortable","rowClassRules","_isFailedRow","_isWarningRow","_hasSaveError","onCellValueChanged","_handleCellValueChanged","rows","safeColumns","walk","nodes","parentPath","depth","iterable","isArray","Object","filter","Boolean","normalizeNodes","snapshot_uraian","uraian","nama","name","kode","snapshot_kode","code","rowPath","pekerjaan_id","join","rowClasses","path","isEditable","rowClass","unit","snapshot_satuan","satuan","snapshot_unit","volume","_resolveVolumeValue","isCostMode","columnField","childColumns","child","childField","childValue","_fetchCostValue","_fetchAssignmentValue","assignmentMap","assignments","assignment_map","directValue","_normalizeCellValue","displayValue","_percentToVolume","childNodes","candidates","getChildren","log","colDef","displayScale","setDataValue","oldValue","_isCellEditable","isVolumeMode","rowVolume","validation","_validateCostValue","toastType","canonicalValue","_volumeToPercent","columnMeta","find","onCellChange","columnId","valueType","volumeMap","qty","jumlah","volume_total","total_volume","updateTopScrollMetrics","prototype","hasOwnProperty","modifiedCosts","costModifiedCells","costMap","costAssignmentMap","percent","totalVolume","numericPercent","numericVolume","volumeValue","numericTotal","numeric","isDark","documentElement","getAttribute","setInputMode","normalized","refreshCells","force","trimmed","topInner","bottomViewport","syncTop","syncBottom","centerContainer","scrollWidth","refreshRowStyles","__spreadValues","MutationObserver","mutations","mutation","attributeName","observe","attributes","attributeFilter","_resolveRowId","candidate","_setHasFlag","setRef","Set","failedRows","validationWarningRows","saveErrorRows","escapeHtml","text","div","formatNumber","num","decimals","n","GridRenderer","Error","_getDisplayColumns","activeTimeColumns","_isCostMode","displayMode","_formatDisplayValue","percentValue","referenceValue","numericReference","renderTables","pekerjaanTree","_renderLeftRow","_renderRightRow","leftHTML","rightHTML","parentVisible","parentId","_isNodeExpanded","isVisible","needsVolumeReset","volumeResetJobs","levelClass","progressChip","_renderProgressChip","timeCells","_renderTimeCell","aggregatedValue","childColumn","saved","_getCostAssignmentValue","_getAssignmentValue","getEffectiveCellValue","dataValue","savedValue","modifiedValue","cellClasses","generationMode","renderTimeHeader","headerRow","fragment","createDocumentFragment","th","colId","line1","line2","subLabel","isMonthly","safeLine1","safeLine2","headerParts","title","calculateRowProgress","badgeClass","fallbackSaved","useCost","savedNumeric","modifiedSource","toggleNode","expandNode","collapseNode","expandAll","collectIds","size","collapseAll","syncRowHeights","useAgGrid","heights","syncHeaderHeights","leftThead","rightThead","leftHeaderRow","rightHeaderRow","setupScrollSync","leftPanel","rightPanel","cache","gridScrollSyncBound","syncFromRight","syncFromLeft","getStats","totalRows","flatPekerjaan","pekerjaanRows","totalCells","validateState","errors","warnings"],"mappings":"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"}