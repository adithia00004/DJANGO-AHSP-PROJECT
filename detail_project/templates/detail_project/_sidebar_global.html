<!-- templates/detail_project/_sidebar_global.html -->
<!-- UPDATE: Added Kelola Tahapan menu item -->

{% load i18n %}

{% url 'dashboard:dashboard' as url_dashboard %}
{% if project %}
  {% url 'detail_project:list_pekerjaan' project.id as url_list_pekerjaan %}
  {% url 'detail_project:volume_pekerjaan' project.id as url_volume_pekerjaan %}
  {% url 'detail_project:harga_items' project.id as url_harga_items %}
  {% url 'detail_project:template_ahsp' project.id as url_template_ahsp %}
  {% url 'detail_project:rincian_ahsp' project.id as url_rincian_ahsp %}
  {% url 'detail_project:rekap_rab' project.id as url_rekap_rab %}
  {% url 'detail_project:rekap_kebutuhan' project.id as url_rekap_kebutuhan %}
  {% url 'detail_project:kelola_tahapan' project.id as url_kelola_tahapan %}
{% endif %}

{% trans "Project" as project_label %}
{% trans "Global project navigation" as nav_label %}
{% trans "Close sidebar" as close_label %}
{% trans "Dashboard" as t_dashboard %}
{% trans "List Pekerjaan" as t_list_pekerjaan %}
{% trans "Volume Pekerjaan" as t_volume_pekerjaan %}
{% trans "Harga Items" as t_harga_items %}
{% trans "Template AHSP" as t_template_ahsp %}
{% trans "Rincian AHSP" as t_rincian_ahsp %}
{% trans "Rekap RAB" as t_rekap_rab %}
{% trans "Rekap Kebutuhan" as t_rekap_kebutuhan %}
{% trans "Kelola Tahapan" as t_kelola_tahapan %}

<aside id="dp-sidebar"
       class="dp-sidebar dp-z-sidebar"
       aria-label="{{ nav_label }}"
       aria-labelledby="dp-sidebar-title"
       aria-hidden="true"
       tabindex="-1"
       role="complementary"
       data-version="v4"
       data-pid="{{ project.id|default:'' }}">
  <div class="dp-sidebar__inner dp-surface dp-border">
    <div class="d-flex align-items-start justify-content-between">
      <div class="dp-sidebar__project">
        <div id="dp-sidebar-title" class="dp-sidebar__title"
             title="{{ project.nama|default:project_label }}">
          {{ project.nama|default:project_label }}
        </div>
        {% if project %}
          {# Meta ringkas (tahun/lokasi) untuk smoke test dan aksesibilitas #}
          {% if project.tahun_project or project.lokasi_project %}
            <div class="dp-sidebar__meta text-muted small">
              {% if project.tahun_project %}{{ project.tahun_project }}{% endif %}
              {% if project.tahun_project and project.lokasi_project %} Â· {% endif %}
              {% if project.lokasi_project %}{{ project.lokasi_project }}{% endif %}
            </div>
          {% elif project.tahun_proyek %}
            <div class="dp-sidebar__meta text-muted small">{{ project.tahun_proyek }}</div>
          {% endif %}
        {% endif %}
      </div>
      {# Tombol close (mobile) untuk offcanvas sidebar #}
      <button type="button"
              class="btn-close ms-2 d-lg-none"
              data-lp-toggle="sidebar"
              data-lp-target="#dp-sidebar"
              aria-label="{{ close_label }}">
      </button>
    </div>

    <nav class="dp-sidebar__nav" aria-label="Menu halaman">
      <ul class="dp-nav-list">
        {% if not project %}
          <li>
            <a class="dp-link" href="{{ url_dashboard }}">
              <i class="bi bi-house-door" aria-hidden="true"></i>
              <span>{{ t_dashboard }}</span>
            </a>
          </li>
        {% else %}
          <!-- Input Section -->
          <li class="dp-nav-section">Input Data</li>
          <li>
            <a class="dp-link {% if side_active == 'list_pekerjaan' %}is-active{% endif %}"
               {% if side_active == 'list_pekerjaan' %}aria-current="page"{% endif %}
               href="{{ url_list_pekerjaan|default:'#' }}">
              <i class="bi bi-list-task" aria-hidden="true"></i>
              <span>{{ t_list_pekerjaan }}</span>
            </a>
          </li>
          <li>
            <a class="dp-link {% if side_active == 'volume_pekerjaan' %}is-active{% endif %}"
               {% if side_active == 'volume_pekerjaan' %}aria-current="page"{% endif %}
               href="{{ url_volume_pekerjaan|default:'#' }}">
              <i class="bi bi-box-seam" aria-hidden="true"></i>
              <span>{{ t_volume_pekerjaan }}</span>
            </a>
          </li>
          <li>
            <a class="dp-link {% if side_active == 'template_ahsp' %}is-active{% endif %}"
               {% if side_active == 'template_ahsp' %}aria-current="page"{% endif %}
               href="{{ url_template_ahsp|default:'#' }}">
              <i class="bi bi-list-ul" aria-hidden="true"></i>
              <span>{{ t_template_ahsp }}</span>
            </a>
          </li>
          <li>
            <a class="dp-link {% if side_active == 'harga_items' %}is-active{% endif %}"
               {% if side_active == 'harga_items' %}aria-current="page"{% endif %}
               href="{{ url_harga_items|default:'#' }}">
              <i class="bi bi-currency-dollar" aria-hidden="true"></i>
              <span>{{ t_harga_items }}</span>
            </a>
          </li>

          <!-- Analysis Section -->
          <li class="dp-nav-section">Analisis & Laporan</li>
          <li>
            <a class="dp-link {% if side_active == 'rincian_ahsp' %}is-active{% endif %}"
               {% if side_active == 'rincian_ahsp' %}aria-current="page"{% endif %}
               href="{{ url_rincian_ahsp|default:'#' }}">
              <i class="bi bi-collection" aria-hidden="true"></i>
              <span>{{ t_rincian_ahsp }}</span>
            </a>
          </li>
          <li>
            <a class="dp-link {% if side_active == 'rekap_rab' %}is-active{% endif %}"
               {% if side_active == 'rekap_rab' %}aria-current="page"{% endif %}
               href="{{ url_rekap_rab|default:'#' }}">
              <i class="bi bi-card-checklist" aria-hidden="true"></i>
              <span>{{ t_rekap_rab }}</span>
            </a>
          </li>
          <li>
            <a class="dp-link {% if side_active == 'rekap_kebutuhan' %}is-active{% endif %}"
               {% if side_active == 'rekap_kebutuhan' %}aria-current="page"{% endif %}
               href="{{ url_rekap_kebutuhan|default:'#' }}">
              <i class="bi bi-list-check" aria-hidden="true"></i>
              <span>{{ t_rekap_kebutuhan }}</span>
            </a>
          </li>

          <!-- Planning Section (NEW) -->
          <li class="dp-nav-section">Perencanaan</li>
          <li>
            <a class="dp-link {% if side_active == 'kelola_tahapan' %}is-active{% endif %}"
               {% if side_active == 'kelola_tahapan' %}aria-current="page"{% endif %}
               href="{{ url_kelola_tahapan|default:'#' }}">
              <i class="bi bi-calendar2-range" aria-hidden="true"></i>
              <span>{{ t_kelola_tahapan }}</span>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</aside>
<button class="dp-sidebar__backdrop dp-sidebar-backdrop" type="button" aria-label="{{ close_label }}"></button>
