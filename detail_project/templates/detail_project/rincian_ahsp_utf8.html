{% extends "detail_project/base_detail.html" %}
{% load static %}

{% block title %}Rincian AHSP — {{ project.nama }}{% endblock %}
{% block body_attrs %}data-page="rincian_ahsp"{% endblock %}

{% block detail_css %}{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'detail_project/css/harga_items.css' %}">
  <link rel="stylesheet" href="{% static 'detail_project/css/rincian_ahsp.css' %}">
{% endblock %}

{% block dp_toolbar %}{% endblock %}

{% block dp_content %}
<div id="rekap-app"
     class="hi-app ta-app"
     data-project-id="{{ project.id }}"
     data-ep-rekap="{% url 'detail_project:api_get_rekap_rab' project.id %}"
     data-ep-pricing="{% url 'detail_project:api_project_pricing' project.id %}"
     data-ep-detail-prefix="{% url 'detail_project:api_get_detail_ahsp' project.id 0 %}"
     data-ep-pricing-item-prefix="{% url 'detail_project:api_pekerjaan_pricing' project.id 0 %}"
     data-ep-reset-prefix="{% url 'detail_project:api_reset_detail_ahsp_to_ref' project.id 0 %}"
     data-locale="id-ID">

  <header class="ta-page-header">
    <h1 class="ta-title">Rincian AHSP</h1>
    <p class="ta-subtitle">Detail komponen AHSP per pekerjaan (dengan harga dan total).</p>
  </header>

  <div id="ra-toolbar-inner" class="ta-toolbar d-flex align-items-center gap-2 flex-wrap mb-3 dp-sticky-topbar dp-layer-toolbar border-bottom ux-toolbar-inputs" role="toolbar" aria-label="Toolbar Rincian AHSP">
    <div class="ta-combobox ta-searchbar flex-grow-1" role="search">
      <div class="input-group">
        <span class="input-group-text" id="rk-search-addon"><i class="bi bi-search" aria-hidden="true"></i></span>
        <input id="rk-search"
               type="search"
               class="hi-input form-control ux-focusable"
               placeholder="Cari uraian/kode… (⌘/Ctrl+K)"
               autocomplete="off"
               aria-label="Cari pekerjaan"
               aria-describedby="rk-search-addon" />
      </div>
    </div>

    <div class="ta-toolbar-hint only-desktop ms-2">
      <span class="kbd-hint">
        <kbd>Ctrl</kbd>/<kbd>⌘</kbd>+<kbd>K</kbd> cari &middot;
        <kbd>Ctrl</kbd>/<kbd>⌘</kbd>+<kbd>S</kbd> apply override
      </span>
    </div>

    <div class="d-inline-flex align-items-center gap-2 ms-auto">
      <span class="badge text-bg-light" id="rk-badge-buk" title="Biaya Umum &amp; Keuntungan proyek">BUK: 10.00%</span>
      <div id="rk-grand" class="ux-mono small text-muted" aria-live="polite">Grand Total: Rp 0,00</div>
    </div>
  </div>

  <div class="hi-body ta-body">
    <aside class="rk-left ta-sidebar" aria-label="Daftar pekerjaan">
      <ul id="rk-list" class="ta-job-list" role="listbox" aria-label="Pekerjaan">
        <li class="rk-item ta-job-item"><div class="row-note">Memuat…</div></li>
      </ul>
    </aside>

    <div id="rk-resizer" class="rk-resizer ux-resizer" role="separator" aria-orientation="vertical" aria-label="Resize panel" tabindex="0"></div>

    <section class="rk-right ta-editor" aria-label="Detail pekerjaan terpilih">
      <div class="rk-right-header ta-seg-header">
        <div class="rk-right-head-main">
          <div class="ux-mono mono small text-muted rk-right-meta">
            <span id="rk-pkj-kode" class="mono">-</span>
            &middot;
            <span id="rk-pkj-sat" class="mono">-</span>
            &nbsp;&nbsp;<span id="rk-pkj-source" class="ux-chip ux-mono mono">-</span>
          </div>
          <div id="rk-pkj-uraian" class="rk-right-title ta-title">Pilih pekerjaan di kiri</div>
        </div>

        <div class="rk-right-actions d-flex align-items-center gap-2">
          <span id="rk-eff" class="ux-chip ux-mono mono" title="BUK efektif">
            <i class="bi bi-lightning-charge-fill"></i>&nbsp;Efektif: -%
          </span>
          <span id="rk-pkj-ovr-chip" class="ux-chip warn ux-mono mono" hidden>
            <i class="bi bi-sliders2"></i>&nbsp;Override
          </span>
          <div class="input-group input-group-sm" style="width:160px">
            <span class="input-group-text ux-mono mono">%</span>
            <input id="rk-ovr-input" type="text" inputmode="decimal" class="hi-input form-control ux-mono mono" placeholder="Override">
          </div>
          <div class="btn-group btn-group-sm">
            <button id="rk-ovr-apply" class="btn btn-primary btn-neon d-inline-flex align-items-center gap-1" type="button">
              <i class="bi bi-check2"></i><span>Apply</span>
            </button>
            <button id="rk-ovr-clear" class="btn btn-outline-secondary d-inline-flex align-items-center gap-1" type="button">
              <i class="bi bi-x-lg"></i><span>Clear</span>
            </button>
            <button id="rk-btn-reset" class="btn btn-outline-warning d-inline-flex align-items-center gap-1" type="button" title="Reset ke Referensi">
              <i class="bi bi-arrow-repeat"></i><span>Reset</span>
            </button>
          </div>
        </div>
      </div>

      <div id="rk-summary" class="rk-summary d-flex flex-wrap gap-2 my-2">
        <span class="ux-badge-ref ux-mono mono" id="rk-sum-sub">Sub-Total: -</span>
        <span class="ux-badge-ref ux-mono mono" id="rk-sum-buk">BUK (-%): -</span>
        <span class="ux-badge-ref ux-mono mono" id="rk-sum-grand">Grand Total: -</span>
      </div>

      <div class="hi-table-wrap ta-table-wrap">
        <table id="ra-table" class="table table-sm ra-table ta-table table-hover ux-thead" aria-label="Rincian AHSP (pekerjaan terpilih)">
          <colgroup>
            <col class="col-no">
            <col class="col-uraian">
            <col class="col-kode">
            <col class="col-satuan">
            <col class="col-koef">
            <col class="col-rps">
            <col class="col-rpj">
          </colgroup>
          <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">Uraian</th>
              <th scope="col">Kode</th>
              <th scope="col" class="text-center">Satuan</th>
              <th scope="col" class="text-end">Koefisien</th>
              <th scope="col" class="text-end">Harga Satuan (Rp)</th>
              <th scope="col" class="text-end">Jumlah Harga (Rp)</th>
            </tr>
          </thead>
          <tbody id="rk-tbody-detail">
            <tr><td colspan="7" class="row-note">Pilih pekerjaan untuk melihat rincian.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <div id="rk-toast" class="rk-toast-wrap" aria-live="polite" aria-atomic="true"></div>
</div>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script src="{% static 'detail_project/js/rincian_ahsp.js' %}"></script>
{% endblock %}

