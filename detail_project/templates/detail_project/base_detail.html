<!-- templates/detail_project/base_detail.html -->
{% extends "base.html" %}
{% load static %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'detail_project/css/sidebar_global.css' %}">
<link rel="stylesheet" href="{% static 'detail_project/css/_project_identity.css' %}">
<link rel="stylesheet" href="{% static 'detail_project/css/loading.css' %}">

{% block detail_css %}
<link rel="stylesheet" href="{% static 'detail_project/css/detail_ahsp.css' %}">
{% endblock %}
<link rel="stylesheet" href="{% static 'detail_project/css/sync_indicator.css' %}">

{% block extra_css %}{% endblock %}

{% block extra_js_head %}{% endblock %}
{% endblock %}

{% block content %}

<nav id="dp-topbar" class="navbar navbar-expand bg-body shadow-sm sticky-top dp-z-topbar " role="navigation"
  aria-label="Toolbar proyek">
  <div class="container py-2 d-flex align-items-center gap-2">
    <button id="dp-sidebar-toggle" class="btn btn-outline-secondary btn-sm me-2" type="button" data-lp-toggle="sidebar"
      data-lp-target="#dp-sidebar" aria-controls="dp-sidebar" aria-expanded="false" title="Menu proyek">
      <i class="bi bi-layout-sidebar"></i> <span class="d-none d-sm-inline">Menu</span>
    </button>

    <!-- Brand/identitas project -->
    <span class="navbar-text fw-semibold me-2">
      {{ project.nama|default:"Project" }}
    </span>
    <span class="text-muted small">ID: {{ project.id }}</span>

    <!-- Aksi halaman (kanan) -->
    <div class="ms-auto d-flex align-items-center gap-2">
      {% block dp_topbar_extra %}{% endblock %}
    </div>

  </div>
</nav>

<div class="dp-hover-edge" aria-hidden="true"></div>
<div class="container-fluid mt-2">
  {% include 'detail_project/_project_identity.html' %}
</div>

<div id="vp-app" class="container-fluid my-3 dp-scope">
  {% block dp_content %}{% endblock %}
</div>

<!-- ============================================================ -->
<!-- SSOT GLOBAL EXPORT MODAL (used by all pages via ExportManager) -->
<!-- ============================================================ -->
<div class="modal fade dp-modal" id="globalExportModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="globalExportModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-body text-center py-4">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <h6 class="mb-1" id="globalExportModalLabel">Memproses Export</h6>
        <p class="text-muted small mb-2" id="globalExportModalText">Mohon tunggu...</p>
        <div class="progress mt-3" style="height: 6px;">
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"
            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Global ExportManager (SSOT for all export operations) -->
<script src="{% static 'detail_project/js/export/ExportManager.js' %}" defer></script>

{% include 'detail_project/_sidebar_global.html' %}

<script defer src="{% static 'detail_project/js/sidebar_global.js' %}"></script>

{% endblock %}

{% block extra_js %}
<script src="{% static 'detail_project/js/numeric.umd.js' %}" defer></script>
<script src="{% static 'detail_project/js/source_change_state.js' %}" defer></script>
<script src="{% static 'detail_project/js/sync_indicator.js' %}" defer></script>
<script src="{% static 'detail_project/js/sync_led.js' %}" defer></script>
<script src="{% static 'detail_project/js/core/messages.js' %}" defer></script>
{% block page_js %}{% endblock %}
{% endblock %}